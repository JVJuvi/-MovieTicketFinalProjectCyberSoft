if (self.CavalryLogger) { CavalryLogger.start_js(["geVjUSa"]); }

__d("MercuryAPIArgsSource",[],(function(a,b,c,d,e,f){e.exports={CHAT:"chat",JEWEL:"jewel",MERCURY:"mercury",MERCURYSYNC:"mercury_sync",WEBMESSENGER:"web_messenger",MESSENGER:"messenger",UBISPCLIENT:"unified_inbox_sp_client"}}),null);
__d("MercuryAudioType",[],(function(a,b,c,d,e,f){e.exports={FileAttachment:"file_attachment",AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"}}),null);
__d("MessageLiveLocationClientSyncProtocolStopReason",[],(function(a,b,c,d,e,f){e.exports={EXPIRED:1,CANCELED:2,ARRIVED:3}}),null);
__d("MessagingTag",[],(function(a,b,c,d,e,f){e.exports={ACTION_ARCHIVED:"action:archived",INBOX:"inbox",MARKETPLACE_FOLDER:"marketplace_folder",PENDING:"pending",MONTAGE:"montage",OTHER:"other",EVENT:"event",SENT:"sent",SPAM:"spam",UPDATES:"broadcasts_inbox",BCC:"header:bcc",FILTERED_CONTENT:"filtered_content",FILTERED_CONTENT_BH:"filtered_content_bh",FILTERED_CONTENT_ACCOUNT:"filtered_content_account",FILTERED_CONTENT_QUASAR:"filtered_content_quasar",FILTERED_CONTENT_INVALID_APP:"filtered_content_invalid_app",UNAVAILABLE_ATTACHMENT:"unavailable_attachment",UNREAD:"unread",FLAGGED:"flagged",GROUPS:"groups",TRANSITIONAL_MAILBOX:"transitional_mailbox",ARCHIVED:"archived",EMAIL:"email",VOICEMAIL:"voicemail",SPAM_SPOOFING:"spam:spoofing",SPOOF_WARNING:"MTA:spoof_warning",SMS_TAG_ROOT:"SMSShortcode:",APP_ID_ROOT:"app_id:",DOMAIN_AUTH_PASS:"MTA:dmarc:pass",DOMAIN_AUTH_FAIL:"MTA:dmarc:fail",MTA_SYSTEM_MESSAGE:"MTA:system_message",EMAIL_MESSAGE:"source:email",MARKETPLACE:"marketplace",ROOM:"room",PAGES:"pages",PAGE_BACKGROUND:"page_background",PAGE_FOLLOWUP:"page_followup",ONE_CLICK_MESSAGE:"page_one_click_message",MESSAGE_REQUEST_AGGREGATION_UNIT:"message_request_aggregation_unit",ONE_WAY_MESSAGE:"one_way_message",ACTION_COPIED_MESSAGE:"action:copy_message",ACTION_COPIED_SELF_MESSAGE:"copy_self_message",ACTION_COPIED_ATTACHMENT:"action:copy_attachment",ACTION_COPIED_SELF_ATTACHMENT:"copy_self_attachment",IRIS_MAPPING:{FOLDER_INVALID:null,FOLDER_INBOX:"inbox",FOLDER_OTHER:"other",FOLDER_SPAM:"spam",FOLDER_PENDING:"pending",FOLDER_MONTAGE:"montage",FOLDER_HIDDEN:"hidden",FOLDER_DISABLED:"disabled",FOLDER_PAGE_BACKGROUND:"page_background",FOLDER_PAGE_DONE:"page_done",FOLDER_BLOCKED:"blocked",FOLDER_COMMUNITY:"community",FOLDER_RESTRICTED:"restricted",FOLDER_BC_PARTNERSHIP:"bc_partnership"}}}),null);
__d("PageCommItemStatus",[],(function(a,b,c,d,e,f){e.exports={FOLLOW_UP:"FOLLOW_UP",DONE:"DONE",TODO:"TODO",SPAM:"SPAM",DELETED:"DELETED"}}),null);
__d("ZenonMediaStatsSource",[],(function(a,b,c,d,e,f){"use strict";a=["averageRtcpInterval","firCount","frameBitDepth","frameHeight","frameWidth","nackCount","packetsLost","pliCount","qpSum","remoteId","sliCount","trackId","timestamp"];b=["bytesSent","encoderImplementation","framesEncoded","headerBytesSent","hugeFramesSent","keyFramesEncoded","lastPacketSentTimestamp","mediaSourceId","packetsSent","perDscpPacketsSent","qualityLimitationDurations","qualityLimitationReason","qualityLimitationResolutionChanges","retransmittedBytesSent","retransmittedPacketsSent","rid","senderId","targetBitrate","totalEncodedBytesTarget","totalEncodeTime","totalPacketSendDelay"];c=["audioLevel","burstDiscardCount","burstDiscardRate","burstLossCount","burstPacketsDiscarded","burstPacketsLost","bytesReceived","concealedSamples","concealmentEvents","decoderImplementation","estimatedPlayoutTimestamp","fecPacketsDiscarded","fecPacketsReceived","fractionLost","framesDecoded","framesDropped","framesReceived","gapDiscardRate","gapLossRate","headerBytesReceived","insertedSamplesForDeceleration","jitter","jitterBufferDelay","jitterBufferEmittedCount","keyFramesDecoded","lastPacketReceivedTimestamp","packetsDiscarded","packetsDuplicated","packetsFailedDecryption","packetsReceived","packetsRepaired","perDscpPacketsReceived","receiverId","removedSamplesForAcceleration","roundTripTime","silentConcealedSamples","totalAudioEnergy","totalDecodeTime","totalInterFrameDelay","totalSamplesDuration","totalSamplesReceived","totalSquaredInterFrameDelay"];d=["delayedPacketOutageSamples","framesSent","interruptionCount","jitterBufferTargetDelay","relativePacketArrivalDelay","sumOfSquaredFramesDuration","timestamp","totalFramesDuration","totalInterruptionDuration"];e=["availableOutgoingBitrate","consentRequestsSent","requestsReceived","requestsSent","responsesReceived","responsesSent"];var g=["audioLevel","framesPerSecond","height","timestamp","totalAudioEnergy","totalSamplesDuration","width"],h=["googAccelerateRate","googCurrentDelayMs","googDecodingCNG","googDecodingCTN","googDecodingNormal","googDecodingPLC","googDecodingPLCCNG","googExpandRate","googJitterReceived","googPreemptiveExpandRate","googPreferredJitterBufferMs","googSecondaryDiscardedRate","googSpeechExpandRate","packetsLost"],i=["googActualEncBitrate"],j=["googRtt"];f.RTP_STATS=a;f.OUTBOUND_RTP_STATS=b;f.INBOUND_RTP_STATS=c;f.TRACK_STATS=d;f.CANDIDATE_PAIR_STATS=e;f.MEDIA_SOURCE_STATS=g;f.SSRC_STATS=h;f.VIDEO_BWE_STATS=i;f.GOOG_CANDIDATE_PAIR_STATS=j}),66);
__d("ZenonMediaStatsSourcePreM86",[],(function(a,b,c,d,e,f){"use strict";a=["firCount","nackCount","packetsLost","pliCount","qpSum","sliCount","timestamp"];b=["audioLevel","concealedSamples","concealmentEvents","delayedPacketOutageSamples","frameHeight","framesDropped","framesReceived","framesSent","frameWidth","insertedSamplesForDeceleration","interruptionCount","jitterBufferDelay","jitterBufferEmittedCount","jitterBufferTargetDelay","relativePacketArrivalDelay","removedSamplesForAcceleration","sumOfSquaredFramesDuration","timestamp","totalAudioEnergy","totalFramesDuration","totalInterruptionDuration","totalSamplesDuration","totalSamplesReceived"];c=["burstDiscardCount","burstDiscardRate","burstLossCount","burstPacketsDiscarded","burstPacketsLost","bytesReceived","decoderImplementation","estimatedPlayoutTimestamp","fecPacketsDiscarded","fecPacketsReceived","framesDecoded","gapDiscardRate","gapLossRate","headerBytesReceived","jitter","keyFramesDecoded","lastPacketReceivedTimestamp","packetsDiscarded","packetsReceived","packetsRepaired","roundTripTime","totalDecodeTime","totalInterFrameDelay","totalSquaredInterFrameDelay"];d=["bytesSent","framesEncoded","headerBytesSent","hugeFramesSent","keyFramesEncoded","packetsSent","qualityLimitationResolutionChanges","retransmittedBytesSent","retransmittedPacketsSent","targetBitrate","totalEncodedBytesTarget","totalEncodeTime","totalPacketSendDelay"];f.RTP_STATS=a;f.TRACK_STATS=b;f.INBOUND_RTP_STATS=c;f.OUTBOUND_RTP_STATS=d}),66);
__d("ZenonRenderedView",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({THUMBNAIL:1,GRID:2,PINNED:3});c=a;f["default"]=c}),66);
__d("ZenonMediaStatsConfig",["UserAgent","ZenonMediaStatsSource","ZenonMediaStatsSourcePreM86","ZenonRenderedView"],(function(a,b,c,d,e,f,g){"use strict";var h={contentType:"audio",remote:!1,trackId:"globalStatsTrackId"},i=h.trackId,j=h.contentType,k={contentType:"audio",remote:!1,trackId:"pinnedAudioStatsTrackId"},l={contentType:"video",remote:!1,trackId:"pinnedVideoStatsTrackId"},m={contentType:"audio",remote:!1,trackId:"outboundAudioStatsTrackId"},n=m.trackId,o={contentType:"screen_audio",remote:!1,trackId:"outboundScreenAudioStatsTrackId"},p=o.trackId,q={contentType:"screen",remote:!1,trackId:"outboundScreenStatsTrackId"},r=q.trackId,s={contentType:"video",remote:!1,trackId:"outboundVideoStatsTrackId"},t=s.trackId,u=0,v=6e4,w={AUDIO_DEV_IS_STALLED:"audioDevIsStalled",AUDIO_DEV_REC_STALLS:"audioDevRecStalls",AUDIO_DEV_STALL_DURATION:"audioDevStallDuration",AUDIO_DEV_TOTAL_STALLS:"audioDevTotalStalls",AUDIO_LOG_LEVEL:"audioLogLevel",AUDIO_LOG_LEVEL_COUNT:"audioLogLevelCount",AUDIO_LOUDNESS_LEVEL:"audioLoudnessLevel",AV_SYNC:"avSync",AV_SYNC_ABS:"avSyncAbs",AV_SYNC_COUNT:"avSyncCount",AV_SYNC_OOB:"avSyncOob",E2E_LATENCY:"e2eLatency",FRAME_RATE_MEAN:"framerateMean",PACKETS_LOST_CORRECTED:"packetsLostCorrected",RENDERED_VIEW:"renderedView",SIMULCAST_LAYER_CHANGES:"simulcast_layer_changes",VIDEO_CAPTURE_FRAME_COUNT:"captureFrameCount",VIDEO_CAPTURE_IS_STALLED:"videoCaptureIsStalled",VIDEO_CAPTURE_STALL_DURATION:"videoCaptureStallDuration",VIDEO_CAPTURE_TOTAL_STALLS:"videoCaptureTotalStalls",VIDEO_CONVERTED_QP_SUM:"videoConvertedQpSum",VIDEO_DECODE_TIME:"videoDecodeTime",VIDEO_DECODED_BYTES:"videoDecodedBytes",VIDEO_ENCODE_IS_STALLED:"videoEncodeIsStalled",VIDEO_ENCODE_STALL_DURATION:"videoEncodeStallDuration",VIDEO_ENCODE_TOTAL_STALLS:"videoEncodeTotalStalls",VIDEO_FREEZE_COUNT:"videoFreezeCount",VIDEO_FREEZE_DURATION:"videoFreezeDuration",VIDEO_PAUSE_COUNT:"videoPauseCount",VIDEO_PAUSE_DURATION:"videoPauseDuration",VIDEO_QP:"qp",VIDEO_SENT_IS_STALLED:"videoSentIsStalled",VIDEO_SENT_STALL_DURATION:"videoSentStallDuration",VIDEO_SENT_TOTAL_STALLS:"videoSentTotalStalls",VIDEO_SUM_CAPTURE_PIXEL:"videoSumCapturePixel",VIDEO_SUM_PIXEL:"videoSumPixel"},x={AUDIO_NETEQ_WAIT_TIME:"audioNeteqWaitTime",AUDIO_PACKET_LOSS_RATE:"audioPacketLossRate",AUDIO_PLC_CNG_RATE:"audioPlcCngRate",AUDIO_PLC_RATE:"audioPlcRate",GLOBAL_AUDIO_BITRATE:"globalAudioBitrate",GLOBAL_BATTERY_USAGE:"globalBatteryUsage",GLOBAL_CPU_USAGE:"globalCpuUsage",GLOBAL_VIDEO_BITRATE:"globalVideoBitrate",ROUND_TRIP_TIME:"roundTripTime",VIDEO_AV_SYNC_ABS:"videoAvSyncAbs",VIDEO_AV_SYNC_OOB:"videoAvSyncOob",VIDEO_CROPPING_RATIO:"videoCroppingRatio",VIDEO_ENCODED_FRAME_RATE:"encodedFrameRate",VIDEO_FRAME_RATE:"videoFrameRate",VIDEO_FREEZE_COUNT_PER_MIN:"videoFreezeCountPerMin",VIDEO_FREEZE_DURATION_PER_MIN:"videoFreezeDurationPerMin",VIDEO_NETEQ_WAIT_TIME:"videoNeteqWaitTime",VIDEO_PACKET_LOSS_RATE:"videoPacketLossRate",VIDEO_QP:"videoQP",VIDEO_QUALITY:"videoQuality",VIDEO_RENDER_SCALE_RATIO:"videoRenderScaleRatio"},y=["bytesReceived","bytesSent","consentRequestsSent","estimatedPlayoutTimestamp","fecPacketsDiscarded","fecPacketsReceived","firCount","framesDecoded","framesEncoded","framesReceived","framesSent","googDecodingCNG","googDecodingCTN","googDecodingNormal","googDecodingPLC","googDecodingPLCCNG","insertedSamplesForDeceleration","jitterBufferDelay","jitterBufferEmittedCount","keyFramesDecoded","keyFramesEncoded","nackCount","packetsLost","packetsReceived","packetsSent","pliCount","qpSum","requestsReceived","requestsSent","removedSamplesForAcceleration","responsesReceived","responsesSent","totalAudioEnergy","totalDecodeTime","totalEncodeTime","totalInterFrameDelay","totalPacketSendDelay","totalSamplesDuration","totalSamplesReceived","totalSquaredInterFrameDelay",w.AUDIO_LOG_LEVEL,w.AUDIO_LOG_LEVEL_COUNT,w.AUDIO_LOUDNESS_LEVEL,w.AUDIO_DEV_REC_STALLS,w.AUDIO_DEV_STALL_DURATION,w.AUDIO_DEV_TOTAL_STALLS,w.AV_SYNC_COUNT,w.AV_SYNC_OOB,w.PACKETS_LOST_CORRECTED,w.SIMULCAST_LAYER_CHANGES,w.VIDEO_CAPTURE_FRAME_COUNT,w.VIDEO_FREEZE_COUNT,w.VIDEO_FREEZE_DURATION,w.VIDEO_PAUSE_COUNT,w.VIDEO_PAUSE_DURATION,w.VIDEO_SUM_CAPTURE_PIXEL,w.VIDEO_SUM_PIXEL,w.VIDEO_CONVERTED_QP_SUM,w.VIDEO_DECODED_BYTES,w.VIDEO_DECODE_TIME,w.VIDEO_CAPTURE_STALL_DURATION,w.VIDEO_CAPTURE_TOTAL_STALLS,w.VIDEO_ENCODE_STALL_DURATION,w.VIDEO_ENCODE_TOTAL_STALLS,w.VIDEO_SENT_STALL_DURATION,w.VIDEO_SENT_TOTAL_STALLS],z=["audioLevel","availableOutgoingBitrate","frameHeight","frameWidth","framesPerSecond","googAccelerateRate","googActualEncBitrate","googCurrentDelayMs","googExpandRate","googJitterReceived","googPreemptiveExpandRate","googPreferredJitterBufferMs","googRtt","googSecondaryDiscardedRate","googSpeechExpandRate","height","jitter","roundTripTime","width",w.AUDIO_DEV_IS_STALLED,w.RENDERED_VIEW,w.FRAME_RATE_MEAN,w.E2E_LATENCY,w.AV_SYNC,w.AV_SYNC_ABS,w.VIDEO_QP,w.VIDEO_CAPTURE_IS_STALLED,w.VIDEO_ENCODE_IS_STALLED,w.VIDEO_SENT_IS_STALLED],A=["availableOutgoingBitrate","bytesReceived","bytesSent","estimatedPlayoutTimestamp","fecPacketsDiscarded","fecPacketsReceived","firCount","frameHeight","framesDecoded","framesEncoded","framesPerSecond","framesReceived","framesSent","frameWidth","googAccelerateRate","googActualEncBitrate","googCurrentDelayMs","googDecodingCNG","googDecodingCTN","googDecodingNormal","googDecodingPLC","googDecodingPLCCNG","googExpandRate","googJitterReceived","googPreemptiveExpandRate","googRtt","googSecondaryDiscardedRate","googSpeechExpandRate","height","insertedSamplesForDeceleration","jitter","jitterBufferDelay","jitterBufferEmittedCount","nackCount","keyFramesDecoded","packetsLost","packetsReceived","packetsSent","pliCount","qpSum","removedSamplesForAcceleration","roundTripTime","totalAudioEnergy","totalDecodeTime","totalEncodeTime","totalInterFrameDelay","totalPacketSendDelay","totalSamplesDuration","totalSamplesReceived","totalSquaredInterFrameDelay","width",w.AUDIO_DEV_REC_STALLS,w.AUDIO_DEV_STALL_DURATION,w.AUDIO_DEV_TOTAL_STALLS,w.VIDEO_CAPTURE_STALL_DURATION,w.VIDEO_CAPTURE_TOTAL_STALLS,w.VIDEO_ENCODE_STALL_DURATION,w.VIDEO_ENCODE_TOTAL_STALLS,w.VIDEO_SENT_STALL_DURATION,w.VIDEO_SENT_TOTAL_STALLS,w.PACKETS_LOST_CORRECTED,w.VIDEO_CAPTURE_FRAME_COUNT,w.VIDEO_FREEZE_COUNT,w.VIDEO_FREEZE_DURATION,w.VIDEO_PAUSE_COUNT,w.VIDEO_PAUSE_DURATION,w.VIDEO_SUM_CAPTURE_PIXEL,w.VIDEO_SUM_PIXEL,w.VIDEO_CONVERTED_QP_SUM,w.VIDEO_DECODED_BYTES,w.VIDEO_DECODE_TIME,w.SIMULCAST_LAYER_CHANGES,w.AUDIO_DEV_IS_STALLED,w.VIDEO_CAPTURE_IS_STALLED,w.VIDEO_ENCODE_IS_STALLED,w.VIDEO_SENT_IS_STALLED,w.FRAME_RATE_MEAN,w.E2E_LATENCY,w.AV_SYNC,w.AV_SYNC_ABS],B=["audioLevel","availableOutgoingBitrate","bytesReceived","bytesSent","estimatedPlayoutTimestamp","fecPacketsDiscarded","fecPacketsReceived","firCount","frameHeight","framerateMean","framesDecoded","framesEncoded","framesPerSecond","framesReceived","framesSent","frameWidth","googAccelerateRate","googCurrentDelayMs","googDecodingCNG","googDecodingCTN","googDecodingNormal","googDecodingPLC","googDecodingPLCCNG","googExpandRate","googJitterReceived","googPreemptiveExpandRate","googPreferredJitterBufferMs","googRtt","height","jitter","jitterBufferDelay","jitterBufferEmittedCount","keyFramesEncoded","packetsLost","packetsReceived","packetsSent","pliCount","qpSum","roundTripTime","totalAudioEnergy","totalDecodeTime","totalEncodeTime","width",w.E2E_LATENCY,w.VIDEO_QP,w.VIDEO_CAPTURE_IS_STALLED,w.VIDEO_ENCODE_IS_STALLED,w.VIDEO_SENT_IS_STALLED],C=["consentRequestsSent","estimatedPlayoutTimestamp","estimatedPlayoutTimestamp_delta","fecPacketsDiscarded","fecPacketsReceived","firCount","googDecodingCNG","googDecodingCTN","googDecodingNormal","googDecodingPLC","googDecodingPLCCNG","jitterBufferDelay_delta","jitterBufferDelay","jitterBufferEmittedCount","keyFramesEncoded","packetsLost","packetsReceived","packetsSent","pliCount","qpSum_delta","requestsReceived","requestsSent","responsesReceived","responsesSent","totalAudioEnergy"],D={audioLevel:1e4,jitter:1e3,totalAudioEnergy:1e4,totalDecodeTime:1e3,totalEncodeTime:1e3,totalSamplesDuration:1e3},E=["availableOutgoingBitrate","consentRequestsSent","requestsReceived","requestsSent","responsesReceived","responsesSent"],F=["audioLevel","packetsLost","totalAudioEnergy","totalSamplesDuration"],G=[5,50,95],H=["bandwidth","rtt"];function a(){return c("UserAgent").isBrowser("Chrome < 86")||c("UserAgent").isBrowser("Edge (Chromium Based) < 86")||c("UserAgent").isBrowser("Opera < 72")}function b(){return f.exports.isPreChromium86()?d("ZenonMediaStatsSourcePreM86").TRACK_STATS:d("ZenonMediaStatsSource").TRACK_STATS}function e(){return f.exports.isPreChromium86()?d("ZenonMediaStatsSourcePreM86").INBOUND_RTP_STATS:d("ZenonMediaStatsSource").INBOUND_RTP_STATS}function I(){return f.exports.isPreChromium86()?d("ZenonMediaStatsSourcePreM86").OUTBOUND_RTP_STATS:d("ZenonMediaStatsSource").OUTBOUND_RTP_STATS}function J(){return f.exports.isPreChromium86()?d("ZenonMediaStatsSourcePreM86").RTP_STATS:d("ZenonMediaStatsSource").RTP_STATS}function K(){return d("ZenonMediaStatsSource").CANDIDATE_PAIR_STATS}function L(){return d("ZenonMediaStatsSource").MEDIA_SOURCE_STATS}function M(){return d("ZenonMediaStatsSource").SSRC_STATS}function N(){return d("ZenonMediaStatsSource").VIDEO_BWE_STATS}function O(){return d("ZenonMediaStatsSource").GOOG_CANDIDATE_PAIR_STATS}g.GLOBAL_STATS_TRACK_INFO=h;g.GLOBAL_STATS_TRACKID=i;g.GLOBAL_STATS_CONTENT_TYPE=j;g.GLOBAL_STATS_RENDERED_VIEW=c("ZenonRenderedView").GRID;g.PINNED_AUDIO_STATS_TRACK_INFO=k;g.PINNED_VIDEO_STATS_TRACK_INFO=l;g.OUTBOUND_AUDIO_STATS_TRACK_INFO=m;g.OUTBOUND_AUDIO_STATS_TRACKID=n;g.OUTBOUND_SCREEN_AUDIO_STATS_TRACK_INFO=o;g.OUTBOUND_SCREEN_AUDIO_STATS_TRACKID=p;g.OUTBOUND_SCREEN_STATS_TRACK_INFO=q;g.OUTBOUND_SCREEN_STATS_TRACKID=r;g.OUTBOUND_VIDEO_STATS_TRACK_INFO=s;g.OUTBOUND_VIDEO_STATS_TRACKID=t;g.VOICE_ENERGY_THRESHOLD=u;g.AV_SYNC_CUTOFF=v;g.DERIVED_METRICS=w;g.PER_STREAM_AGG_METRICS=x;g.CUMULATIVE_STATS=y;g.DELTA_STATS=z;g.STATS_REQUESTED=A;g.TSLOG_STATS_REQUESTED=B;g.TSLOG_STATS_TO_SUPPRESS=C;g.TSLOG_METRIC_SCALE=D;g.TSLOG_STATS_REQUESTED_FROM_CANDIDATE_PAIR=E;g.RULE_VIOLATION_ALLOWLIST=F;g.PERCENTILES_REQUESTED=G;g.NETWORK_HEALTH_STATS=H;g.isPreChromium86=a;g.getTrackStats=b;g.getInboundRtpStats=e;g.getOutboundRtpStats=I;g.getRtpStats=J;g.getCandidatePairStats=K;g.getMediaSourceStats=L;g.getSsrcStats=M;g.getVideoBweStats=N;g.getGoogCandidatePairStats=O}),98);
__d("ZenonNetworkQualityMonitor",["$InternalEnum","UserAgent","ZenonInfraActionsLogger","ZenonMediaStatsConfig","ZenonNetworkQualityIndicatorConfigSitevarConfig","immutable"],(function(a,b,c,d,e,f,g){"use strict";var h=2,i="googActualEncBitrate";a=function(){function a(){var a;this.$3=0;this.$4=0;this.$5=[];this.$6=j.Good;this.$7=c("immutable").Map();this.$1=this.$13();this.$2=this.$14();this.$8=(a=c("ZenonNetworkQualityIndicatorConfigSitevarConfig").remote_poor_packet_loss_rate_threshold)!=null?a:Number.POSITIVE_INFINITY;this.$9=(a=c("ZenonNetworkQualityIndicatorConfigSitevarConfig").remote_fair_packet_loss_rate_threshold)!=null?a:Number.POSITIVE_INFINITY;this.$10=(a=c("ZenonNetworkQualityIndicatorConfigSitevarConfig").remote_jitter_threshold)!=null?a:Number.POSITIVE_INFINITY;this.$11=(a=c("ZenonNetworkQualityIndicatorConfigSitevarConfig").remote_avsync_threshold)!=null?a:Number.POSITIVE_INFINITY;this.$12=c("ZenonNetworkQualityIndicatorConfigSitevarConfig").remote_use_disconnected_check||!1;c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"ZenonNetworkQualityMonitor constructed: rtt "+this.$1+", packetLoss "+this.$2})}var b=a.prototype;b.$14=function(){var a;return(a=c("ZenonNetworkQualityIndicatorConfigSitevarConfig").packet_loss_rate_threshold)!=null?a:Number.POSITIVE_INFINITY};b.$13=function(){var a;return(a=c("ZenonNetworkQualityIndicatorConfigSitevarConfig").rtt_threshold)!=null?a:Number.POSITIVE_INFINITY};b.$15=function(a,b){if(a!=null){a=a.deltaStat[b];if(a!=null){return((b=a.getLastAddedValue())!=null?b:0)>this.$1}}return!1};b.$16=function(a,b,c){a=a<0?0:a/(a+b);return a>=c};b.$17=function(a){if(a!=null){a=a.deltaStat[i];if(a!=null){this.$4=(a=a.getLastAddedValue())!=null?a:0}}};b.$18=function(a,b,c,d){if(a!=null&&c!=="packetsSent"){b=a.cumulativeStat[b];a=a.cumulativeStat[c];if(b!=null&&a!=null)return this.$16(b.getDeltaFromLastUpdate(),a.getDeltaFromLastUpdate(),d)}return!1};b.$19=function(a,b){var c=this,d=b.packetLostKey,e=b.packetsKey,f=b.rttKey;b=Array.from(a.values()).some(function(a){var b=c.$18(a,d,e,c.$2);c.$17(a);return b||c.$15(a,f)});return b};b.getMetricKeys=function(a){return{packetLostKey:d("ZenonMediaStatsConfig").DERIVED_METRICS.PACKETS_LOST_CORRECTED,packetsKey:a?"packetsSent":"packetsReceived",rttKey:c("UserAgent").isBrowser("Chrome")||c("UserAgent").isBrowser("Opera")?"googRtt":"roundTripTime"}};b.getCount=function(){return this.$3};b.getCurrentBitrate=function(){return this.$4};b.getAvgBitrateDuringBadNetwork=function(){var a=this.$5.reduce(function(a,b){return a+b},0),b=this.$5.length;return b===0?0:a/b};b.$20=function(a,b){if(b){this.$6=j.Poor;this.$5.push(this.$4);return this.$6}if(a!=null){b=this.$3;var d=this.$19(a,this.getMetricKeys(!0));a=this.$19(a,this.getMetricKeys(!1));d||a?this.$3<h&&this.$3++:this.$3>0&&this.$3--;this.$3>=h?(this.$6=j.Poor,this.$5.push(this.$4)):this.$3<=0?(b!==this.$3&&this.$3===0&&this.$6!==j.Good&&c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[Network] Bad network window with avg bitrate: "+this.getAvgBitrateDuringBadNetwork()}),this.$5=[],this.$6=j.Good):this.$3>=1&&this.$6===j.Poor&&this.$5.push(this.$4)}return this.$6};b.$21=function(a,b){var d=this;if(a==null){this.$7=c("immutable").Map();return this.$7}var e=this.$7;this.$7=c("immutable").Map().withMutations(function(c){a.forEach(function(a,f){if(a.remote===!1)return;var g=e.get(f)==null;a=[d.$22(a),d.$23(b),d.$24(a),d.$25(a,g),d.$26(a,g)];var h=j.Excellent,i=[];a.forEach(function(a){a.quality<h&&(h=a.quality);a=a.reason;a!=null&&i.push(a)});c.set(f,{quality:h,reasons:i})})});return this.$7};b.$26=function(a,b){if(!this.$12||a.contentType!=="video"||a.isMuted===!0||b)return{quality:j.Excellent};a=(b=a.cumulativeStat.packetsReceived)==null?void 0:b.getDeltaFromLastUpdate();return a===0?{quality:j.Disconnected,reason:k.ZERO_PACKETS_RECEIVED}:{quality:j.Excellent}};b.$23=function(a){return a?{quality:j.Disconnected,reason:k.ICE_DISCONNECTED}:{quality:j.Excellent}};b.$24=function(a){var b;b=(b=a.cumulativeStat.jitter)==null?void 0:b.getDeltaFromLastUpdate();return a.contentType==="audio"&&b!=null&&b>this.$10?{quality:j.Fair,reason:k.JITTER}:{quality:j.Excellent}};b.$25=function(a,b){if(b)return{quality:j.Excellent};b=(b=a.cumulativeStat.packetsReceived)==null?void 0:b.getDeltaFromLastUpdate();a=(a=a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.PACKETS_LOST_CORRECTED])==null?void 0:a.getDeltaFromLastUpdate();if(b==null||a==null)return{quality:j.Excellent};if(this.$16(a,b,this.$8))return{quality:j.Poor,reason:k.PACKET_LOSS};else if(this.$16(a,b,this.$9))return{quality:j.Fair,reason:k.PACKET_LOSS};return{quality:j.Excellent}};b.$22=function(a){a=(a=a.deltaStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC])==null?void 0:a.getLastAddedValue();return a!=null&&a>this.$11?{quality:j.Fair,reason:k.AV_SYNC}:{quality:j.Excellent}};b.determineNetworkStatus=function(a,b){var d=this.$20(a,b);d===j.Poor&&c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[Network] Showing poor network indicator with current bitrate: "+this.getCurrentBitrate()});return{local:d,remote:this.$21(a,b)}};return a}();var j=b("$InternalEnum")({Excellent:4,Good:3,Fair:2,Poor:1,Disconnected:0}),k=b("$InternalEnum").Mirrored(["PACKET_LOSS","ZERO_PACKETS_RECEIVED","END_TO_END_LANTENCY","AV_SYNC","JITTER","ICE_DISCONNECTED"]);g.ZenonNetworkQualityMonitor=a;g.ZenonNetworkQuality=j;g.ZenonNetworkQualityReason=k}),98);
__d("ZenonScreenSharingAvailabilityType",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["AudioCallUnsupported","Available","GroupCallUnsupported","RemoteUnsupported","Unknown"]);c=a;f["default"]=c}),66);
__d("ZenonCallFeatures",["ZenonNetworkQualityMonitor","ZenonScreenSharingAvailabilityType","immutable"],(function(a,b,c,d,e,f){"use strict";a=b("ZenonNetworkQualityMonitor").ZenonNetworkQuality;c=b("immutable").Record({canAddParticipants:!1,canReplaceLocalStreams:!1,cowatchEnabled:!1,cowatchGroupEnabled:!1,dominantSpeaker:null,multiwayVideoEscalation:!1,networkStatus:{local:a.Good,remote:b("immutable").Map()},screenSharingAvailability:b("ZenonScreenSharingAvailabilityType").Available,supportMultipleStreams:!1});d=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c);e.exports=d}),null);
__d("ZenonCall",["ZenonCallFeatures","ZenonCallsModelTypes","immutable"],(function(a,b,c,d,e,f){"use strict";a=b("ZenonCallsModelTypes").ZenonCallState;d=(c=b("immutable")).Record({callState:a.New,clientCallId:"",collisionContext:{groupThreadID:null,peerID:null,serverInfoData:null},endCallReason:null,features:new(b("ZenonCallFeatures"))(),groupEscalationStatus:null,mediaTracks:c.Map(),participants:c.Map(),remoteScreenSharingUserIDs:c.OrderedSet(),responseSubCode:null,rtpReceivers_I_KNOW_WHAT_I_AM_DOING:c.Set(),rtpSenders_I_KNOW_WHAT_I_AM_DOING:c.Set(),stateSyncInputStates:c.Map(),stateSyncOutputStates:c.Map(),videoEscalationStatus:null});f=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(d);e.exports=f}),null);
__d("ZenonCallParticipant",["ZenonCallsModelTypes","immutable"],(function(a,b,c,d,e,f){"use strict";a=b("ZenonCallsModelTypes").ZenonCallParticipantState;c=b("immutable").Record({id:void 0,isExistingParticipant:void 0,isVideoSubscribed:!1,participantType:void 0,state:a.Disconnected,trackIDs:void 0,userCapabilities:void 0});d=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c);e.exports=d}),null);
__d("ChatReliabilityTypedLogger",["Banzai","GeneratedLoggerUtils"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1={}}var c=a.prototype;c.log=function(a){b("GeneratedLoggerUtils").log("logger:ChatReliabilityLoggerConfig",this.$1,b("Banzai").BASIC,a)};c.logVital=function(a){b("GeneratedLoggerUtils").log("logger:ChatReliabilityLoggerConfig",this.$1,b("Banzai").VITAL,a)};c.logImmediately=function(a){b("GeneratedLoggerUtils").log("logger:ChatReliabilityLoggerConfig",this.$1,{signal:!0},a)};c.clear=function(){this.$1={};return this};c.getData=function(){return babelHelpers["extends"]({},this.$1)};c.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.setEvent=function(a){this.$1.event=a;return this};c.setEventData=function(a){this.$1.event_data=a;return this};return a}();c={event:!0,event_data:!0};f["default"]=a}),66);
__d("MercurySyncHolesTypedLogger",["Banzai","GeneratedLoggerUtils"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1={}}var c=a.prototype;c.log=function(a){b("GeneratedLoggerUtils").log("logger:MercurySyncHolesLoggerConfig",this.$1,b("Banzai").BASIC,a)};c.logVital=function(a){b("GeneratedLoggerUtils").log("logger:MercurySyncHolesLoggerConfig",this.$1,b("Banzai").VITAL,a)};c.logImmediately=function(a){b("GeneratedLoggerUtils").log("logger:MercurySyncHolesLoggerConfig",this.$1,{signal:!0},a)};c.clear=function(){this.$1={};return this};c.getData=function(){return babelHelpers["extends"]({},this.$1)};c.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.setDifference=function(a){this.$1.difference=a;return this};c.setSeqID=function(a){this.$1.seq_id=a;return this};c.setTopicType=function(a){this.$1.topic_type=a;return this};return a}();c={difference:!0,seq_id:!0,topic_type:!0};f["default"]=a}),66);
__d("MessengerWebGraphQLTypedLogger",["Banzai","GeneratedLoggerUtils"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1={}}var c=a.prototype;c.log=function(a){b("GeneratedLoggerUtils").log("logger:MessengerWebGraphQLLoggerConfig",this.$1,b("Banzai").BASIC,a)};c.logVital=function(a){b("GeneratedLoggerUtils").log("logger:MessengerWebGraphQLLoggerConfig",this.$1,b("Banzai").VITAL,a)};c.logImmediately=function(a){b("GeneratedLoggerUtils").log("logger:MessengerWebGraphQLLoggerConfig",this.$1,{signal:!0},a)};c.clear=function(){this.$1={};return this};c.getData=function(){return babelHelpers["extends"]({},this.$1)};c.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.setErrorMessage=function(a){this.$1.error_message=a;return this};c.setEvent=function(a){this.$1.event=a;return this};c.setQueryParams=function(a){this.$1.query_params=a;return this};return a}();c={error_message:!0,event:!0,query_params:!0};f["default"]=a}),66);
__d("ZenonMWSendMessageMutation.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],b=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"RtcWebSendMultiwaySignalingMessageResponsePayload",kind:"LinkedField",name:"rtc_web_send_multiway_signaling_message",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"header",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"body",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"ZenonMWSendMessageMutation",selections:b,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"ZenonMWSendMessageMutation",selections:b},params:{id:"3833284223373600",metadata:{},name:"ZenonMWSendMessageMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("ZenonP2PSendMessageMutation.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],b=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],kind:"ScalarField",name:"rtc_web_send_p2p_signaling_message",storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"ZenonP2PSendMessageMutation",selections:b,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"ZenonP2PSendMessageMutation",selections:b},params:{id:"3730720003707432",metadata:{},name:"ZenonP2PSendMessageMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("FluxDebugUtils",["areEqual","flattenArray","getByPath"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return c("areEqual")(a,b.slice(0,a.length))}function i(a){return Object.prototype.toString.call(a)==="[object Object]"}function j(a){return Object.keys(a).sort()}function k(a,b){return j(a).filter(function(a){return!(a in b)})}function l(a,b){return j(b).filter(function(b){return!(b in a)})}function m(a,b){return j(a).filter(function(a){return a in b})}function n(a,b){if(!i(a)||!i(b))return[];var d=l(a,b).map(function(a){var c;return{path:[],op:"add",value:(c={},c[a]=b[a],c)}}),e=k(a,b).map(function(a){return{path:[a],op:"delete"}}),f=[].concat(c("flattenArray")(m(a,b).map(function(d){if(c("areEqual")(a[d],b[d]))return[];return!i(a[d])||!i(b[d])?{path:[d],op:"update",oldValue:a[d],newValue:b[d]}:n(a[d],b[d]).map(function(a){return babelHelpers["extends"]({},a,{path:[d].concat(a.path)})})})));return[].concat(d,e,f)}function o(a){return a.prevState&&a.prevState.toJS?n(a.prevState.toJS(),a.currState.toJS()):n(a.prevState,a.currState)}function a(a){return o(a.mutation)}function b(a,b){if(c("areEqual")(a.path,b))return!0;if(h(a.path,b)){b=b.slice(a.path.length);a=a.value||a.newValue;return!!c("getByPath")(a,b)}return!1}function d(a){return a.store&&a.stateGetter?a.stateGetter():a.getState()}function e(a){return a.store||a}function p(a,b,c){b.forEach(function(d){return a[d.name]=function(){for(var a=arguments.length,e=new Array(a),f=0;f<a;f++)e[f]=arguments[f];var g=d.run.apply(d,[c()].concat(e));p(g,b,function(){return g});return g}})}g.diff=n;g.diffStoreMutation=o;g.diffStoreMutationInstance=a;g.isOperationTouchingPath=b;g.getStoreStateFromStoreConfig=d;g.getStoreInstanceFromStoreConfig=e;g.applyPlugins=p}),98);
__d("AjaxError",[],(function(a,b,c,d,e,f){a="ar:error";b="ar:timeout";c="ar:proxy error";d="ar:transport error";e="ar:http error";var g="ar:parse error",h="ar:noservice";f.ERROR=a;f.TIMEOUT=b;f.PROXY_ERROR=c;f.TRANSPORT_ERROR=d;f.SERVER_ERROR=e;f.PARSE_ERROR=g;f.SERVICE_UNAVAILABLE=h}),66);
__d("AjaxRequest",["AjaxError","ErrorUtils","Keys","PHPQuerySerializer","TimeSlice","URI","UserAgent_DEPRECATED","ZeroRewrites","clearTimeout","killswitch","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){var h=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest(),i=[];function a(){var a=i;i=[];a.forEach(function(a){return a.abort()})}function j(a){a.onJSON=a.onError=a.onSuccess=null,c("clearTimeout")(a._timer),a.xhr&&a.xhr.readyState<4&&(a.xhr.abort(),a.xhr=null),i=i.filter(function(b){return b&&b!=a&&b.xhr&&b.xhr.readyState<4})}b=function(){function a(a,b,e){this.timeout=6e4,this.streamMode=!0,this.prelude=/^for \(;;\);/,this.status=null,this.$1=-1,this.$2=null,this.$3=0,this.$4=null,this.json=null,this.errorType=null,this.errorText=null,this.onJSON=null,this.onSuccess=null,this.onError=null,b instanceof c("URI")||(b=new(c("URI"))(b)),this.xhr=d("ZeroRewrites").getTransportBuilderForURI(b)(),e&&a=="GET"&&b.setQueryData(e),this.method=a,this.uri=b,this.xhr.open(a,c("killswitch")("ASYNC_REQUEST_STRINGIFY_URI_BEFORE_PASSING_TO_OPEN_METHOD")?b:b.toString())}a.supportsCORS=function(){return h};var b=a.prototype;b.send=function(a){var b=this,e=c("TimeSlice").getReusableContinuation("AjaxRequest xhr.onreadystatechange");this.xhr.onreadystatechange=function(){return b.$5(e)};var f=this.timeout;f&&(this.$2=c("setTimeoutAcrossTransitions")(function(){b.errorType=d("AjaxError").TIMEOUT,b.errorText="timeout",b.$4=Date.now()-b.$3,b.onError&&b.onError(b),j(b)},f));i.push(this);this.method=="POST"&&this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");this.$3=Date.now();this.xhr.send(a?d("PHPQuerySerializer").serialize(a):"")};b.abort=function(){j(this)};b.toString=function(){var a="[AjaxRequest readyState="+this.xhr.readyState;this.errorType&&(a+=" errorType="+this.errorType,this.errorText&&(a+=" ("+this.errorText+")"));return a+"]"};b.toJSON=function(){var a={};this.json&&(a.json=this.json);this.status&&(a.status=this.status);this.errorType&&(a.errorType=this.errorType,a.uri=this.uri);this.errorText&&(a.errorText=this.errorText);this.$4&&(a.time=this.$4);return a};b.onJSONSafe=function(){this.onJSON&&this.onJSON(this)};b.onSuccessSafe=function(){this.onSuccess&&this.onSuccess(this)};b.onErrorSafe=function(){this.onError&&this.onError(this)};b.$6=function(){var a;try{this.status=this.xhr.status,a=this.xhr.statusText}catch(a){this.xhr.readyState>=4&&(this.errorType=d("AjaxError").TRANSPORT_ERROR,this.errorText=a.message);return}var b=this.status;if(b==null){this.errorType=d("AjaxError").ERROR;this.errorText="null status code";return}if(b===0&&!/^(file|ftp)/.test(this.uri.toString()))this.errorType=d("AjaxError").TRANSPORT_ERROR;else if(b>=100&&b<200)this.errorType=d("AjaxError").PROXY_ERROR;else if(b>=200&&b<300)return;else if(b>=300&&b<400)this.errorType=d("AjaxError").PROXY_ERROR;else if(b>=400&&b<500)this.errorType=d("AjaxError").SERVER_ERROR;else if(b===503)this.errorType=d("AjaxError").SERVICE_UNAVAILABLE;else if(b>500&&b<600)this.errorType=d("AjaxError").PROXY_ERROR;else if(b==1223)return;else b>=12001&&b<=12156?this.errorType=d("AjaxError").TRANSPORT_ERROR:(a="unrecognized status code: "+b,this.errorType=d("AjaxError").ERROR);this.errorText||(this.errorText=a)};b.$7=function(){var a,b=this.xhr.readyState;try{a=this.xhr.responseText||""}catch(a){b>=4&&(this.errorType=d("AjaxError").ERROR,this.errorText="responseText not available - "+a.message);return}while(this.xhr){var e=this.$1+1,f=this.streamMode?a.indexOf("\n",e):a.length;f<0&&b==4&&(f=a.length);if(f<=this.$1)break;var g=a;this.streamMode&&(g=a.substr(e,f-e).replace(/^\s*|\s*$/g,""));if(e===0&&this.prelude){var h=this.prelude;h.test(g)&&(g=g.replace(h,""))}this.$1=f;if(g){try{this.json=JSON.parse(g)}catch(b){h=a.match(/(<body[\S\s]+?<\/body>)/i);f=h!=null&&h.length>0?h[0]:null;h={message:b.message,"char":e,excerpt:(e===0&&f||g).substr(512)};this.errorType=d("AjaxError").PARSE_ERROR;this.errorText="parse error - "+JSON.stringify(h);return}c("ErrorUtils").applyWithGuard(this.onJSONSafe,this)}}};b.$5=function(a){var b=this,c=this.xhr&&this.xhr.readyState||0;this.status==null&&c>=2&&this.$6();!this.errorType&&this.status!=null&&((c===3&&this.streamMode||c===4)&&a(function(){return b.$7()}));(this.errorType||c===4)&&(this.$4=Date.now()-this.$3,a.last(function(){b.errorType?b.onErrorSafe():b.onSuccessSafe(),j(b)}))};return a}();window.addEventListener&&d("UserAgent_DEPRECATED").firefox()&&window.addEventListener("keydown",function(a){a.keyCode===c("Keys").ESC&&a.prevent()},!1);window.attachEvent&&window.attachEvent("onunload",a);g["default"]=b}),98);
__d("ChannelSubdomain",["Event","LogHistory","Run","WebStorage","clearTimeout","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){var h=d("LogHistory").getInstance("channel"),i="channel_sub:",j=7,k=100*1e3,l=null,m=null;function n(){var a=c("WebStorage").getLocalStorage();m&&(c("clearTimeout")(m),m=null);a&&l!=null&&a.removeItem(i+l);l=null}function a(a,b,e){e===void 0&&(e=!1);a=(a-1)*j;e&&(m&&c("clearTimeout")(m),l=m=null);b==null&&(b=Math.floor(Math.random()*a));if(l==null){var f=c("WebStorage").getLocalStorage();if(f){e=[];for(var g=0;g<f.length;g++){var o=f.key(g);if(o!=null&&o.indexOf(i)===0){var p=parseInt(o.substr(i.length),10);e[p]=parseInt(f.getItem(o),10)}}p=Date.now()-k;for(var o=0;o<a;o++){g=(o+b)%a;if(!e[g]||e[g]<p){l=g;break}}if(l!=null){g=function a(){if(l==null)return;try{f.setItem(i+l,Date.now().toString())}catch(a){h.warn("subdomain set failed",a.message)}m=c("setTimeoutAcrossTransitions")(a,k/2)};g()}else h.warn("no channel subdomain",e);typeof window.onpageshow!=="undefined"?c("Event").listen(window,"pagehide",n):d("Run").onUnload(n)}else l=b}return l==null?null:l%j}g.clear=n;g.allocate=a}),98);
__d("ChatproxyClientErrorsTypedLogger",["Banzai","GeneratedLoggerUtils"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1={}}var c=a.prototype;c.log=function(a){b("GeneratedLoggerUtils").log("logger:ChatproxyClientErrorsLoggerConfig",this.$1,b("Banzai").BASIC,a)};c.logVital=function(a){b("GeneratedLoggerUtils").log("logger:ChatproxyClientErrorsLoggerConfig",this.$1,b("Banzai").VITAL,a)};c.logImmediately=function(a){b("GeneratedLoggerUtils").log("logger:ChatproxyClientErrorsLoggerConfig",this.$1,{signal:!0},a)};c.clear=function(){this.$1={};return this};c.getData=function(){return babelHelpers["extends"]({},this.$1)};c.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.setAppVersion=function(a){this.$1.app_version=a;return this};c.setBatchSize=function(a){this.$1.batch_size=a;return this};c.setErrorMessage=function(a){this.$1.error_message=a;return this};c.setErrorReason=function(a){this.$1.error_reason=a;return this};c.setErrorText=function(a){this.$1.error_text=a;return this};c.setJsEventTimeMs=function(a){this.$1.js_event_time_ms=a;return this};c.setMultiViewSubscription=function(a){this.$1.multi_view_subscription=a;return this};c.setRequestID=function(a){this.$1.request_id=a;return this};c.setResponseHeaders=function(a){this.$1.response_headers=a;return this};c.setSessionID=function(a){this.$1.session_id=a;return this};c.setSessionIDStr=function(a){this.$1.session_id_str=a;return this};c.setStatusCode=function(a){this.$1.status_code=a;return this};c.setSubscriberID=function(a){this.$1.subscriber_id=a;return this};c.setTopicPrefixes=function(a){this.$1.topic_prefixes=b("GeneratedLoggerUtils").serializeVector(a);return this};c.setURL=function(a){this.$1.url=a;return this};c.setXhrReadyState=function(a){this.$1.xhr_ready_state=a;return this};c.setXhrStatus=function(a){this.$1.xhr_status=a;return this};return a}();c={app_version:!0,batch_size:!0,error_message:!0,error_reason:!0,error_text:!0,js_event_time_ms:!0,multi_view_subscription:!0,request_id:!0,response_headers:!0,session_id:!0,session_id_str:!0,status_code:!0,subscriber_id:!0,topic_prefixes:!0,url:!0,xhr_ready_state:!0,xhr_status:!0};f["default"]=a}),66);
__d("DocRPC",["ErrorUtils","FBLogger"],(function(a,b,c,d,e,f){var g,h={_apis:{},_dispatch:function(a){var c;try{a=JSON.parse(a)}catch(b){throw new Error('DocRPC unparsable dispatch: "'+a+'"')}if(Object.prototype.hasOwnProperty.call(h._apis,a.api)){var d=h._apis[a.api];d[a.method]&&(c=(g||(g=b("ErrorUtils"))).applyWithGuard(d[a.method],d,a.args))}c===void 0&&(c=null);return JSON.stringify(c)},publish:function(a,b){h._apis[b]=a},proxy:function(a,c,d){var e={};d.forEach(function(d){e[d]=function(){var e={api:c,method:d,args:Array.prototype.slice.call(arguments)},f;try{if(a.closed)throw new Error("DocRPC window closed");f=a.DocRPC._dispatch(JSON.stringify(e))}catch(a){b("FBLogger")("doc_rpc").catching(a).warn("Encountered an error duing proxy call");return}if(typeof f==="string")try{f=JSON.parse(f)}catch(a){b("FBLogger")("doc_rpc").catching(a).mustfix("DocRPC %s.%s unparsable return: %s",c,d,f);throw new Error("DocRPC "+c+"."+d+' unparsable return: "'+f+'"')}return f}});return e}};e.exports=a.DocRPC=h}),null);
__d("ChannelTransport",["AjaxRequest","ChannelConstants","ChatproxyClientErrorsTypedLogger","DocRPC","LogHistory","ODS","TimeSlice","URI","bind","clearTimeout","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){var g,h="BROWSER_REFUSED_TO_GET_FAILURE_REASON_HEADER",i=b("LogHistory").getInstance("channel");function j(a){var c=new(b("ChatproxyClientErrorsTypedLogger"))();c.setStatusCode(a.status);if(a.xhr!=null){var d;try{d=a.xhr.getResponseHeader("x-fb-chat-failure-reason")}catch(a){d=h}d&&c.setErrorReason(d)}c.setErrorMessage(a.errorType);a.uri!==void 0&&c.setURL(a.uri.getPath());c.log()}function k(){return(1048576*Math.random()|0).toString(36)}function l(a){return a!==null&&a!==void 0&&!isNaN(a)&&isFinite(a)&&0<=a&&a<=6}function m(a,c){var d="";l(a.subdomain)&&(d=a.subdomain+"-");var e=a.host;e=e===null||e===void 0?"edge-chat":a.host;c=new(g||(g=b("URI")))(c).setDomain(d+e+"."+a.domain).setPort(a.port).setSecure(new g(window.location.href).isSecure());return c}function n(a){var c={partition:a.partition,cb:k(),failure:a.pingFailuresOnSubdomain};a.sticky_token&&(c.sticky_token=a.sticky_token);a.sticky_pool&&(c.sticky_pool=a.sticky_pool);c=m(a,"/p").setQueryData(c);i.log("start_p",{uri:c.toString()});var d=new(b("AjaxRequest"))("GET",c);b("AjaxRequest").supportsCORS()&&(d.xhr.withCredentials=!0);var e=function(b){i.log("finish_p",{xhr:b.toJSON?b.toJSON():b,subdomain:a.subdomain,fullHost:a.fullHost})};d.onError=function(c){b("ODS").bumpEntityKey(2966,"ChannelTransport","sendP.error");j(d);e(c);if(a.subdomain===null)return;l(a.subdomain)&&(a.pingFailuresOnSubdomain++,a.subdomain++,a.subdomain>6&&(a.subdomain=0))};d.timeout=a.P_TIMEOUT;d.onSuccess=function(a){b("ODS").bumpEntityKey(2966,"ChannelTransport","sendP.success"),e(a)};d.send()}function o(a,c,d){var e=new Image(),f=0,g=function(a){e.abort();return a?c():d()};e.onload=b("TimeSlice").guard(function(){i.log("ping_ok",{duration:Date.now()-f}),b("ODS").bumpEntityKey(2966,"ChannelTransport","sendPing.success"),g(!0)},"ChannelTransport image.onload");e.onerror=b("TimeSlice").guard(function(){n(a),b("ODS").bumpEntityKey(2966,"ChannelTransport","sendPing.error"),j(e),g(!1)},"ChannelTransport image.onerror");var h=b("setTimeoutAcrossTransitions")(e.onerror,1e4);e.abort=function(){h&&(b("clearTimeout")(h),h=null),e.onload=e.onerror=null};var l={partition:a.partition,cb:k()};a.sticky_token&&(l.sticky_token=a.sticky_token);a.sticky_pool&&(l.sticky_pool=a.sticky_pool);a.lastRequestErrorReason&&(l.reason=a.lastRequestErrorReason,a.lastRequestErrorReason=null);a.uid&&a.viewerUid&&(l.uid=a.uid,l.viewer_uid=a.viewerUid);f=Date.now();e.src=m(a,"/ajax/chatproxy-ping").setQueryData(l);return e}function a(a){var c={channel:a.user_channel,partition:a.partition,clientid:a.sessionID,cb:k(),cap:0,uid:a.uid,viewer_uid:a.viewerUid};a.sticky_token&&(c.sticky_token=a.sticky_token);a.sticky_pool&&(c.sticky_pool=a.sticky_pool);a.is_offline||a.shouldSuppressPresence?c.state="offline":c.state="active";if(c.state===a.lastPresenceState)return;a.lastPresenceState=c.state;a.profile&&(c.profile=a.profile);a.capabilities&&(c.cap=a.capabilities);c=m(a,"/active_ping").setQueryData(c);var d=new(b("AjaxRequest"))("GET",c);b("AjaxRequest").supportsCORS()&&(d.xhr.withCredentials=!0);d.onError=function(a){b("ODS").bumpEntityKey(2966,"ChannelTransport","sendActivePing.error"),i.warn("active_ping_error"),j(d)};d.onSuccess=function(a){b("ODS").bumpEntityKey(2966,"ChannelTransport","sendActivePing.success"),i.log("active_ping_ok")};d.timeout=a.P_TIMEOUT;d.send()}function p(a,c,d,e){var f=new Date(),g=-1;a.userActive>0&&(g=(f-a.userActive)/1e3|0,g<0&&i.warn("idle_regression",{idleTime:g,now:f.getTime(),userActive:a.userActive}));f={channel:a.user_channel,seq:a.seq,partition:a.partition,clientid:a.sessionID,cb:k(),idle:g,qp:"y",cap:0};a.state.aiq&&(f.aiq=a.state.aiq);a.ready&&((a.seqTurSentAt==-1||a.seqTurSentAt==a.seq)&&(f.tur=a.timeUntilReady,f.qpmade=a.queueMade,a.seqTurSentAt=a.seq));f.pws=a.pws;a.sequenceId>0&&(f.isq=a.sequenceId);f.msgs_recv=a.estimatedReceived;a.uid&&a.viewerUid&&(f.uid=a.uid,f.viewer_uid=a.viewerUid);a.sticky_token?f.sticky_token=a.sticky_token:(f.request_batch=1,a.msgr_region&&(f.msgr_region=a.msgr_region));a.sticky_pool&&(f.sticky_pool=a.sticky_pool);"trace_id"in a&&(f.traceid=a.trace_id);a.is_offline||a.shouldSuppressPresence?f.state="offline":a.userActive>0&&g<60&&(f.state="active");a.lastPresenceState=f.state;a.streamingCapable&&(f.mode="stream",f.format="json");a.profile&&(f.profile=a.profile);a.capabilities&&(f.cap=a.capabilities);g=m(a,"/pull").setQueryData(f);f="GET";var h=new(b("AjaxRequest"))(f,g);b("AjaxRequest").supportsCORS()&&(h.xhr.withCredentials=!0);h.timeout=a.streamingCapable?a.STREAMING_TIMEOUT:a.LONGPOLL_TIMEOUT;h.onJSON=function(a){b("ODS").bumpEntityKey(2966,"ChannelTransport","sendPull.json"),c(a)};h.onSuccess=function(a){b("ODS").bumpEntityKey(2966,"ChannelTransport","sendPull.success"),d(a)};h.onError=function(){var c=this.status==12002&&this._time>=a.MIN_12002_TIMEOUT||this.status==504&&this._time>=a.MIN_504_TIMEOUT,f=c?d:e;c?b("ODS").bumpEntityKey(2966,"ChannelTransport","sendPull.success"):(b("ODS").bumpEntityKey(2966,"ChannelTransport","sendPull.error"),j(h));return f&&f.apply(this,arguments)};h.send();a.inStreaming=a.streamingCapable;return h}function q(a){this.manager=a,this.init&&this.init()}function c(a){q.apply(this,arguments)}Object.assign(c.prototype,{logName:"CORS",enterState:function(a,c){this._request&&(this._request.abort(),this._request=null);a=="init"&&b("setTimeoutAcrossTransitions")(b("bind")(this.manager,"exitState",{status:b("ChannelConstants").OK,stateId:c.stateId}),0);if(!/pull|ping/.test(a))return;var d=this.manager;a=="ping"?this._request=o(c,b("bind")(d,"exitState",{status:b("ChannelConstants").OK,stateId:c.stateId}),b("bind")(d,"exitState",{status:b("ChannelConstants").ERROR,stateId:c.stateId})):a=="pull"&&(this._request=p(c,b("bind")(d,"_processTransportData",c.stateId),b("bind")(d,"exitState",{status:b("ChannelConstants").OK,stateId:c.stateId}),b("bind")(d,"exitState",{status:b("ChannelConstants").ERROR,stateId:c.stateId})))}});function d(a){i.log("iframe_init_constructor"),q.apply(this,arguments),this._iframe=document.createElement("iframe"),this._iframe.style.display="none",document.body.appendChild(this._iframe),b("DocRPC").publish(this,"outerTransport")}Object.assign(d.prototype,{logName:"iframe",_initIframe:function(a){i.log("iframe_init_start");window.onchanneliframeready=function(){i.log("iframe_resources");return a.resources};window.onchanneliframeloaded=function(){i.log("iframe_loaded")};if(a){this._iframeURI=m(a,a.path);if(a.resources){var c=this._iframeURI.getDomain();a.resources=a.resources.map(function(a){var d=new(g||(g=b("URI")))(a);return d.getPath().startsWith("/intern/rsrc.php")&&d.getQueryData().origin!==void 0?d.addQueryData("origin",c).toString():a})}}else this._iframeURI="about:blank";this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI),i.log("iframe_uri_set")}catch(c){i.error("iframe_uri_set_error",c),this.exitState({status:b("ChannelConstants").ERROR,stateId:a.stateId},c+"")}},enterState:function(a,c){a=="init"?this._initIframe(c):/idle|ping|pull/.test(a)?this._iframeProxy?this._iframeProxy.enterState.apply(this._iframeProxy,arguments):a!="idle"&&this.exitState({status:b("ChannelConstants").ERROR,stateId:c.stateId},"iframe not yet loaded"):a=="shutdown"&&this._initIframe()},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments)},exitState:function(a){this.manager.state=="init"&&a.status==b("ChannelConstants").OK&&(this._iframeProxy=b("DocRPC").proxy(this._iframe.contentWindow,"innerTransport",["enterState"],(this._iframeURI+"").replace(/iframe.*/,"")));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments)}});function f(){this.init=this.init.bind(this),q.apply(this,arguments)}Object.assign(f.prototype,{logName:"iframe(inner)",init:function(){b("DocRPC").publish(this,"innerTransport");try{var a=b("DocRPC").proxy(window.parent,"outerTransport",["_processTransportData","exitState"],top.DocRPC.origin);Object.assign(this,a);this.exitState({status:b("ChannelConstants").OK,stateId:1e6})}catch(a){i.error("iframe_inner_init_error",a)}},enterState:function(a,c){this._request&&(this._request.abort(),this._request=null),a=="ping"?this._request=o(c,b("bind")(this,"exitState",{status:b("ChannelConstants").OK,stateId:c.stateId}),b("bind")(this,"exitState",{status:b("ChannelConstants").ERROR,stateId:c.stateId})):a=="pull"&&(this._request=p(c,b("bind")(this,"_processTransportData",c.stateId),b("bind")(this,"exitState",{status:b("ChannelConstants").OK,stateId:c.stateId}),b("bind")(this,"exitState",{status:b("ChannelConstants").ERROR,stateId:c.stateId})))}});e.exports={isSubdomain:l,getURI:m,Transport:q,CORSTransport:c,IframeTransport:d,IframeInnerTransport:f,sendActivePing:a}}),null);
__d("ChatProxyConnectionState",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.auxiliaryIrisQueues={},this.aiq=null}var b=a.prototype;b.subscribeIrisQueue=function(a,b){this.auxiliaryIrisQueues[a]=b,this.updateCaches()};b.unsubscribeIrisQueue=function(a){delete this.auxiliaryIrisQueues[a],this.updateCaches()};b.updateCaches=function(){var a=[];for(var b in this.auxiliaryIrisQueues)Object.prototype.hasOwnProperty.call(this.auxiliaryIrisQueues,b)&&(a.push(b),a.push(this.auxiliaryIrisQueues[b]));a.length===0?this.aiq=null:this.aiq=a.join(",")};return a}();f["default"]=a}),66);
__d("ChatReliabilityEvents",[],(function(a,b,c,d,e,f){a=Object.freeze({ERROR:"error",CHANNEL_DISCONNECT:"channel_disconnect",CHANNEL_CONNECT:"channel_connect",CHANNEL_INIT:"channel_init",CHANNEL_NOCONFIG:"channel_noconfig",CHANNEL_HISTORY_INVALID:"channel_history_invalid",CHANNEL_STALLED:"channel_stalled",MESSAGE_RECEIVED:"msg_received",MESSAGE_SEND_START:"msg_send_start",THREAD_INFO_ENDPOINT_FATAL:"thread_info_fatal",DFF_ENDPOINT_FATAL:"invalidate_global_state_fatal",DFF_DELTA_INIT:"dff_initiated_by_delta",DFF_HOLE_INIT:"dff_initiated_by_hole",FETCHING_MANY_MESSAGES:"fetching_many_messages",THREAD_INFO_MISSING:"thread_info_missing",SET_THREAD_ID_MAP:"set_thread_id_map",DELETE_THREAD:"delete_thread",PROCESS_DELTA:"process_delta",RTI_SESSION:"chatproxy_rti_session",ON_INVALID_HISTORY:"chatproxy_on_invalid_history",GET_DEBUG_PRESENCE:"chatproxy_get_debug_presence"});f["default"]=a}),66);
__d("ChatReliabilityInstrumentation",["ChatReliabilityEvents","ChatReliabilityTypedLogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b){if(!c("gkx")("678576"))return;new(c("ChatReliabilityTypedLogger"))().setEvent(a).setEventData(b).log()};function a(a){h(c("ChatReliabilityEvents").ERROR,a)}function b(a){h(c("ChatReliabilityEvents").CHANNEL_DISCONNECT,a)}function d(a){h(c("ChatReliabilityEvents").CHANNEL_CONNECT,a)}function e(a){h(c("ChatReliabilityEvents").CHANNEL_HISTORY_INVALID,a)}function f(a){h(c("ChatReliabilityEvents").MESSAGE_RECEIVED,a)}function i(a){h(c("ChatReliabilityEvents").MESSAGE_SEND_START,a)}function j(a){h(c("ChatReliabilityEvents").CHANNEL_STALLED,a)}function k(a){h(c("ChatReliabilityEvents").CHANNEL_INIT,a)}function l(a){h(c("ChatReliabilityEvents").CHANNEL_NOCONFIG,a)}function m(a){h(c("ChatReliabilityEvents").DFF_DELTA_INIT,a)}function n(a){h(c("ChatReliabilityEvents").DFF_HOLE_INIT,a)}function o(a){h(c("ChatReliabilityEvents").FETCHING_MANY_MESSAGES,a)}function p(a){h(c("ChatReliabilityEvents").PROCESS_DELTA,a)}function q(a){h(c("ChatReliabilityEvents").THREAD_INFO_MISSING,a)}function r(a){h(c("ChatReliabilityEvents").SET_THREAD_ID_MAP,a)}function s(a){h(c("ChatReliabilityEvents").DELETE_THREAD,a)}function t(a){h(a)}g.logERROR=a;g.logCHANNEL_DISCONNECT=b;g.logCHANNEL_CONNECT=d;g.logCHANNEL_HISTORY_INVALID=e;g.logMESSAGE_RECEIVED=f;g.logMESSAGE_SEND_START=i;g.logCHANNEL_STALLED=j;g.logCHANNEL_INIT=k;g.logCHANNEL_NOCONFIG=l;g.logDFF_DELTA_INIT=m;g.logDFF_HOLE_INIT=n;g.logFETCHING_MANY_MESSAGES=o;g.logPROCESS_DELTA=p;g.logTHREAD_INFO_MISSING=q;g.logSET_THREAD_ID_MAP=r;g.logDELETE_THREAD=s;g.logCHATPROXY_EVENT=t}),98);
__d("PresencePrivacy",["Arbiter","ArbiterMixin","AsyncRequest","Bootloader","ChannelConstants","CurrentUser","PresencePrivacyInitialData","PresenceUtil","mixin"],(function(a,b,c,d,e,f,g){var h="/ajax/chat/privacy/settings.php",i="/ajax/chat/privacy/online_policy.php",j="/ajax/chat/privacy/visibility.php",k="friend_visibility",l="visibility",m="online_policy",n=babelHelpers["extends"]({},d("PresencePrivacyInitialData").privacyData),o=d("PresencePrivacyInitialData").visibility,p=babelHelpers["extends"]({},d("PresencePrivacyInitialData").privacyData),q=o,r=d("PresencePrivacyInitialData").onlinePolicy,s=r,t=[],u=!1;b=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.WHITELISTED=1,c.BLACKLISTED=-1,c.UNLISTED=0,c.ONLINE=1,c.OFFLINE=0,c.ONLINE_TO_WHITELIST=0,c.ONLINE_TO_BLACKLIST=1,b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.init=function(a,b,c){};c.setVisibility=function(a){q=o;z(a);var b={visibility:a},c={type:l,visibility:a};b=H(j,b,c);C(b,c);return a};c.getVisibility=function(){return o};c.setOnlinePolicy=function(a){s=r;A(a);var b={online_policy:a},c={type:m,online_policy:a};b=H(i,b,c);C(b,c);return a};c.getOnlinePolicy=function(){return r};c.getFriendVisibility=function(a){return n[a]||v.UNLISTED};c.getFriendsVisibility=function(){return n};c.isUserOffline=function(){return this.getVisibility()===v.OFFLINE};c.allows=function(a){return this.isUserOffline()?!1:this.allowsIfViewerIsOnline(a)};c.allowsIfViewerIsOnline=function(a){var b=this.getOnlinePolicy();return b===v.ONLINE_TO_WHITELIST?n[a]==v.WHITELISTED:n[a]!=v.BLACKLISTED};c.getOnlinePolicyStr=function(){if(this.isUserOffline())return"offline";var a=this.getOnlinePolicy();if(a===v.ONLINE_TO_WHITELIST)return"online_to_whitelist";return a===v.ONLINE_TO_BLACKLIST?"online_to_blacklist":"unknown"};c.setFriendsVisibility=function(a,b){if(a.length>0){var c={};for(var d=0;d<a.length;d++){var e=a[d];p[e]=n[e];c[e]=b}w(c);e=b;e==v.UNLISTED&&(e=p[a[0]]);d={users:a,setting:b,setting_type:e};a={type:k,settings:c};e=H(h,d,a);C(e,a)}return b};c.setFriendVisibilityMap=function(a,b){for(var c in a)p[c]=n[c];w(a);a={type:k,settings:a};C(G(b,a),a)};c.allow=function(a){if(this.allows(a))throw new Error("allow() should only be called for users that are not already allowed");if(this.getVisibility()===v.OFFLINE)throw new Error("allow() should only be called when the user is already online");var b=this.getOnlinePolicy()===v.ONLINE_TO_WHITELIST?v.WHITELISTED:v.UNLISTED;return this.setFriendsVisibility([a],b)};c.disallow=function(a){if(!this.allows(a))throw new Error("disallow() should only be called for users that are not already disallowed");if(this.getVisibility()===v.OFFLINE)throw new Error("disallow() should only be called when the user is already online");var b=this.getOnlinePolicy()===v.ONLINE_TO_BLACKLIST?v.BLACKLISTED:v.UNLISTED;return this.setFriendsVisibility([a],b)};c.getBlacklist=function(){var a=[];for(var b in n)n[b]===v.BLACKLISTED&&a.push(b);return a};c.getWhitelist=function(){var a=[];for(var b in n)n[b]===v.WHITELISTED&&a.push(b);return a};c.getMapForTest=function(){return n};c.setMapForTest=function(a){n=a};return b}(c("mixin")(d("ArbiterMixin")));var v=new b();function w(a){var b;for(b in a){var d=a[b];if(b==c("CurrentUser").getID())throw new Error("Invalid to set current user's visibility");switch(d){case v.WHITELISTED:case v.BLACKLISTED:case v.UNLISTED:break;default:throw new Error("Invalid state: "+d)}}for(b in a)n[b]=a[b];v.inform("privacy-changed")}function x(a,b){var c={};c[a]=b;w(c)}function y(a){c("Bootloader").loadModules(["MessengerMQTTPresenceReporting"],function(b){b.reportChatVisibility(!!a)},"PresencePrivacy")}function z(a){switch(a){case v.ONLINE:case v.OFFLINE:break;default:throw new Error("Invalid visibility: "+a)}o=a;y(a);v.inform("privacy-changed");v.inform("privacy-user-presence-changed")}function A(a){switch(a){case v.ONLINE_TO_WHITELIST:case v.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+a)}r=a;v.inform("privacy-user-presence-changed");v.inform("privacy-changed")}function B(a,b){u=!0,a.send()}function C(a,b){t.push({request:a,data:b});if(!u){a=t.shift();B(a.request,a.data)}}function D(a,b){b=a.type;if(b===k){v.inform("privacy-availability-changed");for(var c in a.settings)p[c]=a.settings[c]}else b===l?q=a.visibility:b===m&&(s=a.online_policy),v.inform("privacy-user-presence-response")}function E(a,b){o!==q&&z(q),r!==s&&A(s),Object.assign(n,p),v.inform("privacy-changed"),t=[]}function F(a){u=!1;if(t.length>0){a=t.shift();B(a.request,a.data)}}function G(a,b){if(d("PresenceUtil")!=null){var c=a.getData();c.window_id=d("PresenceUtil").getSessionID();a.setData(c)}a.setHandler(D.bind(this,b)).setErrorHandler(E.bind(this,b)).setTransportErrorHandler(E.bind(this,b)).setFinallyHandler(F.bind(this)).setAllowCrossPageTransition(!0);return a}function H(a,b,d){return G(new(c("AsyncRequest"))(a).setData(b),d)}function a(a,b){a=b.obj;if(a.viewer_id!=c("CurrentUser").getID())throw new Error("Viewer got from the channel is not the real viewer");if(a.window_id===d("PresenceUtil").getSessionID())return;var e=a.data;if(a.event=="access_control_entry")e.target_ids.forEach(function(a){x(a,e.setting),p[a]=e.setting});else{if(a.event=="visibility_update"){b=e.visibility?v.ONLINE:v.OFFLINE;z(b);q=b}else a.event=="online_policy_update"&&(A(e.online_policy),s=e.online_policy);v.inform("privacy-user-presence-response")}}v.inform("privacy-changed");v.inform("privacy-user-presence-changed","state");c("Arbiter").subscribe(d("ChannelConstants").getArbiterType("privacy_changed"),a.bind(this));c("Arbiter").subscribe(d("ChannelConstants").ON_CONFIG,function(a,b){a=b.getConfig("visibility",null);if(a!==null&&typeof a!=="undefined"){b=a?v.ONLINE:v.OFFLINE;z(b)}}.bind(this));e=v;g["default"]=e}),98);
__d("ChatVisibility",["Arbiter","PresencePrivacy"],(function(a,b,c,d,e,f){var g={isOnline:function(){return b("PresencePrivacy").getVisibility()===b("PresencePrivacy").ONLINE},hasBlackbirdEnabled:function(){return this.isVisibleToMostFriends()||this.isVisibleToSomeFriends()},isVisibleToMostFriends:function(){return b("PresencePrivacy").getOnlinePolicy()===b("PresencePrivacy").ONLINE_TO_BLACKLIST&&b("PresencePrivacy").getBlacklist().length>0},isVisibleToSomeFriends:function(){return b("PresencePrivacy").getOnlinePolicy()===b("PresencePrivacy").ONLINE_TO_WHITELIST&&b("PresencePrivacy").getWhitelist().length>0},goOnline:function(a){b("PresencePrivacy").getVisibility()===b("PresencePrivacy").OFFLINE&&(b("PresencePrivacy").setVisibility(b("PresencePrivacy").ONLINE),b("Arbiter").inform("chat-visibility/go-online")),a&&a()},goOffline:function(a){b("PresencePrivacy").getVisibility()===b("PresencePrivacy").ONLINE&&(b("PresencePrivacy").setVisibility(b("PresencePrivacy").OFFLINE),b("Arbiter").inform("chat-visibility/go-offline")),a&&a()},toggleVisibility:function(){g.isOnline()?g.goOffline():g.goOnline()}};e.exports=g}),null);
__d("FBAjaxRequest",["AjaxError","AjaxRequest","getAsyncParams"],(function(a,b,c,d,e,f,g){a=function(a){babelHelpers.inheritsLoose(b,a);function b(b,d,e){e=babelHelpers["extends"]({},c("getAsyncParams")(b),e);b=a.call(this,b,d,e)||this;b.$FBAjaxRequest1=e;b.streamMode=!1;return b}var e=b.prototype;e.onJSONSafe=function(){this.json&&(this.json.error&&(this.errorType=d("AjaxError").SERVER_ERROR,this.errorText="AsyncResponse error: "+this.json.error),this.json=this.json.payload),a.prototype.onJSONSafe.call(this)};e.send=function(b){a.prototype.send.call(this,babelHelpers["extends"]({},b,this.$FBAjaxRequest1))};return b}(c("AjaxRequest"));g["default"]=a}),98);
__d("FantailLogger",["FantailConfig"],(function(a,b,c,d,e,f){var g=b("FantailConfig").FantailLogQueue;a={debug:function(a,b){var c;for(var d=arguments.length,e=new Array(d>2?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];g&&(c=g.get(a)).debug.apply(c,[b].concat(e))},info:function(a,b){var c;for(var d=arguments.length,e=new Array(d>2?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];g&&(c=g.get(a)).info.apply(c,[b].concat(e))},warn:function(a,b){var c;for(var d=arguments.length,e=new Array(d>2?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];g&&(c=g.get(a)).warn.apply(c,[b].concat(e))},error:function(a,b){var c;for(var d=arguments.length,e=new Array(d>2?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];g&&(c=g.get(a)).error.apply(c,[b].concat(e))}};e.exports=a}),null);
__d("MovingStat",[],(function(a,b,c,d,e,f){a=function(){function a(a){this.$1=a>0?a:6e4,this.$2=0,this.$3=0,this.$5={t:new Date(),count:0,v:0},this.$4=this.$5}var b=a.prototype;b.add=function(a){this.$2+=a;this.$3++;var b=new Date();if(b-this.$5.t<1e3){this.$5.v+=a;this.$5.count++;return}this.$5.next={t:b,v:a,count:1};this.$5=this.$5.next;this.$6()};b.tally=function(a){a===void 0&&(a=1e3);this.$6();return{sum:this.$2,count:this.$3,timeAverage:this.$2*a/this.$1}};b.$6=function(){var a=new Date()-this.$1;while(this.$4&&this.$4.next&&this.$4.t<a)this.$2-=this.$4.v,this.$3-=this.$4.count,this.$4=this.$4.next};return a}();f["default"]=a}),66);
__d("InstantGamesPresenceProperties",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=!1}var b=a.prototype;b.addInstantGamePresence=function(){this.$1=!0};b.removeInstantGamePresence=function(){this.$1=!1};b.isActiveGamePresence=function(){return this.$1};return a}();b=new a();c=b;f["default"]=c}),66);
__d("PresenceProperties",["ChannelConstants","InstantGamesPresenceProperties","WorkplaceChatHelper"],(function(a,b,c,d,e,f,g){a=function(){function a(){this.$1=d("ChannelConstants").CAPABILITY_VOIP_INTEROP}var b=a.prototype;b.getProperties=function(){d("WorkplaceChatHelper").isDesktopChatApp()&&(this.$1|=d("ChannelConstants").CAPABILITY_ACTIVE_ON_DESKTOP_APP);c("InstantGamesPresenceProperties").isActiveGamePresence()?this.$1|=d("ChannelConstants").CAPABILITY_PLAYING_INSTANT_GAME:this.$1&=~d("ChannelConstants").CAPABILITY_PLAYING_INSTANT_GAME;return this.$1};return a}();b=new a();e=b;g["default"]=e}),98);
__d("SystemEvents",["ArbiterMixin","Cookie","ExecutionEnvironment","SystemEventsInitialData","TimeSlice","UserActivity","UserAgent_DEPRECATED","clearTimeout","mixin","setIntervalAcrossTransitions","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){"use strict";var h=1e3;b=function(b){babelHelpers.inheritsLoose(e,b);function e(){var e;e=b.call(this)||this;e.$SystemEvents11=function(){var a=e.$SystemEvents7();e.$SystemEvents2!=a&&(e.$SystemEvents2=a,e.inform(e.USER,a));e.$SystemEvents12()};e.USER="SystemEvents/USER";e.ONLINE="SystemEvents/ONLINE";e.TIME_TRAVEL="SystemEvents/TIME_TRAVEL";e.$SystemEvents1=c("SystemEventsInitialData").ORIGINAL_USER_ID;e.$SystemEvents2=e.$SystemEvents1;e.$SystemEvents3=a.navigator!=null?a.navigator.onLine:!1;e.$SystemEvents4=Date.now();d("ExecutionEnvironment").canUseDOM&&e.$SystemEvents6();return e}var f=e.prototype;f.isPageOwner=function(a){return(a||this.$SystemEvents7())==this.$SystemEvents1};f.isOnline=function(){return!!(d("UserAgent_DEPRECATED").chrome()||this.$SystemEvents3)};f.checkTimeTravel=function(){var a=Date.now(),b=a-this.$SystemEvents4;this.$SystemEvents4=a;(b<0||b>1e4)&&this.inform(this.TIME_TRAVEL,b)};f.$SystemEvents6=function(){this.$SystemEvents8(),this.$SystemEvents9(),this.$SystemEvents10()};f.$SystemEvents8=function(){var a=this,b=c("TimeSlice").guard(function(){a.$SystemEvents3||(a.$SystemEvents3=!0,a.inform(a.ONLINE,a.$SystemEvents3))},"SystemEvents onOnline"),e=c("TimeSlice").guard(function(){a.$SystemEvents3&&(a.$SystemEvents3=!1,a.inform(a.ONLINE,a.$SystemEvents3))},"SystemEvents onOffline");d("UserAgent_DEPRECATED").ie()?d("UserAgent_DEPRECATED").ie()>=11?(window.addEventListener("online",b,!1),window.addEventListener("offline",e,!1)):d("UserAgent_DEPRECATED").ie()>=8?window.attachEvent("onload",function(){document.body.ononline=b,document.body.onoffline=e}):c("setIntervalAcrossTransitions")(function(){(navigator.onLine?b:e)()},h):window.addEventListener&&(window.addEventListener("online",b,!1),window.addEventListener("offline",e,!1))};f.$SystemEvents12=function(){c("clearTimeout")(this.$SystemEvents5),this.$SystemEvents5=c("setTimeoutAcrossTransitions")(this.$SystemEvents11,h)};f.$SystemEvents9=function(){var a=this;c("UserActivity").subscribe(function(){a.$SystemEvents12()});this.$SystemEvents12()};f.$SystemEvents10=function(){c("setIntervalAcrossTransitions")(this.checkTimeTravel.bind(this),h)};f.$SystemEvents7=function(){return c("Cookie").get("c_user")||"0"};return e}(c("mixin")(d("ArbiterMixin")));e=new b();g["default"]=e}),99);
__d("ChannelManager",["errorCode","AjaxError","AjaxRequest","Arbiter","AsyncRequest","ChannelClientID","ChannelConstants","ChannelInitialData","ChannelSubdomain","ChannelTransport","ChatProxyConnectionState","ChatReliabilityInstrumentation","ChatVisibility","DTSG","DesktopWebMessageTypesSitevarConfig","Env","FBAjaxRequest","FBMqttChannel","FantailLogger","ISB","LogHistory","MovingStat","ODS","PresenceCookieManager","PresenceProperties","PresenceUtil","Promise","Random","SystemEvents","URI","UserActivity","clearTimeout","cr:1579987","emptyFunction","requestAnimationFrameAcrossTransitions","setIntervalAcrossTransitions","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){var h,i,j=b("LogHistory").getInstance("channel_manager"),k=b("emptyFunction"),l=new(b("Promise"))(function(a,c){b("ODS").bumpEntityKey(2231,"ChannelManager","transportPromise.cleanup"),k=a}),m={idle:{ok:"init!"},init:{ok:"pull!",error:"reconnect",sys_online:"init",sys_timetravel:"init"},pull:{ok:"pull!",error:"ping",error_missing:"pull",error_msg_type:"pull",refresh_0:"reconnect",refresh_110:"reconnect",refresh_111:"reconnect",refresh_112:"pull",refresh_113:"pull",refresh_117:"reconnect"},ping:{ok:"pull!",error:"ping",error_stale:"reconnect!"},reconnect:{ok:"init!",error:"reconnect",sys_online:"reconnect",sys_timetravel:"reconnect"},shutdown:{},_all:{error_max:"shutdown!",error_shutdown:"shutdown!",sys_owner:"reconnect",sys_nonowner:"idle!",sys_online:"ping",sys_offline:"idle!",sys_timetravel:"ping"}},n={state:new(b("ChatProxyConnectionState"))(),userActive:Date.now(),created:Date.now(),ready:!1,seqTurSentAt:-1,queueMade:"",sequenceId:0,lastPresenceState:null,lastRequestErrorReason:null,seq:0,pingFailuresOnSubdomain:0,pws:"fresh",estimatedReceived:0,sessionID:b("ChannelClientID").getID(),capabilities:b("PresenceProperties").getProperties(),streamingCapable:!1,inStreaming:!1,shouldSuppressPresence:b("cr:1579987")?b("cr:1579987").shouldSuppress():!1,LONGPOLL_TIMEOUT:6e4,STREAMING_TIMEOUT:6e4,P_TIMEOUT:3e4,IFRAME_LOAD_TIMEOUT:3e4,MIN_RETRY_INTERVAL:5e3,MAX_RETRY_INTERVAL:32e4,MIN_12002_TIMEOUT:9e3,MIN_504_TIMEOUT:2e4,STALL_THRESHOLD:18e4,JUMPSTART_THRESHOLD:9e4,MIN_INIT_PROBE_DELAY:3e3,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12e3,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:1e4,PROBE_DELAY:6e4,PROBE_HEARTBEATS_INTERVAL_LOW:1e3,PROBE_HEARTBEATS_INTERVAL_HIGH:5e3,STREAMING_EXIT_STATE_ON_CONTINUE:!1},o=1,p={},q=0;function r(){b("ODS").bumpEntityKey(2231,"ChannelManager","getLastSuccess.cleanup");var a=b("AsyncRequest").lastSuccessTime;return a?Math.round((Date.now()-a)/1e3):-1}function s(a,c){b("ODS").bumpEntityKey(2231,"ChannelManager","_getConfig.cleanup");return Object.prototype.hasOwnProperty.call(n,a)?n[a]:c}function t(){b("ODS").bumpEntityKey(2231,"ChannelManager","_getInfo.cleanup");var a={};s("host")&&(a[s("user_channel")]=s("seq",0));return a}function u(a){b("ODS").bumpEntityKey(2231,"ChannelManager","_bumpDelay.cleanup"),a?(q=0,p={}):q++}a={state:"idle",nextState:null,proxyDown:!1,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],backoff:!1,sessionRegistered:!1,_initTimer:null,_deferredTransition:null,_transportRate:null,_shutdownHint:null,init:function(a,c){var d=this;b("ODS").bumpEntityKey(2231,"ChannelManager","init.cleanup");b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"initializing sessionid:%s at iris-seq:%s",n.sessionID,n.sequenceId);this.init=b("emptyFunction");b("Arbiter").subscribe(b("ChannelConstants").GET_RTI_SESSION_REQUEST,function(a,b){d.informCurrentSession()});b("Arbiter").subscribe(b("ChannelConstants").CONSOLE_LOG,function(a,b){});b("requestAnimationFrameAcrossTransitions")(function(){b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"using session id: %s at seq: %s {%s} with sticky: %s/%s",n.sessionID,n.seq,n.sequenceId,n.sticky_token,n.sticky_pool),b("UserActivity").subscribe(function(){var a=b("ChannelTransport").getURI(n,"/U");b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"user activity sessionid: %s at seq: %s/{%s} with sticky: %s/%s state: %s uri: %s",n.sessionID,n.seq,n.sequenceId,n.sticky_token,n.sticky_pool,d.state,a);d.state=="pull"&&(n.userActive=Date.now(),b("ChannelTransport").sendActivePing(n))}),b("Arbiter").subscribe(b("ChannelConstants").ENTITY_PRESENCE_ACTIVE_PING,function(a){a=b("ChannelTransport").getURI(n,"/U");b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"entity presence activity sessionid: %s at seq: %s/{%s} with sticky: %s/%s state: %s uri: %s",n.sessionID,n.seq,n.sequenceId,n.sticky_token,n.sticky_pool,d.state,a);d.state=="pull"&&(n.userActive=Date.now())})});b("PresenceCookieManager").register("ch",t);var e=this.getConfig("max_conn",2);n.subdomain=b("ChannelSubdomain").allocate(e);b("ChannelTransport").isSubdomain(n.subdomain)||(b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"invalid subdomain from ChannelSubdomain: %s",n.subdomain),n.subdomain=null);this._transportRate=new(b("MovingStat"))(3e4);e=b("AjaxRequest").supportsCORS()?"CORSTransport":"IframeTransport";b("ODS").bumpEntityKey(2966,"ChannelManager","transport_chosen."+e);this.transport=new(b("ChannelTransport")[e])(this);k(this.transport);a&&this.enterState(a,c);b("requestAnimationFrameAcrossTransitions")(function(){d._initMonitors()});if(this.getConfig("fullHost")&&b("AjaxRequest").supportsCORS()){if(this.getConfig("tryStreaming")){e=n.MIN_INIT_PROBE_DELAY+b("Random").random()*n.INIT_PROBE_DELAY_RANDOMIZE_RANGE;b("setTimeoutAcrossTransitions")(this._probeTest,e)}if(this.getConfig("trySSEStreaming")){a=n.MIN_INIT_PROBE_DELAY+b("Random").random()*n.INIT_PROBE_DELAY_RANDOMIZE_RANGE;b("setTimeoutAcrossTransitions")(this._sseProbeTest,a)}}},_mqttInit:function(){var a=this;b("ODS").bumpEntityKey(2231,"ChannelManager","_mqttInit.cleanup");b("FBMqttChannel").subscribe("/legacy_web",function(c){try{c=JSON.parse(c);a._processMqttMessage(c)}catch(a){b("ODS").bumpEntityKey(2966,"ChannelManager","mqttInit."+a.message)}})},configure:function(){b("ODS").bumpEntityKey(2231,"ChannelManager","configure.cleanup");for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];j.log("configure",JSON.stringify(c));c.forEach(function(a){return Object.assign(n,a)});this._indicateLbInfoUpdated("reconnect",JSON.stringify(c));b("Arbiter").inform(b("ChannelConstants").ON_CONFIG,this)},getConfig:function(a,c){b("ODS").bumpEntityKey(2231,"ChannelManager","getConfig.cleanup");return s(a,c)},getCompleteConfig:function(){b("ODS").bumpEntityKey(2231,"ChannelManager","getCompleteConfig.cleanup");return n},isShutdown:function(){b("ODS").bumpEntityKey(2231,"ChannelManager","isShutdown.cleanup");return this.state=="shutdown"},shouldIdle:function(){b("ODS").bumpEntityKey(2231,"ChannelManager","shouldIdle.cleanup");return!(b("SystemEvents").isPageOwner()&&b("SystemEvents").isOnline())},_sendIframeError:function(a){b("ODS").bumpEntityKey(2231,"ChannelManager","_sendIframeError.cleanup");a=new(b("AsyncRequest"))().setURI("/ajax/presence/reconnect.php").setData({reason:a,fb_dtsg:b("DTSG").getToken()}).setOption("suppressErrorHandlerWarning",!0).setOption("retries",1).setMethod("GET").setReadOnly(!0).setAllowCrossPageTransition(!0);a.specifiesWriteRequiredParams()&&a.send()},_getDelay:function(){b("ODS").bumpEntityKey(2231,"ChannelManager","_getDelay.cleanup");var a=Math.min(n.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,q-1)),n.MAX_RETRY_INTERVAL);this.proxyDown&&"proxy_down_delay_millis"in n&&(a=n.proxy_down_delay_millis);this.proxyDown=!1;return Math.floor(a*(1+Math.random()*.5))},resetDelay:function(){b("ODS").bumpEntityKey(2231,"ChannelManager","resetDelay.cleanup"),u(!0)},enterState:function(a,c){b("ODS").bumpEntityKey(2231,"ChannelManager","enterState.cleanup");this._inEnterState&&(j.warn("enterstate_recursion",JSON.stringify({state:this.state,args:arguments})),b("ChatReliabilityInstrumentation").logERROR("enterstate_recursion"));this._inEnterState=!0;try{this._enterState.apply(this,arguments),this._inEnterState=!1}catch(a){this._inEnterState=!1;throw a}},_enterState:function(a){var c=this;b("ODS").bumpEntityKey(2231,"ChannelManager","_enterState.cleanup");if(!(/init/.test(a)||/reconnect/.test(a)))return;var d=this.backoff?this._getDelay():0;this.backoff=!1;if(this.isShutdown()){b("FantailLogger").warn(b("ChannelConstants").FANTAIL_SERVICE,"not executing state due to shutdown mode: %s",a);return}if(a!="idle!"&&this.shouldIdle()){b("FantailLogger").warn(b("ChannelConstants").FANTAIL_SERVICE,"forced idleness");return}o++;n.stateId=o;b("clearTimeout")(this._deferredTransition);this._deferredTransition=null;!this.transport?(l.then(function(a){return a.enterState("idle")}),b("ChatReliabilityInstrumentation").logERROR("called enterState "+a+" before transport init")):this.transport.enterState("idle");this.state="idle";this.nextState=null;if(/!$/.test(a)){if(this._transportRate){var e=this._transportRate.tally().timeAverage,f=this.getConfig("MAX_CHANNEL_STATES_PER_SEC",1);e>=f&&(this._throttled||(this._throttled=!0,j.warn("throttled","{}"),b("Arbiter").inform(b("ChannelConstants").THROTTLED,e)),d=1e3/f)}}else/#$/.test(a)||(d=this._getDelay());a=a.replace(/\W*$/,"");if(!m[a]){b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"invalid state: %s",a);throw new Error("invalid state:"+a)}var g=Array.from(arguments),h={};if(d<=0){h.state=a;this._transportRate&&this._transportRate.add(1);this.state=a;var i=this["_enter_"+this.state];i&&(g.shift(),i.apply(this,g));/init|idle|pull|ping/.test(this.state)&&(n.streamingCapable&&/pull/.test(this.state)&&(this.heartbeats=[]),n.is_offline=!b("ChatVisibility").isOnline(),n.capabilities=b("PresenceProperties").getProperties(),b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"entering transport state: %s",this.state),!this.transport?(l.then(function(a){return a.enterState(c.state,n)}),b("ChatReliabilityInstrumentation").logERROR("called enterState "+a+" before transport init")):this.transport.enterState(this.state,n),this.state=="ping"&&(h.url=b("ChannelTransport").getURI(n).toString(),h.port=n.port||"undefined"))}else this.state="idle",this.nextState=a,h.state=this.state,h.delay=d,h.nextState=a,g[0]=a+"#",this._deferredTransition=b("setTimeoutAcrossTransitions")(function(){c._deferredTransition=null,c.enterState.apply(c,g)},d);/pull/.test(a)&&(h.client_id=n.sessionID,h.streaming=n.inStreaming);b("Arbiter").inform(b("ChannelConstants").ON_ENTER_STATE,h)},exitState:function(a,c){b("ODS").bumpEntityKey(2231,"ChannelManager","exitState.cleanup");var d=a.stateId,e=a.status;if(this.isShutdown()||d<o)return;var f=this.state,g=Array.from(arguments);g[0]=a.status;var h={state:f,status:e};/pull/.test(f)&&(h.client_id=n.sessionID,h.streaming=n.inStreaming);/ping/.test(f)&&e!=b("ChannelConstants").OK&&(h.url=b("ChannelTransport").getURI(n).toString());this.nextState&&(h.nextState=this.nextState);c&&c.errorType?(n.lastRequestErrorReason=c.errorType,h.xhr=c.toJSON?c.toJSON():c,c.errorType==b("AjaxError").SERVICE_UNAVAILABLE&&(b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"got 5xx http status code, setting long delay"),this.proxyDown=!0),delete h.xhr.json):e!=b("ChannelConstants").OK&&(n.lastRequestErrorReason=e);c&&c.json&&(c.json.t&&(h.t=c.json.t),c.json.reason&&(h.reason=c.json.reason),c.json.seq&&(h.seq=c.json.seq));b("Arbiter").inform(b("ChannelConstants").ON_EXIT_STATE,h);var i=this["_exit_"+f];i&&(e=i.apply(this,g)||e);e!=b("ChannelConstants").OK&&(u(),p[f]=(p[f]||0)+1);var k=m[this.nextState||f][e]||m._all[e],l=k&&k.replace(/!*$/,"");l||(j.error("terminal_transition",JSON.stringify(h)),this._shutdownHint=b("ChannelConstants").HINT_INVALID_STATE,k="shutdown!",b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"entering shutdown state"));this._lastState=f;this._lastStatus=e;this.enterState(k)},_processTransportData:function(a,c){b("ODS").bumpEntityKey(2231,"ChannelManager","_processTransportData.cleanup"),this._processTransportData0(a,c,c.json)},_processTransportData0:function(a,c,d){b("ODS").bumpEntityKey(2231,"ChannelManager","_processTransportData0.cleanup");var e=d.t;"s"in d&&(d.seq=d.s,delete d.s);if(d.u&&n.user&&d.u!=n.user){j.warn("misguided_msg",JSON.stringify({user:n.user,target:d.u}));this._reportProxyMisguidedMsg(d.u,n.user);return}var f=n.seq;"seq"in d&&(n.seq=d.seq,b("cr:1579987")&&b("cr:1579987").doSync());switch(e){case"continue":n.inStreaming&&this.heartbeats.length<1&&(n.streamingCapable=!1,j.log("switch_to_longpoll","{}"),b("setTimeoutAcrossTransitions")(this._probeTest,n.PROBE_DELAY));u(!0);(!n.inStreaming||n.STREAMING_EXIT_STATE_ON_CONTINUE)&&this.exitState({status:b("ChannelConstants").OK,stateId:a});break;case"refresh":case"refreshDelay":b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"got refresh with reason: %s",d.reason);this.exitState({status:"refresh_"+(d.reason||0),stateId:a},c);break;case"backoff":b("FantailLogger").warn(b("ChannelConstants").FANTAIL_SERVICE,"server told client to back off");u();this.backoff=!0;break;case"lb":var g=d.lb_info;if(g){n.sticky_token=g.sticky;"pool"in g&&(n.sticky_pool=g.pool);if("sd"in g){var h=g.subdomain;b("ChannelTransport").isSubdomain(h)&&(n.subdomain=g.subdomain)}"vip"in g&&(n.host=g.vip);this._indicateLbInfoUpdated("chatproxy",JSON.stringify(d))}else j.error("missing_lb_info","{}");break;case"test_streaming":b("setTimeoutAcrossTransitions")(this._probeTest,500);break;case"fullReload":b("PresenceCookieManager").clear();j.log("full_reload","{}");this.sessionRegistered=!0;this.informCurrentSession();b("Arbiter").inform(b("ChannelConstants").ON_INVALID_HISTORY);u(!0);b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"full reload incurred");h=b("ChannelConstants").OK;this.exitState({status:h,stateId:a},c);"ms"in d&&this._processMessages(d,f);break;case"msg":u(!0);this._processMessages(d,f);break;case"heartbeat":if(n.inStreaming){g=Date.now();var i;this.heartbeats.length>0&&(i=g-this.heartbeats[this.heartbeats.length-1]);j.log("heartbeat_interval",JSON.stringify({client_id:n.sessionID,interval:i}));this.heartbeats.push(g)}break;case"batched":h=d.batches;for(var f=0;f<h.length;f++)this._processTransportData0(a,c,h[f]);break;default:b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"got an unknown protocol message: %s",e);j.error("unknown_msg_type",JSON.stringify({type:e}));break}},_processMqttMessage:function(a){b("ODS").bumpEntityKey(2231,"ChannelManager","_processMqttMessage.cleanup");if(b("DesktopWebMessageTypesSitevarConfig").ChatProxySupportedMessageTypes.get(a.type)===!0&&b("DesktopWebMessageTypesSitevarConfig").MQTTMigrationExcludeMessageTypes.get(a.type)!==!0)if(a.type==="rtc_live_json")b("ODS").bumpEntityKey(2966,"ChannelManager","processMqttMessages.dropped."+a.type);else{var c=b("ChannelConstants").getArbiterType(a.type);b("Arbiter").inform(c,{obj:a});b("ODS").bumpEntityKey(2966,"ChannelManager","processMqttMessages."+a.type)}else b("ODS").bumpEntityKey(2966,"ChannelManager","processMqttMessages.dropped."+a.type)},_processMessages:function(a,c){b("ODS").bumpEntityKey(2231,"ChannelManager","_processMessages.cleanup");"tr"in a&&(n.trace_id=a.tr);a=a.ms;var d=n.seq-a.length;for(var e=0;e<a.length;e++,d++){n.estimatedReceived++;if(d>=c){var f=a[e];if(f.type){b("ODS").bumpEntityKey(2966,"ChannelManager","messageReceive."+f.type);if(b("DesktopWebMessageTypesSitevarConfig").ChatProxySupportedMessageTypes.get(f.type)!==!0){b("ODS").bumpEntityKey(2966,"ChannelManager","processMessages.dropped."+f.type);continue}var g=b("ChannelConstants").getArbiterType(f.type);f.type==="skywalker"?g=b("ChannelConstants").SKYWALKER:f.type==="delta"&&(n.sequenceId=f.iseq);try{f.type=="buddylist_overlay"&&f.buffered==1?b("ODS").bumpEntityKey(2966,"ChannelManager","processMessages.buddylist_overlay.dropped"):b("DesktopWebMessageTypesSitevarConfig").MQTTMigrationExcludeMessageTypes.get(f.type)!==!0?f.type==="rtc_live_json"?b("Arbiter").inform(g,{obj:f}):b("ODS").bumpEntityKey(2966,"ChannelManager","processMessages.migration.list."+f.type):b("Arbiter").inform(g,{obj:f})}catch(a){b("ODS").bumpEntityKey(2966,"ChannelManager","processMessages.error."+f.type),b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"message threw exception: %s %s",a,f)}}}else j.warn("seq_regression",JSON.stringify({last_seq:c,messages:a.length,seq:d}))}},_enter_init:function(){var a=this;b("ODS").bumpEntityKey(2231,"ChannelManager","_enter_init.cleanup");if(p.init>=this.getConfig("MAX_INIT_FAILS",2))return b("setTimeoutAcrossTransitions")(function(){return a.exitState({status:b("ChannelConstants").ERROR_MAX,stateId:o})},0);this._initTimer=b("setTimeoutAcrossTransitions")(function(){return a.exitState({status:b("ChannelConstants").ERROR,stateId:o},"timeout")},n.IFRAME_LOAD_TIMEOUT)},_enter_reconnect:function(a){var c=this;b("ODS").bumpEntityKey(2231,"ChannelManager","_enter_reconnect.cleanup");j.warn("enter_reconnect",a);b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"entered reconnect with reason: %s",a);var d=o;if(!b("PresenceUtil").hasUserCookie()){b("FantailLogger").warn(b("ChannelConstants").FANTAIL_SERVICE,"user has no cookie???");j.warn("no_user_cookie","{}");b("setTimeoutAcrossTransitions")(function(){c._shutdownHint=b("ChannelConstants").HINT_AUTH,c.exitState({status:b("ChannelConstants").ERROR_SHUTDOWN,stateId:d})},0);return}a={reason:a,fb_dtsg:b("DTSG").getToken()};b("ISB").token&&(a.fb_isb=b("ISB").token);var e=new(b("FBAjaxRequest"))("GET","/ajax/presence/reconnect.php",a);e.onSuccess=function(){c.configure(e.json),b("PresenceCookieManager").store(),c.exitState({status:b("ChannelConstants").OK,stateId:d})};e.onError=function(){var a=e.json&&e.json.error;b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"reconnect error: %s",e.errorType);(e.errorType==b("AjaxError").TRANSPORT_ERROR||e.errorType==b("AjaxError").PROXY_ERROR||e.errorType==b("AjaxError").SERVICE_UNAVAILABLE)&&(c._shutdownHint=b("ChannelConstants").HINT_CONN);a&&a==1356007?c._shutdownHint=b("ChannelConstants").HINT_MAINT:a==1357001||a==1357004||a==1348009?c._shutdownHint=b("ChannelConstants").HINT_AUTH:c._shutdownHint=null;c.exitState({status:c._shutdownHint?b("ChannelConstants").ERROR_SHUTDOWN:b("ChannelConstants").ERROR,stateId:d},e)};e.onSuccess()},_exit_init:function(a){b("ODS").bumpEntityKey(2231,"ChannelManager","_exit_init.cleanup"),this._initTimer&&(this._initTimer=b("clearTimeout")(this._initTimer)),a==b("ChannelConstants").ERROR_MAX&&this._sendIframeError(b("ChannelConstants").reason_IFrameLoadGiveUp)},_reportProxyMisguidedMsg:function(a,c){b("ODS").bumpEntityKey(2231,"ChannelManager","_reportProxyMisguidedMsg.cleanup");b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"misguided message to %s meant for %s",c,a);var d=Date.now();if(d-this.lastReportOnMisguidedMsgTime<=n.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=d;d={received_uid:a,expected_uid:c};n.sticky_token&&(d.sticky_token=n.sticky_token);a=new(h||(h=b("URI")))("/err_misguided_msg").setDomain(n.host+"."+n.domain).setPort(n.port).setSecure(new h(window.location.href).isSecure()).setQueryData(d);c=new(b("AjaxRequest"))("GET",a);b("AjaxRequest").supportsCORS()&&(c.xhr.withCredentials=!0);c.onSuccess=function(a){};c.onError=function(a){};c.onJSON=function(a){};c.send()},_initMonitors:function(){var a=this,c;b("ODS").bumpEntityKey(2231,"ChannelManager","_initMonitors.cleanup");var d=Date.now(),e=Date.now(),f={};f.total=0;var g="idle",h=!1;(c=b("SystemEvents")).subscribe([c.USER,c.ONLINE,c.TIME_TRAVEL],function(c,d){u(!0);e=null;a.lastPullTime=Date.now();var f;switch(c){case b("SystemEvents").USER:f=b("SystemEvents").isPageOwner()?b("ChannelConstants").SYS_OWNER:b("ChannelConstants").SYS_NONOWNER;break;case b("SystemEvents").ONLINE:f=d?b("ChannelConstants").SYS_ONLINE:b("ChannelConstants").SYS_OFFLINE;break;case b("SystemEvents").TIME_TRAVEL:if(n.skipTimeTravel)return;if(0<d){b("FantailLogger").warn(b("ChannelConstants").FANTAIL_SERVICE,"skipping time travel failure. %s",d);return}f=b("ChannelConstants").SYS_TIMETRAVEL;break}a.exitState({status:f,stateId:o})});c=function(a,c){var h=Date.now(),i=null;c?(d=h,i=c.nextState||c.state):i=g;b("SystemEvents").checkTimeTravel();if(e){c=Math.round((h-e)/1e3);c>0&&(f[g]=(f[g]||0)+c,f.total+=c)}g=i;e=h;a||(f.lastSuccessTime=r(),f.online=b("SystemEvents").isOnline(),j.log("rollup",JSON.stringify(f)))};b("Arbiter").subscribe(b("ChannelConstants").ON_ENTER_STATE,c);b("setIntervalAcrossTransitions")(c,6e4);c=function(){if(a.isShutdown()||a.shouldIdle())return;b("SystemEvents").checkTimeTravel();var c=Date.now()-(a.lastPullTime||(i||(i=b("Env"))).start);if(!h&&c>n.STALL_THRESHOLD){var e=r();j.error("stall",JSON.stringify({lastSuccessTime:e,rollupState:g}));b("ChatReliabilityInstrumentation").logCHANNEL_STALLED(c.toString());h=!0}e=Date.now()-(d||0);a.state=="pull"&&e>n.JUMPSTART_THRESHOLD&&(d=null,j.warn("jumpstart",JSON.stringify({state:a.state,dormant:e})),b("Arbiter").inform(b("ChannelConstants").JUMPSTART,e),a.enterState("init"))};b("setIntervalAcrossTransitions")(c,5e3)},_indicateLbInfoUpdated:function(a,c){b("ODS").bumpEntityKey(2231,"ChannelManager","_indicateLbInfoUpdated.cleanup");var d=!b("AjaxRequest").supportsCORS(),e=b("ChannelTransport").isSubdomain(n.subdomain);!e||d?n.fullHost=n.host:n.fullHost=n.subdomain+"-"+n.host;b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"received lb info: %s at seq: %s{%s} with ".concat("sticky: %s/%s, subdomain: %s, fullHost: %s, state: %s,").concat(" source: %s, args: %s"),n.sessionID,n.seq,n.sequenceId,n.sticky_token,n.sticky_pool,n.subdomain,n.fullHost,this.state,a,c)},_probeTest:function(){b("ODS").bumpEntityKey(2231,"ChannelManager","_probeTest.cleanup");n.streamingCapable=!1;var a=[],c={mode:"stream",format:"json"};n.sticky_token&&(c.sticky_token=n.sticky_token);c=new(h||(h=b("URI")))("/probe").setDomain(n.fullHost+"."+n.domain).setPort(n.port).setSecure(new h(window.location.href).isSecure()).setQueryData(c);b("ODS").bumpEntityKey(2966,"ChannelManager","probe.attempt");c=new(b("AjaxRequest"))("GET",c);c.onJSON=function(c,d){if(c&&c.json&&c.json.t==="heartbeat"){a.push(Date.now());if(a.length>=2){d=a[1]-a[0];d>=n.PROBE_HEARTBEATS_INTERVAL_LOW&&d<=n.PROBE_HEARTBEATS_INTERVAL_HIGH?(n.streamingCapable=!0,b("ODS").bumpEntityKey(2966,"ChannelManager","probe.switch_to_streaming"),j.log("switch_to_streaming","{}")):b("ODS").bumpEntityKey(2966,"ChannelManager","probe.failure.delayed")}}};c.onSuccess=function(c){a.length!=2&&(n.streamingCapable=!1,b("ODS").bumpEntityKey(2966,"ChannelManager","probe.failure.data_loss"),j.error("probe_error",JSON.stringify({error:"beats.length = "+a.length}))),b("ODS").bumpEntityKey(2966,"ChannelManager","probe.success"),j.log("probe_success","{}")};c.onError=function(a){n.streamingCapable=!1,b("ODS").bumpEntityKey(2966,"ChannelManager","probe.failure.error"),j.error("probe_error",JSON.stringify(a))};c.send()},_sseProbeTest:function(){b("ODS").bumpEntityKey(2231,"ChannelManager","_sseProbeTest.cleanup");if(!window.EventSource){b("ODS").bumpEntityKey(2966,"ChannelManager","sse_probe.failure.no_event_source");j.log("sse_probe.failure.no_event_source","{}");return}var a=[],c={mode:"sse",format:"json"};n.sticky_token&&(c.sticky_token=n.sticky_token);c=new(h||(h=b("URI")))("/sse_probe").setDomain(n.fullHost+"."+n.domain).setPort(n.port).setSecure(new h(window.location.href).isSecure()).setQueryData(c);b("ODS").bumpEntityKey(2966,"ChannelManager","sse_probe.attempt");var d=new EventSource(c.toString()),e=b("setTimeoutAcrossTransitions")(function(){d.close(),b("ODS").bumpEntityKey(2966,"ChannelManager","sse_probe.failure.timeout"),j.log("sse_probe.failure.timeout","{}")},n.PROBE_HEARTBEATS_INTERVAL_HIGH*6);d.addEventListener("heartbeat",function(c){a.push(Date.now());if(a.length>=2){c=a[1]-a[0];c>=n.PROBE_HEARTBEATS_INTERVAL_LOW&&c<=n.PROBE_HEARTBEATS_INTERVAL_HIGH?(b("ODS").bumpEntityKey(2966,"ChannelManager","sse_probe.success"),j.log("sse_probe.success","{}")):(b("ODS").bumpEntityKey(2966,"ChannelManager","sse_probe.failure.delayed"),j.log("sse_probe.failure.delayed","{}"));b("clearTimeout")(e);d.close()}});d.onerror=function(a){b("ODS").bumpEntityKey(2966,"ChannelManager","sse_probe.failure.error"),j.error("sse_probe.failure.error",JSON.stringify(a)),b("clearTimeout")(e),d.close()}},startChannelManagerForApp:function(a){b("ODS").bumpEntityKey(2231,"ChannelManager","startChannelManagerForApp.cleanup"),this.startChannelManager!==b("emptyFunction")&&this.startChannelManager(),b("ChannelInitialData").channelConfig&&n&&(n.profile=a)},startChannelManager:function(){b("ODS").bumpEntityKey(2231,"ChannelManager","startChannelManager.cleanup"),b("ChannelInitialData").channelConfig?(this.configure(b("ChannelInitialData").channelConfig),/shutdown/.test(b("ChannelInitialData").state)&&(this._shutdownHint=b("ChannelConstants")[b("ChannelInitialData").reason]),this.init(b("ChannelInitialData").state,b("ChannelInitialData").reason),this._mqttInit(),b("ChatReliabilityInstrumentation").logCHANNEL_INIT(),this.startChannelManager=b("emptyFunction")):b("ChatReliabilityInstrumentation").logCHANNEL_NOCONFIG()}};e.exports=a}),null);
__d("AvailableListConstants",[],(function(a,b,c,d,e,f){a=Object.freeze({ON_AVAILABILITY_CHANGED:"buddylist/availability-changed",ON_UPDATE_ERROR:"buddylist/update-error",ON_UPDATED:"buddylist/updated",ON_CHAT_NOTIFICATION_CHANGED:"chat-notification-changed",OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,WEB_STATUS:"webStatus",FB_APP_STATUS:"fbAppStatus",MESSENGER_STATUS:"messengerStatus",OTHER_STATUS:"otherStatus",STATUS_ACTIVE:"active",STATUS_IDLE:"idle",STATUS_OFFLINE:"offline"});f["default"]=a}),66);
__d("LastActiveTimes",["fbt","ServerTime"],(function(a,b,c,d,e,f,g,h){var i={};function j(a){if(!a||a<0)return null;a=d("ServerTime").get()/1e3-a;a=Math.floor(a/60);var b=Math.floor(a/60),c=Math.floor(b/24);if(a<=1)return h._({"*":"{count} min"},[h._param("count",1,[0])]);else if(a<60)return h._({"*":"{count} min"},[h._param("count",a,[0])]);else if(b<24)return h._({"*":"{count}h"},[h._param("count",b,[0])]);else if(c<3)return h._({"*":"{count}d"},[h._param("count",c,[0])]);else return null}function k(a,b){(!(a in i)||i[a]<b)&&(i[a]=b)}function l(a){if(a in i)return i[a];else return 0}function a(a){for(var b in a)k(b,a[b])}function b(a){return j(l(a))}function c(a){return l(a)}function e(){return i}g.update=a;g.getShortDisplay=b;g.get=c;g.getDebugData=e}),98);
__d("PresenceStatus",["ArbiterMixin","AvailableListConstants","AvailableListInitialData","Bootloader","ChatVisibility","CurrentUser","FBIDCheck","FBLogger","LastActiveTimes","ODS","PresenceConfig","PresencePrivacy","ServerTime","createObjectFrom","debounceAcrossTransitions","gkx"],(function(a,b,c,d,e,f,g){d("ODS").setEntitySample("presence",1e-4);var h={},i={},j={},k={},l=babelHelpers["extends"]({},d("ArbiterMixin")),m=c("debounceAcrossTransitions")(function(){return l.inform("change")},0);function n(a){var b,e=parseInt(a.topic.match(/\d+$/),10);a=parseInt(JSON.parse(a.payload).lat,10);var f=Date.now()-a*1e3;f=d("PresenceConfig").get("active_cutoff")*1e3-f;d("LastActiveTimes").update((b={},b[e]=a,b));l.checkPresence(e);l.get(e)===c("AvailableListConstants").ACTIVE&&(window.clearTimeout(k[e].timeout),k[e].timeout=window.setTimeout(function(){l.checkPresence(e)},f))}function o(a){return/^\d+$/.test(a)}Object.assign(l,{resetPresenceData:function(){h={},i={}},reset:function(){l.resetPresenceData(),j={}},get:function(a){!o(a)&&d("PresenceConfig").get("presence_throw_for_malformed_id")&&c("FBLogger")("presence").warn("received malformed id '%s'",a);if(a==c("CurrentUser").getID())return d("ChatVisibility").isOnline()?c("AvailableListConstants").ACTIVE:c("AvailableListConstants").OFFLINE;o(a)&&!d("FBIDCheck").isUser_deprecated(a)&&!k[a]&&(d("ODS").bumpEntityKey(3303,"presence","page_subscribe"),k[a]={},d("PresenceConfig").get("presence_page_green_dot_sub")&&c("Bootloader").loadModules(["SkywalkerManager"],function(b){return b.subscribe("presence_push/fb/"+a,n)},"PresenceStatus"));var b=c("AvailableListConstants").OFFLINE;a in h&&(b=h[a]);c("PresencePrivacy").allows(a)||(b=c("AvailableListConstants").OFFLINE);return b},getCapabilities:function(a){a=i[a];return a?a:0},isPlayingCanvasGameUser:function(a){return!!j[a]},getGroup:function(a){return a.some(function(a){return a==c("CurrentUser").getID()?!1:l.get(a)===c("AvailableListConstants").ACTIVE})?c("AvailableListConstants").ACTIVE:c("AvailableListConstants").OFFLINE},set:function(a,b,e,f,g,j){if(a==c("CurrentUser").getID())return!1;var k;if(b!==null&&b!==void 0){b=b==c("AvailableListConstants").ACTIVE?c("AvailableListConstants").ACTIVE:c("AvailableListConstants").OFFLINE;e=l.get(a);k=e!=b;if((k||b==c("AvailableListConstants").ACTIVE)&&d("FBIDCheck").isUser_deprecated(a)){d("LastActiveTimes").update((f={},f[a]=d("ServerTime").get()/1e3,f))}h[a]=b}e=!1;g!==void 0&&g!==null&&(e=l.getCapabilities(a)!=g,i[a]=g);f=k||e;f&&!j&&m();return f},setPlayingCanvasGameFriends:function(a){if(!c("gkx")("678262"))return;j=c("createObjectFrom")(a)},getOnlineIDs:function(){var a,b=[];for(a in h)l.get(a)===c("AvailableListConstants").ACTIVE&&b.push(a);return b},getAllIDs:function(){return Object.keys(h)},getOnlineCount:function(){return l.getOnlineIDs().length},getPresenceStats:function(){var a=0,b=0,d=0;for(var e in h){a+=1;switch(l.get(e)){case c("AvailableListConstants").OFFLINE:b+=1;break;case c("AvailableListConstants").ACTIVE:d+=1;break;default:break}}return{total:a,offline:b,active:d}},getAllDebugInfo:function(){var a={};for(var b in h)a[b]={p:h[b],vc:i[b]};return a},setMultiFromMQTT:function(a){var b={};Array.isArray(a)&&a.forEach(function(a){a.l&&(b[a.u]=a.l),l.set(a.u,a.p,!1,"mqtt",a.c,!0)});d("LastActiveTimes").update(b);m()},setMultiChatproxy:function(a){var b={};for(var c in a){a[c].lat&&(b[c]=a[c].lat);var e=a[c].p;l.set(c,e,!1,"chatproxy",a[c].vc,!0)}d("LastActiveTimes").update(b);m()},setMultiActive:function(a,b){var d=!1;a.forEach(function(a){l.set(a,c("AvailableListConstants").ACTIVE,!1,b,null,!0)&&(d=!0)});d&&m()},checkPresence:function(a){var b=!1,e=Math.ceil(Date.now()/1e3)-d("LastActiveTimes").get(a);l.set(a,e<d("PresenceConfig").get("active_cutoff")?c("AvailableListConstants").ACTIVE:c("AvailableListConstants").OFFLINE,!1,"pylon",null,!0)&&(b=!0);b&&m()}});c("AvailableListInitialData").activeList&&c("AvailableListInitialData").activeList.length>0&&l.setMultiActive(c("AvailableListInitialData").activeList,"available_list_active");c("AvailableListInitialData").playingNow&&c("AvailableListInitialData").playingNow.length>0&&l.setPlayingCanvasGameFriends(c("AvailableListInitialData").playingNow);c("AvailableListInitialData").lastActiveTimes&&Object.keys(c("AvailableListInitialData").lastActiveTimes).length>0&&d("LastActiveTimes").update(c("AvailableListInitialData").lastActiveTimes);a=l;g["default"]=a}),98);
__d("BaseContainerQueryElement.react",["react","stylex"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react"),i={root:{boxSizing:"rq0escxv",flexShrink:"pfnyh3mw",position:"l9j0dhe7"}};function a(a,b){var d=a.breakpoint,e=a.inverseToContainer;e=e===void 0?!1:e;var f=a.maxWidth,g=a.minWidth,j=a.xstyle;a=babelHelpers.objectWithoutPropertiesLoose(a,["breakpoint","inverseToContainer","maxWidth","minWidth","xstyle"]);return h.jsx("div",babelHelpers["extends"]({},a,{className:c("stylex")(i.root,j),ref:b,style:{maxWidth:f,minWidth:g,width:e?"calc(("+d+"px - 100%) * 9999)":"calc((100% - "+(d-.1)+"px) * 9999)"}}))}a.displayName=a.name+" [from "+f.id+"]";b=h.forwardRef(a);g["default"]=b}),98);
__d("Dots3HorizontalFilled24.svg.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){return h.jsxs("svg",babelHelpers["extends"]({viewBox:"0 0 24 24",width:"1em",height:"1em"},a,{children:[a.title!=null&&h.jsx("title",{children:a.title}),a.children!=null&&h.jsx("defs",{children:a.children}),h.jsx("circle",{cx:12,cy:12,r:2.5}),h.jsx("circle",{cx:19.5,cy:12,r:2.5}),h.jsx("circle",{cx:4.5,cy:12,r:2.5})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("CometOverlappingFacepile.react",["fbt","BaseContainerQueryElement.react","CometComponentWithKeyCommands.react","CometIcon.react","CometKeys","CometPressable.react","CometProfilePhoto.react","CometTooltip.react","CometVisualCompletionAttributes","Dots3HorizontalFilled24.svg.react","FocusGroup.react","ReactDOMComet","SVGIcon","TetraText.react","focusScopeQueries","react","stylex","useCometUniqueID","useIntersectionObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("react");b=d("react");var j=b.useCallback,k=b.useRef,l=b.useState;e=d("FocusGroup.react").createFocusGroup(d("focusScopeQueries").tabbableScopeQuery);var m=e[0],n=e[1],o=-4,p={item:{marginBottom:"sej5wr8e",position:"l9j0dhe7"},itemWithSpacing:{marginStart:"rl04r1d5"},itemWithoutMargin:{position:"l9j0dhe7"},items:{display:"j83agx80",flexDirection:"btwxx1t3",flexShrink:"pfnyh3mw",flexWrap:"lhclo0ds",overflowX:"ni8dbmo4",overflowY:"stjgntxs",position:"l9j0dhe7"},overflow16:{height:"gl3lb2sf",width:"hhz5lgdu"},overflow16Child:{alignItems:"bp9cbjyn",display:"j83agx80",justifyContent:"taijpn5t",marginStart:"lq239pai"},overflow16Frame:{marginStart:"ggphbty4",overflowX:"ni8dbmo4",overflowY:"stjgntxs",width:"xthkpp0z"},overflow24:{height:"rgmg9uty",width:"b73ngqbp"},overflow32:{height:"k7cz35w2",width:"bsnbvmp4"},overflow36:{height:"tv7at329",width:"thwo4zme"},overflow40:{height:"qypqp5cg",width:"q676j6op"},overflow48:{height:"m7zwrmfr",width:"tmrshh9y"},overflowItem:{alignItems:"bp9cbjyn",borderTopStartRadius:"s45kfl79",borderTopEndRadius:"emlxlaya",borderBottomEndRadius:"bkmhp75w",borderBottomStartRadius:"spb7xbtv",display:"j83agx80",flexShrink:"pfnyh3mw",justifyContent:"taijpn5t",pointerEvents:"oqq733wu"},overflowItemBg:{fill:"lw8b5zex"},overflowItemContainer:{bottom:"i09qtzwb",boxSizing:"rq0escxv",end:"n7fi1qx3",position:"pmk7jnqg",start:"j9ispegn",top:"kr520xx4",display:"j83agx80",flexDirection:"btwxx1t3",pointerEvents:"hzruof5a"},overflowItemOverlay:{fill:"lw8b5zex",opacity:"b5wmifdl",transitionDuration:"c5ndavph",transitionProperty:"art1omkt",transitionTimingFunction:"ot9fgl3s"},overflowItemOverlayHovered:{fill:"geeicf24",opacity:"pedkr2u6",transitionDuration:"akwz6i9j"},overflowItemOverlayPressed:{fill:"jchep4xs",opacity:"pedkr2u6",transitionDuration:"akwz6i9j"},overflowItemSVG:{bottom:"i09qtzwb",end:"n7fi1qx3",position:"pmk7jnqg",start:"j9ispegn",top:"kr520xx4"},root:{display:"j83agx80",flexDirection:"cbu4d94t"},rootInline:{alignItems:"bp9cbjyn",flexDirection:"btwxx1t3"},text:{display:"j83agx80",flexDirection:"btwxx1t3",paddingTop:"pybr56ya"},textInline:{flexBasis:"rj1gh0hx",flexGrow:"buofh1pr",paddingStart:"b3onmgus",paddingTop:"jb3vyjys"},wrapper:{paddingEnd:"d1544ag0",paddingStart:"dati1w0a",paddingTop:"discj3wi"}},q={16:{minWidth:"a5nuqjux"},24:{minWidth:"alsk43pb"},32:{minWidth:"gl2wjlmp"},36:{minWidth:"jgsskzai"},40:{minWidth:"rjkj87ba"},48:{minWidth:"nhgh0rzy"}},r={center:{alignItems:"bp9cbjyn"},end:{alignItems:"aovydwv3"},start:{alignItems:"ll8tlv6m"}},s={center:{justifyContent:"taijpn5t"},end:{justifyContent:"bkfpd7mw"},start:{justifyContent:"jifvfom9"}};function a(a){var b=a.align;b=b===void 0?"start":b;var e=a.items,f=a.isOverlapping;f===void 0?!0:f;f=a.isTextInline;f=f===void 0?!1:f;var g=a.count,j=g===void 0?e.length:g;g=a.ellipsisTooltip;var l=a.linkProps,x=a.onPress,y=a.screenReaderLabel,z=a.size,A=a.testid;A=a.testOnly_pressed;var B=A===void 0?!1:A;A=a.text;var C=a.disableMarginOnItems,D=C===void 0?!1:C;C=a.withWrapper;var E=o,F=Math.min(j,e.length,f?3:Infinity),G=k(null);a=[{command:{key:c("CometKeys").LEFT},description:h._("Previous item"),handler:function(){}},{command:{key:c("CometKeys").RIGHT},description:h._("Next item"),handler:function(){}}];e=i.jsxs("div",babelHelpers["extends"]({className:c("stylex")(p.items),ref:G,role:"row",style:{height:z}},c("CometVisualCompletionAttributes").IGNORE_DYNAMIC,{children:[e.slice(0,F).map(function(a,b){var d=a.containerComponent,e=a.linkProps,f=a.onPress,g=a.testOnly_pressed;a=babelHelpers.objectWithoutPropertiesLoose(a,["containerComponent","linkProps","onPress","testOnly_pressed"]);return i.jsxs(i.Fragment,{children:[i.jsx(c("BaseContainerQueryElement.react"),{breakpoint:(b+1)*(z+E)-E,inverseToContainer:!0,maxWidth:"100%",minWidth:0}),i.jsx(t,babelHelpers["extends"]({},a,{Container:d,FocusItemComponent:y!=null?void 0:n,"aria-label":h._("Link to see everyone"),divClassName:c("stylex")(D?p.itemWithoutMargin:p.item,b>0&&p.itemWithSpacing),isOverlapped:b>0,linkProps:e,onPress:f,parentRef:G,role:"cell",shape:"circle",size:z,testOnly_pressed:g,testid:void 0}))]},b)}),i.jsxs("div",{className:c("stylex")(p.overflowItemContainer),children:[e.slice(0,Math.min(e.length,F<j?F:j)).map(function(a,b){return b===0&&j>1?null:i.jsx(c("BaseContainerQueryElement.react"),{breakpoint:(b+1)*(z+E)-E,maxWidth:b===j-1?"100%":z+E,minWidth:0},"overflowPusher"+b)}),i.jsx(v,{FocusItemComponent:y!=null?void 0:n,"aria-label":h._("Link to see everyone"),count:j,ellipsisTooltip:g,linkProps:l,onPress:x,overlayDisabled:!0,parentRef:G,size:z,spacing:E,testid:void 0,xstyle:[p.overflowItem,z===16&&p.overflow16,z===24&&p.overflow24,z===32&&p.overflow32,z===36&&p.overflow36,z===40&&p.overflow40,z===48&&p.overflow48],children:function(a){var b=a.hovered;a=a.pressed;return i.jsxs(i.Fragment,{children:[i.jsx(w,{hovered:b,isOverlapped:F>1,pressed:a||B,size:z}),z===16?i.jsx("div",{className:c("stylex")(p.overflow16Frame),children:i.jsx("div",{className:c("stylex")(p.overflow16Child),children:i.jsx(c("CometIcon.react"),{color:"white",icon:d("SVGIcon").svgIcon(c("Dots3HorizontalFilled24.svg.react")),size:u(z)})})}):i.jsx(c("CometIcon.react"),{color:"white",icon:d("SVGIcon").svgIcon(c("Dots3HorizontalFilled24.svg.react")),size:u(z)})]})}})]})]}));g=f?s:r;l=q[z];x=i.jsxs("div",{"aria-label":y,className:c("stylex")(p.root,f&&p.rootInline,g[b]),"data-testid":void 0,role:y==null?"grid":"img",children:[y!=null?i.jsx("div",{"aria-hidden":!0,className:c("stylex")(f&&F>=3&&l),children:e}):i.jsx(c("CometComponentWithKeyCommands.react"),{commandConfigs:a,xstyle:f&&F>=3&&l,children:i.jsx(m,{orientation:"horizontal",tabScopeQuery:d("focusScopeQueries").tabbableScopeQuery,wrap:!0,children:e})}),A!=null&&i.jsx("div",{"aria-hidden":y!=null?!0:void 0,className:c("stylex")(p.text,f&&p.textInline,g[b]),children:i.jsx(c("TetraText.react"),{color:"secondary",type:"body3",children:A})})]});return C?i.jsx("div",{className:c("stylex")(p.wrapper),children:x}):x}a.displayName=a.name+" [from "+f.id+"]";function t(a){var b=a.Container,e=a.FocusItemComponent,f=a.divClassName,g=a.parentRef,h=babelHelpers.objectWithoutPropertiesLoose(a,["Container","FocusItemComponent","divClassName","parentRef"]);a=l(!1);var k=a[0],m=a[1];a=j(function(a){var b=a.intersectionRatio;d("ReactDOMComet").flushSync(function(){m(b<.5)})},[]);a=c("useIntersectionObserver")(a,{root:function(){var a;return(a=g.current)!=null?a:null},threshold:.5});b=b?i.jsx(b,{children:function(a){return i.jsx(c("CometProfilePhoto.react"),babelHelpers["extends"]({},h,{overlayDisabled:!0,ref:a}))}}):i.jsx(c("CometProfilePhoto.react"),babelHelpers["extends"]({},h,{overlayDisabled:!0}));return i.jsx("div",{className:f,ref:a,role:"cell",children:e!=null?i.jsx(e,{disabled:k,children:b}):b})}t.displayName=t.name+" [from "+f.id+"]";function u(a){switch(a){case 36:case 32:return 16;case 40:case 48:return 24;default:return 12}}function v(a){var b=a.FocusItemComponent;a.count;var e=a.ellipsisTooltip,f=a.parentRef,g=a.size,h=a.spacing;a=babelHelpers.objectWithoutPropertiesLoose(a,["FocusItemComponent","count","ellipsisTooltip","parentRef","size","spacing"]);var k=l(!1),m=k[0],n=k[1];k=l(null);var o=k[0],p=k[1];k=j(function(a){var b=a.intersectionRatio;d("ReactDOMComet").flushSync(function(){n(b<.5)})},[]);k=c("useIntersectionObserver")(k,{root:function(){var a;return(a=f.current)!=null?a:null},threshold:.5});var q=function(a){if(!a)return;a=f.current;if(!a)return;a=a.getBoundingClientRect();a=a.width;a=Math.floor((a+h)/(g+h));p(a-1)};a=i.jsx(c("CometPressable.react"),babelHelpers["extends"]({},a,{ref:k,role:"cell"}));e&&(a=i.jsx(c("CometTooltip.react"),{align:"middle",onVisibilityChange:q,position:"below",tooltip:o!=null?e(o):"",children:a}));return b!=null?i.jsxs(b,{disabled:m,children:[" ",a," "]}):a}v.displayName=v.name+" [from "+f.id+"]";function w(a){var b=a.hovered,d=a.isOverlapped,e=a.pressed;a=a.size;var f=c("useCometUniqueID")();return i.jsxs("svg",{className:c("stylex")(p.overflowItemSVG),height:a,viewBox:"0 0 "+a+" "+a,width:a,children:[d&&i.jsxs("mask",{id:f,suppressHydrationWarning:!0,children:[i.jsx("circle",{cx:a/2,cy:a/2,fill:"white",r:a/2}),i.jsx("circle",{cx:-a/2+4,cy:a/2,fill:"black",r:a/2+2})]}),i.jsx("circle",babelHelpers["extends"]({className:c("stylex")(p.overflowItemBg),cx:a/2,cy:a/2,r:a/2,role:"cell",suppressHydrationWarning:!0},d?{mask:"url(#"+f+")"}:null)),i.jsx("circle",babelHelpers["extends"]({className:c("stylex")(p.overflowItemOverlay,b&&p.overflowItemOverlayHovered,e&&p.overflowItemOverlayPressed),cx:a/2,cy:a/2,r:a/2,role:"cell",suppressHydrationWarning:!0},d?{mask:"url(#"+f+")"}:null))]})}w.displayName=w.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWChatDeleteMessageEventEmitter",["BaseEventEmitter"],(function(a,b,c,d,e,f,g){"use strict";var h="deleteMessage",i=new(c("BaseEventEmitter"))();function a(a){i.emit(h,a)}function b(a){var b=i.addListener(h,a);return function(){return b.remove()}}g.emit=a;g.subscribe=b}),98);
__d("bs_caml_array",[],(function(a,b,c,d,e,f){"use strict";function a(b,c,a){var d=new Array(a),e=0;c=c;while(e<a)d[e]=b[c],e=e+1|0,c=c+1|0;return d}function g(a,b){while(!0){var c=b,d=a;if(!c)return d;b=c.tl;a=c.hd.length+d|0;continue}}function h(a,b,c){while(!0){var d=c,e=b;if(!d)return;var f=d.hd,g=f.length;e=e;var h=0;while(h<g)a[e]=f[h],e=e+1|0,h=h+1|0;c=d.tl;b=e;continue}}function b(a){var b=g(0,a);b=new Array(b);h(b,0,a);return b}function c(a,b,c){if(b<0||b>=a.length)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error()};a[b]=c}function d(a,b){if(b<0||b>=a.length)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error()};return a[b]}function e(a,b){var c=new Array(a);for(var d=0;d<a;++d)c[d]=b;return c}function i(a){var b=new Array(a);for(var c=0;c<a;++c)b[c]=0;return b}function j(b,c,d,e,a){if(e<=c){for(var f=0;f<a;++f)d[f+e|0]=b[f+c|0];return}for(var f=a-1|0;f>=0;--f)d[f+e|0]=b[f+c|0]}function k(a){return a.slice(0)}f.dup=k;f.sub=a;f.concat=b;f.make=e;f.make_float=i;f.blit=j;f.get=d;f.set=c}),null);
__d("bs_curry",["bs_caml_array"],(function(a,b,c,d,e,f){"use strict";function g(a,c){while(!0){var d=c,e=a,f=e.length;f=f===0?1:f;var h=d.length;h=f-h|0;if(h===0)return e.apply(null,d);if(h>=0)return function(b,a){return function(c){return g(b,a.concat([c]))}}(e,d);c=b("bs_caml_array").sub(d,f,-h|0);a=e.apply(null,b("bs_caml_array").sub(d,0,f));continue}}function h(a,b){var c=a.length;if(c===1)return a(b);else switch(c){case 1:return a(b);case 2:return function(c){return a(b,c)};case 3:return function(c,d){return a(b,c,d)};case 4:return function(c,d,e){return a(b,c,d,e)};case 5:return function(c,d,e,f){return a(b,c,d,e,f)};case 6:return function(c,d,e,f,g){return a(b,c,d,e,f,g)};case 7:return function(c,d,e,f,g,h){return a(b,c,d,e,f,g,h)};default:return g(a,[b])}}function a(a){var b=a.length;if(b===1)return a;else return function(b){return h(a,b)}}function i(a,b,c){var d=a.length;if(d===2)return a(b,c);else switch(d){case 1:return g(a(b),[c]);case 2:return a(b,c);case 3:return function(d){return a(b,c,d)};case 4:return function(d,e){return a(b,c,d,e)};case 5:return function(d,e,f){return a(b,c,d,e,f)};case 6:return function(d,e,f,g){return a(b,c,d,e,f,g)};case 7:return function(d,e,f,g,h){return a(b,c,d,e,f,g,h)};default:return g(a,[b,c])}}function c(a){var b=a.length;if(b===2)return a;else return function(b,c){return i(a,b,c)}}function j(a,b,c,d){var e=a.length;if(e===3)return a(b,c,d);else switch(e){case 1:return g(a(b),[c,d]);case 2:return g(a(b,c),[d]);case 3:return a(b,c,d);case 4:return function(e){return a(b,c,d,e)};case 5:return function(e,f){return a(b,c,d,e,f)};case 6:return function(e,f,g){return a(b,c,d,e,f,g)};case 7:return function(e,f,g,h){return a(b,c,d,e,f,g,h)};default:return g(a,[b,c,d])}}function d(a){var b=a.length;if(b===3)return a;else return function(b,c,d){return j(a,b,c,d)}}function k(a,b,c,d,e){var f=a.length;if(f===4)return a(b,c,d,e);else switch(f){case 1:return g(a(b),[c,d,e]);case 2:return g(a(b,c),[d,e]);case 3:return g(a(b,c,d),[e]);case 4:return a(b,c,d,e);case 5:return function(f){return a(b,c,d,e,f)};case 6:return function(f,g){return a(b,c,d,e,f,g)};case 7:return function(f,g,h){return a(b,c,d,e,f,g,h)};default:return g(a,[b,c,d,e])}}function e(a){var b=a.length;if(b===4)return a;else return function(b,c,d,e){return k(a,b,c,d,e)}}function l(a,b,c,d,e,f){var h=a.length;if(h===5)return a(b,c,d,e,f);else switch(h){case 1:return g(a(b),[c,d,e,f]);case 2:return g(a(b,c),[d,e,f]);case 3:return g(a(b,c,d),[e,f]);case 4:return g(a(b,c,d,e),[f]);case 5:return a(b,c,d,e,f);case 6:return function(g){return a(b,c,d,e,f,g)};case 7:return function(g,h){return a(b,c,d,e,f,g,h)};default:return g(a,[b,c,d,e,f])}}function m(a){var b=a.length;if(b===5)return a;else return function(b,c,d,e,f){return l(a,b,c,d,e,f)}}function n(a,b,c,d,e,f,h){var i=a.length;if(i===6)return a(b,c,d,e,f,h);else switch(i){case 1:return g(a(b),[c,d,e,f,h]);case 2:return g(a(b,c),[d,e,f,h]);case 3:return g(a(b,c,d),[e,f,h]);case 4:return g(a(b,c,d,e),[f,h]);case 5:return g(a(b,c,d,e,f),[h]);case 6:return a(b,c,d,e,f,h);case 7:return function(g){return a(b,c,d,e,f,h,g)};default:return g(a,[b,c,d,e,f,h])}}function o(a){var b=a.length;if(b===6)return a;else return function(b,c,d,e,f,g){return n(a,b,c,d,e,f,g)}}function p(a,b,c,d,e,f,h,i){var j=a.length;if(j===7)return a(b,c,d,e,f,h,i);else switch(j){case 1:return g(a(b),[c,d,e,f,h,i]);case 2:return g(a(b,c),[d,e,f,h,i]);case 3:return g(a(b,c,d),[e,f,h,i]);case 4:return g(a(b,c,d,e),[f,h,i]);case 5:return g(a(b,c,d,e,f),[h,i]);case 6:return g(a(b,c,d,e,f,h),[i]);case 7:return a(b,c,d,e,f,h,i);default:return g(a,[b,c,d,e,f,h,i])}}function q(a){var b=a.length;if(b===7)return a;else return function(b,c,d,e,f,g,h){return p(a,b,c,d,e,f,g,h)}}function r(a,b,c,d,e,f,h,i,j){var k=a.length;if(k===8)return a(b,c,d,e,f,h,i,j);else switch(k){case 1:return g(a(b),[c,d,e,f,h,i,j]);case 2:return g(a(b,c),[d,e,f,h,i,j]);case 3:return g(a(b,c,d),[e,f,h,i,j]);case 4:return g(a(b,c,d,e),[f,h,i,j]);case 5:return g(a(b,c,d,e,f),[h,i,j]);case 6:return g(a(b,c,d,e,f,h),[i,j]);case 7:return g(a(b,c,d,e,f,h,i),[j]);default:return g(a,[b,c,d,e,f,h,i,j])}}function s(a){var b=a.length;if(b===8)return a;else return function(b,c,d,e,f,g,h,i){return r(a,b,c,d,e,f,g,h,i)}}f.app=g;f._1=h;f.__1=a;f._2=i;f.__2=c;f._3=j;f.__3=d;f._4=k;f.__4=e;f._5=l;f.__5=m;f._6=n;f.__6=o;f._7=p;f.__7=q;f._8=r;f.__8=s}),null);
__d("bs_belt_Id",["bs_curry"],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function c(a){a=a.cmp;a=b("bs_curry").__2(a);return{cmp:a}}function d(a){return{cmp:a}}function e(a){a=b("bs_curry").__2(a);return{cmp:a}}function g(a){return a}function h(a){var c=a.hash;c=b("bs_curry").__1(c);a=a.eq;a=b("bs_curry").__2(a);return{hash:c,eq:a}}function i(a,b){return{hash:a,eq:b}}function j(a,c){a=b("bs_curry").__1(a);c=b("bs_curry").__2(c);return{hash:a,eq:c}}f.MakeComparableU=a;f.MakeComparable=c;f.comparableU=d;f.comparable=e;f.MakeHashableU=g;f.MakeHashable=h;f.hashableU=i;f.hashable=j}),null);
__d("FBID.bs",["bs_belt_Id"],(function(a,b,c,d,e,f){"use strict";function a(a,b){return b.localeCompare(a)|0}e=b("bs_belt_Id").MakeComparable({cmp:a});function c(a){return a}function d(a){return a}b=e.cmp;f.cmp=b;f.compare=a;f.ofString=d;f.ofStringExn=c}),null);
__d("MessengerObjectAssociationType",["keyMirror"],(function(a,b,c,d,e,f,g){"use strict";a=c("keyMirror")({REGULAR_CHAT:null,GENERAL_CHAT:null});g["default"]=a}),98);
__d("FBRTCCallConstants",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({FBRTCCallConnectionType:{MISSED_CALL:4,CONNECTED_CALL:5},FBRTCCallType:{VOICE_CALL:1,VIDEO_CALL:2,COLLAB_VIDEO_CALL:3,COLLAB_SCREEN_SHARE_CALL:4}})}),null);
__d("XVideoCallAdminMessageController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/admin_msg/",{})}),null);
__d("ScotchFBRTCAdminMessage",["FBRTCCallConstants","ScotchConstants","ScotchFBRTCUtils","ScotchRTCLogger","ScotchRTWebUserActionLogger","XVideoCallAdminMessageController","emptyFunction","performanceNow"],(function(a,b,c,d,e,f,g){a=function(){function a(a,b){this.$1=a,this.$2=b,this.$3=Date.now(),this.$4=null,this.$5=null}var b=a.prototype;b.getPeerID=function(){return this.$1};b.getCallID=function(){return this.$2};b.getStartTimestamp=function(){return this.$3};b.getConnectedTime=function(){return this.$4};b.getEndTime=function(){return this.$5};b.onCallConnected=function(){this.$4||(this.$4=c("performanceNow")())};b.onCallEnded=function(){this.$5||(this.$5=c("performanceNow")())};b.submit=function(a,b,e){this.$5||this.onCallEnded();var f=0,g=c("FBRTCCallConstants").FBRTCCallConnectionType.MISSED_CALL;this.$4&&this.$5&&(f=Math.ceil(this.$5-this.$4),g=c("FBRTCCallConstants").FBRTCCallConnectionType.CONNECTED_CALL);b=g===c("FBRTCCallConstants").FBRTCCallConnectionType.CONNECTED_CALL||b===d("ScotchConstants").CallEndReason.IGNORE_CALL;c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"admin_message_"+g});this.$6({peer_id:this.$1,call_id:this.$2,start_time:this.$3,call_duration:f,message_type:g,call_category:a,call_acknowledged:b,conference_name:e})};b.$6=function(a){var b=c("XVideoCallAdminMessageController").getURIBuilder().getURI();d("ScotchFBRTCUtils").sendServerRequest(b,c("emptyFunction"),this.$7.bind(this,a.peer_id,a.call_id),!1,void 0,a)};b.$7=function(a,b,d){d?d="Fail to log admin message, error "+d.error:d="Server timed out on logging admin message";c("ScotchRTCLogger").getInstance().logError(a,b,d)};return a}();g["default"]=a}),98);
__d("ScotchFBRTCIceStatsParser",[],(function(a,b,c,d,e,f){var g=null;a=function(){function a(){}a.getInstance=function(){g||(g=new a());return g};var b=a.prototype;b.extractIceInfo=function(a){var b=[];a=a.split("\r\n");for(var c=0;c<a.length;c++){var d=a[c];this.$1(d)&&b.push({gen:this.$2(d),type:this.$3(d)})}return b};b.$1=function(a){return a.indexOf("candidate:")>-1};b.$2=function(a){var b=0;a=a.match(/generation (\d+)/);a&&(b=parseInt(a[1],10));return b};b.$3=function(a){a=a.match(/typ (host|relay|srflx|prflx)/);if(a)return a[1];else return"unknown"};return a}();f["default"]=a}),66);
__d("ScotchFBRTCMediaMetricTracker",["performanceNow"],(function(a,b,c,d,e,f,g){"use strict";var h={count:0,current:-1,first:-1,min:-1,max:-1,mean:-1,median:-1,startedTime:-1,total:-1,updatedTime:-1};a=function(){function a(){this.$2={},this.$3={},this.$4={},this.$1={},this.$5=null}var b=a.prototype;b.getVideoStreamReportKeys=function(){return Object.keys(this.$4)};b.getJitterStreamReportKey=function(){return Object.keys(this.$2)};b.getAudioStreamReportKeys=function(){return Object.keys(this.$3)};b.addJitterBufferDelay=function(a,b){b!==null&&b!==void 0&&(this.$2[a]||(this.$2[a]=[]),this.$2[a].push(b))};b.setHistResScale=function(a,b,c){this.$1[a]||(this.$1[a]={contentType:b,histogram:[]}),this.$1[a]={contentType:b,histogram:c}};b.getHistResScale=function(a){return this.$1[a]?{contentType:this.$1[a].contentType,histogram:this.$1[a].histogram}:null};b.setVideoContentType=function(a,b){this.$4[a]||(this.$4[a]={}),this.$4[a].contentType=b};b.getVideoContentType=function(a){return this.$4[a].contentType};b.setVideoMetric=function(a,b,c){c!==null&&c!==void 0&&(this.$4[a]||(this.$4[a]={}),this.$4[a][b]=this.$6(this.$4[a][b],c))};b.$6=function(a,b){if(a!==null&&a!==void 0){a.current=b;a.updatedTime=c("performanceNow")();a.total+=b;a.count+=1;a.min=Math.min(a.min,b);a.max=Math.max(a.max,b);a.mean=a.total/a.count;return a}else return{min:b,max:b,total:b,count:1,mean:b,first:b,startedTime:c("performanceNow")(),current:b,updatedTime:c("performanceNow")()}};b.getVideoStreamDuration=function(a,b){return this.$4[a]!=null&&this.$4[a][b]!=null?this.$4[a][b].count:0};b.getAudioStreamDuration=function(a,b){return this.$3[a]!=null&&this.$3[a][b]!=null?this.$3[a][b].count:0};b.getVideoMetric=function(a,b){return this.$4[a]?this.$4[a][b]:null};b.addMetricStat=function(a,b,c){c!==null&&c!==void 0&&(this.$3[a]||(this.$3[a]={}),this.$3[a][b]=this.$6(this.$3[a][b],c))};b.getMetricStats=function(a,b){return!this.$3[a]?null:this.$3[a][b]};b.getJitterBufferStats=function(a){if(!this.$2[a])return h;var b=this.$2[a].length;if(b===0)return h;this.$2[a].sort(function(a,b){return a-b});var c=this.$2[a].reduce(function(a,b){return a+b});if(b%2===0){var d=Math.floor((b-1)/2),e=Math.ceil((b-1)/2);d=(this.$2[a][d]+this.$2[a][e])/2}else d=this.$2[a][(b-1)/2];return{max:this.$2[a][b-1],min:this.$2[a][0],mean:c/b,median:d,total:c,count:b,first:-1,startedTime:-1,current:-1,updatedTime:-1}};b.toJsonString=function(){return JSON.stringify({stats:this.$3,jitterBufferDelays:this.$2,videoMetric:this.$4,histResScale:this.$1})};a.getPercentMediaKey=function(a,b,c){return a.concat("_",b,"_p",String(c))};a.getAvgMediaKey=function(a,b){return a.concat("_",b,"_avg")};a.fromJsonString=function(b){var c=new a();try{b=JSON.parse(b),b=b}catch(a){return c}b.stats&&(c.$3=b.stats);b.jitterBufferDelays&&(c.$2=b.jitterBufferDelays);b.videoMetric&&(c.$4=b.videoMetric);b.histResScale&&(c.$1=b.histResScale);return c};return a}();g["default"]=a}),98);
__d("ScotchFBRTCMediaMetricsConst",[],(function(a,b,c,d,e,f){"use strict";a="jitter";b="accelerate_rate";c="decoding_cng";d="decoding_normal";e="decoding_plc";var g="decoding_plc_cng",h="decoding_neteq_call",i="discard_rate",j="encode_bitrate",k="expand_rate",l="speech_expand_rate",m="preemptive_rate",n="audio_send_total_energy",o="audio_receive_total_energy",p="audio_send_log_level",q="audio_send_log_level_count",r="audio_send_loudness_level",s="audio_receive_log_level",t="audio_receive_log_level_count",u="audio_receive_loudness_level",v="audio_packets_received",w="audio_fec_packets_received",x="audio_fec_packets_discarded",y="audio_packets_received_lost",z="audio_packets_sent",A="audio_packets_sent_lost",B="video_bytes_received",C="video_bytes_sent",D="inbound_qp",E="outbound_qp",F="frames_encoded",G="frames_decoded",H="frames_received",I="frames_sent",J="keyframes_decoded",K="picture_less_indication_received",L="full_intra_request_received",M="videobwe_send_bandwidth",N="videobwe_transmit_bitrate",O="videobwe_retransmit_bitrate",P="audio_bytes_sent",Q="audio_bytes_received",R="video_pkts_sent",S="video_pkts_send_lost",T="video_pkts_received",U="video_fec_pkts_received",V="video_fec_pkts_discarded",W="video_pkts_receive_lost",X="audio_rtt_received",Y="audio_rtt_sent",Z="audio_dev_rec_stalls",$="audio_dev_total_stalls",aa="audio_dev_is_stalled",ba="audio_dev_stall_duration",ca="video_freeze_cnt",da="video_freeze_duration",ea="video_pause_cnt",fa="video_pause_duration",ga="video_capture_width",ha="video_capture_height",ia="video_sum_capture_pixel",ja="video_capture_frame_count",ka="video_decoded_width",la="video_decoded_height",ma="video_encoded_width",na="video_encoded_height",oa="video_sum_decoded_pixel",pa="video_sum_encoded_pixel",qa="audio_total_packet_send_delay",ra="video_total_packet_send_delay",sa="audio_total_encode_time",ta="video_total_encode_time",ua="audio_total_decode_time",va="video_total_decode_time",wa="audio_jitter_buffer_delay",xa="video_jitter_buffer_delay",ya="audio_jitter_buffer_emitted_count",za="video_jitter_buffer_emitted_count",Aa="audio_e2e_latency",Ba="video_e2e_latency",Ca="av_sync",Da="av_sync_abs",Ea="av_sync_count",Fa="av_sync_oob",Ga="audio_neteq_wait_time",Ha="audio_packet_loss_rate",Ia="audio_plc_cng_rate",Ja="audio_plc_rate",Ka="global_audio_bitrate",La="global_battery_usage",Ma="global_cpu_usage",Na="global_video_bitrate",Oa="video_av_sync_abs",Pa="video_av_sync_oob",Qa="video_frame_rate",Ra="video_freeze_count_per_min",Sa="video_freeze_duration_per_min",Ta="video_neteq_wait_time",Ua="video_packet_loss_rate",Va="video_render_scale_ratio",Wa="video_cropping_ratio",Xa="video_rtt_received",Ya="video_rtt_sent",Za="simulcast_layer_changes",$a="video_quality_sent",ab="video_encoded_frame_rate",bb="video_qp_sent",cb="video_decode_time";f.JITTER=a;f.ACCELERATE_RATE=b;f.DECODING_CNG=c;f.DECODING_NORMAL=d;f.DECODING_PLC=e;f.DECODING_PLC_CNG=g;f.DECODING_NETEQ_CALL=h;f.DISCARD_RATE=i;f.ENCODE_BITRATE=j;f.EXPAND_RATE=k;f.SPEECH_EXPAND_RATE=l;f.PREEMPTIVE_RATE=m;f.AUDIO_SEND_TOTAL_ENERGY=n;f.AUDIO_RECEIVE_TOTAL_ENERGY=o;f.AUDIO_SEND_LOG_LEVEL=p;f.AUDIO_SEND_LOG_LEVEL_COUNT=q;f.AUDIO_SEND_LOUDNESS_LEVEL=r;f.AUDIO_RECEIVE_LOG_LEVEL=s;f.AUDIO_RECEIVE_LOG_LEVEL_COUNT=t;f.AUDIO_RECEIVE_LOUDNESS_LEVEL=u;f.AUDIO_PACKETS_RECEIVED=v;f.AUDIO_FEC_PACKETS_RECEIVED=w;f.AUDIO_FEC_PACKETS_DISCARDED=x;f.AUDIO_PACKETS_RECEIVED_LOST=y;f.AUDIO_PACKETS_SENT=z;f.AUDIO_PACKETS_SENT_LOST=A;f.VIDEO_BYTES_RECEIVED=B;f.VIDEO_BYTES_SENT=C;f.INBOUND_QP=D;f.OUTBOUND_QP=E;f.FRAMES_ENCODED=F;f.FRAMES_DECODED=G;f.FRAMES_RECEIVED=H;f.FRAMES_SENT=I;f.KEYFRAMES_DECODED=J;f.PICTURE_LOSS_INDICAION_RECEIVED=K;f.FULL_INTRA_REQUEST_RECEIVED=L;f.VIDEOBWE_SEND_BANDWIDTH=M;f.VIDEOBWE_TRANSMIT_BITRATE=N;f.VIDEOBWE_RETRANSMIT_BITRATE=O;f.AUDIO_BYTES_SENT=P;f.AUDIO_BYTES_RECEIVED=Q;f.VIDEO_PKTS_SENT=R;f.VIDEO_PKTS_SEND_LOST=S;f.VIDEO_PKTS_RECEIVED=T;f.VIDEO_FEC_PKTS_RECEIVED=U;f.VIDEO_FEC_PKTS_DISCARDED=V;f.VIDEO_PKTS_RECV_LOST=W;f.AUDIO_RTT_RECEIVED=X;f.AUDIO_RTT_SENT=Y;f.AUDIO_DEV_REC_STALLS=Z;f.AUDIO_DEV_TOTAL_STALLS=$;f.AUDIO_DEV_IS_STALLED=aa;f.AUDIO_DEV_STALL_DURATION=ba;f.VIDEO_FREEZE_COUNT=ca;f.VIDEO_FREEZE_DURATION=da;f.VIDEO_PAUSE_COUNT=ea;f.VIDEO_PAUSE_DURATION=fa;f.VIDEO_CAPTURE_WIDTH=ga;f.VIDEO_CAPTURE_HEIGHT=ha;f.VIDEO_SUM_CAPTURE_PIXEL=ia;f.VIDEO_CAPTURE_FRAME_COUNT=ja;f.VIDEO_DECODED_WIDTH=ka;f.VIDEO_DECODED_HEIGHT=la;f.VIDEO_ENCODED_WIDTH=ma;f.VIDEO_ENCODED_HEIGHT=na;f.VIDEO_SUM_DECODED_PIXEL=oa;f.VIDEO_SUM_ENCODED_PIXEL=pa;f.AUDIO_TOTAL_PACKET_SEND_DELAY=qa;f.VIDEO_TOTAL_PACKET_SEND_DELAY=ra;f.AUDIO_TOTAL_ENCODE_TIME=sa;f.VIDEO_TOTAL_ENCODE_TIME=ta;f.AUDIO_TOTAL_DECODE_TIME=ua;f.VIDEO_TOTAL_DECODE_TIME=va;f.AUDIO_JITTER_BUFFER_DELAY=wa;f.VIDEO_JITTER_BUFFER_DELAY=xa;f.AUDIO_JITTER_BUFFER_EMITTED_COUNT=ya;f.VIDEO_JITTER_BUFFER_EMITTED_COUNT=za;f.AUDIO_E2E_LATENCY=Aa;f.VIDEO_E2E_LATENCY=Ba;f.AV_SYNC=Ca;f.AV_SYNC_ABS=Da;f.AV_SYNC_COUNT=Ea;f.AV_SYNC_OOB=Fa;f.AUDIO_NETEQ_WAIT_TIME=Ga;f.AUDIO_PACKET_LOSS_RATE=Ha;f.AUDIO_PLC_CNG_RATE=Ia;f.AUDIO_PLC_RATE=Ja;f.GLOBAL_AUDIO_BITRATE=Ka;f.GLOBAL_BATTERY_USAGE=La;f.GLOBAL_CPU_USAGE=Ma;f.GLOBAL_VIDEO_BITRATE=Na;f.VIDEO_AV_SYNC_ABS=Oa;f.VIDEO_AV_SYNC_OOB=Pa;f.VIDEO_FRAME_RATE=Qa;f.VIDEO_FREEZE_COUNT_PER_MIN=Ra;f.VIDEO_FREEZE_DURATION_PER_MIN=Sa;f.VIDEO_NETEQ_WAIT_TIME=Ta;f.VIDEO_PACKET_LOSS_RATE=Ua;f.VIDEO_RENDER_SCALE_RATIO=Va;f.VIDEO_CROPPING_RATIO=Wa;f.VIDEO_RTT_RECEIVED=Xa;f.VIDEO_RTT_SENT=Ya;f.SIMULCAST_LAYER_CHANGES=Za;f.VIDEO_QUALITY_SENT=$a;f.VIDEO_ENCODED_FRAME_RATE=ab;f.VIDEO_QP_SENT=bb;f.VIDEO_DECODE_TIME=cb}),66);
__d("ScotchFBRTCCallSummary",["ChannelClientID","ErrorMetadata","ScotchConstants","ScotchFBRTCIceStatsParser","ScotchFBRTCMediaMetricTracker","ScotchFBRTCMediaMetricsConst","ScotchRTCLogger","ScotchRTWebUserActionLogger","SiteData","URI","UserAgentData","WebPerformanceDeviceInfo","ZenonBrowsers","ZenonLocalUploadLogLevel","gkx","performanceNow","uuid"],(function(a,b,c,d,e,f,g){var h=5*60*1e3,i=1e5,j=[5,50,95],k={CALL_STARTED:"started",SENT_OFFER:"s_o",RECV_OFFER:"r_o",SENT_OFFER_ACK:"s_oack",RECV_OFFER_ACK:"r_oack",SENT_RETRIED_OFFER:"s_o2",RECV_RETRIED_OFFER:"r_o2",SENT_RETRIED_OFFER_ACK:"s_oack2",RECV_RETRIED_OFFER_ACK:"r_oack2",SENT_PRANSWER:"s_pr",RECV_PRANSWER:"r_pr",NETWORK_READY:"network_ready",SENT_ANSWER:"s_a",RECV_ANSWER:"r_a",SENT_ANSWER_ACK:"s_aack",RECV_ANSWER_ACK:"r_aack",SENT_RETRIED_ANSWER:"s_a2",RECV_RETRIED_ANSWER:"r_a2",SENT_RETRIED_ANSWER_ACK:"s_aack2",RECV_RETRIED_ANSWER_ACK:"r_aack2",SENT_OK:"s_ok",RECV_OK:"r_ok",CALL_CONNECTED:"connected",CALL_ENDED:"ended",SENT_JOIN_REQUEST:"s_jreq",RECV_JOIN_RESPONSE:"r_jresp",PROC_JOIN_RESPONSE:"p_jresp",RECV_RING_REQUEST:"r_rreq",SENT_RING_RESPONSE:"s_rresp"},l={FELLBACK_TO_AUDIO:"f_a",MEDIA_REQUESTED:"m_r",MEDIA_SUCCEEDED:"m_s",POPUP_OPENED:"opened",PRESSED_ANSWER:"p_a"},m={ESCALATION_IS_AVAILABLE:"esc_available",USER_INITIATED_REQUEST:"out_started",RECEIVED_INCOMING_REQUEST:"inc_started",REJECTED_INVALID_P2P_STATE:"rej_invalid_state",CONNECTING_TO_MULTIWAY:"u_connecting_mw",CONNECTED_TO_MULTIWAY:"u_connected_mw",PEER_CONNECTING_TO_MULTIWAY:"p_connecting_mw",PEER_CONNECTED_TO_MULTIWAY:"p_connected_mw",READY_TO_ESCALATE:"ready_esc",PEER_FAILED_TO_CONNECT_TO_MULTIWAY:"p_fail_conn",MULTIWAY_CALL_ENDED:"mw_call_ended",TIMED_OUT:"timed_out",PEER_ABORTED:"p_aborted",INTERNAL_ERROR:"internal_err"},n={ESCALATION_INITIATION_BUTTON_CLICKED:"esc_init_button",ESCALATION_APPROVED_BUTTON_CLICKED:"esc_appr_button",ESCALATION_DECLINED_BUTTON_CLICKED:"esc_decl_button",USERMEDIA_REQUEST:"media_req",USERMEDIA_SUCCESS:"media_success",USERMEDIA_FAILURE:"media_fail",SENT_ESC_REQUEST:"s_esc_req",RECV_ESC_REQUEST:"r_esc_req",SENT_ESC_REQUEST_ACK:"s_esc_req_ack",RECV_ESC_REQUEST_ACK:"s_esc_req_ack",SENT_ESC_RESPONSE:"s_esc_rep",RECV_ESC_ACCEPT:"r_esc_accept",RECV_ESC_DECLINE:"r_esc_decl",RECV_ESC_TIMEOUT:"r_esc_timeout"},o=[d("ScotchFBRTCMediaMetricsConst").ACCELERATE_RATE,d("ScotchFBRTCMediaMetricsConst").DISCARD_RATE,d("ScotchFBRTCMediaMetricsConst").EXPAND_RATE,d("ScotchFBRTCMediaMetricsConst").PREEMPTIVE_RATE,d("ScotchFBRTCMediaMetricsConst").SPEECH_EXPAND_RATE],p=[{key:d("ScotchFBRTCMediaMetricsConst").AUDIO_NETEQ_WAIT_TIME,field:"nwt",scale:1},{key:d("ScotchFBRTCMediaMetricsConst").AUDIO_PACKET_LOSS_RATE,field:"plr",scale:1e4},{key:d("ScotchFBRTCMediaMetricsConst").AUDIO_PLC_CNG_RATE,field:"plccngr",scale:1e4},{key:d("ScotchFBRTCMediaMetricsConst").AUDIO_PLC_RATE,field:"plcr",scale:1e4}],q=[{key:d("ScotchFBRTCMediaMetricsConst").VIDEO_AV_SYNC_ABS,field:"avabs",scale:1},{key:d("ScotchFBRTCMediaMetricsConst").VIDEO_FRAME_RATE,field:"fr",scale:1},{key:d("ScotchFBRTCMediaMetricsConst").VIDEO_NETEQ_WAIT_TIME,field:"nwt",scale:1},{key:d("ScotchFBRTCMediaMetricsConst").VIDEO_PACKET_LOSS_RATE,field:"plr",scale:1e4},{key:d("ScotchFBRTCMediaMetricsConst").VIDEO_RENDER_SCALE_RATIO,field:"rsr",scale:100},{key:d("ScotchFBRTCMediaMetricsConst").VIDEO_CROPPING_RATIO,field:"cr",scale:100}],r=[{key:d("ScotchFBRTCMediaMetricsConst").VIDEO_FREEZE_COUNT_PER_MIN,field:"vfmin",scale:1},{key:d("ScotchFBRTCMediaMetricsConst").VIDEO_FREEZE_DURATION_PER_MIN,field:"vfdur",scale:1},{key:d("ScotchFBRTCMediaMetricsConst").VIDEO_AV_SYNC_OOB,field:"avoob",scale:1e4}],s=[{key:d("ScotchFBRTCMediaMetricsConst").GLOBAL_CPU_USAGE,field:"proc",scale:100},{key:d("ScotchFBRTCMediaMetricsConst").GLOBAL_BATTERY_USAGE,field:"bat",scale:1},{key:d("ScotchFBRTCMediaMetricsConst").GLOBAL_AUDIO_BITRATE,field:"tadb",scale:1},{key:d("ScotchFBRTCMediaMetricsConst").GLOBAL_VIDEO_BITRATE,field:"tvdb",scale:1}],t=[{key:d("ScotchFBRTCMediaMetricsConst").AUDIO_RTT_SENT,field:"artt",scale:1}],u=[{key:d("ScotchFBRTCMediaMetricsConst").VIDEO_RTT_SENT,field:"vrtt",scale:1},{key:d("ScotchFBRTCMediaMetricsConst").VIDEO_QUALITY_SENT,field:"vqs",scale:1},{key:d("ScotchFBRTCMediaMetricsConst").VIDEO_ENCODED_FRAME_RATE,field:"efr",scale:1},{key:d("ScotchFBRTCMediaMetricsConst").VIDEO_QP_SENT,field:"qp",scale:1}],v="globalStatsTrackId",w="grid",x="pinned",y="thumbnail",z="pinnedAudioStatsTrackId",A="pinnedVideoStatsTrackId",B="outboundAudioStatsTrackId",C="outboundScreenStatsTrackId",D="outboundVideoStatsTrackId",E=[v,z,A,B,C,D];function F(a){var b=new(c("URI"))(window.location).getPath().includes("/videocall/");if(a==="MW_PEER_ID"&&!b){a=c("gkx")("1984542");b=c("gkx")("1845186");var e=d("ZenonBrowsers").isFBWebviewWithChromeMinVersion(67)&&c("gkx")("1888615");a=a||b||e;if(a)return"ZenonPlatform"}b=c("gkx")("1341692");e=c("gkx")("1680228");return!b&&!e?"ZenonScotch":"Old Codebase"}a=function(){a.nullSummary=function(){return new a({peerID:"0",callID:"0",isCaller:!1,callTrigger:"NULL_SUMMARY"})};function a(b){var e;this.$41={};this.peerID=String(b.peerID);this.callID=String(b.callID);this.localCallID=(e=b.localCallID)!=null?e:c("uuid")();this.deviceID=d("ChannelClientID").getID();this.$2=b.isCaller;this.$1=b.version||a.CURRENT_SUMMARY_VERSION;this.$3=d("ZenonLocalUploadLogLevel").getLocalUploadLogLevel();this.$15=new Date().valueOf();this.$43={};this.$4=b.callTrigger||null;this.$6={};this.$8={};this.$9={};this.$14={};this.$34=null;this.$35=null;this.$36=null;this.$17=0;this.$18=0;this.$33=!1;this.$10={};this.$11={};this.$12={};this.$13={};this.$39=null;this.$38=null;this.$37=null;this.$5=F(this.peerID);this.$20=c("performanceNow")();this.$16=0;this.$7={};this.$19=this.$20;this.$21=0;this.$22={};this.addExtraInfo(c("ScotchRTCLogger").Key.DEVICE_INFO,this.$56());this.$57();this.$58();this.$59();this.$60();this.$24=c("ScotchFBRTCIceStatsParser").getInstance();this.$50=new(c("ScotchFBRTCMediaMetricTracker"))();this.$23=c("ScotchRTCLogger").getInstance()}var b=a.prototype;b.toJsonString=function(){this.$18=new Date().valueOf();return JSON.stringify({version:this.$1,peerID:this.peerID,callID:this.callID,localCallID:this.localCallID,deviceID:this.deviceID,isCaller:this.$2,uploadLogLevel:this.$3,callType:this.$29,conferenceName:this.$26,joinWithSID:this.$27,activeConn:this.$25,escP2PCallID:this.$28,serverInfoData:this.$30,localVideoDuration:this.$31,remoteVideoDuration:this.$32,startTime:this.$15,trigger:this.$4,signalingTime:this.$6,escStateTimes:this.$8,applicationEventTime:this.$9,videoEscTimes:this.$14,endCallReason:this.$34,endCallSubreason:this.$35,isRemoteEnded:this.$36,lastUpdatedTime:this.$17,lastSerializedTime:this.$18,unsetOnRetrieve:this.$33,openCount:this.$21,extraInfo:this.$22,gen0IceSentCount:this.$10,gen0IceReceivedCount:this.$11,iceSentCount:this.$12,iceReceivedCount:this.$13,connectionType:this.$39,mediaMetricStats:this.$50.toJsonString(),newSignalingTime:this.$7,accumulatedCallTime:this.$61(),deviceCharged:this.$42,ehist:this.getEhist(),videoReceivedCodec:this.$44,videoSentCodec:this.$45,videoDevice:this.$46,audioDevice:this.$47,audioDeviceHist:this.$48,audioSentCodec:this.$49,relayIP:this.$40,clientVersion:this.$5,pcConnectionStates:this.$41,pcIsConnected:this.$37,endIsConnected:this.$38,maxTotalDecodeTime:this.$51,totalDecodeTime:this.$52,totalEncodeTime:this.$53,keyFramesEncoded:this.$54,avSyncAbsHist:this.$55})};a.fromJsonString=function(b){var d;try{b=JSON.parse(b)}catch(a){return null}if(b.version<a.OLDEST_SUPPORTED_SUMMARY_VERSION)return null;if(!Object.prototype.hasOwnProperty.call(b,"peerID")||!Object.prototype.hasOwnProperty.call(b,"callID")||!Object.prototype.hasOwnProperty.call(b,"isCaller")||!Object.prototype.hasOwnProperty.call(b,"startTime")||!Object.prototype.hasOwnProperty.call(b,"trigger")||!Object.prototype.hasOwnProperty.call(b,"signalingTime")||!Object.prototype.hasOwnProperty.call(b,"endCallReason")||!Object.prototype.hasOwnProperty.call(b,"isRemoteEnded")||!Object.prototype.hasOwnProperty.call(b,"lastUpdatedTime")||!Object.prototype.hasOwnProperty.call(b,"lastSerializedTime"))return null;var e=new a({peerID:b.peerID,callID:b.callID,isCaller:b.isCaller,localCallID:b.localCallID});e.deviceID=b.deviceID;e.$1=b.version;e.$3=b.uploadLogLevel;e.$15=b.startTime;e.$4=b.trigger;e.$5=b.clientVersion;e.$6=b.signalingTime;e.$34=b.endCallReason;e.$35=b.endCallSubreason;e.$36=b.isRemoteEnded;e.$17=b.lastUpdatedTime;e.$18=b.lastSerializedTime;e.$27=b.joinWithSID;e.$38=(d=b.endIsConnected)!=null?d:null;e.$37=(d=b.pcIsConnected)!=null?d:null;b.callType&&(e.$29=b.callType);b.conferenceName&&(e.$26=b.conferenceName);b.escP2PCallID&&(e.$28=b.escP2PCallID);b.activeConn&&(e.$25=b.activeConn);b.serverInfoData&&(e.$30=b.serverInfoData);b.localVideoDuration&&(e.$31=b.localVideoDuration);b.remoteVideoDuration&&(e.$32=b.remoteVideoDuration);b.unsetOnRetrieve&&(e.$33=b.unsetOnRetrieve);b.openCount&&(e.$21=b.openCount);b.extraInfo&&(e.$22=b.extraInfo);b.gen0IceSentCount&&(e.$10=b.gen0IceSentCount);b.gen0IceReceivedCount&&(e.$11=b.gen0IceReceivedCount);b.iceSentCount&&(e.$12=b.iceSentCount);b.iceReceivedCount&&(e.$13=b.iceReceivedCount);b.newSignalingTime&&(e.$7=b.newSignalingTime);b.pcConnectionStates&&(e.$41=b.pcConnectionStates);b.accumulatedCallTime&&(e.$16=b.accumulatedCallTime);b.escStateTimes&&(e.$8=b.escStateTimes);b.applicationEventTime&&(e.$9=b.applicationEventTime);b.videoEscTimes&&(e.$14=b.videoEscTimes);b.mediaMetricStats&&(e.$50=c("ScotchFBRTCMediaMetricTracker").fromJsonString(b.mediaMetricStats));b.connectionType&&(e.$39=b.connectionType);b.deviceCharged&&(e.$42=b.deviceCharged);b.ehist!==null&&(e.$43=b.ehist);b.videoReceivedCodec!==null&&(e.$44=b.videoReceivedCodec);b.videoSentCodec!==null&&(e.$45=b.videoSentCodec);b.videoDevice!==null&&(e.$46=b.videoDevice);b.audioDevice!==null&&(e.$47=b.audioDevice);b.audioDeviceHist!==null&&(e.$48=b.audioDeviceHist);b.audioSentCodec!==null&&(e.$49=b.audioSentCodec);b.relayIP!==null&&b.relayIP!==void 0&&(e.$40=b.relayIP);b.maxTotalDecodeTime!==null&&b.maxTotalDecodeTime!==void 0&&(e.$51=b.maxTotalDecodeTime);b.totalDecodeTime!=null&&(e.$52=b.totalDecodeTime);b.totalEncodeTime!=null&&(e.$53=b.totalEncodeTime);b.keyFramesEncoded!=null&&(e.$54=b.keyFramesEncoded);b.avSyncAbsHist!==null&&(e.$55=b.avSyncAbsHist);return e};a.restoreOrInitialize=function(b,d,e,f,g,h){d=String(d);e=String(e);b=b.retrieveCallSummary(d,e);!b?(b=new a({peerID:d,callID:e,isCaller:f}),g?(b.onFullMessageReceived({msg:g}),b.onOfferAckSent(g)):b.onCallStarted(h||c("ScotchRTCLogger").Trigger.UNKNOWN),h!==c("ScotchRTCLogger").Trigger.REDIAL_BUTTON&&c("ScotchRTCLogger").getInstance().logError(d,e,"Missing call summary from storage")):b.$33&&(b.$38=null,b.$34=null,b.$35=null,b.$36=null,delete b.$6[k.CALL_ENDED],delete b.$7[k.CALL_ENDED],b.$20=0,b.$33=null);return b};a.logSavedSummaries=function(a){var b=a.getLoggableSummaries(),d=b.length;if(d<=0)return;var e=c("ScotchRTCLogger").getInstance(),f=[];for(var g=0;g<d;g++){var h=b[g];e.logEndCallSummary(h);f.push({peerID:h.peerID,callID:h.callID})}a.removeCallSummaries(f);e.logToConsole("Logged pending summaries: "+d)};b.logThisSummary=function(a,b){b===void 0&&(b=!1);var d=c("ScotchRTCLogger").getInstance();a.retrieveCallSummary(this.peerID,this.callID)!=null?(d.logEndCallSummary(this,b),a.removeCallSummary(this.peerID,this.callID),d.logToConsole("Logged active summary"),c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"FBRTCCallSummary_logThisSummary: Logged call summary "+JSON.stringify({peerID:this.peerID,callID:this.callID})})):c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"FBRTCCallSummary_logThisSummary: Unable to retrieve call summary "+JSON.stringify({peerID:this.peerID,callID:this.callID})})};b.isNull=function(){var b=a.CANONICAL_NULL_SUMMARY;return this.peerID===b.peerID&&this.callID===b.callID&&this.isCaller()===b.isCaller()&&this.getCallTrigger()===b.getCallTrigger()};b.save=function(a){var b=c("performanceNow")(),d=b-this.$19;if(d>h){this.$23.logInfo(this.peerID,this.callID,"Summary too old: "+d);return}a.storeCallSummary(this.peerID,this.callID,this);this.$19=b};b.getVersion=function(){return this.$1};b.getLastUpdatedTime=function(){return this.$17};b.setLastUpdatedTime=function(a){this.$17=a};b.getExtraInfo=function(){return this.$22};b.getCallTrigger=function(){return this.$4};b.addExtraInfo=function(a,b){this.$22[a]=b,this.$60()};b.isCaller=function(){return this.$2};b.isNetworkReady=function(){if(this.$6[k.NETWORK_READY])return!0;else return!1};b.isAnswerReceived=function(){if(this.$6[k.RECV_ANSWER])return!0;else return!1};b.onCallStarted=function(a){this.$4=a,this.$62(k.CALL_STARTED),this.$60(),c("ErrorMetadata").addGlobalMetadata("RT_WEB","TYPE","CallStarted")};b.setCallTrigger=function(a){this.$4=a,this.$60()};b.setPCIsConnected=function(a){this.$37!==a&&(this.$37=a,this.$41[this.$61()]=a)};b.onPopupOpened=function(){this.deviceID=d("ChannelClientID").getID(),this.$63(l.POPUP_OPENED),this.$21++,this.$60()};b.onPressedAnswer=function(){this.$63(l.PRESSED_ANSWER),this.$60()};b.onMediaRequested=function(){this.$63(l.MEDIA_REQUESTED),this.$60()};b.onMediaSucceeded=function(){this.$63(l.MEDIA_SUCCEEDED),this.$60()};b.onFellbackToAudio=function(){this.$63(l.FELLBACK_TO_AUDIO),this.$60()};b.setConnectionType=function(a){this.$39=a,this.$60()};b.setUploadLogLevel=function(a){this.$3=a,this.$60()};b.getCallType=function(){return this.$29};b.setCallType=function(a){this.$29=a,this.addExtraInfo(c("ScotchRTCLogger").Key.CALL_TYPE,a),this.$60()};b.setLinkSurface=function(a){this.addExtraInfo(c("ScotchRTCLogger").Key.ROOM_SURFACE,a)};b.setVideoDurations=function(a,b){this.$31=a,this.$32=b,this.$60()};b.setAudioDevice=function(a){var b;this.$47=a;this.$48=(b=this.$48)!=null?b:new Array(0);this.$48.length===0?this.$48.push(a):a!==this.$48[this.$48.length-1]&&this.$48.push(a)};b.setVideoDevice=function(a){this.$46=a};b.setScreenDuration=function(a){this.addExtraInfo(c("ScotchRTCLogger").Key.SCREEN_DURATION,a)};b.setConferenceName=function(a){this.$26=a,this.$60()};b.setTotalVideoFilterDuration=function(a){this.addExtraInfo(c("ScotchRTCLogger").Key.VIDEO_DURATION_WITH_FILTER,Math.ceil(a).toString())};b.setCoExperienceEffectDuration=function(a){this.addExtraInfo(c("ScotchRTCLogger").Key.EFFECT_TOTAL_DURATION,Math.ceil(a).toString())};b.setEffectCount=function(a){this.addExtraInfo(c("ScotchRTCLogger").Key.EFFECT_COUNT,a.toString())};b.setJoinWithSID=function(a){this.$27=a,this.$60()};b.setServerInfoData=function(a){this.$30=a,this.$60()};b.setActiveConnection=function(a){this.$25=a,this.$60()};b.setEscalationP2PCallID=function(a){this.$28=a,this.$60()};b.onOfferAckSent=function(a){this.onMessageSent({type:d("ScotchConstants").PayloadType.OFFER_ACK,flag:a.flag})};b.onMessageSent=function(a){var b=a.flag===1;switch(a.type){case d("ScotchConstants").PayloadType.OFFER:this.$64(b,k.SENT_OFFER,k.SENT_RETRIED_OFFER);this.$65(a,this.$10,this.$12);break;case d("ScotchConstants").PayloadType.ANSWER:this.$64(b,k.SENT_ANSWER,k.SENT_RETRIED_ANSWER);this.$65(a,this.$10,this.$12);break;case d("ScotchConstants").PayloadType.OK:this.$62(k.SENT_OK);break;case d("ScotchConstants").PayloadType.PRANSWER:this.$62(k.SENT_PRANSWER);break;case d("ScotchConstants").PayloadType.OFFER_ACK:this.$64(b,k.SENT_OFFER_ACK,k.SENT_RETRIED_OFFER_ACK);break;case d("ScotchConstants").PayloadType.ANSWER_ACK:this.$64(b,k.SENT_ANSWER_ACK,k.SENT_RETRIED_ANSWER_ACK);break;case d("ScotchConstants").PayloadType.ICE_CANDIDATE:this.$65(a,this.$10,this.$12);break;case d("ScotchConstants").PayloadType.ACK:a.ack_type===d("ScotchConstants").PayloadType.VIDEO_REQUEST&&this.$66(n.SENT_ESC_REQUEST_ACK);break;case d("ScotchConstants").PayloadType.VIDEO_REQUEST:a.ack_id?this.$66(n.SENT_ESC_RESPONSE):this.$66(n.SENT_ESC_REQUEST);break;default:}this.$60()};b.$65=function(a,b,c){var d,e=null;a=this.$24.extractIceInfo(a.sdp);for(var f=0;f<a.length;f++)d=a[f].gen,e=a[f].type,d===0&&this.$67(b,e),this.$67(c,e)};b.$67=function(a,b){!a[b]?a[b]=1:a[b]+=1};b.$68=function(a){this.addExtraInfo(c("ScotchRTCLogger").Key.PEER_IS_MOBILE,a.isFromMobile()?"1":"0")};b.onFullMessageReceived=function(a){var b=a.msg,c=b.flag===1;switch(b.type){case d("ScotchConstants").PayloadType.OFFER:this.$68(a);this.$64(c,k.RECV_OFFER,k.RECV_RETRIED_OFFER);this.$65(b,this.$11,this.$13);break;case d("ScotchConstants").PayloadType.ANSWER:this.$68(a);this.$64(c,k.RECV_ANSWER,k.RECV_RETRIED_ANSWER);this.$65(b,this.$11,this.$13);break;case d("ScotchConstants").PayloadType.OK:this.$62(k.RECV_OK);break;case d("ScotchConstants").PayloadType.PRANSWER:this.$62(k.RECV_PRANSWER);break;case d("ScotchConstants").PayloadType.OFFER_ACK:this.$64(c,k.RECV_OFFER_ACK,k.RECV_RETRIED_OFFER_ACK);break;case d("ScotchConstants").PayloadType.ANSWER_ACK:this.$64(c,k.RECV_ANSWER_ACK,k.RECV_RETRIED_ANSWER_ACK);break;case d("ScotchConstants").PayloadType.ICE_CANDIDATE:this.$65(b,this.$11,this.$13);break;case d("ScotchConstants").PayloadType.ACK:b.ack_type===d("ScotchConstants").PayloadType.VIDEO_REQUEST&&this.$66(n.RECV_ESC_REQUEST_ACK);break;case d("ScotchConstants").PayloadType.VIDEO_REQUEST:b.ack_id?b.videoon||b.reqVideoOn?this.$66(n.RECV_ESC_ACCEPT):this.$66(n.RECV_ESC_DECLINE):b.videoon||b.reqVideoOn?this.$66(n.RECV_ESC_REQUEST):this.$66(n.RECV_ESC_TIMEOUT);break;default:}this.$60()};b.onMsgAckReceived=function(a,b){a=a.msg.flag===1;b?this.$64(a,k.RECV_OFFER_ACK,k.RECV_RETRIED_OFFER_ACK):this.$64(a,k.RECV_ANSWER_ACK,k.RECV_RETRIED_ANSWER_ACK)};b.onNetworkReady=function(){this.$62(k.NETWORK_READY),this.$60()};b.onCallConnected=function(){this.$62(k.CALL_CONNECTED),this.$60()};b.onCallEnded=function(a,b,c,d){this.$33=c,this.$34=a,this.$35=d,this.$36=b,this.$38==null&&(this.$38=this.$37),this.$62(k.CALL_ENDED),this.$60()};b.setOfferSentTime=function(){this.$62(k.SENT_OFFER)};b.setOfferAckReceivedTime=function(){this.$62(k.RECV_OFFER_ACK)};b.setAnswerSentTime=function(){this.$62(k.SENT_ANSWER)};b.setAnswerReceivedTime=function(){this.$62(k.RECV_ANSWER)};b.setJoinRequestSent=function(){this.$62(k.SENT_JOIN_REQUEST),this.$60()};b.setJoinResponseReceived=function(){this.$62(k.RECV_JOIN_RESPONSE),this.$60()};b.setJoinResponseProcessed=function(){this.$62(k.PROC_JOIN_RESPONSE),this.$60()};b.setRingRequestReceived=function(){this.$62(k.RECV_RING_REQUEST),this.$60()};b.setRingResponseSent=function(){this.$62(k.SENT_RING_RESPONSE),this.$60()};b.setEscalationAvailable=function(){this.$69(m.ESCALATION_IS_AVAILABLE)};b.setEscalationInitiated=function(){this.$69(m.USER_INITIATED_REQUEST)};b.setReceivedEscalationRequest=function(){this.$69(m.RECEIVED_INCOMING_REQUEST)};b.setInvalidP2PEscalationState=function(){this.$69(m.REJECTED_INVALID_P2P_STATE)};b.setEscalationConnectingToMultiway=function(){this.$69(m.CONNECTING_TO_MULTIWAY)};b.setEscalationConnectedToMultiway=function(){this.$69(m.CONNECTED_TO_MULTIWAY)};b.setEscalationPeerConnectingToMultiway=function(){this.$69(m.PEER_CONNECTING_TO_MULTIWAY)};b.setEscalationPeerConnectedToMultiway=function(){this.$69(m.PEER_CONNECTED_TO_MULTIWAY)};b.setReadyToEscalate=function(){this.$69(m.READY_TO_ESCALATE)};b.setEscalationPeerFailedToConnectToMultiway=function(){this.$69(m.PEER_FAILED_TO_CONNECT_TO_MULTIWAY)};b.setEscalationTimedOut=function(){this.$69(m.TIMED_OUT)};b.setVidEscalationInitClick=function(){this.$66(n.ESCALATION_INITIATION_BUTTON_CLICKED)};b.setVidEscalationAcceptedClick=function(){this.$66(n.ESCALATION_APPROVED_BUTTON_CLICKED)};b.setVidEscalationDeclinedClick=function(){this.$66(n.ESCALATION_DECLINED_BUTTON_CLICKED)};b.setVidEscalationMediaRequested=function(){this.$66(n.USERMEDIA_REQUEST)};b.setVidEscalationMediaSuccess=function(){this.$66(n.USERMEDIA_SUCCESS)};b.setVidEscalationMediaFailed=function(){this.$66(n.USERMEDIA_FAILURE)};b.setVideoCapabilities=function(a){this.addExtraInfo(c("ScotchRTCLogger").Key.VIDEO_CAPABILITIES,a)};b.setMediaInputs=function(a){this.addExtraInfo(c("ScotchRTCLogger").Key.MEDIA_INPUTS,a)};b.getVideoReceivedCodec=function(){return this.$44};b.setVideoReceivedCodec=function(a){this.$44=a};b.getVideoSentCodec=function(){return this.$45};b.setVideoSentCodec=function(a){this.$45=a};b.getEhist=function(){return this.$43};b.setEhist=function(a){this.$43=a};b.getAudioSentCodec=function(){return this.$49};b.setAudioSentCodec=function(a){this.$49=a};b.setVideoMaxTotalDecodeTime=function(a){var b;this.$51=Math.max((b=this.$51)!=null?b:0,a)};b.getTotalDecodeTime=function(){return this.$52};b.setTotalDecodeTime=function(a){this.$52=a};b.getTotalEncodeTime=function(){return this.$53};b.setTotalEncodeTime=function(a){this.$53=a};b.getKeyFramesEncoded=function(){return this.$54};b.setKeyFramesEncoded=function(a){this.$54=a};b.$70=function(){return this.$55};b.setAvSyncAbsHist=function(a){var b;b=(b=a)!=null?b:[];b=b.some(function(a){return a>0});b&&(this.$55=a)};b.toString=function(){var a={core_metrics:this.$71(),time_series:null};return JSON.stringify(a)};b.$71=function(){var a={ver:this.$1,log_level:d("ScotchConstants").uploadLogLevelString(this.$3),caller:this.$2,call_type:this.$29,active_conn:this.$25,app_event_times:this.$9,conf_name:this.$26,CoreAudioMetrics:this.$72(),join_with_sid:this.$27,esc_p2p_call_id:this.$28,esc_state_times:this.$8,vid_esc_times:this.$14,serv_info:this.$30,conn:this.$73(),peer_id:this.peerID,has_video:!0,open_count:this.$21,signaling:this.$74(),sender:this.$75(),receiver:this.$76(),end:this.$77(),video:this.$78(),push_phase:c("SiteData").push_phase,DebugAudioMetrics:this.$79(),device_charged:this.$42,client_version:this.$5,perf:this.$80(),grid:this.$81(),pinned:this.$82(),thumbnail:this.$83(),sys_pct:this.$84(),sender_pct:this.$85()};return a};b.$79=function(){return{NetworkReceive:{jb_nm:this.$86()}}};b.$87=function(a,b,c){var d=this,e=0,f=0;b==null&&(b=1);var g=this.$50.getVideoStreamReportKeys();g.forEach(function(b){if(c==null||d.$50.getVideoContentType(b)===c){b=d.$50.getVideoMetric(b,a);b&&(e+=b.total,f+=b.count)}});return f===0?null:Math.round(e*b/f)};b.$88=function(a,b,c){var d=this,e=0,f=0;b==null&&(b=1);var g=this.$50.getVideoStreamReportKeys();g.forEach(function(b){if(c==null||d.$50.getVideoContentType(b)===c){b=d.$50.getVideoMetric(b,a);b&&(e+=b.current,f+=1)}});return f===0?null:Math.round(e*b)};b.$89=function(a,b){var c=this,d=0,e=0;b==null&&(b=1);var f=this.$50.getAudioStreamReportKeys();f.forEach(function(b){b=c.$50.getMetricStats(b,a);b&&(d+=b.current,e+=1)});return e===0?null:Math.round(d*b)};b.$86=function(){var a=this,b={},c=this.$50.getAudioStreamReportKeys();if(c.length<1)return b;o.forEach(function(d){var e=0,f=0,g=-Infinity,h=Infinity;c.forEach(function(b){b=a.$50.getMetricStats(b,d);b!=null&&b.total!=null&&(e+=b.count,f+=b.total,g=Math.max(g,b.max),h=Math.min(h,b.min))});e>0&&(b[d]={m:Math.round(1e4*h),M:Math.round(1e4*g),avg:Math.round(f*1e4/e)})});b.neteq={meanWait:this.$90()};return b};b.$90=function(){var a=this.$89(d("ScotchFBRTCMediaMetricsConst").AUDIO_JITTER_BUFFER_DELAY),b=this.$89(d("ScotchFBRTCMediaMetricsConst").AUDIO_JITTER_BUFFER_EMITTED_COUNT);return a!=null&&b!=null&&b>0?Math.round(a*1e3/b):-1};b.$72=function(){var a=this,b=this.$50.getAudioStreamReportKeys();b=b.reduce(function(b,c){c=a.$50.getMetricStats(c,d("ScotchFBRTCMediaMetricsConst").AUDIO_DEV_IS_STALLED);return!c||c.updatedTime==null||c.current==null?b:c.updatedTime>b.timeStamp?{val:c.current,timeStamp:c.updatedTime}:b},{val:-1,timeStamp:-Infinity}).val>0?1:0;var c=this.$89(d("ScotchFBRTCMediaMetricsConst").AUDIO_DEV_REC_STALLS),e=this.$89(d("ScotchFBRTCMediaMetricsConst").AUDIO_DEV_TOTAL_STALLS),f=this.$89(d("ScotchFBRTCMediaMetricsConst").AUDIO_DEV_STALL_DURATION),g=this.$91();g=g.count===0?0:Math.round(g.levelSum/g.count);e={astall:e,audio_device:this.$47,audio_device_hist:this.$48,isstall:b,rstall:c,rx_chan_proc_lvl:g,sdur:f};return e};b.$73=function(){var a={dtls:1},b=this.$75();b.avgrtt&&(a.avgrtt=b.avgrtt,a.maxrtt=b.maxrtt,a.minrtt=b.minrtt);this.$40!==null&&(a.relay_ip=this.$40);a.ctd=this.$41;return a};b.$74=function(){var a={};this.$4&&(a.trigger=this.$4);a.start_time=this.$15;a.time_from_start=this.$6;a.new_time_from_start=this.$7;var b=this.$92();b>0&&(a.duration=b);return a};b.$92=function(a){var b=this.$7[k.CALL_CONNECTED]||this.$7[k.NETWORK_READY];if(!b)return 0;a=this.$7[k.CALL_ENDED]||!(a==null?void 0:a.assumeOngoing)&&this.$16||this.$61();return Math.max(0,a-b)};b.$75=function(){var a=this,b={},c=this.$50.getAudioStreamReportKeys(),e=0,f=0,g=0;c.forEach(function(b){b=a.$50.getMetricStats(b,d("ScotchFBRTCMediaMetricsConst").AUDIO_BYTES_SENT);b!=null&&(e+=b.current,f+=b.current-b.first,g+=b.updatedTime-b.startedTime)});g>0&&(b.ube_avg=Math.round(f*8e3/g));b.bytes=e;b.plost=this.$89(d("ScotchFBRTCMediaMetricsConst").AUDIO_PACKETS_SENT_LOST);b.psent=this.$89(d("ScotchFBRTCMediaMetricsConst").AUDIO_PACKETS_SENT);var h=this.$50.getMetricStats(B,d("ScotchFBRTCMediaMetricsConst").AUDIO_SEND_LOUDNESS_LEVEL),i=this.$50.getMetricStats(B,d("ScotchFBRTCMediaMetricsConst").AUDIO_SEND_LOG_LEVEL_COUNT);h&&i&&(b.tx_sum_lvl=h.current,b.taulc=i.current);var j=0,k=0,l=null,m=null;c.forEach(function(b){b=a.$50.getMetricStats(b,d("ScotchFBRTCMediaMetricsConst").AUDIO_RTT_SENT);b&&(k+=b.count,j+=b.total,l=l==null?b.min:Math.min(l,b.min),m=m==null?b.max:Math.max(m,b.max))});k>0&&(b.avgrtt=Math.round(j/k),b.maxrtt=m,b.minrtt=l);this.$10&&(b.ice_g0=this.$10);this.$12&&(b.ice=this.$12);this.$49!=null&&this.$49!==""&&(b.codec={www:this.$49});return b};b.$76=function(){var a=this,b={},c=this.$50.getAudioStreamReportKeys();b.jbd=this.$89(d("ScotchFBRTCMediaMetricsConst").AUDIO_JITTER_BUFFER_DELAY,1e3);b.jbec=this.$89(d("ScotchFBRTCMediaMetricsConst").AUDIO_JITTER_BUFFER_EMITTED_COUNT);var e=new Map([[d("ScotchFBRTCMediaMetricsConst").DECODING_PLC,0],[d("ScotchFBRTCMediaMetricsConst").DECODING_PLC_CNG,0],[d("ScotchFBRTCMediaMetricsConst").DECODING_CNG,0],[d("ScotchFBRTCMediaMetricsConst").DECODING_NORMAL,0],[d("ScotchFBRTCMediaMetricsConst").DECODING_NETEQ_CALL,0]]);c.forEach(function(b){if(E.includes(b))return;e.forEach(function(c,d){c=a.$50.getMetricStats(b,d);if(c!=null){var f;f=(f=e.get(d))!=null?f:0;e.set(d,f+c.current)}})});b.dec_plc=e.get(d("ScotchFBRTCMediaMetricsConst").DECODING_PLC);b.dec_plc_cng=e.get(d("ScotchFBRTCMediaMetricsConst").DECODING_PLC_CNG);b.dec_cng=e.get(d("ScotchFBRTCMediaMetricsConst").DECODING_CNG);b.dec_normal=e.get(d("ScotchFBRTCMediaMetricsConst").DECODING_NORMAL);b.neteq_calls=e.get(d("ScotchFBRTCMediaMetricsConst").DECODING_NETEQ_CALL);var f=this.$50.getMetricStats(v,d("ScotchFBRTCMediaMetricsConst").AUDIO_SEND_LOUDNESS_LEVEL),g=this.$50.getMetricStats(v,d("ScotchFBRTCMediaMetricsConst").AUDIO_SEND_LOG_LEVEL_COUNT);f&&g&&(b.rx_sum_lvl=f.current,b.taulc=g.current);b.fecpd=this.$89(d("ScotchFBRTCMediaMetricsConst").AUDIO_FEC_PACKETS_DISCARDED);b.fecpr=this.$89(d("ScotchFBRTCMediaMetricsConst").AUDIO_FEC_PACKETS_RECEIVED);var h=0;c.forEach(function(b){b=a.$50.getMetricStats(b,d("ScotchFBRTCMediaMetricsConst").AUDIO_BYTES_RECEIVED);b&&(h+=b.current)});b.bytes=h;var j=0,k=0;c.forEach(function(b){b=a.$50.getMetricStats(b,d("ScotchFBRTCMediaMetricsConst").AUDIO_BYTES_RECEIVED);if(b){var c=b.updatedTime-b.startedTime;c>0&&(j+=b.current-b.first,k+=c)}});k>0&&(b.dbe_avg=Math.round(j*8e3/k));var l=0;c.forEach(function(b){b=a.$50.getMetricStats(b,d("ScotchFBRTCMediaMetricsConst").AUDIO_PACKETS_RECEIVED_LOST);b&&(l+=b.current)});b.plost=l;var m=0,n,o,p,q=0,r=0;c.forEach(function(b){var c=a.$50.getMetricStats(b,d("ScotchFBRTCMediaMetricsConst").AUDIO_PACKETS_RECEIVED),e=a.$50.getMetricStats(b,d("ScotchFBRTCMediaMetricsConst").AUDIO_RTT_RECEIVED);b=a.$50.getMetricStats(b,d("ScotchFBRTCMediaMetricsConst").AUDIO_RECEIVE_TOTAL_ENERGY);b!=null&&(q+=b.current,r+=b.updatedTime-b.startedTime);c!=null&&(m+=c.current,e!=null&&e.mean!=null&&(n=n==null?c.current*e.mean:n+c.current*e.mean,p=p==null?e.max:Math.max(p,e.max),o=o==null?e.min:Math.min(o,e.min)))});b.taue=Math.round(q*i);b.taut=Math.round(r);m>0&&n!=null&&(b.avgrtt=Math.round(n/m),b.maxrtt=p,b.minrtt=o);b.precv=m;this.$11&&(b.ice_g0=this.$11);this.$13&&(b.ice=this.$13);return b};b.$77=function(){var a={};this.$34!=null&&(a.end_call_reason_string=d("ScotchConstants").callEndReasonString(this.$34),this.$35!==null&&(a.end_call_subreason_string=this.$35),a.remote_ended=this.$36,a.end_ctd=this.$38);this.$39&&(a.conn_type=this.$39);return a};b.$78=function(){var a={ch:null,cw:null,ah:null,aw:null,efrate:this.$93(),ehist:this.getEhist(),eipxl:null,ename:this.$45,eopxl:null,fcap:this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_CAPTURE_FRAME_COUNT),eqps:this.$88(d("ScotchFBRTCMediaMetricsConst").OUTBOUND_QP),frames:this.$88(d("ScotchFBRTCMediaMetricsConst").FRAMES_ENCODED),kframes:this.$54,fcsn:this.$88(d("ScotchFBRTCMediaMetricsConst").FRAMES_SENT),histResScale:null,psent:this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_PKTS_SENT),plost:this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_PKTS_SEND_LOST),ss:{avbr:null,avbw:this.$87(d("ScotchFBRTCMediaMetricsConst").VIDEOBWE_SEND_BANDWIDTH,1,"screen"),dur:null,eiframes:null,eipxl:null,eopxl:null,eqps:this.$88(d("ScotchFBRTCMediaMetricsConst").OUTBOUND_QP,1,"screen"),frames:this.$88(d("ScotchFBRTCMediaMetricsConst").FRAMES_ENCODED,1,"screen")},sim_l_chg:this.$88(d("ScotchFBRTCMediaMetricsConst").SIMULCAST_LAYER_CHANGES,1),tet:this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_TOTAL_ENCODE_TIME,1e3),tpsd:this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_TOTAL_PACKET_SEND_DELAY,1e3),video_device:this.$46};return{sender:this.$94(a),receiver:this.$95(),ld:this.$31,rd:this.$32,bwe:this.$96()}};b.$93=function(){var a=this.$31,b=this.$88(d("ScotchFBRTCMediaMetricsConst").FRAMES_ENCODED);if(a!=null&&a>0&&b!=null&&b>0)return Math.round(b*1e3/a)};b.$80=function(){var a,b=this.$92()/1e3;if(b<=0)return;a=((a=this.$52)!=null?a:0)+((a=this.$53)!=null?a:0);a=Math.round(100*(a/b));return{cpu:{proc:{avg:a}}}};b.$91=function(){var a=this,b=this.$50.getAudioStreamReportKeys();b=b.reduce(function(b,c){if(c===v||c===B)return b;var e=a.$50.getMetricStats(c,d("ScotchFBRTCMediaMetricsConst").AUDIO_RECEIVE_LOG_LEVEL);c=a.$50.getMetricStats(c,d("ScotchFBRTCMediaMetricsConst").AUDIO_RECEIVE_LOG_LEVEL_COUNT);return!e||!c?b:{count:b.count+c.current,levelSum:b.levelSum+e.current}},{count:0,levelSum:0});return b};b.$96=function(){var a=this,b={avg_enc_bitrate:this.$97(),avg_send_bw:this.$98(),avg_trans_bitrate:null,avg_retrans_bitrate:null},c=this.$50.getVideoStreamReportKeys();c.some(function(c){var e=a.$50.getVideoMetric(c,d("ScotchFBRTCMediaMetricsConst").VIDEOBWE_TRANSMIT_BITRATE);c=a.$50.getVideoMetric(c,d("ScotchFBRTCMediaMetricsConst").VIDEOBWE_RETRANSMIT_BITRATE);if(e&&c){b.avg_trans_bitrate=e.mean;b.avg_retrans_bitrate=c.mean;return!0}return!1});return b};b.$97=function(){var a=this,b=this.$50.getVideoStreamReportKeys(),c=0,e=0;b.forEach(function(b){b=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").ENCODE_BITRATE);b&&(c+=b.total,e+=b.count)});return e===0?null:Math.round(c/e)};b.$98=function(){var a=this,b=this.$50.getVideoStreamReportKeys(),c=null;b.some(function(b){c=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").VIDEOBWE_SEND_BANDWIDTH);return c?!0:!1});c&&(c=c.mean);return c};b.$85=function(){var a=this.$99(t,B,w),b=this.$100(u,C,w),c=this.$100(u,D,w);return{audio:a,screen:b,video:c}};b.$99=function(a,b,d){var e=this,f={};a.forEach(function(a){var g,h=a.field,i=a.key;a=a.scale;var k=[];g=(g=e.$50.getMetricStats(b,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(i,d)))==null?void 0:g.current;j.forEach(function(a){a=(a=(a=e.$50.getMetricStats(b,c("ScotchFBRTCMediaMetricTracker").getPercentMediaKey(i,d,a)))==null?void 0:a.current)!=null?a:0;k.push(a)});g!=null&&(f[h]=e.$101(g,k,a,j))});return Object.keys(f).length>0?f:null};b.$100=function(a,b,d){var e=this,f={};a.forEach(function(a){var g,h=a.field,i=a.key;a=a.scale;var k=[];g=(g=e.$50.getVideoMetric(b,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(i,d)))==null?void 0:g.current;j.forEach(function(a){a=(a=(a=e.$50.getVideoMetric(b,c("ScotchFBRTCMediaMetricTracker").getPercentMediaKey(i,d,a)))==null?void 0:a.current)!=null?a:0;k.push(a)});g!=null&&(f[h]=e.$101(g,k,a,j))});return Object.keys(f).length>0?f:null};b.$84=function(){return this.$99(s,v,w)};b.$81=function(){var a=this,b={audio:{avg:{},max:{},min:{}},video:{avg:{},max:{},min:{}}},c=this.$50.getAudioStreamReportKeys(),d=this.$50.getVideoStreamReportKeys();p.forEach(function(d){var e=d.field,f=d.key;d=d.scale;f=a.$102(f,c,d,!0,j);f!=null&&(b.audio.avg[e]=f.avg,b.audio.max[e]=f.max,b.audio.min[e]=f.min)});q.forEach(function(c){var e=c.field,f=c.key;c=c.scale;f=a.$102(f,d,c,!1,j);f!=null&&(b.video.avg[e]=f.avg,b.video.max[e]=f.max,b.video.min[e]=f.min)});r.forEach(function(c){var e=c.field,f=c.key;c=c.scale;f=a.$102(f,d,c,!1,[]);f!=null&&(b.video.avg[e]=f.avg.avg,b.video.max[e]=f.max.avg,b.video.min[e]=f.min.avg)});return b};b.$103=function(a,b,d,e,f){var g=this,h=0,i=new Array(f.length).fill(0),j=0,k=0;b.forEach(function(b){var d=null,l=[];if(e){var m;j=g.$50.getAudioStreamDuration(b,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(a,y));d=(m=g.$50.getMetricStats(b,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(a,y)))==null?void 0:m.current;f.forEach(function(d){d=(d=g.$50.getMetricStats(b,c("ScotchFBRTCMediaMetricTracker").getPercentMediaKey(a,y,d)))==null?void 0:d.current;l.push(d)})}else{j=g.$50.getVideoStreamDuration(b,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(a,y));d=(m=g.$50.getVideoMetric(b,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(a,y)))==null?void 0:m.current;f.forEach(function(d){d=(d=g.$50.getVideoMetric(b,c("ScotchFBRTCMediaMetricTracker").getPercentMediaKey(a,y,d)))==null?void 0:d.current;l.push(d)})}d!=null&&(h+=d*j,i=l.map(function(a,b){return a!=null?a*j+i[b]:i[b]}),k+=j)});if(k===0)return null;b=h/k;var l=i.map(function(a){return a/k});return this.$101(b,l,d,f)};b.$102=function(a,b,d,e,f){var g=this,h=0,i=new Array(f.length).fill(0),j=0,k=new Array(f.length).fill(0),l=0,m=new Array(f.length).fill(0),n=0,o=0;b.forEach(function(b){var d=null,p=[];if(e){var q;n=g.$50.getAudioStreamDuration(b,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(a,w));d=(q=g.$50.getMetricStats(b,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(a,w)))==null?void 0:q.current;f.forEach(function(d){d=(d=g.$50.getMetricStats(b,c("ScotchFBRTCMediaMetricTracker").getPercentMediaKey(a,w,d)))==null?void 0:d.current;p.push(d)})}else{n=g.$50.getVideoStreamDuration(b,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(a,w));d=(q=g.$50.getVideoMetric(b,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(a,w)))==null?void 0:q.current;f.forEach(function(d){d=(d=g.$50.getVideoMetric(b,c("ScotchFBRTCMediaMetricTracker").getPercentMediaKey(a,w,d)))==null?void 0:d.current;p.push(d)})}d!=null&&n>0&&(h+=d*n,i=p.map(function(a,b){return a!=null?a*n+i[b]:i[b]}),o===0?(j=d,l=d,k=p,m=p):d>j?(j=d,k=p):d<l&&(l=d,m=p),o+=n)});if(o===0)return null;b=h/o;var p=i.map(function(a){return a/o});b={avg:this.$101(b,p,d,f),min:this.$101(l,m,d,f),max:this.$101(j,k,d,f)};return b};b.$101=function(a,b,c,d){var e={};e.avg=Math.round(a*c);d.forEach(function(a,d){a="p".concat(String(a));e[a]=Math.round(b[d]*c)});return e};b.$83=function(){var a=this,b={audio:{},video:{}},c=this.$50.getAudioStreamReportKeys(),d=this.$50.getVideoStreamReportKeys(),e=!1;p.forEach(function(d){var f=d.field,g=d.key;d=d.scale;g=a.$103(g,c,d,!0,j);g!=null&&(b.audio[f]=g,e=!0)});q.forEach(function(c){var f=c.field,g=c.key;c=c.scale;g=a.$103(g,d,c,!1,j);g!=null&&(b.video[f]=g,e=!0)});r.forEach(function(c){var f=c.field,g=c.key;c=c.scale;g=a.$103(g,d,c,!1,[]);g!=null&&(b.video[f]=g.avg,e=!0)});return!e?null:b};b.$82=function(){var a=this,b=this.$50.getAudioStreamReportKeys(),d=this.$50.getVideoStreamReportKeys();if(!b.includes(z)&&!d.includes(A))return null;var e={audio:{},video:{}};p.forEach(function(b){var d,f=b.field,g=b.key;b=b.scale;var h=[];d=(d=a.$50.getMetricStats(z,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(g,x)))==null?void 0:d.current;j.forEach(function(b){b=(b=(b=a.$50.getMetricStats(z,c("ScotchFBRTCMediaMetricTracker").getPercentMediaKey(g,x,b)))==null?void 0:b.current)!=null?b:0;h.push(b)});d!=null&&(e.audio[f]=a.$101(d,h,b,j))});q.forEach(function(b){var d,f=b.field,g=b.key;b=b.scale;var h=[];d=(d=a.$50.getVideoMetric(A,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(g,x)))==null?void 0:d.current;j.forEach(function(b){b=(b=(b=a.$50.getVideoMetric(A,c("ScotchFBRTCMediaMetricTracker").getPercentMediaKey(g,x,b)))==null?void 0:b.current)!=null?b:0;h.push(b)});d!=null&&(e.video[f]=a.$101(d,h,b,j))});r.forEach(function(b){var d=b.field,f=b.key;b=b.scale;var g=[];f=(f=a.$50.getVideoMetric(A,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(f,x)))==null?void 0:f.current;f!=null&&(e.video[d]=a.$101(f,g,b,[]).avg)});return e};b.$94=function(a){var b=this,e=this.$50.getVideoStreamReportKeys(),f=new Array(5).fill(0),g=0;e.forEach(function(a){a=b.$50.getHistResScale(a);a&&(g+=1,a.histogram.forEach(function(a,b){f[b]+=a}))});a.histResScale=g===0?null:f;e.reverse().some(function(c){var e=b.$50.getVideoMetric(c,d("ScotchFBRTCMediaMetricsConst").VIDEO_CAPTURE_WIDTH),f=b.$50.getVideoMetric(c,d("ScotchFBRTCMediaMetricsConst").VIDEO_CAPTURE_HEIGHT),g=b.$50.getVideoMetric(c,d("ScotchFBRTCMediaMetricsConst").VIDEO_ENCODED_WIDTH);c=b.$50.getVideoMetric(c,d("ScotchFBRTCMediaMetricsConst").VIDEO_ENCODED_HEIGHT);e&&f&&(a.cw=e.current,a.ch=f.current);if(g&&c){a.aw=g.current;a.ah=c.current;return!0}return!1});this.$22[c("ScotchRTCLogger").Key.SCREEN_DURATION]!=null&&typeof this.$22[c("ScotchRTCLogger").Key.SCREEN_DURATION]==="number"&&(a.ss.dur=this.$22[c("ScotchRTCLogger").Key.SCREEN_DURATION]);e=this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_BYTES_SENT,1,"screen");e!=null&&a.ss.dur!=null&&a.ss.dur>0&&(a.ss.avbr=Math.round(1e3*8*e/a.ss.dur));e=this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_SUM_ENCODED_PIXEL,1,"screen");var h=this.$88(d("ScotchFBRTCMediaMetricsConst").FRAMES_ENCODED,1,"screen");e!=null&&h!=null&&h>0&&(a.ss.eopxl=Math.round(e/h));e=this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_SUM_CAPTURE_PIXEL,1,"screen");h=this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_CAPTURE_FRAME_COUNT,1,"screen");e!=null&&h!=null&&h>0&&(a.ss.eiframes=h,a.ss.eipxl=Math.round(e/h));e=this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_SUM_ENCODED_PIXEL,1);h=this.$88(d("ScotchFBRTCMediaMetricsConst").FRAMES_ENCODED,1);e!=null&&h!=null&&h>0&&(a.eopxl=Math.round(e/h));e=this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_SUM_CAPTURE_PIXEL,1);h=this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_CAPTURE_FRAME_COUNT,1);e!=null&&h!=null&&h>0&&(a.eipxl=Math.round(e/h));return a};b.$95=function(){var a=this,b=this.$50.getVideoStreamReportKeys(),c=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0;b.forEach(function(b){var l=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").VIDEO_PKTS_RECEIVED),m=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").VIDEO_PKTS_RECV_LOST);l&&m&&(f+=l.current,g+=m.current);l=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").VIDEO_BYTES_RECEIVED);l&&(c+=l.current);m=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").FRAMES_DECODED);m&&(h+=m.current);l=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").KEYFRAMES_DECODED);l&&(i+=l.current);m=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").PICTURE_LOSS_INDICAION_RECEIVED);m&&(j+=m.current);l=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").FULL_INTRA_REQUEST_RECEIVED);l&&(k+=l.current);m=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").VIDEO_DECODE_TIME);m&&(e+=m.current)});var l={jtkey:i,pli:j,fir:k,dec_bytes:c,dec_frame:h,dec_time:this.$51?Math.round(this.$51):null,dec_time_all_streams:Math.round(e),dname:this.$44,dpxl:null,frd:h,frcnt:null,jtasb:null,precv:f,plost:g,qps:this.$88(d("ScotchFBRTCMediaMetricsConst").INBOUND_QP),rh:null,rw:null,tdt:this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_TOTAL_DECODE_TIME,1e3),jbd:null,jbec:null,recjbl:null,e2el:null,av:null,avabs:null,avhist:this.$70(),avoob:null},m=this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_JITTER_BUFFER_DELAY,1e3),n=this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_JITTER_BUFFER_EMITTED_COUNT);l.jbd=m;l.jbec=n;m!=null&&n!=null&&n>0&&(l.recjbl=Math.round(m/n));var o=0,p=0,q=0,r=0,s=0;b.forEach(function(b){var c=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").AV_SYNC),e=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").AV_SYNC_ABS),f=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").AV_SYNC_OOB),g=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").AV_SYNC_COUNT);b=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").FRAMES_DECODED);b!=null&&c!=null&&e!=null&&c.mean!=null&&e.mean!=null&&(q+=b.current,o+=c.mean*b.current,p+=e.mean*b.current);f!=null&&g!=null&&(s+=g.current,r+=f.current)});q>0&&(l.av=Math.round(o/q),l.avabs=Math.round(p/q));s>0&&(l.avoob=Math.round(r*1e4/s));var t=0,u=0;b.forEach(function(b){var c=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").VIDEO_E2E_LATENCY);b=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").FRAMES_DECODED);c!=null&&c.mean!=null&&b!=null&&(t+=b.current,u+=c.mean*b.current)});t>0&&(l.e2el=Math.round(u/t));l.frcnt=b.reduce(function(b,c){c=a.$50.getVideoMetric(c,d("ScotchFBRTCMediaMetricsConst").VIDEO_FREEZE_COUNT);return b+(c?c.current:0)},0);l.frdur=b.reduce(function(b,c){c=a.$50.getVideoMetric(c,d("ScotchFBRTCMediaMetricsConst").VIDEO_FREEZE_DURATION);return b+(c?c.current:0)},0);l.frdur=Math.round(l.frdur);l.pact=b.reduce(function(b,c){c=a.$50.getVideoMetric(c,d("ScotchFBRTCMediaMetricsConst").VIDEO_PAUSE_COUNT);return b+(c?c.current:0)},0);l.padur=b.reduce(function(b,c){c=a.$50.getVideoMetric(c,d("ScotchFBRTCMediaMetricsConst").VIDEO_PAUSE_DURATION);return b+(c?c.current:0)},0);l.padur=Math.round(l.padur);var v=0;b.forEach(function(b){var c=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").VIDEO_DECODED_HEIGHT);b=a.$50.getVideoMetric(b,d("ScotchFBRTCMediaMetricsConst").VIDEO_DECODED_WIDTH);b&&c&&b.updatedTime>v&&(l.rw=b.current,l.rh=c.current,v=b.updatedTime)});l.jtasb=b.reduce(function(b,c){c=a.$50.getVideoMetric(c,d("ScotchFBRTCMediaMetricsConst").FRAMES_RECEIVED);return b+(c?c.current:0)},0);m=this.$88(d("ScotchFBRTCMediaMetricsConst").VIDEO_SUM_DECODED_PIXEL,1);n=this.$88(d("ScotchFBRTCMediaMetricsConst").FRAMES_DECODED,1);m!=null&&n!=null&&n>0&&(l.dpxl=Math.round(m/n));return l};b.$104=function(){return new Date().valueOf()-this.$15};b.$61=function(){var a=c("performanceNow")()-this.$20;return Math.floor(this.$16+a)};b.$62=function(a){if(this.$6[a])return;this.$6[a]=this.$104();this.$7[a]=this.$61()};b.$69=function(a){if(this.$8[a])return;this.$8[a]=this.$104()};b.$63=function(a){if(this.$9[a])return;this.$9[a]=this.$104()};b.$66=function(a){if(this.$14[a])return;this.$14[a]=this.$104()};b.setDeviceCharged=function(a){this.$42!==!0&&(this.$42=a)};b.$64=function(a,b,c){a?this.$62(c):this.$62(b)};b.$60=function(){this.$17=new Date().valueOf()};b.$56=function(){var a=c("UserAgentData").browserName,b=c("UserAgentData").platformName;window.navigator.userAgent.toLowerCase().includes("mobile")&&(b+=" Mobile",a==="Chrome"&&(a="Mobile "+a));return{device:c("UserAgentData").deviceName,os:b,os_version:c("UserAgentData").platformFullVersion,browser:a,browser_version:c("UserAgentData").browserFullVersion,screen_height:window.screen.availHeight,screen_width:window.screen.availWidth,user_agent:window.navigator.userAgent}};b.$57=function(){window.navigator.connection!=null&&window.navigator.connection.effectiveType!=null&&this.addExtraInfo(c("ScotchRTCLogger").Key.CONNECTION_EFFECTIVE_TYPE,window.navigator.connection.effectiveType)};b.$59=function(){var a=d("WebPerformanceDeviceInfo").getMobileYearClass();a!=null&&a>0?this.addExtraInfo(c("ScotchRTCLogger").Key.YEAR_CLASS,a):this.addExtraInfo(c("ScotchRTCLogger").Key.DESKTOP_DEVICE_CLASS,d("WebPerformanceDeviceInfo").getDeviceLevel())};b.$58=function(){navigator.hardwareConcurrency!=null&&this.addExtraInfo(c("ScotchRTCLogger").Key.CPU_CORES,navigator.hardwareConcurrency),window.navigator.deviceMemory!=null&&this.addExtraInfo(c("ScotchRTCLogger").Key.DEVICE_MEMORY,window.navigator.deviceMemory),this.addExtraInfo(c("ScotchRTCLogger").Key.DEVICE_PIXEL_RATIO,window.devicePixelRatio)};b.getCallDuration=function(){var a=c("gkx")("707989");return this.$92({assumeOngoing:a})};b.getConnectedStartTime=function(){return this.$6[k.CALL_CONNECTED]?this.$6[k.CALL_CONNECTED]+this.$15:0};b.getCurrentTimeFromCallConnected=function(){var a=this.$7[k.CALL_CONNECTED];return this.$61()-a};b.getMediaMetricTracker=function(){return this.$50};b.getEndCallReason=function(){return this.$34!=null?d("ScotchConstants").callEndReasonString(this.$34):"Unknown"};b.getRelayIP=function(){return this.$40};b.setRelayIP=function(a){this.$40=a};b.getClientVersion=function(){return this.$5};b.getHeartbeatData=function(){return this.$71()};b.wasCallEnded=function(){return this.$6[k.CALL_ENDED]!=null};return a}();a.CANONICAL_NULL_SUMMARY=Object.freeze(a.nullSummary());a.OLDEST_SUPPORTED_SUMMARY_VERSION=19;a.CURRENT_SUMMARY_VERSION=24;a.REPORT_KEY="reportID";g["default"]=a}),98);
__d("ScotchFBRTCCallSummaryStore",["CacheStorage","FBLogger","ScotchFBRTCCallSummary","ScotchRTCLogger","ScotchRTWebUserActionLogger","areEqual","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h="localstorage",i="RTC_CALL_SUMMARY_",j="summary",k=2e3,l=3,m=3*60*1e3,n=null;a=function(){a.getInstance=function(){n||(n=new a());return n};function a(){this.$1=new(c("CacheStorage"))(h,i),this.$2=c("ScotchRTCLogger").getInstance()}var b=a.prototype;b.storeCallSummary=function(a,b,d){if(d.isNull()){c("ScotchRTWebUserActionLogger").logError({errorDomain:"ScotchFBRTCCallSummaryStore_storeCallSummary",errorType:"ScotchFBRTCCallSummaryStore Storing invalid ScotchFBRTCCallSummary!",callID:b});c("FBLogger")("rtweb").mustfix("Storing invalid ScotchFBRTCCallSummary!");return}var e=this;this.$3(function(c){c[a]||(c[a]={});var f=c[a][b];if(f){f=e.$4(f);if(f&&f.getLastUpdatedTime()>d.getLastUpdatedTime()){e.$2.logToConsole("Outdated summaries");return null}}c[a][b]=e.$5(d);return c},e.$2.logError.bind(e.$2,a,b))};b.retrieveCallSummary=function(a,b){var c=this.getCallSummaries(),d=null;c[a]&&(d=c[a][b]);if(d)return this.$4(d);else return null};b.removeCallSummary=function(a,b){this.removeCallSummaries([{peerID:a,callID:b}])};b.removeCallSummaries=function(a){var b=this;this.$3(function(c){var d=a.length;for(var e=0;e<d;e++){var f=a[e].peerID,g=a[e].callID;c[f]&&c[f][g]&&(delete c[f][g],b.$6(c[f])&&delete c[f])}return c},this.$2.logError.bind(this.$2,null,null))};b.getLoggableSummaries=function(){var a=this.getCallSummaries(),b=[];for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c))for(var d in a[c])if(Object.prototype.hasOwnProperty.call(a[c],d)){var e=this.$4(a[c][d],m);e&&b.push(e)}return b};b.$6=function(a){for(var b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0};b.$5=function(a){a={__t:Date.now(),__d:a.toJsonString()};return a};b.$4=function(a,b){return a&&(!b||Date.now()-a.__t>=b)?c("ScotchFBRTCCallSummary").fromJsonString(a.__d):null};b.getCallSummaries=function(){var a=this.$1.get(j)||{};return a};b.$3=function(a,b,d,e){d===void 0&&(d=l);(d===void 0||d===null)&&(d=l);var f=this.getCallSummaries(),g=this.getCallSummaries();f=a(f);if(f===null)return;var h=this.getCallSummaries();if(c("areEqual")(g,h))this.$1.set(j,f),this.logStorageError(this.$1.getLastSetException());else if(d>0){b("Retry lock");if(e){var i=this;c("setTimeout")(function(){i.$3(a,b,d-1,!0)},k)}else this.$3(a,b,d-1,!0)}else b("Failed to lock")};b.logStorageError=function(a){a!=null&&c("ScotchRTWebUserActionLogger").logError({errorDomain:"ScotchFBRTCCallSummaryStore_storeCallSummary",errorType:a.name})};return a}();g["default"]=a}),98);
__d("ScotchFBRTCIceCache",[],(function(a,b,c,d,e,f){a=function(){function a(){this.$1=new Map()}var b=a.prototype;b.getCache=function(){var a={};for(var b=this.$1,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;var f=e[0];e=e[1];a[f]={};for(var e=e,g=Array.isArray(e),h=0,e=g?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=e.length)break;i=e[h++]}else{h=e.next();if(h.done)break;i=h.value}i=i;var j=i[0];i=i[1];a[f][j]=i}}return a};b.reset=function(a,b){var c=this.$1.get(a);c||(c=new Map(),this.$1.set(a,c));c.set(b,[])};b.cacheCandidate=function(a,b,c){var d=this.$1.get(a);d||(d=new Map(),this.$1.set(a,d));a=d.get(b);a||(a=[],d.set(b,a));a.unshift(c)};b.drainCandidates=function(a,b,c){a=this.$1.get(a);if(a){a=a.get(b)||[];while(a.length>0){b=a.pop();c(b)}}};return a}();f["default"]=a}),66);
__d("FBRTCExperiment",["FBRTCExperimentsConfig","QE2Logger"],(function(a,b,c,d,e,f,g){"use strict";a=function(){a.gen=function(b){var d={params:{},auto_exposure:!1,in_experiment:!1};d=c("FBRTCExperimentsConfig")[b]||d;b=new a(b,d);return b};a.getIncomingCallExperiments=function(){return a.gen("rtweb_incoming_call_experiments")};a.getMediaQualityExperiments=function(){return a.gen("rtc_www_media_quality_h2_2018")};a.getUpsellMessengerDesktopUnsupportedBrowser=function(){return a.gen("upsell_messenger_desktop_unsupported_browser_universe")};function a(a,b){this.$1=a,this.$2=b}var b=a.prototype;b.$3=function(){this.$2.auto_exposure&&this.logExposure()};b.logExposure=function(){this.$2.in_experiment&&d("QE2Logger").logExposureForUser(this.$1)};b.getParam=function(a,b){if(this.$2.in_experiment){this.$3();a=this.$2.params[a];if(a!==void 0)return String(a)}return b};b.getInt=function(a,b){if(this.$2.in_experiment){this.$3();if(this.$2.params[a]!==void 0)return parseInt(this.$2.params[a],10)}return b};b.getBool=function(a,b,c){c===void 0&&(c=!0);var d=this.$2.params;if(this.$2.in_experiment){c&&this.$3();if(d[a]!==void 0)return d[a]==="1"||d[a]===1||d[a]==="true"||d[a]===!0}return b};return a}();g["default"]=a}),98);
__d("ScotchFBRTCMessage",["FBRTCConstants","FBRTCExperiment","RTWebIncomingRingConfiguration","ScotchFBRTCSdpUtils","ZenonSignalingProtocol"],(function(a,b,c,d,e,f){var g="mobile";a=function(){"use strict";function a(a){var b;if(!this.$1(a))throw new Error("invalid webrtc message");this.originalMessageData=a;this.peerID=a.from;this.selfID=(b=a.to)!=null?b:null;this.callID=parseInt(a.call_id,10);this.msg=JSON.parse(a.payload);this.msg.json_payload&&(this.escalationName=this.msg.sessionName,this.msg=this.msg.json_payload);this.msgType=this.msg.type;this.msgID=this.msg.msg_id;this.ackID=this.msg.ack_id;this.source=a.source;this.peerSupportsVideoInterop=!!this.msg.supports_video_interop;this.$2();this.$3();this.$4();this.$5()}var c=a.prototype;c.$1=function(a){return a.from&&a.call_id&&a.payload};c.$2=function(){if(this.peerSupportsVideoInterop)return;this.isFromMobile()&&this.disableVideo()};c.disableVideo=function(){this.msg.sdp&&(this.msg.sdp=b("ScotchFBRTCSdpUtils").disableVideo(this.msg.sdp)),(this.msgType===b("FBRTCConstants").PayloadType.SET_VIDEO||this.msgType===b("FBRTCConstants").PayloadType.OFFER||this.msgType===b("FBRTCConstants").PayloadType.ICERESTART_OFFER||this.msgType===b("FBRTCConstants").PayloadType.ANSWER||this.msgType===b("FBRTCConstants").PayloadType.ICERESTART_ANSWER)&&(this.msg.videoon=!1)};c.$3=function(){this.isFromMobile()&&this.msg.sdp&&this.msgType!==b("FBRTCConstants").PayloadType.ICE_CANDIDATE&&(this.msg.sdp=b("ScotchFBRTCSdpUtils").removeRED(this.msg.sdp))};c.$4=function(){this.isFromMobile()&&b("RTWebIncomingRingConfiguration").isSupportedClientForProtocol(b("ZenonSignalingProtocol").P2P)&&this.msg.sdp&&this.msgType!==b("FBRTCConstants").PayloadType.ICE_CANDIDATE&&(this.msg.sdp=b("ScotchFBRTCSdpUtils").removeH264(this.msg.sdp))};c.$5=function(){if(this.isFromMobile()&&b("RTWebIncomingRingConfiguration").isSupportedClientForProtocol(b("ZenonSignalingProtocol").P2P)&&this.msg.sdp&&this.msgType!==b("FBRTCConstants").PayloadType.ICE_CANDIDATE){var a=b("FBRTCExperiment").gen("rtc_browser_use_vp9");a.getBool("allow_vp9",!1)||(this.msg.sdp=b("ScotchFBRTCSdpUtils").removeVP9(this.msg.sdp))}};c.isOffer=function(){return this.msgType===b("FBRTCConstants").PayloadType.OFFER};c.isFromMobile=function(){return this.source===g};c.isRemoteVideoSupported=function(){return!this.msg.sdp||this.msgType===b("FBRTCConstants").PayloadType.ICE_CANDIDATE?!0:b("ScotchFBRTCSdpUtils").isVideoSupported(this.msg.sdp)};c.isRetry=function(){return!!this.msg.flag};c.isForCall=function(a,c){return this.escalationName&&(this.msgType===b("FBRTCConstants").PayloadType.HANGUP||this.msgType===b("FBRTCConstants").PayloadType.SWITCH_TO_MULTIWAY)?c===this.escalationName:!a||a===this.callID||this.msgType===b("FBRTCConstants").PayloadType.OFFER||this.msgType===b("FBRTCConstants").PayloadType.ICERESTART_OFFER||this.msgType===b("FBRTCConstants").PayloadType.PCRESTART_OFFER||this.msgType===b("FBRTCConstants").PayloadType.ICE_CANDIDATE};c.getSignalingExperiments=function(){if(this.isFromMobile()){if(!this.msg.experiments)return["sdp_update"];this.msg.experiments.includes("sdp_update")||this.msg.experiments.push("sdp_update")}return this.msg.experiments};return a}();e.exports=a}),null);
__d("ScotchFBRTCMessageDedup",[],(function(a,b,c,d,e,f){var g={};function a(a,b,c){g[a]||(g[a]={});g[a][b]||(g[a][b]={});if(g[a][b][c])return!1;g[a][b][c]=!0;return!0}f.check=a}),66);
__d("RTWebLoggingSharedInstance",["ChannelClientID"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=d("ChannelClientID").getID()}var b=a.prototype;b.getDeviceID=function(){return this.$1};return a}();b=new a();g["default"]=b}),98);
__d("RTWebUserActionLogger",["CurrentUser","FBRTCConsoleLogger","RTWebLoggingSharedInstance","RtcWebUserActionsDebugFalcoEvent","RtcWebUserActionsFalcoEvent","ZenonBrowsers","ZenonSDESKeyDetector","immutable","performanceNow","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$2=c("immutable").Map(),this.$3=new Set(),this.$4=new Set(),this.$5=c("RTWebLoggingSharedInstance").getDeviceID(),this.$6=this.$7(),this.clearCache()}var b=a.prototype;b.clearCache=function(){this.$1={callID:void 0,callType:void 0,mediaType:void 0,conferenceName:void 0,conferenceState:void 0}};b.logImpression=function(a){this.logEvent(babelHelpers["extends"]({eventName:"impression"},a))};b.logPreCallImpression=function(a){this.clearCache(),this.logImpression(a)};b.logPreCallClick=function(a){this.clearCache(),this.logClick(a)};b.logClick=function(a){this.logEvent(babelHelpers["extends"]({eventName:"tap"},a))};b.logError=function(a){this.logEvent(babelHelpers["extends"]({eventName:"error"},a))};b.startTimer=function(a){var b=c("performanceNow")();this.$2=this.$2.set(a,b);this.logCheckpoint({checkpoint:a+"_timerStart"});this.$8(a,{startTime:b})};b.logStopTimer=function(a){var b=a.checkpointName===void 0?a.timerName:a.checkpointName,c=a.event||{};c.timeElapsed=this.$9(a.timerName);this.logCheckpoint(babelHelpers["extends"]({checkpoint:b+"_timerEnd"},c));return c.timeElapsed};b.logCheckpoint=function(a){this.logEvent(babelHelpers["extends"]({eventName:"checkpoint"},a))};b.$10=function(a){return a===null||a===void 0};b.logEvent=function(a){if(c("ZenonSDESKeyDetector")(a))throw c("unrecoverableViolation")("RTWebUserActionLogger event contains SDES crypto key! This log entry must be removed!","rtc_www");var b=this.$1;b.callID=this.$10(a.callID)?b.callID:a.callID;b.callType=a.callType||b.callType;b.conferenceState=a.conferenceState||b.conferenceState;b.conferenceName=this.$10(a.conferenceName)?b.conferenceName:a.conferenceName;b.isCaller=a.isCaller==null?b.isCaller:a.isCaller;b.mediaType=a.mediaType||b.mediaType;this.$11(a,b);b=this.$12(a,b);this.$8(a.eventName,b)};b.$12=function(a,b){var d={call_type:b.callType,client_time:Date.now().toString(),device_id:this.$5,error_domain:a.errorDomain,error_type:a.errorType,component:a.component,conference_state:b.conferenceState,event:a.eventName,media_type:b.mediaType,page:this.$6,call_id:b.callID,conference_name:b.conferenceName,surface:a.surface,checkpoint:a.checkpoint,event_time_elapsed:(a=a.timeElapsed)==null?void 0:a.toString(),is_caller:b.isCaller,codebase_version:"Old Codebase"};c("RtcWebUserActionsFalcoEvent").log(function(){return d});return d};b.$11=function(a,b){var d={call_type:b.callType,client_time:Date.now().toString(),device_id:this.$5,error_domain:a.errorDomain,error_type:a.errorType,component:a.component,conference_state:b.conferenceState,event:a.eventName,media_type:b.mediaType,page:this.$6,call_id:b.callID,conference_name:b.conferenceName,surface:a.surface,checkpoint:a.checkpoint,event_time_elapsed:(a=a.timeElapsed)==null?void 0:a.toString(),is_caller:b.isCaller,codebase_version:"Old Codebase"};c("RtcWebUserActionsDebugFalcoEvent").log(function(){return d});return d};b.getCallType=function(a,b){b===void 0&&(b=!1);if(a===null||a===void 0)return null;if(a)return"mw";else if(b)return"escalated";else return"p2p"};b.getAudioVideoComponent=function(a){return a===null||a===void 0?null:a?"audio_button":"video_button"};b.getMediaType=function(a,b){b===void 0&&(b=!1);if(b)return"escalated";else if(a)return"audio";else return"video"};b.logErrorOnceforDomain=function(a,b){this.$3.has(a)||(this.$3.add(a),this.logError({errorDomain:a,errorType:b.toString()}))};b.logCheckpointOnceForDomain=function(a){var b=a.checkpoint;this.$4.has(b)||(this.$4.add(b),this.logCheckpoint(a))};b.clearLoggedDomains=function(){this.$3.clear(),this.$4.clear()};b.getWebLoggerInfoFromStore=function(a){a=a.callInfo;var b=a.callID,c=a.conferenceName;a=a.conferenceState;return{callID:b,conferenceName:c,conferenceState:a}};b.$7=function(){if(d("ZenonBrowsers").isMobileDevice())return"mweb";else if(c("CurrentUser").isWorkUser())return"workplace";var a=window.location.hostname;if(a.search("facebook")!==-1)return"facebook";else if(a.search("messenger")!==-1)return"messenger_dot_com";return a};b.$9=function(a){var b=this.$2.get(a);if(b){this.$2=this.$2.remove(a);return parseInt(c("performanceNow")()-b,10)}return null};b.$8=function(a,b){a=a==null?"null":a;c("FBRTCConsoleLogger").getInstance().getLogHistory().log(a,JSON.stringify(b))};return a}();b=new a();g["default"]=b}),98);
__d("FBRTCLogger",["CurrentUser","FBLogger","FBRTCConsoleLogger","FBRTCMessageType","FBRTCRtcResponseStatusCode","FacebookAppIDs","MarauderLogger","ODS","P2pReliabilityFalcoEvent","RTWebLoggingSharedInstance","RTWebUserActionLogger","RtcCallActionFalcoEvent","RtcInfraReliabilityFalcoEvent","RtcTslogFalcoEvent","UserAgentData","gkx","pageID"],(function(a,b,c,d,e,f,g){var h="rtc_client_call_summary",i="client_error",j="client_event",k="info",l="received_message",m="send_failed",n="send_succeeded",o="sent_message",p="RECEIVED_RESPONSE",q="RECEIVED_REQUEST",r="PROCESSING_REQUEST",s="PROCESSED_REQUEST",t="PROCESSING_REQUEST_FAILED",u="PROCESSED_RESPONSE",v="START_PROCESSING_RESPONSE",w="SENDING_RESPONSE",x="RELAY_CONNECTED",y="BEGIN_SET_REMOTE_DESCRIPTION",z="END_SET_REMOTE_DESCRIPTION",A="BEGIN_REMOTE_SDP_MUNGING",B="END_REMOTE_SDP_MUNGING",C="SENDING_REQUEST",D="SENT_REQUEST",E="SENT_RESPONSE",F="SEND_REQUEST_FAILED",G="SEND_RESPONSE_FAILED",H=null;a=function(){a.getInstance=function(){H==null&&(H=new a());return H};a.multiwayMessageTypeName=function(a){switch(a){case c("FBRTCMessageType").JOIN:return"JOIN";case c("FBRTCMessageType").SERVER_MEDIA_UPDATE:return"SERVER_MEDIA_UPDATE";case c("FBRTCMessageType").HANGUP:return"HANGUP";case c("FBRTCMessageType").ICE_CANDIDATE:return"ICE_CANDIDATE";case c("FBRTCMessageType").RING:return"RING";case c("FBRTCMessageType").DISMISS:return"DISMISS";case c("FBRTCMessageType").CONFERENCE_STATE:return"CONFERENCE_STATE";case c("FBRTCMessageType").ADD_PARTICIPANTS:return"ADD_PARTICIPANTS";case c("FBRTCMessageType").SUBSCRIPTION:return"SUBSCRIPTION";case c("FBRTCMessageType").CLIENT_MEDIA_UPDATE:return"CLIENT_MEDIA_UPDATE";case c("FBRTCMessageType").DATA_MESSAGE:return"DATA_MESSAGE";case c("FBRTCMessageType").REMOVE_PARTICIPANTS:return"REMOVE_PARTICIPANTS";case c("FBRTCMessageType").CONNECT:return"CONNECT";case c("FBRTCMessageType").PING:return"PING";case c("FBRTCMessageType").P2P_PROTOCOL:return"P2P_PROTOCOL";case c("FBRTCMessageType").UPDATE:return"UPDATE";case c("FBRTCMessageType").NOTIFY:return"NOTIFY";case c("FBRTCMessageType").CLIENT_EVENT:return"CLIENT_EVENT";case c("FBRTCMessageType").UNSUBSCRIBE:return"UNSUBSCRIBE"}return a.toString()};function a(){var a=this;this.logError=function(b,d,e){var f,g={call_id:d,content:e,peer_id:b};f=c("FBLogger")("rtweb").addMetadata("RT_WEB","CALL_ID",""+((f=d)!=null?f:"null")).addMetadata("RT_WEB","PEER_ID",""+((f=b)!=null?f:"null"));if(typeof e==="string")f.warn(e);else{var h=JSON.stringify(e);f.warn((f=h)!=null?f:"Unknown error")}a.$9(i,g);a.$5(b,d,"Error",JSON.stringify(e))};this.$2=JSON.stringify({version:2,device:c("UserAgentData").deviceName,os:c("UserAgentData").platformName,os_version:c("UserAgentData").platformFullVersion,browser:c("UserAgentData").browserName,browser_version:c("UserAgentData").browserFullVersion});this.$3=JSON.stringify({version:2,device:c("UserAgentData").deviceName,os:c("UserAgentData").platformName,os_version:c("UserAgentData").platformFullVersion,browser:c("UserAgentData").browserName,browser_version:c("UserAgentData").browserFullVersion,msg_source:"web"});this.$1=c("RTWebLoggingSharedInstance").getDeviceID();this.$4=c("FacebookAppIDs").MQTT_WEB}var b=a.prototype;b.logToConsole=function(a){this.$5(null,null,"Console",a)};b.$6=function(a,b,d,e,f,g,h){var i=this;c("P2pReliabilityFalcoEvent").log(function(){return{app_id:i.$4.toString(),call_id:a,device_id:i.$1,result_code:h==null?void 0:h.toString(),event_name:b,extra:i.$2,msg_id:e,msg_type:d.toUpperCase(),raw_time:String(Date.now()),receiver_id:g,sender_id:f,service_name:"WEB_CLIENT"}})};b.logMultiwayMessageReceived=function(b,c){var d=a.multiwayMessageTypeName(b.type());this.$5(b.conferenceName(),c,"Received MW",d+", "+b.transactionId(),d==="EXPERIMENT"?"DEBUG":"INFO");b.isRequest()&&this.$7(q,b.conferenceName(),b.serverInfoData(),b.transactionId(),a.multiwayMessageTypeName(b.type()),b.header().retryCount,c?c.toString():null)};b.$8=function(b,c,d,e){if(!c.isRequest())return;this.$7(b,c.conferenceName(),c.serverInfoData(),c.transactionId(),a.multiwayMessageTypeName(c.type()),c.header().retryCount,d?d.toString():null,e?e:null)};b.logServerRequestStartProcessing=function(a,b){this.$8(r,a,b)};b.logServerRequestDoneProcessing=function(a,b){this.$8(s,a,b)};b.logServerRequestFailedProcessing=function(a,b,c){this.$8(t,a,b,c)};b.logMultiwayResponseReceived=function(b,d){try{var e=b.header.responseStatusCode;e===c("FBRTCRtcResponseStatusCode").OK&&this.$7(p,b.header.conferenceName,b.header.serverInfoData,b.header.transactionId,a.multiwayMessageTypeName(b.header.type),b.header.retryCount,d)}catch(a){this.logErrorWithoutID(a)}};b.logMultiwayResponseStartProcessing=function(b,c,d){this.$7(v,b.conferenceName,b.serverInfoData,b.transactionId,a.multiwayMessageTypeName(b.type),b.retryCount,c,d)};b.logMultiwayResponseProcessed=function(b,d,e){try{var f=b.responseStatusCode;f===c("FBRTCRtcResponseStatusCode").OK&&this.$7(u,b.conferenceName,b.serverInfoData,b.transactionId,a.multiwayMessageTypeName(b.type),b.retryCount,d,e)}catch(a){this.logErrorWithoutID(a)}};b.logMultiwayResponseProcessedFromResponsePayload=function(a,b,d){try{var e=a.header.responseStatusCode;e===c("FBRTCRtcResponseStatusCode").OK&&this.logMultiwayResponseProcessed(a.header,b,d)}catch(a){this.logErrorWithoutID(a)}};b.logSendingMultiwayMessage=function(b){this.$7(b.isRequest()?C:w,b.conferenceName(),b.serverInfoData(),b.transactionId(),a.multiwayMessageTypeName(b.type()),b.header().retryCount,b.header().clientSessionId)};b.logSentMultiwayMessage=function(b){this.$7(b.isRequest()?D:E,b.conferenceName(),b.serverInfoData(),b.transactionId(),a.multiwayMessageTypeName(b.type()),b.header().retryCount,b.header().clientSessionId)};b.logSendMultiwayMessageFailed=function(b){this.$7(b.isRequest()?F:G,b.conferenceName(),b.serverInfoData(),b.transactionId(),a.multiwayMessageTypeName(b.type()),b.header().retryCount,b.header().clientSessionId)};b.logSendMultiwayMessageFailure=function(a){d("ODS").bumpEntityKey(4083,"scotch_multiway","send_message_failure"),d("ODS").flush(),c("RTWebUserActionLogger").logCheckpoint({checkpoint:"Failed to send MW message, error: "+a})};b.logMultiwayRelayConnected=function(a,b,c){this.$7(x,a,b,null,null,null,c)};b.logMultiwayBeginSetRemoteDescription=function(b){this.$7(y,b.conferenceName,b.serverInfoData,b.transactionId,a.multiwayMessageTypeName(b.type),b.retryCount,b.clientSessionId)};b.logMultiwayEndSetRemoteDescription=function(b){this.$7(z,b.conferenceName,b.serverInfoData,b.transactionId,a.multiwayMessageTypeName(b.type),b.retryCount,b.clientSessionId)};b.logMultiwayBeginRemoteSdpMunging=function(b){this.$7(A,b.conferenceName,b.serverInfoData,b.transactionId,a.multiwayMessageTypeName(b.type),b.retryCount,b.clientSessionId)};b.logMultiwayEndRemoteSdpMunging=function(b){this.$7(B,b.conferenceName,b.serverInfoData,b.transactionId,a.multiwayMessageTypeName(b.type),b.retryCount,b.clientSessionId)};b.$7=function(a,b,d,e,f,g,h,i){var j=this;c("RtcInfraReliabilityFalcoEvent").log(function(){return{event_name:a,client_session_id:h,data:{extra_data:i},tc:Date.now(),conference_name:b,server_info_data:d,message_type:f,transaction_id:e,retry_count:g,web_device_id:j.$1,web_app_id:j.$4,version:"0"}})};b.logReceivedMessage=function(a,b,d){var e=b?b.toString():null,f={call_id:b,from:a,msg_id:d.msg_id,type:d.type};d.sdp&&(f.content=d.sdp);d.ack_id&&(f.ack_msg_id=d.ack_id);var g=d.type||d.msgType;this.$6(e,"CLIENT_RECEIVED_MESSAGE",g,d.msg_id,a,c("CurrentUser").getID());this.$9(l,f);this.$5(a,b,"Received P2P",d.type+", "+d.msg_id)};b.logSentMessage=function(a,b,d){var e=b?b.toString():null,f={call_id:b,msg_id:d.msg_id,to:a,type:d.type};d.sdp&&(f.content=d.sdp);d.ack_id&&(f.ack_msg_id=d.ack_id);this.$6(e,"CLIENT_SENDING_MESSAGE",d.type,d.msg_id,c("CurrentUser").getID(),a);this.$9(o,f);this.$5(a,b,"Sent",d.type+", "+d.msg_id)};b.logSentMessageSuccess=function(a,b,d,e){var f={call_id:b,msg_id:e,peer_id:a,type:d};b=b?b.toString():null;this.$6(b,"CLIENT_TRANSPORT_SUCCESS",d,e.toString(),c("CurrentUser").getID(),a);this.$9(n,f)};b.logSentMessageFailure=function(a,b,d,e,f){var g={call_id:b,error_code:f,msg_id:e,peer_id:a,type:d},h=b?b.toString():null;this.$6(h,"CLIENT_TRANSPORT_ERROR",d,e.toString(),c("CurrentUser").getID(),a,f);this.$9(m,g);this.$5(a,b,"Send Failed",d+", "+f)};b.logCallAction=function(a,b,d,e,f){var g={call_action:d,call_id:b,content:e,peer_id:a};f&&(g.trigger=f);c("RtcCallActionFalcoEvent").logImmediately(function(){return{action_name:d,call_id:"",audio_output_name:"UNKNOWN",rownum:-1,logging_instance_id:-1,logger_schema_version:-1,caller_id:"",call_type:"UNKNOWN",session_type:"UNKNOWN",seconds_since_call_start:-1,ms_since_epoch:-1,ms_steady:-1,device_orientation:"UNKNOWN",interface_orientation:"UNKNOWN",battery_level:-1,battery_plugged_state:"UNKNOWN",battery_charge_state:"UNKNOWN",battery_mode:"UNKNOWN",camera_facing:"UNKNOWN"}});this.$5(a,b,"CallAction",d+", "+JSON.stringify(e))};b.logEvent=function(a,b,c){var d={call_id:b,content:c,peer_id:a};this.$9(j,d);this.$5(a,b,"Event",JSON.stringify(c))};b.logInfo=function(a,b,c){var d={call_id:b,content:c,peer_id:a};this.$9(k,d);this.$5(a,b,"Info",JSON.stringify(c))};b.logErrorWithoutID=function(a){this.logError(null,null,a)};b.logEndCallSummary=function(a,b){b===void 0&&(b=!1);if(!a)return;c("RTWebUserActionLogger").logCheckpoint({checkpoint:"Attempting to upload CallSummary",callID:a.callID});var d={call_id:a.callID,channel_session_id:a.deviceID,content:a.toString(),local_call_id:a.localCallID,peer_id:a.peerID,tag:"endcallstats"},e=babelHelpers["extends"]({},d,a.getExtraInfo());this.$9(h,e,b);this.$5(a.peerID,a.callID,"Call Summary",JSON.stringify(d));c("RTWebUserActionLogger").logCheckpoint({checkpoint:"Complete uploading CallSummary",callID:a.callID})};b.logTsLogData=function(a,b,d,e,f){f===void 0&&(f=null);if(!b||!d||a.streams.length===0)return;c("RTWebUserActionLogger").logCheckpoint({checkpoint:"Attempting to upload tslog",callID:d});var g=b;f&&(g=null);var h=JSON.stringify(a);c("RtcTslogFalcoEvent").logImmediately(function(){return{call_id:d,conf_name:e,time_series1:h,serv_info:f,peer_id:g}});this.$5(b,d,"TSLog Data",h);c("RTWebUserActionLogger").logCheckpoint({checkpoint:"Complete uploading tslog",callID:d})};b.doesContainSensitiveData=function(a){return String(a).indexOf("crypto")>-1};b.redactSensitiveData=function(a,b){if(a!==h){a=JSON.stringify(b);if(this.doesContainSensitiveData(a))return{redacted:!0}}return b};b.$9=function(a,b,e){e===void 0&&(e=!1);var f="basic";e&&(f=c("gkx")("1488912")?"vital":"signal");b.page_id=c("pageID");e=this.redactSensitiveData(a,b);c("FBRTCConsoleLogger").getInstance().getLogHistory().log(a,e);d("MarauderLogger").log(a,c("FBRTCConsoleLogger").MODULE_NAME,e,void 0,void 0,void 0,void 0,f)};b.$5=function(a,b,d,e,f){f===void 0&&(f="DEBUG"),c("FBRTCConsoleLogger").getInstance().log(this.doesContainSensitiveData(e)?"redacted":e,a,b,d,f)};return a}();a.CallAction=Object.freeze({ANSWER_CALL:"answer_call",AUTO_DISABLE_VIDEO:"auto_disable_video",DENIED_PERMISSION:"denied_permission",END_CALL:"end_call",FAILED_GETTING_URI:"failed_getting_uri",OLD_URI:"old_uri",OPEN_POPUP:"open_popup",POPUP_OPENED:"popup_opened",RECEIVED_CALL:"received_call",SET_FULLSCREEN_ON:"set_fullscreen_on",SET_MUTE:"set_mute",SET_SELF_VIEW_ON:"set_self_view_on",SET_VIDEO_ON:"set_video_on",START_CALL:"start_call",START_SKYPE:"start_skype",TRY_NEW:"try_new",USER_SETTINGS_CHANGED:"user_settings_changed"});a.Trigger=Object.freeze({ADMIN_MESSAGE:"admin_message",CHAT_TAB_ICON_TOUR:"chat_tab_icon_tour",CHAT_TAB_ICON:"chat_tab_icon",CHAT_TAB_VOICE_ICON:"chat_tab_voice_icon",MULTIWAY_ADMIN_MESSAGE_JOIN_AUDIO_CALL_BUTTON:"multiway_admin_message_join_audio_call_button",MULTIWAY_ADMIN_MESSAGE_JOIN_VIDEO_CALL_BUTTON:"multiway_admin_message_join_video_call_button",MULTIWAY_ADMIN_MESSAGE_START_AUDIO_CALL_BUTTON:"multiway_admin_message_start_audio_call_button",MULTIWAY_ADMIN_MESSAGE_START_VIDEO_CALL_BUTTON:"multiway_admin_message_start_video_call_button",MULTIWAY_CHAT_TAB_SHEET_JOIN_CALL_BUTTON:"multiway_chat_tab_sheet_join_call_button",MULTIWAY_POPUP_START_CALL_BUTTON:"multiway_popup_start_call_button",MULTIWAY_THREAD_HEADER_AUDIO_BUTTON:"multiway_thread_header_audio_button",MULTIWAY_THREAD_HEADER_JOIN_AUDIO_CALL_AUDIO_BUTTON:"multiway_thread_header_join_audio_call_audio_button",MULTIWAY_THREAD_HEADER_JOIN_AUDIO_CALL_VIDEO_BUTTON:"multiway_thread_header_join_audio_call_video_button",MULTIWAY_THREAD_HEADER_JOIN_VIDEO_CALL_AUDIO_BUTTON:"multiway_thread_header_join_video_call_audio_button",MULTIWAY_THREAD_HEADER_JOIN_VIDEO_CALL_VIDEO_BUTTON:"multiway_thread_header_join_video_call_video_button",MULTIWAY_THREAD_HEADER_VIDEO_BUTTON:"multiway_thread_header_video_button",MULTIWAY_THREAD_LIST_JOIN_CALL_BUTTON:"multiway_thread_list_join_call_button",POPUP_CALL_START_BUTTON:"popup_start_call_button",REDIAL_BUTTON:"redial_button",RESET_CALL:"install_screen_sharing_ext_dialog",RETURN_CALL:"return_call",SKYPE_DEPRECATION_DIALOG:"skype_deprecation_dialog",TIMELINE_PROFILE:"timeline_profile",VC_PRECALL_SETUP:"vc_precall_setup",WORKPLACE_GROUP_CALL:"workplace_group_call",WORKPLACE_P2P_CALL:"workplace_p2p_call",UNKNOWN:"unknown",WEB_MESSENGER:"web_messenger",TEAMWORK_USER_VIDEO_CALL_ITEM:"teamwork_user_video_call_item",TEAMWORK_USER_AUDIO_CALL_ITEM:"teamwork_user_audio_call_item"});a.Key=Object.freeze({BATTERY_START:"battery_start",BATTERY_END:"battery_end",CALL_TYPE:"call_type",CONNECTION_EFFECTIVE_TYPE:"conn_effective_type",CPU_CORES:"cpu_cores",DEVICE_INFO:"device_info",DEVICE_MEMORY:"device_memory",DEVICE_PIXEL_RATIO:"device_pixel_ratio",INITIATED_BY_PAGE_ID:"initiated_by_page_id",INITIATED_BY_APP_ID:"initiated_by_app_id",PEER_IS_MOBILE:"peer_is_mobile",RATING_SHOWN:"rating_shown",RATING:"rating5",ROOM_SURFACE:"room_surface",EFFECT_COUNT:"rtc_effect_count",EFFECT_TOTAL_DURATION:"rtc_effect_total_duration",VIDEO_DURATION_WITH_FILTER:"rtc_video_duration_with_filter_enabled",SCREEN_DURATION:"screen_duration",SURVEY_CHOICE:"survey_choice",SURVEY_DETAILS:"survey_details",SURVEY_SHOWN:"survey_shown",MEDIA_INPUTS:"media_inputs",VIDEO_CAPABILITIES:"video_capabilities",CB_ACTIVE:"cb_active",YEAR_CLASS:"year_class",DESKTOP_DEVICE_CLASS:"desktop_device_class",IS_BACKGROUNDED:"is_backgrounded",APPLICATION_STATE:"application_state",MAX_CONCURRENT_CONNECTED_PARTICIPANTS:"max_concurrent_connected_participants"});g["default"]=a}),98);
__d("ScotchFBRTCVersionDetection",["UserAgent","UserAgentData"],(function(a,b,c,d,e,f,g){function a(){return c("UserAgent").isBrowser("Chrome")}function b(){return c("UserAgent").isBrowser("Firefox")}function d(){return c("UserAgent").isBrowser("Edge (Chromium Based)")}function e(){return!!navigator.webkitGetUserMedia}function f(){if(this.isFirefox()||this.isChrome()||this.isChromiumBasedEdge())return c("UserAgentData").browserVersion||0;if(this.isChromium()){var a=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return a!=null?parseInt(a[2],10):999}return 0}g.isChrome=a;g.isFirefox=b;g.isChromiumBasedEdge=d;g.isChromium=e;g.webrtcVersion=f}),98);
__d("ZenonUserCapabilities",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({GROUP_COWATCH:"GROUP_COWATCH",Cowatch:"cowatch",DesktopBrowser:"desktop_browser",DisableScreenSharing:"disable_screen_sharing",MultipleStreamsPlanB:"multiple_streams_plan_b",MultipleStreamsUnified:"multiple_streams_unified",MWeb:"mweb",ScreenSharing:"screen_sharing",VideoEscalationByUnmute:"video_escalation_by_unmute",WWW:"www"});c=a;f["default"]=c}),66);
__d("ScotchFBRTCScreenSharingUtils",["ScotchFBRTCVersionDetection","ScotchRTCUtils","ZenonBrowsers","ZenonRTWebBrowserFeatureSupport","ZenonUserCapabilities"],(function(a,b,c,d,e,f,g){"use strict";function a(){return(d("ScotchFBRTCVersionDetection").isChrome()||d("ScotchFBRTCVersionDetection").isChromiumBasedEdge())&&d("ScotchFBRTCVersionDetection").webrtcVersion()>=34}function b(){return!d("ZenonBrowsers").isMobileDevice()&&(d("ScotchFBRTCVersionDetection").isChromium()&&d("ScotchFBRTCVersionDetection").webrtcVersion()>=34||d("ScotchRTCUtils").isVCScreenSharingSupported())}function e(a){if(d("ZenonRTWebBrowserFeatureSupport").isReplaceTrackSupported())return!0;return a.remoteSupport(c("ZenonUserCapabilities").ScreenSharing)?!0:!1}g.isSupportedBrowser=a;g.canUserReceiveScreenSharing=b;g.canPeerReceiveScreenSharing=e}),98);
__d("ScotchFBRTCUserCapabilities",["ScotchFBRTCScreenSharingUtils","ZenonBrowsers","ZenonUserCapabilities"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(b){this.$2=new Set(),this.$1=new Set(a.getLocal()),b&&(this.$2=new Set(b))}var b=a.prototype;b.getLocal=function(){return Array.from(this.$1)};b.setRemote=function(b){return!b?this:new a(b)};b.getRemote=function(){return Array.from(this.$2)};b.support=function(a){return this.localSupport(a)&&this.remoteSupport(a)};b.localSupport=function(a){return this.$1.has(a)};b.remoteSupport=function(a){return this.$2.has(a)};a.getLocal=function(){var a=[];d("ScotchFBRTCScreenSharingUtils").canUserReceiveScreenSharing()&&a.push(c("ZenonUserCapabilities").ScreenSharing);d("ZenonBrowsers").isMobileDevice()?a.push(c("ZenonUserCapabilities").MWeb):a.push(c("ZenonUserCapabilities").WWW);d("ZenonBrowsers").videoEscalationByUnmuteWorkaround()&&a.push(c("ZenonUserCapabilities").VideoEscalationByUnmute);a.push(c("ZenonUserCapabilities").Cowatch);a.push(c("ZenonUserCapabilities").GROUP_COWATCH);return a};return a}();g["default"]=a}),98);
__d("ScotchRTCOneVCStoreState",["immutable"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("immutable").Record({meetingID:null,meetingPassword:null,participants:[]}));g["default"]=a}),98);
__d("ScotchRTCOneVCStore",["invariant","FluxReduceStore","ScotchRTCAppDispatcher","ScotchRTCOneVCStoreState","ZenonRTCConfig"],(function(a,b,c,d,e,f,g,h){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b;b=a.call(this,c("ScotchRTCAppDispatcher"))||this;b.reduce=function(a,b){switch(b.type){case"SET_MEETING_ID":return a.set("meetingID",b.meetingID);case"SET_MEETING_PASSWORD":return a.set("meetingPassword",b.meetingPassword);case"STORE_PARTICIPANTS":b=i(b.participants);return a.set("participants",b);default:return a}};return b}var d=b.prototype;d.getInitialState=function(){return new(c("ScotchRTCOneVCStoreState"))()};d.getParticipantsSummary=function(){var a=this.getState().participants;return a.length===0?{audioParticipants:0,videoParticipants:0}:a.reduce(function(a,b){b=b.video_mute.some(function(a){return a!==!1});return b?{audioParticipants:a.audioParticipants+1,videoParticipants:a.videoParticipants}:{audioParticipants:a.audioParticipants,videoParticipants:a.videoParticipants+1}},{audioParticipants:0,videoParticipants:0})};d.getParticipants=function(){return this.getState().participants};return b}(c("FluxReduceStore"));a.__moduleID=f.id;function i(a){var b=d("ZenonRTCConfig").getMeetingID();b!=null||h(0,11961);var c="Facebook (Meeting ID: "+b+")";return a.filter(function(a){return!a.peer_name.includes(c)})}b=new a();g["default"]=b}),98);
__d("ScotchgenerateRTCSignalingMessageID",["randomInt"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("randomInt")(0,4294967294)+1}g["default"]=a}),98);
__d("XVideoCallSendMessageController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/sendmessage/",{recipient_id:{type:"Int",required:!0},msg_id:{type:"Int",required:!0},message_info:{type:"String",required:!0},webrtc_fbtrace:{type:"Int"},device_id:{type:"String"}})}),null);
__d("ScotchFBRTCMessageSender",["errorCode","ChannelClientID","CurrentUser","FBRTCConstants","FBRTCLocalUploadLogLevel","FBRTCLogger","PresenceProperties","RTWebIncomingRingConfiguration","ScotchFBRTCUserCapabilities","ScotchFBRTCUtils","ScotchgenerateRTCSignalingMessageID","XVideoCallSendMessageController","ZenonSignalingProtocol"],(function(a,b,c,d,e,f,g){var h=0;a=function(){"use strict";function a(){this.onSendFailure=null,this.$1=b("FBRTCLogger").getInstance()}var c=a.prototype;c.sendOffer=function(a,c,d,e,f,g){return this.$2(b("FBRTCConstants").PayloadType.OFFER,a,c,d,e,f,null,g)};c.sendAnswer=function(a,c,d,e,f,g){return this.$2(b("FBRTCConstants").PayloadType.ANSWER,a,c,d,e,f,g)};c.sendPCRestartOffer=function(a,c,d,e,f){return this.$2(b("FBRTCConstants").PayloadType.PCRESTART_OFFER,a,c,d,e,f)};c.sendSdpUpdate=function(a,c,d,e,f){return this.$2(b("FBRTCConstants").PayloadType.SDP_UPDATE,a,c,d,e,f)};c.resendSdpMessage=function(a,b){b.flag=1,this.$3(a,b)};c.resendPayload=function(a,b){b.flag=1,this.$4(a,b)};c.$2=function(a,c,d,e,f,g,h,i){d=this.$5(d,a);d.sdp=e;a===b("FBRTCConstants").PayloadType.OFFER&&(d.browser_supports_escalation=b("RTWebIncomingRingConfiguration").isSupportedClientForProtocol(b("ZenonSignalingProtocol").MW),d.handlescollision=!0,d.pranswer=!1,i&&(d.call_trigger=i));a===b("FBRTCConstants").PayloadType.ANSWER&&h&&(d.escalation_conference_name=h.escalationConferenceName,d.negotiated_escalation_support=h.negotiatedEscalationSupport);(a===b("FBRTCConstants").PayloadType.OFFER||a===b("FBRTCConstants").PayloadType.ANSWER||a===b("FBRTCConstants").PayloadType.PCRESTART_OFFER)&&(d.icerestart=!1,d.experiments=b("ScotchFBRTCUserCapabilities").getLocal());d.videoon=f;d.attributes=g;d.ull=b("FBRTCConstants").convertFromUploadLogLevel(b("FBRTCLocalUploadLogLevel").getLocalUploadLogLevel());this.$3(c,d);return d};c.sendIceCandidate=function(a,c,d){c=this.$5(c,b("FBRTCConstants").PayloadType.ICE_CANDIDATE);c.sdp_mid=d.sdpMid;c.label=d.sdpMLineIndex;c.sdp=d.candidate;this.$4(a,c)};c.sendHangup=function(a,c,d,e,f){c=this.$5(c,b("FBRTCConstants").PayloadType.HANGUP);c.reason=b("FBRTCConstants").callEndReasonString(d);c.subreason=f||"";this.$4(a,c,e,!0)};c.sendOtherDismiss=function(a){a=this.$5(a,b("FBRTCConstants").PayloadType.OTHER_DISMISS);this.$4(b("CurrentUser").getID(),a)};c.sendOfferAck=function(a,c,d,e){e===void 0&&(e=new Map()),this.$6(a,c,d,b("FBRTCConstants").PayloadType.OFFER_ACK,e)};c.sendOfferNack=function(a,c,d){this.$6(a,c,d,b("FBRTCConstants").PayloadType.OFFER_NACK,new Map([["error_code",1356043]]))};c.sendAnswerAck=function(a,c,d){this.$6(a,c,d,b("FBRTCConstants").PayloadType.ANSWER_ACK)};c.sendAck=function(a,c,d){this.$6(a,c,d,b("FBRTCConstants").PayloadType.ACK,new Map([["ack_type",d.type]]))};c.sendMuteStateUpdate=function(a,c,d){c=this.$5(c,b("FBRTCConstants").PayloadType.SET_VIDEO);c.videoon=d;this.$4(a,c)};c.sendClientReportedEvent=function(a,c,d){c=this.$5(c,b("FBRTCConstants").PayloadType.CLIENT_REPORTED_EVENT);c.event_type=d;this.$4(a,c)};c.sendVideoEscalationRequest=function(a,b,c){return this.sendVideoRequestResponse(a,b,0,c)};c.sendVideoRequestResponse=function(a,c,d,e){c=this.$5(c,b("FBRTCConstants").PayloadType.VIDEO_REQUEST);c.ack_id=d;c.videoon=e;c.capability=b("PresenceProperties").getProperties();this.$4(a,c);return c};c.sendMsgAck=function(){};c.sendOk=function(){};c.sendPranswer=function(){};c.sendIcerestartAnswer=function(){};c.$5=function(a,c){var d=b("ScotchgenerateRTCSignalingMessageID")();a={version:h,type:c,call_id:a,msg_id:d};this.$7(c)&&(a.supports_video_interop=!0);return a};c.$7=function(a){return a===b("FBRTCConstants").PayloadType.OFFER||a===b("FBRTCConstants").PayloadType.ANSWER||a===b("FBRTCConstants").PayloadType.PRANSWER||a===b("FBRTCConstants").PayloadType.ICERESTART_OFFER||a===b("FBRTCConstants").PayloadType.ICERESTART_ANSWER||a===b("FBRTCConstants").PayloadType.PCRESTART_OFFER||a===b("FBRTCConstants").PayloadType.PCRESTART_ANSWER||a===b("FBRTCConstants").PayloadType.SDP_UPDATE||a===b("FBRTCConstants").PayloadType.SET_VIDEO||a===b("FBRTCConstants").PayloadType.VIDEO_REQUEST};c.$3=function(a,b){this.$4(a,b,!1,!0,!0)};c.$6=function(a,c,d,e){var f=(arguments.length<=4?void 0:arguments[4])||new Map(),g=this.$5(c,e);g.ack_id=d.msg_id;d.flag===1&&(g.flag=1);g.ull=b("FBRTCConstants").convertFromUploadLogLevel(b("FBRTCLocalUploadLogLevel").getLocalUploadLogLevel());f.forEach(function(a,b,c){g[b]=a});this.$4(a,g)};c.$4=function(a,c,d,e,f){var g=c.msg_id,h={peer_id:a,call_id:c.call_id,msg_id:g,msg_type:c.type};g=b("XVideoCallSendMessageController").getURIBuilder().setInt("recipient_id",a).setInt("msg_id",g).setString("message_info",JSON.stringify(c)).setString("device_id",b("ChannelClientID").getID()).getURI();var i=null;e&&(i=this.$4.bind(this,a,c,d,!1,f));e=this.$8.bind(this,h);h=this.$9.bind(this,h,i,f);b("ScotchFBRTCUtils").sendServerRequest(g,e,h,d);this.onMessageSent&&this.onMessageSent(a,c);this.$1.logSentMessage(a,c.call_id,c)};c.$8=function(a){this.$1.logSentMessageSuccess(a.peer_id,a.call_id,a.msg_type,a.msg_id)};c.$9=function(a,c,d,e){var f="UNKNOWN_ERROR";e&&(f=e.getError?e.getError():e);this.$1.logSentMessageFailure(a.peer_id,a.call_id,a.msg_type,a.msg_id,f);e=null;f===1356001||f===1356049?e=b("FBRTCConstants").CallEndReason.NO_PERMISSION:f===1356046?e=b("FBRTCConstants").CallEndReason.CALLER_NOT_VISIBLE:(f===1356003||f===1356002||f===1356044)&&(e=b("FBRTCConstants").CallEndReason.OTHER_NOT_CAPABLE);if(!e&&c){c();return}d&&this.onSendFailure&&(e||(e=b("FBRTCConstants").CallEndReason.SIGNALING_MESSAGE_FAILED),this.onSendFailure(e,f,a.msg_type))};return a}();e.exports=a}),null);
__d("flatMapArray",[],(function(a,b,c,d,e,f){var g=Array.prototype.push;function a(a,b){var c=[];for(var d=0;d<a.length;d++){var e=b.call(a,a[d],d);if(Array.isArray(e))g.apply(c,e);else if(e!=null)throw new TypeError('flatMapArray: Callback must return an array or null, received "'+e.toString()+'" instead')}return c}f["default"]=a}),66);
__d("ScotchFBRTCPeerConnectionHelper",["MediaStream","Promise","ScotchRTCP2PProtocolHandler","flatMapArray","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var d=!1,e=a.getLocalStreams(),f=e.filter(function(a){return!b.includes(a)}),g=b.filter(function(a){return!e.includes(a)});(f.length>0||g.length>0)&&(d=!0);f.forEach(function(b){return a.removeStream(b)});g.forEach(function(b){return a.addStream(b)});if(c("ScotchRTCP2PProtocolHandler").supportMultipleStreams()===!1){g=e.filter(function(a){return!f.includes(a)});g=c("flatMapArray")(g,function(b){return a.addStream(b)});g.length>0&&(d=!0)}return d}function d(a,b,c){var d=!1,e=b.getVideoTracks().length>0?b.getVideoTracks()[0]:null,f=b.getAudioTracks().length>0?b.getAudioTracks()[0]:null,g=a.getSenders(),h=g.filter(function(a){return a.track&&a.track.kind==="video"}),i=g.filter(function(a){return a.track&&a.track.kind==="audio"});h=h.length===(e===null?0:1)&&i.length===(f===null?0:1);if(c||!h){g.filter(function(a){return a.track!==e&&a.track!==e}).forEach(function(b){d=!0,a.removeTrack(b)});f&&!g.some(function(a){return a.track===f})&&(d=!0,a.addTrack(f,b));e&&!g.some(function(a){return a.track===e})&&(d=!0,a.addTrack(e,b));return d}a.getSenders().forEach(function(a){a.track&&a.track.kind==="video"&&e!==a.track?a.replaceTrack(e):a.track&&a.track.kind==="audio"&&f!==a.track&&a.replaceTrack(f)});return d}function e(a,d,e){var f,g,i,j,k,l,m,n,o,p,q,r,s,t;return b("regeneratorRuntime").async(function(u){while(1)switch(u.prev=u.next){case 0:j=a.getSenders();k=(f=a.getLocalStreams()[0])!=null?f:new(c("MediaStream"))();l=(g=e==null?void 0:e.getAudioTracks()[0])!=null?g:d.getAudioTracks()[0];m=(i=e==null?void 0:e.getVideoTracks()[0])!=null?i:d.getVideoTracks()[0];n=[];l!=null&&n.push(l);m!=null&&n.push(m);k.getTracks().forEach(function(a){n.includes(a)===!1&&k.removeTrack(a)});n.forEach(function(a){k.addTrack(a)});o=j.filter(function(a){return((a=a.track)==null?void 0:a.kind)==="audio"})[0];p=j.filter(function(a){return((a=a.track)==null?void 0:a.kind)==="video"})[0];u.next=13;return b("regeneratorRuntime").awrap(b("Promise").all([h(a,l,o),h(a,m,p)]));case 13:q=u.sent;r=q[0];s=q[1];t=a.addStream(k);return u.abrupt("return",r||s||t.length>0);case 18:case"end":return u.stop()}},null,this)}function h(a,c,d){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:e=!1;if(!(c!=null)){f.next=8;break}if(!(d!=null&&d.track!==null)){f.next=6;break}if(!(c!==d.track)){f.next=6;break}f.next=6;return b("regeneratorRuntime").awrap(d.replaceTrack(c));case 6:f.next=9;break;case 8:d!=null&&d.track!==null&&(a.removeTrack(d),e=!0);case 9:return f.abrupt("return",e);case 10:case"end":return f.stop()}},null,this)}g.resetLocalStreams=a;g.resetLocalStreamWithTrackAPI=d;g.resetLocalStreamsByTrack=e}),98);
__d("MercuryIDs",["gkx"],(function(a,b,c,d,e,f){"use strict";var g={isValid:function(a){return a==null||a===""||typeof a!=="string"?!1:/^\w{3,12}:.+/.test(a)},isValidThreadID:function(a){if(!g.isValid(a))return!1;a=g.tokenize(a);switch(a.type){case"user":case"support":case"thread":case"root":return!0;default:return(a.type==="pending"||a.type==="group")&&!b("gkx")("863760")?!0:!1}},tokenize:function(a){if(a==null||a===""||!g.isValid(a))throw new Error("bad_id_format "+String(a));var b=a.indexOf(":");return{type:a.substr(0,b),value:a.substr(b+1)}},getUserIDFromParticipantID:function(a){if(!g.isValid(a))throw new Error("bad_id_format "+a);a=g.tokenize(a);var b=a.type;a=a.value;return b==="fbid"?a:null},getParticipantIDFromUserID:function(a){if(isNaN(a))throw new Error("Not a user ID: "+a);return"fbid:"+a},getUserIDFromThreadID:function(a){return!this.isCanonical(a)?null:this.tokenize(a).value},getThreadIDFromUserID:function(a){return"user:"+a},getThreadIDFromThreadFBID:function(a){return"thread:"+a},getThreadIDFromSupportInboxItemID:function(a){return"support:"+a},getThreadFBIDFromThreadID:function(a){return this.tokenize(a).value},getThreadKeyfromThreadIDUserID:function(a,b){if(a==null||a===""||!g.isValid(a))throw new Error("bad_id_format "+String(a));var c=this.tokenize(a).type;a=this.tokenize(a).value;if(c!=="user")return"g"+a;c="";var d="";if(a.length!==b.length)a.length>b.length?(c=a,d=b):(c=b,d=a);else if(b===a)return b+"u"+a;else{var e=0;while(e<a.length&&e<b.length)if(a[e]===b[e])e++;else{a[e]>b[e]?(c=a,d=b):(c=b,d=a);break}}return d+"u"+c},getThreadIDFromParticipantID:function(a){a=this.getUserIDFromParticipantID(a);return a?this.getThreadIDFromUserID(a):null},getParticipantIDFromFromThreadID:function(a){a=this.getUserIDFromThreadID(a);return a?this.getParticipantIDFromUserID(a):null},getSupportInboxItemIDFromThreadID:function(a){return this.tokenize(a).value},isCanonical:function(a){return this.isValid(a)&&this.tokenize(a).type==="user"},isGroupChat:function(a){return this.isValid(a)&&this.tokenize(a).type!=="user"},isLocalThread:function(a){return this.isValid(a)&&this.tokenize(a).type==="root"}};e.exports=g}),null);
__d("MercurySyncDeltaTypes",[],(function(a,b,c,d,e,f){"use strict";a={AdminAddedToGroupThread:"AdminAddedToGroupThread",AdminRemovedFromGroupThread:"AdminRemovedFromGroupThread",AdminTextMessage:"AdminTextMessage",ChangeViewerStatus:"ChangeViewerStatus",DeliveryReceipt:"DeliveryReceipt",ForcedFetch:"ForcedFetch",MarkRead:"MarkRead",MarkUnread:"MarkUnread",MarkFolderSeen:"MarkFolderSeen",MessageDelete:"MessageDelete",NewMessage:"NewMessage",NoOp:"NoOp",PagesManagerEvent:"PagesManagerEvent",ParticipantLeftGroupThread:"ParticipantLeftGroupThread",ParticipantsAddedToGroupThread:"ParticipantsAddedToGroupThread",ReadReceipt:"ReadReceipt",ReplaceMessage:"ReplaceMessage",ThreadAction:"ThreadAction",ThreadDelete:"ThreadDelete",ThreadFolder:"ThreadFolder",ThreadMuteSettings:"ThreadMuteSettings",ThreadName:"ThreadName",JoinableMode:"JoinableMode",ApprovalMode:"ApprovalMode",ApprovalQueue:"ApprovalQueue",ClientPayload:"ClientPayload",GenieMessage:"GenieMessage",MontageMessage:"MontageMessage",RtcCallData:"RtcCallData"};b=a;f["default"]=b}),66);
__d("ImmutableValue",["invariant","isNode"],(function(a,b,c,d,e,f,g){"use strict";var h="_DONT_EVER_TYPE_THIS_SECRET_KEY";a=function(){function a(b){b===a[h]||g(0,5608)}a.mergeAllPropertiesInto=function(a,b){var c=b.length;for(var d=0;d<c;d++)Object.assign(a,b[d])};a.deepFreezeRootNode=function(c){if(b("isNode")(c))return;Object.freeze(c);for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&a.recurseDeepFreeze(c[d]);Object.seal(c)};a.recurseDeepFreeze=function(c){if(b("isNode")(c)||!a.shouldRecurseFreeze(c))return;Object.freeze(c);for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&a.recurseDeepFreeze(c[d]);Object.seal(c)};a.shouldRecurseFreeze=function(b){return typeof b==="object"&&!(b instanceof a)&&b!==null};return a}();a._DONT_EVER_TYPE_THIS_SECRET_KEY=Math.random();f["default"]=a}),66);
__d("mergeHelpers",["invariant","FbtResultBase"],(function(a,b,c,d,e,f,g,h){"use strict";var i=36,j=function(a){return typeof a!=="object"||a instanceof Date||a===null||a instanceof c("FbtResultBase")},k={MAX_MERGE_DEPTH:i,isTerminal:j,normalizeMergeArg:function(a){return a==null?{}:a},checkMergeArrayArgs:function(a,b){Array.isArray(a)&&Array.isArray(b)||h(0,3714,a,b)},checkMergeObjectArgs:function(a,b){k.checkMergeObjectArg(a),k.checkMergeObjectArg(b)},checkMergeObjectArg:function(a){!j(a)&&!Array.isArray(a)||h(0,3715,a)},checkMergeIntoObjectArg:function(a){(!j(a)||typeof a==="function")&&!Array.isArray(a)||h(0,3716,a)},checkMergeLevel:function(a){a<i||h(0,3717)},checkArrayStrategy:function(a){a==null||a in k.ArrayStrategies||h(0,3718)},ArrayStrategies:{Clobber:"Clobber",Concat:"Concat",IndexByIndex:"IndexByIndex"}};a=k;g["default"]=a}),98);
__d("ImmutableObject",["invariant","ImmutableValue","mergeHelpers"],(function(a,b,c,d,e,f,g){"use strict";var h=b("mergeHelpers").checkMergeObjectArgs,i=b("mergeHelpers").isTerminal,j="_DONT_EVER_TYPE_THIS_SECRET_KEY";function k(a){a instanceof b("ImmutableValue")||g(0,3884)}var l=function(c){babelHelpers.inheritsLoose(a,c);function a(){var a;a=c.call(this,b("ImmutableValue")[j])||this;b("ImmutableValue").mergeAllPropertiesInto(babelHelpers.assertThisInitialized(a),arguments);return a}a.set=function(b,c){k(b);typeof c==="object"&&c!==void 0&&!Array.isArray(c)||g(0,3885);return new a(b,c)};a.setProperty=function(b,c,d){var e={};e[c]=d;return a.set(b,e)};a.deleteProperty=function(b,c){var d={};for(var e in b)e!==c&&Object.prototype.hasOwnProperty.call(b,e)&&(d[e]=b[e]);return new a(d)};a.setDeep=function(a,b){k(a);return m(a,b)};a.values=function(a){return Object.keys(a).map(function(b){return a[b]})};return a}(b("ImmutableValue"));function m(a,c){h(a,c);var d={},e=Object.keys(a);for(var f=0;f<e.length;f++){var g=e[f];!Object.prototype.hasOwnProperty.call(c,g)?d[g]=a[g]:i(a[g])||i(c[g])?d[g]=c[g]:d[g]=m(a[g],c[g])}g=Object.keys(c);for(f=0;f<g.length;f++){e=g[f];if(Object.prototype.hasOwnProperty.call(a,e))continue;d[e]=c[e]}return a instanceof b("ImmutableValue")?new l(d):c instanceof b("ImmutableValue")?new l(d):d}e.exports=l}),null);
__d("MercuryAssert",["MercuryIDs"],(function(a,b,c,d,e,f,g){function a(a){if(a==null)throw new Error("participant_id null/undefined");if(!d("MercuryIDs").isValid(a))throw new Error("bad_participant_id "+a)}function b(a){a.forEach(this.isParticipantID)}function c(a){var b=d("MercuryIDs").tokenize(a);if(a==null)throw new Error("participant_id null/undefined");if(b.type!="fbid")throw new Error("bad_user_id "+a)}function e(a){var b=d("MercuryIDs").tokenize(a);if(a==null)throw new Error("participant_id null/undefined");if(b.type!="email")throw new Error("bad_email_id "+a)}function f(a){a.forEach(this.isThreadID)}function h(a){if(a==null)throw new Error("participant_id null/undefined");if(!d("MercuryIDs").isValid(a))throw new Error("bad_thread_id "+a)}g.isParticipantID=a;g.allParticipantIDs=b;g.isUserParticipantID=c;g.isEmailParticipantID=e;g.allThreadID=f;g.isThreadID=h}),98);
__d("MercuryParticipantTypes",[],(function(a,b,c,d,e,f){a=Object.freeze({USER:"user",THREAD:"thread",EVENT:"event",PAGE:"page",FRIEND:"friend",FB4C:"fb4c",NON_FRIEND:"non_friend",SERVICE:"service",GUEST:"guest",PARENT_APPROVED_USER:"parent_approved_user",MESSAGE:"message",ASSISTANT_TYPEAHEAD:"assistant_typeahead"});f["default"]=a}),66);
__d("bs_caml_option",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a.BS_PRIVATE_NESTED_SOME_NONE!==void 0}function g(a){if(a===void 0)return{BS_PRIVATE_NESTED_SOME_NONE:0};else if(a!==null&&a.BS_PRIVATE_NESTED_SOME_NONE!==void 0)return{BS_PRIVATE_NESTED_SOME_NONE:a.BS_PRIVATE_NESTED_SOME_NONE+1|0};else return a}function b(a){if(a==null)return;else return g(a)}function c(a){if(a===void 0)return;else return g(a)}function d(a){if(a===null)return;else return g(a)}function h(a){if(!(a!==null&&a.BS_PRIVATE_NESTED_SOME_NONE!==void 0))return a;a=a.BS_PRIVATE_NESTED_SOME_NONE;if(a===0)return;else return{BS_PRIVATE_NESTED_SOME_NONE:a-1|0}}function e(a){if(a===void 0)return;else return h(a)}function i(a){if(a!==void 0)return a.VAL;else return a}f.nullable_to_opt=b;f.undefined_to_opt=c;f.null_to_opt=d;f.valFromOption=h;f.some=g;f.isNested=a;f.option_get=e;f.option_unwrap=i}),null);
__d("bs_js_dict",["bs_caml_option"],(function(a,b,c,d,e,f){"use strict";function a(a,c){if(c in a)return b("bs_caml_option").some(a[c])}var g=function(a,b){delete a[b]};function c(a){var b=Object.keys(a),c=b.length,d=new Array(c);for(var e=0;e<c;++e){var f=b[e];d[e]=[f,a[f]]}return d}function d(a){var b=Object.keys(a),c=b.length,d=new Array(c);for(var e=0;e<c;++e)d[e]=a[b[e]];return d}function e(a){var b={};a=a;while(!0){var c=a;if(!c)return b;var d=c.hd;b[d[0]]=d[1];a=c.tl;continue}}function h(a){var b={},c=a.length;for(var d=0;d<c;++d){var e=a[d];b[e[0]]=e[1]}return b}function i(a,b){var c={},d=Object.keys(b),e=d.length;for(var f=0;f<e;++f){var g=d[f];c[g]=a(b[g])}return c}f.get=a;f.unsafeDeleteKey=g;f.entries=c;f.values=d;f.fromList=e;f.fromArray=h;f.map=i}),null);
__d("bs_js_null_undefined",["bs_caml_option"],(function(a,b,c,d,e,f){"use strict";function a(a,b){if(a==null)return a;else return b(a)}function c(a,b){if(!(a==null))return b(a)}function d(a){if(a!==void 0)return b("bs_caml_option").valFromOption(a)}e=d;f.bind=a;f.iter=c;f.fromOption=d;f.from_opt=e}),null);
__d("MercuryVanityIDMap.bs",["MercuryAssert","bs_js_dict","bs_js_null_undefined"],(function(a,b,c,d,e,f){"use strict";var g={},h={};function a(a){return b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(g,a.toLowerCase()))}function c(a){return b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(h,a))}function d(a){return b("bs_js_dict").get(h,a)!==void 0}function e(a){return b("bs_js_dict").get(g,a.toLowerCase())!==void 0}function i(a,c){b("MercuryAssert").isParticipantID(c);a=a.toLowerCase();g[a]=c;h[c]=a}f.vanityToID=g;f.idToVanity=h;f.getID=a;f.getVanity=c;f.hasID=d;f.hasVanity=e;f.set=i}),null);
__d("WebGraphQLLegacyHelper",["invariant"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a){var b=a.controller,c=a.docID,d=a.queryID;a=a.variables;c!=d&&(c||d)!=null||h(0,5819,c,d);b=b.getURIBuilder();d?b.setFBID("query_id",d):b.setFBID("doc_id",c);a&&b.setString("variables",JSON.stringify(a));return b.getURI()}g.getURI=a}),98);
__d("XWebGraphQLQueryController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/webgraphql/query/",{query_id:{type:"FBID"},variables:{type:"String"},doc_id:{type:"FBID"}})}),null);
__d("WebGraphQLQueryBase",["invariant","WebGraphQLLegacyHelper","XWebGraphQLQueryController"],(function(a,b,c,d,e,f,g,h){"use strict";a=function(){function a(a){this.$1=a}var b=a.prototype;b.__getVariables=function(){return this.$1};b.__getDocID=function(){return this.constructor.__getDocID()};a.__getController=function(){return c("XWebGraphQLQueryController")};a.__getDocID=function(){h(0,1804)};a.getURI=function(a){return d("WebGraphQLLegacyHelper").getURI({controller:this.__getController(),docID:this.__getDocID(),variables:a})};a.getLegacyURI=function(a){return d("WebGraphQLLegacyHelper").getURI({controller:this.__getController(),queryID:this.getQueryID(),variables:a})};a.getQueryID=function(){h(0,5095)};return a}();g["default"]=a}),98);
__d("MessengerParticipantsWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"4405414552848179"};b.getQueryID=function(){return"151141687209678"};return b}(b("WebGraphQLQueryBase"))}),null);
__d("DisplayGenderConst",[],(function(a,b,c,d,e,f){a=Object.freeze({UNKNOWN:"UNKNOWN",FEMALE:"FEMALE",MALE:"MALE",NEUTER:"NEUTER"});f["default"]=a}),66);
__d("MessageThreadUnsendabilityStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({CAN_UNSEND:"can_unsend",DENY_FOR_SPECIFIC_IDS:"deny_for_specific_ids",DENY_IF_THREAD_CONTAINS_PAU:"deny_if_thread_contains_pau",DENY_IF_THREAD_CONTAINS_WORK_USER:"deny_if_thread_contains_work_user",DENY_IF_THREAD_CONTAINS_WORK_USER_FAILING_KILLSWITCH:"deny_if_thread_contains_work_user_failing_killswitch",DENY_IF_PAGE_THREAD:"deny_if_page_thread",DENY_IF_MARKETPLACE_THREAD:"deny_if_marketplace_thread",DENY_IF_CANNOT_LOAD_THREAD:"deny_if_cannot_load_thread",DENY_IF_CANONICAL_THREAD_CONTAINS_BLOCKED_USERS:"deny_if_canonical_thread_contains_blocked_users",DENY_IF_CANNOT_REPLY_TO_VIEWER_THREAD:"deny_if_cannot_reply_to_viewer_thread"});f["default"]=a}),66);
__d("MessageThreadUnsendabilityStatus.bs",["MessageThreadUnsendabilityStatus"],(function(a,b,c,d,e,f){"use strict";function a(a){if(a==null)return null;switch(a){case"can_unsend":return b("MessageThreadUnsendabilityStatus").CAN_UNSEND;case"deny_for_specific_ids":return b("MessageThreadUnsendabilityStatus").DENY_FOR_SPECIFIC_IDS;case"deny_if_cannot_load_thread":return b("MessageThreadUnsendabilityStatus").DENY_IF_CANNOT_LOAD_THREAD;case"deny_if_marketplace_thread":return b("MessageThreadUnsendabilityStatus").DENY_IF_MARKETPLACE_THREAD;case"deny_if_page_thread":return b("MessageThreadUnsendabilityStatus").DENY_IF_PAGE_THREAD;case"deny_if_thread_contains_pau":return b("MessageThreadUnsendabilityStatus").DENY_IF_THREAD_CONTAINS_PAU;default:return null}}f.fromNullableString=a}),null);
__d("MessagingThreadType",[],(function(a,b,c,d,e,f){a=Object.freeze({ONE_TO_ONE:1,GROUP:2,ROOM:3,MONTAGE:4,MARKETPLACE:5,FOLDER:6,TINCAN_ONE_TO_ONE:7,TINCAN_GROUP_DISAPPEARING:8,CARRIER_MESSAGING_ONE_TO_ONE:10,CARRIER_MESSAGING_GROUP:11,TINCAN_ONE_TO_ONE_DISAPPEARING:13,PAGE_FOLLOW_UP:14,SECURE_MESSAGE_OVER_WA_ONE_TO_ONE:15,SECURE_MESSAGE_OVER_WA_GROUP:16,COMMUNITY_FOLDER:17,COMMUNITY_GROUP:18,COMMUNITY_GROUP_UNJOINED:19,COMMUNITY_CHANNEL_CATEGORY:20});f["default"]=a}),66);
__d("MercuryAttachmentContentType",[],(function(a,b,c,d,e,f){a=Object.freeze({PHOTO:"attach:image",VIDEO:"attach:video",MUSIC:"attach:music",VOICE:"attach:voice",TEXT:"attach:text",PDF:"attach:pdf",RICHTEXT:"attach:richtext",SPREADSHEET:"attach:spreadsheet",PRESENTATION:"attach:presentation",ARCHIVE:"attach:archive",MSWORD:"attach:ms:word",MSXLS:"attach:ms:xls",MSPPT:"attach:ms:ppt",ORION:"attach:orion",SHOERACK_INVITATION:"attach:shoerackinvite",UNKNOWN:"attach:unknown"});f["default"]=a}),66);
__d("MercuryAttachmentType",[],(function(a,b,c,d,e,f){a=Object.freeze({AUDIO:"audio",ERROR:"error",FILE:"file",PHOTO:"photo",STICKER:"sticker",SHARE:"share",UNKNOWN:"unknown",VIDEO:"video",ANIMATED_IMAGE:"animated_image",EMOJI_LIKE:"emoji_like",GIFT:"gift",THIRDPARTYSTICKER:"third_party_sticker"});f["default"]=a}),66);
__d("MessageSharedMediaIDStore.bs",["bs_js_dict"],(function(a,b,c,d,e,f){"use strict";var g={};function a(a,b){g[a]=b}function c(a){a=b("bs_js_dict").get(g,a);if(a!==void 0)return a;else return null}f._store=g;f.setMessageIDForAttachmentID=a;f.getMessageIDForAttachmentID=c}),null);
__d("FundsAvailability",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({NONE:0,FUNDS_AVAILABILITY_NA:65,FUNDS_AVAILABILITY_IMMEDIATE:73,FUNDS_AVAILABILITY_SAME_DAY:83,FUNDS_AVAILABILITY_NEXT_DAY:78,FUNDS_AVAILABILITY_TWO_DAY:80,FUNDS_AVAILABILITY_FIVE_DAY:70,FUNDS_AVAILABILITY_UNKNOWN:85,FUNDS_AVAILABILITY_ONE_THREE_DAY:79,FUNDS_AVAILABILITY_CROSS_BORDER:66,FUNDS_AVAILABILITY_CROSS_BORDER_FAST_FUNDS:67,FUNDS_AVAILABILITY_DOMESTIC:68,FUNDS_AVAILABILITY_DOMESTIC_FAST_FUNDS:69})}),null);
__d("LeadGenInfoFieldTypes",[],(function(a,b,c,d,e,f){a=Object.freeze({CUSTOM:"CUSTOM",CITY:"CITY",COMPANY_NAME:"COMPANY_NAME",COUNTRY:"COUNTRY",DOB:"DOB",EMAIL:"EMAIL",GENDER:"GENDER",FIRST_NAME:"FIRST_NAME",FULL_ADDRESS:"FULL_ADDRESS",FULL_NAME:"FULL_NAME",JOB_TITLE:"JOB_TITLE",LAST_NAME:"LAST_NAME",MARITIAL_STATUS:"MARITIAL_STATUS",PHONE:"PHONE",POST_CODE:"POST_CODE",PROVINCE:"PROVINCE",RELATIONSHIP_STATUS:"RELATIONSHIP_STATUS",STATE:"STATE",STREET_ADDRESS:"STREET_ADDRESS",ZIP:"ZIP",WORK_EMAIL:"WORK_EMAIL",MILITARY_STATUS:"MILITARY_STATUS",WORK_PHONE_NUMBER:"WORK_PHONE_NUMBER",STORE_LOOKUP:"STORE_LOOKUP",STORE_LOOKUP_WITH_TYPEAHEAD:"STORE_LOOKUP_WITH_TYPEAHEAD",DATE_TIME:"DATE_TIME",ID_CPF:"ID_CPF",ID_AR_DNI:"ID_AR_DNI",ID_CL_RUT:"ID_CL_RUT",ID_CO_CC:"ID_CO_CC",ID_EC_CI:"ID_EC_CI",ID_PE_DNI:"ID_PE_DNI",ID_MX_RFC:"ID_MX_RFC"});f["default"]=a}),66);
__d("MNCommerceBubbleType",[],(function(a,b,c,d,e,f){a=Object.freeze({FB_RETAIL_RECEIPT:1,FB_RETAIL_CANCELLATION:2,FB_RETAIL_SHIPMENT:3,FB_RETAIL_SHIPMENT_TRACKING_EVENT_ETA:4,FB_RETAIL_SHIPMENT_TRACKING_EVENT_IN_TRANSIT:5,FB_RETAIL_SHIPMENT_TRACKING_EVENT_OUT_FOR_DELIVERY:6,FB_RETAIL_SHIPMENT_TRACKING_EVENT_DELAYED:7,FB_RETAIL_SHIPMENT_TRACKING_EVENT_DELIVERED:8,FB_RETAIL_SHIPMENT_FOR_UNSUPPORTED_CARRIER:9,FB_RETAIL_SHIPMENT_ETA:10,FB_RETAIL_NOW_IN_STOCK:11,FB_RETAIL_AGENT_ITEM_SUGGESTION:12,FB_RETAIL_AGENT_ITEM_RECEIPT:13,FB_RETAIL_PROMOTIONAL_MSG:14});f["default"]=a}),66);
__d("MNCommerceCallToActionType",[],(function(a,b,c,d,e,f){a=Object.freeze({OPEN_NATIVE:1,OPEN_URL:2,POSTBACK:4,ACCOUNT_LINK:5,SHARE:7,PAYMENT:8,FACEBOOK_REPORT_A_PROBLEM:9,NAVIGATION:11,EXTENSIBLE_SHARE:12,OPEN_PAGE_ABOUT:14,OPEN_BRANDED_CAMERA:15,OPEN_THREAD:16,OPEN_MARKETPLACE_PROFILE_REPORT:17,OPEN_DIRECT_SEND_VIEW:18,BOOKING:19,BOOKING_ADD_TO_CALENDAR:20,BOOKING_CONFIRM:47,BOOKING_RESCHEDULE:48,ACCOUNT_UNLINK:21,RATE_SELLER:22,ROOMS_SPEAKEASY_INVITE:23,ROOMS_SPEAKEASY_INTERESTED:24,ROOMS_SPEAKEASY_EDIT:25,ROOMS_SPEAKEASY_UNDO:26,ROOMS_SPEAKEASY_CALLBACK:27,ROOMS_SPEAKEASY_COPY_LINK:32,ROOMS_SPEAKEASY_JOIN_WITHOUT_VIDEO:34,ROOMS_SPEAKEASY_JOIN_FROM_PORTAL:36,FB_LOGIN:28,FEEDBACK_SEND:29,SHOPS_PDP:30,OPEN_SHOPS_PRODUCT_VARIANT_PICKER:43,OPEN_DIALOG:31,RTC_NEW_AUDIO_DEFAULT:45,RTC_NEW_VIDEO_DEFAULT:35,RTC_NEW_VIDEO_FROM_FB_SHARE:38,RTC_NEW_VIDEO_FROM_FB_VIDEO_SHARE:40,RTC_NEW_VIDEO_FROM_COWATCH_SHARE:42,DISABLED:44,CUSTOMER_INFORMATION:46,SUBSCRIPTION_PRESELECT:10,OPEN_REACT_NATIVE_MINI_APP:13,OPEN_CANCEL_RIDE_MUTATION:3,MANAGE_MESSAGES:6});f["default"]=a}),66);
__d("P2PPaymentRequestStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({INITED:1,DECLINED:2,TRANSFER_INITED:3,TRANSFER_COMPLETED:4,TRANSFER_FAILED:5,CANCELED:6,EXPIRED:7});f["default"]=a}),66);
__d("P2PTransferStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({SYSTEM_FAILURE:0,PENDING_SENDER_MANUAL_REVIEW:1,PENDING_SENDER_VERIFICATION:2,CANCELED_SENDER_RISK:3,PENDING_RECIPIENT_NUX:4,CANCELED_DECLINED:5,PENDING_RECIPIENT_VERIFICATION:6,PENDING_RECIPIENT_MANUAL_REVIEW:7,PENDING_RECIPIENT_PROCESSING:8,PENDING_PUSH_FAIL:9,CANCELED_RECIPIENT_RISK:10,CANCELED_SYSTEM_FAIL:11,CANCELED_EXPIRED:12,COMPLETED:13,INTERMEDIATE_PROCESSING:14,PENDING_SENDER_INITED:15,CANCELED_SAME_CARD:16,PENDING_SENDER_VERIFICATION_PROCESSING:17,PENDING_RECIPIENT_VERIFICATION_PROCESSING:18,CANCELED_SENDER_CANCEL:19,PENDING_SENDER_IDV_REVIEW:20,PENDING_RECEIVER_IDV_REVIEW:21});f["default"]=a}),66);
__d("PaymentModulesClient",[],(function(a,b,c,d,e,f){a=Object.freeze({DONATION_P4P:"donation_p4p",MOR_DONATIONS:"mor_donations",PPGF_DONATION:"ppgf_donation",DONATION_P4C:"donation_p4c",INSTANT_EXPERIENCES:"instant_experiences",BUSINESS_PLATFORM_COMMERCE:"business_platform_commerce",MESSENGER_OMNIM:"messenger_omnim",MESSENGER_PLATFORM:"messenger_platform",PAGES_COMMERCE:"pages_commerce",MESSAGING_COMMERCE:"messaging_commerce",SHIPPING_LABEL:"shipping_label",SYNCHRONOUS_COMPONENT_FLOW:"synchronous_component_flow",PAGES_SOLUTION:"pages_solution",CHECKOUT_EXPERIENCES:"checkout_experiences",C2C_CHECKOUT_EXPERIENCES:"c2c_checkout_experiences",MOBILE_TOP_UP:"mobile_top_up",MOCK:"mock",ADVERTISER_SUBSCRIPTION:"advertiser_subscription",NMOR_FB_BROWSER_PAY:"fb_browser_payment"});f["default"]=a}),66);
__d("ServicesCalendarSyncType",[],(function(a,b,c,d,e,f){a=Object.freeze({CLIENT_ONLY:"client_only",NO_CALENDAR_SYNC:"no_calendar_sync",SERVER_CONTINUOUS:"server_continuous",SERVER_SINGLE:"server_single"});f["default"]=a}),66);
__d("bs_caml",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){if(a<b)return-1;else if(a===b)return 0;else return 1}function b(a,b){if(a)if(b)return 0;else return 1;else if(b)return-1;else return 0}function c(a,b){if(a===b)return 0;else if(a<b)return-1;else if(a>b||a===a)return 1;else if(b===b)return-1;else return 0}function d(a,b){if(a===b)return 0;else if(a<b)return-1;else return 1}function e(a,b){if(a)return b;else return a}function g(a,b){if(a<b)return a;else return b}function h(a,b){if(a<b)return a;else return b}function i(a,b){if(a<b)return a;else return b}function j(a,b){if(a<b)return a;else return b}function k(a,b){if(a)return a;else return b}function l(a,b){if(a>b)return a;else return b}function m(a,b){if(a>b)return a;else return b}function n(a,b){if(a>b)return a;else return b}function o(a,b){if(a>b)return a;else return b}function p(a,b){if(a[1]===b[1])return a[0]===b[0];else return!1}function q(a,b){var c=b[0],d=a[0];if(d>c)return!0;else if(d<c)return!1;else return a[1]>=b[1]}function r(a,b){return!p(a,b)}function s(a,b){return!q(a,b)}function t(a,b){if(a[0]>b[0])return!0;else if(a[0]<b[0])return!1;else return a[1]>b[1]}function u(a,b){return!t(a,b)}function v(a,b){if(q(a,b))return b;else return a}function w(a,b){if(t(a,b))return a;else return b}f.caml_int_compare=a;f.caml_bool_compare=b;f.caml_float_compare=c;f.caml_string_compare=d;f.caml_bool_min=e;f.caml_int_min=g;f.caml_float_min=h;f.caml_string_min=i;f.caml_int32_min=j;f.caml_bool_max=k;f.caml_int_max=l;f.caml_float_max=m;f.caml_string_max=n;f.caml_int32_max=o;f.i64_eq=p;f.i64_neq=r;f.i64_lt=s;f.i64_gt=t;f.i64_le=u;f.i64_ge=q;f.i64_min=v;f.i64_max=w}),null);
__d("bs_caml_format",["bs_caml","bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";function g(a){if(a>=65)if(a>=97)if(a>=123)return-1;else return a-87|0;else if(a>=91)return-1;else return a-55|0;else if(a>57||a<48)return-1;else return a-48|0}function h(a){switch(a){case 0:return 8;case 1:return 16;case 2:return 10;case 3:return 2}}function i(a){var b=1,c=2,d=0,e=a.charCodeAt(d);switch(e){case 43:d=d+1|0;break;case 44:break;case 45:b=-1;d=d+1|0;break;default:}if(a[d]==="0"){e=a.charCodeAt(d+1|0);if(e>=89)if(e>=111){if(e<121)switch(e){case 111:c=0;d=d+2|0;break;case 117:d=d+2|0;break;case 112:case 113:case 114:case 115:case 116:case 118:case 119:break;case 120:c=1;d=d+2|0;break}}else e===98&&(c=3,d=d+2|0);else if(e!==66){if(e>=79)switch(e){case 79:c=0;d=d+2|0;break;case 85:d=d+2|0;break;case 80:case 81:case 82:case 83:case 84:case 86:case 87:break;case 88:c=1;d=d+2|0;break}}else c=3,d=d+2|0}return[d,b,c]}function a(a){var b=i(a),c=b[0],d=h(b[2]),e=4294967295,f=a.length,j=c<f?a.charCodeAt(c):0;j=g(j);if(j<0||j>=d)throw{RE_EXN_ID:"Failure",_1:"int_of_string",Error:new Error()};var k=function(b,c){while(!0){var h=c,i=b;if(h===f)return i;var j=a.charCodeAt(h);if(j===95){c=h+1|0;continue}j=g(j);if(j<0||j>=d)throw{RE_EXN_ID:"Failure",_1:"int_of_string",Error:new Error()};i=d*i+j;if(i>e)throw{RE_EXN_ID:"Failure",_1:"int_of_string",Error:new Error()};c=h+1|0;b=i;continue}};b=b[1]*k(j,c+1|0);k=b|0;if(d===10&&b!==k)throw{RE_EXN_ID:"Failure",_1:"int_of_string",Error:new Error()};return k}function c(a){var c=i(a),d=c[2],e=c[0],f=b("bs_caml_int64").of_int32(h(d));c=b("bs_caml_int64").of_int32(c[1]);var j;switch(d){case 0:j=[536870911,4294967295];break;case 1:j=[268435455,4294967295];break;case 2:j=[429496729,2576980377];break;case 3:j=b("bs_caml_int64").max_int;break}var k=a.length;d=e<k?a.charCodeAt(e):0;d=b("bs_caml_int64").of_int32(g(d));if(b("bs_caml").i64_lt(d,b("bs_caml_int64").zero)||b("bs_caml").i64_ge(d,f))throw{RE_EXN_ID:"Failure",_1:"int64_of_string",Error:new Error()};var l=function(c,d){while(!0){var e=d,h=c;if(e===k)return h;var i=a.charCodeAt(e);if(i===95){d=e+1|0;continue}i=b("bs_caml_int64").of_int32(g(i));if(b("bs_caml").i64_lt(i,b("bs_caml_int64").zero)||b("bs_caml").i64_ge(i,f)||b("bs_caml").i64_gt(h,j))throw{RE_EXN_ID:"Failure",_1:"int64_of_string",Error:new Error()};h=b("bs_caml_int64").add(b("bs_caml_int64").mul(f,h),i);d=e+1|0;c=h;continue}};c=b("bs_caml_int64").mul(c,l(d,e+1|0));l=b("bs_caml_int64").or_(c,b("bs_caml_int64").zero);if(b("bs_caml").i64_eq(f,[0,10])&&b("bs_caml").i64_neq(c,l))throw{RE_EXN_ID:"Failure",_1:"int64_of_string",Error:new Error()};return l}function j(a){switch(a){case 0:return 8;case 1:return 16;case 2:return 10}}function k(a){if(a>=65&&a<=90||a>=192&&a<=214||a>=216&&a<=222)return a+32|0;else return a}function l(a){var b=a.length;if(b>31)throw{RE_EXN_ID:"Invalid_argument",_1:"format_int: format too long",Error:new Error()};var c={justify:"+",signstyle:"-",filter:" ",alternate:!1,base:2,signedconv:!1,width:0,uppercase:!1,sign:1,prec:-1,conv:"f"},d=0;while(!0){var e=d;if(e>=b)return c;var f=a.charCodeAt(e),g=0;if(f>=69)if(f>=88)if(f>=121)g=1;else switch(f){case 88:c.base=1;c.uppercase=!0;d=e+1|0;continue;case 101:case 102:case 103:g=5;break;case 100:case 105:g=4;break;case 111:c.base=0;d=e+1|0;continue;case 117:c.base=2;d=e+1|0;continue;case 89:case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:case 98:case 99:case 104:case 106:case 107:case 108:case 109:case 110:case 112:case 113:case 114:case 115:case 116:case 118:case 119:g=1;break;case 120:c.base=1;d=e+1|0;continue}else if(f>=72)g=1;else{c.signedconv=!0;c.uppercase=!0;c.conv=String.fromCharCode(k(f));d=e+1|0;continue}else switch(f){case 35:c.alternate=!0;d=e+1|0;continue;case 32:case 43:g=2;break;case 45:c.justify="-";d=e+1|0;continue;case 46:c.prec=0;var h=e+1|0;while(function(b){return function(){var c=a.charCodeAt(b)-48|0;return c>=0&&c<=9}}(h)())c.prec=(Math.imul(c.prec,10)+a.charCodeAt(h)|0)-48|0,h=h+1|0;d=h;continue;case 33:case 34:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 44:case 47:g=1;break;case 48:c.filter="0";d=e+1|0;continue;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:g=3;break;default:g=1}switch(g){case 1:d=e+1|0;continue;case 2:c.signstyle=String.fromCharCode(f);d=e+1|0;continue;case 3:c.width=0;h=e;while(function(b){return function(){var c=a.charCodeAt(b)-48|0;return c>=0&&c<=9}}(h)())c.width=(Math.imul(c.width,10)+a.charCodeAt(h)|0)-48|0,h=h+1|0;d=h;continue;case 4:c.signedconv=!0;c.base=2;d=e+1|0;continue;case 5:c.signedconv=!0;c.conv=String.fromCharCode(f);d=e+1|0;continue}}}function m(a,b){var c=a.justify,d=a.signstyle,e=a.filter,f=a.alternate,g=a.base,h=a.signedconv,i=a.width,j=a.uppercase;a=a.sign;var k=b.length;h&&(a<0||d!=="-")&&(k=k+1|0);f&&(g===0?k=k+1|0:g===1&&(k=k+2|0));var l="";if(c==="+"&&e===" ")for(var m=k;m<i;++m)l=l+e;h&&(a<0?l=l+"-":d!=="-"&&(l=l+d));f&&g===0&&(l=l+"0");f&&g===1&&(l=l+"0x");if(c==="+"&&e==="0")for(var m=k;m<i;++m)l=l+e;l=j?l+b.toUpperCase():l+b;if(c==="-")for(var h=k;h<i;++h)l=l+" ";return l}function d(a,b){if(a==="%d")return String(b);a=l(a);b=b<0?a.signedconv?(a.sign=-1,-b>>>0):b>>>0:b;b=b.toString(j(a.base));if(a.prec>=0){a.filter=" ";var c=a.prec-b.length|0;c>0&&(b="0".repeat(c)+b)}return m(a,b)}function n(a){if(!b("bs_caml").i64_lt(a,b("bs_caml_int64").zero))return b("bs_caml_int64").to_string(a);var c=[0,10];a=b("bs_caml_int64").discard_sign(a);a=b("bs_caml_int64").div_mod(a,c);c=b("bs_caml_int64").div_mod(b("bs_caml_int64").add([0,8],a[1]),c);a=b("bs_caml_int64").add(b("bs_caml_int64").add([214748364,3435973836],a[0]),c[0]);return b("bs_caml_int64").to_string(a)+"0123456789"[b("bs_caml_int64").to_int32(c[1])]}function o(a){var c="",d=[0,8],e="01234567";if(b("bs_caml").i64_lt(a,b("bs_caml_int64").zero)){var f,g=(f=b("bs_caml_int64")).discard_sign(a);g=f.div_mod(g,d);var h=f.add([268435456,0],g[0]);g=g[1];c=e[f.to_int32(g)]+c;while(b("bs_caml").i64_neq(h,b("bs_caml_int64").zero)){f=b("bs_caml_int64").div_mod(h,d);h=f[0];g=f[1];c=e[b("bs_caml_int64").to_int32(g)]+c}}else{f=b("bs_caml_int64").div_mod(a,d);g=f[0];h=f[1];c=e[b("bs_caml_int64").to_int32(h)]+c;while(b("bs_caml").i64_neq(g,b("bs_caml_int64").zero)){a=b("bs_caml_int64").div_mod(g,d);g=a[0];h=a[1];c=e[b("bs_caml_int64").to_int32(h)]+c}}return c}function e(a,c){if(a==="%d")return b("bs_caml_int64").to_string(c);a=l(a);c=a.signedconv&&b("bs_caml").i64_lt(c,b("bs_caml_int64").zero)?(a.sign=-1,b("bs_caml_int64").neg(c)):c;var d=a.base,e;switch(d){case 0:e=o(c);break;case 1:e=b("bs_caml_int64").to_hex(c);break;case 2:e=n(c);break}if(a.prec>=0){a.filter=" ";d=a.prec-e.length|0;c=d>0?"0".repeat(d)+e:e}else c=e;return m(a,c)}function p(a,b){a=l(a);var c=a.prec<0?6:a.prec,d=b<0?(a.sign=-1,-b):b;b="";if(isNaN(d))b="nan",a.filter=" ";else if(isFinite(d)){var e=a.conv;switch(e){case"e":b=d.toExponential(c);e=b.length;b[e-3|0]==="e"&&(b=b.slice(0,e-1|0)+("0"+b.slice(e-1|0)));break;case"f":b=d.toFixed(c);break;case"g":var f=c!==0?c:1;b=d.toExponential(f-1|0);e=b.indexOf("e");c=Number(b.slice(e+1|0))|0;if(c<-4||d>=1e21||d.toFixed().length>f){var g=e-1|0;while(b[g]==="0")g=g-1|0;b[g]==="."&&(g=g-1|0);b=b.slice(0,g+1|0)+b.slice(e);g=b.length;b[g-3|0]==="e"&&(b=b.slice(0,g-1|0)+("0"+b.slice(g-1|0)))}else{var h=f;if(c<0)h=h-(c+1|0)|0,b=d.toFixed(h);else while(function(){b=d.toFixed(h);return b.length>(f+1|0)}())h=h-1|0;if(h!==0){e=b.length-1|0;while(b[e]==="0")e=e-1|0;b[e]==="."&&(e=e-1|0);b=b.slice(0,e+1|0)}}break;default:}}else b="inf",a.filter=" ";return m(a,b)}var q=function(a,b,c){if(!isFinite(a))return isNaN(a)?"nan":a>0?"infinity":"-infinity";var d=a==0&&1/a==-Infinity?1:a>=0?0:1;d&&(a=-a);var e=0;if(!(a==0))if(a<1)while(a<1&&e>-1022)a*=2,e--;else while(a>=2)a/=2,e++;var f=e<0?"":"+",g="";if(d)g="-";else switch(c){case 43:g="+";break;case 32:g=" ";break;default:break}if(b>=0&&b<13){d=Math.pow(2,b*4);a=Math.round(a*d)/d}c=a.toString(16);if(b>=0){d=c.indexOf(".");if(d<0)c+="."+"0".repeat(b);else{a=d+1+b;c.length<a?c+="0".repeat(a-c.length):c=c.substr(0,a)}}return g+"0x"+c+"p"+f+e.toString(10)},r=function(a,b){var c=+a;if(a.length>0&&c===c)return c;a=a.replace(/_/g,"");c=+a;if(a.length>0&&c===c||/^[+-]?nan$/i.test(a))return c;var d=/^ *([+-]?)0x([0-9a-f]+)\.?([0-9a-f]*)p([+-]?[0-9]+)/i.exec(a);if(d){var e=d[3].replace(/0+$/,""),f=parseInt(d[1]+d[2]+e,16);d=(d[4]|0)-4*e.length;c=f*Math.pow(2,d);return c}if(/^\+?inf(inity)?$/i.test(a))return Infinity;if(/^-inf(inity)?$/i.test(a))return-Infinity;throw b};function s(a){return r(a,{RE_EXN_ID:"Failure",_1:"float_of_string"})}var t=d,u=d,v=a,w=a;f.caml_format_float=p;f.caml_hexstring_of_float=q;f.caml_format_int=d;f.caml_nativeint_format=t;f.caml_int32_format=u;f.caml_float_of_string=s;f.caml_int64_format=e;f.caml_int_of_string=a;f.caml_int32_of_string=v;f.caml_int64_of_string=c;f.caml_nativeint_of_string=w}),null);
__d("bs_caml_bytes",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){if(b<0||b>=a.length)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error()};a[b]=c}function b(a,b){if(b<0||b>=a.length)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error()};return a[b]}function c(a,b,c,d){if(c<=0)return;for(var e=b,c=c+b|0;e<c;++e)a[e]=d}function d(a){if(a<0)throw{RE_EXN_ID:"Invalid_argument",_1:"String.create",Error:new Error()};var b=new Array(a);for(var c=0;c<a;++c)b[c]=0;return b}function e(a,b,c,d,e){if(e<=0)return;if(a===c){if(b<d){var f=(a.length-d|0)-1|0,g=e-1|0;g=f>g?g:f;for(var f=g;f>=0;--f)a[d+f|0]=a[b+f|0];return}if(b<=d)return;g=(a.length-b|0)-1|0;f=e-1|0;f=g>f?f:g;for(var g=0;g<=f;++g)a[d+g|0]=a[b+g|0];return}g=a.length-b|0;if(e<=g){for(var f=0;f<e;++f)c[d+f|0]=a[b+f|0];return}for(var f=0;f<g;++f)c[d+f|0]=a[b+f|0];for(var f=g;f<e;++f)c[d+f|0]=0}function g(a){var b=0,c=a.length,d="",e=c;if(b===0&&c<=4096&&c===a.length)return String.fromCharCode.apply(null,a);b=0;while(e>0){c=e<1024?e:1024;var f=new Array(c);for(var g=0;g<c;++g)f[g]=a[g+b|0];d=d+String.fromCharCode.apply(null,f);e=e-c|0;b=b+c|0}return d}function h(a,b,c,d,e){if(e<=0)return;var f=a.length-b|0;if(e<=f){for(var g=0;g<e;++g)c[d+g|0]=a.charCodeAt(b+g|0);return}for(var g=0;g<f;++g)c[d+g|0]=a.charCodeAt(b+g|0);for(var g=f;g<e;++g)c[d+g|0]=0}function i(a){var b=a.length,c=new Array(b);for(var d=0;d<b;++d)c[d]=a.charCodeAt(d);return c}function j(a,b,c,d,e){while(!0){var f=c;if(f>=d)return e;var g=a[f],h=b[f];if(g>h)return 1;if(g<h)return-1;c=f+1|0;continue}}function k(a,b){var c=a.length,d=b.length;if(c===d)return j(a,b,0,c,0);else if(c<d)return j(a,b,0,c,-1);else return j(a,b,0,d,1)}function l(a,b){var c=a.length,d=b.length;if(c===d){d=0;while(!0){var e=d;if(e===c)return!0;var f=a[e],g=b[e];if(f!==g)return!1;d=e+1|0;continue}}else return!1}function m(a,b){return k(a,b)>0}function n(a,b){return k(a,b)>=0}function o(a,b){return k(a,b)<0}function p(a,b){return k(a,b)<=0}f.caml_create_bytes=d;f.caml_fill_bytes=c;f.get=b;f.set=a;f.bytes_to_string=g;f.caml_blit_bytes=e;f.caml_blit_string=h;f.bytes_of_string=i;f.caml_bytes_compare=k;f.caml_bytes_greaterthan=m;f.caml_bytes_greaterequal=n;f.caml_bytes_lessthan=o;f.caml_bytes_lessequal=p;f.caml_bytes_equal=l}),null);
__d("bs_caml_exceptions",[],(function(a,b,c,d,e,f){"use strict";var g={contents:0};function a(a){g.contents=g.contents+1|0;return a+("/"+g.contents)}function b(a){if(a==null)return!1;else return typeof a.RE_EXN_ID==="string"}function c(a){return a.RE_EXN_ID}f.id=g;f.create=a;f.caml_is_extension=b;f.caml_exn_slot_name=c}),null);
__d("bs_caml_js_exceptions",["bs_caml_exceptions","bs_caml_option"],(function(a,b,c,d,e,f){"use strict";var g=b("bs_caml_exceptions").create("Caml_js_exceptions.Error");function a(a){if(b("bs_caml_exceptions").caml_is_extension(a))return a;else return{RE_EXN_ID:g,_1:a}}function c(a){if(a.RE_EXN_ID===g)return b("bs_caml_option").some(a._1)}f.$$Error=g;f.internalToOCamlException=a;f.caml_as_js_exn=c}),null);
__d("bs_char",["bs_caml_bytes"],(function(a,b,c,d,e,f){"use strict";function a(a){if(a<0||a>255)throw{RE_EXN_ID:"Invalid_argument",_1:"Char.chr",Error:new Error()};return a}function c(a){var c=0;if(a>=40){if(a===92)return"\\\\";c=a>=127?1:2}else if(a>=32){if(a>=39)return"\\'";c=2}else if(a>=14)c=1;else switch(a){case 8:return"\\b";case 9:return"\\t";case 10:return"\\n";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 11:case 12:c=1;break;case 13:return"\\r"}switch(c){case 1:c=[0,0,0,0];c[0]=92;c[1]=48+(a/100|0)|0;c[2]=48+(a/10|0)%10|0;c[3]=48+a%10|0;return b("bs_caml_bytes").bytes_to_string(c);case 2:c=[0];c[0]=a;return b("bs_caml_bytes").bytes_to_string(c)}}function d(a){if(a>=65&&a<=90||a>=192&&a<=214||a>=216&&a<=222)return a+32|0;else return a}function e(a){if(a>=97&&a<=122||a>=224&&a<=246||a>=248&&a<=254)return a-32|0;else return a}function g(a){if(a>=65&&a<=90)return a+32|0;else return a}function h(a){if(a>=97&&a<=122)return a-32|0;else return a}function i(a,b){return a-b|0}function j(a,b){return(a-b|0)===0}f.chr=a;f.escaped=c;f.lowercase=d;f.uppercase=e;f.lowercase_ascii=g;f.uppercase_ascii=h;f.compare=i;f.equal=j}),null);
__d("bs_bytes",["bs_caml","bs_caml_bytes","bs_caml_js_exceptions","bs_char","bs_curry"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){var d=b("bs_caml_bytes").caml_create_bytes(a);b("bs_caml_bytes").caml_fill_bytes(d,0,a,c);return d}function c(a,c){var d=b("bs_caml_bytes").caml_create_bytes(a);for(var e=0;e<a;++e)d[e]=b("bs_curry")._1(c,e);return d}var h=[];function i(a){var c=a.length,d=b("bs_caml_bytes").caml_create_bytes(c);b("bs_caml_bytes").caml_blit_bytes(a,0,d,0,c);return d}function d(a){return b("bs_caml_bytes").bytes_to_string(i(a))}function e(a){return i(b("bs_caml_bytes").bytes_of_string(a))}function j(a,c,d){if(c<0||d<0||c>(a.length-d|0))throw{RE_EXN_ID:"Invalid_argument",_1:"String.sub / Bytes.sub",Error:new Error()};var e=b("bs_caml_bytes").caml_create_bytes(d);b("bs_caml_bytes").caml_blit_bytes(a,c,e,0,d);return e}function k(a,c,d){return b("bs_caml_bytes").bytes_to_string(j(a,c,d))}function l(a,b){var c=a+b|0;a=a<0;b=b<0;var d=c<0;if(a){if(!b)return c;if(d)return c;throw{RE_EXN_ID:"Invalid_argument",_1:"Bytes.extend",Error:new Error()}}if(b)return c;if(d)throw{RE_EXN_ID:"Invalid_argument",_1:"Bytes.extend",Error:new Error()};return c}function m(a,c,d){d=l(l(a.length,c),d);var e=b("bs_caml_bytes").caml_create_bytes(d);c=c<0?[-c|0,0]:[0,c];var f=c[1];c=c[0];d=b("bs_caml").caml_int_min(a.length-c|0,d-f|0);d>0&&b("bs_caml_bytes").caml_blit_bytes(a,c,e,f,d);return e}function n(a,c,d,e){if(c<0||d<0||c>(a.length-d|0))throw{RE_EXN_ID:"Invalid_argument",_1:"String.fill / Bytes.fill",Error:new Error()};return b("bs_caml_bytes").caml_fill_bytes(a,c,d,e)}function o(a,c,d,e,f){if(f<0||c<0||c>(a.length-f|0)||e<0||e>(d.length-f|0))throw{RE_EXN_ID:"Invalid_argument",_1:"Bytes.blit",Error:new Error()};return b("bs_caml_bytes").caml_blit_bytes(a,c,d,e,f)}function p(a,c,d,e,f){if(f<0||c<0||c>(a.length-f|0)||e<0||e>(d.length-f|0))throw{RE_EXN_ID:"Invalid_argument",_1:"String.blit / Bytes.blit_string",Error:new Error()};return b("bs_caml_bytes").caml_blit_string(a,c,d,e,f)}function q(a,c){for(var d=0,e=c.length;d<e;++d)b("bs_curry")._1(a,c[d])}function r(a,c){for(var d=0,e=c.length;d<e;++d)b("bs_curry")._2(a,d,c[d])}function s(a,b){if(a>=b)return a;throw{RE_EXN_ID:"Invalid_argument",_1:"Bytes.concat",Error:new Error()}}function t(a,b,c){while(!0){var d=c,e=a;if(!d)return e;var f=d.tl;d=d.hd;if(!f)return d.length+e|0;c=f;a=s((d.length+b|0)+e|0,e);continue}}function u(a,c){if(!c)return h;var d=a.length,e=b("bs_caml_bytes").caml_create_bytes(t(0,d,c)),f=0;c=c;while(!0){var g=c,i=f;if(!g)return e;var j=g.tl;g=g.hd;if(j){b("bs_caml_bytes").caml_blit_bytes(g,0,e,i,g.length);b("bs_caml_bytes").caml_blit_bytes(a,0,e,i+g.length|0,d);c=j;f=(i+g.length|0)+d|0;continue}b("bs_caml_bytes").caml_blit_bytes(g,0,e,i,g.length);return e}}function v(a,c){var d=a.length,e=c.length,f=b("bs_caml_bytes").caml_create_bytes(d+e|0);b("bs_caml_bytes").caml_blit_bytes(a,0,f,0,d);b("bs_caml_bytes").caml_blit_bytes(c,0,f,d,e);return f}function w(a){if(a>13||a<9)return a===32;else return a!==11}function x(a){var b=a.length,c=0;while(c<b&&w(a[c]))c=c+1|0;b=b-1|0;while(b>=c&&w(a[b]))b=b-1|0;if(b>=c)return j(a,c,(b-c|0)+1|0);else return h}function y(a){var c=0;for(var d=0,e=a.length;d<e;++d){var f=a[d];c=c+(f>=32?f>92||f<34?f>=127?4:1:f>91||f<35?2:1:f>=11?f!==13?4:2:f>=8?2:4)|0}if(c===a.length)return i(a);f=b("bs_caml_bytes").caml_create_bytes(c);c=0;for(var d=0,e=a.length;d<e;++d){var g=a[d],h=0;if(g>=35)g!==92?g>=127?h=1:f[c]=g:h=2;else if(g>=32)g>=34?h=2:f[c]=g;else if(g>=14)h=1;else switch(g){case 8:f[c]=92;c=c+1|0;f[c]=98;break;case 9:f[c]=92;c=c+1|0;f[c]=116;break;case 10:f[c]=92;c=c+1|0;f[c]=110;break;case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 11:case 12:h=1;break;case 13:f[c]=92;c=c+1|0;f[c]=114;break}switch(h){case 1:f[c]=92;c=c+1|0;f[c]=48+(g/100|0)|0;c=c+1|0;f[c]=48+(g/10|0)%10|0;c=c+1|0;f[c]=48+g%10|0;break;case 2:f[c]=92;c=c+1|0;f[c]=g;break}c=c+1|0}return f}function z(a,c){var d=c.length;if(d===0)return c;var e=b("bs_caml_bytes").caml_create_bytes(d);for(var f=0;f<d;++f)e[f]=b("bs_curry")._1(a,c[f]);return e}function A(a,c){var d=c.length;if(d===0)return c;var e=b("bs_caml_bytes").caml_create_bytes(d);for(var f=0;f<d;++f)e[f]=b("bs_curry")._2(a,f,c[f]);return e}function B(a){return z(b("bs_char").uppercase_ascii,a)}function C(a){return z(b("bs_char").lowercase_ascii,a)}function D(a,c){if(c.length===0)return c;var d=i(c);d[0]=b("bs_curry")._1(a,c[0]);return d}function E(a){return D(b("bs_char").uppercase_ascii,a)}function F(a){return D(b("bs_char").lowercase_ascii,a)}function G(a,b,c,d){while(!0){var e=c;if(e>=b)throw{RE_EXN_ID:"Not_found",Error:new Error()};if(a[e]===d)return e;c=e+1|0;continue}}function H(a,b){return G(a,a.length,0,b)}function I(a,b,c,d){while(!0){var e=c;if(e>=b)return;if(a[e]===d)return e;c=e+1|0;continue}}function J(a,b){return I(a,a.length,0,b)}function K(a,b,c){var d=a.length;if(b<0||b>d)throw{RE_EXN_ID:"Invalid_argument",_1:"String.index_from / Bytes.index_from",Error:new Error()};return G(a,d,b,c)}function L(a,b,c){var d=a.length;if(b<0||b>d)throw{RE_EXN_ID:"Invalid_argument",_1:"String.index_from_opt / Bytes.index_from_opt",Error:new Error()};return I(a,d,b,c)}function M(a,b,c){while(!0){var d=b;if(d<0)throw{RE_EXN_ID:"Not_found",Error:new Error()};if(a[d]===c)return d;b=d-1|0;continue}}function N(a,b){return M(a,a.length-1|0,b)}function O(a,b,c){if(b<-1||b>=a.length)throw{RE_EXN_ID:"Invalid_argument",_1:"String.rindex_from / Bytes.rindex_from",Error:new Error()};return M(a,b,c)}function P(a,b,c){while(!0){var d=b;if(d<0)return;if(a[d]===c)return d;b=d-1|0;continue}}function Q(a,b){return P(a,a.length-1|0,b)}function R(a,b,c){if(b<-1||b>=a.length)throw{RE_EXN_ID:"Invalid_argument",_1:"String.rindex_from_opt / Bytes.rindex_from_opt",Error:new Error()};return P(a,b,c)}function S(a,c,d){var e=a.length;if(c<0||c>e)throw{RE_EXN_ID:"Invalid_argument",_1:"String.contains_from / Bytes.contains_from",Error:new Error()};try{G(a,e,c,d);return!0}catch(c){a=b("bs_caml_js_exceptions").internalToOCamlException(c);if(a.RE_EXN_ID==="Not_found")return!1;throw a}}function T(a,b){return S(a,0,b)}function U(a,c,d){if(c<0||c>=a.length)throw{RE_EXN_ID:"Invalid_argument",_1:"String.rcontains_from / Bytes.rcontains_from",Error:new Error()};try{M(a,c,d);return!0}catch(c){a=b("bs_caml_js_exceptions").internalToOCamlException(c);if(a.RE_EXN_ID==="Not_found")return!1;throw a}}var V=(g=b("bs_caml_bytes")).caml_bytes_compare;function W(a){return z(b("bs_char").uppercase,a)}function X(a){return z(b("bs_char").lowercase,a)}function Y(a){return D(b("bs_char").uppercase,a)}function Z(a){return D(b("bs_char").lowercase,a)}var $=g.caml_bytes_equal,aa=g.bytes_to_string;g=g.bytes_of_string;f.make=a;f.init=c;f.empty=h;f.copy=i;f.of_string=e;f.to_string=d;f.sub=j;f.sub_string=k;f.extend=m;f.fill=n;f.blit=o;f.blit_string=p;f.concat=u;f.cat=v;f.iter=q;f.iteri=r;f.map=z;f.mapi=A;f.trim=x;f.escaped=y;f.index=H;f.index_opt=J;f.rindex=N;f.rindex_opt=Q;f.index_from=K;f.index_from_opt=L;f.rindex_from=O;f.rindex_from_opt=R;f.contains=T;f.contains_from=S;f.rcontains_from=U;f.uppercase=W;f.lowercase=X;f.capitalize=Y;f.uncapitalize=Z;f.uppercase_ascii=B;f.lowercase_ascii=C;f.capitalize_ascii=E;f.uncapitalize_ascii=F;f.compare=V;f.equal=$;f.unsafe_to_string=aa;f.unsafe_of_string=g}),null);
__d("bs_caml_string",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){if(b>=a.length||b<0)throw{RE_EXN_ID:"Invalid_argument",_1:"index out of bounds",Error:new Error()};return a.charCodeAt(b)}function b(a,b){return String.fromCharCode(b).repeat(a)}f.get=a;f.make=b}),null);
__d("bs_string",["bs_bytes","bs_caml","bs_caml_bytes","bs_caml_js_exceptions","bs_caml_string","bs_curry"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("bs_caml_bytes").bytes_to_string(b("bs_bytes").init(a,c))}function g(a,c,d){return b("bs_caml_bytes").bytes_to_string(b("bs_bytes").sub(b("bs_caml_bytes").bytes_of_string(a),c,d))}function h(a,b){if(a>=b)return a;throw{RE_EXN_ID:"Invalid_argument",_1:"String.concat",Error:new Error()}}function i(a,b,c){while(!0){var d=c,e=a;if(!d)return e;var f=d.tl;d=d.hd;if(!f)return d.length+e|0;c=f;a=h((d.length+b|0)+e|0,e);continue}}function j(a,c,d,e,f){while(!0){var g=f,h=c;if(!g)return a;var i=g.tl;g=g.hd;if(i){b("bs_caml_bytes").caml_blit_string(g,0,a,h,g.length);b("bs_caml_bytes").caml_blit_string(d,0,a,h+g.length|0,e);f=i;c=(h+g.length|0)+e|0;continue}b("bs_caml_bytes").caml_blit_string(g,0,a,h,g.length);return a}}function c(a,c){if(!c)return"";var d=a.length;return b("bs_caml_bytes").bytes_to_string(j(b("bs_caml_bytes").caml_create_bytes(i(0,d,c)),0,a,d,c))}function d(a,c){for(var d=0,e=c.length;d<e;++d)b("bs_curry")._1(a,c.charCodeAt(d))}function e(a,c){for(var d=0,e=c.length;d<e;++d)b("bs_curry")._2(a,d,c.charCodeAt(d))}function k(a,c){return b("bs_caml_bytes").bytes_to_string(b("bs_bytes").map(a,b("bs_caml_bytes").bytes_of_string(c)))}function l(a,c){return b("bs_caml_bytes").bytes_to_string(b("bs_bytes").mapi(a,b("bs_caml_bytes").bytes_of_string(c)))}function m(a){if(a>13||a<9)return a===32;else return a!==11}function n(a){if(a===""||!(m(a.charCodeAt(0))||m(a.charCodeAt(a.length-1|0))))return a;else return b("bs_caml_bytes").bytes_to_string(b("bs_bytes").trim(b("bs_caml_bytes").bytes_of_string(a)))}function o(a){var c=function(b){while(!0){var c=b;if(c>=a.length)return!1;var d=a.charCodeAt(c);if(d<32)return!0;if(d>92||d<34){if(d>=127)return!0;b=c+1|0;continue}if(d>91||d<35)return!0;b=c+1|0;continue}};if(c(0))return b("bs_caml_bytes").bytes_to_string(b("bs_bytes").escaped(b("bs_caml_bytes").bytes_of_string(a)));else return a}function p(a,b,c,d){while(!0){var e=c;if(e>=b)throw{RE_EXN_ID:"Not_found",Error:new Error()};if(a.charCodeAt(e)===d)return e;c=e+1|0;continue}}function q(a,b){return p(a,a.length,0,b)}function r(a,b,c,d){while(!0){var e=c;if(e>=b)return;if(a.charCodeAt(e)===d)return e;c=e+1|0;continue}}function s(a,b){return r(a,a.length,0,b)}function t(a,b,c){var d=a.length;if(b<0||b>d)throw{RE_EXN_ID:"Invalid_argument",_1:"String.index_from / Bytes.index_from",Error:new Error()};return p(a,d,b,c)}function u(a,b,c){var d=a.length;if(b<0||b>d)throw{RE_EXN_ID:"Invalid_argument",_1:"String.index_from_opt / Bytes.index_from_opt",Error:new Error()};return r(a,d,b,c)}function v(a,b,c){while(!0){var d=b;if(d<0)throw{RE_EXN_ID:"Not_found",Error:new Error()};if(a.charCodeAt(d)===c)return d;b=d-1|0;continue}}function w(a,b){return v(a,a.length-1|0,b)}function x(a,b,c){if(b<-1||b>=a.length)throw{RE_EXN_ID:"Invalid_argument",_1:"String.rindex_from / Bytes.rindex_from",Error:new Error()};return v(a,b,c)}function y(a,b,c){while(!0){var d=b;if(d<0)return;if(a.charCodeAt(d)===c)return d;b=d-1|0;continue}}function z(a,b){return y(a,a.length-1|0,b)}function A(a,b,c){if(b<-1||b>=a.length)throw{RE_EXN_ID:"Invalid_argument",_1:"String.rindex_from_opt / Bytes.rindex_from_opt",Error:new Error()};return y(a,b,c)}function B(a,c,d){var e=a.length;if(c<0||c>e)throw{RE_EXN_ID:"Invalid_argument",_1:"String.contains_from / Bytes.contains_from",Error:new Error()};try{p(a,e,c,d);return!0}catch(c){a=b("bs_caml_js_exceptions").internalToOCamlException(c);if(a.RE_EXN_ID==="Not_found")return!1;throw a}}function C(a,b){return B(a,0,b)}function D(a,c,d){if(c<0||c>=a.length)throw{RE_EXN_ID:"Invalid_argument",_1:"String.rcontains_from / Bytes.rcontains_from",Error:new Error()};try{v(a,c,d);return!0}catch(c){a=b("bs_caml_js_exceptions").internalToOCamlException(c);if(a.RE_EXN_ID==="Not_found")return!1;throw a}}function E(a){return b("bs_caml_bytes").bytes_to_string(b("bs_bytes").uppercase_ascii(b("bs_caml_bytes").bytes_of_string(a)))}function F(a){return b("bs_caml_bytes").bytes_to_string(b("bs_bytes").lowercase_ascii(b("bs_caml_bytes").bytes_of_string(a)))}function G(a){return b("bs_caml_bytes").bytes_to_string(b("bs_bytes").capitalize_ascii(b("bs_caml_bytes").bytes_of_string(a)))}function H(a){return b("bs_caml_bytes").bytes_to_string(b("bs_bytes").uncapitalize_ascii(b("bs_caml_bytes").bytes_of_string(a)))}var I=b("bs_caml").caml_string_compare;function J(a,b){var c=0,d=b.length;for(var e=b.length-1|0;e>=0;--e)b.charCodeAt(e)===a&&(c={hd:g(b,e+1|0,(d-e|0)-1|0),tl:c},d=e);return{hd:g(b,0,d),tl:c}}function K(a){return b("bs_caml_bytes").bytes_to_string(b("bs_bytes").uppercase(b("bs_caml_bytes").bytes_of_string(a)))}function L(a){return b("bs_caml_bytes").bytes_to_string(b("bs_bytes").lowercase(b("bs_caml_bytes").bytes_of_string(a)))}function M(a){return b("bs_caml_bytes").bytes_to_string(b("bs_bytes").capitalize(b("bs_caml_bytes").bytes_of_string(a)))}function N(a){return b("bs_caml_bytes").bytes_to_string(b("bs_bytes").uncapitalize(b("bs_caml_bytes").bytes_of_string(a)))}var O=b("bs_caml_string").make,P=b("bs_bytes").blit_string;function Q(a,b){return a===b}f.make=O;f.init=a;f.sub=g;f.blit=P;f.concat=c;f.iter=d;f.iteri=e;f.map=k;f.mapi=l;f.trim=n;f.escaped=o;f.index=q;f.index_opt=s;f.rindex=w;f.rindex_opt=z;f.index_from=t;f.index_from_opt=u;f.rindex_from=x;f.rindex_from_opt=A;f.contains=C;f.contains_from=B;f.rcontains_from=D;f.uppercase=K;f.lowercase=L;f.capitalize=M;f.uncapitalize=N;f.uppercase_ascii=E;f.lowercase_ascii=F;f.capitalize_ascii=G;f.uncapitalize_ascii=H;f.compare=I;f.equal=Q;f.split_on_char=J}),null);
__d("MessengerStoryAttachmentTransformer.bs",["fbt","CurrentUser","FundsAvailability","LeadGenInfoFieldTypes","MNCommerceBubbleType","MNCommerceCallToActionType","MercuryAttachmentType","P2PPaymentRequestStatus","P2PTransferStatus","PaymentModulesClient","ServicesCalendarSyncType","URI","bs_belt_Option","bs_caml_array","bs_caml_format","bs_caml_option","bs_js_dict","bs_js_null_undefined","bs_string"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return a.map(function(a){var c=a.user_confirmation;c=c==null?[null,null,null,null,!1]:[c.cancel_button_label,c.continue_button_label,c.confirmation_message,c.confirmation_title,!0];var d=a.payment_metadata;return{action_link:a.action_link,action_type:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MNCommerceCallToActionType"),a.action_open_type)),action_objects:a.action_objects,title:a.title,confirmation_cancel_label:c[0],confirmation_continue_label:c[1],confirmation_message:c[2],confirmation_title:c[3],id:a.id,is_disabled:a.is_disabled,is_mutable_by_server:a.is_mutable_by_server,logging_token:a.logging_token,payment_metadata:d==null?{payment_module_config:null,total_price:null}:{payment_module_config:d.payment_module_config,total_price:d.total_price},render_style:a.render_style,webview_metadata:{fallback_url:a.webview_metadata.fallback_url,messenger_extensions:a.webview_metadata.messenger_extensions,webview_height_ratio:a.webview_metadata.webview_height_ratio,webview_share_button:a.webview_metadata.webview_share_button},should_show_user_confirmation:c[4],page_id:a.page_id,cta_data:a.cta_data}})}function j(a){return a.map(function(a){var c=a.url;c=c==null?null:new(h||(h=b("URI")))(c).getUnqualifiedURI().toString();return{title:a.title,uri:c}})}function a(a){if(!(a==null)&&a!=="")return"#"+b("bs_string").sub(a,2,a.length-2|0);else return null}function c(a){if(a==null)return null;else return{url:a.uri,src:a.uri,width:a.width,height:a.height}}function k(a,b){var c=b.cover_photo,d;if(c==null)d=[null,null,null];else{var e=c.photo.image;e=e==null?[null,null]:[e.uri,{height:e.height,width:e.width}];d=[c.photo.id,e[0],e[1]]}c=b.location;e=c==null?[null,null]:[c.latitude,c.longitude];c=b.overall_star_rating;return{address:b.address.single_line_full_address,category:b.top_category_name,coverPhotoID:d[0],coverPhotoURL:d[1],coverPhotoDimensions:d[2],latitude:e[0],longitude:e[1],name:b.name,rating:c==null?null:c.value,pageID:b.id,priceRange:b.price_range_description,viewerID:a}}function l(a){var b=a.group_commerce_item_seller,c=a.primary_photo,d;if(c==null)d=null;else{c=c.image;d=c==null?null:c.uri}return{caption:a.group_commerce_item_description.text,desc:a.group_commerce_item_description.text,owner_id:b==null?null:b.id,price:a.formatted_price.text,text:a.group_commerce_item_description.text,title:a.group_commerce_item_title,thumb_url:d,url:a.url}}function m(a){return{app_name:a.application_name,artists:a.artist_names,audio_url:a.audio_url,duration_ms:a.duration_ms,title:a.music_title}}function n(a){var c=a.payment;return{id:a.id,desc:a.desc,display_total_cost:a.total_cost,merchant_name:a.merchant_name,target_url:a.target_url,thumb_url:a.thumb_url,raw_amount:a.raw_amount,payment_id:c==null?null:c.id,total_cost:{amount:b("bs_caml_format").caml_float_of_string(a.price_amount),currency:a.price_currency},name:a.name}}function o(a){return{fundraiserID:a.fundraiserID,canDonate:a.canDonate,hasViewerDonated:a.hasViewerDonated,fundraiserDetailedProgressText:a.fundraiserDetailedProgressText,fundraiserSubtitleText:a.fundraiserSubtitleText,focusedCoverPhoto:a.focusedCoverPhoto}}function p(a){return{id:a.id,name:a.name,is_malicious:a.is_malicious,attach_type:b("MercuryAttachmentType").FILE,url:a.uri,extension:a.extension,filesize:a.filesize}}function q(a){return{id:a.id,url_shimhash:a.url_shimhash,attach_type:b("MercuryAttachmentType").VIDEO,url:a.playable_url,extension:a.extension,filesize:a.filesize,name:a.filename,height:a.height,width:a.width}}function r(a){return{id:a.id,name:a.name,desc:a.desc,thumb_url:a.thumb_url,item_url:a.item_url,title:a.name,text:a.desc,source:a.source,image_aspect_ratio:a.image_aspect_ratio,metalines:{metaline_1:a.first_metaline,metaline_2:a.second_metaline,metaline_3:a.third_metaline},default_action:a.default_action,call_to_actions:i(a.call_to_actions)}}function s(a){var c=function(a){a=a.services_vertical_info;if(!(a==null))return{isEligibleForAppointmentCalendar:a.is_eligible_for_appointment_calendar,timezoneName:a.time_zone_name}},d=a.page;c=d==null?[void 0,void 0,void 0]:[d.id,b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("ServicesCalendarSyncType"),d.calendar_sync_type)),c(d)];d=a.native_component_flow_request;var e;if(d==null)e=null;else{var f=d.page,h=d.page,i=d.page,j;if(i==null)j=void 0;else{i=i.profile_picture;j=i==null?void 0:i.uri}i=d.suggested_time_range;var k=d.user,l=d.user,m=d.job_application,n=d.user,o;if(n==null)o=void 0;else{n=n.profile_picture;o=n==null?void 0:n.uri}e={additionalInfo:d.additional_info,appointmentAddress:d.appointment_address,archivedStatus:d.archived_status,availability:d.availability,consumer_phone_number:d.consumer_phone_number,hasSavedToCalendar:d.has_saved_to_calendar,recurMessage:d.recur_message,requestFlowType:d.request_flow_type,generalInfo:d.service_general_info,id:d.id,pageID:f==null?void 0:f.id,pageName:h==null?void 0:h.name,pageProfilePic:j,preferredTimeRange:i==null?null:{end:i.end,start:i.start},productItems:d.services_product_items,reminderBubbleText:d.reminder_bubble_text,requestAdminApprovalType:d.request_admin_approval_type,requestedTime:d.requested_time,specialRequest:d.special_request,status:d.booking_status_value,statusLabel:d.status,userID:k==null?void 0:k.id,username:l==null?void 0:l.short_name,jobApplicationID:m==null?void 0:m.id,userProfilePic:o}}n=a.message_bubble_type;var p;switch(n){case"ATTENDANCE_UPDATE":p=["Attendance Update",g._("Attendance update")];break;case"CANCELLED":p=["Cancelled",g._("Cancelled")];break;case"DECLINED":p=["Declined",g._("Declined")];break;case"NO_SHOW":p=["No Show",g._("No-show")];break;case"REQUESTED":p=["Requested",g._("Requested")];break;case"SCHEDULEED":p=["Scheduled",g._("Scheduled")];break;default:throw{RE_EXN_ID:"Invalid_argument",_1:"Erroneous target status",Error:new Error()}}f=a.user;return{id:a.id,pageID:c[0],calendarSyncType:c[1],userID:f==null?"0":f.id,status:p[0],statusLabel:p[1],ls_xma_title:a.ls_xma_title,ls_xma_subtitle:a.ls_xma_subtitle,viewerID:b("CurrentUser").getAccountID(),requestMetadata:e,servicesVerticalInfo:c[2]}}function t(a){return{id:a.id,page_id:a.page.id,user_id:a.consumer.id,time_ranges:a.formatted_available_time_ranges.map(function(a){return{start:a.start,end:a.end}}),has_booking_request_created:a.has_booking_request_created}}function u(a){return{id:a.id}}function v(a){return{live_location_id:a.live_location_id,is_expired:a.is_expired,expiration_time:a.expiration_time,sender:a.sender,coordinate:a.coordinate,location_title:a.location_title,sender_destination:a.sender_destination,stop_reason:a.stop_reason}}function w(a){return{sender_wec_number:a.sender_wec_number,sender_wec_number_formated:a.sender_wec_number_formated,sender_wec_number_fbid:a.sender_wec_number_fbid,sender_wec_name:a.sender_wec_name}}function x(a){var b=a.preview;b=b==null?null:b.uri;var c=a.large_preview;c=c==null?null:c.uri;return{id:a.id,extension:a.extension,preview:a.preview,large_preview:a.large_preview,attach_type:"photo",large_preview_url:c,preview_url:b}}function y(a){return{id:a.id,name:a.filename,url_shimhash:a.url_shimhash,attach_type:b("MercuryAttachmentType").AUDIO,url:a.playable_url,extension:a.extension,filesize:a.filesize,duration:a.duration}}function z(a){var b=a.first_metaline;return{desc:a.description,id:a.id,image_aspect_ratio:a.image_aspect_ratio,item_url:a.target_url,metalines:b==null?{}:{metaline_1:b},name:a.name,source:a.source_name,text:a.description,thumb_url:a.image_url,title:a.name,default_action:a.default_action,call_to_actions:i(a.call_to_actions),media_blob_attachments:a.media_blob_attachments}}function A(a){var b=a.business_items.nodes.map(z),c=i(a.call_to_actions);return{message:a.message,call_to_actions:c,items:b}}function B(a){return{message:a.message,call_to_actions:i(a.call_to_actions),items:a.promotion_items.nodes.map(z)}}function C(a){var c=a.structured_address.streets,d=a.partner_logo;return{account_holder_name:a.account_holder_name,adjustments:a.adjustments.map(function(a){return{adjustment_type:a.adjustment_type,display_adjustment_amount:a.adjustment_amount}}),cancellation_url:a.cancellation_url,items:a.items.nodes.map(z),merchant_name:a.merchant_name,messenger_commerce_bubble_type:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MNCommerceBubbleType"),a.messenger_commerce_bubble_type)),order_id:a.order_id,order_time:a.order_time,order_url:a.order_url,payment_method:a.payment_method,receipt_id:a.receipt_id,recipient_name:a.recipient_name,shipping_cost:a.shipping_cost,shipping_method:a.shipping_method,status:a.status,structured_address:{city:a.structured_address.city,state:a.structured_address.state,country:a.structured_address.country,postal_code:a.structured_address.postal_code,street_1:b("bs_caml_array").get(c,0),street_2:b("bs_caml_array").get(c,1)},subtotal:a.subtotal,total_cost:a.total_cost,total_tax:a.total_tax,partner_logo:d==null?void 0:d.uri}}function D(a,c){return{payment_modules_client:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("PaymentModulesClient"),c.payment_modules_client)),is_viewer_seller:c.is_viewer_seller,payment_snippet:c.payment_snippet,item_list:c.item_list.map(function(a){return{item_id:a.item_id,name:a.name,subtitle:a.subtitle,description:a.description,unit_price:a.unit_price,image_urls:a.images.map(function(a){return a.uri}),quantity:a.quantity}}),components:c.components,payment_call_to_actions:c.payment_call_to_actions,click_action:c.click_action,summary_action:c.summary_action,actor_id:a,invoicer_id:c.invoicer_id,is_last_attachment:c.is_last_attachment,payment_total:c.payment_total,product_detail:c.product_detail,payment_status_icon:c.payment_status_icon,user_facing_payment_status:c.user_facing_payment_status,payment_sub_statuses:c.payment_sub_statuses,should_show_new_xma:c.should_show_new_xma,buyer_name:c.buyer_name}}var E=function(a){var c=b("LeadGenInfoFieldTypes"),d={},e=[];for(var a=a.field_data_list,f=Array.isArray(a),g=0,a=f?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=a.length)break;h=a[g++]}else{g=a.next();if(g.done)break;h=g.value}h=h;var i=h.field_type,j=h.label;h=h.values;i===c.CUSTOM||i===c.ZIP?e.push({label:j,values:h}):d[i]={label:j,values:h}}d.questions=e;return d};function F(a,b){var c=b.invite_recipient;c=c==null?null:c.id;var d=b.invite_sender;d=d==null?null:d.id;return{quick_invite_id:b.id,recipient_id:c,sender_id:d,is_viewer_recipient:a===c}}function G(a){var b=function(a){if(a==null)return null;else return a.uri},c=a.listing_category;c=c==null?[null,null]:[c.offer_image,c.request_image];return{listingType:a.listing_type,mapURI:b(a.map_image),offerURI:b(c[0]),requestURI:b(c[1])}}function H(a){return{sender:a.sender,receiver:a.receiver,transfer_id:a.transfer_id,bubbleView:a.bubble_view}}function I(a){var c=a.receiver_profile,d;if(c==null)d=null;else{var e=c.profile_picture;d={id:c.id,name:c.short_name,full_name:c.name,picture:e==null?null:e.uri,profile_url:c.url}}e=a.sender;if(e==null)c={};else{var f=e.profile_picture;c={id:e.id,name:e.name,full_name:e.full_name,picture:f==null?null:f.uri,profile_uri:e.url}}f=a.transfer_context;if(f==null)e=[null,null];else{var g=f.transfer_theme;e=[f.memo_images.map(function(a){a=a.image;if(a==null)return null;else return a.uri}),g==null?null:g.id]}f=a.platform_item;g=f==null?null:{name:f.name,description:f.description,image:f.photos.map(function(a){a=a.image;if(a==null)return null;else return a.uri}),refURL:f.url};f=a.amount_fb_discount;return{sender:c,amountWithSymbol:a.transaction_amount.formatted_amount,status:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("P2PTransferStatus"),a.transfer_status)),receiver:d,transfer_id:a.transfer_id,completedTime:a.completedTime,updatedTime:a.updatedTime,creationTime:a.creationTime,amount:a.transaction_amount.amount,memoText:a.memo_text,memoPhotoURLs:e[0],themeID:e[1],discountAmount:f==null?null:f.formatted,fundsAvailability:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("FundsAvailability"),a.funds_availability)),groupThreadFBID:a.group_thread_fbid,platform_item:g,statusDescription:{markup:a.status_description},bubbleView:a.bubble_view,currencyCode:a.currency_amount.currency}}function J(a){var c=a.requester,d;if(c==null)d=void 0;else{var e=c.profile_picture;d={id:c.id,name:c.short_name,full_name:c.name,picture:e==null?null:e.uri,profile_url:c.url}}e=a.requestee;if(e==null)c=void 0;else{var f=e.profile_picture;c={id:e.id,name:e.short_name,full_name:e.name,picture:f==null?null:f.uri,profile_url:e.url}}f=b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("P2PPaymentRequestStatus"),a.request_status));e=a.transfer;e=e==null?[null,""]:[I(e),e.id];var g=a.request_theme;return{amount:a.transaction_amount.amount,amountWithSymbol:a.amount.formatted,requestee:c,requester:d,currentStatus:f,currency:a.amount.currency,creationTime:a.creation_time,groupThreadFBID:a.group_thread_fbid,id:a.id,memoText:a.memo_text,themeID:g==null?null:g.id,transfer:e[0],transferID:e[1],updatedTime:a.updated_time,bubbleView:a.bubble_view,statusDescription:{markup:a.status_description}}}function K(a){var b=J({amount:a.amount,transaction_amount:a.transaction_amount,requester:a.requester,requestee:a.requestee,request_status:a.request_status,request_theme:a.request_theme,id:a.id,memo_text:a.memo_text,transfer:a.transfer,creation_time:a.creation_time,group_thread_fbid:a.group_thread_fbid,updated_time:a.updated_time,bubble_view:a.bubble_view,status_description:a.status_description});a={individualRequests:a.individual_requests.map(J)};return Object.assign(b,a)}function L(a,c,d){var e=c.media,f=e==null?null:e.animated_image,g=e==null?null:e.image,h={};c.properties.forEach(function(a){var b=a.value;h[a.key]=b==null?null:b.text});var i=c.target,z;if(i==null)z=null;else switch(i.TAG|0){case 0:z=G(i._0);break;case 1:z=H(i._0);break;case 2:z=I(i._0);break;case 3:z=K(i._0);break;case 4:z=D(a,i._0);break;case 5:z=B(i._0);break;case 6:z=A(i._0);break;case 8:z=E(i._0);break;case 9:z=v(i._0);break;case 10:z=F(a,i._0);break;case 11:z=s(i._0);break;case 12:z=t(i._0);break;case 13:z=u(i._0);break;case 14:var J=i._0,L=J.genie_sender;L=L==null?[null,null]:[L.messaging_actor.id,L.messaging_actor.name];var N=L[0],O={action_links:[],messaging_attribution:null,messenger_call_to_actions:[],xma_layout_info:null,deduplication_key:null,description:null,media:null,properties:[],source:null,style_list:[],title_with_entities:null,url:null,subattachments:[],target:null,messenger_generic_xma_template_extra_info:null},P=c.media,Q;if(P==null)Q=null;else{P=P.pack;if(P==null){P=J.story_attachment;Q=P==null||d==null?null:M(a,{legacy_attachment_id:N,story_attachment:{action_links:d.action_links,messaging_attribution:d.messaging_attribution,messenger_call_to_actions:d.messenger_call_to_actions,xma_layout_info:d.xma_layout_info,deduplication_key:d.deduplication_key,description:d.description,media:d.media,properties:d.properties,source:d.source,style_list:d.style_list,title_with_entities:d.title_with_entities,url:d.url,subattachments:d.subattachments,target:d.target,messenger_generic_xma_template_extra_info:d.messenger_generic_xma_template_extra_info},genie_attachment:{genie_message:{story_attachment:O}}})}else Q=d==null?null:M(a,{legacy_attachment_id:N,story_attachment:O,genie_attachment:{genie_message:{story_attachment:O}}})}z={genie_id:N,genie_name:L[1],attachment:Q};break;case 16:z=m(i._0);break;case 18:z=r(i._0);break;case 19:z=n(i._0);break;case 20:z=o(i._0);break;case 21:z=C(i._0);break;case 23:z=l(i._0);break;case 24:z=k(a,i._0);break;case 36:z=w(i._0);break;case 37:z=x(i._0);break;case 38:z=y(i._0);break;case 39:z=p(i._0);break;case 40:z=q(i._0);break;default:z=i._0}J=c.target;P=J==null||J.TAG!==5?null:0;d=c.description;O=c.source;N=c.title_with_entities;return{description:d==null?null:d.text,media:{animated_image:f==null?null:f.uri,animated_image_size:f==null?{height:null,width:null}:{height:f.height,width:f.width},image:g==null?null:g.uri,image_size:g==null?{height:null,width:null}:{height:g.height,width:g.width},duration:e==null?null:e.playable_duration,playable:e==null?null:e.is_playable,source:e==null?null:e.playable_url},source:O==null?null:O.text,style_list:c.style_list,title:N==null?null:N.text,action_links:j(c.action_links),messaging_attribution:c.messaging_attribution,messenger_ctas:c.messenger_call_to_actions.map(function(a){return{id:a.id,page_id:b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(a.page_id),""),action_title:a.title,action_url:a.action_link,action_open_type:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MNCommerceCallToActionType"),a.action_open_type)),is_high_confidence:b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(a.is_high_confidence),!1),is_mutable_by_server:a.is_mutable_by_server,native_url:a.native_url,is_disabled:a.is_disabled,webview_metadata:{fallback_url:a.webview_metadata.fallback_url,messenger_extensions:a.webview_metadata.messenger_extensions,webview_height_ratio:a.webview_metadata.webview_height_ratio,webview_share_button:a.webview_metadata.webview_share_button}}}),xma_layout_info:c.xma_layout_info,properties:h,uri:c.url,deduplication_key:c.deduplication_key,target:z,label:P,messenger_generic_xma_template_extra_info:c.messenger_generic_xma_template_extra_info}}function M(a,c){var d=c.genie_attachment,e;if(d==null)e=null;else{d=d.genie_message;if(d==null)e=null;else{d=d.story_attachment;e=d==null?null:{description:d.description,media:d.media,source:d.source,style_list:d.style_list,title_with_entities:d.title_with_entities,properties:d.properties,url:d.url,deduplication_key:d.deduplication_key,action_links:d.action_links,messaging_attribution:d.messaging_attribution,messenger_call_to_actions:d.messenger_call_to_actions,xma_layout_info:d.xma_layout_info,messenger_generic_xma_template_extra_info:d.messenger_generic_xma_template_extra_info,target:d.target,subattachments:d.subattachments}}}d=c.story_attachment;var f;if(d==null)f=null;else{var g={description:null,media:null,source:null,style_list:[],title_with_entities:null,properties:[],url:null,deduplication_key:null,action_links:[],messaging_attribution:null,messenger_call_to_actions:[],xma_layout_info:null,target:null,subattachments:[],messenger_generic_xma_template_extra_info:null};c={share_id:c.legacy_attachment_id,subattachments:d.subattachments.map(function(b){return L(a,b,g)})};var h={description:d.description,media:d.media,source:d.source,style_list:d.style_list,title_with_entities:d.title_with_entities,properties:d.properties,url:d.url,deduplication_key:d.deduplication_key,action_links:d.action_links,messaging_attribution:d.messaging_attribution,messenger_call_to_actions:d.messenger_call_to_actions,xma_layout_info:d.xma_layout_info,target:d.target,messenger_generic_xma_template_extra_info:d.messenger_generic_xma_template_extra_info};d=e==null?{description:d.description,media:d.media,source:d.source,style_list:d.style_list,title_with_entities:d.title_with_entities,properties:d.properties,url:d.url,deduplication_key:d.deduplication_key,action_links:d.action_links,messaging_attribution:d.messaging_attribution,messenger_call_to_actions:d.messenger_call_to_actions,xma_layout_info:d.xma_layout_info,target:d.target,subattachments:d.subattachments,messenger_generic_xma_template_extra_info:d.messenger_generic_xma_template_extra_info}:{description:e.description,media:e.media,source:e.source,style_list:e.style_list,title_with_entities:e.title_with_entities,properties:e.properties,url:e.url,deduplication_key:e.deduplication_key,action_links:e.action_links,messaging_attribution:e.messaging_attribution,messenger_call_to_actions:e.messenger_call_to_actions,xma_layout_info:e.xma_layout_info,target:e.target,subattachments:e.subattachments,messenger_generic_xma_template_extra_info:e.messenger_generic_xma_template_extra_info};f=Object.assign(c,L(a,h,d))}return{app_attribution:null,attach_type:b("MercuryAttachmentType").SHARE,name:null,url:null,rel:null,preview_url:null,preview_width:null,preview_height:null,large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:null,metadata:null,share:f,thumbnail_url:null}}f._getCallToActions=i;f._getActionLinks=j;f._getColor=a;f._getLogo=c;f._getPageTarget=k;f._getGroupCommerceProductItemTarget=l;f._getExternalSongTarget=m;f._getAgentSuggestionItemTarget=n;f._getFundraiserTarget=o;f._getWECFileTarget=p;f._getWECMessageVideoTarget=q;f._getRetailItemTarget=r;f._getPagesPlatformBookingMessageTarget=s;f._getServicesAppointmentAvailabilityTarget=t;f._getServicesGenericAdminTextTarget=u;f._getMessageLiveLocationTarget=v;f._getWECMessageTarget=w;f._getWECMessageImageTarget=x;f._getWECMessageAudioTarget=y;f._getBusinessRetailItem=z;f._getMessengerBusinessMessageTarget=A;f._getMessengerRetailPromotionTarget=B;f._getMessengerRetailReceiptTarget=C;f._getPagesPlatformAttachmentTarget=D;f._getPagesPlatformLeadGenInfoTarget=E;f._getQuickInviteTarget=F;f._getCrisisListingTarget=G;f._getMoneyTransferTarget=H;f._getP2PTransferTarget=I;f._getP2PTransferRequestTarget=J;f._getP2PTransferRequestWithIndividualRequests=K;f.transformStoryAttachment=L;f.getExtensibleAttachmentPayload=M}),null);
__d("MessengerAttachmentTransformer.bs",["fbt","MercuryAttachmentContentType","MercuryAttachmentType","MessageSharedMediaIDStore.bs","MessengerStoryAttachmentTransformer.bs","bs_caml"],(function(a,b,c,d,e,f,g){"use strict";function h(a){if(a.is_malicious){var c=g._("This attachment has been marked as malicious.");return{app_attribution:null,icon_type:b("MercuryAttachmentContentType").UNKNOWN,mime_type:null,metadata:null,name:null,preview_height:null,preview_url:null,preview_width:null,rel:null,share:null,thumbnail_url:null,url:null,attach_type:b("MercuryAttachmentType").ERROR,error_msg:c,message_file_fbid:null,url_shimhash:null,url_skipshim:null,preview:null}}c=a.attribution_app;var d;if(c==null)d=null;else{var e=c.square_logo;d={id:c.id,icon_url:e==null?null:e.uri,metadata:a.attribution_metadata,name:c.name}}e=a.url;return{app_attribution:d,icon_type:a.content_type,mime_type:a.mimetype,metadata:null,name:a.filename,preview_height:null,preview_url:a.preview_url,preview_width:null,rel:"ignore",share:null,thumbnail_url:null,url:e==null?null:e,attach_type:b("MercuryAttachmentType").FILE,error_msg:void 0,message_file_fbid:a.message_file_fbid,url_shimhash:a.url_shimhash,url_skipshim:a.url_skipshim,preview:a.preview}}function i(a,c,d){var e=a.chat_image;e=e==null?[null,null,null]:[e.uri,e.width,e.height];var f=e[0],g=a.chat_image;g=g==null?null:{width:g.width,height:g.height};var h=a.large_image;h=h==null?[null,null]:[h.uri,{width:h.width,height:h.height}];var i=a.inbox_image;i=i==null?[null,null]:[i.uri,{width:i.width,height:i.height}];var j=a.attribution_app,k;if(j==null)k=null;else{var l=j.square_logo;k={id:j.id,icon_url:l==null?null:l.uri,metadata:a.attribution_metadata,name:j.name}}return{app_attribution:k,attach_type:b("MercuryAttachmentType").VIDEO,name:a.filename,url:a.playable_url,rel:"async",preview_url:f,preview_width:e[1],preview_height:e[2],large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:b("MercuryAttachmentContentType").VIDEO,metadata:{fbid:a.legacy_attachment_id,render_as_sticker:a.video_type==="SPEAKING_STICKER",dimensions:{width:a.original_dimensions.x,height:a.original_dimensions.y},duration:a.playable_duration_in_ms,large_size:h[1],large_preview:h[0],chat_size:g,chat_preview:f,inbox_size:i[1],inbox_preview:i[0],pageid:d?c:void 0},thumbnail_url:f,share:null}}function j(a){var c=a.attribution_app,d;if(c==null)d=null;else{var e=c.square_logo;d={id:c.id,icon_url:e==null?null:e.uri,metadata:a.attribution_metadata,name:c.name}}return{app_attribution:d,attach_type:b("MercuryAttachmentType").FILE,name:a.filename,url:a.playable_url,rel:"ignore",preview_url:null,preview_width:null,preview_height:null,large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:b("MercuryAttachmentContentType").MUSIC,metadata:{duration:a.playable_duration_in_ms,isVoicemail:a.is_voicemail?"1":"0",type:a.audio_type==="VOICE_MESSAGE"?"fb_voice_message":a.audio_type==="VOICE_MESSAGE_WITH_TRANSCRIPT"?"fb_voice_message_with_transcript":"file_attachment"},thumbnail_url:null,share:null,url_shimhash:a.url_shimhash,url_skipshim:a.url_skipshim}}function k(a,c,d){var e=a.preview_image;e=e==null?[null,null,null]:[e.uri,e.width,e.height];var f=a.animated_image;f=f==null?null:f.uri;var g=a.attribution_app,h;if(g==null)h=null;else{var i=g.square_logo;h={id:g.id,icon_url:i==null?null:i.uri,metadata:a.attribution_metadata,name:g.name}}return{app_attribution:h,attach_type:b("MercuryAttachmentType").ANIMATED_IMAGE,name:a.filename,url:f,rel:"async",preview_url:e[0],preview_width:e[1],preview_height:e[2],large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:b("MercuryAttachmentContentType").PHOTO,metadata:{fbid:a.legacy_attachment_id,image:f,dimensions:String(a.original_dimensions.x)+(","+String(a.original_dimensions.y)),pageid:d?c:void 0},thumbnail_url:f,title:a.title,share:null}}function l(a){var c=a.original_extension==="gif"?b("MercuryAttachmentType").ANIMATED_IMAGE:a.render_as_sticker?b("MercuryAttachmentType").THIRDPARTYSTICKER:b("MercuryAttachmentType").PHOTO,d=a.preview;d=d==null?[null,null,null]:[d.uri,d.width,d.height];if(c===b("MercuryAttachmentType").PHOTO){var e=a.large_preview;e=e==null?[null,null,null]:[e.uri,e.width,e.height]}else e=[null,null,null];var f=a.attribution_app,g;if(f==null)g=null;else{var h=f.square_logo;g={id:f.id,icon_url:h==null?null:h.uri,metadata:a.attribution_metadata,name:f.name}}h=a.thumbnail;return{app_attribution:g,attach_type:c,blurred_image_uri:a.blurred_image_uri,name:a.filename,url:null,rel:"async",preview_url:d[0],preview_width:d[1],preview_height:d[2],large_preview_url:e[0],large_preview_width:e[1],large_preview_height:e[2],icon_type:b("MercuryAttachmentContentType").PHOTO,metadata:{fbid:a.legacy_attachment_id,dimensions:String(a.original_dimensions.x)+(","+String(a.original_dimensions.y))},thumbnail_url:h==null?null:h.uri,share:null,photo_encodings:a.photo_encodings}}function m(a,c){var d=a,e=c;if(a>=c){a=b("bs_caml").caml_float_min(120,d/2);c=a/(d/2);return[a|0,e/2*c|0]}a=b("bs_caml").caml_float_min(120,e/2);c=a/(e/2);return[d/2*c|0,a|0]}function n(a){var c=m(a.width,a.height),d=a.pack,e=a.sprite_image,f=a.sprite_image_2x,g=a.padded_sprite_image,h=a.padded_sprite_image_2x;return{app_attribution:null,attach_type:b("MercuryAttachmentType").STICKER,name:null,url:a.url,rel:null,preview_url:null,preview_width:null,preview_height:null,large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:b("MercuryAttachmentContentType").UNKNOWN,metadata:{accessibilityLabel:a.label,stickerID:a.id,packID:d==null?null:d.id,frameCount:a.frame_count,frameRate:a.frame_rate,framesPerRow:a.frame_count>1?a.frames_per_row:1,framesPerCol:a.frame_count>1?a.frames_per_column:1,height:c[1],width:c[0],spriteURI:e==null?null:e.uri,spriteURI2x:f==null?null:f.uri,paddedSpriteURI:g==null?null:g.uri,paddedSpriteURI2x:h==null?null:h.uri,thumbnail_url:null,share:null}}}function o(a,c){if(!(c==null))return b("MessageSharedMediaIDStore.bs").setMessageIDForAttachmentID(a,c)}function a(a,c,d,e){var f=[],g={id:"",pack:null,label:"",frame_count:0,frame_rate:0,frames_per_row:0,frames_per_column:0,height:0,padded_sprite_image:null,padded_sprite_image_2x:null,sprite_image_2x:null,sprite_image:null,url:null,width:0},m=c.extensible_attachment,p;if(m==null)p=g;else{m=m.story_attachment;if(m==null)p=g;else{m=m.media;p=m==null?g:{id:m.id,pack:m.pack,label:m.label,frame_count:m.frame_count,frame_rate:m.frame_rate,frames_per_row:m.frames_per_row,frames_per_column:m.frames_per_column,height:m.height,padded_sprite_image:m.padded_sprite_image,padded_sprite_image_2x:m.padded_sprite_image_2x,sprite_image_2x:m.sprite_image_2x,sprite_image:m.sprite_image,url:m.url,width:m.width}}}g=p.id;!(g==null)&&g!==""&&f.push(n(p));m=c.extensible_attachment;m==null||f.push(b("MessengerStoryAttachmentTransformer.bs").getExtensibleAttachmentPayload(a,m));g=c.sticker;g==null||f.push(n(g));p=c.blob_attachments;p==null||p.forEach(function(b){switch(b.TAG|0){case 0:var c=b._0;o(c.legacy_attachment_id,d);f.push(l(c));return;case 1:c=b._0;o(c.legacy_attachment_id,d);f.push(k(c,a,e));return;case 2:f.push(j(b._0));return;case 3:c=b._0;o(c.legacy_attachment_id,d);f.push(i(c,a,e));return;case 4:f.push(h(b._0));return}});return f}f._getFilePayload=h;f._getVideoPayload=i;f._getAudioPayload=j;f._getAnimatedImagePayload=k;f._getImagePayload=l;f._getStickerDimensions=m;f._getStickerPayload=n;f._storeAttachmentMapping=o;f.transformAttachment=a}),null);
__d("MessengerGroupAdminModelStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({REQUIRED:"required",OPTIONAL:"optional",NOT_SUPPORTED:"not_supported"});f["default"]=a}),66);
__d("MessengerGroupAdminModelStatus.bs",["MessengerGroupAdminModelStatus"],(function(a,b,c,d,e,f){"use strict";function a(a){if(a==null)return null;a=a.toUpperCase();switch(a){case"NOT_SUPPORTED":return b("MessengerGroupAdminModelStatus").NOT_SUPPORTED;case"OPTIONAL":return b("MessengerGroupAdminModelStatus").OPTIONAL;case"REQUIRED":return b("MessengerGroupAdminModelStatus").REQUIRED;default:return null}}f.fromNullableString=a}),null);
__d("MessengerGroupAdminType",[],(function(a,b,c,d,e,f){a=Object.freeze({REGULAR_ADMIN:0,GROUP_CREATOR:1,CHAT_SUPER_ADMIN:2});f["default"]=a}),66);
__d("MessengerGroupThreadSubType",[],(function(a,b,c,d,e,f){a=Object.freeze({ADMIN_MODEL_V2_THREAD:1,FB_GROUP_CHAT:2,MARKETPLACE_THREAD:3,SCHOOL_CHAT:4,DEPRECATED__WORK_SYNCED_CHAT:5,ADMIN_NOT_SUPPORTED_THREAD:6,BELL_SYNCED_CHAT:7,GAMES_APP_THREAD:8,VAULT_CHAT:9,VERSE_CHAT:10,GENERIC_COMMERCE_THREAD:11,USER_JOB_THREAD:12,COWORKER_GROUP_THREAD:13,APPROVAL_ENFORCED_CHATROOM_THREAD:14,PARENT_APPROVED_SHEPHERD_MANAGED_THREAD:15,CAMPUS_GROUP_THREAD:16,LOCAL_COMMUNITIES_THREAD:17,CHAT_FOR_ROOM_THREAD:18,GAMING_PLAY_SQUAD:19,CHAT_FOR_GROUP_ADMIN_TO_MEMBER_THREAD:20,EITM_BACKED_IG_1TO1_THREAD:21,LEARNING_SPACE:23,E2EE_GROUP_THREAD_METADATA:24,IGD_BC_PARTNERSHIP:25,E2EE_1TO1_THREAD_METADATA:26});f["default"]=a}),66);
__d("MessengerGroupsSyncStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({PENDING_OPT_IN:"PENDING_OPT_IN",OPT_IN:"OPT_IN",PENDING_OPT_OUT:"PENDING_OPT_OUT",OPT_OUT:"OPT_OUT",UNSET:"UNSET",UNSUPPORTED:"UNSUPPORTED"});f["default"]=a}),66);
__d("MessengerGroupsSyncStatus.bs",["MessengerGroupsSyncStatus"],(function(a,b,c,d,e,f){"use strict";function a(a){if(a==null)return null;switch(a){case"OPT_IN":return b("MessengerGroupsSyncStatus").OPT_IN;case"OPT_OUT":return b("MessengerGroupsSyncStatus").OPT_OUT;case"PENDING_OPT_IN":return b("MessengerGroupsSyncStatus").PENDING_OPT_IN;case"PENDING_OPT_OUT":return b("MessengerGroupsSyncStatus").PENDING_OPT_OUT;case"UNSET":return b("MessengerGroupsSyncStatus").UNSET;case"UNSUPPORTED":return b("MessengerGroupsSyncStatus").UNSUPPORTED;default:return null}}f.fromNullableString=a}),null);
__d("InstantGameUpdateXMATUpdateType",[],(function(a,b,c,d,e,f){a=Object.freeze({UNKNOWN:"unknown",GAME_SCORE:"game_score",CUSTOM_MESSAGE:"custom_message"});f["default"]=a}),66);
__d("MNCommerceMessageType",[],(function(a,b,c,d,e,f){a=Object.freeze({TEXT:"text",IMAGE:"image",VIDEO:"video",AUDIO:"audio",FILE:"file",ROBOT_TEXT:"robot_text",LOCATION:"location",FORCED_FETCH_MESSAGE:"forced_fetch_message",SENDER_ACTION:"sender_action",SHOPS_PRODUCT:"shops_product",SHOPS_PRODUCT_HSCROLL:"shops_product_hscroll",RETAIL_PRODUCT_SUBSCRIPTION:"retail_product_subscription",RETAIL_PROMOTION:"retail_promotion",RETAIL_CANCELLATION:"retail_cancellation",RETAIL_SHIPMENT:"retail_shipment",SHIPMENT_TRACKING_EVENT:"shipment_tracking_event",AIRLINE_CHECKIN_REMINDER:"airline_checkin_reminder",AIRLINE_BOARDING_PASS:"airline_boarding_pass",AIRLINE_CHECKIN:"airline_checkin",AIRLINE_BOARDINGPASS:"airline_boardingpass",AIRLINE_UPDATE:"airline_update",AIRLINE_ITINERARY:"airline_itinerary",CONTENT_SUBSCRIPTION:"content_subscription",AD_ADMIN_TEXT:"ad_admin_text",AD_TEXT:"ad_text",AD_BUBBLE:"ad_bubble",NON_AD:"non_ad",UNKNOWN:"unknown",OTHER:"other",TEMPLATE:"template",OPEN_GRAPH:"open_graph",GENERIC:"generic",LIST:"list",COMPACT_LIST:"compact_list",BUTTON:"button",RECEIPT:"receipt",GENERIC_LEGACY:"generic_legacy",ICE_BREAKER:"ice_breaker",FALLBACK:"fallback",ONE_TIME_NOTIF_REQ:"one_time_notif_req",NOTIFICATION_MESSAGES:"notification_messages",CUSTOMER_FEEDBACK:"customer_feedback",RIDE_INTENT:"ride_intent",RIDE_SIGNUP:"ride_signup",RIDE_WELCOME:"ride_welcome",RIDE_ORDER_CONFIRMATION:"ride_order_confirmation",RIDE_REQUESTED:"ride_requested",RIDE_DRIVER_ON_THE_WAY:"ride_driver_on_the_way",RIDE_NO_DRIVER:"ride_no_driver",RIDE_DRIVER_ARRIVING:"ride_driver_arriving",RIDE_DRIVER_CANCELED:"ride_driver_canceled",RIDE_RIDER_CANCELED:"ride_rider_canceled",RIDE_COMPLETE:"ride_complete",RIDE_ADMIN_MESSAGE:"ride_admin_message",RIDE_RECEIPT:"ride_receipt",RIDE_REENGAGEMENT_FIRST_RIDE:"ride_reengagement_first_ride",GET_RIDE:"give_get_ride",GIVE_RIDE:"send_give_get_ride",REFERER_PROMO:"referer_promo",INSTANT_GAMES_SHARE:"instant_games_share",INSTANT_GAMES_SCORE:"instant_games_score",INSTANT_GAMES_LIVE_STREAM:"instant_games_live_stream",INSTANT_GAMES_CUSTOM_UPDATE:"instant_games_custom_update",INSTANT_GAMES_CUSTOM_UPDATE_MEDIA:"instant_games_custom_update_media",INSTANT_GAMES_TOURNAMENT_UPDATE:"instant_games_tournament_update",GAMING_SERVICES_GAME_INVITE:"GAMING_SERVICES_GAME_INVITE",LINK:"link_admin_message",UNLINK:"unlink_admin_message",BLOCK_ALL:"block_all_admin_message",UNBLOCK_ALL:"unblock_all_admin_message",BLOCK_PROMOTION:"block_promotion_admin_message",UNBLOCK_PROMOTION:"unblock_promotion_admin_message",INITIAL_PROMOTION:"initial_promotion_admin_message",WEAK_CONSENT_ADMIN_MESSAGE:"weak_consent_admin_message",MESSENGER_TEAM_BOT_MESSAGE:"messenger_team_bot",MESSENGER_BOT_BASE_GENERIC:"messenger_bot_base_generic",COMMERCE_COMPACT_LIST:"commerce_compact_list",FEEDBACK:"feedback",FORM_PROGRESS:"form_progress",MEDIA:"media",PLACE_CARD:"place_card"});f["default"]=a}),66);
__d("MercuryActionType",[],(function(a,b,c,d,e,f){a=Object.freeze({ADD_GROUP_ADMINS:"ma-type:add_group_admins",ADD_PARTICIPANTS:"ma-type:add-participants",ADS_CONVERSION_UPDATE:"ma-type:ads_conversion_update",APPROVAL_MODE:"ma-type:approval-mode",APPROVAL_QUEUE:"ma-type:approval-queue",BLOCK_STATUS_CHANGED:"ma-type:block-status-changed",BLURRED_IMAGE_STATUS:"ma-type:blurred-image-status",CANCEL_ATTACHMENT_PLACEHOLDER:"ma-type:cancel-attachment-placeholder",CHANGE_ARCHIVED_STATUS:"ma-type:change-archived-status",CHANGE_FLAG:"ma-type:change_flag",CHANGE_FOLDER:"ma-type:change-folder",CHANGE_MUTE_SETTINGS:"ma-type:change-mute-settings",CHANGE_PAGE_FOLLOW_UP_STATUS:"ma-type:change-page-follow-up-status",CHANGE_PINNED_STATUS:"ma-type:change-pinned-status",CHANGE_READ_STATUS:"ma-type:change_read_status",CONFIRM_ATTACHMENT_PLACEHOLDER:"ma-type:confirm-attachment-placeholder",CREATE_OMNI_M_SUGGESTIONS:"ma-type:create-omni-m-suggestions",CREATE_PAGE_ADMIN_NOTE:"ma-type:create-page-admin-note",DELETE_MESSAGES:"ma-type:delete-messages",DELETE_MONTAGE_MESSAGES:"ma-type:delete-montage-messages",DELETE_THREAD:"ma-type:delete-thread",DESCRIPTION_CHANGED:"ma-type:description-changed",EVENT_RSVP_CHANGED:"ma-type:event-rsvp-changed",GROUPS_SYNC_METADATA_UPDATE:"ma-type:groups-sync-metadata-update",GROUPS_SYNC_STATUS_CHANGED:"ma-type:groups-sync-status-changed",IS_PIN_PROTECTED:"ma-type:is_pin_protected",JOINABLE_MODE:"ma-type:joinable-mode",LIVE_LOCATION_UPDATE:"ma-type:live-location-update",LOG_MESSAGE:"ma-type:log-message",MARK_THREAD_SEEN:"ma-type:mark_thread_seen",MONTAGE_DIRECT_EXPIRE:"ma-type:montage-direct-expire",MOVE_PENDING_TO_INBOX:"ma-type:move_pending_to_inbox",MUTATE_TAGS:"ma-type:mutate_tags",NEW_MONTAGE_MESSAGE:"ma-type:new-montage-message",PIN_MESSAGE:"ma-type:pin-message",PROMOTE_GROUP_ADMINS:"ma-type:promote-group-admins",REACTION_UPDATE:"ma-type:reaction-update",REMOVE_GROUP_ADMINS:"ma-type:remove_group_admins",REMOVE_MESSAGE:"ma-type:remove-message",REPLACE_MESSAGE:"ma-type:replace-message",SEND_MESSAGE:"ma-type:send-message",SUGGESTED_REPLY_UPDATE:"ma-type:suggested_reply_update",UNPIN_MESSAGE:"ma-type:unpin-message",UNSUBSCRIBE_STATUS_UPDATE:"ma-type:unsubscribe-status-update",UNWRAP_MESSAGE:"ma-type:unwrap-message",UPDATE_COMM_ITEM_OWNER:"ma-type:update-comm-item-owner",UPDATE_COMM_STATUS:"ma-type:update-comm-status",UPDATE_CONNECTIVITY_STATUS:"ma-type:update-connectivity-status",UPDATE_CUSTOM_LIKE:"ma-type:update_custom_like",UPDATE_JOINABLE_LINK:"ma-type:update-joinable-link",UPDATE_RTC_CALL_DATA:"ma-type:update-rtc-call-data",UPDATE_SECONDARY_LANGUAGE_BODY:"ma-type:upade-secondary-language-body",UPDATE_SNIPPET:"ma-type:update-snippet",UPDATE_THREAD_THEME:"ma-type:update-thread-theme",USER_GENERATED_MESSAGE:"ma-type:user-generated-message"});f["default"]=a}),66);
__d("MercuryLogMessageType",[],(function(a,b,c,d,e,f){a=Object.freeze({SUBSCRIBE:"log:subscribe",UNSUBSCRIBE:"log:unsubscribe",VIDEO_CALL:"log:video-call",PHONE_CALL:"log:phone-call",THREAD_NAME:"log:thread-name",THREAD_IMAGE:"log:thread-image",SERVER_ERROR:"log:error-msg",LIVE_LISTEN:"log:live-listen",WALLPAPER:"log:wallpaper",ORION:"log:orion",SWITCH_TO_WORK:"log:switch",PAGE_REPLY:"log:page-reply",GENERIC_ADMIN_TEXT:"log:generic-admin-text"});f["default"]=a}),66);
__d("MercurySourceType",[],(function(a,b,c,d,e,f){a=Object.freeze({BRAND_COLLABS_MANAGER:"source:brand_collabs_manager",CHAT_ORCA:"source:chat:orca",CHAT_LIGHT_SPEED:"source:chat:light_speed",CHAT_WEB_LIGHT_SPEED_INBOX:"source:chat:web:light_speed:inbox",CHAT_WEB_LIGHT_SPEED_CHAT:"source:chat:web:light_speed:chat",CHAT_IPHONE:"source:chat:iphone",CHAT_JABBER:"source:chat:jabber",CHAT_MEEBO:"source:chat:meebo",CHAT_WEB:"source:chat:web",CHAT_TEST:"source:chat:test",CHAT_FORWARD_DIALOG:"source:chat:forward",CHAT:"source:chat",CONTACT_ADD_MUTATION:"source:contact_add:graphql_mutation",CONTACT_ADD_CYMK:"source:contact_add:cymk_suggestion",CONTEXTUAL_PROFILE_MESSAGE:"source:contextual_profile:message",COWORKER_GROUP:"source:work:coworker_group",COVID_HUB_MENTAL_HEALTH_UNIT:"source:covid_hub_mental_health",CUSTOMER_CHAT_PLUGIN:"source:discovery:customer_chat_plugin",CUSTOMER_CHAT_PLUGIN_ESCALATION:"source:discovery:customer_chat_plugin_escalation",EMAIL:"source:email",EVENT_MESSAGE_BLAST:"source:event_message_blast",EVENT_TICKETING:"source:event_ticket",EVENT_REMINDERS:"source:event_reminders",WHITEHAT_FBDL:"source:whitehat_fbdl",GENERIC_ADMIN_TEXT:"source:generic_admin_text",GIGABOXX_API:"source:gigaboxx:api",GIGABOXX_BLAST:"source:gigaboxx:blast",GIGABOXX_EMAIL_REPLY:"source:gigaboxx:emailreply",GIGABOXX_MOBILE:"source:gigaboxx:mobile",GIGABOXX_WAP:"source:gigaboxx:wap",GIGABOXX_WEB:"source:gigaboxx:web",GRATITUDE_LIBRARY:"source:gratitude_library",GROUP_ADMOD_THREAD_AUTOJOIN:"source:group:admod_thread_autojoin",GROUP_GENERAL_THREAD_AUTOJOIN:"source:group:general_thread_autojoin",INVITE:"source:invite",LEIA:"source:leia",MESSENGER_WEB:"source:messenger:web",MESSENGER_WEB_SEARCH:"source:messenger:web_search",MESSENGER_UNKNOWN:"source:messenger:unknown",MESSENGER_RESTRICT:"source:messenger:restrict",REFERRALS_DIALOG:"source:referrals:dialog",SAM_UFI:"source:sam:ufi",SHARE_DIALOG:"source:share:dialog",SEND_PLUGIN:"source:sendplugin",SMS:"source:sms",SSI_RESOURCES:"source:ssi_resources",TEST:"source:test",TITAN_WAP:"source:titan:wap",TITAN_M_BASIC:"source:titan:m_basic",TITAN_M_FREE:"source:titan:m_free_basic",TITAN_M_JAPAN:"source:titan:m_japan",TITAN_M_MINI:"source:titan:m_mini",TITAN_M_TOUCH:"source:titan:m_touch",TITAN_M_APP:"source:titan:m_app",TITAN_M_TABLET:"source:titan:m_tablet",TITAN_M_ZERO:"source:titan:m_zero",TITAN_M_TALK:"source:titan:m_talk",TITAN_WEB:"source:titan:web",TITAN_FACEWEB_ANDROID:"source:titan:faceweb_android",TITAN_FACEWEB_BUFFY:"source:titan:faceweb_buffy",TITAN_FACEWEB_IPAD:"source:titan:faceweb_ipad",TITAN_FACEWEB_IPHONE:"source:titan:faceweb_iphone",TITAN_FACEWEB_UNKNOWN:"source:titan:faceweb_unknown",TITAN_API:"source:titan:api",TITAN_API_MOBILE:"source:titan:api_mobile",TITAN_ORCA:"source:titan:orca",TITAN_EMAIL_REPLY:"source:titan:emailreply",MOBILE:"source:mobile",PAGE_PLATFORM_API:"source:page_platform_api",PAGE_UNIFIED_INBOX:"source:page_unified_inbox",WHATSAPP_CALLBACK:"source:wa_callback",UNKNOWN:"source:unknown",WEB:"source:web",WESTWORLD:"source:westworld",TESTDATA:"source:testdata",HELPCENTER:"source:helpcenter",HUDDLE:"source:huddle",NEW_SHARE_DIALOG:"source:share:dialog:new",PAID_PROMOTION:"source:paid_promotion",BUFFY_SMS:"source:buffy:sms",WEBRTC_MOBILE:"source:webrtc:mobile",MESSENGER_COMMERCE:"source:messenger:commerce",MESSENGER_BOT:"source:bot",SERVICES_QPC_CTA_TRIGGER_MESSAGE:"source:services:qpc:cta:trigger:message",MESSENGER_EMPLOYEE_ONLY_BOT:"source:bot:employee_only",MESSENGER_OMNIM:"source:messenger:omnim",PAGES_PRIVATE_REPLY:"source:pages:private_reply",MESSENGER_FORWARD_DIALOG:"source:messenger:forward",MESSENGER_AD:"source:messenger:ad",CLICK_TO_MESSENGER_AD:"source:click_to_messenger_ad",MARKETPLACE:"source:marketplace",MARKETPLACE_CARE:"source:marketplace:care",MARKETPLACE_BOT:"source:marketplace:bot",PAYMENTS_BOT:"source:payments:bot",CHEX_C2C:"source:chex:c2c",MESSENGER_LEAD_GEN:"source:messenger:lead_gen",PAGES_MESSAGE_SHORTLINK:"source:pages:message_shortlink",STICKER_SUBSCRIBE:"source:messenger:sticker_subscribe",PHOTO_TAG:"source:messenger:photo_tag",INTERNAL_TEST_INBOX:"source:internal:test_inbox",INTERNAL_TEST_PENDING:"source:internal:test_pending",INTERNAL_TEST_OTHER:"source:internal:test_other",INTERNAL_TEST_ML_ONLY:"source:internal:test_ml_only",JOB_SEARCH_APPLICATION:"source:job_search:application",JOB_SEARCH_JOB_OPENING:"source:job_search:job_opening",MESSENGER_JOINABLE_LINK:"source:messenger:joinable_link",MESSENGER_ADD_WITH_APPROVAL:"source:messenger:add_with_approval",MESSENGER_SMS_BRIDGE_CONVERT:"source:messenger:sms_bridge_conversion",TINCAN_ORCA:"source:tincan:orca",TINCAN_IOS:"source:tincan:ios",TINCAN_UNKNOWN:"source:tincan:unknown",FACEBOOK_GROUPS_CHANNELS:"source:groups:channels",GROUP_COMMERCE:"source:group_commerce",INTERNAL_TOOL:"source:internal:tool",PAGES_PLATFORM:"source:pages:platform",PAGES_RECOMMENDATION:"source:pages:recommendation",PAGES_ORDER_MANAGEMENT:"source:pages:order_management",PAGE_AUTO_RESPONSE:"source:pages:auto_response",PAGES_INVITE:"source:pages:invite",PAGES_CHAT_EXTENSION:"source:pages:chat_extension",PAGES_COMPOSER:"source:pages:composer",PAGES_SMB_LEAD_GEN:"source:pages:smb_lead_gen",PTX:"source:ptx",SAVED_CHAT_EXTENSION:"source:saved:chat_extension",CREATOR_PAGE_INITIATE_TO_CREATOR_PAGE:"source:pages:creator_page_initiate_to_creator_page",LIVE_VIDEO_CHAT:"source:live_video_chat",LIVE_EVENT_CHAT:"source:live_event_chat",GEMSTONE:"source:gemstone",WATCH_PARTY:"source:watch_party",WORK_ACTIVATION_CARD_GENERAL_GROUP_CHAT:"source:work:activation_card_general_group_chat",SCHOOL_COMMUNITY:"source:school_community",SCHOOL_COMMUNITY_COURSE:"source:school_community_course",SOCIAL_ASSISTANT:"source:social_assistant",BELL_RESEARCH:"source:bell_research",BELL_MESSENGER_LINKED:"source:bell_messenger_linked",BELL_MESSENGER_UNLINKED:"source:bell_messenger_unlinked",BELL_MESSENGER_ONBOARD:"source:bell_messenger_onboard",PROFILE_MEET_NEW_FRIENDS:"source:profile_meet_new_friends",PROFILE_MEET_NEW_FRIENDS_REPLY:"source:profile_meet_new_friends_reply",OCULUS_SHARE_TO_MESSENGER:"source:oculus_share_to_messenger",BFF_BOT:"source:bff:bot",FRIENDING_ADMIN_BUMP:"source:messenger_growth:friending_admin_bump",NEW_MESSENGER_USER_ADMIN_BUMP:"source:messenger_growth:new_messenger_user_admin_bump",EVENT_UPCOMING_BUMP:"source:messenger_growth:event_upcoming_bump",PHOTO_TAG_BUMP:"source:messenger_growth:photo_tag_bump",WALL_POST_BUMP:"source:messenger_growth:wall_post_bump",FRIENDVERSARY_BUMP:"source:messenger_growth:friendversary_bump",CUSTOMIZATION_UPSELL_BUMP:"source:messenger_growth:customization_upsell_bump",MESSENGER_BROADCASTFLOW:"source:messenger:broadcastflow",PAGE_COMMENT_MSG:"source:pages:question_triggered_convo",COMMENT_PIVOT:"source:messenger_growth:comment_pivot",PAGE_HOVERCARD:"source:pages:hovercard",INSTANT_GAMES_GAME_UPDATE:"source:instant_games_game_updates",INSTANT_GAMES_GAME_SHARE:"source:instant_games_game_share",INSTANT_GAMES_MATCH_MAKING:"source:instant_games_match_making",INSTANT_GAMES_GROUP_CREATION:"source:instant_games_group_creation",MOBILE_GAME_SHARE:"source:games_app:mobile_game_share",GAMES_SERVICE_GAME_INVITE:"source:games_service_game_invite",GAMES_SERVICE_GAME_REQUEST:"source:games_service_game_request",PAGE_EMAIL_REPLY:"source:pages:email_reply",PAGE_HOME_PAGE_PANEL:"source:page_home_page_panel",GROUPSYNC_MESSENGER_GROUP_CREATE:"source:groupsync:messenger_group_create",GROUPSYNC_SYNC_FROM_FB:"source:groupsync:sync_from_fb",GROUPSYNC_NAMING:"source:groupsync:naming",GROUPSYNC_THREAD_INFO_SYNC_FROM_FB:"source:groupsync:thread_info_sync",GROUPSYNC_THREAD_INFO_SYNC_FROM_FB_NON_PARTICIPANT:"source:groupsync:thread_info_sync_non_participant",WORK_GARDEN_CREATION:"source:work:garden:creation",WORK_GROUP_SYNCED_CHAT_CREATION:"source:work:groupchat:creation",WORK_DEFAULT_GROUP_SYNCED_CHAT_CREATION:"source:work:defaultgroupchat:creation",WORK_GROUP_SYNCED_CHAT_MEMBER_SYNC:"source:work:groupchat:member_sync",WORK_MEETING_SYNCED_CHAT_MEMBER_SYNC:"source:work:meetingchat:member_sync",WORK_GROUP_SYNCED_CHAT_DESCRIPTION_SYNC:"source:work:groupchat:description_sync",WORK_GROUP_SYNCED_CHAT_NAME_SYNC:"source:work:groupchat:name_sync",WORK_GROUP_SYNCED_CHAT_OPT_IN:"source:work:groupchat:opt_in",PAGE_PQI_MESSAGE:"source:pages:pqi_message",PAGE_PLUGIN_MESSAGE:"source:pages:page_plugin_message",WORKPLACE_ACTIVATION_GOLDIE_CUSTOM_INVITE:"source:workplace:activation_goldie_custom_invite",WORKPLACE_CHAT_DESKTOP:"source:workchat:desktop",WORKPLACE_QUICKCHAT:"source:workchat:quickchat",WORKPLACE_SIGNUP_PAGE_ADMIN_INVITE:"source:workplace:signup_page_admin_invite",WORKPLACE_APPROVALS:"source:workplace:approvals",WORKPLACE_TEAMWORK_CALL:"source:workplace:teamwork_call",WORKPLACE_TEAMWORK_TEST:"source:workplace:test",WORKPLACE_TEAMWORK_GROUP_POST:"source:workplace:group_post",CREATOR_STUDIO:"source:creator_studio",FB_GROUP_ADMINSHIP_SYNC:"source:fbgroup:adminship_sync",FB_GROUP_CHAT_MUTE_MEMBER:"source:fbgroup:mute_member",MESSENGER_ADS_PARTIAL_AUTOMATED_REMINDER:"source:ads_partial_automated:reminder",COMMUNITY_HELP_LISTING:"source:community_help_listing",FUNDRAISER_MESSAGE_BLAST:"source:fundraiser_message_blast",MENTORSHIP:"source:mentorship",MENTORSHIP_DISCUSSION_TOPIC:"source:mentorship_discussion_topic",MENTORSHIP_OUTREACH:"source:mentorship_outreach",VOLUNTEERING_ORGANIZER_REACHOUT:"source:volunteering_organizer_reachout",VOD_CONVERSATION:"source:vod_conversation",LOCAL_SEARCH_SERVICES:"source:local_search_services",YOUTH_VAULT:"source:youth_vault",MESSENGER_KIDS:"source:messenger_kids",MESSENGER_KIDS_ACTIVITY:"source:messenger_kids:activity",STORY_REPLY:"source:story_reply",LOCAL_DEV_PLATFORM:"source:local_dev_platform",INSTAGRAM_DIRECT:"source:instagram_direct",WA_MSGR_INTEROP:"source:wa-msgr-interop",C4G_CURRENT_GROUP_MEMBERS_ENTINTEGRITY:"source:c4g_current_group_members_entintegrity",CHATROOM:"source:chatroom",FB_GROUPS:"source:fb_groups",FB_INBOX:"source:messaging_inbox_in_blue",FB_JOINABLE_VIDEO_CHATS:"source:fb_joinable_video_chats",FB_PAGE:"source:fb_page",FB_PROFILE:"source:fb_profile",FB_STORY:"source:fb_story",FB_STATUS:"source:fb_status",FB_TOP_OF_FEED_UNIT:"source:fb_top_of_feed_unit",FEED:"source:feed",MIB_NOTIFICATION:"source:mib_notification",KOTOTORO:"source:kototoro",SHARESHEET:"source:sharesheet",UFI:"source:ufi",ROOMS_INVITE:"source:rooms_invite",IG_ROOMS:"source:ig_rooms",FRIENDS_HOME:"source:friends_home",FRIENDS_HOME_SENDER_SIDE_POST_ACCEPT:"source:friends_home:sender_side_post_accept",NPE_WHALE:"source:npe_whale",NPE_POUTINE:"source:npe_poutine",NPE_HOBBI:"source:npe_hobbi",SHOPS_XMA_DOGFOODING:"source:shops_xma_dogfooding",CHAT_FOR_ROOM:"source:chat_for_room",WORK_AUTOMATION:"source:work_automation",WORK_ROOM_INCALL_CHAT:"source:work_room_incall_chat",MESSENGER_ROOM_INCALL_CHAT:"source:messenger_room_incall_chat",SECURITY_ACADEMY_BOT:"source:security_academy_bot",VR_MESSENGER:"source:vr_messenger",PRODUCT_PICKER:"product_picker",STARS_ONBOARDING:"source:stars_onboarding",N4M:"source:novi_for_messenger",ARMADILLO_WA:"source:armadillo_wa",REMEDIATION_PLATFORM:"REMEDIATION_PLATFORM",ONLINE_LEARNING_CLASS_CREATION:"source:online_learning_class_creation",ONLINE_LEARNING_CLASS_GOING:"source:online_learning_class_going",ONLINE_LEARNING_CLASS_ADMIN_SYNC:"source:online_learning_class_admin_sync",PORTAL_CONTACT_GROUP:"source:portal_contact_group"});f["default"]=a}),66);
__d("MessageProfileRangeType",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:"n",PROFILE:"p",THREAD:"t",THREAD_ACTIVE:"a"});f["default"]=a}),66);
__d("MessageUnsendabilityStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({CAN_UNSEND:"can_unsend",DENY_LOG_MESSAGE:"deny_log_message",DENY_TOMBSTONE_MESSAGE:"deny_tombstone_message",DENY_FOR_NON_SENDER:"deny_for_non_sender",DENY_P2P_PAYMENT:"deny_p2p_payment",DENY_STORY_REACTION:"deny_story_reaction",DENY_BLOB_ATTACHMENT:"deny_blob_attachment",DENY_MESSAGE_NOT_FOUND:"deny_message_not_found"});f["default"]=a}),66);
__d("MessageUnsendabilityStatus.bs",["MessageUnsendabilityStatus"],(function(a,b,c,d,e,f){"use strict";function a(a){if(a==null)return null;switch(a){case"can_unsend":return b("MessageUnsendabilityStatus").CAN_UNSEND;case"deny_blob_attachment":return b("MessageUnsendabilityStatus").DENY_BLOB_ATTACHMENT;case"deny_for_non_sender":return b("MessageUnsendabilityStatus").DENY_FOR_NON_SENDER;case"deny_log_message":return b("MessageUnsendabilityStatus").DENY_LOG_MESSAGE;case"deny_p2p_payment":return b("MessageUnsendabilityStatus").DENY_P2P_PAYMENT;case"deny_story_reaction":return b("MessageUnsendabilityStatus").DENY_STORY_REACTION;case"deny_tombstone_message":return b("MessageUnsendabilityStatus").DENY_TOMBSTONE_MESSAGE;default:return null}}f.fromNullableString=a}),null);
__d("MessagingGenericAdminTextType",[],(function(a,b,c,d,e,f){a=Object.freeze({ALOHA_AUTOCONNECT_INVITED:"aloha_autoconnect_invited",ALOHA_CONTACT_ADDED:"aloha_contact_added",ALOHA_CONTACT_ADDED_TO_ALOHA_PROXY_USER:"aloha_contact_added_to_aloha_proxy_user",ALOHA_CONTACT_REMOVED:"aloha_contact_removed",ALOHA_INVITE_OWNER_ACCEPT:"aloha_invite_owner_accept",ALOHA_INVITE_OWNER_DECLINE:"aloha_invite_owner_decline",ALOHA_MEDIA_ADDED:"aloha_media_added",ALOHA_MEDIA_SENT:"aloha_media_sent",ALOHA_VISUAL_MEDIA_SENT:"aloha_visual_media_sent",ALOHA_OWNER_INVITED:"aloha_owner_invited",ALOHA_PROXY_USER_NAME_SET:"aloha_proxy_user_name_set",ALOHA_PROXY_USER_PROFILE_PHOTO_SET:"aloha_proxy_user_profile_photo_set",ALOHA_WIFI_CREDENTIALS_SET:"aloha_wifi_credentials_set",ALOHA_USER_JOINED_CALL_ON_ALOHA:"aloha_user_joined_call_on_aloha",ALOHA_CALL_ENDED_ON_ALOHA:"aloha_call_ended_on_aloha",ALOHA_CALL_INVITE:"aloha_call_invite",BCMP_RESPOND_TO_PROJECT_BRIEF:"bcmp_respond_to_project_brief",BCMP_BRAND_INITIATED_MESSAGE:"bcmp_brand_initiated_message",BCMP_CAMPAIGN_INVITE:"bcmp_campaign_invite",MADE_POLL_VOTE:"made_poll_vote",GROUP_POLL:"group_poll",GENERIC_NEW_CONNECTION:"generic_new_connection",CONFIRM_FRIEND_REQUEST:"confirm_friend_request",THREAD_CUSTOMIZATION_UPSELL:"thread_customization_upsell",PHONE_CONTACT_UPLOAD:"phone_contact_upload",RELATIONSHIP_CREATED:"relationship_created",ACCEPT_PENDING_THREAD:"accept_pending_thread",RAMP_UP_WELCOME_MESSAGE:"ramp_up_welcome_message",CHANGE_THREAD_THEME:"change_thread_theme",CHANGE_THREAD_ICON:"change_thread_icon",GROUP_THREAD_CREATED:"group_thread_created",THREAD_EPHEMERAL_SEND_MODE:"thread_ephemeral_send_mode",INVITE_ACCEPTED:"invite_accepted",MESSENGER_INVITE_SENT:"messenger_invite_sent",TURN_ON_PUSH:"turn_on_push",JOURNEY_PROMPT_COLOR:"journey_prompt_color",JOURNEY_PROMPT_LIKE:"journey_prompt_like",JOURNEY_PROMPT_NICKNAME:"journey_prompt_nickname",JOURNEY_PROMPT_SETUP:"journey_prompt_setup",CHANGE_THREAD_NICKNAME:"change_thread_nickname",NOTIFY_GROUP_MAYORSHIP:"notify_group_mayorship",PROMPT_GROUP_MAYORSHIP_CUSTOMIZATION:"prompt_group_mayorship_customization",MESSAGE_COUNT_MILESTONE_MESSAGE:"message_count_milestone_message",BOT_THREAD_SUBSCRIPTION:"bot_thread_subscription",RTC_CALL_LOG:"rtc_call_log",RTC_PAGE_CALLBACK:"rtc_page_callback",RTC_INSTANT_VIDEO_LIFECYCLE:"rtc_instant_video_lifecycle",JOURNEY_PROMPT_BOT:"journey_prompt_bot",RIDE_ORDERED_MESSAGE:"ride_ordered_message",DESTINATION_ETA_MESSAGE:"destination_eta_message",RIDE_ARRIVED_MESSAGE:"ride_arrived_message",JOURNEY_PROMPT_NEW_SETUP:"journey_prompt_new_setup",LIGHTWEIGHT_EVENT_CREATE:"lightweight_event_create",LIGHTWEIGHT_EVENT_DELETE:"lightweight_event_delete",LIGHTWEIGHT_EVENT_NOTIFY:"lightweight_event_notify",LIGHTWEIGHT_EVENT_NOTIFY_BEFORE_EVENT:"lightweight_event_notify_before_event",LIGHTWEIGHT_EVENT_RSVP:"lightweight_event_rsvp",LIGHTWEIGHT_EVENT_UPDATE:"lightweight_event_update",LIGHTWEIGHT_EVENT_UPDATE_LOCATION:"lightweight_event_update_location",LIGHTWEIGHT_EVENT_UPDATE_TIME:"lightweight_event_update_time",LIGHTWEIGHT_EVENT_UPDATE_TITLE:"lightweight_event_update_title",SAFETY_LOCATION_REQUEST_SENT:"safety_location_request_sent",SAFETY_LOCATION_REQUEST_RESPONDED:"safety_location_request_responded",SAFETY_LOCATION_REQUEST_DENIED:"safety_location_request_denied",AD_MANAGE_MESSAGE:"ad_manage_message",ADMIN_TEXT_WITH_LINK:"admin_text_with_link",ADMIN_TEXT_WITH_RPC:"admin_text_with_rpc",AD_REPLY_MESSAGE:"ad_reply_message",TAGGED_PHOTO:"tagged_photo",GAME_SCORE:"game_score",INSTANT_GAME_UPDATE:"instant_game_update",INSTANT_GAME_BOT_INTRO:"instant_game_bot_intro",INSTANT_GAME_BOT_FEEDBACK:"instant_game_bot_feedback",INSTANT_GAME_WORLD_CUP_INTRO:"intant_games_world_cup_intro",INSTANT_GAME_CUSTOM_UPDATE_NUX_ADMIN_MESSAGE:"instant_game_custom_update_nux_admin_message",INSTANT_GAME_OFFLINE_MATCH_INTRO:"instant_game_offline_match_intro",INSTANT_GAME_TOURNAMENT_REMINDER:"instant_game_tournament_reminder",MEDIA_SUBSCRIPTION_MANAGE:"media_subscription_manage",M_AI_SURVEY:"m_ai_survey",PHONE_NUMBER_LOOKUP_NOTICE:"phone_number_lookup_notice",MARK_AS_SHIPPED_UPDATE:"mark_as_shipped_update",MESSENGER_PRECHECKED_PLUGIN:"messenger_prechecked_plugin",MESSENGER_THREAD_RESURRECTION_NOTICE:"messenger_thread_resurrection_notice",MESSENGER_ENTRY_BY_MDOTME_LINK_WITH_REF:"messenger_entry_by_mdotme_link_with_ref",ADD_CONTACT:"add_contact",PRODUCT_INVOICE_RECEIPT_REJECTED:"product_invoice_receipt_rejected",PRODUCT_INVOICE_PAID:"product_invoice_paid",PRODUCT_INVOICE_VOIDED:"product_invoice_voided",PRODUCT_INVOICE_SHIPPED:"product_invoice_shipped",PRODUCT_INVOICE_PAYMENT_EXPIRED:"product_invoice_payment_expired",PRODUCT_INVOICE_RECEIPT_UPLOADED:"product_invoice_receipt_uploaded",PRODUCT_INVOICE_PAYMENT_PROCESSING:"product_invoice_payment_processing",PRODUCT_INVOICE_PAYMENT_FAILED:"product_invoice_payment_failed",PRODUCT_INVOICE_SHIPPING_UPDATE:"product_invoice_shipping_update",PRODUCT_INVOICE_STATUS_UPDATE:"product_invoice_status_update",PRODUCT_INVOICE_DUPLICATE_PAYMENT_REFUND_UPDATE:"product_invoice_duplicate_payment_refund_update",SELLER_NOT_ONBOARDED_FOR_PAYMENTS:"seller_not_onboarded_for_payments",CHANGE_JOINABLE_SETTING:"change_joinable_setting",CHANGE_THREAD_ADMINS:"change_thread_admins",CHANGE_THREAD_APPROVAL_MODE:"change_thread_approval_mode",CAPY_SESSION_BEGIN:"capy_session_begin",CAPY_SESSION_BOT_BEGIN:"capy_session_bot_begin",CAPY_SESSION_END:"capy_session_end",CAPY_AGENT_JOIN:"capy_agent_join",CAPY_AGENT_DUMPED:"capy_agent_dumped",CAPY_SESSION_UNAVAILABLE:"capy_session_unavailable",CAPY_SESSION_WAIT_TIME:"capy_session_wait_time",CAPY_TRANSCRIPT_NOTIF:"capy_transcript_notif",GROUP_SMS_PARTICIPANT_JOINED:"group_sms_participant_joined",GROUP_SMS_PARTICIPANT_CAPPED:"group_sms_participant_capped",SMS_PHONE_NUMBER_CHECK:"sms_phone_number_check",MESSENGER_BOT_REVIEW_SENT:"messenger_bot_review_sent",MESSENGER_CODE_SCAN:"messenger_code_scan",MESSENGER_LIVECHAT_PLUGIN_OPEN:"messenger_livechat_plugin_open",MESSENGER_LIVECHAT_PLUGIN_GUEST_END_CHAT:"messenger_livechat_plugin_guest_end_chat",MESSENGER_LIVECHAT_PLUGIN_GUEST_START_CHAT:"messenger_livechat_plugin_guest_start_chat",MESSENGER_LIVECHAT_PLUGIN_URL_UPDATE:"messenger_livechat_plugin_url_update",MESSENGER_LIVECHAT_PLUGIN_FB_USER_START_CHAT:"messenger_livechat_plugin_fb_user_start_chat",MESSENGER_LIVECHAT_PLUGIN_GUEST_USER_START_CHAT:"messanger_livechat_plugin_guest_user_start_chat",MN_ACCOUNT_LINKING_TEXT:"mn_account_linking_text",MN_ACCOUNT_UNLINKING_TEXT:"mn_account_unlinking_text",MN_ACCOUNT_FORCED_UNLINKING_TEXT:"mn_account_forced_unlinking_text",MN_REF_SEND_TEXT:"mn_ref_send_text",ADS_WELCOME_MSG:"ads_welcome_msg",THREAD_JOINABLE_PROMOTION_TEXT:"thread_joinable_promotion_text",PAGES_PLATFORM_REQUEST_TEXT:"pages_platform_request_text",MESSENGER_NEW_USER_GET_STARTED:"messenger_new_user_get_started",SMS_PHONE_NUMBER_TOGGLE:"sms_phone_number_toggle",PAGES_PLATFORM_CREATE_APPOINTMENT:"Pages_Platform_create_appointment",INTERNAL_CAREER_JOBSY_REACHOUT_CONNECTED:"internal_career_jobsy_reachout_connected",JOINABLE_GROUP_THREAD_CREATED:"joinable_group_thread_created",JOINABLE_ROOM_CREATED_WITH_CO_CREATORS:"joinable_room_created_with_co_creators",PAGES_PLATFORM_ACCEPT_APPOINTMENT:"pages_platform_accept_appointment",PAGES_PLATFORM_REFERRAL_CONFIRMED_APPOINTMENT:"pages_platform_referral_confirmed_appointment",PAGES_PLATFORM_DECLINE_APPOINTMENT:"pages_platform_decline_appointment",PAGES_PLATFORM_USER_CANCEL:"pages_platform_user_cancel",PAGES_PLATFORM_ADMIN_CANCEL:"pages_platform_admin_cancel",MESSENGER_OMNIM_CREATE_FLOW:"messenger_omnim_create_flow",MESSENGER_OMNIM_UPDATE_FLOW:"messenger_omnim_update_flow",MESSENGER_OMNIM_UPDATE_FLOW_STATE:"messenger_omnim_update_flow_state",MESSENGER_GROUP_DESCRITPION_UPDATE:"messenger_group_description_update",MESSENGER_GROUP_DESCRIPTION_UPDATE_V2:"messenger_group_description_update_v2",MESSENGER_EXTENSION_ADD_CART:"messenger_extension_add_cart",MESSENGER_EXTENSION_ADD_FAVORITE:"messenger_extension_add_favorite",MESSENGER_AD_CONTEXT:"messenger_ad_context",PAGES_PLATFORM_APPOINTMENT_REMINDER:"pages_platform_appointment_reminder",PAGES_PLATFORM_ADMIN_DECLINE:"pages_platform_admin_decline",POKE_RECEIVED:"poke_received",MESSENGER_STATION_SUBSCRIPTION:"messenger_station_subscription",MESSENGER_USER_ALSO_ON_MESSENGER:"messenger_user_also_on_messenger",MESSENGER_INBOX2_BIRTHDAY_BUMP:"messenger_inbox2_birthday_bump",MESSENGER_RESPOND_REMINDER_CONFIRMATION:"messenger_respond_reminder_confirmation",MESSENGER_RESPOND_REMINDER:"messenger_respond_reminder",MESSENGER_RESPOND_REMINDER_USER_CANCEL:"messenger_respond_reminder_user_cancel",MESSENGER_RESPOND_REMINDER_CANCEL_SUGGESTION:"messenger_respond_reminder_cancel_suggestion",STARTED_SHARING_VIDEO:"started_sharing_video",LIVE_VIDEO_CHAT:"live_video_chat",PARTICIPANT_JOINED_GROUP_CALL:"participant_joined_group_call",MESSENGER_ONLY_PHONE_JOINED_WITH_NEW_ACCOUNT:"messenger_only_phone_joined_with_new_account",PAGES_COMMERCE_PAYMENT_ENABLED:"pages_commerce_payment_enabled",GROUP_PAYMENT_REQUEST:"group_payment_request",P2P_CALL_ESCALATED_TO_GROUP_CALL:"p2p_call_escalated_to_group_call",INVITED_TO_ESCALATED_P2P_CALL:"invited_to_escalated_p2p_call",EVENT_UPCOMING:"event_upcoming",PAGES_VISITOR_POST_SEND_MESSAGE_UPSELL:"pages_visitor_post_send_message_upsell",PAGES_LOW_MESSAGE_RESPONSE_RATE:"pages_low_message_response_rate",PAGES_START_CALL:"pages_start_call",PARTIES_INVITE:"parties_invite",WORK_INVITE_CLAIMED:"work_invite_claimed",WORK_BOT_INSTALLED:"work_bot_installed",WORK_NEW_MULTI_COMPANY_CHAT:"work_new_multi_company_chat",PARTIAL_AUTOMATED_FEEDBACK:"partial_automated_feedback",P2P_PAYMENT_REQUEST_REMINDER:"p2p_payment_request_reminder",PHOTO_TAG_BUMP:"photo_tag_bump",MESSENGER_CALL_UPGRADE_LEGACY_CLIENT:"messenger_call_upgrade_legacy_client",DIRECTED_WALL_POST:"directed_wall_post",MESSENGER_CALL_LOG:"messenger_call_log",P2P_PAYMENT_MONEY_RAIN_GAME_ENTRY_POINT:"p2p_payment_money_rain_game_entry_point",MESSENGER_MONTAGE_MENTIONS:"messenger_montage_mentions",PAGES_MESSAGING_BLOCK_WORDS:"pages_messaging_block_words",SHIPPO_TRACKING_UPDATES:"shippo_tracking_updates",NEO_APPROVED_CONNECTION_ADDED:"neo_approved_connection_added",NEO_APPROVED_USERNAME:"neo_approved_username",NEO_PARENT_PROXY_CREATED:"neo_parent_proxy_created",NEO_PARENT_PROXY_FORWARDED:"neo_parent_proxy_forwarded",NEO_PARENT_UNLOCK_STICKER:"neo_parent_unlock_sticker",NEO_READ_ONLY_RECIPIENT:"neo_read_only_recipient",CHANGE_FAVORITE_COLOR:"change_favorite_color",MARKETPLACE_ITEM_CHANGED:"marketplace_item_changed",LINK_CTA:"link_cta",PLAIN_TEXT:"plain_text",BUSINESS_INLINE_FEEDBACK_FORM_CONFIRMATION:"business_inline_feedback_form_confirmation",BUSINESS_FEEDBACK_FORM_CONFIRMATION:"business_feedback_form_confirmation",BUSINESS_INLINE_FEEDBACK_FORM_EXPIRING:"business_inline_feedback_form_expiring",BUSINESS_FEEDBACK_FORM_EXPIRING:"business_feedback_form_expiring",SDR_BOT_SESSION_BEGIN:"sdr_bot_session_begin",SERVICES_VERTICAL_REDEEMED_REFERRAL:"services_vertical_redeemed_referral",SERVICES_VERTICAL_OPT_OUT_REQUESTS:"services_vertical_opt_out_requests",SERVICES_VERTICAL_OPT_OUT_REQUESTS_SUCCESS:"services_vertical_opt_out_requests_success",SERVICES_VERTICAL_LEAD_GEN_SURVEY:"services_vertical_lead_gen_survey",SERVICES_VERTICAL_LEAD_GEN_SURVEY_EDIT:"services_vertical_lead_gen_survey_edit",PAGES_MARK_AS_PAID:"pages_mark_as_paid",MIGRATED_TO_WORKPLACE:"migrated_to_workplace",MESSENGER_GROUP_EVENT_STATUS_UPDATE:"messenger_group_event_status_update",NEO_APPROVED_USER_REMOVED_FROM_GROUP:"neo_approved_user_removed_from_group",LIVE_CHAT_SUPPORT_AGENT_JOIN:"live_chat_support_agent_join",LIVE_CHAT_SUPPORT_SESSION_BEGIN:"live_chat_support_session_begin",LIVE_CHAT_SUPPORT_SESSION_END:"live_chat_support_session_end",MONTAGE_DIRECT_KEEP:"montage_direct_keep",MONTAGE_DIRECT_EXPIRE:"montage_direct_expire",CHSBOT_CONVERSATION_ENDED:"chsbot_conversation_ended",CHSBOT_LIVE_CHAT_SUPPORT_AGENT_BEGIN:"chsbot_live_chat_support_agent_begin",CHSBOT_LIVE_CHAT_SUPPORT_AGENT_END:"chsbot_live_chat_support_agent_end",CHSBOT_LIVE_PHONE_SUPPORT_AGENT_CALLING:"chsbot_live_phone_support_agent_calling",CHSBOT_SUPPORT_REQUESTED:"chsbot_support_requested",SUPPORT_BOT_SESSION_AGENT_JOIN:"support_bot_session_agent_join",SUPPORT_BOT_SESSION_AGENT_LEAVE:"support_bot_session_agent_leave",SUPPORT_BOT_SESSION_END:"support_bot_session_end",SUPPORT_BOT_CALL_BEGIN:"support_bot_call_begin",SUPPORT_BOT_CALL_END:"support_bot_call_end",SUPPORT_BOT_INITIATE_CONVERSATION:"support_bot_initiate_conversation",MESSENGER_SUBSCRIBE_TO_UPDATES:"messenger_subscribe_to_updates",MESSENGER_UNSUBSCRIBE_FROM_UPDATES:"messenger_unsubscribe_from_updates",MESSENGER_BLOCK_MESSAGES:"messenger_block_messages",MESSENGER_UNBLOCK_MESSAGES:"messenger_unblock_messages",MESSENGER_TURN_ON_MESSAGES:"messenger_turn_on_messages",MESSENGER_TURN_OFF_MESSAGES:"messenger_turn_off_messages",THANKS_FOR_SHARING_MESSAGE_CONTEXT:"thanks_for_sharing_message_context",GROUP_ADMIN_MODEL_NUX:"group_admin_model_nux",MESSENGER_PAYMENT_INCENTIVE_INFO:"messenger_payment_incentive_info",MESSENGER_PLATFORM_PERSONA:"messenger_platform_persona",MESSENGER_GROUP_SYNC_OPT_IN:"messenger_group_sync_opt_in",MESSENGER_GROUP_SYNC_OPT_OUT:"messenger_group_sync_opt_out",MENTORSHIP_MATCH:"mentorship_match",MENTORSHIP_PROGRAM_MATCH:"mentorship_program_match",MENTORSHIP_PROGRAM_CONTINUE:"mentorship_program_continue",MENTORSHIP_PROGRAM_LEAVE:"mentorship_program_leave",MENTORSHIP_PROGRAM_LEAVE_PROMPT:"mentorship_program_leave_prompt",MENTORSHIP_CURRICULUM_STEP:"mentorship_curriculum_step",MENTORSHIP_DISCUSSION_TOPIC_SET_PROMPT:"mentorship_discussion_topic_set_prompt",MENTORSHIP_CHECK_IN_REMINDER:"mentorship_check_in_reminder",MENTORSHIP_DISCLAIMER:"mentorship_disclaimer",PAGES_CALL_DEFLECTION_UPSELL:"pages_call_deflection_upsell",RTC_PHOTOBOOTH:"rtc_photobooth",DELAYED_PHONE_NUMBER_MATCH:"delayed_phone_number_match",AUTOMATIC_TRANSLATION_ENABLED:"automatic_translation_enabled",AUTOMATIC_TRANSLATION_AUTO_ENABLED:"automatic_translation_auto_enabled",AUTOMATIC_TRANSLATION_DISABLED:"automatic_translation_disabled",AUTOMATIC_TRANSCRIPTION_ENABLED:"automatic_transcription_enabled",AUTOMATIC_TRANSCRIPTION_DISABLED:"automatic_transcription_disabled",MESSENGER_ROOM_MIGRATION:"messenger_room_migration",PAGE_ADMIN_RESPONSIVENESS_REMINDER:"page_admin_responsiveness_reminder",MESSENGER_GROWTH_GENERIC_ADMIN_TEXT:"messenger_growth_generic_admin_text",MESSENGER_TALK_TO_YOUR_MOM_REMINDER:"messenger_talk_to_your_mom_reminder",PAYMENT_INCENTIVE_RECEIVED:"payment_incentive_received",PAGES_THREAD_REMINDER:"pages_thread_reminder",MESSENGER_PLATFORM_PERSONA_LEAVE_THREAD:"messenger_platform_persona_leave_thread",STORY_REPLY_CONTEXT:"story_reply_context",PAGES_AUTOMATED_RESPONSE_RECOMMENDATION:"pages_automated_response_recommendation",PAGES_AUTOMATED_RESPONSE_SMART_REPLY:"pages_automated_response_smart_reply",PAGES_AUTOMATED_RESPONSE_JOB_APPLICATION:"pages_automated_response_job_APPLICATION",MESSENGER_ICEBREAKER_VOTE_CAST:"messenger_icebreaker_vote_cast",PARTIES_PRESENCE:"parties_presence",PAGE_THREAD_ADMIN_ASSIGNMENT_TEXT:"page_thread_admin_assignment_text",RTC_INSTANT_ACTIVITY_LIFECYCLE:"rtc_instant_activity_lifecycle",RTC_VIDEO_CHAT_LINK_LIFECYCLE:"rtc_video_chat_link_lifecycle",RTC_REDUCE_CALL_QUALITY:"rtc_reduce_call_quality",SHIBA_MOCK_BOT_RESTART_CHAT_TEXT:"shiba_mock_bot_restart_chat_text",MARKETPLACE_RENTALS_INITIAL_MESSAGE:"marketplace_rentals_initial_message",MARKETPLACE_RENTALS_SENDER_INFO:"marketplace_rentals_sender_info",PAGES_MARK_AS_PAID_NEW:"pages_mark_as_paid_new",MESSENGER_BUSINESS_REPORT_SPAM:"messenger_business_report_spam",MESSENGER_BUSINESS_REPORT_INAPPROPRIATE:"messenger_business_report_inappropriate",MESSENGER_BUSINESS_REPORT_OTHER_ABUSE:"messenger_business_report_other_abuse",FRIENDED_IN_MESSENGER:"friended_in_messenger",MARKETPLACE_REPLY_REMINDER:"marketplace_reply_reminder",VOD_CONVERSATION_SEND_MESSAGE:"vod_conversation_send_message",MESSENGER_SHARED_WITH:"messenger_shared_with",PAGE_THREAD_ACTION_SYSTEM_ADD_DETAILS:"page_thread_action_system_add_details",PAGE_USER_MESSENGER_CONNECTED:"page_user_messenger_connected",FB_ONLY_BOT_TEXT:"fb_only_bot_text",MESSENGER_SCHOOL_CHAT_AUTO_ADD_USER:"messenger_school_chat_auto_add_user",LIVING_ROOM_MESSAGE:"living_room_message",MESSENGER_FRIENDVERSARY_SHARED_TO:"messenger_friendversary_shared_to",PARENT_APPROVED_NEW_FRIEND_CODE:"parent_approved_new_friend_code",CHAT_ENTICEMENT_JOINED:"chat_enticement_joined",EVENT_CONFIRMED_GOING:"event_confirmed_going",CHEX_ORDER_STATE_CHANGED:"chex_order_state_changed",MESSENGER_CARE_PII_PRIVACY_INTRO:"messenger_care_pii_privacy_intro",MESSENGER_CARE_AUTH_LINKS_REF:"messenger_care_auth_links_ref",MARKETPLACE_RATE_SELLER:"marketplace_rate_seller",MARKETPLACE_DISCOUNTED_PRICE_EXPIRING:"marketplace_discounted_price_expiring",GEMSTONE_THREAD_CREATION:"gemstone_thread_creation",GEMSTONE_FB_MESSENGER_THREAD_CREATION:"gemstone_fb_messenger_thread_creation",GEMSTONE_CONTACT_SHARE_UPSELL:"gemstone_contact_share_upsell",GEMSTONE_MUTUAL_READY_TO_MEET:"gemstone_mutual_ready_to_meet",GEMSTONE_ADD_READY_TO_MEET_SINGLE_SIDED:"gemstone_add_ready_to_meet_single_sided",GEMSTONE_REMOVE_READY_TO_MEET_SINGLE_SIDED:"gemstone_remove_ready_to_meet_single_sided",GEMSTONE_STALE_THREAD:"gemstone_stale_thread",GEMSTONE_WE_MET_PROMPT:"gemstone_we_met_prompt",MNF_LIGHTWEIGHT_LIKE:"mnf_lightweight_like",WORKCHAT_REMINDER_ADMIN_TEXT:"workchat_reminder_admin_text",WORKCHAT_REMINDER_LINK_CTA:"workchat_reminder_link_cta",WORKCHAT_RECIPIENT_ON_DND_WARNING:"workchat_recipient_on_dnd_warning",WORKCHAT_PIN_MESSAGE_ACTION:"workchat_pin_message_action",WORKCHAT_UNPIN_MESSAGE_ACTION:"workchat_unpin_message_action",CHATS_IN_GROUPS_PRE_MIGRATION:"chats_in_groups_pre_migration",CHATS_IN_GROUPS_MIGRATION:"chats_in_groups_migration",POST_SHARED_FROM_GROUP:"post_shared_from_group",WORKCHAT_ACTIVATION_WELCOME_MESSAGE:"workchat_activation_welcome_message",WORKCHAT_SELF_CHAT_INITIATOR:"workchat_self_chat_initiator",WORKCHAT_ACTIVATION_UNCLAIMED_ACCOUNT_WELCOME_MESSAGE:"workchat_activation_unclaimed_account_welcome_message",MARKETPLACE_ASSISTANT_SUPPORT_CASE_START:"marketplace_assistant_support_case_start",MARKETPLACE_ASSISTANT_SUPPORT_CASE_END:"marketplace_assistant_support_case_end",SECURITY_HUB_AGENT_LEFT:"security_hub_agent_left",SECURITY_HUB_AGENT_JOINED:"security_hub_agent_joined",NEO_SEND_DGG:"neo_send_dgg",SECURITY_HUB_AGENT_REASSIGNED:"security_hub_agent_reassigned",MARKETPLACE_MESSAGE_ENHANCEMENT:"marketplace_message_enhancement",C4G_MESSAGE_REMOVED:"c4g_message_removed",C4G_NEW_VIDEO_ROOM_CREATED:"c4g_new_video_room_created",C4G_VIDEO_ROOM_ENDED:"c4g_video_room_ended",C4G_VIDEO_ROOM_PARTICIPANT_JOIN:"c4g_video_room_participant_join",C4G_PARTICIPANT_JOIN:"c4g_participant_join",C4G_PARTICIPANT_LEFT:"c4g_participant_left",NEO_SHARE_VIRTUAL_PET:"neo_share_virtual_pet",NEO_SHARE_ASYNC_GAME_SCORE:"neo_share_async_game_score",NEO_SHARE_ASYNC_GAME_OTHER:"neo_share_async_game_other",NEO_SHARE_PROFILE_PHOTO_UPDATE:"neo_share_profile_photo_update",NEO_UPDATE_EMOJI_STATUS:"neo_update_emoji_status",NEO_NOTIFY_PARENT_EMOJI_STATUS:"neo_notify_parent_emoji_status",NEO_BEACON_QUICK_REACTION:"neo_beacon_quick_reaction",NEO_BEACON_QUICK_REPLY:"neo_beacon_quick_reply",MARKETPLACE_PROFILE_DESCRIPTION:"marketplace_profile_description",THREAD_THEME_DEPRECATION:"thread_theme_deprecation",MAKETPLACE_SELLER_REQUEST_RATING:"maketplace_seller_request_rating",PRODUCT_INVOICE_CREATED:"PRODUCT_INVOICE_CREATED",REJOINED_GROUP_THREAD_AFTER_ERROR:"rejoined_group_thread_after_error",IG_DIRECT_CALL_LOG:"ig_direct_call_log",PAYMENT_REQUEST_REMINDER:"payment_request_reminder",MARKETPLACE_BSG_CONTACT_SELLER:"marketplace_bsg_contact_seller",MARKETPLACE_TXN_QUESTION:"marketplace_txn_question",MARKETPLACE_BUYER_TXN_QUESTION:"marketplace_buyer_txn_question",WORKCHAT_DETACH_SYNCED_GROUP_CHAT:"workchat_detach_synced_group_chat",CHAT_PLUGIN_GUEST_EXPIRATION:"chat_plugin_guest_expiration",MARKETPLACE_FOLLOW_SUGGESTION:"marketplace_follow_suggestion",CIP_REFERRAL_MESSAGE:"cip_referral_message",FB_LOGIN_B2P:"fb_login_b2p",EO_SRT_HELPDESK_TECHNICIAN_JOINED:"eo_srt_helpdesk_technician_joined",EO_SRT_HELPDESK_TECHNICIAN_LEFT:"eo_srt_helpdesk_technician_left",COMMUNITY_CHATS_DESCRITPION_UPDATE:"community_chats_description_update",COMMUNITY_CHATS_THREAD_CREATION:"community_chats_thread_creation",MARKETPLACE_MEETING_PLAN_DELETED:"marketplace_meeting_plan_deleted",MARKETPLACE_MEETING_PLAN_SHARED:"marketplace_meeting_plan_shared",MARKETPLACE_COMMERCE_POST_PRIVATE_REPLY:"marketplace_commerce_post_private_reply",PRIVATE_REPLY_ADMIN_TEXT_LOG:"private_reply_admin_text_log",MESSAGE_REQUEST_ACCEPTED_ADMIN_TEXT_LOG:"message_request_accepted_admin_text_log",CHAT_PLUGIN_UPGRADE_PAGE_SIDE:"chat_plugin_upgrade_page_side",MARKETPLACE_DRAFT_THREAD:"marketplace_draft_thread",MARKETPLACE_THREAD_RTC_ENABLED:"marketplace_thread_rtc_enabled",MARKETPLACE_THREAD_RTC_BUYER_INFORM:"marketplace_thread_rtc_buyer_inform",PRODUCT_INVOICE_PAYMENT_DISPUTED:"product_invoice_payment_disputed",SHH_MODE_SCREENSHOT:"shh_mode_screenshot",SHH_MODE_REPLAY:"SHH_MODE_REPLAY",MESSAGING_REACHABILITY_ONE_WAY_SEND:"messaging_reachability_one_way_send",NEO_LINK_SHARING:"neo_link_sharing",MARKETPLACE_REPLY_REMINDER_1_TO_1_THREAD:"marketplace_reply_reminder_1_to_1_thread",MARKETPLACE_COMMENT_TO_MESSAGING:"marketplace_comment_to_messaging",ADULT_MINOR_INTERACTION_ONE_WAY_SEND:"adult_minor_interaction_one_way_send",SHARED_ITEM_XMA:"shared_item_xma",MESSENGER_ROOMS_THREAD_CREATED:"messenger_rooms_thread_created_xmat",MESSENGER_ROOMS_THREAD_PARTICIPANT_JOINED:"messenger_rooms_thread_participant_joined_xmat",MESSENGER_ROOMS_THREAD_PARTICIPANT_LEFT:"messenger_rooms_thread_participant_left_xmat",MESSENGER_ROOMS_TO_LIVE_STARTED:"messenger_rooms_to_live_started_xmat",MESSENGER_ROOMS_TO_LIVE_END:"messenger_rooms_to_live_end_xmat",PAYMENTS_CARE_B2C_MESSENGER_ESCALATION_XMAT:"payments_care_b2c_messenger_escalation_xmat",REACTION_LOG:"reaction_log",GAMING_SQUADS_ADMIN_XMAT:"gaming_squads_admin_xmat",MAGIC_WORDS:"magic_words",PIN_MESSAGES_V2:"pin_messages_v2",UNPIN_MESSAGES_V2:"unpin_messages_v2",N4M_P2P_INVITE_XMAT:"n4m_p2p_invite_xmat",PAY_REFERRAL_INVITATION_SENT_XMAT:"pay_referral_invitation_sent_xmat",ICEBREAKER_SENT_BY_MISTAKE:"icebreaker_sent_by_mistake",EARLY_THREAD_CLOSE_OUT_SENT_BY_MISTAKE:"early_thread_close_out_sent_by_mistake",N4M_P2P_CANCEL_TXN_XMAT:"N4M_P2P_CANCEL_TXN_XMAT",NOTIFICATION_MESSAGES:"notification_messages",WORKCHAT_BOT_LEFT_MISSING_PERMISSION:"workchat_bot_left_missing_permission"});f["default"]=a}),66);
__d("MessagingTagUtils",["MercurySourceType","MessagingTagConstants"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set(Object.values(c("MercurySourceType")));function a(a){for(var b=0;b<a.length;b++){var c=a[b];if(h.has(c))return c}return"source:unknown"}function i(a){for(var b=0;b<a.length;b++){var d=a[b];d=d.split(c("MessagingTagConstants").app_id_root);if(d.length>1)return d[1].trim()}return null}function b(a,b){var d=[],e=i(a);e&&c("MessagingTagConstants").orca_app_ids.indexOf(e)!==-1&&d.push("source:messenger");c("MessagingTagConstants").chat_sources.indexOf(b)!==-1&&d.push("source:chat");c("MessagingTagConstants").email_source===b&&d.push("source:email");c("MessagingTagConstants").mobile_sources.indexOf(b)!==-1&&d.push("source:mobile");a.indexOf("source:workchat:desktop")!==-1&&d.push("source:workchat:desktop");return d}g.getSourceFromTags=a;g.getSourceTags=b}),98);
__d("P2PPaymentLogMessageSubtype",[],(function(a,b,c,d,e,f){a=Object.freeze({SENT_IN_GROUP:"sent_in_group",CANCELED_SENDER_RISK:"canceled_sender_risk",CANCELED_DECLINED:"canceled_declined",CANCELED_RECIPIENT_RISK:"canceled_recipient_risk",CANCELED_EXPIRED:"canceled_expired",CANCELED_SAME_CARD:"canceled_same_card",CANCELED_CUSTOMER_SERVICE:"canceled_customer_service",CANCELED_CHARGEBACK:"canceled_chargeback",CANCELED_SYSTEM_FAIL:"canceled_system_fail",REQUEST_CANCELED_BY_REQUESTER:"request_canceled_by_requester",REQUEST_DECLINED_BY_REQUESTEE:"request_declined_by_requestee",REQUEST_EXPIRED:"request_expired",REQUEST_REMINDER:"request_reminder",MONEY_RAIN_GAME_ENTRY_POINT:"money_rain_game_entry_point"});f["default"]=a}),66);
__d("StoryAttachmentStyle",[],(function(a,b,c,d,e,f){a=Object.freeze({FALLBACK:"fallback",SHARE:"share",SHARE_MEDIUM:"share_medium",SHARE_SEVERE:"share_severe",SHARE_PORTRAIT:"share_portrait",OG_COMPOSER_SIMPLE:"og_composer_simple",SPORTS_MATCHUP:"sports_matchup",SHARE_LARGE_IMAGE:"share_large_image",PHOTO:"photo",COVER_PHOTO:"cover_photo",INSPIRATION_PHOTO:"inspiration_photo",ALBUM:"album",NEW_ALBUM:"new_album",COUPON:"coupon",QUESTION:"question",ANSWER:"answer",OPTION:"option",GALLERY:"gallery",STREAM_PUBLISH:"stream_publish",MUSIC_AGGREGATION:"music_aggregation",ITEM_LIST:"list",HIGH_SCORE:"high_score",SCORE_LEADERBOARD:"score_leaderboard",FRIEND_LIST:"friend_list",POPULAR_OBJECTS:"popular_objects",AD4AD:"ad4ad",AVATAR_LIST:"avatar_list",AVATAR:"avatar",AVATAR_WITH_VIDEO:"avatar_with_video",EVENT:"event",CANCELED_EVENT:"canceled_event",MINUTIAE_EVENT:"minutiae_event",EXPERIENCE:"experience",LIFE_EVENT:"life_event",GIFT:"gift",IMAGE_SHARE:"image_share",ANIMATED_IMAGE_SHARE:"animated_image_share",ANIMATED_IMAGE_AUTOPLAY:"animated_image_autoplay",ANIMATED_IMAGE_VIDEO:"animated_image_video",ANIMATED_IMAGE_VIDEO_AUTOPLAY:"animated_image_video_autoplay",NOTE:"note",TOPIC:"topic",TOPIC_FOLLOWING_TOPIC:"topic_following_topic",FILE_UPLOAD:"file_upload",FOLDER:"folder",NOTIFICATION_TARGET:"notification_target",UNAVAILABLE:"unavailable",EMPTY:"empty",PAGE_RECOMMENDATION:"page_recommendation",PAGE_VIDEO_PLAYLIST:"page_video_playlist",VIDEO:"video",VIDEO_INLINE:"video_inline",VIDEO_AUTOPLAY:"video_autoplay",VIDEO_SHARE:"video_share",VIDEO_SHARE_HIGHLIGHTED:"video_share_highlighted",VIDEO_SHARE_YOUTUBE:"video_share_youtube",VIDEO_DIRECT_RESPONSE:"video_direct_response",VIDEO_DIRECT_RESPONSE_AUTOPLAY:"video_direct_response_autoplay",VIDEO_SHOP:"video_shop",INSPIRATION_VIDEO:"inspiration_video",MULTI_VIDEOS_STITCHED:"multi_videos_stitched",MAP:"map",OG_MAP:"og_map",PRODUCT:"product",EXTERNAL_PRODUCT:"external_product",FITNESS_COURSE:"fitness_course",APPLICATION:"application",STICKER:"sticker",STICKER_AVATAR:"sticker_avatar",EXTERNAL_OG_PRODUCT:"external_og_product",TRAVEL_LOG:"travel_log",MULTI_SHARE:"multi_share",MULTI_SHARE_NO_END_CARD:"multi_share_no_end_card",MULTI_SHARE_NON_LINK_VIDEO:"multi_share_non_link_video",MULTI_SHARE_SEARCH_END_CARD:"multi_share_search_end_card",MULTI_SHARE_FIXED_TEXT:"multi_share_fixed_text",MULTI_SHARE_CAROUSEL_FREE_SCROLL:"multi_share_carousel_free_scroll",MULTI_SHARE_CAROUSEL_FREE_SCROLL_SNAP_CENTER:"multi_share_carousel_free_scroll_snap_center",MULTI_SHARE_LARGER_CAROUSEL:"multi_share_larger_carousel",MULTI_SHARE_WITH_INSTANT_EXPERIENCE:"multi_share_with_instant_experience",MULTI_SHARE_WITH_PROMO_CARD:"multi_share_with_promo_card",YEAR_IN_REVIEW:"year_in_review",AVATAR_LARGE_COVER:"avatar_large_cover",COMMERCE_PRODUCT_ITEM:"commerce_product_item",COMMERCE_STORE:"commerce_store",THIRD_PARTY_PHOTO:"third_party_photo",PROMPT:"prompt",BIRTHDAY:"birthday",BIRTHDAY_PERCEPTICONS:"birthday_percepticons",DISCUSSION_CONVERSATION:"discussion_conversation",DISCUSSION_COMMENT:"discussion_comment",GROUP_SELL_PRODUCT_ITEM:"group_sell_product_item",GROUP_SELL_PRODUCT_ITEM_MARK_AS_SOLD:"group_sell_mark_as_sold",GAMETIME:"gametime",GAMETIME_LEAGUE:"gametime_league",GAMETIME_PLAY:"gametime_play",GROUP_REPORTED_POST_QUEUE:"group_reported_post_queue",GROUP_PENDING_POST_QUEUE:"group_pending_post_queue",GROUP_JOIN_REQUEST_QUEUE:"group_join_request_queue",GREETING_CARD:"greeting_card",LEAD_GEN:"lead_gen",ATTACHED_STORY:"attached_story",POST_CHANNEL:"post_channel",TEXT_FOR_COLLAGE:"text_for_collage",SOUVENIR:"souvenir",SLIDESHOW:"slideshow",ORION:"orion",ORION_REQUEST:"orion_request",P2P_PAYMENT:"p2p_payment",P2P_SERVER_BUBBLE:"p2p_server_bubble",INSTANT_ARTICLE:"instant_article",MOMENTS_APP_INVITATION:"moments_app_invitation",MOMENTS_APP_PHOTO_REQUEST:"moments_app_photo_request",RIDE_ORDERED:"ride_ordered",RIDE_RECEIPT:"ride_receipt",BUSINESS_MESSAGE_ITEMS:"business_message_items",RETAIL_CANCELLATION:"retail_cancellation",RETAIL_PROMOTION:"retail_promotion",RETAIL_ITEM:"retail_item",RETAIL_NOW_IN_STOCK:"retail_now_in_stock",RETAIL_RECEIPT:"retail_receipt",RETAIL_SHIPMENT:"retail_shipment",RETAIL_SHIPMENT_FOR_SUPPORTED_CARRIER:"retail_shipment_for_supported_carrier",RETAIL_SHIPMENT_FOR_UNSUPPORTED_CARRIER:"retail_shipment_for_unsupported_carrier",RETAIL_SHIPMENT_TRACKING_EVENT:"retail_shipment_tracking_event",RETAIL_SHIPMENT_TRACKING_EVENT_ETA:"retail_shipment_tracking_event_eta",RETAIL_SHIPMENT_TRACKING_EVENT_IN_TRANSIT:"retail_shipment_tracking_event_in_transit",RETAIL_SHIPMENT_TRACKING_EVENT_OUT_FOR_DELIVERY:"retail_shipment_tracking_event_out_for_delivery",RETAIL_SHIPMENT_TRACKING_EVENT_DELAYED:"retail_shipment_tracking_event_delayed",RETAIL_SHIPMENT_TRACKING_EVENT_DELIVERED:"retail_shipment_tracking_event_delivered",SURVEY:"survey",MESSAGE_LOCATION:"message_location",GROUP_ADD_MEMBERS:"group_add_memebers",GROUP_MEMBER_ADDED:"group_member_added",RTC_CALL_LOG:"rtc_call_log",JOINABLE_CALL:"joinable_call",EVENTS_PENDING_POST_QUEUE:"events_pending_post_queue",EVENT_CALENDAR:"event_calendar",FACEPILE:"facepile",ATTRIBUTED_SHARE:"attributed_share",VIDEO_CINEMAGRAPH:"video_cinemagraph",LOCAL_CONTEXT_SHARE:"local_context_share",H_SCROLL:"h_scroll",EGO_HSCROLL:"ego_hscroll",MEDIA_QUESTION:"media_question",RICH_MEDIA:"rich_media",RICH_MEDIA_COLLECTION:"rich_media_collection",SQUARE_IMAGE_SHARE:"square_image_share",RETAIL_AGENT_ITEM_SUGGESTION:"retail_agent_item_suggestion",RETAIL_AGENT_ITEM_RECEIPT:"retail_agent_item_receipt",NOTE_COMPOSED:"note_composed",AVATAR_WITH_BIRTHDAY:"avatar_with_birthday",AIRLINE_FLIGHT_RESCHEDULE_UPDATE_BUBBLE:"airline_flight_reschedule_update_bubble",AIRLINE_CONFIRMATION:"airline_confirmation",AIRLINE_CHECK_IN:"airline_check_in",AIRLINE_BOARDING_PASS:"airline_boarding_pass",AIRLINE_FLIGHT_RESCHEDULE_UPDATE:"airline_flight_reschedule_update",LIGHTBOX_VIDEO:"lightbox_video",GLOBALLY_DELETED_MESSAGE_PLACEHOLDER:"globally_deleted_message_placeholder",GENIE_MESSAGE:"genie_message",MOVIE_BOT_MOVIE_LIST:"movie_bot_movie_list",MOVIE_BOT_MOVIE_SHOWTIME_LIST:"movie_bot_movie_showtime_list",GROUPSMASH_MEDIA:"groupsmash_media",AVATAR_WITH_EGO_ACTION:"avatar_with_ego_action",EVENT_TICKET_DEPRECATED:"event_ticket",VERTICAL_ATTACHMENT_LIST:"vertical_attachment_list",INSTANT_ARTICLE_LEGACY:"instant_article_legacy",FUNDRAISER_PAGE:"fundraiser_page",FINANCIAL_BILL_PAYMENT_REQUEST:"financial_bill_payment_request",GOODWILL_THROWBACK_FRIENDVERSARY_POLAROIDS_CARD:"goodwill_throwback_friendversary_polaroids_card",WELCOME_CARD_IMAGE:"welcome_card_image",LARGE_IMAGE_LIKE:"large_image_like",ASK_FRIENDS:"ask_friends",CULTURAL_MOMENT:"cultural_moment",TELEPHONE_CALL_LOG:"telephone_call_log",SUPER_EMOJI:"super_emoji",BOOK:"book",SUBTOPIC_CUSTOMIZATION_QUESTION:"subtopic_customization_question",SUBTOPIC_CUSTOMIZATION_OPTION:"subtopic_customization_option",RESTAURANT:"restaurant",CONNECTION_QUESTION:"connection_question",CONNECTION_QUESTION_OPTION:"connection_question_option",PYMI_ITEM:"pymi_item",GOODWILL_THROWBACK_FRIENDVERSARY_COLLAGE_CARD:"goodwill_throwback_friendversary_collage_card",CITY:"city",AVATAR_WITH_SHARE:"avatar_with_share",LIGHTWEIGHT_PLACE:"lightweight_place",QUOTED_SHARE:"quoted_share",SMS_LOG:"sms_log",CENTERED_TEXT:"centered_text",GOODWILL_THROWBACK_FRIENDVERSARY_DATA_CARD:"goodwill_throwback_friendversary_data_card",GOODWILL_THROWBACK_FACEVERSARY_COLLAGE_CARD:"goodwill_throwback_faceversary_collage_card",GOODWILL_THROWBACK_ANNIVERSARY_COLLAGE_CARD:"goodwill_throwback_anniversary_collage_card",GOODWILL_THROWBACK_MILESTONE_FRIENDS_MADE_CARD:"goodwill_throwback_milestone_friends_made_card",MESSAGE_EVENT:"message_event",MESSAGE_THREAD:"message_thread",QUOTE:"quote",AIRLINE_ITINERARY:"airline_itinerary",AIRLINE_UPDATE:"airline_update",PLACE_LIST:"place_list",IMPLICIT_PLACE_LIST_CONVERSION:"implicit_place_list_conversion",AIRLINE_CHECKIN_REMINDER:"airline_checkin_reminder",MINUTIAE_UNIT:"minutiae_unit",INSTANT_ARTICLE_PHOTO:"instant_article_photo",INSTANT_ARTICLE_VIDEO:"instant_article_video",PHOTO_LINK_SHARE:"photo_link_share",PHOTO_LINK_SHARE_WITH_INSTAGRAM_CONTEXT:"photo_link_share_with_instagram_context",BUSINESS_LOCATION:"business_location",GOODWILL_WEATHER:"goodwill_weather",CULTURAL_MOMENT_HOLIDAY_CARD:"cultural_moment_holiday_card",GROUP:"group",COMMENT_PLACE_INFO:"comment_place_info",COMMENT_PRODUCT_INFO:"comment_product_info",GOODWILL_THROWBACK_FRIENDVERSARY_POLAROIDS_CARD_IPB:"goodwill_throwback_friendversary_polaroids_card_ipb",GOODWILL_THROWBACK_FRIENDVERSARY_COLLAGE_CARD_IPB:"goodwill_throwback_friendversary_collage_card_ipb",FUNDRAISER_PERSON_TO_CHARITY:"fundraiser_person_to_charity",FUNDRAISER_PERSON_FOR_PERSON:"fundraiser_person_for_person",FUNDRAISER_FOR_STORY:"fundraiser_for_story",FUNDRAISER_PROFILE_FOR_CHARITY:"fundraiser_profile_for_charity",MESSAGE_LIVE_LOCATION:"message_live_location",MESSENGER_INVITE:"messenger_invite",MESSENGER_NATIVE_TEMPLATES:"messenger_native_templates",GAMES_INSTANT_PLAY:"games_instant_play",PROFILE_MEDIA:"profile_media",NATIVE_TEMPLATES:"native_templates",NATIVE_TEMPLATES_FOX:"native_templates_fox",NATIVE_TEMPLATES_KEEP_ATTACHED:"native_templates_keep_attached",GOODWILL_THROWBACK_VIDEO_BASIC:"goodwill_throwback_video_basic",COMMERCE_PRODUCT_MINI:"commerce_product_mini",COMMERCE_PRODUCT_MINI_LIST:"commerce_product_mini_list",COMMENT:"comment",MESSENGER_TEAM_BOT_SHARE:"messenger_team_bot_share",LIVE_VIDEO_SCHEDULE:"live_video_schedule",PRODUCT_ITEM:"product_item",PLATFORM_INSTANT_APP:"platform_instant_app",YEAR_OVERVIEW:"year_overview",NATIVE_COMPONENT_FLOW_BOOKING_REQUEST:"native_component_flow_booking_request",FRIEND_REQUEST:"friend_request",MESSENGER_GROUP_JOINABLE_LINK:"messenger_group_joinable_link",MESSENGER_GROUP_JOINABLE_LINK_V2:"messenger_group_joinable_link_v2",SOCIAL_SEARCH_CONVERSION_PROMPT:"social_search_conversion_prompt",MDOTME_USER_LINK:"mdotme_user_link",DYNAMIC_MULTI_SHARE_ITEMS:"dynamic_multi_share_items",EVENT_REMINDER:"event_reminder",INSTANT_GAMES_SHARE_MESSAGE:"instant_games_share_message",INSTANT_GAMES_LEADERBOARD_UPDATE:"instant_games_leaderboard_update",INSTANT_GAMES_CUSTOM_UPDATE:"instant_games_custom_update",MESSENGER_PLATFORM_COMPACT_ITEM:"messenger_platform_compact_item",MESSENGER_PLATFORM_COVER_ITEM:"messenger_platform_cover_item",MULTI_SHARE_NON_LINK_VIDEO_AUTO_SCROLL:"multi_share_non_link_video_auto_scroll",OFFER_VIEW_LIVE_COUNTDOWN:"offer_view_live_countdown",ENHANCED_LINK_REDDIT_POST:"enhanced_link_reddit_post",MESSENGER_COMMERCE_COVER_ITEM:"messenger_commerce_cover_item",ENHANCED_LINK_YELP_BUSINESS:"enhanced_link_yelp_business",PAGES_PLATFORM_LEAD_GEN:"pages_platform_lead_gen",NATIVE_STORY:"native_story",MFS_BILL_PAY_CREATION_UPDATE:"mfs_bill_pay_creation_update",MFS_BILL_PAY_REFERENCE_CODE_UPDATE:"mfs_bill_pay_reference_code_update",MFS_BILL_PAY_AGENT_CASH_IN_UPDATE:"mfs_bill_pay_agent_cash_in_update",PAGES_PLATFORM_BOOKING_MESSAGE:"pages_platform_booking_message",EXTERNAL_GALLERY:"external_gallery",MEME_SHARE:"meme_share",MESSENGER_PLATFORM_ELEMENT:"messenger_platform_element",INSTANT_GAMES_SHARE_SCORE_MESSAGE:"instant_games_share_score_message",MESSENGER_PLATFORM_BUTTON_LIST:"messenger_platform_button_list",LIGHTWEIGHT_ACTION:"lightweight_action",TAROT_DIGEST:"tarot_digest",EVENT_TOUR:"event_tour",ADAPTIVE_MEDIA:"adaptive_media",DYNAMIC_GAME_BOARD:"dynamic_game_board",PAYMENT_PLATFORM:"payment_platform",OMNI_M_FLOW:"omni_m_flow",GROUP_QUIZ:"group_quiz",TRIAL_AD:"trial_ad",TEEM_COLLECTIONS:"teem_collections",CRISIS_DONATION:"crisis_donation",CRISIS_STATUS:"crisis_status",CRISIS_SHARE:"crisis_share",CRISIS_MARK_SAFE:"crisis_mark_safe",CRISIS_LISTING:"crisis_listing",CORONAVIRUS_HUB:"coronavirus_hub",CORONAVIRUS_FACTS:"coronavirus_facts",RACIAL_JUSTICE_HUB:"racial_justice_hub",FBPAY_OFFER:"fbpay_offer",APPLICATION_SHARE_REFERRAL:"application_share_referral",VR_CONTENT:"vr_content",VIDEO_RECOMMENDATION_HSCROLL:"video_recommendation_hscroll",VIDEO_TRAILER:"video_trailer",SHOW_PAGE_SHARE:"show_page_share",MFS_ATTACHMENT:"mfs_attachment",MFS_TIME_SENSITIVE_ATTACHMENT:"mfs_time_sensitive_attachment",VIDEO_RECOMMENDATION_SINGLETON:"video_recommendation_singleton",PAGE_REVIEW_PROMPT:"page_review_prompt",VIDEO_SHOW:"video_show",UNCONNECTED_VIDEO:"unconnected_video",SHOW_SHARE:"show_share",JOB_SEARCH_JOB_APPLICATION:"job_search_job_application",PAGE_MESSENGER_ATTACHMENT:"page_messenger_attachment",CONTACT_YOUR_REP:"contact_your_rep",LOCATION_EXTENSION:"location_extension",SERVICES_CONSUMER_HUB:"services_consumer_hub",PLACE_RECOMMENDATION:"place_recommendation",JOB_SEARCH_JOB_OPENING:"job_search_job_opening",PAGE_MESSAGE_ONLINE_INDICATOR:"page_message_online_indicator",LOCAL_PIVOT:"local_pivot",ORION_REQUEST_NEW:"orion_request_new",PHOTO_WITH_SHIELD:"photo_with_shield",PLAYABLE_AD:"playable_ad",FUN_FACT_PROMPT:"fun_fact_prompt",FUN_FACT_STACK:"fun_fact_stack",FATIGUED_SHARE:"fatigued_share",DISCUSSION_QUESTION:"discussion_question",PARTIES_INVITE:"parties_invite",PROFILE_INTRO_CARD_BIO:"profile_intro_card_bio",PAGES_SHARE:"pages_share",PRODUCT_RECOMMENDATION_LIST:"product_recommendation_list",VISUAL_POLL:"visual_poll",MULTI_PLACE_RECOMMENDATION:"multi_place_recommendation",PAGE_IN_COMMENT:"page_in_comment",PAGE_ANNOUNCEMENT:"page_announcement",MESSENGER_PLATFORM_MEDIA_ATTACHMENT:"messenger_platform_media_attachment",SCHEDULED_VIDEO_ANNOUNCEMENT:"scheduled_video_announcement",HSCROLL_ITEM:"hscroll_item",MESSENGER_CALL_LOG:"messenger_call_log",PAGE_REVIEW_UPDATE:"page_review_update",LOYALTY_CARD_OFFER:"loyalty_card_offer",GOODWILL_GRID:"goodwill_grid",TRAVEL_PLAN:"travel_plan",FIND_PLAYERS:"find_players",ASSET3D:"asset3d",MESSENGER_GROUP_PERSONAL_LINK:"messenger_group_personal_link",FREQUENTLY_ASKED_QUESTION:"frequently_asked_question",STORY_LIST:"story_list",GOODWILL_SHARED_CARD:"goodwill_shared_card",PAYMENT_BUBBLE_VIEW:"PAYMENT_BUBBLE_VIEW",POST_TO_EVENT_CREATE:"post_to_event_create",MONTAGE_DIRECT:"montage_direct",NEO_INVITATION:"NEO_INVITATION",NATIVE_TEMPLATES_LINK_SHARE_TEST:"native_templates_link_share_test",GOODWILL_HSCROLL:"goodwill_hscroll",NEO_KID_INITIATE_FRIENDING:"NEO_KID_INITIATE_FRIENDING",NEO_VIDEO_PROMPT:"NEO_VIDEO_PROMPT",EVENT_MICRO_ATTACHMENT:"event_micro_attachment",SAVED_LIST:"saved_list",LOCAL_GUIDE:"local_guide",MEET_UP_EVENT:"meet_up_event",DONATION:"donation",FUNDRAISER_FB_SEEDING_GIFT:"fundraiser_fb_seeding_gift",BREAKING_NEWS:"breaking_news",GOODWILL_COLLAGE:"goodwill_collage",LEAD_FORM:"lead_form",LEAD_FORM_USER_INFO:"lead_form_user_info",EVENT_TICKET_ORDER:"event_ticket_order",PROFILE_CHANNEL:"profile_channel",ICE_BREAKER:"ICE_BREAKER",MOVIE:"movie",ALOHA_CALL:"aloha_call",TIP_JAR_PAYMENT:"tip_jar_payment",SUBSCRIPTION_GIFT:"subscription_gift",COMMENT_MESSAGE_INFO:"comment_message_info",CASH_ON_DELIVERY_ORDER:"cash_on_delivery_order",CENSUS:"census",VOTE_BY_MAIL:"vote_by_mail",VOTER_REGISTRATION_DRIVE:"voter_registration_drive",VOTING_INFO:"voting_info",ELECTION_DAY_REMINDER:"election_day_reminder",ELECTION_INFO:"election_info",LIVING_ROOM:"living_room",ACHIEVEMENT_POST:"achievement_post",M_BIRTHDAY_REMINDER:"m_birthday_reminder",INSIGHTS_CHART:"insights_chart",GROUP_PROACTIVE_FLAGGED_POST_QUEUE:"group_proactive_flagged_post_queue",GROUP_ACCEPT_RULE_TO_UNMUTE:"group_accept_rule_to_unmute",SHOW_CLICK_TO_WATCH_TAB:"show_click_to_watch_tab",SHOW_CLICK_TO_WATCH_TAB_V2:"show_click_to_watch_tab_v2",SHOW_CLICK_TO_WATCH_TAB_V3:"show_click_to_watch_tab_v3",SHOW_CLICK_TO_WATCH_TAB_V4:"show_click_to_watch_tab_v4",SHOW_MASKED:"show_masked",SHOW_CONTINUE_WATCHING:"show_continue_watching",WATCH_CLICK_STORY_HEADER_TO_WATCH_TAB:"watch_click_story_header_to_watch_tab",FOX_ALBUM:"fox_album",TOOL_SHARE:"tool_share",PHONE_REMOVED_ACTION_LIST:"phone_removed_action_list",AMP:"amp",LDP_APP_INSTANCE:"ldp_app_instance",PAGE_RECOMMENDATION_V2:"page_recommendation_v2",PLAY_WITH_FRIENDS:"play_with_friends",BLOOD_REQUEST:"blood_request",BLOOD_DONATION_PARTNER_CTA:"blood_donation_partner_cta",HIGH_SCHOOL_COMMUNITY_INVITE:"high_school_community_invite",SCHEDULED_LIVE_VIDEO:"scheduled_live_video",GAMESHOW:"gameshow",GAMESHOW_INVITE:"gameshow_invite",MK_FRIEND_REQUEST:"mk_friend_request",GOODWILL_PHOTO_CIRCLE:"goodwill_photo_circle",SERVICES_APPOINTMENT_AVAILABILITY:"services_appointment_availability",NEO_SOCIAL_INVITATION:"neo_social_invitation",NEO_KID_INVITATION:"neo_kid_invitation",GROUP_SELL_PRODUCT_ITEM_CONDENSED:"group_sell_product_item_condensed",GROUP_SELL_PRODUCT_ITEM_MARK_AS_PENDING:"group_sell_product_item_mark_as_pending",GAMES_VIDEO:"games_video",MOVIE_WITH_SHOWTIMES:"movie_with_showtimes",WORK_CONTENT_ATTACHMENT:"work_content_attachment",GROUP_SAFETY_HUB:"group_safety_hub",NEWS_STORYLINE:"news_storyline",EVENT_TICKET_REQUEST:"event_ticket_request",GROUP_APPLICATION:"group_application",MESSAGE_MULTIPLE_LOCATIONS:"message_multiple_locations",TODO_LIST:"todo_list",PERSONAL_REMINDER:"personal_reminder",ARTICLE_MESSAGE:"article_message",PERSONAL_REMINDER_LIST:"personal_reminder_list",GAMES_APP:"games_app",GAMES_APP_SHARED:"games_app_shared",MOBILE_GAME_SHARE:"mobile_game_share",MONTAGE_MEDIA_EFFECT:"montage_media_effect",GROUPS_VOTER_REGISTRATION_DRIVE:"groups_voter_registration_drive",MONTAGE_SHARE:"montage_share",WEC_MESSAGE:"wec_message",INSTAGRAM_DIRECT_MESSAGE_ATTACHMENT:"instagram_direct_message_attachment",GROUP_APPLICATION_CTA:"group_application_cta",MENTORSHIP_CURRICULUM_STEP:"mentorship_curriculum_step",SCHEDULED_LIVING_ROOM:"scheduled_living_room",STORY_ADS_SURVEY:"story_ads_survey",MESSENGER_FORM_PROGRESS_ATTACHMENT:"messenger_form_progress_attachment",VIDEO_COMMERCE_INTEREST:"video_commerce_interest",PAGES_COMMERCE_BUYER_INTENT:"pages_commerce_buyer_intent",BREAKING_NEWS_STORY_GALLERY:"breaking_news_story_gallery",BRANDING_PLAYABLE_AD:"branding_playable_ad",PAGE_SURFACE_MENU_ITEM:"page_surface_menu_item",VIDEO_LIVING_ROOM_MESSENGER:"video_living_room_messenger",IMAGE_SHARE_NO_OVERLAY:"image_share_no_overlay",JOIN_GROUP_CTA:"join_group_cta",ASSISTANT_DRAFT_MESSAGE:"assistant_draft_message",ASSISTANT_CONTACT_INFO:"assistant_contact_info",NEO_DRAW_AND_GUESS_GAME_REQUEST:"neo_draw_and_guess_game_request",SOCIAL_LEARNING_UNIT_CREATED:"social_learning_unit_created",SOCIAL_LEARNING_UNIT_COMPLETED:"social_learning_unit_completed",GOODWILL_THROWBACK_SINGLE_PHOTO:"goodwill_throwback_single_photo",FAN_FUNDING_SUPPORT_CREATOR_CTA:"fan_funding_support_creator_cta",WOODHENGE_MEMBERSHIP_CARD:"woodhenge_membership_card",USER_PAY_REFERRALS_WWW:"user_pay_referrals_www",GOODWILL_VIDEO_SHARED_VIDEO:"goodwill_video_shared_video",INSTANT_GAMES_TOURNAMENT:"instant_games_tournament",INSTANT_GAMES_TOURNAMENT_ACTIVITY:"instant_games_tournament_activity",INSTANT_GAMES_UPDATE_COMMENT:"instant_games_update_comment",SCHEDULED_LIVE_VIDEO_POST:"scheduled_live_video_post",CHAT_COMMAND_RESULT:"chat_command_result",CROSSROADS:"crossroads",MOBILE_GAME_THREAD_SHARE:"mobile_game_thread_share",SHOW_CLICK_TO_WATCH_TOPIC:"show_click_to_watch_topic",LIFE_EVENT_FB_STORY:"life_event_fb_story",GROUP_KEYWORD_ALERTED_QUEUE:"group_keyword_alerted_queue",GROUP_ADMIN_AUTONOMY_REVIEW_QUEUE:"group_admin_autonomy_review_queue",PARENT_APPROVED_PLAIN_TEXT_BOT_MESSAGE:"parent_approved_plain_text_bot_message",LIVE_VIDEO_REHEARSAL:"live_video_rehearsal",ASSISTANT_CONTACT_INFO_LIST:"assistant_contact_info_list",PARENT_APPROVED_IMAGE_AND_TEXT_BOT_MESSAGE:"parent_approved_image_and_text_bot_message",LIVE_VIDEO_SCHEDULED_REHEARSAL:"live_video_scheduled_rehearsal",LIVE_VIDEO_SCHEDULED_POST_REHEARSAL:"live_video_scheduled_post_rehearsal",GROUPS_LINKED_GROUP_FEED_HSCROLL:"groups_linked_group_feed_hscroll",SCHEDULED_LIVING_ROOM_POST:"scheduled_living_room_post",EVENT_ATTENDANCE_CONFIRMATION:"event_attendance_confirmation",ATTACHMENT_FOOTER_SIMPLE_HEADLINE:"attachment_footer_simple_headline",ATTACHMENT_FOOTER_CTA:"attachment_footer_cta",ATTACHMENT_FOOTER_ACCENT_COLOR:"attachment_footer_accent_color",CLICK_TO_WATCH_TAB_WARION_V1:"click_to_watch_tab_warion_v1",COMMERCE_UPSELL_MESSAGE:"commerce_upsell_message",PROFILE_SONG:"profile_song",MENTORSHIP_DISCUSSION_TOPIC_SET:"mentorship_discussion_topic_set",LINK_SOCIAL_CONTEXT:"link_social_context",POLITICAL_CANDIDATE_VIDEO:"political_candidate_video",TWEENS_WOULD_YOU_RATHER:"tweens_would_you_rather",TWEENS_INTEREST_CONTENT:"tweens_interest_content",SERVICES_GENERIC_ADMIN_TEXT:"services_generic_admin_text",MENTORSHIP_H_SCROLL:"mentorship_h_scroll",CRS_FEED_LINK_LARGE:"crs_feed_link_large",CRS_FEED_LINK_SMALL:"crs_feed_link_small",CRS_FEED_PHOTO_SMALL:"crs_feed_photo_small",CRS_FEED_PHOTO_LARGE:"crs_feed_photo_large",ANONYMOUS_AUTHOR_INFO:"anonymous_author_info",MENTORSHIP_XMA:"mentorship_xma",GEMSTONE_CENTERED_CONTENT:"gemstone",SHOW_EPISODE:"show_episode",PLAYLIST_VIDEO:"playlist_video",RECRUITING_CANDIDATE:"recruiting_candidate",RECRUITING_RESUME_REVIEW:"recruiting_resume_review",RECRUITING_GROUP_CONSIDERATION_SHARE:"recruiting_group_consideration_share",RECRUITING_GROUP_CANDIDATE_SHARE:"recruiting_group_candidate_share",INTERVIEW_MARKETPLACE_LISTING:"interview_marketplace_listing",VIDEO_LIST:"video_list",GROUPS_BUY_SELL_TAB_SALE_ITEM:"groups_buy_sell_tab_sale_item",ALBUM_SALE_ITEM:"album_sale_item",PHOTO_SALE_ITEM:"photo_sale_item",MARKETPLACE_GENERIC_ADMIN_TEXT:"marketplace_generic_admin_text",PARENT_APPROVED_USER_SCHOOL_REQUEST:"parent_approved_user_school_request",PARENT_APPROVED_REMIX_PHOTO_REQUEST:"PARENT_APPROVED_REMIX_PHOTO_REQUEST",ANONYMOUS_POST_CONTENT:"anonymous_post_content",TWEENS_TOPIC_STORY:"tweens_topic_story",NEO_KID_PARENT_INVITATION:"neo_kid_parent_invitation",GAMING_VIDEO_CHAT_ATTACHMENT:"gaming_video_chat_attachment",GAMING_VIDEO_CLIP_ATTACHMENT:"gaming_video_clip_attachment",MARKETPLACE_RATE_SELLER_REQUEST:"marketplace_rate_seller_request",MARKETPLACE_QUICK_RESPONSE:"marketplace_quick_response",GROUP_INVITE_NONMEMBER_MENTIONED:"group_invite_nonmember_mentioned",AR_AD:"ar_ad",INSTANT_GAMES_INTERACTIVE_POLL:"instant_games_interactive_poll",CHATROOM:"chatroom",MARKETPLACE_ECOMM_PRODUCT_ITEM:"marketplace_ecomm_product_item",VOLUNTEERING_SUPPORT_RELATIONSHIP:"volunteering_support_relationship",MARKETPLACE_OFFER:"marketplace_offer",VIDEO_HOME_ELIGIBLE_VIDEO_ENDSCREEN:"video_home_eligible_video_endscreen",COMMERCE_ATTACHMENT:"commerce_attachment",GOODWILL_PRODUCT_SYSTEM_CAMPAIGN:"goodwill_product_system_campaign",WORK_SHIFT_SWAP:"work_shift_swap",FLIPPER_TRACE:"flipper_trace",MARKETPLACE_BOT_ORDER_DETAILS:"marketplace_bot_order_details",NEO_ASYNC_GAME_REQUEST:"neo_async_game_request",GROUP_PENDING_ANONYMOUS_POST_DISCLAIMER:"group_pending_anonymous_post_disclaimer",AVATAR_FEATURE:"avatar_feature",FIRST_PARTY_MUSIC:"first_party_music",MUSIC_CLIP:"music_clip",STORY_CARD_PHOTO:"story_card_photo",STORY_CARD_VIDEO:"story_card_video",CRICKET_VIDEO:"cricket_video",C4G_THREAD_CREATION:"c4g_thread_creation",QUARANTINED_VIDEO:"quarantined_video",WORK_MAJOR_EVENT:"work_major_event",WORK_CHECKLIST:"work_checklist",MESSENGER_GENERIC_TEMPLATE:"messenger_generic_template",IG_ANIMATED_IMAGE_AUTOPLAY:"ig_animated_image_autoplay",VIDEO_MEETUP:"video_meetup",CRISIS_HUB:"crisis_hub",COLLABORATIVE_DOCUMENT:"collaborative_document",AMA_POST:"ama_post",ROOMS_SPEAKEASY_XMA:"rooms_speakeasy_xma",COLLAB_MEDIA:"collab_media",MARKETPLACE_TXN_QUESTION:"marketplace_txn_question",KNOWLEDGE_NOTE:"knowledge_note",KNOWLEDGE_COLLECTION:"knowledge_collection",GIFT_CARD:"gift_card",VIDEO_MEETUP_LINK:"video_meetup_link",COMMUNITY_PROMPT:"community_prompt",COMMUNITY_PROMPT_FOOTER:"community_prompt_footer",MARKETPLACE_GENERIC_XMA:"marketplace_generic_xma",TOURNAMENT_MATCH_SET:"tournament_match_set",FB_SHORTS:"fb_shorts",FB_SHORTS_CREATION:"fb_shorts_creation",C4G_MESSAGE:"c4g_message",COMMUNITY_QUESTIONS:"community_questions",MILAN_WORKOUT:"milan_workout",IN_THREAD_MULTIPHOTO_CAROUSEL:"in_thread_multiphoto_carousel",SHOP_PRODUCT_ITEM:"shop_product_item",NEO_SHORT_FORM_VIDEO:"neo_short_form_video",WORK_JOINABLE_CALL_INVITE:"work_joinable_call_invite",WORK_MEETING:"work_meeting",PROFILE_COMMERCE_POST:"profile_commerce_post",GAMING_COPLAY_SHARE_LINK:"gaming_coplay_share_link",ROOMS_SPEAKEASY_TOMBSTONE_XMA:"rooms_speakeasy_tombstone_xma",COMMUNITY_QA:"community_qa",FUNDRAISER_PERSON_TO_CHARITY_VIDEO:"fundraiser_person_to_charity_video",WORKPLACE_APPROVALS:"workplace_approvals",GROUP_VOTER_PLEDGE_DRIVE:"group_voter_pledge_drive",SHOP_ORDER_UPDATES:"shop_order_updates",SHOP_ORDER_UPDATES_COLLAPSED:"shop_order_updates_collapsed",PREVENTIVE_HEALTH_FLU_SHOT_PLEDGE:"preventive_health_flu_shot_pledge",PREVENTIVE_HEALTH_COVID_VACCINE_FINDER:"preventive_health_covid_vaccine_finder",PREVENTIVE_HEALTH_COVID_VACCINE_FINDER_PROVIDER:"preventive_health_covid_vaccine_finder_provider",PRAYER:"neon",GAMES_SERVICE_PLAYER_INVITE_MESSAGE:"games_service_player_invite_message",REPORTED_GROUP_EVENT:"reported_group_event",WORK_MEETING_TRANSCRIPT:"work_meeting_transcript",INTERACTIVE_MEDIA:"interactive_media",SHOP_STOREFRONT:"shop_storefront",MESSENGER_KIDS_IMAGE_CARD_SHARE:"messenger_kids_image_card_share",CROWDSOURCING_BADGE:"crowdsourcing_badge",RECRUITING_CONTRIBUTIONS_LEADERBOARD:"recruiting_contributions_leaderboard",GRATITUDE:"gratitude",LOOKING_FOR_PLAYERS:"looking_for_players",VOLUNTEERING_EVENT:"volunteering_event",VOLUNTEERING_EVENT_ACTIVITY_SHIFT:"volunteering_event_activity_shift",MARKETPLACE_MEETING_PLAN:"marketplace_meeting_plan",QA_APPROVED_ANSWER:"qa_approved_answer",FACTS_IN_COMMENTS:"facts_in_comments",COMMUNITY_PRODUCT_RECOMMENDATION_IN_COMMENTS:"community_product_recommendation_in_comments",MIB_GENERIC_XMA:"mib_generic_xma",COMMUNITY_PRODUCT_RECOMMENDATIONS_IN_POST:"community_product_recommendations_in_post",GROUP_WELCOME_POST:"group_welcome_post",FB_NOTE:"fb_note",AVATAR_WITH_BLURRED_BACKGROUND:"avatar_with_blurred_background",ANSWER_CARD_STACK:"answer_card_stack",SOUNDBITE:"soundbite",FISHBOWL:"fishbowl",DISCUSSION_POST_ATTACHMENT:"discussion_post_attachment",SHOP_STOREFRONT_XMA:"shop_storefront_xma",SHARE_HUB_UNITS:"share_hub_units",FANTASY_GAMES_GAME:"fantasy_games_game",MEDIA_POLL:"media_poll",FANTASY_GAMES_QUESTION:"fantasy_games_question",GRATITUDE_MOG:"gratitude_mog",GROUP_REFERRAL:"group_referral",PAID_CONTENT:"paid_content",FB_SHORTS_IFR_SINGLE_VIDEO:"fb_shorts_ifr_single_video"});f["default"]=a}),66);
__d("MessengerMessageTransformer.bs",["CurrentUser","FBIDCheck","InstantGameUpdateXMATUpdateType","MNCommerceMessageType","MercuryActionType","MercuryIDs","MercuryLogMessageType","MercurySourceType","MessageProfileRangeType","MessageUnsendabilityStatus.bs","MessagingGenericAdminTextType","MessagingTagUtils","MessengerAttachmentTransformer.bs","P2PPaymentLogMessageSubtype","StoryAttachmentStyle","bs_caml_format","bs_caml_option","bs_js_dict","bs_js_null_undefined","getByPath"],(function(a,b,c,d,e,f){"use strict";function g(a){a=a.blob_attachments;var b=[];a==null||a.forEach(function(a){if(a.__typename==="MessageImage"){b.push({TAG:0,_0:{attribution_app:a.attribution_app,attribution_metadata:a.attribution_metadata,blurred_image_uri:a.blurred_image_uri,filename:a.filename,id:a.id,preview:a.preview,large_preview:a.large_preview,thumbnail:a.thumbnail,legacy_attachment_id:a.legacy_attachment_id,original_dimensions:a.original_dimensions,original_extension:a.original_extension,render_as_sticker:a.render_as_sticker,photo_encodings:a.photo_encodings}});return}else if(a.__typename==="MessageAnimatedImage"){b.push({TAG:1,_0:{attribution_app:a.attribution_app,attribution_metadata:a.attribution_metadata,filename:a.filename,animated_image:a.animated_image,legacy_attachment_id:a.legacy_attachment_id,preview_image:a.preview_image,original_dimensions:a.original_dimensions,title:a.animated_image_caption}});return}else if(a.__typename==="MessageAudio"){b.push({TAG:2,_0:{attribution_app:a.attribution_app,attribution_metadata:a.attribution_metadata,filename:a.filename,playable_url:a.playable_url,playable_duration_in_ms:a.playable_duration_in_ms,is_voicemail:a.is_voicemail,audio_type:a.audio_type,url_shimhash:a.url_shimhash,url_skipshim:a.url_skipshim}});return}else if(a.__typename==="MessageVideo"){b.push({TAG:3,_0:{attribution_app:a.attribution_app,attribution_metadata:a.attribution_metadata,filename:a.filename,playable_url:a.playable_url,playable_duration_in_ms:a.playable_duration_in_ms,legacy_attachment_id:a.legacy_attachment_id,chat_image:a.chat_image,video_type:a.video_type,original_dimensions:a.original_dimensions,large_image:a.large_image,inbox_image:a.inbox_image}});return}else if(a.__typename==="MessageFile"){b.push({TAG:4,_0:{attribution_app:a.attribution_app,attribution_metadata:a.attribution_metadata,filename:a.filename,url:a.url,mimetype:a.mimetype,content_type:a.content_type,is_malicious:a.is_malicious,message_file_fbid:a.message_file_fbid,url_shimhash:a.url_shimhash,url_skipshim:a.url_skipshim,preview_url:a.preview_url,preview:a.preview}});return}else return});return b}function h(a,c,d){var e=c.call_capture_attachments;if(e==null)return[];else return b("MessengerAttachmentTransformer.bs").transformAttachment(a,{extensible_attachment:null,blob_attachments:g({blob_attachments:e.edges.map(function(a){return a.node})}),sticker:null},c.message_id,d)}function i(a,c,d,e,f){if(c.__typename==="GroupPollExtensibleMessageAdminText"){var g=c.question,i;if(g==null)i=[{},null];else{var j=Object.assign({},g);Object.assign(j,{total_count:c.total_count,options:g.options.nodes.map(function(a){var b=Object.assign({},a);return Object.assign(b,{total_count:a.voters.nodes.length,voters:a.voters.nodes.map(function(a){return a.id})})})});i=[j,g.id]}j={message_type:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessagingGenericAdminTextType"),d)),untypedData:{event_type:c.event_type.toLowerCase(),question_id:i[1],question_json:b("bs_js_null_undefined").fromOption(JSON.stringify(i[0]))}}}else if(c.__typename==="InstantGameUpdateExtensibleMessageAdminText"){j={message_type:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessagingGenericAdminTextType"),d)),untypedData:{game_id:(g=b("getByPath"))(c,["game","id"]),update_type:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("InstantGameUpdateXMATUpdateType"),c.update_type)),collapsed_text:c.collapsed_text,expanded_text:c.expanded_text,leaderboard_json:c.leaderboard_json,cta_url:g(c,["instant_game_update_data","cta_url"]),cta_title:g(c,["instant_game_update_data","cta_title"]),custom_image_url:g(c,["instant_game_update_data","photo","image","uri"]),template:g(c,["instant_game_update_data","template"])}}}else if(c.__typename==="MessengerAdContextAdminText")j={message_type:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessagingGenericAdminTextType"),d)),untypedData:{ad_url:c.ad_url}};else if(c.__typename==="AdExtensibleMessageAdminText")j={message_type:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessagingGenericAdminTextType"),d)),untypedData:{ad_client_token:c.ad_client_token,ad_id:c.ad_id,ad_preferences_link:c.ad_preferences_link,ad_properties:c.ad_properties}};else if(c.__typename==="MessengerCallLogExtensibleMessageAdminText")j={message_type:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessagingGenericAdminTextType"),d)),untypedData:Object.assign(Object.assign({},c),{call_capture_attachments:h(a,c,f)})};else if(c.__typename==="ThemeColorExtensibleMessageAdminText"||c.__typename==="ThreadIconExtensibleMessageAdminText"||c.__typename==="ThreadNicknameExtensibleMessageAdminText"||c.__typename==="AcceptPendingThreadExtensibleMessageAdminText"||c.__typename==="AddContactExtensibleMessageAdminText"||c.__typename==="RtcCallLogExtensibleMessageAdminText"||c.__typename==="GameScoreExtensibleMessageAdminText"||c.__typename==="ConfirmFriendRequestExtensibleMessageAdminText"||c.__typename==="MessengerGrowthGenericExtensibleMessageAdminText"||c.__typename==="PartiesInviteExtensibleMessageAdminText"||c.__typename==="AppointmentReminderExtensibleMessageAdminText"||c.__typename==="LinkCTAExtensibleMessageAdminText"||c.__typename==="MessengerLiveChatPluginURLUpdateAdminText"||c.__typename==="MessengerLiveChatPluginFBUserStartChatAdminText"||c.__typename==="MessengerLiveChatPluginGuestUserStartChatAdminText"||c.__typename==="GraphQLServicesAppointmentsOptOutExtensibleMessageAdminText"||c.__typename==="ServicesLeadGenSurveyExtensibleMessageAdminText"||c.__typename==="ServicesLeadGenSurveyEditExtensibleMessageAdminText"||c.__typename==="MessengerIcebreakerVoteCastExtensibleMessageAdminText"||c.__typename==="PagesMarkAsPaidExtensibleMessageAdminText"||c.__typename==="PagesMarkAsPaidNewExtensibleMessageAdminText"||c.__typename==="WorkBotInstalledExtensibleMessageAdminText"||c.__typename==="WorkChatReminderLinkCTAExtensibleMessageAdminText"||c.__typename==="PageThreadActionSystemAddDetailsXMAT"||c.__typename==="MagicWordsExtensibleMessageAdminText"||c.__typename==="NotificationMessagesAdminText"||c.__typename==="PostSharedFromGroupExtensibleMessageAdminText")j={message_type:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessagingGenericAdminTextType"),d)),untypedData:Object.assign({},c)};else if(c.__typename==="LightweightEventCreateExtensibleMessageAdminText"||c.__typename==="LightweightEventDeleteExtensibleMessageAdminText"||c.__typename==="LightweightEventNotifyBeforeEventExtensibleMessageAdminText"||c.__typename==="LightweightEventNotifyExtensibleMessageAdminText"||c.__typename==="LightweightEventUpdateExtensibleMessageAdminText"||c.__typename==="LightweightEventUpdateLocationExtensibleMessageAdminText"||c.__typename==="LightweightEventUpdateTimeExtensibleMessageAdminText"||c.__typename==="LightweightEventUpdateTitleExtensibleMessageAdminText"||c.__typename==="LightweightEventRSVPExtensibleMessageAdminText"){i=c.event_reminder;if(i==null)g=void 0;else{a=i.lightweight_event_creator;f=a==null?void 0:a.id;a=i.location_page;a=a==null?void 0:a.id;var k=i.timezone_id;k=k==null?void 0:k.timezone;var l=i.location_coordinates;l=l==null?{latitude:void 0,longitude:void 0}:l;var m=i.event_reminder_members;m=m==null?void 0:m.edges;g={event_creator_id:f,event_id:i.id,event_location_id:a,event_location_name:i.location_name,event_seconds_to_notify_before:i.seconds_to_notify_before,event_time:i.time,event_end_time:i.end_time,event_timezone:k,event_title:i.event_title,event_type:i.lightweight_event_type,event_track_rsvp:i.allows_rsvp,latitude:l.latitude,longitude:l.longitude,guest_state_list:m,guest_id:c.guest_id,guest_status:c.guest_status}}j={message_type:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessagingGenericAdminTextType"),d)),untypedData:g}}else j=c.__typename==="AdReplyMessageAdminText"?{message_type:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessagingGenericAdminTextType"),d)),untypedData:{ad_url:c.ad_url,should_show_url:c.should_show_url}}:{message_type:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessagingGenericAdminTextType"),d)),untypedData:void 0};return{log_message_body:e,log_message_data:j,log_message_type:b("MercuryLogMessageType").GENERIC_ADMIN_TEXT}}function j(a){return a.map(function(a){if(a==="p2p_transfer")return b("StoryAttachmentStyle").ORION;else if(a==="p2p_payment_request")return b("StoryAttachmentStyle").ORION_REQUEST;else return a})}function k(a){var b=a.target,c;if(b==null)c=null;else if(b.__typename==="CrisisListing")c={TAG:0,_0:{listing_type:b.listing_type,listing_category:b.listing_category,map_image:b.map_image}};else if(b.__typename==="MoneyTransfer")c={TAG:1,_0:{sender:b.sender,receiver:b.receiver,transfer_id:b.transfer_id,bubble_view:b.bubble_view}};else if(b.__typename==="PeerToPeerTransfer")c={TAG:2,_0:{sender:b.sender,receiver_profile:b.receiver_profile,transaction_amount:b.transaction_amount,transfer_status:b.transfer_status,transfer_id:b.transfer_id,completedTime:b.completedTime,updatedTime:b.updatedTime,creationTime:b.creationTime,transfer_context:b.transfer_context,amount_fb_discount:b.amount_fb_discount,funds_availability:b.funds_availability,group_thread_fbid:b.group_thread_fbid,platform_item:b.platform_item,id:b.id,status_description:b.status_description,bubble_view:b.bubble_view,currency_amount:b.currency_amount,memo_text:b.memo_text}};else if(b.__typename==="PeerToPeerPaymentRequest")c={TAG:3,_0:{amount:b.amount,transaction_amount:b.transaction_amount,requester:b.requester,requestee:b.requestee,request_status:b.request_status,request_theme:b.request_theme,id:b.id,memo_text:b.memo_text,transfer:b.transfer,creation_time:b.creation_time,group_thread_fbid:b.group_thread_fbid,updated_time:b.updated_time,status_description:b.status_description,bubble_view:b.bubble_view,individual_requests:b.individual_requests}};else if(b.__typename==="PaymentPlatformAttachment")c={TAG:4,_0:{payment_modules_client:b.payment_modules_client,is_viewer_seller:b.is_viewer_seller,payment_snippet:b.payment_snippet,item_list:b.item_list,components:b.components,payment_call_to_actions:b.payment_call_to_actions,click_action:b.click_action,summary_action:b.summary_action,invoicer_id:b.invoicer_id,is_last_attachment:b.is_last_attachment,payment_total:b.payment_total,product_detail:b.product_detail,payment_status_icon:b.payment_status_icon,user_facing_payment_status:b.user_facing_payment_status,payment_sub_statuses:b.payment_sub_statuses,should_show_new_xma:b.should_show_new_xma,buyer_name:b.buyer_name}};else if(b.__typename==="MessengerRetailPromotion")c={TAG:5,_0:{message:b.message,call_to_actions:b.call_to_actions,promotion_items:b.promotion_items}};else if(b.__typename==="MessengerBusinessMessage")c={TAG:6,_0:{message:b.message,call_to_actions:b.call_to_actions,business_items:b.business_items}};else if(b.__typename==="Video")c={TAG:7,_0:{video_id:b.video_id}};else if(b.__typename==="PagesPlatformLeadGenInfo")c={TAG:8,_0:{field_data_list:b.field_data_list}};else if(b.__typename==="MessageLiveLocation")c={TAG:9,_0:{live_location_id:b.live_location_id,is_expired:b.is_expired,expiration_time:b.expiration_time,sender:b.sender,coordinate:b.coordinate,location_title:b.location_title,sender_destination:b.sender_destination,stop_reason:b.stop_reason}};else if(b.__typename==="QuickInvite")c={TAG:10,_0:{id:b.id,invite_sender:b.invite_sender,invite_recipient:b.invite_recipient}};else if(b.__typename==="PagesPlatformBookingMessage")c={TAG:11,_0:{id:b.id,page:b.page,message_bubble_type:b.message_bubble_type,user:b.user,ls_xma_title:b.ls_xma_title,ls_xma_subtitle:b.ls_xma_subtitle,native_component_flow_request:b.native_component_flow_request}};else if(b.__typename==="ServicesAppointmentAvailability")c={TAG:12,_0:{id:b.id,page:b.page,consumer:b.consumer,formatted_available_time_ranges:b.formatted_available_time_ranges,has_booking_request_created:b.has_booking_request_created}};else if(b.__typename==="ServicesGenericAdminText")c={TAG:13,_0:{id:b.id}};else if(b.__typename==="GenieMessage")c={TAG:14,_0:{genie_sender:b.genie_sender,story_attachment:b.story_attachment}};else if(b.__typename==="Event")c={TAG:15,_0:{eventID:b.eventID,guestStatus:b.guestStatus,canViewerJoin:b.canViewerJoin,timeString:b.timeString,event_place:b.event_place,social_context:b.social_context,watchStatus:b.watchStatus,connection_style:b.connection_style,canViewerWatch:b.canViewerWatch,profile_picture:b.profile_picture,name:b.name,start_timestamp:b.start_timestamp}};else if(b.__typename==="ExternalSong")c={TAG:16,_0:{application_name:b.application_name,artist_names:b.artist_names,audio_url:b.audio_url,duration_ms:b.duration_ms,music_title:b.music_title}};else if(b.__typename==="LightweightAction")c={TAG:17,_0:{lwa_state:b.lwa_state,lwa_type:b.lwa_type}};else if(b.__typename==="MessengerRetailItem")c={TAG:18,_0:{id:b.id,name:b.name,desc:b.desc,thumb_url:b.thumb_url,item_url:b.item_url,source:b.source,image_aspect_ratio:b.image_aspect_ratio,first_metaline:b.first_metaline,second_metaline:b.second_metaline,third_metaline:b.third_metaline,default_action:b.default_action,call_to_actions:b.call_to_actions}};else if(b.__typename==="AgentItemSuggestion")c={TAG:19,_0:{id:b.id,desc:b.desc,total_cost:b.total_cost,merchant_name:b.merchant_name,target_url:b.target_url,thumb_url:b.thumb_url,raw_amount:b.raw_amount,payment:b.payment,price_amount:b.price_amount,price_currency:b.price_currency,name:b.name}};else if(b.__typename==="FundraiserPersonToCharity"||b.__typename==="FundraiserPersonForPerson"){var d=b.fundraiser_detailed_progress_text,e=b.fundraiser_subtitle_text,f=b.focused_cover_photo;c={TAG:20,_0:{fundraiserID:b.id,canDonate:b.can_donate,hasViewerDonated:b.has_viewer_donated,fundraiserDetailedProgressText:d==null?null:d.text,fundraiserSubtitleText:e==null?null:e.text,focusedCoverPhoto:f==null?null:{src:f.photo.image.uri,data:{height:f.photo.image.height,width:f.photo.image.width}}}}}else c=b.__typename==="MessengerRetailReceipt"?{TAG:21,_0:{account_holder_name:b.account_holder_name,adjustments:b.retail_adjustments,cancellation_url:b.cancellation_url,items:b.retail_items,merchant_name:b.merchant_name,messenger_commerce_bubble_type:b.bubble_type,order_id:b.receipt_id,order_time:b.order_time_for_display,order_url:b.receipt_url,payment_method:b.order_payment_method,receipt_id:b.id,recipient_name:b.recipient_name,shipping_cost:b.shipping_cost,shipping_method:b.shipping_method,status:b.status,structured_address:b.structured_address,subtotal:b.subtotal,total_cost:b.total,total_tax:b.tax,partner_logo:b.partner_log}}:b.__typename==="JobApplication"?{TAG:22,_0:{id:b.id}}:b.__typename==="GroupCommerceProductItem"?{TAG:23,_0:{group_commerce_item_description:b.group_commerce_item_description,group_commerce_item_seller:b.group_commerce_item_seller,formatted_price:b.formatted_price,group_commerce_item_title:b.group_commerce_item_title,primary_photo:b.primary_photo,url:b.url}}:b.__typename==="Page"?{TAG:24,_0:{address:b.address,top_category_name:b.top_category_name,cover_photo:b.cover_photo,location:b.location,name:b.name,overall_star_rating:b.overall_star_rating,id:b.id,price_range_description:b.price_range_description}}:b.__typename==="MessengerEventReminder"?{TAG:25,_0:{is_active:b.is_active,event_title:b.event_title,time:b.time}}:b.__typename==="AirlineBoardingPassCollectionMessageAttachment"?{TAG:26,_0:{tint_color:b.tint_color,logo:b.logo,flight_label:b.flight_label,boarding_time_label:b.boarding_time_label,departure_label:b.departure_label,passenger_names_label:b.passenger_names_label,passenger_seat_label:b.passenger_seat_label,flight_terminal_label:b.flight_terminal_label,flight_gate_label:b.flight_gate_label,view_boarding_pass_cta_label:b.view_boarding_pass_cta_label,boarding_passes:b.boarding_passes,share_cta_label:b.share_cta_label,message_cta_label:b.message_cta_label,boarding_pass_title_label:b.boarding_pass_title_label,boarding_pass_error_title_label:b.boarding_pass_error_title_label}}:b.__typename==="AirlineCheckInReminderMessageAttachment"?{TAG:27,_0:{pnr_number:b.pnr_number,tint_color:b.tint_color,checkin_url:b.checkin_url,booking_number_label:b.booking_number_label,flight_label:b.flight_label,arrival_time_label:b.arrival_time_label,departure_time_label:b.departure_time_label,checkin_cta_label:b.checkin_cta_label,logo:b.logo,flight_infos:b.flight_infos}}:b.__typename==="AirlineUpdateMessageAttachment"?{TAG:28,_0:{pnr_number:b.pnr_number,tint_color:b.tint_color,update_type:b.update_type,departure_time_label:b.departure_time_label,arrival_time_label:b.arrival_time_label,booking_number_label:b.booking_number_label,flight_gate_label:b.flight_gate_label,flight_label:b.flight_label,flight_status_label:b.flight_status_label,passenger_names_label:b.passenger_names_label,passenger_seat_label:b.passenger_seat_label,logo:b.logo,flight_info:b.flight_info,hightlighted_labels:b.hightlighted_labels}}:b.__typename==="AirlineItineraryMessageAttachment"?{TAG:29,_0:{confirmation_number:b.confirmation_number,pnr_number:b.pnr_number,tint_color:b.tint_color,formatted_total:b.formatted_total,itemized_price_infos:b.itemized_price_infos,formatted_tax:b.formatted_tax,formatted_base_price:b.formatted_base_price,passenger_infos:b.passenger_infos,logo:b.logo,aircraft_type_label:b.aircraft_type_label,arrival_time_label:b.arrival_time_label,base_price_label:b.base_price_label,booking_number_label:b.booking_number_label,cabin_type_label:b.cabin_type_label,departure_time_label:b.departure_time_label,flight_confirmation_label:b.flight_confirmation_label,flight_date_label:b.flight_date_label,flight_label:b.flight_label,flight_terminal_label:b.flight_terminal_label,itinerary_error_title_label:b.itinerary_error_title_label,itinerary_title_label:b.itinerary_title_label,passenger_name_label:b.passenger_name_label,passenger_names_label:b.passenger_names_label,passenger_seat_label:b.passenger_seat_label,purchase_summary_label:b.purchase_summary_label,taxes_label:b.taxes_label,total_label:b.total_label,view_details_cta_label:b.view_details_cta_label,itinerary_legs:b.itinerary_legs}}:b.__typename==="MessengerRetailShipmentTrackingEvent"?{TAG:30,_0:{id:b.id,shipment:b.shipment,tracking_event_time_for_display:b.tracking_event_time_for_display,shipment_tracking_event_type:b.shipment_tracking_event_type,messenger_commerce_location:b.messenger_commerce_location,tracking_event_description:b.tracking_event_description,bubble_type:b.bubble_type}}:b.__typename==="MessengerRetailShipment"?{TAG:31,_0:{id:b.id,tracking_number:b.tracking_number,shipdate_for_display:b.shipdate_for_display,estimated_delivery_time_for_display:b.estimated_delivery_time_for_display,commerce_origin:b.commerce_origin,commerce_destination:b.commerce_destination,retail_carrier:b.retail_carrier,shipment_tracking_events:b.shipment_tracking_events,receipt:b.receipt,recipient:b.recipient,retail_shipment_items:b.retail_shipment_items,bubble_type:b.bubble_type}}:b.__typename==="EventAttendanceConfirmation"?{TAG:33,_0:{id:b.id,num_guests:b.num_guests,attendee_answers:b.attendee_answers,event:b.event}}:b.__typename==="LeadGenDeepLinkData"?{TAG:32,_0:{id:b.id,cover_image:b.cover_image,headline:b.headline,name:b.name,page:b.page}}:b.__typename==="UserLeadGenInfo"?{TAG:34,_0:{id:b.id,field_data:b.field_data}}:b.__typename==="WECMessageAudio"?{TAG:38,_0:{id:b.id,filename:b.filename,playable_url:b.playable_url,url_shimhash:b.url_shimhash,filesize:b.filesize,extension:b.extension,duration:b.duration}}:b.__typename==="IceBreakerMessageAttachment"?{TAG:35,_0:{ice_breaker_title:b.ice_breaker_title,ice_breaker_messages:b.ice_breaker_messages,ad_id:b.ad_id}}:b.__typename==="WECMessage"?{TAG:36,_0:{sender_wec_number:b.sender_wec_number,sender_wec_number_formated:b.sender_wec_number_formated,sender_wec_number_fbid:b.sender_wec_number_fbid,sender_wec_name:b.sender_wec_name}}:b.__typename==="WECMessageImage"?{TAG:37,_0:{id:b.id,extension:b.extension,preview:b.preview,large_preview:b.large_preview}}:b.__typename==="WECMessageFile"?{TAG:39,_0:{id:b.id,name:b.name,is_malicious:b.is_malicious,uri:b.uri,extension:b.extension,filesize:b.filesize}}:b.__typename==="WECMessageVideo"?{TAG:40,_0:{id:b.id,playable_url:b.playable_url,url_shimhash:b.url_shimhash,filesize:b.filesize,extension:b.extension,filename:b.filename,height:b.height,width:b.width}}:b.__typename==="MontageDirect"?{TAG:41,_0:{message_state:b.message_state,is_keep_disabled:b.is_keep_disabled,blob_media_type:b.blob_media_type,blob_media:b.blob_media,image:b.image}}:b.__typename==="MBirthdayReminderAttachment"?{TAG:42,_0:{friend_id:b.friend_id,confidence:b.confidence,birthday_date:b.birthday_date}}:b.__typename==="MPersonalRemindersList"?{TAG:43,_0:{has_more_upcoming_reminders:b.has_more_upcoming_reminders,personal_reminders:b.personal_reminders}}:b.__typename==="MentorshipMessengerCurriculumStep"?{TAG:44,_0:{id:b.id,module_name:b.module_name,mentorship_program:b.mentorship_program,program_name:b.program_name,curriculum_message:b.curriculum_message,prompt:b.prompt,step_count:b.step_count,total_steps:b.total_steps}}:b.__typename==="MentorshipMessengerDiscussionTopicSet"?{TAG:45,_0:{id:b.id,topics:b.topics}}:b.__typename==="MentorshipMessengerLeavePrompt"?{TAG:46,_0:{mentorship_program:b.mentorship_program,id:b.id,xma_type:b.xma_type}}:b.__typename==="MentorshipMessengerReminder"?{TAG:47,_0:{id:b.id,xma_type:b.xma_type}}:b.__typename==="MentorshipMessengerSurvey"?{TAG:48,_0:{id:b.id,xma_type:b.xma_type,xma_title:b.xma_title,xma_disclaimer:b.xma_disclaimer,mentorship_program:b.mentorship_program}}:b.__typename==="MentorshipMessengerProgressTracker"?{TAG:49,_0:{id:b.id,xma_type:b.xma_type,xma_title:b.xma_title,xma_body:b.xma_body}}:b.__typename==="Story"?{TAG:50,_0:{title:b.title,message_richtext:b.message_richtext,feedback:b.feedback,reaction_count_reduced:b.reaction_count_reduced,top_reactions:b.top_reactions,post_id:b.post_id,creation_time:b.creation_time,description:b.description,actors:b.actors,to:b.to,attachments:b.attachments,attached_story:b.attached_story}}:b.__typename==="User"?{TAG:51,_0:{type:b.__typename,id:b.id,name:b.name,profile_picture:b.profile_picture,cover_photo:b.cover_photo,work_info:b.work_info,subscribe_status:b.subscribe_status}}:b.__typename==="Group"?{TAG:52,_0:{type:b.__typename,id:b.id,name:b.name,cover_photo:b.cover_photo,visibility:b.visibility,visibility_sentence:b.visibility_sentence,viewer_join_state:b.viewer_join_state,group_general_chat:b.group_general_chat,work_groups_sync_metadata:b.work_groups_sync_metadata}}:b.__typename==="AppContent"?{TAG:53,_0:{type:b.__typename,id:b.id,attachment_type_name:b.attachment_type_name,privacy_status:b.privacy_status,file_type_category:b.file_type_category,app_integration:b.app_integration,attachment_icon:b.app_integration,content_uri:b.content_uri,link_preview_additional_data:b.link_preview_additional_data}}:b.__typename==="OneVCMeetingPublic"?{TAG:54,_0:{type:b.__typename,subject:b.subject,joinable_link:b.joinable_link}}:b.__typename==="OfferItem"?{TAG:55,_0:{type:b.__typename,id:b.id}}:b.__typename==="CommerceProductItemShare"?{TAG:56,_0:{type:b.__typename,default_action:b.default_action}}:b.__typename==="ApplicationReferralXMA"?{TAG:57,_0:{type:b.__typename,id:b.id,referral_offer_link:b.referral_offer_link}}:b.__typename==="PostPurchaseOrderUpdateXma"?{TAG:58,_0:{type:b.__typename,order_progress:b.order_progress}}:b.__typename==="InThreadMultiphotoItemCTAData"?{TAG:59,_0:{type:b.__typename,action_prefill:b.action_prefill,ad_id:b.ad_id,cta_title:b.cta_title,customer_id:b.customer_id,index:b.index,page_id:b.page_id,reply_image_uri:b.reply_image_uri}}:null;return{description:a.description,media:a.media,source:a.source,style_list:j(a.style_list),title_with_entities:a.title_with_entities,properties:a.properties,url:a.url,deduplication_key:a.deduplication_key,action_links:a.action_links,messaging_attribution:a.messaging_attribution,messenger_call_to_actions:a.messenger_call_to_actions,xma_layout_info:a.xma_layout_info,messenger_generic_xma_template_extra_info:a.messenger_generic_xma_template_extra_info,target:c}}function l(a){var b=k({description:a.description,media:a.media,source:a.source,style_list:a.style_list,title_with_entities:a.title_with_entities,properties:a.properties,url:a.url,deduplication_key:a.deduplication_key,action_links:a.action_links,messaging_attribution:a.messaging_attribution,messenger_call_to_actions:a.messenger_call_to_actions,xma_layout_info:a.xma_layout_info,messenger_generic_xma_template_extra_info:a.messenger_generic_xma_template_extra_info,target:a.target});if(b==null)return null;a=a.subattachments.map(k);return Object.assign({subattachments:a},b)}function m(a){a=a.message;if(a==null)return[];var c=[];a.ranges.forEach(function(a){var d=a.entity;if(d==null)return;var e=d.id,f=d.thread_key;if(e==null){if(f==null)return;f=f.thread_fbid;if(f==null)return;var g=d.__typename,h;switch(g){case"MessengerViewerGroupThread":h=b("MessageProfileRangeType").THREAD;break;case"User":h=b("MessageProfileRangeType").PROFILE;break;default:h=b("MessageProfileRangeType").NONE}c.push({id:f,offset:a.offset,length:a.length,type:h});return}g=d.__typename;var i;switch(g){case"MessengerViewerGroupThread":i=b("MessageProfileRangeType").THREAD;break;case"User":i=b("MessageProfileRangeType").PROFILE;break;default:i=b("MessageProfileRangeType").NONE}c.push({id:e,offset:a.offset,length:a.length,type:i})});return c}function n(a,c,d,e){var f={};c.message_reactions.forEach(function(a){f[a.user.id]=a.reaction});var j=b("FBIDCheck").isUser_deprecated(c.message_sender.id),k=j?b("MessagingTagUtils").getSourceFromTags(c.tags_list):b("MercurySourceType").UNKNOWN;j=j?b("MessagingTagUtils").getSourceTags(c.tags_list,k):[];var o=c.message_id,p=d.thread_id,q=d.thread_fbid,r=d.other_user_fbid;r=p==null?q==null?r==null?null:b("MercuryIDs").getThreadIDFromUserID(r):b("MercuryIDs").getThreadIDFromThreadFBID(q):p;q=c.secondary_language_body;p=c.tags_list.some(function(a){if(a==="action:copy_message"||a==="copy_self_message"||a==="action:copy_attachment")return!0;else return a==="copy_self_attachment"});var s=c.commerce_message_type,t=c.customizations,u=c.replied_to_message,v;if(u==null)v=null;else{var w=u.message;v=w==null?{status:u.status,message:null}:{status:u.status,message:b("bs_js_null_undefined").fromOption(b("bs_caml_option").some(n(a,w,d,e)))}}u=c.error_data;w=c.unsent_timestamp_precise;w=w==null||w==="0"?null:b("bs_js_null_undefined").fromOption(b("bs_caml_format").caml_float_of_string(w));var x=c.unsender;r={thread_id:r,thread_fbid:d.thread_fbid,other_user_fbid:d.other_user_fbid,action_type:c.__typename==="UserMessage"?b("MercuryActionType").USER_GENERATED_MESSAGE:b("MercuryActionType").LOG_MESSAGE,message_id:o,secondary_language_body:q,threading_id:null,offline_threading_id:c.offline_threading_id,author:b("MercuryIDs").getParticipantIDFromUserID(c.message_sender.id),author_email:c.message_sender.email,ephemeral_ttl_mode:c.ttl,timestamp:b("bs_caml_format").caml_float_of_string(c.timestamp_precise),is_unread:c.unread,is_filtered_content:c.tags_list.indexOf("filtered_content")!==-1,is_filtered_content_bh:c.tags_list.indexOf("filtered_content_bh")!==-1,is_filtered_content_account:c.tags_list.indexOf("filtered_content_account")!==-1,is_filtered_content_quasar:c.tags_list.indexOf("filtered_content_quasar")!==-1,is_filtered_content_invalid_app:c.tags_list.indexOf("filtered_content_invalid_app")!==-1,is_sponsored:c.is_sponsored,is_one_way_sent:c.tags_list.some(function(a){return a==="one_way_message"}),ad_id:c.ad_id,ad_client_token:c.ad_client_token,commerce_message_type:s==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MNCommerceMessageType"),s)),customizations:t==null?[]:t,source:k,source_tags:j,tags:c.tags_list,is_spoof_warning:c.tags_list.indexOf("MTA:dmarc:fail")!==-1||c.tags_list.indexOf("spam:spoofing")!==-1||c.tags_list.indexOf("MTA:spoof_warning")!==-1,folder:d.folder,platform_xmd:c.platform_xmd_encoded,m_suggestions:c.m_suggestions,message_source:c.message_source_data,montage_reply_data:c.montage_reply_data,replied_to_message:v,skip_bump_thread:!1,profile_ranges:m(c),reactions:f,error_data:u==null?null:{description:u.description},removed_timestamp:w,unsender:x==null?null:{id:b("MercuryIDs").getParticipantIDFromUserID(x.messaging_actor.id),name:x.messaging_actor.name,short_name:x.messaging_actor.short_name},verse_group_role_xmd:c.verse_group_role_xmd,mib_direct_message_data:c.mib_direct_message_data,message_unsendability_status:b("MessageUnsendabilityStatus.bs").fromNullableString(c.message_unsendability_status),has_attachment:null,attachments:null,raw_attachments:null,ranges:null,meta_ranges:null,status:null,log_message_type:null,log_message_data:null,log_message_body:null,body:null,subject:null,creator_info:null,is_forwarded:p,preview_attachments:null,sticker_id:null};if(c.__typename==="UserMessage"){q=g(c);s=c.extensible_attachment;if(s==null)t=null;else{k=s.story_attachment;j=s.genie_attachment;if(j==null)v=null;else{u=j.genie_message;if(u==null)w=null;else{x=u.story_attachment;w={story_attachment:x==null?null:l(x)}}v={genie_message:w}}t={legacy_attachment_id:s.legacy_attachment_id,story_attachment:k==null?null:l(k),genie_attachment:v}}p=b("MessengerAttachmentTransformer.bs").transformAttachment(a,{extensible_attachment:t,blob_attachments:q,sticker:c.sticker},o,e);j=c.message;u=c.page_admin_sender;Object.assign(r,{body:j==null?null:j.text,creator_info:u==null?null:{creatorID:u.admin_id,creatorName:u.name,creatorType:u.sender_type,labelType:u.label_type,pageID:u.page_id,profileURI:u.profile_uri},subject:null,has_attachment:p.length>0,attachments:p,raw_attachments:null,ranges:void 0,meta_ranges:c.meta_ranges.map(function(a){return babelHelpers["extends"]({},a,{data:JSON.parse(a.data)})})})}else if(c.__typename==="VoiceCallMessage"||c.__typename==="VideoCallMessage"){x=c.__typename;w=x==="VoiceCallMessage"?b("MercuryLogMessageType").PHONE_CALL:b("MercuryLogMessageType").VIDEO_CALL;s=c.message_sender.id;k=d.other_user_fbid;v=k==null?null:b("MercuryIDs").getParticipantIDFromUserID(s===k?b("CurrentUser").getID():k);t=c.answered;Object.assign(r,{log_message_type:w,log_message_data:{answered:t==null?!1:t,call_capture_attachments:h(a,c,e),caller:b("MercuryIDs").getParticipantIDFromUserID(s),callee:v},log_message_body:c.snippet})}else if(c.__typename==="ThreadNameMessage")Object.assign(r,{log_message_type:b("MercuryLogMessageType").THREAD_NAME,log_message_data:{name:c.thread_name},log_message_body:c.snippet});else if(c.__typename==="ThreadImageMessage"){q=c.image_with_metadata;if(q==null)o=null;else{j=q.preview;o={preview_url:j==null?null:j.uri,metadata:{fbid:q.legacy_attachment_id,dimensions:String(q.original_dimensions.x)+(","+String(q.original_dimensions.y))}}}Object.assign(r,{log_message_type:b("MercuryLogMessageType").THREAD_IMAGE,log_message_data:{image:o},log_message_body:c.snippet})}else if(c.__typename==="ParticipantsAddedMessage"){u=c.participants_added;Object.assign(r,{log_message_type:b("MercuryLogMessageType").SUBSCRIBE,log_message_data:{added_participants:u==null?[]:u.map(function(a){return b("MercuryIDs").getParticipantIDFromUserID(a.id)})},log_message_body:c.snippet})}else if(c.__typename==="ParticipantLeftMessage"){p=c.participants_removed;Object.assign(r,{log_message_type:b("MercuryLogMessageType").UNSUBSCRIBE,log_message_data:{removed_participants:p==null?[]:p.map(function(a){return b("MercuryIDs").getParticipantIDFromUserID(a.id)})},log_message_body:c.snippet})}else if(c.__typename==="GenericAdminTextMessage"){x=c.extensible_message_admin_text;d=c.extensible_message_admin_text_type;x==null?d==null||Object.assign(r,{log_message_body:c.snippet,log_message_data:{message_type:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessagingGenericAdminTextType"),d)),untypedData:void 0},log_message_type:b("MercuryLogMessageType").GENERIC_ADMIN_TEXT}):d==null||Object.assign(r,i(a,x,d,c.snippet,e))}else if(c.__typename==="P2PPaymentRequestMessage"||c.__typename==="P2PPaymentMessage"){k=c.p2p_sender;w=c.p2p_receiver;t=c.amount;s=c.message_type;Object.assign(r,{log_message_body:c.snippet,log_message_data:{transfer_id:c.transfer_id,senderId:k==null?null:b("MercuryIDs").getParticipantIDFromUserID(k.id),receiverId:w==null?null:b("MercuryIDs").getParticipantIDFromUserID(w.id),formattedAmount:t==null?null:t.formatted,subtype:s==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("P2PPaymentLogMessageSubtype"),s))},log_message_type:b("MercuryLogMessageType").ORION})}return r}f.unsafeCastBlobAttachments=g;f._getCallCaptureAttachments=h;f._getGenericAdminTextMessage=i;f._getStyleList=j;f.unsafeCastExtensibleAttachmentWithoutSubattachments=k;f.unsafeCastExtensibleAttachment=l;f._getProfileRanges=m;f.transformMessage=n}),null);
__d("MessengerThreadCannotReplyReason",[],(function(a,b,c,d,e,f){a=Object.freeze({BLOCKED:"blocked",MESSENGER_BLOCKEE:"messenger_blockee",COMPOSER_DISABLED_BOT:"composer_disabled_bot",HAS_EMAIL_PARTICIPANT:"has_email_participant",OBJECT_ORIGINATED:"object_originated",READ_ONLY:"read_only",VIEWER_NOT_SUBSCRIBED:"viewer_not_subscribed",RECIPIENTS_NOT_LOADABLE:"recipients_not_loadable",RECIPIENTS_UNAVAILABLE:"recipients_unavailable",RECIPIENTS_INVALID:"recipients_invalid",RECIPIENTS_INACTIVE_WORK_ACC:"recipients_inactive_work_account",MONTAGE_NOT_AUTHOR:"montage_not_author",VIEWER_MUTED_IN_FBGROUP:"viewer_muted_in_fbgroup",VIEWER_IS_LIMITED_WORK_ACCOUNT:"viewer_is_limited_work_account",RECIPIENTS_IS_LIMITED_WORK_ACCOUNT:"recipients_is_limited_work_account",WORK_GARDEN_ARCHIVED:"work_garden_archived",PARTICIPANTS_IN_RESTRICTED_JURISDICTION:"participants_in_restricted_jurisdiction"});f["default"]=a}),66);
__d("MessengerThreadCannotReplyReason.bs",["MessengerThreadCannotReplyReason","bs_js_dict"],(function(a,b,c,d,e,f){"use strict";function a(a){if(!(a==null))return b("bs_js_dict").get(b("MessengerThreadCannotReplyReason"),a.toUpperCase())}function c(a){if(a==null)return null;if(a===0)return b("MessengerThreadCannotReplyReason").BLOCKED;switch(a){case 1:return b("MessengerThreadCannotReplyReason").RECIPIENTS_NOT_LOADABLE;case 2:return b("MessengerThreadCannotReplyReason").BLOCKED;case 3:return b("MessengerThreadCannotReplyReason").MESSENGER_BLOCKEE}}f.fromName=a;f.fromMessageThreadCannotReplyReason=c}),null);
__d("WorkForeignEntityType",[],(function(a,b,c,d,e,f){a=Object.freeze({FOREIGN:"FOREIGN",NOT_FOREIGN:"NOT_FOREIGN",LIMITED:"LIMITED"});f["default"]=a}),66);
__d("bs_caml_obj",["bs_caml"],(function(a,b,c,d,e,f){"use strict";var g=function(a,b){for(var c in a)b(c)},h=function(a){if(Array.isArray(a)){var b=a.length,c=new Array(b);for(var d=0;d<b;++d)c[d]=a[d];a.TAG!==void 0&&(c.TAG=a.TAG);return c}return Object.assign({},a)},i=function(a,b){var c;if(Array.isArray(b)){for(c=0;c<b.length;++c)a[c]=b[c];b.TAG!==void 0&&(a.TAG=b.TAG)}else for(var c in b)a[c]=b[c]};function j(a,c){if(a===c)return 0;var d=typeof a,e=typeof c;switch(d){case"boolean":if(e==="boolean")return b("bs_caml").caml_bool_compare(a,c);break;case"function":if(e==="function")throw{RE_EXN_ID:"Invalid_argument",_1:"compare: functional value",Error:new Error()};break;case"number":if(e==="number")return b("bs_caml").caml_int_compare(a,c);break;case"string":if(e==="string")return b("bs_caml").caml_string_compare(a,c);else return 1;case"undefined":return-1;default:}switch(e){case"string":return-1;case"undefined":return 1;default:if(d==="boolean")return 1;if(e==="boolean")return-1;if(d==="function")return 1;if(e==="function")return-1;if(d==="number")if(c===null||c.BS_PRIVATE_NESTED_SOME_NONE!==void 0)return 1;else return-1;if(e==="number")if(a===null||a.BS_PRIVATE_NESTED_SOME_NONE!==void 0)return-1;else return 1;if(a===null)if(c.BS_PRIVATE_NESTED_SOME_NONE!==void 0)return 1;else return-1;if(c===null)if(a.BS_PRIVATE_NESTED_SOME_NONE!==void 0)return-1;else return 1;if(a.BS_PRIVATE_NESTED_SOME_NONE!==void 0)if(c.BS_PRIVATE_NESTED_SOME_NONE!==void 0)return k(a,c);else return-1;d=a.TAG|0;e=c.TAG|0;if(d===248)return b("bs_caml").caml_int_compare(a[1],c[1]);if(d===251)throw{RE_EXN_ID:"Invalid_argument",_1:"equal: abstract value",Error:new Error()};if(d!==e)if(d<e)return-1;else return 1;d=a.length|0;e=c.length|0;if(d===e)if(Array.isArray(a)){var f=0;while(!0){var g=f;if(g===d)return 0;var h=j(a[g],c[g]);if(h!==0)return h;f=g+1|0;continue}}else if(a instanceof Date&&c instanceof Date)return a-c;else return k(a,c);else if(d<e){h=0;while(!0){g=h;if(g===d)return-1;f=j(a[g],c[g]);if(f!==0)return f;h=g+1|0;continue}}else{f=0;while(!0){g=f;if(g===e)return 1;h=j(a[g],c[g]);if(h!==0)return h;f=g+1|0;continue}}}}function k(a,c){var d={contents:void 0},e={contents:void 0},f=function(b,c){var d=b[2],a=b[1];if(!(!Object.prototype.hasOwnProperty.call(a,c)||j(b[0][c],a[c])>0))return;b=d.contents;if(b!==void 0&&c>=b)return;else{d.contents=c;return}},h=[a,c,e],i=function(a){return f(h,a)},k=[c,a,d],l=function(a){return f(k,a)};g(a,i);g(c,l);a=d.contents;i=e.contents;if(a!==void 0)if(i!==void 0)return b("bs_caml").caml_string_compare(a,i);else return-1;else if(i!==void 0)return 1;else return 0}function l(a,b){if(a===b)return!0;var c=typeof a;if(c==="string"||c==="number"||c==="boolean"||c==="undefined"||a===null)return!1;var d=typeof b;if(c==="function"||d==="function")throw{RE_EXN_ID:"Invalid_argument",_1:"equal: functional value",Error:new Error()};if(d==="number"||d==="undefined"||b===null)return!1;c=a.TAG|0;d=b.TAG|0;if(c===248)return a[1]===b[1];if(c===251)throw{RE_EXN_ID:"Invalid_argument",_1:"equal: abstract value",Error:new Error()};if(c!==d)return!1;c=a.length|0;d=b.length|0;if(c===d)if(Array.isArray(a)){d=0;while(!0){var e=d;if(e===c)return!0;if(!l(a[e],b[e]))return!1;d=e+1|0;continue}}else if(a instanceof Date&&b instanceof Date)return!(a>b||a<b);else{var f={contents:!0};e=function(a){if(!Object.prototype.hasOwnProperty.call(b,a)){f.contents=!1;return}};d=function(c){if(!Object.prototype.hasOwnProperty.call(a,c)||!l(b[c],a[c])){f.contents=!1;return}};g(a,e);f.contents&&g(b,d);return f.contents}else return!1}function a(a,b){if(b!==null)return l(a,b);else return a===b}function c(a,b){if(b!==void 0)return l(a,b);else return a===b}function d(a,b){if(b==null)return a===b;else return l(a,b)}function e(a,b){return!l(a,b)}function m(a,b){return j(a,b)>=0}function n(a,b){return j(a,b)>0}function o(a,b){return j(a,b)<=0}function p(a,b){return j(a,b)<0}function q(a,b){if(j(a,b)<=0)return a;else return b}function r(a,b){if(j(a,b)>=0)return a;else return b}f.caml_obj_dup=h;f.update_dummy=i;f.caml_compare=j;f.caml_equal=l;f.caml_equal_null=a;f.caml_equal_undefined=c;f.caml_equal_nullable=d;f.caml_notequal=e;f.caml_greaterequal=m;f.caml_greaterthan=n;f.caml_lessthan=p;f.caml_lessequal=o;f.caml_min=q;f.caml_max=r}),null);
__d("bs_array",["bs_caml_array","bs_caml_exceptions","bs_caml_js_exceptions","bs_caml_obj","bs_curry"],(function(a,b,c,d,e,f){"use strict";var g=b("bs_caml_array").make_float,h={};function a(a,c){if(a===0)return[];if(a<0)throw{RE_EXN_ID:"Invalid_argument",_1:"Array.init",Error:new Error()};var d=b("bs_caml_array").make(a,b("bs_curry")._1(c,0));for(var e=1;e<a;++e)d[e]=b("bs_curry")._1(c,e);return d}function c(a,c,d){var e=b("bs_caml_array").make(a,[]);for(var f=0;f<a;++f)e[f]=b("bs_caml_array").make(c,d);return e}function i(a){var c=a.length;if(c===0)return[];else return b("bs_caml_array").sub(a,0,c)}function d(a,c){var d=a.length;if(d===0)return i(c);else if(c.length===0)return b("bs_caml_array").sub(a,0,d);else return a.concat(c)}function e(a,c,d){if(c<0||d<0||c>(a.length-d|0))throw{RE_EXN_ID:"Invalid_argument",_1:"Array.sub",Error:new Error()};return b("bs_caml_array").sub(a,c,d)}function j(a,b,c,d){if(b<0||c<0||b>(a.length-c|0))throw{RE_EXN_ID:"Invalid_argument",_1:"Array.fill",Error:new Error()};for(var e=b,b=b+c|0;e<b;++e)a[e]=d}function k(a,c,d,e,f){if(f<0||c<0||c>(a.length-f|0)||e<0||e>(d.length-f|0))throw{RE_EXN_ID:"Invalid_argument",_1:"Array.blit",Error:new Error()};return b("bs_caml_array").blit(a,c,d,e,f)}function l(a,c){for(var d=0,e=c.length;d<e;++d)b("bs_curry")._1(a,c[d])}function m(a,c,d){if(c.length!==d.length)throw{RE_EXN_ID:"Invalid_argument",_1:"Array.iter2: arrays must have the same length",Error:new Error()};for(var e=0,f=c.length;e<f;++e)b("bs_curry")._2(a,c[e],d[e])}function n(a,c){var d=c.length;if(d===0)return[];var e=b("bs_caml_array").make(d,b("bs_curry")._1(a,c[0]));for(var f=1;f<d;++f)e[f]=b("bs_curry")._1(a,c[f]);return e}function o(a,c,d){var e=c.length,f=d.length;if(e!==f)throw{RE_EXN_ID:"Invalid_argument",_1:"Array.map2: arrays must have the same length",Error:new Error()};if(e===0)return[];f=b("bs_caml_array").make(e,b("bs_curry")._2(a,c[0],d[0]));for(var g=1;g<e;++g)f[g]=b("bs_curry")._2(a,c[g],d[g]);return f}function p(a,c){for(var d=0,e=c.length;d<e;++d)b("bs_curry")._2(a,d,c[d])}function q(a,c){var d=c.length;if(d===0)return[];var e=b("bs_caml_array").make(d,b("bs_curry")._2(a,0,c[0]));for(var f=1;f<d;++f)e[f]=b("bs_curry")._2(a,f,c[f]);return e}function r(a){var b=a.length-1|0,c=0;while(!0){var d=c,e=b;if(e<0)return d;c={hd:a[e],tl:d};b=e-1|0;continue}}function s(a,b){while(!0){var c=b,d=a;if(!c)return d;b=c.tl;a=d+1|0;continue}}function t(a){if(!a)return[];var c=b("bs_caml_array").make(s(0,a),a.hd),d=1;a=a.tl;while(!0){var e=a,f=d;if(!e)return c;c[f]=e.hd;a=e.tl;d=f+1|0;continue}}function u(a,c,d){c=c;for(var e=0,f=d.length;e<f;++e)c=b("bs_curry")._2(a,c,d[e]);return c}function v(a,c,d){d=d;for(var e=c.length-1|0;e>=0;--e)d=b("bs_curry")._2(a,c[e],d);return d}function w(a,c){var d=c.length,e=0;while(!0){var f=e;if(f===d)return!1;if(b("bs_curry")._1(a,c[f]))return!0;e=f+1|0;continue}}function x(a,c){var d=c.length,e=0;while(!0){var f=e;if(f===d)return!0;if(!b("bs_curry")._1(a,c[f]))return!1;e=f+1|0;continue}}function y(a,c){var d=c.length,e=0;while(!0){var f=e;if(f===d)return!1;if(b("bs_caml_obj").caml_equal(c[f],a))return!0;e=f+1|0;continue}}function z(a,b){var c=b.length,d=0;while(!0){var e=d;if(e===c)return!1;if(a===b[e])return!0;d=e+1|0;continue}}var A=b("bs_caml_exceptions").create("Array.Bottom");function B(a,c){var d=function(d,e){var f=((e+e|0)+e|0)+1|0,g=f;if((f+2|0)<d){b("bs_curry")._2(a,b("bs_caml_array").get(c,f),b("bs_caml_array").get(c,f+1|0))<0&&(g=f+1|0);b("bs_curry")._2(a,b("bs_caml_array").get(c,g),b("bs_caml_array").get(c,f+2|0))<0&&(g=f+2|0);return g}if((f+1|0)<d&&b("bs_curry")._2(a,b("bs_caml_array").get(c,f),b("bs_caml_array").get(c,f+1|0))<0)return f+1|0;if(f<d)return f;throw{RE_EXN_ID:A,_1:e,Error:new Error()}},e=function(e,f,g){try{f=f;while(!0){var h=f,i=d(e,h);if(b("bs_curry")._2(a,b("bs_caml_array").get(c,i),g)<=0)return b("bs_caml_array").set(c,h,g);b("bs_caml_array").set(c,h,b("bs_caml_array").get(c,i));f=i;continue}}catch(a){h=b("bs_caml_js_exceptions").internalToOCamlException(a);if(h.RE_EXN_ID===A)return b("bs_caml_array").set(c,h._1,g);throw h}},f=function(a,e){try{e=e;while(!0){var f=e,g=d(a,f);b("bs_caml_array").set(c,f,b("bs_caml_array").get(c,g));e=g;continue}}catch(a){f=b("bs_caml_js_exceptions").internalToOCamlException(a);if(f.RE_EXN_ID===A)return f._1;throw f}},g=function(e,f){while(!0){var d=e,g=(d-1|0)/3|0;if(d===g)throw{RE_EXN_ID:"Assert_failure",_1:["array.ml",238,4],Error:new Error()};if(b("bs_curry")._2(a,b("bs_caml_array").get(c,g),f)>=0)return b("bs_caml_array").set(c,d,f);b("bs_caml_array").set(c,d,b("bs_caml_array").get(c,g));if(g<=0)return b("bs_caml_array").set(c,0,f);e=g;continue}},h=c.length;for(var i=((h+1|0)/3|0)-1|0;i>=0;--i)e(h,i,b("bs_caml_array").get(c,i));for(var i=h-1|0;i>=2;--i){e=b("bs_caml_array").get(c,i);b("bs_caml_array").set(c,i,b("bs_caml_array").get(c,0));g(f(i,0),e)}if(h<=1)return;e=b("bs_caml_array").get(c,1);b("bs_caml_array").set(c,1,b("bs_caml_array").get(c,0));return b("bs_caml_array").set(c,0,e)}function C(a,c){var d=function(d,e,f,g,h,i,j){e=d+e|0;h=g+h|0;var l=d;d=b("bs_caml_array").get(c,d);var m=g;g=b("bs_caml_array").get(f,g);j=j;while(!0){var n=j,o=g,p=m,q=d,r=l;if(b("bs_curry")._2(a,q,o)<=0){b("bs_caml_array").set(i,n,q);q=r+1|0;if(q>=e)return k(f,p,i,n+1|0,h-p|0);j=n+1|0;d=b("bs_caml_array").get(c,q);l=q;continue}b("bs_caml_array").set(i,n,o);q=p+1|0;if(q>=h)return k(c,r,i,n+1|0,e-r|0);j=n+1|0;g=b("bs_caml_array").get(f,q);m=q;continue}},e=function(d,e,f,g){for(var h=0;h<g;++h){var i=b("bs_caml_array").get(c,d+h|0),j=(f+h|0)-1|0;while(j>=f&&b("bs_curry")._2(a,b("bs_caml_array").get(e,j),i)>0)b("bs_caml_array").set(e,j+1|0,b("bs_caml_array").get(e,j)),j=j-1|0;b("bs_caml_array").set(e,j+1|0,i)}},f=function a(f,g,h,i){if(i<=5)return e(f,g,h,i);var b=i/2|0;i=i-b|0;a(f+b|0,g,h+b|0,i);a(f,c,f+i|0,b);return d(f+i|0,b,g,h+b|0,i,g,h)},g=c.length;if(g<=5)return e(0,c,0,g);var h=g/2|0;g=g-h|0;var i=b("bs_caml_array").make(g,b("bs_caml_array").get(c,0));f(h,i,0,g);f(0,c,g,h);return d(g,h,i,0,g,c,0)}var D=c,E=b("bs_caml_array").concat,F=C;f.make_float=g;f.init=a;f.make_matrix=c;f.create_matrix=D;f.append=d;f.concat=E;f.sub=e;f.copy=i;f.fill=j;f.blit=k;f.to_list=r;f.of_list=t;f.iter=l;f.iteri=p;f.map=n;f.mapi=q;f.fold_left=u;f.fold_right=v;f.iter2=m;f.map2=o;f.for_all=x;f.exists=w;f.mem=y;f.memq=z;f.sort=B;f.stable_sort=C;f.fast_sort=F;f.Floatarray=h}),null);
__d("bs_js_json",["bs_caml_option"],(function(a,b,c,d,e,f){"use strict";function a(a){var b=typeof a;if(b==="string")return{TAG:0,_0:a};else if(b==="number")return{TAG:1,_0:a};else if(b==="boolean")if(a===!0)return 1;else return 0;else if(a===null)return 2;else if(Array.isArray(a))return{TAG:3,_0:a};else return{TAG:2,_0:a}}function c(a,b){switch(b){case 0:return typeof a==="string";case 1:return typeof a==="number";case 2:if(a!==null&&typeof a==="object")return!Array.isArray(a);else return!1;case 3:return Array.isArray(a);case 4:return typeof a==="boolean";case 5:return a===null}}function d(a){if(typeof a==="string")return a}function e(a){if(typeof a==="number")return a}function g(a){if(typeof a==="object"&&!Array.isArray(a)&&a!==null)return b("bs_caml_option").some(a)}function h(a){if(Array.isArray(a))return a}function i(a){if(typeof a==="boolean")return a}function j(a){if(a===null)return null}var k=function(a){a=[a];var b=[{kind:0,i:0,parent:a}];while(b.length!==0){var c=b[b.length-1];c.kind===0?(c.val=c.parent[c.i],++c.i===c.parent.length&&b.pop()):b.pop();var d=c.val;if(typeof d==="object")if(Array.isArray(d)&&d.length!==0)b.push({kind:0,i:0,parent:d,val:void 0});else for(var e in d){if(e==="RE_PRIVATE_NONE"){c.kind===0?c.parent[c.i-1]=void 0:c.parent[c.i]=void 0;continue}b.push({kind:1,i:e,parent:d,val:d[e]})}}return a[0]};function l(a){return function(a){a=JSON.stringify(a,function(a,b){return b===void 0?{RE_PRIVATE_NONE:!0}:b});if(a===void 0)throw new TypeError("output is undefined");return a}(a)}function m(a){return k(JSON.parse(a))}f.classify=a;f.test=c;f.decodeString=d;f.decodeNumber=e;f.decodeObject=g;f.decodeArray=h;f.decodeBoolean=i;f.decodeNull=j;f.deserializeUnsafe=m;f.serializeExn=l}),null);
__d("MessengerServerPayloadTransformer.bs",["fbt","ChatConfig","CurrentUser","DisplayGenderConst","FBID.bs","GenderConst","MercuryIDs","MercuryParticipantTypes","MessageThreadUnsendabilityStatus.bs","MessagingThreadType","MessengerAttachmentTransformer.bs","MessengerGroupAdminModelStatus.bs","MessengerGroupAdminType","MessengerGroupThreadSubType","MessengerGroupsSyncStatus.bs","MessengerMessageTransformer.bs","MessengerObjectAssociationType","MessengerThreadCannotReplyReason","MessengerThreadCannotReplyReason.bs","URI","WorkForeignEntityType","bs_array","bs_belt_Option","bs_caml_array","bs_caml_format","bs_caml_option","bs_js_dict","bs_js_json","bs_js_null_undefined","bs_string","getByPath","isMessengerDotComURI"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){var c=a.location_coordinates;c=c==null?[null,null]:[c.latitude,c.longitude];var d=a.location_page,e;if(d==null)e=null;else{d=d.address;e=d==null?null:d.full_address}d=a.allows_rsvp?1:0;var f=b("bs_array").fold_left(function(a,b){a[b.node.id]=b.guest_list_state;return a},{},a.event_reminder_members.edges),g=a.lightweight_event_creator;return{creator_id:g==null?null:g.id,event_members:f,event_time:a.time,event_type:a.lightweight_event_type,latitude:c[0],longitude:c[1],location_address:e,location_name:a.location_name,note:a.note,oid:a.id,related_event:a.related_event,repeat_mode:a.repeat_mode,seconds_to_notify_before:a.seconds_to_notify_before,status:a.lightweight_event_status,title:a.event_title,track_rsvp:d}}function j(a){a=a.associated_object;if(a==null)return null;var c=a.action_link,d=a.profile_picture,e=a.group_general_chat,f=a.group_saves,g=a.verse_group_link;return{id:a.id,name:a.name,action_link:c==null?null:b("CurrentUser").isWorkUser()?c:new(h||(h=b("URI")))(c).setDomain("www.facebook.com"),profile_picture:d==null?null:{uri:d.uri},group_general_chat:e==null?null:{id:e.id},room_type:a.room_type,privacy_mode:a.privacy_mode,approval_mode_toggleable:a.approval_mode_toggleable,start_timestamp:a.start_timestamp,event_place:a.event_place,mentorship_program:a.mentorship_program,group_saves:f==null?{count:0}:{count:f.count},verse_group_link:g==null?null:new(h||(h=b("URI")))(g).setDomain("www.facebook.com")}}function k(a){a=a.related_page_thread;if(a==null)return null;var b=a.custom_thread_tags.nodes.map(function(a){return{id:a.id,name:a.name,color:a.color}}),c=a.custom_thread_labels.nodes.map(function(a){return{id:a.id,name:a.name,color:a.label_color,data_silo:a.data_silo}}),d=a.corp_thread_labels.nodes.map(function(a){return{id:a.id,name:a.name,color:a.label_color,data_silo:a.data_silo}}),e=a.page;e=e==null?null:e.id;return{flagged:a.is_flagged,pageID:e,customTags:b,customLabels:c,corpLabels:d}}function l(a){var c=a.thread_key.other_user_id;if(c==null)return!1;a=a.all_participants.edges;return b("bs_array").fold_left(function(a,b){b=b.node.messaging_actor;if(b.id===c)return b.__typename==="User";else return a},!1,a)}function m(a){if(a.length===0)return null;var b={};a.forEach(function(a){var c=a.nickname;if(!(c==null)){b[a.participant_id]=c;return}});return b}function n(a){return"#"+b("bs_string").sub(a,2,a.length-2|0)}function o(a){if(a==null||a==="")return null;else return n(a)}function a(a){return a.thread_key.thread_fbid}function c(a){return a.thread_key.other_user_id}function d(a){return b("bs_caml_option").nullable_to_opt(b("getByPath")(a,["messages","page_info"]))}function e(a){var c=b("CurrentUser").isWorkUser()?g._("Workplace user"):g._("Facebook User");return{id:"fbid:"+a,fbid:b("FBID.bs").ofStringExn(a),gender:b("GenderConst").UNKNOWN_SINGULAR,href:null,image_src:null,square_image_src:null,big_image_src:null,name:c,short_name:c,user_type:null,vanity:null,accepts_messenger_user_feedback:!1,is_friend:!1,is_viewer_managing_parent:!1,is_messenger_user:!1,is_aloha_proxy_confirmed:!1,is_business_enabled:!1,is_messenger_platform_bot:!1,is_messenger_ignored:null,is_messenger_blocked:!1,is_facebook_blocked:!0,is_subscribed_to_page_updates:!1,title:null,company_name:null,employee:!1,instant_game_channel:null,work_foreign_entity_info:null,timezone:null,wec_group_admins:[],wec_group_creation_time:null,wec_group_invite_link:null,wec_group_participant_count:null,wec_group_participants:[],verification_status:null}}function p(a){var c=a.profile_picture_url;if(c==null){var d=a.big_image_src;d=d==null?null:d.uri}else d=c;c=a.gender;var e=a.url,f;if(e==null)f=null;else{var g=b("isMessengerDotComURI")(new(h||(h=b("URI")))(e));f=g?new(h||(h=b("URI")))(e).getUnqualifiedURI().setDomain("www.facebook.com").setProtocol("https").toString():e}g=a.__typename;var i;switch(g){case"NeoApprovedUser":i=b("MercuryParticipantTypes").PARENT_APPROVED_USER;break;case"Page":i=b("MercuryParticipantTypes").PAGE;break;case"ReducedMessagingActor":i=b("MercuryParticipantTypes").GUEST;break;case"User":i=b("MercuryParticipantTypes").USER;break;default:i=null}e=a.accepts_messenger_user_feedback;g=a.is_viewer_friend;var j=a.is_viewer_managing_parent,k=a.is_messenger_user,l=a.is_aloha_proxy_confirmed,m=a.is_messenger_platform_bot,n=a.is_message_blocked_by_viewer,o=a.is_blocked_by_viewer,p=a.is_viewer_subscribed_to_message_updates,q=a.work_info,r;if(q==null)r=null;else{var s=q.work_community;s=s==null?null:s.name;q=q.job_title;r=s==null?q==null?null:q:q==null||q.length===0?s:""+q+" \u2022 "+s}q=a.work_info;if(q==null)s=null;else{q=q.work_community;q=q==null?null:q.name;var t=a.work_foreign_entity_info;s=q==null||t==null||t.type!==b("WorkForeignEntityType").FOREIGN?null:q}t=a.is_employee;q=a.work_foreign_entity_info;var u=a.wec_group_creation_time,v=a.wec_group_invite_link,w=a.wec_group_participants,x=a.wec_group_participants,y=a.wec_group_admins;return{id:"fbid:"+a.id,fbid:a.id,gender:c==null?b("GenderConst").NOT_A_PERSON:c===b("DisplayGenderConst").MALE?b("GenderConst").MALE_SINGULAR:c===b("DisplayGenderConst").FEMALE?b("GenderConst").FEMALE_SINGULAR:b("GenderConst").NOT_A_PERSON,href:f,image_src:d,square_image_src:null,big_image_src:d,name:a.name,short_name:b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(a.short_name),a.name),user_type:i,vanity:a.username,accepts_messenger_user_feedback:e==null?!1:e,is_friend:g==null?!1:g,is_viewer_managing_parent:j==null?!1:j,is_messenger_user:k==null?!1:k,is_aloha_proxy_confirmed:l==null?!1:l,is_business_enabled:a.__typename==="Page",is_messenger_platform_bot:m==null?!1:m,is_messenger_ignored:null,is_messenger_blocked:n==null?!1:n,is_facebook_blocked:o==null?!1:o,is_subscribed_to_page_updates:p==null?!0:p,title:r,company_name:s,employee:t==null?!1:t,instant_game_channel:a.__typename==="Page"?a.instant_game_channel:null,work_foreign_entity_info:q==null?null:q,timezone:null,wec_group_creation_time:u==null?null:u,wec_group_invite_link:v==null?null:v,wec_group_participant_count:w==null?null:w.count,wec_group_participants:x==null?[]:x.nodes.map(function(a){return{id:b("MercuryIDs").getParticipantIDFromUserID(a.messaging_actor.id),name:a.messaging_actor.name}}),wec_group_admins:y==null?[]:y.nodes.map(function(a){return{id:b("MercuryIDs").getParticipantIDFromUserID(a.messaging_actor.id),name:a.messaging_actor.name}}),verification_status:a.verification_status}}function q(a){return a.all_participants.edges.map(function(a){return p(a.node.messaging_actor)})}function r(a,c){c=c.read_receipts;if(c==null)return;var d={};c.nodes.forEach(function(c){var e=c.actor;if(!(e==null)&&a!==e.id){d[e.id]={action:b("bs_caml_format").caml_float_of_string(c.action),watermark:b("bs_caml_format").caml_float_of_string(c.watermark)};return}});return b("bs_caml_option").some(d)}function s(a){a=a.delivery_receipts;if(a==null)return[];else return a.nodes.sort(function(a,c){a=b("bs_caml_format").caml_float_of_string(a.timestamp_precise);c=b("bs_caml_format").caml_float_of_string(c.timestamp_precise);if(a>c)return-1;else if(a===c)return 0;else return 1})}function t(a,c,d){var e=c.messages;if(!(e==null))return e.nodes.map(function(e){return b("MessengerMessageTransformer.bs").transformMessage(a,e,{thread_id:null,thread_fbid:c.thread_key.thread_fbid,other_user_fbid:c.thread_key.other_user_id,folder:c.folder.toLowerCase()},d)})}function u(a,c,d){var e=c.last_message.nodes.map(function(d){var f=b("MessengerMessageTransformer.bs").unsafeCastBlobAttachments(d),a=d.extensible_attachment,g;if(a==null)g=null;else{var h=a.story_attachment,i=a.genie_attachment,c;if(i==null)c=null;else{i=i.genie_message;var e;if(i==null)e=null;else{i=i.story_attachment;e={story_attachment:i==null?null:b("MessengerMessageTransformer.bs").unsafeCastExtensibleAttachment(i)}}c={genie_message:e}}g={legacy_attachment_id:a.legacy_attachment_id,story_attachment:h==null?null:b("MessengerMessageTransformer.bs").unsafeCastExtensibleAttachment(h),genie_attachment:c}}return{message_id:d.message_id,snippet:d.snippet,message_sender:d.message_sender,timestamp_precise:d.timestamp_precise,commerce_message_type:d.commerce_message_type,extensible_attachment:g,blob_attachments:f,sticker:d.sticker,extensible_message_admin_text:d.extensible_message_admin_text,platform_xmd_encoded:d.platform_xmd_encoded,extensible_message_admin_text_type:d.extensible_message_admin_text_type,message_unsendability_status:d.message_unsendability_status}}),f={id:c.id,thread_key:c.thread_key,name:c.name,all_participants:c.all_participants,last_message:{nodes:e},unread_count:c.unread_count,message_count:c.messages_count,image:c.image,square_image:c.square_image,updated_time_precise:c.updated_time_precise,mute_until:c.mute_until,is_pinned:c.is_pinned,is_pin_protected:c.is_pin_protected,is_viewer_subscribed:c.is_viewer_subscribed,is_other_recipient_page:c.is_other_recipient_page,is_canonical_neo_user:c.is_canonical_neo_user,thread_queue_enabled:c.thread_queue_enabled,folder:c.folder,unread_mentions_count:c.unread_mentions_count,has_viewer_archived:c.has_viewer_archived,is_page_follow_up:c.is_page_follow_up,is_page_unresponded_thread:c.is_page_unresponded_thread,cannot_reply_reason:c.cannot_reply_reason,can_viewer_report:c.can_viewer_report,composer_input_disabled:c.composer_input_disabled,ephemeral_ttl_mode:c.ephemeral_ttl_mode,customization_info:c.customization_info,thread_admins:c.thread_admins,approval_mode:c.approval_mode,joinable_mode:c.joinable_mode,thread_queue_metadata:c.thread_queue_metadata,event_reminders:c.event_reminders,montage_thread:c.montage_thread,last_read_receipt:c.last_read_receipt,related_page_thread:c.related_page_thread,rtc_call_data:c.rtc_call_data,associated_object:c.associated_object,reactions_mute_mode:c.reactions_mute_mode,mentions_mute_mode:c.mentions_mute_mode,privacy_mode:c.privacy_mode,customization_enabled:c.customization_enabled,thread_type:c.thread_type,group_thread_subtype:c.group_thread_subtype,thread_pin_timestamp:c.thread_pin_timestamp,page_unsubscribe_status:c.page_unsubscribe_status,participant_add_mode_as_string:c.participant_add_mode_as_string,participants_event_status:c.participants_event_status,marketplace_thread_data:c.marketplace_thread_data,page_comm_item:c.page_comm_item,group_approval_queue:c.group_approval_queue,admin_model_status_string:c.admin_model_status_string,groups_sync_status_string:c.groups_sync_status_string,work_groups_sync_metadata:c.work_groups_sync_metadata,pinned_messages:c.pinned_messages,description:c.description,joinable_link:c.joinable_link,linked_mentorship_programs:c.linked_mentorship_programs,theme:c.thread_theme,thread_connectivity_data:c.thread_connectivity_data,thread_unsendability_status:c.thread_unsendability_status,is_business_page_active:c.is_business_page_active,thread_associated_job_applications:c.thread_associated_job_applications,thread_associated_page_admin:c.thread_associated_page_admin,conversion_detection_data:c.conversion_detection_data,suggested_reply_data:c.suggested_reply_data};e=f.customization_info;var g;if(e==null)g=[null,null,null];else{var h=e.emoji;g=[o(e.outgoing_bubble_color),h==null?null:{emoji:h},m(e.participant_customizations)]}h=g[0];e=f.theme;if(e==null)h=[h,h,h,[],null,void 0,null,null];else{var p=e.reaction_pack,r;if(p==null)r=void 0;else{p=p.reaction_assets;r=p==null?void 0:p.nodes.map(function(a){return{reactionName:a.reaction_name,reactionEmoji:a.reaction_emoji,keyframeAssetUri:a.keyframe_asset_uri,staticAssetUri:a.static_asset.uri}})}p=e.gradient_colors.length;var s=n(e.fallback_color),t=b("FBID.bs").ofString(e.id);t=t!==void 0?b("bs_caml_option").valFromOption(t):null;if(p>0&&b("ChatConfig").get("chat_tab_has_gradients")){var u=e.gradient_colors.map(n);h=[s,b("bs_caml_array").get(u,0),b("bs_caml_array").get(u,p-1|0),u,t,r,e.accessibility_label,e.reverse_gradients_for_radial]}else h=[s,s,s,[],t,r,e.accessibility_label,e.reverse_gradients_for_radial]}p=f.page_comm_item;u=p==null?[null,null,null,null,null,[]]:[p.comm_status,p.comm_source_id,p.id,p.subtitle,p.comm_item_owners,p.comm_icon_type];s=f.last_message.nodes;t=s.length!==0?b("bs_caml_option").some(s[0]):void 0;r=f.last_read_receipt.nodes;e=r.length!==0?b("bs_caml_option").some(r[0]):void 0;if(t!==void 0){p=b("bs_caml_option").valFromOption(t);s=b("MessengerAttachmentTransformer.bs").transformAttachment(a,{extensible_attachment:p.extensible_attachment,blob_attachments:p.blob_attachments,sticker:p.sticker},p.message_id,d)}else s=[];if(t!==void 0){r=b("bs_caml_option").valFromOption(t).extensible_message_admin_text;if(r==null)p=null;else{d=r.game;p=d==null?null:d.id}}else p=null;r=b("MessengerThreadCannotReplyReason.bs").fromName(f.cannot_reply_reason);d=f.thread_key.other_user_id;if(d==null){var v=f.thread_key.thread_fbid;v=v==null?null:v}else v=d;d=b("bs_array").fold_left(function(a,c){a[c.id]=b("MessengerGroupAdminType").REGULAR_ADMIN;return a},{},f.thread_admins);d=b("bs_array").fold_left(function(a,c){var d=c.node.messaging_actor.id;c=c.admin_type;var e=b("bs_js_dict").get(a,d);!(c==null)&&e!==void 0&&(a[d]=c);return a},d,f.all_participants.edges);var w=f.thread_queue_metadata,x=f.thread_type,y=f.group_thread_subtype,z=f.montage_thread,A=f.image,B=f.square_image,C=f.thread_key.other_user_id,D;if(t!==void 0){var E=b("bs_caml_option").valFromOption(t).platform_xmd_encoded;if(E==null)D=!1;else{try{E=JSON.parse(E)}catch(a){E={}}E=b("bs_js_json").classify(E);D=typeof E==="number"||E.TAG!==2?!1:b("bs_js_dict").get(E._0,"landing_exp")!==void 0}}else D=!1;E=f.thread_queue_metadata;var F=f.event_reminders.nodes,G=f.name,H=f.associated_object,I;if(H==null)I=null;else{H=H.group_general_chat;I=H==null||v==null?null:H.id===v?b("MessengerObjectAssociationType").GENERAL_CHAT:b("MessengerObjectAssociationType").REGULAR_CHAT}H=f.rtc_call_data;var J;if(H==null)J=null;else{var K=H.initiator;J={call_state:H.call_state,server_info_data:H.server_info_data,initiator_fbid:K==null?null:b("bs_js_null_undefined").fromOption(b("FBID.bs").ofString(K.id))}}H=f.marketplace_thread_data;if(H==null)K=null;else{var L=H.for_sale_item,M;if(L==null)M=null;else{var N=L.formatted_price,O=L.location,P;if(O==null)P=null;else{O=O.reverse_geocode;P={reverse_geocode:O==null?null:{city:O.city,state:O.state}}}O=L.primary_photo;var Q;if(O==null)Q=null;else{O=O.image;Q=O==null?null:O.uri}O=L.product_item;var R=L.product_item;M={id:L.id,story_id:L.story_id,title:L.group_commerce_item_title,price:N==null?null:N.text,location:P,c2c_shipping_eligible:L.c2c_shipping_eligible,is_pending:L.is_pending,is_shipping_offered:L.is_shipping_offered,is_sold:L.is_sold,inventory_count:L.inventory_count,delivery_types:L.delivery_types,image_uri:Q,is_commerce_post_item:O==null?!1:O.is_commerce_post_item,product_item_id:R==null?null:R.id,url:L.url}}N=H.buyer;P=H.seller;Q=H.rating_state;O=H.seller;if(O==null)R=!1;else{L=O.marketplace_c2c_shipping_seller;R=L==null?!1:L.is_eligible}K={for_sale_item:M,buyer_fbid:N==null?null:N.id,seller_fbid:P==null?null:P.id,is_eligible_to_rate:Q==null?null:Q.is_eligible_to_rate,is_seller_eligible_for_shipping:R,seller_added_labels:H.seller_added_labels.map(function(a){return{label_string:a.label_string,label_type:a.label_type}}),eligible_profile_selling_invoice_actions:H.eligible_profile_selling_invoice_actions,thread_fbid:v}}O=f.group_approval_queue;L=f.work_groups_sync_metadata;if(L==null)M=null;else{N=L.fb_group;M=N==null?null:N}P=f.pinned_messages;Q=f.linked_mentorship_programs;R=f.thread_associated_job_applications;return{admins:d,approval_mode:f.approval_mode,approval_queue_ids:w==null?[]:w.approval_requests.nodes.map(function(a){return b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(a.id))}),can_reply:r===void 0,cannot_reply_reason:r!==void 0?r:null,can_viewer_report:f.can_viewer_report,composer_input_disabled:f.composer_input_disabled,solid_color:h[0],header_color:h[1],footer_color:h[2],accessibility_label:h[6],reverse_gradients_for_radial:h[7],gradient_colors:h[3],theme_id:h[4],reactions:h[5],thread_connectivity_data:f.thread_connectivity_data,custom_like_icon:g[1],custom_nickname:g[2],customization_enabled:f.customization_enabled,thread_type:x==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessagingThreadType"),x)),group_thread_subtype:y==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessengerGroupThreadSubType"),y)),page_unsubscribe_status:f.page_unsubscribe_status,participant_add_mode:f.participant_add_mode_as_string,ephemeral_ttl_mode:f.ephemeral_ttl_mode,folder:f.folder.toLowerCase(),has_email_participant:r!==void 0?r===b("MessengerThreadCannotReplyReason").HAS_EMAIL_PARTICIPANT:!1,has_montage:!(z==null),unread_mentions_count:f.unread_mentions_count,image_src:A==null?null:A.uri,square_image_src:B==null?null:B.uri,is_archived:f.has_viewer_archived,is_pinned:f.is_pinned,is_page_follow_up:f.is_page_follow_up,is_page_unresponded_thread:f.is_page_unresponded_thread,is_canonical_user:l(f),is_canonical:!(C==null),is_from_weak_entry_point:D,is_pin_protected:f.is_pin_protected,is_subscribed:f.is_viewer_subscribed,is_other_recipient_page:f.is_other_recipient_page,is_canonical_neo_user:f.is_canonical_neo_user,is_thread_queue_enabled:!(E==null),joinable_mode:{mode:b("bs_caml_format").caml_int_of_string(f.joinable_mode.mode),link:f.joinable_mode.link},last_message_timestamp:t!==void 0?b("bs_caml_format").caml_float_of_string(b("bs_caml_option").valFromOption(t).timestamp_precise):0,last_message_id:null,last_message_type:t!==void 0?b("bs_caml_option").valFromOption(t).commerce_message_type:null,last_message_admin_text_type:t!==void 0?b("bs_caml_option").valFromOption(t).extensible_message_admin_text_type:null,last_message_unsendability_status:t!==void 0?b("bs_caml_option").valFromOption(t).message_unsendability_status:null,last_read_timestamp:e!==void 0?b("bs_caml_format").caml_float_of_string(b("bs_caml_option").valFromOption(e).timestamp_precise):0,lightweight_event:F.length!==0?i(F[0]):null,lightweight_events:b("bs_array").fold_left(function(a,b){a[b.id]=i(b);return a},{},f.event_reminders.nodes),message_count:f.message_count,mute_until:f.mute_until,name:G==null?"":G,object_association_type:I,other_user_fbid:f.thread_key.other_user_id,page_thread_info:k(f),participants:f.all_participants.edges.map(function(a){return b("MercuryIDs").getParticipantIDFromUserID(a.node.messaging_actor.id)}),participants_event_status:f.participants_event_status,preloaded_participants:q(c),read_only:r!==void 0?r===b("MessengerThreadCannotReplyReason").READ_ONLY:!1,recipients_loadable:r!==void 0?r!==b("MessengerThreadCannotReplyReason").RECIPIENTS_NOT_LOADABLE:!0,server_timestamp:b("bs_caml_format").caml_float_of_string(f.updated_time_precise),snippet_attachments:s,snippet_sender:t!==void 0?b("MercuryIDs").getParticipantIDFromUserID(b("bs_caml_option").valFromOption(t).message_sender.messaging_actor.id):null,snippet:t!==void 0?b("bs_caml_option").valFromOption(t).snippet:null,thread_fbid:v,thread_id:"",thread_pin_timestamp:f.thread_pin_timestamp,timestamp:b("bs_caml_format").caml_float_of_string(f.updated_time_precise),unread_count:f.unread_count,rtc_call_data:J,marketplace_thread_data:K,associated_object:j(f),reactions_mute_mode:f.reactions_mute_mode==="REACTIONS_NOT_MUTED"?0:1,mentions_mute_mode:f.mentions_mute_mode==="MENTIONS_NOT_MUTED"?0:1,comm_status:u[0],page_comm_item_id:u[2],comm_source_id:u[1],subtitle:u[3],comm_item_owners:u[4],comm_icon_type:u[5],group_approval_queue:O==null?null:O.nodes,game_id:p,admin_model_status:b("MessengerGroupAdminModelStatus.bs").fromNullableString(f.admin_model_status_string),groups_sync_status:b("MessengerGroupsSyncStatus.bs").fromNullableString(f.groups_sync_status_string),work_associated_group:M,pinned_messages:P==null?null:P.map(function(c){var d=c.message;return{message_id:c.message_id,pinning_time:c.pinning_time,message:d==null?null:b("MessengerMessageTransformer.bs").transformMessage(a,d,{thread_id:null,thread_fbid:f.thread_key.thread_fbid,other_user_fbid:f.thread_key.other_user_id,folder:f.folder.toLowerCase()},!1)}}),description:f.description,joinable_link:f.joinable_link,linked_mentorship_programs:Q==null?null:Q,thread_unsendability_status:b("MessageThreadUnsendabilityStatus.bs").fromNullableString(f.thread_unsendability_status),is_business_page_active:f.is_business_page_active,thread_associated_job_applications:R==null?null:R,thread_associated_page_admin:f.thread_associated_page_admin,graphql_token:f.id,conversion_detection_data:f.conversion_detection_data,suggested_reply_data:f.suggested_reply_data}}f.getThreadFBID=a;f.getOtherUserID=c;f.getMessagePageInfo=d;f.getBlockedParticipant=e;f.transformParticipant=p;f.transformParticipants=q;f.transformReadReceipts=r;f.transformDeliveryReceipts=s;f.transformMessages=t;f.transformThread=u}),null);
__d("XGraphQLBatchAPIController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/api/graphqlbatch/",{queries:{type:"String"},batch_name:{type:"String"},scheduler:{type:"Enum",enumType:1},shared_params:{type:"String"},fb_api_req_friendly_name:{type:"String"},uft_request_id:{type:"String"}})}),null);
__d("WebGraphQL",["errorCode","ActorURI","AsyncRequest","DTSG","DTSG_ASYNC","Deferred","FBLogger","ODS","WebGraphQLConfig","XGraphQLBatchAPIController","getAsyncParams"],(function(a,b,c,d,e,f,g,h){"use strict";var i="for (;;);",j=i.length;function k(a){var b=a.getURIBuilder().getURI(),e={exec:function(a,b){return e.execAll([a],b)[0]},execAll:function(a,e){var f={},g={};a=a.map(function(a,b){b="o"+b;d("ODS").bumpEntityKey(281,"gql.webgraphql","id."+String(a.__getDocID()),1);f[b]={doc_id:a.__getDocID(),query_params:a.__getVariables()};a=new(c("Deferred"))();g[b]=a;return a.getPromise()});var h=babelHelpers["extends"]({},c("getAsyncParams")("POST"));e&&e.actorID!=null&&(h[d("ActorURI").PARAMETER_ACTOR]=e.actorID);var k=e&&e.batchName?{batch_name:e.batchName}:{};k=new(c("AsyncRequest"))().setURI(b).setOption("suppressEvaluation",!0).setMethod("POST").setRequestHeader("Content-Type","application/x-www-form-urlencoded").setData(babelHelpers["extends"]({},k,h,{queries:JSON.stringify(f)})).setHandler(function(a){a=a.getPayload();a=a.response;try{if(a.startsWith(i)){var b=a.substring(j);b=JSON.parse(b);if(b.error==1357001){Object.keys(g).forEach(function(a){g[a].isSettled()||g[a].reject({data:{},errors:[{message:"Not logged in.",severity:"CRITICAL",should_end_session:!0}]})});return}var e=b.dtsgToken;b=b.dtsgAsyncGetToken;e&&d("DTSG").setToken(e);b&&d("DTSG_ASYNC").setToken(b)}e=a.split("\r\n");e.pop();b=e.map(function(a){return JSON.parse(a)});b.forEach(function(a){return Object.keys(a).forEach(function(b){var c=g[b];if(c){b=a[b];if(b.extensions){var e;e=(e=b.extensions)==null?void 0:e.dtsg_token;e&&d("DTSG").setToken(e)}b.errors?c.reject(b):b.data?c.resolve(b.data):c.reject({data:{},errors:[{message:"Unexpected response received from server.",severity:"CRITICAL",response:b}]})}})})}catch(b){c("FBLogger")("webgraphql").catching(b).mustfix("Bad response: ","%s%s",a.substr(0,250),a.length>250?"[truncated]":"")}Object.keys(g).forEach(function(a){g[a].isSettled()||g[a].reject({data:{},errors:[{message:"No response received from server.",severity:"CRITICAL"}]})})}).setTimeoutHandler(c("WebGraphQLConfig").timeout,function(){Object.keys(g).forEach(function(a){g[a].isSettled()||g[a].reject({data:{},errors:[{message:"Request timed out.",severity:"CRITICAL"}]})})}).setErrorHandler(function(a){var b=a.getErrorDescription();Object.keys(g).forEach(function(c){g[c].isSettled()||g[c].reject({data:{},errors:[{message:b,severity:"CRITICAL",error:a.getError()}]})})});e&&e.msgrRegion&&k.setRequestHeader("X-MSGR-Region",e.msgrRegion);k.setAllowCrossPageTransition(!0);k.send();return a},__forController:k};return e}a=k(c("XGraphQLBatchAPIController"));b=a;g["default"]=b}),98);
__d("MessengerParticipantsFetcher.bs",["MessengerParticipantsWebGraphQLQuery","MessengerServerPayloadTransformer.bs","ODS","Promise","WebGraphQL"],(function(a,b,c,d,e,f){"use strict";function a(a){var c=new(b("MessengerParticipantsWebGraphQLQuery"))(a);return b("WebGraphQL").exec(c,{actorID:null,batchName:"MessengerParticipantsFetcher"})["catch"](function(a){b("ODS").bumpEntityKey(2966,"messenger_webgraphql","fetch_participants.failure");return b("Promise").reject(a)}).then(function(c){b("ODS").bumpEntityKey(2966,"messenger_webgraphql","fetch_participants.success");var d=[],e=new Set();c.messaging_actors.forEach(function(a){if(a==null)return;a=b("MessengerServerPayloadTransformer.bs").transformParticipant(a);e.add(a.fbid);d.push(a)});c=a.ids.filter(function(a){return!e.has(a)});c.length>0&&c.forEach(function(a){d.push(b("MessengerServerPayloadTransformer.bs").getBlockedParticipant(a))});return d})}f.$$fetch=a}),null);
__d("bs_js_int",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a===b}b=2147483647;c=-2147483648;f.equal=a;f.max=b;f.min=c}),null);
__d("bs_js_math",["bs_js_int"],(function(a,b,c,d,e,f){"use strict";function a(a){return Math.ceil(a)}function c(a){if(a>b("bs_js_int").max)return b("bs_js_int").max;else if(a<b("bs_js_int").min)return b("bs_js_int").min;else return Math.ceil(a)}function d(a){return Math.floor(a)}function g(a){if(a>b("bs_js_int").max)return b("bs_js_int").max;else if(a<b("bs_js_int").min)return b("bs_js_int").min;else return Math.floor(a)}function e(a,b){return g(Math.random()*(b-a|0))+a|0}var h=c,i=g;f.unsafe_ceil=a;f.ceil_int=c;f.ceil=h;f.unsafe_floor=d;f.floor_int=g;f.floor=i;f.random_int=e}),null);
__d("bs_belt_Array",["bs_caml","bs_caml_option","bs_curry","bs_js_math"],(function(a,b,c,d,e,f){"use strict";function a(a,c){if(c>=0&&c<a.length)return b("bs_caml_option").some(a[c])}function c(a,b){if(!(b>=0&&b<a.length))throw{RE_EXN_ID:"Assert_failure",_1:["belt_Array.ml",27,4],Error:new Error()};return a[b]}function d(a,b,c){if(b>=0&&b<a.length){a[b]=c;return!0}else return!1}function e(a,b,c){if(!(b>=0&&b<a.length))throw{RE_EXN_ID:"Assert_failure",_1:["belt_Array.ml",33,2],Error:new Error()};a[b]=c}function g(a,b,c){var d=a[b];a[b]=a[c];a[c]=d}function h(a){var c=a.length;for(var d=0;d<c;++d)g(a,d,b("bs_js_math").random_int(d,c))}function i(a){a=a.slice(0);h(a);return a}function j(a){var b=a.length,c=0;for(var d=0,e=b/2|0;d<e;++d)g(a,c+d|0,((c+b|0)-d|0)-1|0)}function k(a){var b=a.length,c=new Array(b);for(var d=0;d<b;++d)c[d]=a[(b-1|0)-d|0];return c}function l(a,b){if(a<=0)return[];var c=new Array(a);for(var d=0;d<a;++d)c[d]=b;return c}function m(a,b){if(a<=0)return[];var c=new Array(a);for(var d=0;d<a;++d)c[d]=b(d);return c}function n(a,c){return m(a,b("bs_curry").__1(c))}function o(a,b){a=m(a,b);h(a);return a}function p(a,c){return o(a,b("bs_curry").__1(c))}function q(a,b){b=b-a|0;if(b<0)return[];var c=new Array(b+1|0);for(var d=0;d<=b;++d)c[d]=a+d|0;return c}function r(a,b,c){b=b-a|0;if(b<0||c<=0)return[];b=(b/c|0)+1|0;var d=new Array(b);a=a;for(var e=0;e<b;++e)d[e]=a,a=a+c|0;return d}function s(a,b){var c=a.length,d=b.length;c=c<d?c:d;d=new Array(c);for(var e=0;e<c;++e)d[e]=[a[e],b[e]];return d}function t(a,b,c){var d=a.length,e=b.length;d=d<e?d:e;e=new Array(d);for(var f=0;f<d;++f)e[f]=c(a[f],b[f]);return e}function u(a,c,d){return t(a,c,b("bs_curry").__2(d))}function v(a,b){var c=a.length,d=b.length,e=new Array(c+d|0);for(var f=0;f<c;++f)e[f]=a[f];for(var a=0;a<d;++a)e[c+a|0]=b[a];return e}function w(a){var b=a.length,c=0;for(var d=0;d<b;++d)c=c+a[d].length|0;d=new Array(c);c=0;for(var e=0;e<b;++e){var f=a[e];for(var g=0,h=f.length;g<h;++g)d[c]=f[g],c=c+1|0}return d}function x(a,c,d){if(d<=0)return[];var e=a.length;c=c<0?b("bs_caml").caml_int_max(e+c|0,0):c;e=e-c|0;e=e<d?e:d;if(e<=0)return[];d=new Array(e);for(var f=0;f<e;++f)d[f]=a[c+f|0];return d}function y(a,c){var d=a.length;c=c<0?b("bs_caml").caml_int_max(d+c|0,0):c;d=d-c|0;var e=new Array(d);for(var f=0;f<d;++f)e[f]=a[c+f|0];return e}function z(a,c,d,e){if(d<=0)return;var f=a.length;c=c<0?b("bs_caml").caml_int_max(f+c|0,0):c;f=f-c|0;f=f<d?f:d;if(f<=0)return;for(var d=c,c=c+f|0;d<c;++d)a[d]=e}function A(a,b,c,d,e){if(d<=b){for(var f=0;f<e;++f)c[f+d|0]=a[f+b|0];return}for(var f=e-1|0;f>=0;--f)c[f+d|0]=a[f+b|0]}function B(a,c,d,e,f){var g=a.length,h=d.length;c=c<0?b("bs_caml").caml_int_max(g+c|0,0):c;e=e<0?b("bs_caml").caml_int_max(h+e|0,0):e;f=b("bs_caml").caml_int_min(f,b("bs_caml").caml_int_min(g-c|0,h-e|0));if(e<=c){for(var g=0;g<f;++g)d[g+e|0]=a[g+c|0];return}for(var h=f-1|0;h>=0;--h)d[h+e|0]=a[h+c|0]}function C(a,b){for(var c=0,d=a.length;c<d;++c)b(a[c])}function D(a,c){return C(a,b("bs_curry").__1(c))}function E(a,b){var c=a.length,d=new Array(c);for(var e=0;e<c;++e)d[e]=b(a[e]);return d}function F(a,c){return E(a,b("bs_curry").__1(c))}function G(a,c){var d=a.length,e=0,f;while(f===void 0&&e<d){var g=a[e];c(g)&&(f=b("bs_caml_option").some(g));e=e+1|0}return f}function H(a,c){return G(a,b("bs_curry").__1(c))}function I(a,b){var c=a.length,d=0,e;while(e===void 0&&d<c){var f=a[d];b(f)&&(e=d);d=d+1|0}return e}function aa(a,c){return I(a,b("bs_curry").__1(c))}function J(a,b){var c=a.length,d=new Array(c),e=0;for(var f=0;f<c;++f){var g=a[f];b(g)&&(d[e]=g,e=e+1|0)}d.length=e;return d}function ba(a,c){return J(a,b("bs_curry").__1(c))}function K(a,b){var c=a.length,d=new Array(c),e=0;for(var f=0;f<c;++f){var g=a[f];b(g,f)&&(d[e]=g,e=e+1|0)}d.length=e;return d}function ca(a,c){return K(a,b("bs_curry").__2(c))}function L(a,c){var d=a.length,e=new Array(d),f=0;for(var g=0;g<d;++g){var h=a[g];h=c(h);h!==void 0&&(e[f]=b("bs_caml_option").valFromOption(h),f=f+1|0)}e.length=f;return e}function da(a,c){return L(a,b("bs_curry").__1(c))}function M(a,b){for(var c=0,d=a.length;c<d;++c)b(c,a[c])}function ea(a,c){return M(a,b("bs_curry").__2(c))}function N(a,b){var c=a.length,d=new Array(c);for(var e=0;e<c;++e)d[e]=b(e,a[e]);return d}function fa(a,c){return N(a,b("bs_curry").__2(c))}function O(a,b,c){b=b;for(var d=0,e=a.length;d<e;++d)b=c(b,a[d]);return b}function ga(a,c,d){return O(a,c,b("bs_curry").__2(d))}function P(a,b,c){b=b;for(var d=a.length-1|0;d>=0;--d)b=c(b,a[d]);return b}function ha(a,c,d){return P(a,c,b("bs_curry").__2(d))}function Q(a,c,d,e){d=d;var f=b("bs_caml").caml_int_min(a.length,c.length);for(var f=f-1|0;f>=0;--f)d=e(d,a[f],c[f]);return d}function ia(a,c,d,e){return Q(a,c,d,b("bs_curry").__3(e))}function R(a,b,c){b=b;for(var d=0,e=a.length;d<e;++d)b=c(b,a[d],d);return b}function ja(a,c,d){return R(a,c,b("bs_curry").__3(d))}function S(a,b){var c=a.length,d=0;while(!0){var e=d;if(e===c)return!0;if(!b(a[e]))return!1;d=e+1|0;continue}}function ka(a,c){return S(a,b("bs_curry").__1(c))}function T(a,b){var c=a.length,d=0;while(!0){var e=d;if(e===c)return!1;if(b(a[e]))return!0;d=e+1|0;continue}}function la(a,c){return T(a,b("bs_curry").__1(c))}function U(a,b,c,d,e){while(!0){var f=c;if(f===e)return!0;if(!d(a[f],b[f]))return!1;c=f+1|0;continue}}function V(a,c,d){return U(a,c,0,d,b("bs_caml").caml_int_min(a.length,c.length))}function ma(a,c,d){return V(a,c,b("bs_curry").__2(d))}function W(a,c,d){var e=0,f=b("bs_caml").caml_int_min(a.length,c.length);while(!0){var g=e;if(g===f)return!1;if(d(a[g],c[g]))return!0;e=g+1|0;continue}}function na(a,c,d){return W(a,c,b("bs_curry").__2(d))}function X(a,b,c){var d=a.length,e=b.length;if(d===e)return U(a,b,0,c,d);else return!1}function oa(a,c,d){return X(a,c,b("bs_curry").__2(d))}function Y(a,b,c){var d=a.length,e=b.length;if(d>e)return 1;else if(d<e)return-1;else{e=0;while(!0){var f=e;if(f===d)return 0;var g=c(a[f],b[f]);if(g!==0)return g;e=f+1|0;continue}}}function pa(a,c,d){return Y(a,c,b("bs_curry").__2(d))}function Z(a,b){var c=a.length,d=0,e=0,f=new Array(c),g=new Array(c);for(var h=0;h<c;++h){var i=a[h];b(i)?(f[d]=i,d=d+1|0):(g[e]=i,e=e+1|0)}f.length=d;g.length=e;return[f,g]}function qa(a,c){return Z(a,b("bs_curry").__1(c))}function ra(a){var b=a.length,c=new Array(b),d=new Array(b);for(var e=0;e<b;++e){var f=a[e];c[e]=f[0];d[e]=f[1]}return[c,d]}function $(a,b,c){var d=a.length;if(d===0)return"";d=d-1|0;var e=0,f="";while(!0){var g=f,h=e;if(h===d)return g+c(a[h]);f=g+(c(a[h])+b);e=h+1|0;continue}}function sa(a,c,d){return $(a,c,b("bs_curry").__1(d))}f.get=a;f.getExn=c;f.set=d;f.setExn=e;f.shuffleInPlace=h;f.shuffle=i;f.reverseInPlace=j;f.reverse=k;f.make=l;f.range=q;f.rangeBy=r;f.makeByU=m;f.makeBy=n;f.makeByAndShuffleU=o;f.makeByAndShuffle=p;f.zip=s;f.zipByU=t;f.zipBy=u;f.unzip=ra;f.concat=v;f.concatMany=w;f.slice=x;f.sliceToEnd=y;f.fill=z;f.blit=B;f.blitUnsafe=A;f.forEachU=C;f.forEach=D;f.mapU=E;f.map=F;f.getByU=G;f.getBy=H;f.getIndexByU=I;f.getIndexBy=aa;f.keepU=J;f.keep=ba;f.keepWithIndexU=K;f.keepWithIndex=ca;f.keepMapU=L;f.keepMap=da;f.forEachWithIndexU=M;f.forEachWithIndex=ea;f.mapWithIndexU=N;f.mapWithIndex=fa;f.partitionU=Z;f.partition=qa;f.reduceU=O;f.reduce=ga;f.reduceReverseU=P;f.reduceReverse=ha;f.reduceReverse2U=Q;f.reduceReverse2=ia;f.reduceWithIndexU=R;f.reduceWithIndex=ja;f.joinWithU=$;f.joinWith=sa;f.someU=T;f.some=la;f.everyU=S;f.every=ka;f.every2U=V;f.every2=ma;f.some2U=W;f.some2=na;f.cmpU=Y;f.cmp=pa;f.eqU=X;f.eq=oa}),null);
__d("MessengerParticipants.bs",["fbt","CurrentUser","FBID.bs","ImmutableObject","MercuryAssert","MercuryIDs","MercuryParticipantTypes","MercuryVanityIDMap.bs","MessengerParticipantsFetcher.bs","ODS","Promise","bs_belt_Array","bs_caml_obj","bs_caml_option","bs_curry","bs_js_dict","bs_js_null_undefined","immutable"],(function(a,b,c,d,e,f,g){"use strict";var h={contents:1},i={},j=new Set(),k={},l=function(b,a){delete b[a];return 0},m=function(b,a){delete b[a];return 0};function n(a){if(b("CurrentUser").isWorkUser())return g._("Workplace user");else return g._("Facebook User")}function o(a){var c=a.user_type;if(c==null)return a;if(!(b("bs_caml_obj").caml_equal(c,b("MercuryParticipantTypes").USER)||b("bs_caml_obj").caml_equal(c,b("MercuryParticipantTypes").FRIEND)))return a;c=a.href;var d=a.vanity;if(!(c==null))return a;if(!(d==null))return a;c=n(void 0);return Object.assign(a,{name:c,short_name:c})}function a(a){Object.keys(i).forEach(function(a){return m(i,a)})}function p(a){var c=a.id,d=a.vanity;d==null||b("MercuryVanityIDMap.bs").set(d,c);d=b("bs_js_dict").get(i,c);d!==void 0?i[c]=b("ImmutableObject").set(b("bs_caml_option").valFromOption(d),a):i[c]=new(b("ImmutableObject"))(o(a))}function c(a){a=a.participants;if(!(a==null)){a.map(p);return}}function d(a){a=a.preloaded_participants;if(!(a==null)){a.map(p);return}}function q(a,c){var d={},e=[];a.forEach(function(a){var c=b("bs_js_dict").get(i,a);c!==void 0?d[a]=b("bs_caml_option").valFromOption(c):e.push(a)});if(e.length!==0){var f=[];e.forEach(function(a){if(j.has(a))return;var c=b("MercuryIDs").getUserIDFromParticipantID(a);if(!(c==null)){f.push(c);j.add(a);return}});var g=h.contents.toString();k[g]=[a,c];h.contents=h.contents+1|0;f.length>0&&b("MessengerParticipantsFetcher.bs").$$fetch({ids:f}).then(function(a){a.forEach(function(a){i[a.id]=new(b("ImmutableObject"))(a);var c=a.id;a=a.vanity;a==null||b("MercuryVanityIDMap.bs").set(a,c);j["delete"](c)});Object.keys(k).forEach(function(a){var d=b("bs_js_dict").get(k,a);if(d===void 0)return;var e=d[0],c={};e.forEach(function(a){var d=b("bs_js_dict").get(i,a);if(d!==void 0){c[a]=b("bs_caml_option").valFromOption(d);return}});if(Object.keys(c).length===e.length){l(k,a);return d[1](c)}});b("ODS").bumpEntityKey(2966,"messenger_webgraphql","fetch_participant.success");return b("Promise").resolve(void 0)})["catch"](function(a){b("ODS").bumpEntityKey(2966,"messenger_webgraphql","fetch_participant.failure");return b("Promise").resolve(void 0)});return g}c(d);return null}function e(a,c){b("MercuryAssert").isParticipantID(a);return q([a],function(d){d=b("bs_js_dict").get(d,a);if(d!==void 0)return b("bs_curry")._1(c,b("bs_caml_option").valFromOption(d))})}function r(a){return b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(i,a))}function s(c,d){var e=[],a=[];c.forEach(function(b){var c=r(b);c==null?e.push(b):a.push(c)});if(e.length===0)return[a,null];var f=q(e,function(a){return b("bs_curry")._1(d,b("bs_belt_Array").keepMap(c,function(a){return b("bs_caml_option").nullable_to_opt(r(a))}))});return[a,f]}function t(a,c){var d=function(a){return b("immutable").Map(a.map(function(a){return[a.id,a]}))},e=function(a){return b("bs_curry")._1(c,d(a))};a=s(a,e);return[d(a[0]),a[1]]}function u(a){return l(k,a)}function v(a){if(a==null)return null;if(b("MercuryVanityIDMap.bs").hasVanity(a)){var c=b("MercuryVanityIDMap.bs").getID(a);if(c==null)return null;else return c}c=/^\d+$/;if(!c.test(a))return null;c=b("FBID.bs").ofString(a);if(c!==void 0)return b("MercuryIDs").getParticipantIDFromUserID(b("bs_caml_option").valFromOption(c));else return null}f.reset=a;f.addParticipants=c;f.addPreloadedParticipants=d;f.getDefaultName=n;f.get=e;f.getNow=r;f.getMulti=q;f.getMultiEager=s;f.getMultiEagerMap=t;f.removeCallback=u;f.getIDFromVanityOrFBID=v}),null);
__d("ScotchRTCMWThreadDeltaHandler",["Arbiter","ChannelConstants","CurrentUser","MercuryIDs","MercurySyncDeltaTypes","MessengerParticipants.bs","ScotchRTCCallInitUtils","ScotchRTCGroupCallActions"],(function(a,b,c,d,e,f,g){"use strict";function a(a){c("Arbiter").subscribe(d("ChannelConstants").getArbiterType("delta"),function(b,e){b=e&&e.obj&&e.obj.queue;if(b&&b.toString()!==c("CurrentUser").getID())return;e=(b=e)!=null?(b=b.obj)!=null?b.delta:b:b;b=(b=e)!=null?(b=b.messageMetadata)!=null?(b=b.threadKey)!=null?b.threadFbId:b:b:b;if(!e||b!==a)return;switch(e["class"]){case c("MercurySyncDeltaTypes").ParticipantLeftGroupThread:d("ScotchRTCGroupCallActions").onParticipantLeft(e.leftParticipantFbId);break;case c("MercurySyncDeltaTypes").ParticipantsAddedToGroupThread:d("MessengerParticipants.bs").getMulti(e.addedParticipants.map(function(a){a=a.userFbId;return d("MercuryIDs").getParticipantIDFromUserID(a)}),d("ScotchRTCGroupCallActions").onParticipantsAdded);break}})}function b(a){var b=null;a=a.appMessages;a&&a.forEach(function(a){var c;c=(c=a)!=null?(c=c.body)!=null?(c=c.genericMessage)!=null?c.topic:c:c:c;a=(a=a)!=null?(a=a.body)!=null?(a=a.genericMessage)!=null?a.data:a:a:a;if(c==="thread_id_payload"&&a!=null){c=JSON.parse(a);if(c.thread_id!==null){b=c.thread_id;return}}});b&&d("ScotchRTCCallInitUtils").initializeThreadFromCollisionContext({groupThreadID:String(b),peerID:null})}g.initHandler=a;g.processThreadUpdateFromSignaling=b}),98);
__d("FBRTCDeviceStatus",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({OK:0,NOT_SUPPORTED:1,IN_ANOTHER_CALL:10})}),null);
__d("ScotchRTCAppData",["FacebookAppIDs","WorkplaceChatHelper"],(function(a,b,c,d,e,f,g){"use strict";function a(){return d("WorkplaceChatHelper").isDesktopChatApp()?this._getWorkplaceChatDesktopAppID():c("FacebookAppIDs").WWW}function b(){switch(h()){case c("FacebookAppIDs").MESSENGERDOTCOM.toString():return"messenger_dot_com";case c("FacebookAppIDs").WWW.toString():return"www";case c("FacebookAppIDs").WORKPLACE_DESKTOP.toString():return"workplace";case c("FacebookAppIDs").MESSENGER_DESKTOP_ARCHON_MACOS.toString():return"desktop_video_chat";case c("FacebookAppIDs").MESSENGER_DESKTOP_ARCHON_WINDOWS.toString():return"desktop_video_chat_for_windows";default:return"desktop"}}function e(){return d("WorkplaceChatHelper").getAppID()||c("FacebookAppIDs").WORKPLACE_DESKTOP}function h(){return c("FacebookAppIDs").MQTT_WEB.toString()}g.getAppID=a;g.getChannelManagerAppName=b;g._getWorkplaceChatDesktopAppID=e;g.getMWAppID=h}),98);
__d("ZenonScreenSharingConstants",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a="kMNScreenShareDataKeyUserId";c=b("$InternalEnum")({End:"kMNScreenShareDataEndScreenSharing",Start:"kMNScreenShareDataStartScreenSharing"});f.SCREEN_SHARE_DATA_USER_ID_KEY=a;f.ZenonScreenSharingDataMessageTopic=c}),66);
__d("ScotchFBRTCMultiwayMessage",["ChannelManager","CurrentUser","FBRTCMessageType","ScotchRTCAppData","ScotchRTCUtils","ZenonScreenSharingConstants"],(function(a,b,c,d,e,f,g){a=function(){function a(a){this.$1=a}var b=a.prototype;b.isRequest=function(){return this.$1.jsonPayload.header.responseStatusCode==null};b.isType=function(a){return this.type()==a};b.transactionId=function(){return this.$1.jsonPayload.header.transactionId};b.conferenceName=function(){return this.$1.jsonPayload.header.conferenceName};b.serverInfoData=function(){return this.$1.jsonPayload.header.serverInfoData};b.message=function(){return this.$1};b.type=function(){return this.header().type};b.endpoint=function(){return this.$1.endpoint};b.header=function(){return this.$1.jsonPayload.header};b.body=function(){return this.$1.jsonPayload.body};b.incrementRetryCount=function(){this.$1.jsonPayload.header.retryCount++};b.ringRequest=function(){return this.isRequest()&&this.isType(c("FBRTCMessageType").RING)?this.body().ringRequest:null};b.dismissRequest=function(){return this.isRequest()&&this.isType(c("FBRTCMessageType").DISMISS)?this.body().dismissRequest:null};b.serverMediaUpdateRequest=function(){return this.isRequest()&&this.isType(c("FBRTCMessageType").SERVER_MEDIA_UPDATE)?this.body().serverMediaUpdateRequest:null};b.conferenceStateRequest=function(){return this.isRequest()&&this.isType(c("FBRTCMessageType").CONFERENCE_STATE)?this.body().conferenceStateRequest:null};b.notifyRequest=function(){return this.isRequest()&&this.isType(c("FBRTCMessageType").NOTIFY)?this.body().notifyRequest:null};b.startScreenSharingRequest=function(){var a=this.genericDataMessage();if(a!=null&&a.topic===d("ZenonScreenSharingConstants").ZenonScreenSharingDataMessageTopic.Start){a=JSON.parse(atob(a.data));return a[d("ZenonScreenSharingConstants").SCREEN_SHARE_DATA_USER_ID_KEY]}return null};b.endScreenSharingRequest=function(){var a=this.genericDataMessage();if(a!=null&&a.topic===d("ZenonScreenSharingConstants").ZenonScreenSharingDataMessageTopic.End){a=JSON.parse(atob(a.data));return a[d("ZenonScreenSharingConstants").SCREEN_SHARE_DATA_USER_ID_KEY]}return null};b.genericDataMessage=function(){var a;return this.isRequest()&&this.isType(c("FBRTCMessageType").DATA_MESSAGE)?(a=this.body().dataMessageRequest)==null?void 0:(a=a.message)==null?void 0:(a=a.body)==null?void 0:a.genericMessage:null};b.createResponse=function(b,e){var f=e.body;e=e.callID;b={endpoint:{appId:d("ScotchRTCAppData").getMWAppID(),deviceId:d("ChannelManager").getCompleteConfig().sessionID,userId:c("CurrentUser").getID()},jsonPayload:{header:d("ScotchRTCUtils").createResponseHeader(this.header(),b,e?e:""),body:f||{}}};return new a(b)};return a}();g["default"]=a}),98);
__d("XGroupCallSendMessageController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/groupcall/sendmessage/",{av:{type:"FBID"},webrtc_fbtrace:{type:"Int"}})}),null);
__d("ScotchRTCMessageSender",["AsyncRequest","Promise","ScotchFBRTCMultiwayMessage","ScotchRTCLogger","XGroupCallSendMessageController"],(function(a,b,c,d,e,f,g){var h=6e3;a=function(){function a(){}var d=a.prototype;d.send=function(a){return new(b("Promise"))(function(b,d){var e=new(c("ScotchFBRTCMultiwayMessage"))(a);c("ScotchRTCLogger").getInstance().logSendingMultiwayMessage(e);var f=c("XGroupCallSendMessageController").getURIBuilder().getURI();f=new(c("AsyncRequest"))(f).setMethod("POST").setData({message:JSON.stringify(a)}).setAllowCrossPageTransition(!0).setHandler(function(a){c("ScotchRTCLogger").getInstance().logSentMultiwayMessage(e),b(a)}).setErrorHandler(function(a){c("ScotchRTCLogger").getInstance().logSendMultiwayMessageFailed(e);a=a.getErrorDescription();a=a!=null?a.toString():"AsyncRequest error";c("ScotchRTCLogger").getInstance().logSendMultiwayMessageFailure(a);d(Error(a))}).setTimeoutHandler(h,function(){c("ScotchRTCLogger").getInstance().logSendMultiwayMessageFailed(e),d("Timeout")});f.send()})};return a}();g["default"]=a}),98);
__d("ScotchFBRTCTransactions",["Promise","ScotchRTCMessageSender","ZenonDebugLogger","clearTimeout","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=6e4,i=Object.freeze({INIT:0,PROCESSING:1,COMPLETED:2,TERMINATED:3});a=function(){function a(){this.$1=new Map()}var b=a.prototype;b.findTransaction=function(a){return this.$1.get(a)};b.addTransaction=function(a){this.$1.set(a.id,a)};b.removeTransaction=function(a){this.$1["delete"](a.id)};b.getTransaction=function(a){return this.findTransaction(a.transactionId())||new j(this,a)};return a}();var j=function(){function a(a,b){this.id=b.transactionId(),this.$1=i.INIT,this.$2=b,this.$3=null,this.$4=a,this.$5=new Error("Unknown"),this.$6=null,this.$7=new(c("ScotchRTCMessageSender"))(),this.$8(),this.$4.addTransaction(this)}var d=a.prototype;d.start=function(){if(this.$1==i.INIT){this.$9(i.PROCESSING);return b("Promise").resolve(this.$2)}else if(this.$1==i.PROCESSING)return b("Promise").resolve(null);else if(this.$1==i.COMPLETED){this.$10();return b("Promise").resolve(null)}return b("Promise").reject(this.$5)};d.sendResponse=function(a){var b=this;this.$3=a;this.$9(i.COMPLETED);return this.$7.send(a.message()).then(function(a){},function(a){b.$5=a,b.$9(i.TERMINATED)})};d.$10=function(){if(this.$3!=null){var a=this.$3;a.incrementRetryCount();this.sendResponse(a)}};d.$9=function(a){a!=this.$1&&(this.$1=a,this.$1!=i.TERMINATED&&this.$8(),this.$1==i.TERMINATED&&(this.$5=new Error("Terminated"),this.$4.removeTransaction(this)))};d.$8=function(){var a=this;this.$6&&(c("clearTimeout")(this.$6),this.$6=null);this.$6=c("setTimeout")(function(){a.$9(i.TERMINATED)},h)};return a}();g.FBRTCTransactionOwner=a;g.FBRTCServerTransaction=j}),98);
__d("FBRTCCapability",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({SUPPORT_AUDIO_DEPRECATED:0,SUPPORT_VIDEO_DEPRECATED:1,SUPPORT_EXPERIMENTS_IN_JOIN_RESPONSE:2,SUPPORT_NEW_PARTICIPANT_STATES:3,SUPPORT_SDP_RENEGOTIATION:4,SUPPORT_MWPP:5,REQUIRE_FULL_SDP_IN_SMU:6,SUPPORT_PRECONNECT:7,SUPPORT_MWPP_DEESCALATION:8,SUPPORT_PARTICIPANT_STATE_UNCALLABLE:9,SUPPORT_MULTIPLE_VIDEO_STREAMS:10,REQUIRE_FULL_SDP_IN_SMU_OPTIMIZED:11})}),null);
__d("ScotchMWDeviceCapabilities",["FBRTCCapability","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){if(c("gkx")("1484828")){var a=[c("FBRTCCapability").SUPPORT_AUDIO_DEPRECATED,c("FBRTCCapability").SUPPORT_VIDEO_DEPRECATED,c("FBRTCCapability").SUPPORT_SDP_RENEGOTIATION];return a}else return[c("FBRTCCapability").SUPPORT_AUDIO_DEPRECATED,c("FBRTCCapability").SUPPORT_VIDEO_DEPRECATED]}g.getDeviceCapabilities=a}),98);
__d("ImageSourceType",[],(function(a,b,c,d,e,f){a=Object.freeze({PROFILE_PICTURE:"profile_picture",IMAGE:"image"});f["default"]=a}),66);
__d("CallbackManagerController",["ErrorGuard"],(function(a,b,c,d,e,f){var g;a=function(){function a(a){this.$2=[],this.$1=[void 0],this.$3=a}var c=a.prototype;c.executeOrEnqueue=function(a,b,c){c=Boolean(c)?c:{};var d=this.$4(b,a,c);if(d)return 0;this.$1.push({fn:b,request:a,options:c});d=this.$1.length-1;this.$2.push(d);return d};c.unsubscribe=function(a){delete this.$1[a]};c.reset=function(){this.$1=[]};c.getRequest=function(a){return this.$1[a]};c.runPossibleCallbacks=function(a){var b=this,c=this.$2;this.$2=[];var d=[];c.forEach(function(c){var e=b.$1[c];if(!e)return;e=b.$3(e.request,babelHelpers["extends"]({},e.options,a));e?d.push({args:e,id:c}):b.$2.push(c)});d.forEach(function(a){var c=a.args;a=a.id;var d=b.$1[a];if(!d)return;delete b.$1[a];b.$5(d.fn,c,d.request)})};c.$4=function(a,b,c){c=this.$3(b,c);c&&this.$5(a,c,b);return!!c};c.$5=function(a,c,d){d={ids:d};(g||(g=b("ErrorGuard"))).applyWithGuard(a,d,c)};return a}();f["default"]=a}),66);
__d("KeyedCallbackManager",["CallbackManagerController","FBLogger"],(function(a,b,c,d,e,f){a=function(){function a(){this.$2={},this.$1=new(b("CallbackManagerController"))(this.$3.bind(this))}var c=a.prototype;c.executeOrEnqueue=function(a,c){if(!(a instanceof Array)){var d=a,e=c;a=[a];c=function(a){e(a[d])}}a=a.filter(function(a){var c=a!==null&&a!==void 0;c||b("FBLogger")("KeyedCallbackManager").mustfix("KeyedCallbackManager.executeOrEnqueue: key %s is invalid",JSON.stringify(a));return c});return this.$1.executeOrEnqueue(a,c)};c.unsubscribe=function(a){this.$1.unsubscribe(a)};c.reset=function(){this.$1.reset(),this.$2={}};c.getUnavailableResources=function(a){var b=this;a=this.$1.getRequest(a);var c=[];a&&(c=a.request.filter(function(a){return!b.$2[a]}));return c};c.getUnavailableResourcesFromRequest=function(a){a=Array.isArray(a)?a:[a];return a.filter(function(a){if(a!==null&&a!==void 0)return!this.$2[a]},this)};c.addResourcesAndExecute=function(a){Object.assign(this.$2,a),this.$1.runPossibleCallbacks()};c.setResource=function(a,b){this.$2[a]=b,this.$1.runPossibleCallbacks()};c.getResource=function(a){return this.$2[a]};c.getAllResources=function(){return this.$2};c.dumpResources=function(){var a=this,b={};Object.keys(this.$2).forEach(function(c){var d=a.$2[c];typeof d==="object"&&(d=babelHelpers["extends"]({},d));b[c]=d});return b};c.$3=function(a){var b={};for(var c=0;c<a.length;c++){var d=a[c],e=this.$2[d];if(typeof e==="undefined")return!1;b[d]=e}return[b]};return a}();f["default"]=a}),66);
__d("MercuryMessagingLightswitch",["gkx"],(function(a,b,c,d,e,f,g){"use strict";a={guard:function(a){if(c("gkx")("1828242"))return;a()},shouldRun:function(){return!c("gkx")("1828242")}};b=a;g["default"]=b}),98);
__d("MercuryServerURIs",[],(function(a,b,c,d,e,f){"use strict";a="/ajax/mercury/thread_info.php";b="/ajax/mercury/mark_folder_as_read.php";c="/ajax/mercury/change_read_status.php";d="/ajax/mercury/mark_seen.php";e="/ajax/mercury/threadlist_info.php";var g="/ajax/mercury/mark_spam.php",h="/ajax/mercury/unmark_spam.php",i="/ajax/mercury/unread_threads.php",j="/ajax/mercury/change_pinned_status.php",k="/ajax/mercury/change_archived_status.php",l="/ajax/mercury/change_page_follow_up_status.php",m="/ajax/mercury/delete_thread.php",n="/ajax/mercury/delete_messages.php",o="/ajax/mercury/delivery_receipts.php",p="/ajax/mercury/move_thread.php",q="/ajax/mercury/change_mute_thread.php";f.THREAD_INFO=a;f.MARK_FOLDER_READ=b;f.CHANGE_READ_STATUS=c;f.MARK_SEEN=d;f.THREADLIST_INFO=e;f.MARK_SPAM=g;f.UNMARK_SPAM=h;f.UNREAD_THREADS=i;f.CHANGE_PINNED_STATUS=j;f.CHANGE_ARCHIVED_STATUS=k;f.CHANGE_PAGE_FOLLOW_UP_STATUS=l;f.DELETE_THREAD=m;f.DELETE_MESSAGES=n;f.DELIVERY_RECEIPTS=o;f.MOVE_THREAD=p;f.CHANGE_MUTE_THREAD=q}),66);
__d("areJSONRepresentationsEqual",[],(function(a,b,c,d,e,f){function a(a,b){return JSON.stringify(a)==JSON.stringify(b)}f["default"]=a}),66);
__d("MercuryServerDispatcher",["AsyncRequest","AsyncResponse","BanzaiLogger","Bootloader","ChatReliabilityInstrumentation","CurrentUser","FBIDCheck","LogHistory","MercuryMessagingLightswitch","MercuryServerURIs","MessagingTag","MessengerWebGraphQLTypedLogger","areJSONRepresentationsEqual","debounceAcrossTransitions","getByPath","performanceAbsoluteNow"],(function(a,b,c,d,e,f){"use strict";var g,h={},i=b("LogHistory").getInstance("mercury_server_dispatcher"),j=50,k=[],l=!1,m={IMMEDIATE:"immediate",IDEMPOTENT:"idempotent",BATCH_SUCCESSIVE:"batch-successive",BATCH_SUCCESSIVE_UNIQUE:"batch-successive-unique",BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR:"batch-successive-piggyback-retry",BATCH_DEFERRED_MULTI:"batch-deferred-multi",BATCH_CONDITIONAL:"batch-conditional",DEFAULT_ENDPOINT_ID:"mercuryServerDispatcherDefaultEndpointID",registerEndpoints:function(a){for(var c in a){var d=a[c],e=d.request_user_id||b("CurrentUser").getID(),f=d.endpoint_id||m.DEFAULT_ENDPOINT_ID;h[c]||(h[c]={});h[c][e]||(h[c][e]={});h[c][e][f]=new n(c,d)}},trySend:function(a,c,d,e,f){e=e||b("CurrentUser").getID(),f=f||m.DEFAULT_ENDPOINT_ID,h[a][e][f].trySend(c,d)},getRequestErrors:function(){return k}};function n(a,c){var d=c.mode||m.IMMEDIATE;switch(d){case m.IMMEDIATE:case m.IDEMPOTENT:case m.BATCH_SUCCESSIVE:case m.BATCH_SUCCESSIVE_UNIQUE:case m.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR:case m.BATCH_DEFERRED_MULTI:case m.BATCH_CONDITIONAL:break;default:throw new Error("Invalid MercuryServerDispatcher mode "+d)}this._endpoint=a;this._mode=d;this._customHeader=c.customHeader;this._requestUserID=c.request_user_id;this._combineData=c.batch_function;this._combineDataIf=c.batch_if;this._batches=[];this._handler=c.handler;this._errorHandler=c.error_handler;this._transportErrorHandler=c.transport_error_handler||c.error_handler;this._connectionRetries=c.connection_retries||0;this._timeoutHandler=c.timeout_handler;this._timeout=c.timeout;this._serverDialogCancelHandler=c.server_dialog_cancel_handler||c.error_handler;this._deferredSend=b("debounceAcrossTransitions")(this._batchSend,0,this)}Object.assign(n.prototype,{_inFlight:0,_handler:null,_errorHandler:null,_transportErrorHandler:null,_timeoutHandler:null,_timeout:null,_serverDialogCancelHandler:null,_combineData:null,trySend:function(a,b){if(l)return;a===void 0&&(a=null);b=b||this._mode;if(b==m.IMMEDIATE)this._send(a);else if(b==m.IDEMPOTENT)this._inFlight||this._send(a);else if(b==m.BATCH_SUCCESSIVE||b==m.BATCH_SUCCESSIVE_UNIQUE)!this._inFlight?this._send(a):this._batchData(a);else if(b==m.BATCH_CONDITIONAL){var c=this._batches[0]&&this._batches[0].getData();this._inFlight&&(this._combineDataIf(this._pendingRequestData,a)||this._combineDataIf(c,a))?this._batchData(a):this._send(a)}else b==m.BATCH_DEFERRED_MULTI?(this._batchData(a),this._deferredSend()):b==m.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR&&(this._batchData(a),this._inFlight||this._batchSend())},_send:function(a){var c=this;this._inFlight++;this._pendingRequestData=babelHelpers["extends"]({},a);this._requestUserID!=b("CurrentUser").getID()&&(a.request_user_id=this._requestUserID);b("MercuryMessagingLightswitch").guard(function(){i.log("send",JSON.stringify({endpoint:c._endpoint,inflight_count:c._inFlight}))});var d=(g||(g=b("performanceAbsoluteNow")))(),e=new(b("AsyncRequest"))(this._endpoint).setData(a).setOption("retries",this._connectionRetries).setAllowCrossPageTransition(!0);this._customHeader&&e.setRequestHeader(this._customHeader.name,this._customHeader.value);if(this._endpoint===b("MercuryServerURIs").THREADLIST_INFO){b("Bootloader").loadModules(["MessengerGraphQLThreadlistFetcher.bs","MercuryJewelBootloadModules"],function(f,g){var h=a.request_user_id||b("CurrentUser").getID(),d=a.request_user_id&&!b("FBIDCheck").isUser_deprecated(a.request_user_id);g=(g={},g[b("MessagingTag").INBOX]="INBOX",g[b("MessagingTag").OTHER]="OTHER",g[b("MessagingTag").ACTION_ARCHIVED]="ARCHIVED",g[b("MessagingTag").SPAM]="SPAM",g[b("MessagingTag").PENDING]="PENDING",g[b("MessagingTag").PAGE_BACKGROUND]="PAGE_BACKGROUND",g);var i=[],j=Object.keys(g);for(var k=0;k<j.length;k++){var l=j[k];if(Object.prototype.hasOwnProperty.call(a,l)){var m=a[l];i.push({limit:m.before?m.limit+1:m.limit,folder:l,tags:m.filter?[g[l],m.filter]:[g[l]],timestamp:m.before,filter:m.filter,includeDeliveryReceipts:!0,includeSeqID:!1,source:a.client})}}l=function(){f.fetchAll(h,i,d,"fetch_threadlist").done(function(a){a=new(b("AsyncResponse"))(e,babelHelpers["extends"]({},a,{payload_source:"server_fetch_threadlist_info"}));c._handleResponse(a)},function(a){c._handleGraphQLError("threadlist_failure",i,a,e)})};l()},"MercuryServerDispatcher");return}if(this._endpoint===b("MercuryServerURIs").THREAD_INFO){var f,h=(f=b("getByPath"))(a,["threads","user_ids"],[]),j=f(a,["threads","thread_fbids"],[]),k=f(a,["messages","user_ids"],{}),l=f(a,["messages","thread_fbids"],{}),m=a.request_user_id&&!b("FBIDCheck").isUser_deprecated(a.request_user_id);b("Bootloader").loadModules(["MessengerGraphQLThreadFetcher.bs"],function(d){var f=a.request_user_id||b("CurrentUser").getID(),g=Object.keys(k),i=g.map(function(b){var c=k[b].limit,d=k[b].timestamp;return{id:b,limit:d?c+1:c,loadReadReceipts:!0,loadDeliveryReceipts:!0,timestamp:d,isCanonical:!0,source:a.client}}),n=new Set(g);h.forEach(function(b){if(n.has(b))return;i.push({id:b,limit:0,loadReadReceipts:!1,loadDeliveryReceipts:!1,timestamp:null,isCanonical:!0,source:a.client})});g=Object.keys(l);var o=g.map(function(b){var c=l[b].limit,d=l[b].timestamp;return{id:b,limit:d?c+1:c,loadReadReceipts:!0,loadDeliveryReceipts:!0,timestamp:d,isCanonical:!1,source:a.client}}),p=new Set(g);j.forEach(function(b){if(p.has(b))return;o.push({id:b,limit:0,loadReadReceipts:!1,loadDeliveryReceipts:!1,timestamp:null,isCanonical:!1,source:a.client})});var q=[].concat(i,o);q.forEach(function(a){a.limit>21&&b("ChatReliabilityInstrumentation").logFETCHING_MANY_MESSAGES(JSON.stringify(a))});d.fetchAll(f,q,m).done(function(a){a=a.slice(0);if(a.length>0){var d={};a.forEach(function(a){return Object.assign(d,a.roger)});var f=[];a.forEach(function(a){return f.push.apply(f,a.delivery_receipts)});var g=[];a.forEach(function(a){return g=g.concat(a.actions)});g=g.filter(Boolean);a={actions:g,threads:a.map(function(a){return a.thread}).filter(Boolean),end_of_history:a.map(function(a){return a.end_of_history}).filter(Boolean),roger:d,delivery_receipts:f,payload_source:"server_fetch_thread_info"};a=new(b("AsyncResponse"))(e,a);c._handleResponse(a)}else c._handleResponse(new(b("AsyncResponse"))(e,{}))},function(a){c._handleGraphQLError("thread_failure",q,a,e)})},"MercuryServerDispatcher");return}e.setHandler(function(a){b("MercuryMessagingLightswitch").guard(function(){b("BanzaiLogger").log("ChatPerfLoggerConfig",{event:"async_request",duration:(g||(g=b("performanceAbsoluteNow")))()-d,endpoint:c._endpoint})}),c._handleResponse(a)}).setErrorHandler(this._handleError.bind(this)).setTransportErrorHandler(this._handleTransportError.bind(this)).setServerDialogCancelHandler(this._handleServerDialogCancel.bind(this));this._timeout&&this._timeoutHandler&&e.setTimeoutHandler(this._timeout,this._handleTimeout.bind(this));e.send()},_handleGraphQLError:function(a,c,d,e){var f=null,g=e.getData().retry_count;typeof d.toString==="function"&&(f=d.toString());if(typeof d.getRequest!=="function"){var h=d.errors&&d.errors[0];d=new(b("AsyncResponse"))(e,d);d.errorSummary=d.errors&&d.errors.map();d.errorDescription=h?h.message:null;f=h&&h.message?h.message:f;d.silentError=h&&h.is_silent;d.transientError=h&&h.is_transient}g||new(b("MessengerWebGraphQLTypedLogger"))().setErrorMessage(f).setEvent(a).setQueryParams(JSON.stringify(c)).log();this._handleError(d)},_batchData:function(a,c){var d=this;if(this._mode==m.BATCH_SUCCESSIVE_UNIQUE&&this._pendingRequestData!==void 0&&b("areJSONRepresentationsEqual")(a,this._pendingRequestData))return;else{var e=this._batches.length-1;e>=0?c?this._batches[e].combineWithOlder(a,this._combineData):this._batches[e].combineWith(a,this._combineData):this._batches.push(new o(a));b("MercuryMessagingLightswitch").guard(function(){i.debug("batch",JSON.stringify({endpoint:d._endpoint}))})}},_batchSend:function(){this._batches[0]&&(this._send(this._batches[0].getData()),this._batches.shift())},_handleResponse:function(a){var c=this;this._inFlight--;b("MercuryMessagingLightswitch").guard(function(){i.log("response",JSON.stringify({endpoint:c._endpoint,inflight_count:c._inFlight}))});var d=a.getPayload();l=d&&d.kill_chat;l&&b("MercuryMessagingLightswitch").guard(function(){i.log("killswitch_enabled",JSON.stringify({endpoint:c._endpoint,inflight_count:c._inFlight}))});d&&d.error_payload?this._errorHandler&&this._errorHandler(a):this._handler&&this._handler(d,a.getRequest());(this._mode==m.BATCH_SUCCESSIVE||this._mode==m.BATCH_SUCCESSIVE_UNIQUE||this._mode==m.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR||this._mode==m.BATCH_CONDITIONAL)&&this._batchSend();delete this._pendingRequestData},_createErrorRecord:function(a){return a instanceof b("AsyncResponse")?{endpoint:this._endpoint,user:this._requestUserID,time:Date.now(),code:a.getError(),description:a.getErrorDescriptionString(),summary:a.getErrorSummary(),isSilent:a.isSilent,isTransient:a.isTransient(),isBlockedAction:a.isBlockedAction(),isWarning:a.getErrorIsWarning(),payload:a.getPayload()}:{endpoint:this._endpoint,user:this._requestUserID,time:Date.now(),description:a.toString()}},_postErrorHandler:function(a){var c=this;this._inFlight--;b("MercuryMessagingLightswitch").guard(function(){i.error("error",JSON.stringify({endpoint:c._endpoint,inflight_count:c._inFlight,error:a instanceof b("AsyncResponse")?a.getError()+" "+a.getErrorDescription():a instanceof Error?a.toString():"Unknown"}))});k.push(this._createErrorRecord(a));k.length>j&&(k=k.slice(-1*j));var d=this._mode;d==m.BATCH_SUCCESSIVE||d==m.BATCH_SUCCESSIVE_UNIQUE||d==m.BATCH_CONDITIONAL?this._batchSend():d==m.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR&&(this._batches[0]?(this._batchData(this._pendingRequestData,!0),this._batchSend()):this._batchData(this._pendingRequestData,!0));delete this._pendingRequestData},_handleError:function(a){this._errorHandler&&this._errorHandler(a),this._postErrorHandler(a)},_handleTransportError:function(a){this._transportErrorHandler&&this._transportErrorHandler(a),this._postErrorHandler(a)},_handleTimeout:function(a){this._timeoutHandler&&this._timeoutHandler(a),this._postErrorHandler(new Error("Endpoint Timeout"))},_handleServerDialogCancel:function(a){this._serverDialogCancelHandler&&this._serverDialogCancelHandler(a),this._postErrorHandler(a)}});function o(a){this._data=a,this._size=1}Object.assign(o.prototype,{getData:function(){return this._data},getSize:function(){return this._size},combineWith:function(a,b){this._data=b(this._data,a),this._size++},combineWithOlder:function(a,b){this._data=b(a,this._data),this._size++}});e.exports=m}),null);
__d("ImageSourceRequest",["CurrentUser","ImageSourceType","KeyedCallbackManager","MercuryServerDispatcher"],(function(a,b,c,d,e,f){a=function(){"use strict";function a(){this._request={fbid:null,type:null,width:null,height:null,resize_mode:null},this._callback=null}var c=a.prototype;c.setFBID=function(a){this._request.fbid=a;return this};c.setType=function(a){if(![b("ImageSourceType").PROFILE_PICTURE,b("ImageSourceType").IMAGE].includes(a))throw new TypeError("ImageSourceRequest.setType: invalid type "+a);this._request.type=a;return this};c.setDimensions=function(a,b){this._request.width=a;this._request.height=b;return this};c.setResizeMode=function(a){if(!["p","s"].includes(a))throw new TypeError("ImageSourceRequest.setResizeMode: invalid resize mode "+a);this._request.resize_mode=a;return this};c.setCallback=function(a){this._callback=a;return this};c.send=function(){if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error("ImageSourceRequest: You must set all the fields");var a=h(),c=i(this._request);a.executeOrEnqueue(c,this._callback);if(a.getUnavailableResourcesFromRequest(c).length===1){b("MercuryServerDispatcher").trySend("/ajax/image_source.php",{requests:[this._request]});return!0}return!1};return a}();var g=null;function h(){if(g)return g;var a=new(b("KeyedCallbackManager"))();g=a;b("MercuryServerDispatcher").registerEndpoints({"/ajax/image_source.php":{request_user_id:b("CurrentUser").getID(),mode:b("MercuryServerDispatcher").BATCH_DEFERRED_MULTI,batch_function:function(a,b){var c;(c=a.requests).push.apply(c,b.requests);return a},handler:function(b,c){c=c.getData().requests;for(var d=0;d<c.length;++d)a.setResource(i(c[d]),b[d])}}});return a}function i(a){return[a.fbid,a.type,a.width,a.height,a.resize_mode].join("|")}e.exports=a}),null);
__d("PhotoResizeModeConst",[],(function(a,b,c,d,e,f){a=Object.freeze({CONTAIN:"s",COVER:"p"});f["default"]=a}),66);
__d("MessengerParticipantsImages.bs",["ImageSourceRequest","ImageSourceType","ImmutableObject","MercuryAssert","MercuryIDs","MercuryParticipantsConstants","MessengerParticipants.bs","PhotoResizeModeConst","bs_caml_option","bs_curry","bs_js_dict","bs_js_null_undefined"],(function(a,b,c,d,e,f){"use strict";function g(a,c,d){new(b("ImageSourceRequest"))().setFBID(b("bs_js_null_undefined").fromOption(b("bs_caml_option").nullable_to_opt(b("MercuryIDs").getUserIDFromParticipantID(a)))).setType(b("ImageSourceType").PROFILE_PICTURE).setDimensions(c,c).setResizeMode(b("PhotoResizeModeConst").COVER).setCallback(function(c){return b("bs_curry")._2(d,a,c)}).send()}function h(a,c,d,e){b("MercuryAssert").allParticipantIDs(a);var f={contents:!1},h=b("MessengerParticipants.bs").getMulti(a,function(e){var h={},i=function(d,e){h[d]=e;if(!f.contents&&a.length===Object.keys(h).length)return b("bs_curry")._1(c,h)},j=function(a,c){var d=b("bs_js_dict").get(e,a);d!==void 0&&(e[a]=b("ImmutableObject").set(b("bs_caml_option").valFromOption(d),{big_image_src:c.uri}));return i(a,c.uri)};Object.keys(e).map(function(a){return a}).forEach(function(a){var c=b("bs_js_dict").get(e,a);if(c===void 0)return g(a,d,j);c=b("bs_caml_option").valFromOption(c);var f=d===b("MercuryParticipantsConstants").BIG_IMAGE_SIZE?b("bs_caml_option").nullable_to_opt(c.big_image_src):void 0;if(f!==void 0)return i(c.id,f);else return g(a,d,j)})});return{remove:function(a){f.contents=!0;if(!(h==null))return b("MessengerParticipants.bs").removeCallback(h)}}}function i(a,c,d){return h(a,c,b("MercuryParticipantsConstants").BIG_IMAGE_SIZE,void 0)}function a(a,c){return i(a,function(d){return b("bs_curry")._1(c,a.map(function(a){return b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(d,a))}))},void 0)}function c(a,c,d){return h(a,function(d){return b("bs_curry")._1(c,a.map(function(a){return b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(d,a))}))},d,void 0)}f.getBigImageMultiWithSize=h;f.getBigImageMulti=i;f.getOrderedBigImageMulti=a;f.getOrderedBigImageMultiWithSize=c}),null);
__d("MessengerParticipantsImages.re",["MessengerParticipantsImages.bs","bs_curry"],(function(a,b,c,d,e,f){a=function(a,c){a=b("bs_curry")._4(b("MessengerParticipantsImages.bs").getBigImageMultiWithSize,a.ids,a.callback,a.size,c);return a};f.getBigImageMultiWithSize=a;c=function(a,c){a=b("bs_curry")._3(b("MessengerParticipantsImages.bs").getBigImageMulti,a.ids,a.callback,c);return a};f.getBigImageMulti=c;d=function(a,c){a=b("bs_curry")._2(b("MessengerParticipantsImages.bs").getOrderedBigImageMulti,a,c);return a};f.getOrderedBigImageMulti=d;e=function(a,c,d){a=b("bs_curry")._3(b("MessengerParticipantsImages.bs").getOrderedBigImageMultiWithSize,a,c,d);return a};f.getOrderedBigImageMultiWithSize=e}),null);
__d("ScotchRTCProxyUserActions",["ScotchRTCAppDispatcher"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("ScotchRTCAppDispatcher").dispatch({type:"SET_PROXY_USER_MAP",proxyUserID:a,proxyingAsUserID:b})}g.setProxyUsers=a}),98);
__d("ScotchRTCProxyUserReducer",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){switch(b.type){case"SET_PROXY_USER_MAP":var c=b.proxyUserID;b=b.proxyingAsUserID;if(!a.proxyUserToProxyingAs.has(c))return a.set("proxyingAsToProxyUser",a.proxyingAsToProxyUser.set(b,c)).set("proxyUserToProxyingAs",a.proxyUserToProxyingAs.set(c,b))}return a}f.setProxyUsers=a}),66);
__d("ScotchRTCProxyUserStoreState",["immutable"],(function(a,b,c,d,e,f,g){a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("immutable").Record({proxyingAsToProxyUser:c("immutable").Map(),proxyUserToProxyingAs:c("immutable").Map()}));g["default"]=a}),98);
__d("ScotchRTCProxyUserStore",["FluxReduceStore","ScotchRTCAppDispatcher","ScotchRTCProxyUserReducer","ScotchRTCProxyUserStoreState"],(function(a,b,c,d,e,f,g){"use strict";var h=[d("ScotchRTCProxyUserReducer").setProxyUsers];a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.reduce=function(a,b){return h.reduce(function(a,c){return c(a,b)},a)},b)||babelHelpers.assertThisInitialized(c)}var d=b.prototype;d.getInitialState=function(){return new(c("ScotchRTCProxyUserStoreState"))()};return b}(c("FluxReduceStore"));a.__moduleID=f.id;b=new a(c("ScotchRTCAppDispatcher"));g["default"]=b}),98);
__d("ScotchRTCProxyUserUtils",["ImmutableObject","MercuryIDs","ScotchRTCProxyUserActions","ScotchRTCProxyUserStore","ScotchRTWebUserActionLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.appMessages;if(a){var b=new Map();a.forEach(function(a){var e;e=(e=a)!=null?(e=e.body)!=null?(e=e.genericMessage)!=null?e.topic:e:e:e;a=(a=a)!=null?(a=a.body)!=null?(a=a.genericMessage)!=null?a.data:a:a:a;if(e==="aloha_proxying_as_users"&&a!=null){c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"Initializing_AlohaProxyingAsUsers"});e=JSON.parse(a);for(var f in e){a=e[f][0].id.toString();a&&(d("ScotchRTCProxyUserActions").setProxyUsers(f,a),b.set(f,a))}}});return b}return null}function b(a,b){for(var e in a){var f=a[e].fbid;if(b.has(f)){var g=a[e];f=b.get(f);var h=d("MercuryIDs").getParticipantIDFromUserID(f);g=c("ImmutableObject").setProperty(g,"fbid",f);g=c("ImmutableObject").setProperty(g,"id",h);a[h]=g}}return a}function e(a){var b=c("ScotchRTCProxyUserStore").getState();b=b.proxyUserToProxyingAs;return b.has(a)?b.get(a):a}g.setProxyingAsUsersFromMessage=a;g.transformProxyUserParticipantsToProxyingAs=b;g.getUserIDToFetch=e}),98);
__d("ScotchMultiwayParticipantFetcher",["ImmutableObject","MercuryIDs","MercuryParticipantsConstants","MessengerParticipants.bs","MessengerParticipantsImages.re","Promise","ScotchRTCProxyUserUtils","immutable","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,e){var f=a.map(function(a){return d("MercuryIDs").getParticipantIDFromUserID(a)});return new(b("Promise"))(function(a,b){try{d("MessengerParticipantsImages.re").getBigImageMultiWithSize({ids:f.toArray(),callback:function(b){a(c("immutable").fromJS(b))},size:e})}catch(a){b(a)}})}function i(a,e){var f=a.map(function(a){return d("MercuryIDs").getParticipantIDFromUserID(a)});return new(b("Promise"))(function(a,b){try{d("MessengerParticipants.bs").getMulti(f.toArray(),function(b){e&&e.proxyingAsToProxyUser!=null&&e.proxyingAsToProxyUser!==void 0&&e.proxyingAsToProxyUser.size>0&&(b=d("ScotchRTCProxyUserUtils").transformProxyUserParticipantsToProxyingAs(b,e.proxyingAsToProxyUser)),a(c("immutable").fromJS(b))})}catch(a){b(a)}})}function j(a,d){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(i(a,d));case 2:e=g.sent;if(!d.profileImageSize){g.next=8;break}g.next=6;return b("regeneratorRuntime").awrap(h(a,d.profileImageSize));case 6:f=g.sent;return g.abrupt("return",e.withMutations(function(a){f.forEach(function(b,d){var e=a.get(d);if(e){e=c("ImmutableObject").setProperty(e,"big_image_src",b);a.set(d,e)}})}));case 8:return g.abrupt("return",e);case 9:case"end":return g.stop()}},null,this)}function k(a){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:e=c("immutable").Set([a]);f=d("MercuryIDs").getParticipantIDFromUserID(a);h.next=4;return b("regeneratorRuntime").awrap(j(e,{profileImageSize:d("MercuryParticipantsConstants").WWW_INCALL_THUMBNAIL_SIZE}));case 4:g=h.sent;return h.abrupt("return",g.get(f));case 6:case"end":return h.stop()}},null,this)}function a(a,c){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.next=2;return b("regeneratorRuntime").awrap(k(c));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},null,this)}function e(a,c,d){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:d===void 0&&(d={});a.next=3;return b("regeneratorRuntime").awrap(j(c,d));case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}},null,this)}g.fetchParticipant=a;g.fetchAllParticipants=e}),98);
__d("ScotchRTCCallActions",["invariant","ScotchRTCAppDispatcher","ScotchRTCUtils","ScotchRTWebUserActionLogger","emptyFunction","mixInEventEmitter"],(function(a,b,c,d,e,f,g,h){"use strict";var i={addListener:c("emptyFunction"),emit:c("emptyFunction"),initialize:function(a){c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchRTCCallActions_initialize",callID:String(a.callID),conferenceName:a.conferenceName,callType:a.protocol==="p2p"?"p2p":"mw"}),c("ScotchRTCAppDispatcher").dispatch(babelHelpers["extends"]({type:"INIT"},a))},reset:function(){c("ScotchRTCAppDispatcher").dispatch({type:"RESET"})},resetForRedial:function(a,b){c("ScotchRTCAppDispatcher").dispatch({type:"RESET_FOR_REDIAL",conferenceName:a,callID:b})},callCollision:function(a,b){c("ScotchRTCAppDispatcher").dispatch({type:"CALL_COLLISION",conferenceName:a,peerID:b})},setCallSummary:function(a){c("ScotchRTCAppDispatcher").dispatch({type:"SET_CALL_SUMMARY",callSummary:a})},call:function(a,b){c("ScotchRTCAppDispatcher").dispatch({type:"CALL",usersToRing:a,peerConnection:b})},callSuccess:function(a){a===void 0&&(a=!1),c("ScotchRTCAppDispatcher").dispatch({type:"CALL_SUCCESS",connected:a})},incomingCallSuccess:function(){c("ScotchRTCAppDispatcher").dispatch({type:"INCOMING_CALL_SUCCESS"})},callError:function(a,b){c("ScotchRTCAppDispatcher").dispatch({type:"CALL_ERROR",endCallReason:d("ScotchRTCUtils").endCallReasonFromResponseStatusCode(a),endCallSubreason:"Call error: "+(a||0),responseSubCode:b})},completeTransitionToMultiway:function(){c("ScotchRTCAppDispatcher").dispatch({type:"GROUP_ESCALATION_CLEAR_P2P_CONNECTION"})},hangupSuccess:function(){c("ScotchRTCAppDispatcher").dispatch({type:"HANGUP_SUCCESS"})},hangupError:function(){c("ScotchRTCAppDispatcher").dispatch({type:"HANGUP_ERROR"})},join:function(a){i.call([],a)},hangup:function(a,b){c("ScotchRTCAppDispatcher").dispatch({type:"HANGUP",hangupReason:a,endCallReason:a,endCallSubreason:b})},initLocalUser:function(a){c("ScotchRTCAppDispatcher").dispatch({type:"INIT_LOCAL_USER",localUser:a})},initRemoteUsers:function(a){c("ScotchRTCAppDispatcher").dispatch({type:"INIT_REMOTE_USERS",remoteUsers:a})},updateRemoteUsers:function(a){c("ScotchRTCAppDispatcher").dispatch({type:"UPDATE_REMOTE_USERS",remoteUsers:a})},addLocalStream:function(a){a!=null||h(0,11208),c("ScotchRTCAppDispatcher").dispatch({type:"ADD_LOCAL_STREAM",stream:a})},removeLocalStream:function(a){c("ScotchRTCAppDispatcher").dispatch({type:"REMOVE_LOCAL_STREAM",stream:a})},replaceLocalStream:function(a,b){c("ScotchRTCAppDispatcher").dispatch({type:"REPLACE_LOCAL_STREAM",oldStream:a,newStream:b})},removeAllLocalStreams:function(a){a===void 0&&(a=!1),c("ScotchRTCAppDispatcher").dispatch({type:"REMOVE_ALL_LOCAL_STREAMS",stopStreams:a})},removeAllLocalScreenStreams:function(a){a===void 0&&(a=!1),c("ScotchRTCAppDispatcher").dispatch({type:"REMOVE_ALL_LOCAL_SCREEN_STREAMS",stopStreams:a})},addRemoteStream:function(a,b){c("ScotchRTWebUserActionLogger").logEvent({checkpoint:"ScotchRTCCallActions_addRemoteStream. Stream="+a.id}),c("ScotchRTCAppDispatcher").dispatch({type:"ADD_REMOTE_STREAM",stream:a,userID:b})},removeRemoteStream:function(a,b){c("ScotchRTWebUserActionLogger").logEvent({checkpoint:"ScotchRTCCallActions_removeRemoteStream. Stream="+a.id}),c("ScotchRTCAppDispatcher").dispatch({type:"REMOVE_REMOTE_STREAM",stream:a,userID:b})},removeAllRemoteStreams:function(a){c("ScotchRTWebUserActionLogger").logEvent({checkpoint:"ScotchRTCCallActions_removeAllRemoteStreams"}),c("ScotchRTCAppDispatcher").dispatch({type:"REMOVE_ALL_REMOTE_STREAMS",userID:a})},addRemoteTrack:function(a,b){c("ScotchRTWebUserActionLogger").logEvent({checkpoint:"ScotchRTCCallActions_addRemoteTrack. Track id ="+b.id+";stream id ="+a.id}),c("ScotchRTCAppDispatcher").dispatch({type:"ADD_REMOTE_TRACK",stream:a,track:b})},removeRemoteTrack:function(a,b){c("ScotchRTWebUserActionLogger").logEvent({checkpoint:"ScotchRTCCallActions_removeRemoteTrack. Track id ="+b.id+";stream id ="+a.id}),c("ScotchRTCAppDispatcher").dispatch({type:"REMOVE_REMOTE_TRACK",stream:a,track:b})},addLocalScreenStream:function(a){c("ScotchRTCAppDispatcher").dispatch({type:"ADD_LOCAL_SCREEN_STREAM",stream:a})},removeLocalScreenStream:function(a){c("ScotchRTCAppDispatcher").dispatch({type:"REMOVE_LOCAL_SCREEN_STREAM",stream:a})},replaceLocalScreenStream:function(a,b){c("ScotchRTCAppDispatcher").dispatch({type:"REPLACE_LOCAL_SCREEN_STREAM",oldStream:a,newStream:b})},addRemoteScreenStream:function(a,b){c("ScotchRTCAppDispatcher").dispatch({type:"ADD_REMOTE_SCREEN_STREAM",stream:a,userID:b})},removeRemoteScreenStream:function(a,b){c("ScotchRTCAppDispatcher").dispatch({type:"REMOVE_REMOTE_SCREEN_STREAM",stream:a,userID:b})},endCall:function(a,b){c("ScotchRTCAppDispatcher").dispatch({type:"END_CALL",endCallReason:a,endCallSubreason:b})},waitForUserInput:function(){c("ScotchRTCAppDispatcher").dispatch({type:"WAIT_FOR_USER_INPUT"})},toggleMuteAudio:function(a){c("ScotchRTCAppDispatcher").dispatch({type:a?"AUDIO_UNMUTED":"AUDIO_MUTED"})},toggleMuteVideo:function(a){c("ScotchRTCAppDispatcher").dispatch({type:a?"VIDEO_UNMUTED":"VIDEO_MUTED"})},stopLocalVideo:function(){c("ScotchRTCAppDispatcher").dispatch({type:"STOP_LOCAL_STREAM"})},toggleMuteRemoteVideo:function(a,b){c("ScotchRTCAppDispatcher").dispatch({type:a?"REMOTE_VIDEO_MUTED":"REMOTE_VIDEO_UNMUTED",userID:b})},toggleSelfView:function(a){c("ScotchRTCAppDispatcher").dispatch({type:a?"SELF_VIEW_COLLAPSED":"SELF_VIEW_UNCOLLAPSED"})},submitRating:function(a){c("ScotchRTCAppDispatcher").dispatch({type:"SUBMIT_RATING",rating:a})},submitFeedback:function(a){c("ScotchRTCAppDispatcher").dispatch({type:"SUBMIT_FEEDBACK",feedback:a})},submitFeedbackOptions:function(a){c("ScotchRTCAppDispatcher").dispatch({type:"SUBMIT_FEEDBACK_OPTIONS",feedbackOptions:a})},submitSurveyChoice:function(a){c("ScotchRTCAppDispatcher").dispatch({type:"SUBMIT_SURVEY_CHOICE",surveyChoice:a})},ratingShown:function(){c("ScotchRTCAppDispatcher").dispatch({type:"RATING_SHOWN"})},feedbackShown:function(){c("ScotchRTCAppDispatcher").dispatch({type:"FEEDBACK_SHOWN"})},setEndCallReason:function(a){c("ScotchRTCAppDispatcher").dispatch({type:"SET_END_CALL_REASON",endCallReason:a})},setConferenceState:function(a){c("ScotchRTCAppDispatcher").dispatch({type:"SET_CONFERENCE_STATE",conferenceState:a})}};c("mixInEventEmitter")(i,{onIceConnectionStateChange:!0});a=i;g["default"]=a}),98);
__d("FBRTCCallSummaryPageVisibilityObserver",["FBRTCLogger","Visibility"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){var a=this;this.$1=new Map();c("Visibility").isSupported()&&(c("Visibility").addListener(c("Visibility").HIDDEN,function(){a.$1.forEach(function(a){a.addExtraInfo(c("FBRTCLogger").Key.APPLICATION_STATE,c("Visibility").HIDDEN)})}),c("Visibility").addListener(c("Visibility").VISIBLE,function(){a.$1.forEach(function(a){a.addExtraInfo(c("FBRTCLogger").Key.APPLICATION_STATE,c("Visibility").VISIBLE)})}))}var b=a.prototype;b.onCallStart=function(a){this.$1.set(a.callID,a),c("Visibility").isSupported()&&a.addExtraInfo(c("FBRTCLogger").Key.APPLICATION_STATE,c("Visibility").VISIBLE)};b.onCallEnd=function(a){this.$1["delete"](a.callID)};return a}();b=new a();g["default"]=b}),98);
__d("ScotchFBRTCCallSummaryReducer",["FBRTCCallSummaryPageVisibilityObserver","ScotchFBRTCCallSummaryStore","ScotchRTCCallStore","ScotchRTCLogger","ScotchRTWebUserActionLogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(b.type){case"SET_CALL_SUMMARY":return a.set("callSummary",b.callSummary)}return a}function b(a,b){switch(b.type){case"INCOMING_CALL_SUCCESS":case"CALL_SUCCESS":b=function b(){var d=c("ScotchRTCCallStore").getState().callInfo,e=d.conferenceState;d=d.callID;e!=="TERMINATED"&&a.callInfo.callID===d&&(a.callSummary.save(c("ScotchFBRTCCallSummaryStore").getInstance()),window.setTimeout(b,1e4))};b();c("FBRTCCallSummaryPageVisibilityObserver").onCallStart(a.callSummary);return a}return a}function d(a,b){switch(b.type){case"ON_JOIN_REQUEST_SENT":a.callSummary.setJoinRequestSent();a.callSummary.save(c("ScotchFBRTCCallSummaryStore").getInstance());return a;case"ON_RECEIVED_JOIN_RESPONSE":a.callSummary.setJoinResponseReceived();a.callSummary.save(c("ScotchFBRTCCallSummaryStore").getInstance());return a;case"ON_JOIN_RESPONSE":a.callSummary.setServerInfoData(b.serverInfoData);a.callSummary.save(c("ScotchFBRTCCallSummaryStore").getInstance());return a;case"ON_PROCESSED_JOIN_RESPONSE":a.callSummary.setJoinResponseProcessed();a.callSummary.save(c("ScotchFBRTCCallSummaryStore").getInstance());return a}return a}function e(a,b){var d=c("ScotchFBRTCCallSummaryStore").getInstance();switch(b.type){case"CALL_ERROR":case"HANGUP":case"END_CALL":c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchFBRTCCallSummaryReducer_onCallEnded: "+JSON.stringify({reason:b.endCallReason,subreason:b.endCallSubreason,type:b.type})});a.callSummary.onCallEnded(b.endCallReason,!1,!1,b.endCallSubreason);a.callSummary.save(d);c("FBRTCCallSummaryPageVisibilityObserver").onCallEnd(a.callSummary);if(c("gkx")("1369511")&&a.callInfo.protocol!=="p2p"){c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchFBRTCCallSummaryReducer_onCallEnded: Uploading ECS for Rooms call"});a.callSummary.logThisSummary(d,!0);return a["delete"]("callSummary")}return a;case"DISMISS":c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchFBRTCCallSummaryReducer_onCallEnded: "+JSON.stringify({reason:b.endCallReason,subreason:b.endCallSubreason,type:b.type})});a.callSummary.onCallEnded(b.endCallReason,!0,!1,b.endCallSubreason);a.callSummary.save(d);c("FBRTCCallSummaryPageVisibilityObserver").onCallEnd(a.callSummary);if(c("gkx")("1369511")&&a.callInfo.protocol!=="p2p"){c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchFBRTCCallSummaryReducer_onCallEnded: Uploading ECS for Rooms call"});a.callSummary.logThisSummary(d,!0);return a["delete"]("callSummary")}return a}return a}function f(a,b){switch(b.type){case"RATING_SHOWN":a.callSummary.addExtraInfo(c("ScotchRTCLogger").Key.RATING_SHOWN,"1");a.callSummary.save(c("ScotchFBRTCCallSummaryStore").getInstance());return a;case"FEEDBACK_SHOWN":a.callSummary.addExtraInfo(c("ScotchRTCLogger").Key.SURVEY_SHOWN,"1");a.callSummary.save(c("ScotchFBRTCCallSummaryStore").getInstance());return a;case"SUBMIT_RATING":a.callSummary.addExtraInfo(c("ScotchRTCLogger").Key.RATING,b.rating);a.callSummary.save(c("ScotchFBRTCCallSummaryStore").getInstance());return a;case"SUBMIT_FEEDBACK":a.callSummary.addExtraInfo(c("ScotchRTCLogger").Key.SURVEY_DETAILS,b.feedback);a.callSummary.save(c("ScotchFBRTCCallSummaryStore").getInstance());return a;case"SUBMIT_SURVEY_CHOICE":a.callSummary.addExtraInfo(c("ScotchRTCLogger").Key.SURVEY_CHOICE,b.surveyChoice);a.callSummary.save(c("ScotchFBRTCCallSummaryStore").getInstance());return a}return a}g.setCallSummary=a;g.onCallStarted=b;g.onMessageSignaling=d;g.onCallEnded=e;g.onSurveyResult=f}),98);
__d("ZenonCumulativeMediaStat",["performanceNow"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.$3=this.$5=this.$1=a,this.$7=this.$8=a,this.$9=!1,this.$4=this.$6=this.$2=c("performanceNow")(),this.$10=1}var b=a.prototype;b.$11=function(a){this.$5=this.$1,this.$6=this.$2,this.$1=a,this.$2=c("performanceNow")(),this.$10++};b.update=function(a){this.$7=this.$8;this.$8=a;a=this.$8-this.$7;a<0?(a=this.$8,this.$9=!0):this.$9=!1;this.$11(this.$1+a)};b.updateNonStrictCumulative=function(a){this.$7=this.$8,this.$8=a,this.$9=!1,this.$11(a)};b.isReset=function(){return this.$9};b.getCurrentValue=function(){return this.$1};b.getDeltaValue=function(){return this.$1-this.$3};b.getDeltaFromLastUpdate=function(){return this.$1-this.$5};b.getTimeSinceLastUpdate=function(){return this.$2-this.$6};b.getElapsedTime=function(){return this.$2-this.$4};b.getPreviousTime=function(){return this.$6};b.getCurrentTime=function(){return this.$2};b.getAverageOverTime=function(){return this.getDeltaValue()/this.getElapsedTime()};b.getCurrentTimeSinceLastUpdate=function(){return c("performanceNow")()-this.$2};b.getCount=function(){return this.$10};b.getFirstValue=function(){return this.$3};return a}();g["default"]=a}),98);
__d("percentile",[],(function(a,b,c,d,e,f){function g(a,b){return(a||0)-(b||0)}function a(a,b){return h(a.slice().sort(g),b)}function h(a,b){b=(a.length-1)*b;var c=Math.floor(b),d=Math.ceil(b);if(c===d)return a[b];var e=a[c]*(d-b);a=a[d]*(b-c);return e+a}e.exports=a;e.exports.fromSorted=h}),null);
__d("median",["percentile"],(function(a,b,c,d,e,f){function a(a){return b("percentile")(a,.5)}e.exports=a}),null);
__d("ZenonDeltaMediaStat",["median"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=[],this.$2=0,this.$3=null}var b=a.prototype;b.add=function(a){this.$1.push(a),this.$2++,this.$3=a};b.getLastAddedValue=function(){return this.$3};b.getTotal=function(){var a=this.$1.reduce(function(a,b){return a+b},0);return a};b.getCount=function(){return this.$1.length};b.getAverage=function(){return this.getTotal()/this.getCount()};b.getMin=function(){return Math.min.apply(Math,this.$1)};b.getMax=function(){return Math.max.apply(Math,this.$1)};b.getMedian=function(){return c("median")(this.$1)};return a}();g["default"]=a}),98);
__d("ZenonSimulcastStats",[],(function(a,b,c,d,e,f){"use strict";b=function(){function a(){this.$1=0,this.$2=new Map(),this.$3=new Map()}var b=a.prototype;b.update=function(a){a=g(a,this.$2,this.$3);var b=0;for(var c=a,d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=c.length)break;f=c[e++]}else{e=c.next();if(e.done)break;f=e.value}f=f;f[0];f=f[1];f&&b++}if(this.$3.size===0)b>0&&this.$1++;else{f=!1;for(var e=a,d=Array.isArray(e),c=0,e=d?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(d){if(c>=e.length)break;b=e[c++]}else{c=e.next();if(c.done)break;b=c.value}b=b;var h=b[0];b=b[1];(!this.$3.has(h)||this.$3.get(h)!==b)&&(f=!0)}f&&this.$1++}this.$3=a};b.getNumLayerChanges=function(){return this.isSimulcastCall()?this.$1:0};b.isSimulcastCall=function(){return this.$3.size>1};return a}();function g(a,b,c){var d=new Map();for(var a=a.values(),e=Array.isArray(a),f=0,a=e?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=a.length)break;g=a[f++]}else{f=a.next();if(f.done)break;g=f.value}g=g;if(g.ssrc===void 0||g.framesSent===void 0)continue;var h=String(g.ssrc);g=Number(g.framesSent);if(b.has(h)){var i=b.get(h);i!==void 0&&d.set(h,g>i)}else d.set(h,g>0);b.set(h,g)}for(var i=c,h=Array.isArray(i),g=0,i=h?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(h){if(g>=i.length)break;f=i[g++]}else{g=i.next();if(g.done)break;f=g.value}e=f;a=e[0];e[1];d.has(a)||d.set(a,!1)}return d}function a(a){if(a.length===1)return a[0];var b=null,c=null,d=0;for(var e=0;e<a.length;e++){var f=a[e];if(f.frameWidth){var g=Number(f.frameWidth),h=!1;(c==null||g<c)&&(c=g,h=!0);var i=!1;if(f.framesEncoded){var j=Number(f.framesEncoded);j>d&&(i=!0,d=j)}(h||g===c&&i)&&(b=f)}}return b}f.ZenonSimulcastStats=b;f.getBaseLayerReport=a}),66);
__d("ZenonVideoScaleHistogram",[],(function(a,b,c,d,e,f){"use strict";function g(a){if(a>=.765625)return 0;else if(a>=.390625)return 1;else if(a>=.19140625)return 2;else if(a>=.09765625)return 3;return 4}function a(a,b){var c=["video","screen"];a.filter(function(a){return c.includes(a.contentType)&&a.remote===!1}).forEach(function(a){a=b.get(a.trackId);if(!a||!a.cumulativeStat||!a.histResScale)return;var c=a.cumulativeStat,d=c.framesEncoded;c=c.tracktimestamp;var e=a.deltaStat,f=e.frameHeight,h=e.frameWidth,i=e.height;e=e.width;if(d!=null&&e!=null&&i!=null&&h!=null&&f!=null&&d.getDeltaFromLastUpdate()>0&&c.getCurrentValue()>a.lastUpdate){c=d.getDeltaFromLastUpdate();d=((d=e.getLastAddedValue())!=null?d:0)*((e=i.getLastAddedValue())!=null?e:0);h=((i=h.getLastAddedValue())!=null?i:0)*((e=f.getLastAddedValue())!=null?e:0);if(d>0){i=h/d;f=g(i);a.histResScale[f]+=c}}})}f.getBinFromScale=g;f.updateTrackerWithScaleHistogram=a}),66);
__d("ZenonMediaStatsParser",["ZenonCumulativeMediaStat","ZenonDeltaMediaStat","ZenonMediaStatsConfig","ZenonSimulcastStats","ZenonVideoScaleHistogram","isTruthy","performanceNow"],(function(a,b,c,d,e,f,g){"use strict";var h=["inbound-rtp","outbound-rtp","track","media-source","candidate-pair"];function i(a,b){var c=new Map();b.forEach(function(b,d){(b.type==="ssrc"&&b.googTrackId!=null&&b.googTrackId===a.trackId||b.type==="VideoBwe"||b.type==="googCandidatePair"&&b.googActiveConnection==="true"&&b.googRtt!=null)&&c.set(d,b)});return c}function a(a){var b=new Map();for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;var f=e[0];e=e[1];h.includes(e.type)&&b.set(f,e)}return b}function j(a,b){var e=b.contentType,f=b.remote;b=b.trackId;var g=a.get(b);g==null&&(g={codec:null,contentType:e,cumulativeStat:{},deltaStat:{},duration:0,histResScale:new Array(d("ZenonVideoScaleHistogram").getBinFromScale(0)+1).fill(0),lastUpdate:0,maxTotalDecodeTime:0,percentStat:{},remote:f,startTime:c("performanceNow")()},a.set(b,g));return g}function k(a){return d("ZenonMediaStatsConfig").CUMULATIVE_STATS.includes(a)}function l(a){return d("ZenonMediaStatsConfig").DELTA_STATS.includes(a)}function b(a){if(a instanceof Map)return a;var b=new Map();if(a.result)for(var c=a.result(),d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=c.length)break;f=c[e++]}else{e=c.next();if(e.done)break;f=e.value}f=f;var g={id:f.id,timestamp:f.timestamp,type:f.type};for(var h=f.names(),i=Array.isArray(h),j=0,h=i?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k;if(i){if(j>=h.length)break;k=h[j++]}else{j=h.next();if(j.done)break;k=j.value}k=k;g[k]==null&&(g[k]=f.stat(k))}b.set(g.id,g)}else for(var k=a.values(),j=Array.isArray(k),i=0,k=j?k:k[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(j){if(i>=k.length)break;h=k[i++]}else{i=k.next();if(i.done)break;h=i.value}f=h;b.set(f.id,f)}return b}function e(a,b,c){c=i(a,c);for(var c=c.values(),d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=c.length)break;f=c[e++]}else{e=c.next();if(e.done)break;f=e.value}f=f;var g=j(b,a);p(a,g,f);f=n(f);f!=null&&(g.codec=f)}}function f(a,b,c){var e=null,f=[];for(var c=c.values(),g=Array.isArray(c),h=0,c=g?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=c.length)break;i=c[h++]}else{h=c.next();if(h.done)break;i=h.value}i=i;i.type==="outbound-rtp"&&i.trackId&&(e=j(b,a),typeof i.trackId==="string"&&(e.sender=i.trackId));switch(i.type){case"inbound-rtp":e=j(b,a);q(e,i,d("ZenonMediaStatsConfig").getInboundRtpStats().concat(d("ZenonMediaStatsConfig").getRtpStats()));break;case"outbound-rtp":i.kind==="video"?f.push(i):(e=j(b,a),q(e,i,d("ZenonMediaStatsConfig").getOutboundRtpStats().concat(d("ZenonMediaStatsConfig").getRtpStats())));break;case"media-source":e=j(b,a);q(e,i,d("ZenonMediaStatsConfig").getMediaSourceStats());break;case"track":e=j(b,a);q(e,i,d("ZenonMediaStatsConfig").getTrackStats());break;case"candidate-pair":e=j(b,a);q(e,i,d("ZenonMediaStatsConfig").getCandidatePairStats());break;case"codec":var k=String(i.mimeType).split("/")[1];k!=null&&k!==""&&(e=j(b,a),o(e,k));break;case"local-candidate":e=j(b,a);e.localIceCandidateStats=s(i);break;case"remote-candidate":e=j(b,a);e.remoteIceCandidateStats=s(i);break;default:break}}if(f.length>0){e=j(b,a);r(e,f);k=d("ZenonSimulcastStats").getBaseLayerReport(f);k!=null&&q(e,k,d("ZenonMediaStatsConfig").getOutboundRtpStats().concat(d("ZenonMediaStatsConfig").getRtpStats()))}}function m(a,b,c){b=j(b,a);if(typeof c.getParameters==="function"){c=c.getParameters();c=c.encodings;var d=b.audioEncoding,e=b.videoEncoding;if(Array.isArray(c)){c=c.some(function(a){return a.active});a.contentType==="audio"?!d?b.audioEncoding={enabled:c,prevState:null}:(d.prevState=d.enabled,d.enabled=c):!e?b.videoEncoding={enabled:c,prevState:null}:(e.prevState=e.enabled,e.enabled=c)}}}function n(a){var b=null;a.googCodecName!=null&&a.googCodecName!==""&&(b=String(a.googCodecName),a.codecImplementationName!=null&&(b+=String(a.codecImplementationName)));return b}function o(a,b){a.startTime==null&&(a.startTime=c("performanceNow")());var d=a.startTime;a.codecHistory==null&&(a.codecHistory=[]);b.length>0&&(a.codecHistory.length===0||a.codecHistory[a.codecHistory.length-1].codec!==b)&&a.codecHistory.push({codec:b,updateTime:c("performanceNow")()-d});a.codec=b}function p(a,b,e){Object.entries(e).forEach(function(f){var g=f[0];f=Number(f[1]);if(e.type==="ssrc"&&d("ZenonMediaStatsConfig").STATS_REQUESTED.includes(g)&&d("ZenonMediaStatsConfig").getSsrcStats().includes(g)||e.type==="VideoBwe"&&d("ZenonMediaStatsConfig").getVideoBweStats().includes(g)&&a.contentType!=="audio"&&a.remote===!1||e.type==="googCandidatePair"&&d("ZenonMediaStatsConfig").getGoogCandidatePairStats().includes(g))if(d("ZenonMediaStatsConfig").CUMULATIVE_STATS.includes(g)){if(g==="packetsLost"&&a.remote)return;b.cumulativeStat[g]!=null?g==="packetsLost"?b.cumulativeStat[g].updateNonStrictCumulative(f):b.cumulativeStat[g].update(f):b.cumulativeStat[g]=new(c("ZenonCumulativeMediaStat"))(f)}else d("ZenonMediaStatsConfig").DELTA_STATS.includes(g)&&(b.deltaStat[g]==null&&(b.deltaStat[g]=new(c("ZenonDeltaMediaStat"))()),b.deltaStat[g].add(f))})}function q(a,b,e){Object.entries(b).forEach(function(f){var g=f[0];f=Number(f[1]);if(!e||e.includes(g))if(k(g))a.cumulativeStat[g]!=null?g==="packetsLost"?a.cumulativeStat[g].updateNonStrictCumulative(f):a.cumulativeStat[g].update(f):a.cumulativeStat[g]=new(c("ZenonCumulativeMediaStat"))(f);else if(g==="timestamp"){var h=b.type+g;a.cumulativeStat[h]!=null?a.cumulativeStat[h].update(f):a.cumulativeStat[h]=new(c("ZenonCumulativeMediaStat"))(f)}else if(g===d("ZenonMediaStatsConfig").DERIVED_METRICS.FRAME_RATE_MEAN){h=null;b.framesEncoded!=null?h=Number(b.framesEncoded):b.framesDecoded!=null&&(h=Number(b.framesDecoded));c("isTruthy")(h)&&(a.deltaStat[g]==null&&(a.deltaStat[g]=new(c("ZenonDeltaMediaStat"))()),a.deltaStat[g].add(f))}else l(g)&&(a.deltaStat[g]==null&&(a.deltaStat[g]=new(c("ZenonDeltaMediaStat"))()),a.deltaStat[g].add(f))})}function r(a,b){var e;a.simulcastStats===void 0&&(a.simulcastStats=new(d("ZenonSimulcastStats").ZenonSimulcastStats)());(e=a.simulcastStats)==null?void 0:e.update(b);b=(e=a.simulcastStats)==null?void 0:e.getNumLayerChanges();if(b!=null){e=d("ZenonMediaStatsConfig").DERIVED_METRICS.SIMULCAST_LAYER_CHANGES;a.cumulativeStat[e]!=null?a.cumulativeStat[e].update(b):a.cumulativeStat[e]=new(c("ZenonCumulativeMediaStat"))(b)}}function s(a){var b=a.candidateType,c=a.networkType;a=a.protocol;var d={};b&&typeof b==="string"&&(d.candidateType=b);c&&typeof c==="string"&&(d.networkType=c);a&&typeof a==="string"&&(d.protocol=a);return d}g.filterLegacyMediaReports=i;g.filterMediaReports=a;g.getOrCreateTrackerFromMap=j;g.isCumulativeStat=k;g.isDeltaStat=l;g.makeStatsReportMap=b;g.updateTrackStatsWithChromiumLegacyReport=e;g.updateTrackStatsWithReport=f;g.updateTrackStatsFromSender=m}),98);
__d("ZenonVideoQpConversion",[],(function(a,b,c,d,e,f){"use strict";var g=[0,1,2,3,4,5,7,8,9,10,12,13,15,17,18,19,20,21,23,24,25,26,27,28,29,30,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,64,67,70,73,76,79,82,85,88,91,94,97,100,103,106,109,112,115,118,121,124,127];function a(a,b,c){var d;a===0?d=0:d=b/a;b=d;c||(b=g.findIndex(function(a){return a>=d}));return b===-1?g.length-1:Math.round(b)}f.convertQp=a}),66);
__d("ZenonTSLogDataHelper",["ZenonInfraActionsLogger","ZenonMediaStatsConfig","ZenonMediaStatsParser","ZenonVideoQpConversion"],(function(a,b,c,d,e,f,g){"use strict";var h={"new":1,checking:2,connected:3,completed:4,failed:5,disconnected:6,closed:7},i={iceConnectionState:0,sendParametersState:null},j=1073741824;function k(a,b,c,e){if(e.includes("qp")&&b.counters.qpSum!=null&&(b.counters.framesDecoded!=null||b.counters.framesEncoded!=null)){b.counters.qp==null&&(b.counters.qp=Array(a.shared_idx-b.bucket_start).fill(0));e=0;var f=0;a=a.shared_idx-b.bucket_start;a>0?(b.counters.framesEncoded!=null?e=b.counters.framesEncoded[a]-b.counters.framesEncoded[a-1]:b.counters.framesDecoded!=null&&(e=b.counters.framesDecoded[a]-b.counters.framesDecoded[a-1]),f=b.counters.qpSum[a]-b.counters.qpSum[a-1]):(b.counters.framesEncoded!=null?e=b.counters.framesEncoded[a]:b.counters.framesDecoded!=null&&(e=b.counters.framesDecoded[a]),f=b.counters.qpSum[a]);b.counters.qp[a]=(b=d("ZenonVideoQpConversion").convertQp(e,f,c))!=null?b:0}}function l(a,b,c,e,f){var g=function(e,g){for(var h=0;h<e.length;h++){var i=e[h];if(c.includes(i))for(var j=b.values(),k=Array.isArray(j),l=0,j=k?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var m;if(k){if(l>=j.length)break;m=j[l++]}else{l=j.next();if(l.done)break;m=l.value}m=m;if(m.type===g&&m[i]!==void 0){var n;f.counters[i]==null&&(f.counters[i]=Array(a.shared_idx-f.bucket_start).fill(0));n=(n=d("ZenonMediaStatsConfig").TSLOG_METRIC_SCALE[i])!=null?n:1;f.counters[i][a.shared_idx-f.bucket_start]=Math.round(Number(m[i])*n)}}}};g(d("ZenonMediaStatsConfig").getTrackStats(),"track");g(d("ZenonMediaStatsConfig").getMediaSourceStats(),"media-source");if(e==="video"&&c.includes("qp")){g=!1;for(var e=b.values(),h=Array.isArray(e),i=0,e=h?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j;if(h){if(i>=e.length)break;j=e[i++]}else{i=e.next();if(i.done)break;j=i.value}j=j;j.encoderImplementation!==void 0&&(g=String(j.encoderImplementation).includes("264"))}k(a,f,g,c)}}function m(a){return a.map(function(b,c){return c===0?0:b-a[c-1]})}function n(a){if(a.type==="candidate-pair")return a.id;var b="unknown",c=["recv","inbound"],d=["send","outbound"];c.some(function(b){return a.id.toLowerCase().includes(b)})&&(b="inbound");d.some(function(b){return a.id.toLowerCase().includes(b)})&&(b="outbound");c=a.mediaType===void 0?"unknown":a.mediaType.toString();d=a.ssrc===void 0?"unknown":a.ssrc.toString();return b+"_"+c+"_"+d}function o(a){return a}function p(a){var b=["recv","inbound"],d=["send","outbound"];if(b.some(function(b){return a.toLowerCase().includes(b)}))return"inbound";if(d.some(function(b){return a.toLowerCase().includes(b)}))return"outbound";c("ZenonInfraActionsLogger").logError({checkpoint:"TsLogHolder Stream Name: "+a,error:"CANNOT_DETERMINE_STREAM_DIRECTION",errorDomain:"ZenonTSLogDataHelper"});return"inbound"}function q(a,b){return a+"_rtp_"+b}function r(a,b,c){if(c&&Object.prototype.hasOwnProperty.call(c.counters,"estimatedPlayoutTimestamp")&&Object.prototype.hasOwnProperty.call(a.counters,"estimatedPlayoutTimestamp")){var d=c.counters.estimatedPlayoutTimestamp.length,e=a.counters.estimatedPlayoutTimestamp.length,f=Math.min(e,d),g=new Array(f).fill(0),h=new Array(f).fill(0);for(var i=0;i<f;i++){var k=c.counters.estimatedPlayoutTimestamp[i],l=a.counters.estimatedPlayoutTimestamp[i];k>0&&l>0?k>=l?(h[i]=2,g[i]=Math.min(k-l,j)):(h[i]=1,g[i]=Math.min(l-k,j)):(h[i]=0,g[i]=0)}b.push({data:g,name:"avSync"});b.push({data:h,name:"avSyncSign"});l=22089888e5+1598738e6;k=Math.max(e,d);i=new Array(d).fill(0);f=new Array(e).fill(0);g=null;for(var h=0;h<k;h++){d=c.counters.estimatedPlayoutTimestamp[h];e=a.counters.estimatedPlayoutTimestamp[h];g==null&&(d>l&&e>l?g=Math.min(d,e):d>l?g=d:e>l&&(g=e));g!=null&&(d>l&&(i[h]=Math.max(Math.min(d-g,j),-j)),e>l&&(f[h]=Math.max(Math.min(e-g,j),-j)))}b.push({data:i,name:"audioTs"});b.push({data:f,name:"videoTs"})}}function s(a,b,c){var e=[];for(var f in a.counters)b.includes(f)||e.push({data:a.counters[f],name:f}),d("ZenonMediaStatsParser").isCumulativeStat(f)&&!b.includes(f+"_delta")&&e.push({data:m(a.counters[f]),name:f+"_delta"});b=a.counters;var g=b.fecPacketsDiscarded;b=b.fecPacketsReceived;if(g!=null&&b!=null){var h=Math.min(g.length,b.length),i=[];for(var j=0;j<h;j++)i.push(b[j]-g[j]);e.push({data:m(i),name:"fecPacketsUsed_delta"})}t(a,e);r(a,e,c);return e}function t(a,b){if(Object.prototype.hasOwnProperty.call(a.counters,"jitterBufferDelay")&&Object.prototype.hasOwnProperty.call(a.counters,"jitterBufferEmittedCount")){var c=Math.min(a.counters.jitterBufferDelay.length,a.counters.jitterBufferEmittedCount.length),d=new Array(c).fill(0);for(var e=1;e<c;e++){var f=a.counters.jitterBufferDelay[e]-a.counters.jitterBufferDelay[e-1],g=a.counters.jitterBufferEmittedCount[e]-a.counters.jitterBufferEmittedCount[e-1];g===0?d[e]=0:d[e]=Math.round(f*1e3/g)}b.push({data:d,name:"neteqMeanWaitTime"})}}function a(a,b){[[d("ZenonMediaStatsConfig").OUTBOUND_SCREEN_STATS_TRACKID,"screen"],[d("ZenonMediaStatsConfig").OUTBOUND_VIDEO_STATS_TRACKID,"video"]].forEach(function(c){var d=c[0];c=c[1];var e=a.get(d);if(e!=null){d=C(c,d);var f=b.streams[d];f==null&&(f={bucket_end:b.shared_idx,bucket_start:b.shared_idx,contentType:c,counters:{},owner:""},b.streams[d]=f);B(e,f,b.shared_idx,c)}})}function b(a,b,c){if(b.size===0)return;b.forEach(function(d){if(d.mediaType!=="video"||d.kind!=="video")return;var e=n(d);e=c.streams[e];if(e==null)return;d=d.trackId!=null?b.get(d.trackId.toString()):null;if(d==null||d.trackIdentifier==null||d.remoteSource===!1||d.ended)return;d=d.trackIdentifier?d.trackIdentifier.toString():"";if(!d)return;d=a.get(d);if(d){var f;e.counters.renderedWidth==null&&(e.counters.renderedWidth=Array(c.shared_idx-e.bucket_start).fill(0));e.counters.renderedHeight==null&&(e.counters.renderedHeight=Array(c.shared_idx-e.bucket_start).fill(0));var g=c.shared_idx-e.bucket_start;e.counters.renderedWidth[g]=(f=d.renderedWidth)!=null?f:0;e.counters.renderedWidth[g]=Math.round(e.counters.renderedWidth[g]);e.counters.renderedHeight[g]=(f=d.renderedHeight)!=null?f:0;e.counters.renderedHeight[g]=Math.round(e.counters.renderedHeight[g])}})}function e(a,b,c){a=o(a);var d=c.streams[a];d==null&&(d={bucket_end:c.shared_idx,bucket_start:c.shared_idx,contentType:"client-metrics",counters:{},owner:""},c.streams[a]=d);d.bucket_end=c.shared_idx;Object.keys(b).forEach(function(a){D(c,d,a,b[a])})}function f(a,b){if(b.size===0)return;b.forEach(function(b){if(b.type==="candidate-pair"){var c=n(b),e=a.streams[c];e==null&&(e={bucket_end:a.shared_idx,bucket_start:a.shared_idx,contentType:"candidate-pair",counters:{},owner:""},a.streams[c]=e);(a.start_time_ms==null||b.timestamp<a.start_time_ms)&&(a.start_time_ms=Math.round(b.timestamp));for(var f in b)d("ZenonMediaStatsConfig").TSLOG_STATS_REQUESTED_FROM_CANDIDATE_PAIR.includes(f)&&D(a,e,f,b[f],d("ZenonMediaStatsConfig").TSLOG_METRIC_SCALE[f]);e.bucket_end=a.shared_idx;(a.end_time_ms==null||b.timestamp>a.end_time_ms)&&(a.end_time_ms=Math.round(b.timestamp))}})}function u(a,b,c,e,f,g){if(c.size===0)return;c.forEach(function(h){if(h.type==="track"||h.type==="media-source"||h.type==="candidate-pair"||h.type==="VideoBwe"||h.type==="googCandidatePair")return;var i=n(h),j=a.streams[i];if(h.type==="ssrc"){if(j==null)return;for(var k in h)e.includes(k)&&d("ZenonMediaStatsConfig").getSsrcStats().includes(k)&&D(a,j,k,h[k],d("ZenonMediaStatsConfig").TSLOG_METRIC_SCALE[k])}else{j==null&&(j={bucket_end:a.shared_idx,bucket_start:a.shared_idx,contentType:f,counters:{},owner:g?g.id:""},a.streams[i]=j);(a.start_time_ms==null||h.timestamp<a.start_time_ms)&&(a.start_time_ms=Math.round(h.timestamp));h.ssrc!=null&&(j.ssrc=h.ssrc.toString());D(a,j,"trackEnabled",b);for(var m in h){e.includes(m)&&D(a,j,m,h[m],d("ZenonMediaStatsConfig").TSLOG_METRIC_SCALE[m]);if(m==="estimatedPlayoutTimestamp"&&e.includes(d("ZenonMediaStatsConfig").DERIVED_METRICS.E2E_LATENCY)){i=new Date(Date.UTC(0,0));i=Date.now()-i-Number(h[m]);j.counters[d("ZenonMediaStatsConfig").DERIVED_METRICS.E2E_LATENCY]==null&&(j.counters[d("ZenonMediaStatsConfig").DERIVED_METRICS.E2E_LATENCY]=Array(a.shared_idx-j.bucket_start).fill(0));j.counters[d("ZenonMediaStatsConfig").DERIVED_METRICS.E2E_LATENCY][a.shared_idx-j.bucket_start]=i}}l(a,c,e,f,j)}j.bucket_end=a.shared_idx;(a.end_time_ms==null||h.timestamp>a.end_time_ms)&&(a.end_time_ms=Math.round(h.timestamp))})}function v(a){a.streams.nonMediaState==null&&(a.streams.nonMediaState={bucket_end:a.shared_idx,bucket_start:a.shared_idx,contentType:"non-media-state",counters:{},owner:""});var b=a.streams.nonMediaState;Object.keys(i).forEach(function(c){if(c==="sendParametersState"){var d=i[c];if(d!=null)for(var e=0;e<d.encodings.length;e++){var f=d.encodings[e],g="l"+e,h=0;f.active!=null&&(h=f.active?2:1);D(a,b,g+"a",h);h=0;f.maxBitrate!=null&&(h=f.maxBitrate);D(a,b,g+"mb",h);h=0;f.scaleResolutionDownBy!=null&&(h=f.scaleResolutionDownBy);D(a,b,g+"sr",h,100)}}else D(a,b,c,i[c])});b.bucket_end=a.shared_idx}function w(a){var b;a.streams["."]==null&&(a.streams["."]={bucket_end:a.shared_idx,bucket_start:a.shared_idx,contentType:"time",counters:{btime:[],ctime:[]}});b=(b=a.end_time_ms)!=null?b:0;var c=a.streams["."].counters,d=c.btime;c=c.ctime;c.push(Math.round(b-((b=a.start_time_ms)!=null?b:0)));d.push(Math.round(c[a.shared_idx]-((b=c[a.shared_idx-1])!=null?b:0)));a.streams["."].bucket_end=a.shared_idx;a.shared_idx++}function x(){return{end_time_ms:null,shared_idx:0,source:"rtc_www",start_time_ms:null,streams:{}}}function y(a){i.iceConnectionState=(a=h[a])!=null?a:0}function z(a){i.sendParametersState=a}function A(a,b){b=(b=b)!=null?b:d("ZenonMediaStatsConfig").TSLOG_STATS_TO_SUPPRESS;var c={source:a.source,start_time_ms:Math.round(Number(a.start_time_ms)),streams:[]},e=new Map(),f=0,g=new Map(),h=["audio","video","screen"];for(var i in a.streams){var j=a.streams[i];if(h.includes(j.contentType)){var k=p(i);k==="inbound"&&j.owner!=null&&!e.has(j.owner)&&(e.set(j.owner,f.toString()),f++);k=j.owner+j.contentType;g.set(k,i)}}j={};for(var l in a.streams){k=a.streams[l];f=void 0;var m=l;if(h.includes(k.contentType)){var n=p(l);j[n+k.contentType]=j[n+k.contentType]+1||0;m=q(n,k.contentType)}else k.contentType==="candidate-pair"?m="cp":k.contentType==="client-metrics"&&(m="cm");n=g.get(k.owner+"audio");k.contentType==="video"&&n!=null&&(f=a.streams[n]);n={bucket_end:k.bucket_end,bucket_start:k.bucket_start,counters:s(a.streams[l],b,f),name:m,props:{}};e.has(a.streams[l].owner)&&(n.props.seq=e.get(a.streams[l].owner));a.streams[l].ssrc!=null&&(n.props.ssrc=a.streams[l].ssrc);c.streams.push(n)}return c}function B(a,b,c,e){[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_IS_STALLED,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_ENCODE_IS_STALLED,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SENT_IS_STALLED].forEach(function(d){var f=e+"_"+d,g=c-b.bucket_start;b.counters[f]==null&&(b.counters[f]=Array(g).fill(0));b.counters[f][g]=(g=(f=a.deltaStat[d])==null?void 0:f.getLastAddedValue())!=null?g:0;b.bucket_end=c})}function C(a,b){return"outbound_"+a+"_"+b}function D(a,b,c,d,e){a=Math.max(a.shared_idx-b.bucket_start,0);b.counters[c]==null&&(b.counters[c]=Array(a).fill(0));e=Math.round(Number(d)*((d=e)!=null?d:1));b.counters[c][a]=e}g._addDataQp=k;g._addExtraStats=l;g._cumulativeToDelta=m;g._getTslogStreamName=n;g._getMediaTrackDirection=p;g._normalizeStreamName=q;g._serializeAvsync=r;g._serializeCounters=s;g._serializeNeteqMeanWaitTime=t;g.addSenderVideoStallData=a;g.addRenderedFrameData=b;g.addCallCpuData=e;g.addCandidatePairStats=f;g.addData=u;g.addNonMediaStates=v;g.advance=w;g.emptyTSLogDataHolder=x;g.onIceConnectionStateChange=y;g.onRtpSendParametersStateChange=z;g.serialize=A}),98);
__d("ScotchRTCCallStoreState",["CurrentUser","ScotchFBRTCCallSummary","ScotchRTCUser","ZenonTSLogDataHelper","immutable"],(function(a,b,c,d,e,f,g){"use strict";a={debugID:0,callID:"",collisionContext:{groupThreadID:null,peerID:null,serverInfoData:null},conferenceState:"NEW",conferenceName:"",responseSubCode:null,protocol:"",serverInfoData:"",tsLogData:d("ZenonTSLogDataHelper").emptyTSLogDataHolder()};b=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var c=b.prototype;c.isInCall=function(){return this.conferenceState==="CONNECTING"||this.conferenceState==="CONNECTED"};return b}(c("immutable").Record(a));e={connections:c("immutable").Set(),localUser:new(c("ScotchRTCUser"))({FBID:c("CurrentUser").getID()}),remoteUsers:c("immutable").Set(),remoteScreenSharingUserIDs:c("immutable").OrderedSet(),callInfo:new b(),callSummary:c("ScotchFBRTCCallSummary").nullSummary(),mediaStatus:c("immutable").Map()};f=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("immutable").Record(e));g["default"]=f}),98);
__d("ScotchRTCCallReducer",["invariant","FBRTCParticipantCallState","FBRTCRtcResponseStatusCode","ScotchConstants","ScotchFBRTCCallSummary","ScotchFBRTCCallSummaryStore","ScotchRTCCallStore","ScotchRTCCallStoreState","ScotchRTCLogger","ScotchRTCUser","ScotchRTCUtils","ScotchRTWebUserActionLogger","URI","ZenonMWTranslatorUtils","gkx","immutable"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a,b){switch(b.type){case"INIT":return a.set("callInfo",a.callInfo.set("callID",b.callID).set("conferenceName",b.conferenceName).set("serverInfoData",b.serverInfoData).set("protocol",b.protocol).set("collisionContext",{serverInfoData:b.serverInfoData,peerID:null,groupThreadID:null})).set("remoteScreenSharingUserIDs",c("immutable").OrderedSet());case"RESET":return new(c("ScotchRTCCallStoreState"))();case"RESET_FOR_REDIAL":return a.set("callInfo",a.callInfo.set("conferenceState","NEW").set("callID",b.callID).set("conferenceName",b.conferenceName)).set("callSummary",c("ScotchFBRTCCallSummary").nullSummary()).set("connections",c("immutable").Set()).set("remoteUsers",a.remoteUsers.map(function(a){return a.removeAllStreams()})).set("remoteScreenSharingUserIDs",c("immutable").OrderedSet());case"CALL_COLLISION":return a.set("callInfo",a.callInfo.set("conferenceState","NEW").set("callID",b.conferenceName).set("conferenceName",b.conferenceName)).set("remoteUsers",a.remoteUsers.map(function(a){return a.removeAllStreams()})).set("remoteScreenSharingUserIDs",c("immutable").OrderedSet())}return a}function b(a,b){switch(b.type){case"CALL":return a.setIn(["callInfo","conferenceState"],"CONNECTING").set("connections",a.connections.add(b.peerConnection));case"CALL_ERROR":return a.setIn(["callInfo","conferenceState"],"TERMINATED").setIn(["callInfo","responseSubCode"],b.responseSubCode);case"CALL_SUCCESS":return b.connected?a.setIn(["callInfo","conferenceState"],"CONNECTED"):a}return a}function e(a,b){switch(b.type){case"SET_PENDING_APPROVAL":return a.setIn(["callInfo","conferenceState"],"PENDING_APPROVAL")}return a}function f(a,b){switch(b.type){case"INCOMING_CALL_SUCCESS":return a.setIn(["callInfo","conferenceState"],"CONNECTED")}return a}function i(a,b){switch(b.type){case"HANGUP":a.connections.forEach(function(a){return a.close()});return a.setIn(["callInfo","conferenceState"],"TERMINATING").set("connections",c("immutable").Set()).set("remoteUsers",a.remoteUsers.map(function(a){return a.removeAllStreams()}));case"DISMISS":b.transaction.sendResponse(b.request.createResponse(c("FBRTCRtcResponseStatusCode").OK,{callID:a.callInfo.callID}));case"END_CALL":a.connections.forEach(function(a){return a.close()});return a.setIn(["callInfo","conferenceState"],"TERMINATED").set("connections",c("immutable").Set()).set("remoteUsers",a.remoteUsers.map(function(a){return a.removeAllStreams()}));case"HANGUP_ERROR":case"HANGUP_SUCCESS":return a.setIn(["callInfo","conferenceState"],"TERMINATED")}return a}function j(a,b){switch(b.type){case"GROUP_ESCALATION_CLEAR_P2P_CONNECTION":var e=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.P2P);if(e){b=e.getRemoteStreams();var f=b[0];e.close();var g=a.localUser;b=g.getScreenStream();if(b){var h=g.getStream();h&&d("ScotchRTCUtils").transferAudioTracks(h,b);d("ScotchRTCUtils").stopMediaStream(b);g=g.removeScreenStream(b)}return a.withMutations(function(a){a.set("connections",a.connections.remove(e)).set("localUser",g).set("remoteUsers",a.remoteUsers.map(function(a){return a.removeStream(f)}))})}}return a}function k(a,b){switch(b.type){case"GROUP_ESCALATION_CANCEL":var e=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.MULTIWAY);if(e){var f=e.getRemoteStreams(),g=f[0],h=a.callSummary;b.p2pCallSummary&&(h=b.p2pCallSummary,c("ScotchFBRTCCallSummaryStore").getInstance().removeCallSummary(a.callSummary.peerID,a.callSummary.callID));e.close();return a.withMutations(function(a){a.set("callInfo",a.callInfo.set("conferenceState","CONNECTED").set("conferenceName",h.callID).set("protocol","p2p").set("serverInfoData","")).set("callSummary",h).set("connections",a.connections.remove(e)).set("remoteUsers",a.remoteUsers.map(function(a){return a.removeStream(g)}))})}}return a}function l(a,b){var d=function(){switch(b.type){case"ON_PARTICIPANTS_ADDED":var d=a.remoteUsers.map(function(a){return a.FBID});return a.set("remoteUsers",a.remoteUsers.union(Object.keys(b.participants).filter(function(a){return!d.has(b.participants[a].fbid)}).map(function(a){var d=b.participants[a],e=d.big_image_src||d.image_src;b.images&&b.images[a]&&(e=b.images[a]);d.fbid||h(0,1174);return new(c("ScotchRTCUser"))({FBID:d.fbid,profileUrl:new(c("URI"))(d.href),profilePictureUrl:e,isGuestUser:d.user_type==="guest",isMessengerUser:!!d.is_messenger_user,isPartiesUser:!!d.is_parties_user,streams:(a=d.streams)!=null?a:c("immutable").Set(),userName:d.name,userShortName:d.short_name,vanity:d.vanity})})))}return a};d=d();return d}function m(a,b){var d=function(){switch(b.type){case"ON_CONFERENCE_STATE":var d=b.transaction,e=b.request,f=b.request.conferenceStateRequest(),g={currentVersion:b.conferenceStateVersion},h=a.callInfo.callID;if(a.callInfo.conferenceState==="TERMINATING"||a.callInfo.conferenceState==="TERMINATED"){c("ScotchRTCLogger").getInstance().logServerRequestDoneProcessing(e,h);d.sendResponse(e.createResponse(c("FBRTCRtcResponseStatusCode").OK,{body:{conferenceStateResponse:g},callID:h}));return a}c("gkx")("2890")&&c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchRTCCallReducer_processConferenceState: "+JSON.stringify(f)});if(b.conferenceStateVersion>=f.version){c("ScotchRTCLogger").getInstance().logServerRequestDoneProcessing(e,h);d.sendResponse(e.createResponse(c("FBRTCRtcResponseStatusCode").OK,{body:{conferenceStateResponse:g},callID:h}));return a}b.resolve(f.version);var i=a.remoteUsers.map(function(a){var b=f.participantStates[a.FBID];b&&b.state===c("FBRTCParticipantCallState").DISCONNECTED&&(a=a.removeAllStreams());return b?a.setParticipantState(b):a}),j=i.some(function(a){a=a.participantState;return a&&a.state===c("FBRTCParticipantCallState").CONNECTED});j=j&&a.callInfo.conferenceState!="PENDING_APPROVAL"?"CONNECTED":a.callInfo.conferenceState;var k=f.appMessages;k=(k=c("ZenonMWTranslatorUtils").getCollisionContextFromAppMessages(k))!=null?k:a.callInfo.collisionContext;c("ScotchRTCLogger").getInstance().logServerRequestDoneProcessing(e,h);d.sendResponse(e.createResponse(c("FBRTCRtcResponseStatusCode").OK,{body:{conferenceStateResponse:g},callID:a.callInfo.callID}));return a.setIn(["remoteUsers"],i).setIn(["callInfo","conferenceState"],j).setIn(["callInfo","collisionContext"],k)}return a};d=d();return d}function n(a,b){switch(b.type){case"ON_JOIN_RESPONSE":return a.setIn(["callInfo","serverInfoData"],b.serverInfoData).setIn(["callInfo","collisionContext"],{serverInfoData:b.serverInfoData})}return a}function o(a,b){var c=function(){switch(b.type){case"INIT_LOCAL_USER":return a.set("localUser",b.localUser);case"INIT_REMOTE_USERS":case"UPDATE_REMOTE_USERS":return a.set("remoteUsers",b.remoteUsers)}return a};c=c();return c}function p(a,b){switch(b.type){case"ADD_REMOTE_SCREEN_SHARING_USER_ID":return a.set("remoteScreenSharingUserIDs",a.remoteScreenSharingUserIDs.add(b.userID));case"REMOVE_REMOTE_SCREEN_SHARING_USER_ID":return a.set("remoteScreenSharingUserIDs",a.remoteScreenSharingUserIDs.remove(b.userID))}return a}function q(a,b){switch(b.type){case"AUDIO_MUTED":case"AUDIO_UNMUTED":return a.set("localUser",a.localUser.toggleDisableAudio());case"VIDEO_MUTED":return a.set("localUser",a.localUser.toggleDisableVideo(!0));case"VIDEO_UNMUTED":return a.set("localUser",a.localUser.toggleDisableVideo(!1));default:return a}}function r(a,b){switch(b.type){case"ADD_LOCAL_STREAM":return a.set("localUser",a.localUser.addStream(b.stream));case"REMOVE_LOCAL_STREAM":return a.set("localUser",a.localUser.removeStream(b.stream));case"REPLACE_LOCAL_STREAM":var c=b.oldStream.getAudioTracks();c=c[0];var e=b.oldStream.getVideoTracks();e=e[0];if(c!=null)for(var f=b.newStream.getAudioTracks(),g=Array.isArray(f),h=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=f.length)break;i=f[h++]}else{h=f.next();if(h.done)break;i=h.value}i=i;i.enabled=c.enabled}if(e!=null)for(var i=b.newStream.getVideoTracks(),h=Array.isArray(i),g=0,i=h?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(h){if(g>=i.length)break;f=i[g++]}else{g=i.next();if(g.done)break;f=g.value}c=f;c.enabled=e.enabled}return a.set("localUser",a.localUser.replaceStream(b.oldStream,b.newStream));case"STOP_LOCAL_STREAM":return a.set("localUser",a.localUser.stopVideo());case"REMOVE_ALL_LOCAL_STREAMS":if(b.stopStreams)for(var f=a.localUser.streams,c=Array.isArray(f),g=0,f=c?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(c){if(g>=f.length)break;h=f[g++]}else{g=f.next();if(g.done)break;h=g.value}i=h;d("ScotchRTCUtils").stopMediaStream(i)}return a.set("localUser",a.localUser.removeAllStreams())}return a}function s(a,b){switch(b.type){case"ADD_LOCAL_SCREEN_STREAM":return a.set("localUser",a.localUser.addScreenStream(b.stream));case"REMOVE_LOCAL_SCREEN_STREAM":return a.set("localUser",a.localUser.removeScreenStream(b.stream));case"REMOVE_ALL_LOCAL_SCREEN_STREAMS":if(b.stopStreams)for(var c=a.localUser.screenStreams,e=Array.isArray(c),f=0,c=e?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=c.length)break;g=c[f++]}else{f=c.next();if(f.done)break;g=f.value}g=g;d("ScotchRTCUtils").stopMediaStream(g)}return a.set("localUser",a.localUser.removeAllScreenStreams());case"REPLACE_LOCAL_SCREEN_STREAM":return a.set("localUser",a.localUser.replaceScreenStream(b.oldStream,b.newStream))}return a}function t(a,b){var d,e=function(){switch(b.type){case"ADD_REMOTE_STREAM":var e="";a.mediaStatus.forEach(function(a,b){e+="track: "+b+" status: "+(a?"true":"false")+","});var f=b.stream.getTracks().reduce(function(a,b){return a.concat(b.kind+": "+b.id+",")},"");c("gkx")("2890")&&c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchRTCCallReducer_AddRemoteStream.\n            New stream: "+b.stream.id+":{"+f+"} .\n            Current media status: "+e});d=x(a,b);if(!d)return a;f=d;a.callInfo.protocol==="multiway"&&(f=f.removeAllStreams());f=a.setIn(["remoteUsers"],a.remoteUsers["delete"](d).add(f.addStream(b.stream)));return w(f,{type:"TOGGLE_REMOTE_STREAM",mediaStatus:f.mediaStatus.toJS()});case"REMOVE_REMOTE_STREAM":d=x(a,b);return!d?a:a.setIn(["remoteUsers"],a.remoteUsers["delete"](d).add(d.removeStream(b.stream)));case"REMOVE_ALL_REMOTE_STREAMS":d=x(a,b);return!d?a:a.setIn(["remoteUsers"],a.remoteUsers["delete"](d).add(d.removeAllStreams().removeAllScreenStreams()))}return a};e=e();return e}function u(a,b){var c,d=function(){switch(b.type){case"ADD_REMOTE_TRACK":c=x(a,b);return!c?a:a.setIn(["remoteUsers"],a.remoteUsers["delete"](c).add(c.clone()));case"REMOVE_REMOTE_TRACK":c=x(a,b);return!c?a:a.setIn(["remoteUsers"],a.remoteUsers["delete"](c).add(c.clone()))}return a};d=d();return d}function v(a,b){var c,d=function(){switch(b.type){case"ADD_REMOTE_SCREEN_STREAM":c=x(a,b);return!c?a:a.setIn(["remoteUsers"],a.remoteUsers["delete"](c).add(c.addScreenStream(b.stream)));case"REMOVE_REMOTE_SCREEN_STREAM":c=x(a,b);return!c?a:a.setIn(["remoteUsers"],a.remoteUsers["delete"](c).add(c.removeScreenStream(b.stream)))}return a};d=d();return d}function w(a,b){var d,e=function(){switch(b.type){case"TOGGLE_REMOTE_STREAM":if(c("gkx")("2890")&&b.mediaStatus!=null){var e=Object.keys(b.mediaStatus).reduce(function(a,c){return""+a+c+":"+String(b.mediaStatus[c])+";"},"");c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchRTCCallReducer_toggleRemoteStream.\n            Action type: "+b.type+" mediaStatus: "+e})}var f=new Map(),g=a.remoteUsers;a.mediaStatus.forEach(function(a,c){var d=g.reduce(function(b,a){var d=a.streams.map(function(a){return a.getTracks().find(function(a){return a.id===c})}).find(Boolean);return d?{user:a,track:d}:b},{}),b=d.user;d=d.track;if(b&&d){var e=Boolean(b.audioStreamMuteStates.get(d.id));d.kind==="video"&&b.isVideoDisabled()===a?g=g["delete"](b).add(b.toggleDisableVideo(!b.isVideoDisabled())):d.kind==="audio"&&e===a&&(g=g["delete"](b).add(b.toggleAudioTrackMutedByUser(d.id,!e)))}else f.set(c,a)});Object.entries(b.mediaStatus).forEach(function(b){var c=b[0];b=b[1];var d=g.reduce(function(b,a){var d=a.streams.map(function(a){return a.getTracks().find(function(a){return a.id===c})}).find(Boolean);return d?{user:a,track:d}:b},{}),a=d.user;d=d.track;if(a&&d){var e=Boolean(a.audioStreamMuteStates.get(d.id));d.kind==="video"&&a.isVideoDisabled()===b?g=g["delete"](a).add(a.toggleDisableVideo(!a.isVideoDisabled())):d.kind==="audio"&&e===b&&(g=g["delete"](a).add(a.toggleAudioTrackMutedByUser(d.id,!e)))}else f.set(c,!!b)});return a.set("remoteUsers",g).set("mediaStatus",c("immutable").Map(f));case"REMOTE_VIDEO_MUTED":d=x(a,b);if(!d)return a;c("gkx")("2890")&&c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchRTCCallReducer_toggleRemoteStream. REMOTE_VIDEO_MUTED. mute user"+d.FBID});return a.setIn(["remoteUsers"],a.remoteUsers["delete"](d).add(d.toggleDisableVideo(!0)));case"REMOTE_VIDEO_UNMUTED":d=x(a,b);if(!d)return a;c("gkx")("2890")&&c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchRTCCallReducer_toggleRemoteStream. REMOTE_VIDEO_UNMUTED. unmute user"+d.FBID});return a.setIn(["remoteUsers"],a.remoteUsers["delete"](d).add(d.toggleDisableVideo(!1)))}return a};e=e();return e}function x(a,b){return a.remoteUsers.find(function(a){return b.userID?a.FBID==b.userID:a.FBID===b.stream.id.split(":")[0]})}function y(a,b){switch(b.type){case"WAIT_FOR_USER_INPUT":return a.callInfo.conferenceState==="NEW"?a.setIn(["callInfo","conferenceState"],"AWAITING_USER_START"):a}return a}g.callInit=a;g.callStart=b;g.setPendingApproval=e;g.incomingCallStart=f;g.callEnd=i;g.completeTransitionToMultiway=j;g.abortMultiwayEscalationProcess=k;g.onParticipantsChanged=l;g.processConferenceState=m;g.processJoinResponse=n;g.processUsers=o;g.processRemoteScreenSharingUserID=p;g.toggleLocalStream=q;g.processLocalStream=r;g.processLocalScreenStream=s;g.processRemoteStream=t;g.processRemoteTrack=u;g.processRemoteScreenStream=v;g.toggleRemoteStream=w;g.waitForUserInput=y}),98);
__d("ScotchRTCCallStore",["FluxReduceStore","ScotchFBRTCCallSummaryReducer","ScotchFBRTCCallSummaryStore","ScotchRTCAppDispatcher","ScotchRTCCallReducer","ScotchRTCCallStoreState","ScotchRTWebUserActionLogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=[d("ScotchFBRTCCallSummaryReducer").onCallEnded,d("ScotchFBRTCCallSummaryReducer").onCallStarted,d("ScotchFBRTCCallSummaryReducer").onMessageSignaling,d("ScotchFBRTCCallSummaryReducer").onSurveyResult,d("ScotchFBRTCCallSummaryReducer").setCallSummary,d("ScotchRTCCallReducer").abortMultiwayEscalationProcess,d("ScotchRTCCallReducer").callEnd,d("ScotchRTCCallReducer").callInit,d("ScotchRTCCallReducer").callStart,d("ScotchRTCCallReducer").completeTransitionToMultiway,d("ScotchRTCCallReducer").incomingCallStart,d("ScotchRTCCallReducer").onParticipantsChanged,d("ScotchRTCCallReducer").processConferenceState,d("ScotchRTCCallReducer").processJoinResponse,d("ScotchRTCCallReducer").processLocalScreenStream,d("ScotchRTCCallReducer").processLocalStream,d("ScotchRTCCallReducer").processRemoteScreenStream,d("ScotchRTCCallReducer").processRemoteStream,d("ScotchRTCCallReducer").processRemoteTrack,d("ScotchRTCCallReducer").processUsers,d("ScotchRTCCallReducer").processRemoteScreenSharingUserID,d("ScotchRTCCallReducer").setPendingApproval,d("ScotchRTCCallReducer").toggleLocalStream,d("ScotchRTCCallReducer").toggleRemoteStream,d("ScotchRTCCallReducer").waitForUserInput],i=function(a){return a.map(function(a){return a.streams.map(function(b){return{state:a.getParticipantState(),active:b.active,streamID:b.id,tracks:b.getTracks().map(function(a){return{trackID:a.id,kind:a.kind,enabled:a.enabled,muted:a.muted,readyState:a.readyState}})}})})};a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=d=a.call.apply(a,[this].concat(f))||this,d.reduce=function(a,b){var d=h.reduce(function(a,c){return c(a,b)},a);if(c("gkx")("2890")&&a.remoteUsers!==d.remoteUsers){a=i(a.remoteUsers);var e=i(d.remoteUsers);JSON.stringify(a)!==JSON.stringify(e)&&c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchRTCCallStore.reduce: "+JSON.stringify({beforeStreams:a,afterStreams:e,action:b.type})})}return d},b)||babelHelpers.assertThisInitialized(d)}var d=b.prototype;d.getInitialState=function(){return new(c("ScotchRTCCallStoreState"))()};d.hasRemoteVideo=function(){return this.getState().remoteUsers.some(function(a){return a.hasStream()&&!a.areAllTracksDisabled(a.streams.first().getVideoTracks())})};d.hasLocalVideo=function(){var a=this.getState();a=a.localUser;return a.hasStream()&&!a.areAllTracksDisabled(a.streams.first().getVideoTracks())};d.getConnection=function(a){var b=this.getState();b=b.connections;a&&(b=b.filter(function(b){return b.getSignalingProtocol()===a}));return b.first()};d.mutateCallSummary=function(a){var b=this.getState();b=b.callSummary;a(b);b.save(c("ScotchFBRTCCallSummaryStore").getInstance())};d.getSortedRemoteUsers=function(){return this.getState().remoteUsers.toList().sort(function(a,b){return a.lastConnectedAt===b.lastConnectedAt?a.FBID>b.FBID?1:-1:a.lastConnectedAt-b.lastConnectedAt})};return b}(c("FluxReduceStore"));a.__moduleID=f.id;b=new a(c("ScotchRTCAppDispatcher"));g["default"]=b}),98);
__d("ScotchRTCMWSessionDescription",["FBLogger","FBRTCMediaType","Promise","ScotchConstants","ScotchRTCCallActions","ScotchRTCCallStore","ScotchRTCGroupCallActions","ScotchRTCSessionDescription","ScotchRTWebUserActionLogger","ZenonDebugLogger","ZenonMWMessageTypes","gkx","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";f={};function a(a,e,f,g){var h=this,i,j,k,l,m,n,o,p,q,r,s,t;return b("regeneratorRuntime").async(function(u){while(1)switch(u.prev=u.next){case 0:i=a.fromVersion,j=a.toVersion,k=a.mediaUpdates,l=a.offer;m=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.MULTIWAY);n=g==null?void 0:g.id;if(m){u.next=7;break}c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchRTCMWSessionDescription_serverMediaUpdate no connection: "+JSON.stringify({transactionId:n}),callID:f==null?void 0:f.callID,conferenceName:f==null?void 0:f.conferenceName,callType:"mw"});e(j,!1,null,!0);return u.abrupt("return");case 7:o=m.getLocalDescription();p=m.getRemoteDescriptionForSMU();q=p.sessionDescription.getVersion();r=l!=null;c("gkx")("2890")&&c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchRTCMWSessionDescription_serverMediaUpdate: "+JSON.stringify({fromVersion:i,toVersion:j,currentVersion:q,transactionId:n,hasOffer:r}),callID:f==null?void 0:f.callID,conferenceName:f==null?void 0:f.conferenceName,callType:"mw"});if(!(q!==i)){u.next=16;break}c("gkx")("2890")&&c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchRTCMWSessionDescription_serverMediaUpdate version mismatch: "+JSON.stringify({transactionId:n}),callID:f==null?void 0:f.callID,conferenceName:f==null?void 0:f.conferenceName,callType:"mw"});e(q,!1,null,!1);return u.abrupt("return");case 16:k.forEach(function(a){h.maybeUpdatePausedDownlink(a,f),p.processServerMediaUpdate(a,f)});p.sessionDescription.setVersion(j);s=null;u.prev=19;if(!(c("gkx")("1484828")&&l)){u.next=30;break}u.next=23;return b("regeneratorRuntime").awrap(m.setRemoteDescription(new(c("ScotchRTCSessionDescription"))(d("ScotchConstants").SignalingProtocol.MULTIWAY,{type:"offer",sdp:l.sdpString})));case 23:u.next=25;return b("regeneratorRuntime").awrap(m.createAnswer());case 25:s=u.sent;u.next=28;return b("regeneratorRuntime").awrap(m.setLocalDescription(s));case 28:u.next=32;break;case 30:u.next=32;return b("regeneratorRuntime").awrap(b("Promise").all([m.setLocalDescription(o),m.setRemoteDescription(p)]));case 32:d("ScotchRTCGroupCallActions").toggleRemoteStream((t=[]).concat.apply(t,k.map(function(a){a=a.media;return a})).reduce(function(a,b){var c=b.id;b=b.enabled;c=m.getWebrtcTrackIdFromMWTrackId(c);a[c]=b;return a},{}));e(j,!0,s,!1);u.next=41;break;case 36:u.prev=36,u.t0=u["catch"](19),c("FBLogger")("rtc_www").catching(u.t0).warn("Failed to apply SMU"),e(q,!1,null,!1);case 41:case"end":return u.stop()}},null,this,[[19,36]])}function e(a,b){var e=c("ScotchRTCCallStore").getState(),f=e.remoteUsers;e=a.media;e.forEach(function(a){if(a.type===c("FBRTCMediaType").VIDEO){var e=f.find(function(b){return b.streams.find(function(b){return b.id.split(":")[0]==a.owner})}),g=a.pausedDownlink===d("ZenonMWMessageTypes").ZenonMWMediaPauseStatus.Paused;e!=null&&e.pausedDownlink!==g&&(c("ScotchRTCCallActions").updateRemoteUsers(f.map(function(a){return a===e?a.setPausedDownlink(g):a})),c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"pausedDownlink changed to "+g.toString()+" for user: "+e.FBID,callID:b==null?void 0:b.callID,conferenceName:b==null?void 0:b.conferenceName,callType:"mw"}))}})}g._videoEnabled=f;g.serverMediaUpdate=a;g.maybeUpdatePausedDownlink=e}),98);
__d("ScotchgenerateRTCCallID",["randomInt"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("randomInt")(0,4294967294)+1}g["default"]=a}),98);
__d("ZenonPlatformExperiments",["ZenonInfraActionsLogger","gkx","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){return 60}function b(){var a;return(a=c("qex")._("1426589"))!=null?a:!0}function d(){var a;a=(a=c("gkx")("1450329"))!=null?a:!1;a&&c("ZenonInfraActionsLogger").logCheckpointOnceForDomain({checkpoint:"gk: rtc_www_lobby_mode"});return a}function e(){var a=c("gkx")("1418215");a&&c("ZenonInfraActionsLogger").logCheckpointOnceForDomain({checkpoint:"gk: rtc_www_state_sync"});return a}g.getOpusPtimeMungeValue=a;g.isOpusMungeEnabled=b;g.shouldUseLobbyMode=d;g.shouldUseStateSync=e}),98);
__d("ScotchRTCMultiwayMessageHandler",["CurrentUser","FBMqttChannel","FBRTCDeviceStatus","FBRTCHangupReason","FBRTCRtcResponseStatusCode","Promise","Run","ScotchConstants","ScotchFBRTCMultiwayMessage","ScotchFBRTCTransactions","ScotchMWDeviceCapabilities","ScotchMultiwayParticipantFetcher","ScotchRTCCallActions","ScotchRTCCallStore","ScotchRTCGroupCallActions","ScotchRTCLogger","ScotchRTCMWProtocolHandler","ScotchRTCMWSessionDescription","ScotchRTCMWThreadDeltaHandler","ScotchRTCProxyUserStore","ScotchRTCProxyUserUtils","ScotchRTWebExperiments","ScotchRTWebUserActionLogger","ScotchgenerateRTCCallID","ZenonPlatformExperiments","cr:1420073","gkx","immutable","performanceNow","promiseDone","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h=15e3;a=function(){function a(){var a=this;this.$3=-1;this.$6=[];this.$7=!1;this.$8=new(d("ScotchFBRTCTransactions").FBRTCTransactionOwner)();this.$9();d("Run").onUnload(function(){c("FBMqttChannel").unsubscribeAll("/rtc_multi")});var b=null,e=0;c("FBMqttChannel").subscribeChannelEvents({onMQTTStateChanged:function(d){if(d==="Disconnected"&&b==null)b=c("performanceNow")();else if(d==="Connecting")e++;else if(d==="Connected"&&b!=null){var f=c("performanceNow")()-b;a.logMQTTConnectStats(f,e);b=null;e=0}a.logMQTTStateChange(d)}})}var e=a.prototype;e.logMQTTStateChange=function(a){c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"onMQTTStateChanged: "+a+", document.visibility: "+document.visibilityState+", document.hasFocus: "+String(document.hasFocus())+", navigator.onLine: "+String(navigator.onLine)})};e.logMQTTConnectStats=function(a,b){c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"MQTT Connection time: "+String(a)+"ms, Retry Count: "+String(b)})};e.initialize=function(a,b,c,d){this.$1=a,this.$2=b,this.$4=c,this.$5=d};e.setShouldDeferServerRequests=function(a){this.$7=a;if(this.$7===!1)while(this.$6.length>0)this.$10(this.$6.shift())};e.waitForSignalingConnected=function(){var a=this;return new(b("Promise"))(function(b,d){if(c("FBMqttChannel").getConnectionState()==="Connected")b();else{c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"MQTT not connected, deferring JOIN request",conferenceName:a.$1});c("ScotchRTWebUserActionLogger").startTimer("MQTT not connected");var e={onMQTTStateChanged:function(a){a==="Connected"&&(c("ScotchRTWebUserActionLogger").logStopTimer({checkpointName:"MQTT connected after deferring JOIN request",timerName:"MQTT not connected"}),c("FBMqttChannel").unsubscribeChannelEvents(e),window.clearTimeout(f),b())}},f=window.setTimeout(function(){c("FBMqttChannel").unsubscribeChannelEvents(e),c("ScotchRTWebUserActionLogger").logStopTimer({checkpointName:"MQTT never connected. Current status: "+c("FBMqttChannel").getConnectionState(),timerName:"MQTT not connected"}),d("timeout")},h);c("FBMqttChannel").subscribeChannelEvents(e)}})};e.$9=function(){var a=this;c("FBMqttChannel").subscribe("/rtc_multi",function(b){b=JSON.parse(b);a.$11(b)})};e.$11=function(a){var b=this,d=new(c("ScotchFBRTCMultiwayMessage"))(a);a=c("ScotchRTCCallStore").getState().callID;var e=c("ScotchRTCCallStore").getState().callInfo.conferenceState;c("ScotchRTCLogger").getInstance().logMultiwayMessageReceived(d,a);if(!d.isRequest())return;if(this.$1===d.conferenceName())this.$7===!0?this.$6.push(d):this.$10(d);else if(d.ringRequest()&&!this.$4&&e!=="TERMINATED"&&e!=="TERMINATING"){var f=this.$8.getTransaction(d);c("promiseDone")(f.start(),function(a){var e=c("ScotchgenerateRTCCallID")();c("promiseDone")(f.sendResponse(b.$12(a,e)),function(){return c("ScotchRTCMWProtocolHandler").otherUserInAnotherCall(d.conferenceName(),d.serverInfoData(),c("FBRTCHangupReason").IN_ANOTHER_CALL,e.toString(),"InAnotherCall")})})}};e.$12=function(a,b){var e=a.ringRequest(),f=a.serverInfoData();if(e==null||f==null)return a.createResponse(c("FBRTCRtcResponseStatusCode").BAD_REQUEST,{});e={deviceCapabilities:d("ScotchMWDeviceCapabilities").getDeviceCapabilities(),deviceStatus:c("FBRTCDeviceStatus").OK};return a.createResponse(c("FBRTCRtcResponseStatusCode").OK,{body:{ringResponse:e},callID:b.toString()})};e.$13=function(a,b){c("promiseDone")(a.sendResponse(b.createResponse(c("FBRTCRtcResponseStatusCode").OK,{})))};e.$10=function(a){var e=this,f=this.$8.getTransaction(a);c("promiseDone")(f.start().then(function(g){if(g!=null){var h=c("ScotchRTCCallStore").getState(),i=h.callInfo;c("ScotchRTCLogger").getInstance().logServerRequestStartProcessing(a,i.callID);if(g.dismissRequest()!=null)g.serverInfoData()===i.serverInfoData&&(d("ScotchRTCGroupCallActions").handleDismissRequest(f,g),h.connections.forEach(function(a){return a.close()}),e.$5||c("ScotchRTCCallActions").removeAllLocalStreams(!0));else if(g.serverMediaUpdateRequest()!=null){var j=g.serverMediaUpdateRequest();d("ScotchRTCProxyUserUtils").setProxyingAsUsersFromMessage(j);d("ScotchRTCMWSessionDescription").serverMediaUpdate(g.serverMediaUpdateRequest(),function(b,e,h,k){k?c("ScotchRTCLogger").getInstance().logServerRequestFailedProcessing(a,i.callId,"Peer connection should not be null when receiving SMU"):d("ScotchRTCGroupCallActions").onServerMediaUpdateSuccess();k=e||j.renegotiationRequested?c("FBRTCRtcResponseStatusCode").OK:c("FBRTCRtcResponseStatusCode").CONDITIONAL_REQUEST_FAILED;e=f.id;var l=h!=null;c("gkx")("2890")&&c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchRTCMWSessionDescription_serverMediaUpdate response: "+JSON.stringify({statusCode:k,currentVersion:b,transactionId:e,hasAnswer:l}),callID:i.callID,conferenceName:i.conferenceName,callType:"mw"});c("ScotchRTCLogger").getInstance().logServerRequestDoneProcessing(a,i.callId);e={currentVersion:b};h!=null&&(e.answer={sdpString:h==null?void 0:h.toSdp()});f.sendResponse(g.createResponse(k,{body:{serverMediaUpdateResponse:e},callID:i.callID}));c("ScotchRTCMWProtocolHandler").resubscribeToRemoteFbids()},i,f);if(j.renegotiationRequested){if(!d("ZenonPlatformExperiments").shouldUseLobbyMode()){c("recoverableViolation")("[WR] SMU with renegotiation requested set to true but lobby mode disabled","rtc_www");c("ScotchRTCLogger").getInstance().logServerRequestFailedProcessing(a,i.callId,"SMU with renegotiation requested set to true but lobby mode disabled");return}c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"[WR] Received SMU with renegotiation requested, sending CMU with offer",conferenceName:e.$1});h=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.MULTIWAY);if(h==null){c("recoverableViolation")("Peer connection should not be null when receiving SMU","rtc_www");c("ScotchRTCLogger").getInstance().logServerRequestFailedProcessing(a,i.callId,"Peer connection should not be null when receiving SMU");return}var k=h.getLocalDescription(),l=k.sessionDescription.getVersion(),m=l+1;k.sessionDescription.setVersion(m);h.setLocalDescription(k);var n={},o=[];h=h.getLocalStreams();h.forEach(function(a){o=o.concat(a.getTracks())});o.forEach(function(a){n[a.id]=a.enabled});c("ScotchRTCMWProtocolHandler").clientMediaUpdate(c("ScotchRTCCallStore").getState().callInfo.conferenceName,c("ScotchRTCCallStore").getState().callInfo.serverInfoData,l,m,[{mediaStatus:n}],k)}if(b("cr:1420073")!=null&&j.stateStore!=null&&Object.keys(j.stateStore).length>0){h=Object.keys(j.stateStore);for(var l=0;l<h.length;l++){m=h[l];c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"[SS] SMU request with ss payload for topic: "+m+" was received",conferenceName:e.$1});k=j.stateStore[m];b("cr:1420073").setOutputState(m,k)}}}else if(g.notifyRequest()!=null){if(b("cr:1420073")==null)return;m=g.notifyRequest();k=m.topic;h=m.version;l=m.data;c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"[SS] Notify request for topic: "+k+" was received",conferenceName:e.$1});if(d("ScotchRTWebExperiments").shouldSubscribeToSimpleTopicOnJoin()&&k.localeCompare("simple_external")==0){c("ScotchRTCLogger").getInstance().logCallAction(null,e.$1,"STATE_SYNC_OUTPUT_NOTIFY_REQUEST","received output state: "+((m=l)!=null?m:"")+" on join response for topic simple_external",null)}b("cr:1420073").setOutputState(k,{version:h,data:l});f.sendResponse(g.createResponse(c("FBRTCRtcResponseStatusCode").OK,{body:{notifyResponse:{topic:k,version:h}},callID:i.callID}))}else if(g.conferenceStateRequest()!=null){m=g.conferenceStateRequest();c("gkx")("1509739")&&c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchRTCMWSessionDescription_CSU received version "+String(m.version),callID:i==null?void 0:i.callID,conferenceName:i==null?void 0:i.conferenceName,callType:"mw"});l=c("ScotchRTCCallStore").getState();k=l.remoteUsers;var p=k.map(function(a){return a.FBID});h=Object.keys(m.participantStates);l=h.filter(function(a){return a!==c("CurrentUser").getID()&&!p.has(a)});d("ScotchRTCMWThreadDeltaHandler").processThreadUpdateFromSignaling(m);if(l.length>0){k=d("ScotchRTCProxyUserUtils").setProxyingAsUsersFromMessage(m);var q=new Set(l);k!=null&&k.forEach(function(a,b){q["delete"](b),a!==null&&!q.has(a)&&q.add(a)});h=c("ScotchRTCProxyUserStore").getState();m=h.proxyingAsToProxyUser;c("promiseDone")(d("ScotchMultiwayParticipantFetcher").fetchAllParticipants(e.$1,c("immutable").Set(q),{profileImageSize:100,proxyingAsToProxyUser:m}),function(a){d("ScotchRTCGroupCallActions").onParticipantsAdded(a.toJS()),d("ScotchRTCGroupCallActions").handleConferenceStateRequest(f,g,e.$3,function(a){e.$3=a})},function(b){c("ScotchRTCLogger").getInstance().logServerRequestFailedProcessing(a,i.callId,b),c("gkx")("1509739")&&c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchRTCMWSessionDescription_CSU fetchAllParticipants failed "+b,callID:i==null?void 0:i.callID,conferenceName:i==null?void 0:i.conferenceName,callType:"mw"})})}else d("ScotchRTCGroupCallActions").handleConferenceStateRequest(f,g,e.$3,function(a){e.$3=a})}else if(g.startScreenSharingRequest()!=null){l=g.startScreenSharingRequest();d("ScotchRTCGroupCallActions").addRemoteScreenSharingUserID(l);e.$13(f,g)}else if(g.endScreenSharingRequest()!=null){k=g.endScreenSharingRequest();d("ScotchRTCGroupCallActions").removeRemoteScreenSharingUserID(k);e.$13(f,g)}}}))};return a}();g["default"]=a}),98);
__d("ScotchRTCP2PCallWindowHandler",["ScotchRTCCallStore","ScotchRTCP2PCallStore","ScotchRTWebUserActionLogger","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){if(this._isWindowOpened())return;h=a;this.updateCallInProgressIndicator();this._monitorOpenerForChanges()}function b(a){if(!this._isWindowOpened())return;var b=c("ScotchRTCCallStore").getState();b=b.remoteUsers;a=a?a:c("ScotchRTCP2PCallStore").getState().connectionStatus;!b.count()||a==="DISCONNECTED"?h.rtcCallInProgessWith=null:h.rtcCallInProgessWith=b.first().FBID.toString()}function d(){this._isWindowOpened()&&h.location.reload()}function e(){this._isWindowOpened()&&h.close()}function f(){var a=this;if(h.opener)try{h.opener.addEventListener("unload",function(b){a._passWindowToOpener()})}catch(a){}}function i(a){var b=this;a===void 0&&(a=10);c("setTimeout")(function(){if(!b._isWindowOpened()||a<=1)return;try{if(h.opener&&!h.opener.closed){h.opener.rtcCallChildWindow=h;return}}catch(a){c("ScotchRTWebUserActionLogger").logErrorOnceforDomain("RTCP2PCallWindowHandler__passWindowToOpener",a)}b._passWindowToOpener(a-1)},1e3)}function j(){return!!(h&&!h.closed)}g.init=a;g.updateCallInProgressIndicator=b;g.reload=d;g.close=e;g._monitorOpenerForChanges=f;g._passWindowToOpener=i;g._isWindowOpened=j}),98);
__d("XScreenSharingController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/screen_sharing/",{peer_id:{type:"FBID",required:!0},version:{type:"Int"}})}),null);
__d("ScotchRTCScreenSharingWindowHandler",["ScotchRTCP2PCallActions","ScotchRTCUtils","SecurePostMessage","XScreenSharingController","promiseDone"],(function(a,b,c,d,e,f,g){var h=540,i=960,j;function a(a,b,e){var f=this;j=window.open("about:blank","Screen Sharing",this._getWindowFeatures());window.callInfo=e;c("promiseDone")(d("ScotchRTCUtils").getStreamVideoResolution(b)["catch"](function(c){f._setupScreenSharingWindow(a,b,null)}),function(c){f._setupScreenSharingWindow(a,b,c)})}function b(a,b,c){var d=this;window.getRemoteMediaStream=function(){return b};window.closeScreenSharingWindow=this._onUnload;if(c){c=this._getConstrainedSize(c.width,c.height);var e=c.width,f=c.height;j.resizeTo(e,f);window.setTimeout(function(){d._adjustScreenSize({width:e,height:f})},200)}j.location=this._getUnsignedUri(a);window.focus&&this.isWindowOpened()&&j.focus()}function e(a){if(!j)return;j.resizeTo(a.width,a.height+(a.height-j.innerHeight))}function f(){if(j){var a=null;j.opener&&!j.opener.closed&&(a=j.opener);j.close();j=null;a&&d("SecurePostMessage").sendMessageAllowAnyOrigin_UNSAFE(a,{recipient:"SC_CONTENT_SCRIPT",type:"SC_RESET_PORT",text:"reset comm port"})}}function k(){return!!(j&&!j.closed)}function l(){d("ScotchRTCP2PCallActions").togglePopOutScreenContent()}function m(){var a=screen.availLeft,b=screen.availTop,c=this._getConstrainedSize(Math.min(i,screen.width-a),Math.min(h,screen.height-b)),d=c.width;c=c.height;c={height:"height="+c.toString(),width:"width="+d.toString(),top:"top="+b.toString(),left:"left="+a.toString()};return["menubar=no","location=no","scrollbars=no","status=no","personalbar=no",c.height,c.width,c.top,c.left].join(",")}function n(a,b){var c;a>i&&(c=i/a,b*=c,a*=c);b>h&&(c=h/b,a*=c,b*=c);return{width:a,height:b}}function o(a){return c("XScreenSharingController").getURIBuilder().setFBID("peer_id",a).setInt("version",2).getURI()}g.open=a;g._setupScreenSharingWindow=b;g._adjustScreenSize=e;g.close=f;g.isWindowOpened=k;g._onUnload=l;g._getWindowFeatures=m;g._getConstrainedSize=n;g._getUnsignedUri=o}),98);
__d("ScotchRTCP2PCallActions",["ScotchRTCAppDispatcher","ScotchRTCP2PCallWindowHandler"],(function(a,b,c,d,e,f,g){"use strict";function a(){d("ScotchRTCP2PCallWindowHandler").reload()}function b(a){c("ScotchRTCAppDispatcher").dispatch({type:"SET_CALL_TYPE",callType:a})}function e(a){c("ScotchRTCAppDispatcher").dispatch({type:"SET_CONNECTION_STATUS",connectionStatus:a})}function f(a,b){c("ScotchRTCAppDispatcher").dispatch({type:"SET_MULTIWAY_ESCALATION_SUPPORT",offerEscalationSupport:a,escalationConferenceName:b})}function h(a){c("ScotchRTCAppDispatcher").dispatch({type:"SET_REMOTE_SIGNALING_EXPERIMENTS",remoteSignalingExperiments:a})}function i(a){c("ScotchRTCAppDispatcher").dispatch({type:a?"POP_OUT_SCREEN_CONTENT":"POP_IN_SCREEN_CONTENT",stream:a})}function j(a){c("ScotchRTCAppDispatcher").dispatch({type:"P2P_PROCESS_MESSAGE",message:a})}function k(a){c("ScotchRTCAppDispatcher").dispatch({type:"P2P_SET_IS_CALLER",isCaller:a})}function l(a){c("ScotchRTCAppDispatcher").dispatch({type:a?"SHOW_POOR_NETWORK_QUALITY":"DISMISS_POOR_NETWORK_QUALITY"})}function m(a){a===void 0&&(a=!0),c("ScotchRTCAppDispatcher").dispatch({type:"P2P_STAR_RATING_DONE",done:a})}g.reload=a;g.setCallType=b;g.setConnectionStatus=e;g.setMultiwayEscalationSupport=f;g.setRemoteSignalingExperiments=h;g.togglePopOutScreenContent=i;g.processMessage=j;g.setIsCaller=k;g.togglePoorNetworkQualityIndicator=l;g.starRatingDone=m}),98);
__d("ScotchFBRTCClientMediaUpdateReducer",["FBRTCRtcResponseStatusCode","ScotchConstants","ScotchFBRTCMWProtocolStore","ScotchRTCCallStore","ScotchRTCMWProtocolHandler","ScotchRTWebUserActionLogger","flatMapArray"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(b.type){case"RESET":return c("ScotchFBRTCMWProtocolStore").getInitialState()}return a}function b(a,b){switch(b.type){case"AUDIO_MUTED":return k(a,"audio",!1);case"AUDIO_UNMUTED":return k(a,"audio",!0)}return a}function e(a,b){switch(b.type){case"ADD_LOCAL_SCREEN_STREAM":return k(a,"video",!0);case"REMOVE_LOCAL_SCREEN_STREAM":return k(a,"video",!c("ScotchRTCCallStore").getState().localUser.isVideoDisabled())}return a}function f(a,b){var d=c("ScotchRTCCallStore").getState();d=d.localUser;if(d&&d.hasScreenStream())return a;switch(b.type){case"VIDEO_MUTED":return k(a,"video",!1);case"VIDEO_UNMUTED":return k(a,"video",!0)}return a}function h(a,b){switch(b.type){case"ON_CLIENT_MEDIA_UPDATE_RESPONSE":b.responseStatusCode===c("FBRTCRtcResponseStatusCode").OK&&(a=a.setIn(["clientMediaUpdateInfo","lastSyncedClientVersion"],b.currentVersion));if(a.clientMediaUpdateInfo.pendingResponse){a=a.setIn(["clientMediaUpdateInfo","pendingResponse"],!1);if(a.clientMediaUpdateInfo.pendingUpdate)return l(a.setIn(["clientMediaUpdateInfo","pendingUpdate"],!1))}return a}return a}function i(a,b){switch(b.type){case"SET_LOCAL_CLIENT_VERSION":return a.setIn(["clientMediaUpdateInfo","lastSyncedClientVersion"],b.version).setIn(["clientMediaUpdateInfo","localMediaUpdates"],a.clientMediaUpdateInfo.localMediaUpdates.push({mediaStatus:{}}))}return a}function j(a,b){switch(b.type){case"ON_LOCAL_TRACK_REPLACED":var c=b.newTrack;b=b.oldTrack;if(b==null)return a;var d=a.clientMediaUpdateInfo.localToMWSTrackIDMap.get(b.id);d!=null?a=a.setIn(["clientMediaUpdateInfo","localToMWSTrackIDMap"],a.clientMediaUpdateInfo.localToMWSTrackIDMap["delete"](b.id)):d=b.id;return a.setIn(["clientMediaUpdateInfo","localToMWSTrackIDMap"],a.clientMediaUpdateInfo.localToMWSTrackIDMap.set(c.id,d))}return a}function k(a,b,e){var f=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.MULTIWAY);if(!f)return a;var g={};f=c("ScotchRTCCallStore").getState();f=f.localUser;var h=a.clientMediaUpdateInfo.localToMWSTrackIDMap;c("flatMapArray")([f.getScreenStream(),f.getStream()],function(a){return a!=null?a.getTracks():[]}).forEach(function(a){var c=h.get(a.id)||a.id;g[c]==null&&(g[c]=a.kind===b?e:a.enabled)});return l(a.setIn(["clientMediaUpdateInfo","localMediaUpdates"],a.clientMediaUpdateInfo.localMediaUpdates.push({mediaStatus:g})))}function l(a){if(a.clientMediaUpdateInfo.pendingResponse){c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchFBRTCClientMediaUpdateReducer.sendClientMediaUpdate: not sending CMU because there is one pending."});return a.setIn(["clientMediaUpdateInfo","pendingUpdate"],!0)}var b=a.clientMediaUpdateInfo.localMediaUpdates.reduce(function(b,c,d){d>=a.clientMediaUpdateInfo.lastSyncedClientVersion&&b.push(c);return b},[]);if(b.length===0)return a;c("ScotchRTCMWProtocolHandler").clientMediaUpdate(c("ScotchRTCCallStore").getState().callInfo.conferenceName,c("ScotchRTCCallStore").getState().callInfo.serverInfoData,a.clientMediaUpdateInfo.lastSyncedClientVersion,a.clientMediaUpdateInfo.localMediaUpdates.size,b);return a.setIn(["clientMediaUpdateInfo","pendingResponse"],!0)}g.reset=a;g.configureAudio=b;g.configureScreenSharing=e;g.configureVideo=f;g.onClientMediaUpdateResponse=h;g.setLocalClientVersion=i;g.onLocalTrackReplaced=j}),98);
__d("ScotchFBRTCGroupCallParticipantsReducer",["MercuryIDs","ScotchRTCCallStore","ScotchRTCMWProtocolHandler","immutable"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set();function a(a,b){var c;switch(b.type){case"INIT_THREAD":return a.merge({participants:(c=b.participants)!=null?c:a.participants,thread:b.thread})}return a}function b(a,b){switch(b.type){case"ON_PARTICIPANT_LEFT":return a.set("participants",a.participants["delete"](d("MercuryIDs").getParticipantIDFromUserID(b.participantFBID)));case"ON_PARTICIPANTS_ADDED":var e=Object.keys(b.participants).map(function(a){return b.participants[a].fbid}).filter(function(a){return h.has(a)});e.length!==0&&(e.forEach(function(a){return h["delete"](a)}),c("ScotchRTCMWProtocolHandler").addParticipants(c("ScotchRTCCallStore").getState().callInfo.conferenceName,c("ScotchRTCCallStore").getState().callInfo.serverInfoData,e));return a.set("participants",a.participants.merge(c("immutable").Map(b.participants)))}return a}function e(a,b){switch(b.type){case"ADD_PARTICIPANTS_TO_RING":b.participantFBIDs.forEach(function(a){return h.add(a)});return a}return a}g._participantsToRing=h;g.initThread=a;g.onParticipantsChanged=b;g.addParticipantsToRing=e}),98);
__d("ScotchRTCStreamDurationTracker",["performanceNow"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){var b=this;a===void 0&&(a="mixed");this.$3=0;this.$4=0;this.$5=!1;this.update=function(){if(!b.$5)return;b.$6()?b.$4===0&&(b.$4=c("performanceNow")()):b.pause(b.$2)};this.$1=a}var b=a.prototype;b.isStarted=function(){return this.$5};b.track=function(a){if(a===this.$2){this.update();return}if(this.$2&&this.$5){var b=this.$2;b.removeEventListener("addtrack",this.update);b.removeEventListener("removetrack",this.update)}a?(this.$5&&this.$6()&&(this.$3=this.getDuration()),this.$2=a,this.$5&&this.start()):this.stop()};b.$6=function(){return!this.$2?!1:this.$7().some(function(a){return a.enabled&&a.readyState!=="ended"})};b.$7=function(){if(!this.$2)return[];switch(this.$1){case"audio":return this.$2.getAudioTracks();case"video":return this.$2.getVideoTracks();case"screen":return this.$2.getVideoTracks();default:return this.$2.getTracks()}};b.pause=function(a){if(!this.$5)return;if(this.$2!==a)return;this.$3=this.getDuration();this.$4=0};b.getDuration=function(){return this.$4===0?this.$3:this.$3+c("performanceNow")()-this.$4};b.start=function(){this.$5=!0;this.$6()&&(this.$4=c("performanceNow")());if(this.$2){var a=this.$2;a.addEventListener("addtrack",this.update);a.addEventListener("removetrack",this.update)}};b.stop=function(){if(!this.$5)return;this.$3=this.getDuration();this.$5=!1;this.$4=0;if(this.$2){var a=this.$2;a.removeEventListener("addtrack",this.update);a.removeEventListener("removetrack",this.update)}};return a}();g["default"]=a}),98);
__d("ScotchFBRTCGroupCallStoreState",["ScotchRTCStreamDurationTracker","immutable"],(function(a,b,c,d,e,f,g){"use strict";a={localVideoDurationTracker:new(c("ScotchRTCStreamDurationTracker"))("video"),remoteVideoDurationTracker:new(c("ScotchRTCStreamDurationTracker"))("video"),localScreenDurationTracker:new(c("ScotchRTCStreamDurationTracker"))("screen")};b=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("immutable").Record(a));d={dominantSpeakerFBID:null,endCallReason:null,responseSubCode:null,layout:null,participants:c("immutable").Map(),pinnedSpeakerFBID:null,thread:null,videoDurationTrackerInfo:new b(),forceEncodingEnabled:!1,videoEscalateState:"initial",localVideoStream:null};e=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("immutable").Record(d));g["default"]=e}),98);
__d("ScotchFBRTCGroupCallReducer",["FBRTCParticipantCallState","ScotchConstants","ScotchFBRTCGroupCallStoreState","ScotchRTCCallStore","ScotchRTCEndCallReason","ScotchRTCMWProtocolHandler"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(b.type){case"SET_DOMINANT_SPEAKER":return a.set("dominantSpeakerFBID",b.dominantSpeakerFBID);case"SET_PINNED_SPEAKER":var e=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.MULTIWAY);return!e?a:a.set("pinnedSpeakerFBID",b.pinnedSpeakerFBID);case"ON_CONFERENCE_STATE":e=b.request.conferenceStateRequest();b=e.participantStates;e=b[a.pinnedSpeakerFBID];return e&&e.state!==c("FBRTCParticipantCallState").CONNECTED?a.set("pinnedSpeakerFBID",null):a}return a}function b(a,b){switch(b.type){case"SET_LAYOUT":return a.set("layout",b.layout)}return a}function e(a,b){switch(b.type){case"CALL_ERROR":case"HANGUP":case"END_CALL":case"DISMISS":return a.set("endCallReason",b.endCallReason!=null?new(c("ScotchRTCEndCallReason"))(b.endCallReason):a.endCallReason)}return a}function f(a,b){switch(b.type){case"FORCE_ENCODING_ENABLED":var e=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.MULTIWAY);e&&c("ScotchRTCMWProtocolHandler").updateLocalEncodingActive(e,b.enabled);return a.set("forceEncodingEnabled",b.enabled)}return a}function h(a,b){switch(b.type){case"MW_VIDEO_ESCALATION_STARTED":return a.set("videoEscalateState","inProgress")}return a}function i(a,b){switch(b.type){case"MW_VIDEO_ESCALATION_COMPLETED":return a.set("videoEscalateState","escalated")}return a}function j(a,b){switch(b.type){case"RESET":case"RESET_FOR_REDIAL":return new(c("ScotchFBRTCGroupCallStoreState"))();case"MW_VIDEO_ESCALATION_RESET":return a.set("videoEscalateState","initial")}return a}g.setDominantSpeaker=a;g.setLayout=b;g.processEndCallReason=e;g.onForceEncodingChanged=f;g.onVideoEscalationStarted=h;g.onVideoEscalationCompleted=i;g.onReset=j}),98);
__d("RTCCallActionTypes",[],(function(a,b,c,d,e,f){a=Object.freeze({CALL:"CALL",CALL_SUCCESS:"CALL_SUCCESS",CALL_ERROR:"CALL_ERROR",INCOMING_CALL_SUCCESS:"INCOMING_CALL_SUCCESS",INIT:"INIT",RESET:"RESET",RESET_FOR_REDIAL:"RESET_FOR_REDIAL",CALL_COLLISION:"CALL_COLLISION",WAIT_FOR_USER_INPUT:"WAIT_FOR_USER_INPUT",SET_CALL_SUMMARY:"SET_CALL_SUMMARY",SET_MW_CALL_TYPE:"SET_MW_CALL_TYPE",SET_LAYOUT:"SET_LAYOUT",SET_LINKHASH:"SET_LINKHASH",SET_DOMINANT_SPEAKER:"SET_DOMINANT_SPEAKER",SET_PINNED_SPEAKER:"SET_PINNED_SPEAKER",SET_USE_DOMINANT_SPEAKE_VIEW:"SET_USE_DOMINANT_SPEAKE_VIEW",SET_GRID_VIEW:"SET_GRID_VIEW",SET_STRIP_VIEW:"SET_STRIP_VIEW",INIT_THREAD:"INIT_THREAD",ON_PARTICIPANT_LEFT:"ON_PARTICIPANT_LEFT",ON_PARTICIPANTS_ADDED:"ON_PARTICIPANTS_ADDED",ADD_PARTICIPANTS_TO_RING:"ADD_PARTICIPANTS_TO_RING",JOIN:"JOIN",JOIN_SUCCESS:"JOIN_SUCCESS",JOIN_ERROR:"JOIN_ERROR",HANGUP:"HANGUP",HANGUP_SUCCESS:"HANGUP_SUCCESS",HANGUP_ERROR:"HANGUP_ERROR",ON_CONFERENCE_STATE:"ON_CONFERENCE_STATE",DISMISS:"DISMISS",END_CALL:"END_CALL",ON_JOIN_REQUEST_SENT:"ON_JOIN_REQUEST_SENT",ON_JOIN_RESPONSE:"ON_JOIN_RESPONSE",ON_RECEIVED_JOIN_RESPONSE:"ON_RECEIVED_JOIN_RESPONSE",ON_PROCESSED_JOIN_RESPONSE:"ON_PROCESSED_JOIN_RESPONSE",ON_SERVER_MEDIA_UPDATE_SUCCESS:"ON_SERVER_MEDIA_UPDATE_SUCCESS",ON_CLIENT_MEDIA_UPDATE_RESPONSE:"ON_CLIENT_MEDIA_UPDATE_RESPONSE",SET_LOCAL_CLIENT_VERSION:"SET_LOCAL_CLIENT_VERSION",INIT_LOCAL_USER:"INIT_LOCAL_USER",INIT_REMOTE_USERS:"INIT_REMOTE_USERS",UPDATE_REMOTE_USERS:"UPDATE_REMOTE_USERS",ADD_REMOTE_STREAM:"ADD_REMOTE_STREAM",REMOVE_REMOTE_STREAM:"REMOVE_REMOTE_STREAM",REMOVE_ALL_REMOTE_STREAMS:"REMOVE_ALL_REMOTE_STREAMS",ADD_REMOTE_TRACK:"ADD_REMOTE_TRACK",REMOVE_REMOTE_TRACK:"REMOVE_REMOTE_TRACK",AUDIO_MUTED:"AUDIO_MUTED",AUDIO_UNMUTED:"AUDIO_UNMUTED",VIDEO_MUTED:"VIDEO_MUTED",VIDEO_UNMUTED:"VIDEO_UNMUTED",REMOTE_AUDIO_MUTED:"REMOTE_AUDIO_MUTED",REMOTE_AUDIO_UNMUTED:"REMOTE_AUDIO_UNMUTED",REMOTE_VIDEO_MUTED:"REMOTE_VIDEO_MUTED",REMOTE_VIDEO_UNMUTED:"REMOTE_VIDEO_UNMUTED",SELF_VIEW_COLLAPSED:"SELF_VIEW_COLLAPSED",SELF_VIEW_UNCOLLAPSED:"SELF_VIEW_UNCOLLAPSED",ADD_LOCAL_STREAM:"ADD_LOCAL_STREAM",REMOVE_LOCAL_STREAM:"REMOVE_LOCAL_STREAM",REPLACE_LOCAL_STREAM:"REPLACE_LOCAL_STREAM",REMOVE_ALL_LOCAL_STREAMS:"REMOVE_ALL_LOCAL_STREAMS",STOP_LOCAL_STREAM:"STOP_LOCAL_STREAM",ADD_LOCAL_SCREEN_STREAM:"ADD_LOCAL_SCREEN_STREAM",REMOVE_LOCAL_SCREEN_STREAM:"REMOVE_LOCAL_SCREEN_STREAM",REMOVE_ALL_LOCAL_SCREEN_STREAMS:"REMOVE_ALL_LOCAL_SCREEN_STREAMS",REPLACE_LOCAL_SCREEN_STREAM:"REPLACE_LOCAL_SCREEN_STREAM",ADD_REMOTE_SCREEN_STREAM:"ADD_REMOTE_SCREEN_STREAM",REMOVE_REMOTE_SCREEN_STREAM:"REMOVE_REMOTE_SCREEN_STREAM",TOGGLE_REMOTE_STREAM:"TOGGLE_REMOTE_STREAM",SUBMIT_RATING:"SUBMIT_RATING",SUBMIT_FEEDBACK:"SUBMIT_FEEDBACK",SUBMIT_FEEDBACK_OPTIONS:"SUBMIT_FEEDBACK_OPTIONS",SUBMIT_SURVEY_CHOICE:"SUBMIT_SURVEY_CHOICE",RATING_SHOWN:"RATING_SHOWN",FEEDBACK_SHOWN:"FEEDBACK_SHOWN",SET_CONFERENCE_STATE:"SET_CONFERENCE_STATE",SET_END_CALL_REASON:"SET_END_CALL_REASON",FLOOR_STATUS:"FLOOR_STATUS",SET_INPUT_SYNC_STATE:"SET_INPUT_SYNC_STATE",SET_OUTPUT_SYNC_STATE:"SET_OUTPUT_SYNC_STATE",STATE_SYNC_SUBSCRIBE:"STATE_SYNC_SUBSCRIBE",STATE_SYNC_UNSUBSCRIBE:"STATE_SYNC_UNSUBSCRIBE",ADD_REMOTE_SCREEN_SHARING_USER_ID:"ADD_REMOTE_SCREEN_SHARING_USER_ID",REMOVE_REMOTE_SCREEN_SHARING_USER_ID:"REMOVE_REMOTE_SCREEN_SHARING_USER_ID",SET_PENDING_APPROVAL:"SET_PENDING_APPROVAL",FORCE_ENCODING_ENABLED:"FORCE_ENCODING_ENABLED",MW_VIDEO_ESCALATION_STARTED:"MW_VIDEO_ESCALATION_STARTED",MW_VIDEO_ESCALATION_COMPLETED:"MW_VIDEO_ESCALATION_COMPLETED",MW_VIDEO_ESCALATION_RESET:"MW_VIDEO_ESCALATION_RESET",ON_LOCAL_TRACK_REPLACED:"ON_LOCAL_TRACK_REPLACED"});f["default"]=a}),66);
__d("RTCGroupCallEscalationActionTypes",[],(function(a,b,c,d,e,f){a=Object.freeze({GROUP_ESCALATION_START:"GROUP_ESCALATION_START",GROUP_ESCALATION_SUCCESS:"GROUP_ESCALATION_SUCCESS",GROUP_ESCALATION_CANCEL:"GROUP_ESCALATION_CANCEL",GROUP_ESCALATION_SET_USERS_TO_RING:"GROUP_ESCALATION_SET_USERS_TO_RING",GROUP_ESCALATION_CLEAR_P2P_CONNECTION:"GROUP_ESCALATION_CLEAR_P2P_CONNECTION",GROUP_ESCALATION_SET_P2P_CALLSUMMARY:"GROUP_ESCALATION_SET_P2P_CALLSUMMARY",GROUP_ESCALATION_ADD_LOCAL_STREAM:"GROUP_ESCALATION_ADD_LOCAL_STREAM"});f["default"]=a}),66);
__d("intlList",["fbt","invariant","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i;a=i||b("react");var j={AND:"AND",NONE:"NONE",OR:"OR"},k={BULLET:"BULLET",COMMA:"COMMA",SEMICOLON:"SEMICOLON"};c=function(a,b,c){var d=a.length;if(d===0)return"";else if(d===1)return a[0];var e=a[d-1],f=a[0];for(var h=1;h<d-1;++h)switch(c){case k.SEMICOLON:f=g._("{previous items}; {following items}",[g._param("previous items",f),g._param("following items",a[h])]);break;case k.BULLET:f=g._("{previous items} \u2022 {following items}",[g._param("previous items",f),g._param("following items",a[h])]);break;default:f=g._("{previous items}, {following items}",[g._param("previous items",f),g._param("following items",a[h])])}return l(f,e,b||j.AND,c||k.COMMA)};function l(a,b,c,d){switch(c){case j.AND:return g._("{list of items} and {last item}",[g._param("list of items",a),g._param("last item",b)]);case j.OR:return g._("{list of items} or {last item}",[g._param("list of items",a),g._param("last item",b)]);case j.NONE:switch(d){case k.SEMICOLON:return g._("{previous items}; {last item}",[g._param("previous items",a),g._param("last item",b)]);case k.BULLET:return g._("{list of items} \u2022 {last item}",[g._param("list of items",a),g._param("last item",b)]);default:return g._("{list of items}, {last item}",[g._param("list of items",a),g._param("last item",b)])}default:h(0,568,c)}}c.DELIMITERS=k;c.CONJUNCTIONS=j;e.exports=c}),null);
__d("ScotchRTCNotificationUtils",["fbt","intlList"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a,b){if(b&&b.size>0){b=b.toArray().map(function(a){return a.short_name});b=a?h._("Adding {names of users being added to call} to your call...",[h._param("names of users being added to call",c("intlList")(b,c("intlList").CONJUNCTIONS.AND))]):h._("Adding {names of users being added to call} to your video chat...",[h._param("names of users being added to call",c("intlList")(b,c("intlList").CONJUNCTIONS.AND))])}else b=a?h._("Adding someone to your call..."):h._("Adding someone to your video chat...");return b}function b(a,b){if(b&&b.size>0){b=b.toArray().map(function(a){return a.short_name});return h._("Unable to add {names of users being added to call}",[h._param("names of users being added to call",c("intlList")(b,c("intlList").CONJUNCTIONS.OR))])}return a?h._("Unable to add person to your call"):h._("Unable to add person to your video chat")}g.addingUsersToCallText=a;g.unableToAddUsersToCallText=b}),98);
__d("ScotchRTCCallNotificationReducer",["ScotchRTCAppDispatcher","ScotchRTCCallStore","ScotchRTCGroupCallEscalationStore","ScotchRTCNotificationUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(b.type){case"GROUP_ESCALATION_START":b=!c("ScotchRTCCallStore").hasRemoteVideo()&&!c("ScotchRTCCallStore").hasLocalVideo();b=d("ScotchRTCNotificationUtils").addingUsersToCallText(b,c("ScotchRTCGroupCallEscalationStore").getState().usersToRing);return a.set("notificationText",b).set("useTimeout",!1)}return a}function b(a,b){switch(b.type){case"ON_CONFERENCE_STATE":c("ScotchRTCAppDispatcher").waitFor([c("ScotchRTCGroupCallEscalationStore").getDispatchToken()]);return c("ScotchRTCGroupCallEscalationStore").getState().readyToTransition?a.set("notificationText",null).set("useTimeout",!1):a}return a}function e(a,b){switch(b.type){case"GROUP_ESCALATION_CANCEL":b=!c("ScotchRTCCallStore").hasRemoteVideo()&&!c("ScotchRTCCallStore").hasLocalVideo();b=d("ScotchRTCNotificationUtils").unableToAddUsersToCallText(b,c("ScotchRTCGroupCallEscalationStore").getState().usersToRing);return a.set("notificationText",b).set("useTimeout",!0)}return a}function f(a,b){switch(b.type){case"HANGUP":case"END_CALL":case"HANGUP_ERROR":case"HANGUP_SUCCESS":return a.withMutations(function(a){a.set("notificationText",null).set("useTimeout",!0)})}return a}g.onEscalationStarted=a;g.onEscalationCompletion=b;g.onAbortedEscalation=e;g.clearStore=f}),98);
__d("ScotchRTCGroupCallEscalationStoreState",["immutable"],(function(a,b,c,d,e,f,g){a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("immutable").Record({aborted:!1,inProgress:!1,toRing:!1,p2pCallSummary:null,readyToTransition:!1,usersToRing:null}));g["default"]=a}),98);
__d("ScotchRTCGroupCallEscalationStoreReducer",["FBRTCParticipantCallState","ScotchRTCCallStore","ScotchRTCGroupCallEscalationStore","ScotchRTCGroupCallEscalationStoreState","ScotchRTCMWProtocolHandler","ScotchRTCP2PCallStore","ScotchRTWebUserActionLogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set([c("FBRTCParticipantCallState").UNKNOWN,c("FBRTCParticipantCallState").DISCONNECTED,c("FBRTCParticipantCallState").NO_ANSWER,c("FBRTCParticipantCallState").REJECTED,c("FBRTCParticipantCallState").UNREACHABLE,c("FBRTCParticipantCallState").CONNECTION_DROPPED,c("FBRTCParticipantCallState").PARTICIPANT_LIMIT_REACHED,c("FBRTCParticipantCallState").IN_ANOTHER_CALL,c("FBRTCParticipantCallState").RING_TYPE_UNSUPPORTED]);function a(a,b){switch(b.type){case"GROUP_ESCALATION_CANCEL":c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"group_escalation_cancel"});return a.withMutations(function(a){a.set("aborted",!0).set("inProgress",!1).set("toRing",!1).set("readyToTransition",!1).set("usersToRing",null)})}return a}function b(a,b){switch(b.type){case"HANGUP":case"END_CALL":case"HANGUP_ERROR":case"HANGUP_SUCCESS":return a.withMutations(function(a){a.set("aborted",!1).set("inProgress",!1).set("toRing",!1).set("usersToRing",null)});case"RESET":return new(c("ScotchRTCGroupCallEscalationStoreState"))()}return a}function d(a,b){switch(b.type){case"GROUP_ESCALATION_SET_P2P_CALLSUMMARY":var c=b.p2pCallSummary;if(c)return a.withMutations(function(a){a.set("p2pCallSummary",c)})}return a}function e(a,b){switch(b.type){case"GROUP_ESCALATION_START":c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"group_escalation_start"});return a.set("inProgress",!0).set("readyToTransition",!1)}return a}function f(a,b){if(!a.readyToTransition&&a.inProgress)switch(b.type){case"ON_JOIN_REQUEST_SENT":c("ScotchRTCGroupCallEscalationStore").logToP2PCallSummary(function(a){return a.setEscalationConnectingToMultiway()});break;case"ON_JOIN_RESPONSE":c("ScotchRTCGroupCallEscalationStore").logToP2PCallSummary(function(a){a.setEscalationConnectedToMultiway(),b.serverInfoData&&a.setServerInfoData(b.serverInfoData)});break}return a}function i(a,b){if(!a.readyToTransition&&a.inProgress)switch(b.type){case"ON_CONFERENCE_STATE":b=b.request.conferenceStateRequest();if(b){var d=b.participantStates;b=a.toRing;var e=!1,f=c("gkx")("2551")||Object.keys(d).every(function(a){return d[a].state===c("FBRTCParticipantCallState").CONNECTED});if(f){c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"group_escalation_success"});c("ScotchRTCGroupCallEscalationStore").logToP2PCallSummary(function(a){a.setEscalationPeerConnectedToMultiway(),a.setEscalationConnectedToMultiway(),a.setReadyToEscalate()});var g=c("ScotchRTCP2PCallStore").getState();g=g.protocolHandler;g.shutDownP2PListenersForMultiwayEscalation();if(a.usersToRing&&b){g=a.usersToRing.valueSeq().map(function(a){return a.fbid}).filter(Boolean).toArray();c("ScotchRTCMWProtocolHandler").addParticipants(c("ScotchRTCCallStore").getState().callInfo.conferenceName,c("ScotchRTCCallStore").getState().callInfo.serverInfoData,g);b=!1}}else e=Object.keys(d).some(function(a){return h.has(d[a].state)}),e&&c("ScotchRTCGroupCallEscalationStore").logToP2PCallSummary(function(a){return a.setInvalidP2PEscalationState()});return a.set("aborted",e).set("readyToTransition",f).set("inProgress",!(f||e)).set("toRing",b)}}return a}function j(a,b){switch(b.type){case"GROUP_ESCALATION_SET_USERS_TO_RING":if(b.usersToRing)return a.set("usersToRing",b.usersToRing).set("toRing",!0)}return a}g.abortEscalation=a;g.clearStore=b;g.setP2PCallSummary=d;g.callStart=e;g.onMultiwayConnectionSignaling=f;g.onParticipantsConnected=i;g.setUsersToRing=j}),98);
__d("ScotchRTCCallType",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({AUDIO_ONLY:"AUDIO_ONLY",VIDEO_ONLY:"VIDEO_ONLY",AUDIO_VIDEO:"AUDIO_VIDEO",NO_AUDIO_VIDEO:"NO_AUDIO_VIDEO"});b=a;f["default"]=b}),66);
__d("ScotchRTCP2PCallEscalationStoreState",["ScotchConstants","immutable"],(function(a,b,c,d,e,f,g){a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("immutable").Record({awaitingACK:!1,callType:d("ScotchConstants").CallType.VOIP,escalated:!1,escalateMediaStream:null,failureReason:null,initiatedEscalation:!1,inProgress:!1,request:null,response:null,token:null}));g["default"]=a}),98);
__d("ScotchRTCP2PCallEscalationStoreReducers",["ScotchConstants","ScotchRTCCallType","ScotchRTCP2PCallEscalationStoreState","ScotchRTCP2PCallEscalator","ScotchRTCP2PCallStore","ScotchRTWebUserActionLogger"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b){switch(b.type){case"P2P_CALL_ESCALATION_START":if(a.inProgress)return a;if(a.escalated||!c("ScotchRTCP2PCallStore").isAudioOnly())return a;c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"video_escalation_start"});return a.withMutations(function(a){a.set("awaitingACK",!0).set("initiatedEscalation",!0).set("failureReason",null).set("inProgress",!0).set("token",c("ScotchRTCP2PCallStore").getState().protocolHandler.generateEscalationRequestToken(!0))});case"P2P_CALL_ESCALATION_SUCCESS":if(!a.inProgress)return a;else if("token"in b&&b.token!==a.token)return a;c("ScotchRTCP2PCallEscalator").onEscalationSucceeded();c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"video_escalation_success"});return a.withMutations(function(a){a.set("awaitingACK",!1).set("callType",d("ScotchConstants").CallType.ESCALATED).set("escalated",!0).set("inProgress",!1).set("request",null).set("response",!0).set("token",null)});case"P2P_CALL_ESCALATION_FAILURE":if(!a.inProgress)return a;else if("token"in b&&b.token!==a.token)return a;c("ScotchRTCP2PCallEscalator").onEscalationFailed();if(b.reason==="denied"){c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"video_escalation_denied"});return a.withMutations(function(a){a.set("awaitingACK",!1).set("initiatedEscalation",!1).set("callType",d("ScotchConstants").CallType.ESCALATION_DECLINED).set("escalated",!1).set("failureReason",b.reason||null).set("inProgress",!1).set("request",null).set("response",b.response||null).set("token",null).set("escalateMediaStream",null)})}else b.reason==="cancelled"?c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"video_escalation_cancelled"}):b.reason==="timeout"?c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"video_escalation_timeout"}):c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"video_escalation_failed"});c("ScotchRTCP2PCallStore").getState().protocolHandler.generateEscalationRequestToken(!1);return a.withMutations(function(a){a.set("awaitingACK",!1).set("inProgress",!1).set("initiatedEscalation",!1).set("callType",d("ScotchConstants").CallType.ESCALATION_DECLINED).set("escalated",!1).set("failureReason",b.reason).set("token",null).set("escalateMediaStream",null)});case"SET_P2P_CALL_ESCALATION_MEDIA":return a.set("escalateMediaStream",b.stream);default:return a}};b=function(a,b){switch(b.type){case"P2P_CALL_ESCALATION_SET_REQUEST":var e=b.request;if(e==null)return a;return!c("ScotchRTCP2PCallEscalator").requestVideoOn(e.msg)?a.withMutations(function(a){a.set("awaitingACK",!1).set("inProgress",!1).set("request",null).set("response",null).set("token",null)}):a.withMutations(function(a){a.set("inProgress",!0).set("request",b.request).set("response",null).set("token",null)});case"P2P_CALL_ESCALATION_SET_RESPONSE":if(b.response==null)return a;else if(a.request==null)return a;return a.withMutations(function(a){a.set("awaitingACK",!0).set("callType",b.response?d("ScotchConstants").CallType.ESCALATED:d("ScotchConstants").CallType.ESCALATION_DECLINED).set("response",b.response).set("token",c("ScotchRTCP2PCallStore").getState().protocolHandler.generateEscalationResponseToken(a.request,b.response))});case"P2P_CALL_ESCALATION_ACK":if(b.token==null)return a;return a.response==null||a.request==null||b.token!==a.token||!a.awaitingACK?a:a.withMutations(function(a){a.set("awaitingACK",!1).set("callType",a.response?d("ScotchConstants").CallType.ESCALATED:d("ScotchConstants").CallType.ESCALATION_DECLINED).set("escalated",a.response).set("inProgress",!1).set("request",null).set("response",null).set("token",null)});default:return a}};e=function(a,b){switch(b.type){case"RESET":return new(c("ScotchRTCP2PCallEscalationStoreState"))();case"SET_CALL_TYPE":switch(b.callType){case c("ScotchRTCCallType").AUDIO_VIDEO:case c("ScotchRTCCallType").VIDEO_ONLY:return a.set("callType",d("ScotchConstants").CallType.DIRECT_VIDEO)}return a;case"P2P_CALL_ESCALATION_ACK":if(b.token==null)return a;if(!a.awaitingACK)return a;else if(b.token!==a.token)return a;return a.set("awaitingACK",!1);default:return a}};g.Alice=a;g.Bob=b;g.common=e}),98);
__d("ScotchRTCP2PCallReducer",["ScotchConstants","ScotchFBRTCUserCapabilities","ScotchRTCAppDispatcher","ScotchRTCCallStore","ScotchRTCCallType","ScotchRTCP2PCallEscalationStore","ScotchRTCP2PCallStoreState","ScotchRTCP2PCallWindowHandler","ScotchRTCP2PProtocolHandler","ScotchRTCScreenSharingWindowHandler","ScotchRTWebClientFeatureGating","ZenonDebugLogger","ZenonRTCConfig"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(b.type){case"INIT":var e=b.callType,f=b.isCaller,g=b.protocol;return g===d("ScotchConstants").SignalingProtocol.P2P&&e&&f!=null?a.set("protocolHandler",a.protocolHandler||new(c("ScotchRTCP2PProtocolHandler"))()).set("isCaller",f).set("callType",e):a;case"RESET":return new(c("ScotchRTCP2PCallStoreState"))();case"RESET_FOR_REDIAL":c("ScotchRTCAppDispatcher").waitFor([c("ScotchRTCCallStore").getDispatchToken()]);g=c("ScotchRTCCallStore").getState().remoteUsers.first();if(g==null)return a;a.protocolHandler.destroy();return a.set("connectionStatus","INIT").set("endCallReason",null).set("protocolHandler",new(c("ScotchRTCP2PProtocolHandler"))().init(g.FBID,Number(b.conferenceName))).set("signalingExperiments",new(c("ScotchFBRTCUserCapabilities"))());case"CALL_COLLISION":c("ScotchRTCAppDispatcher").waitFor([c("ScotchRTCCallStore").getDispatchToken()]);a.protocolHandler.init(b.peerID,Number(b.conferenceName));return a.set("connectionStatus","INIT").set("endCallReason",null).set("signalingExperiments",new(c("ScotchFBRTCUserCapabilities"))());default:return a}}function b(a,b){switch(b.type){case"HANGUP":case"DISMISS":case"HANGUP_ERROR":case"HANGUP_SUCCESS":case"END_CALL":case"REMOVE_REMOTE_SCREEN_STREAM":case"RESET_FOR_REDIAL":d("ScotchRTCScreenSharingWindowHandler").close();return a.withMutations(function(a){return a.set("isScreenContentPoppedOut",d("ScotchRTCScreenSharingWindowHandler").isWindowOpened()).set("isRedialFooterButtonShown",(d("ScotchRTWebClientFeatureGating").shouldAlwaysShowRedial()||c("ScotchRTCP2PProtocolHandler").showRedialButton())&&!d("ZenonRTCConfig").getIsVCEndpointCall()).set("isStarRatingShown",c("ScotchRTCP2PProtocolHandler").showStarRating())});default:return a}}function e(a,b){switch(b.type){case"SET_CALL_TYPE":return a.set("callType",b.callType);case"P2P_CALL_ESCALATION_SET_RESPONSE":c("ScotchRTCAppDispatcher").waitFor([c("ScotchRTCP2PCallEscalationStore").getDispatchToken()]);return a.set("callType",b.response?c("ScotchRTCCallType").AUDIO_VIDEO:c("ScotchRTCCallType").AUDIO_ONLY);case"P2P_CALL_ESCALATION_FAILURE":return a.set("callType",c("ScotchRTCCallType").AUDIO_ONLY);case"P2P_CALL_ESCALATION_SUCCESS":c("ScotchRTCAppDispatcher").waitFor([c("ScotchRTCP2PCallEscalationStore").getDispatchToken()]);return c("ScotchRTCP2PCallEscalationStore").isEscalated()?a.set("callType",c("ScotchRTCCallType").AUDIO_VIDEO):a;default:return a}}function f(a,b){switch(b.type){case"SET_CONNECTION_STATUS":if(a.connectionStatus!==b.connectionStatus){d("ScotchRTCP2PCallWindowHandler").updateCallInProgressIndicator(b.connectionStatus);return a.set("connectionStatus",b.connectionStatus)}default:return a}}function h(a,b){switch(b.type){case"SET_END_CALL_REASON":return a.set("endCallReason",b.endCallReason);default:return a}}function i(a,b){switch(b.type){case"SET_MULTIWAY_ESCALATION_SUPPORT":a=a.set("offerEscalationSupport",b.offerEscalationSupport);b.escalationConferenceName&&(a=a.set("escalationConferenceName",b.escalationConferenceName));return a;default:return a}}function j(a,b){switch(b.type){case"POP_IN_SCREEN_CONTENT":d("ScotchRTCScreenSharingWindowHandler").close();return a.set("isScreenContentPoppedOut",d("ScotchRTCScreenSharingWindowHandler").isWindowOpened());case"POP_OUT_SCREEN_CONTENT":var e=c("ScotchRTCCallStore").getState(),f=e.remoteUsers.first().FBID;e=e.callInfo;d("ScotchRTCScreenSharingWindowHandler").open(f,b.stream,e);return a.set("isScreenContentPoppedOut",d("ScotchRTCScreenSharingWindowHandler").isWindowOpened());default:return a}}function k(a,b){switch(b.type){case"SET_REMOTE_SIGNALING_EXPERIMENTS":return a.set("signalingExperiments",a.signalingExperiments.setRemote(b.remoteSignalingExperiments));default:return a}}function l(a,b){switch(b.type){case"P2P_PROCESS_MESSAGE":return a.set("isRemoteVideoSupported",b.message.isRemoteVideoSupported()).set("isPeerOnMobile",b.message.isFromMobile());default:return a}}function m(a,b){switch(b.type){case"P2P_SET_IS_CALLER":return a.set("isCaller",b.isCaller);case"CALL_COLLISION":return a.set("isCaller",!0);default:return a}}function n(a,b){switch(b.type){case"SET_CONNECTION_STATUS":return b.connectionStatus==="CONNECTED"?a.set("wasConnected",!0):a;case"RESET_FOR_REDIAL":return a.set("wasConnected",!1);case"CALL_COLLISION":return a.set("wasConnected",!1);default:return a}}function o(a,b){switch(b.type){case"P2P_STAR_RATING_DONE":return a.set("isStarRatingShown",!1).set("wasStarRatingDone",b.done);case"RESET_FOR_REDIAL":return a.set("isStarRatingShown",!1).set("wasStarRatingDone",!1);default:return a}}function p(a,b){switch(b.type){case"SHOW_POOR_NETWORK_QUALITY":return a.set("isPoorNetworkQualityShown",!0);case"DISMISS_POOR_NETWORK_QUALITY":return a.set("isPoorNetworkQualityShown",!1);default:return a}}g.callInit=a;g.callEnd=b;g.processCallType=e;g.processConnectionStatus=f;g.processEndCallReason=h;g.processMultiwayEscalationSupport=i;g.processPoppedOutScreenContent=j;g.processSignalingExperiments=k;g.processMessage=l;g.processIsCaller=m;g.processWasConnected=n;g.processWasStarRatingDone=o;g.processPoorNetworkQuality=p}),98);
__d("ScotchFBRTCVideoDurationTrackerReducer",["ScotchFBRTCCallSummaryStore","ScotchRTCAppDispatcher","ScotchRTCCallStore"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var d=a.localVideoStream,e=a.videoDurationTrackerInfo,f=e.localVideoDurationTracker,g=e.remoteVideoDurationTracker;e=e.localScreenDurationTracker;switch(b.type){case"ADD_LOCAL_SCREEN_STREAM":e.track(b.stream);e.isStarted()||e.start();f.track(b.stream);f.isStarted()||f.start();return a;case"ADD_LOCAL_STREAM":e.isStarted()||(f.track(b.stream),f.isStarted()||f.start());return a.set("localVideoStream",b.stream);case"REMOVE_ALL_LOCAL_STREAMS":e.isStarted()||f.stop();return a.remove("localVideoStream");case"REMOVE_LOCAL_SCREEN_STREAM":e.stop();f.stop();f.track(d);f.isStarted()||f.start();return a;case"REPLACE_LOCAL_SCREEN_STREAM":e.track(b.newStream);f.track(b.newStream);return a;case"ADD_REMOTE_STREAM":case"TOGGLE_REMOTE_STREAM":d=c("ScotchRTCCallStore").getState().remoteUsers.find(function(a){return!a.isVideoDisabled()});g.stop();g.start();g.track(d&&d.streams.first());return a}return a}function b(a,b){switch(b.type){case"VIDEO_MUTED":case"VIDEO_UNMUTED":c("ScotchRTCAppDispatcher").waitFor([c("ScotchRTCCallStore").getDispatchToken()]),a.videoDurationTrackerInfo.localVideoDurationTracker.update()}return a}function d(a,b){switch(b.type){case"DISMISS":case"END_CALL":case"HANGUP":b=a.videoDurationTrackerInfo;var d=c("ScotchRTCCallStore").getState();d=d.callSummary;b.localVideoDurationTracker.stop();b.remoteVideoDurationTracker.stop();b.localScreenDurationTracker.stop();d.setVideoDurations(b.localVideoDurationTracker.getDuration(),b.remoteVideoDurationTracker.getDuration());d.setScreenDuration(b.localScreenDurationTracker.getDuration());d.save(c("ScotchFBRTCCallSummaryStore").getInstance());return a}return a}g.track=a;g.update=b;g.stop=d}),98);
__d("ScotchFBRTCGroupCallStore",["FluxReduceStore","ScotchFBRTCGroupCallParticipantsReducer","ScotchFBRTCGroupCallReducer","ScotchFBRTCGroupCallStoreState","ScotchFBRTCVideoDurationTrackerReducer","ScotchRTCAppDispatcher"],(function(a,b,c,d,e,f,g){"use strict";var h=[d("ScotchFBRTCGroupCallParticipantsReducer").addParticipantsToRing,d("ScotchFBRTCGroupCallParticipantsReducer").initThread,d("ScotchFBRTCGroupCallParticipantsReducer").onParticipantsChanged,d("ScotchFBRTCGroupCallReducer").processEndCallReason,d("ScotchFBRTCGroupCallReducer").setDominantSpeaker,d("ScotchFBRTCGroupCallReducer").setLayout,d("ScotchFBRTCGroupCallReducer").onForceEncodingChanged,d("ScotchFBRTCGroupCallReducer").onVideoEscalationStarted,d("ScotchFBRTCGroupCallReducer").onVideoEscalationCompleted,d("ScotchFBRTCGroupCallReducer").onReset,d("ScotchFBRTCVideoDurationTrackerReducer").track,d("ScotchFBRTCVideoDurationTrackerReducer").update,d("ScotchFBRTCVideoDurationTrackerReducer").stop];a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.reduce=function(a,b){return h.reduce(function(a,c){return c(a,b)},a)},b)||babelHelpers.assertThisInitialized(c)}var d=b.prototype;d.getInitialState=function(){return new(c("ScotchFBRTCGroupCallStoreState"))()};d.hadVideoDuration=function(){var a=this.getState().videoDurationTrackerInfo,b=a.localVideoDurationTracker;a=a.remoteVideoDurationTracker;return b.getDuration()>0||a.getDuration()>0};return b}(c("FluxReduceStore"));a.__moduleID=f.id;b=new a(c("ScotchRTCAppDispatcher"));g["default"]=b}),98);
__d("ScotchFBRTCMWProtocolStoreState",["ScotchRTCStreamDurationTracker","immutable"],(function(a,b,c,d,e,f,g){"use strict";a={pendingResponse:!1,pendingUpdate:!1,lastSyncedClientVersion:1,localToMWSTrackIDMap:c("immutable").Map(),localMediaUpdates:c("immutable").List([{mediaStatus:{}}])};b=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("immutable").Record(a));d={clientMediaUpdateInfo:new b(),localScreenDurationTracker:new(c("ScotchRTCStreamDurationTracker"))("screen")};e=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("immutable").Record(d));g["default"]=e}),98);
__d("ScotchFBRTCMWProtocolStore",["FluxReduceStore","ScotchFBRTCClientMediaUpdateReducer","ScotchFBRTCMWProtocolStoreState","ScotchRTCAppDispatcher","ScotchRTWebUserActionLogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=[d("ScotchFBRTCClientMediaUpdateReducer").configureAudio,d("ScotchFBRTCClientMediaUpdateReducer").configureVideo,d("ScotchFBRTCClientMediaUpdateReducer").configureScreenSharing,d("ScotchFBRTCClientMediaUpdateReducer").onClientMediaUpdateResponse,d("ScotchFBRTCClientMediaUpdateReducer").setLocalClientVersion,d("ScotchFBRTCClientMediaUpdateReducer").reset,d("ScotchFBRTCClientMediaUpdateReducer").onLocalTrackReplaced];a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=d=a.call.apply(a,[this].concat(f))||this,d.$ScotchFBRTCMWProtocolStore1="",d.reduce=function(a,b){var e=h.reduce(function(a,c){return c(a,b)},a);if(c("gkx")("2890")){a=a.clientMediaUpdateInfo.localMediaUpdates;var f=e.clientMediaUpdateInfo,g=f.pendingResponse,i=f.pendingUpdate,j=f.lastSyncedClientVersion,k=f.localToMWSTrackIDMap;f=f.localMediaUpdates;var l=[];for(var a=a.size;a<f.size;a++)l.push(f.get(a));a=JSON.stringify({pendingResponse:g,pendingUpdate:i,lastSyncedClientVersion:j,localToMWSTrackIDMap:k.toJS(),localMediaUpdatesChange:l,localMediaUpdateSize:f.size});d.$ScotchFBRTCMWProtocolStore1!==a&&(c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchFBRTCMWProtocolStore.reduce: "+JSON.stringify({beforeCMUInfo:d.$ScotchFBRTCMWProtocolStore1,afterCMUInfo:a,action:b})}),d.$ScotchFBRTCMWProtocolStore1=a)}return e},b)||babelHelpers.assertThisInitialized(d)}var d=b.prototype;d.getInitialState=function(){return new(c("ScotchFBRTCMWProtocolStoreState"))()};return b}(c("FluxReduceStore"));a.__moduleID=f.id;b=new a(c("ScotchRTCAppDispatcher"));g["default"]=b}),98);
__d("ScotchRTCCallNotificationStoreState",["immutable"],(function(a,b,c,d,e,f,g){"use strict";a={useTimeout:!0,notificationText:null};b=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("immutable").Record(a));g["default"]=b}),98);
__d("ScotchRTCCallNotificationStore",["FluxReduceStore","ScotchRTCAppDispatcher","ScotchRTCCallNotificationReducer","ScotchRTCCallNotificationStoreState"],(function(a,b,c,d,e,f,g){"use strict";var h=[d("ScotchRTCCallNotificationReducer").clearStore,d("ScotchRTCCallNotificationReducer").onEscalationStarted,d("ScotchRTCCallNotificationReducer").onEscalationCompletion,d("ScotchRTCCallNotificationReducer").onAbortedEscalation];a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.reduce=function(a,b){return h.reduce(function(a,c){return c(a,b)},a)},b)||babelHelpers.assertThisInitialized(c)}var d=b.prototype;d.getInitialState=function(){return new(c("ScotchRTCCallNotificationStoreState"))()};return b}(c("FluxReduceStore"));a.__moduleID=f.id;b=new a(c("ScotchRTCAppDispatcher"));g["default"]=b}),98);
__d("ScotchRTCGroupCallEscalationStore",["FluxReduceStore","ScotchFBRTCCallSummaryStore","ScotchRTCAppDispatcher","ScotchRTCGroupCallEscalationStoreReducer","ScotchRTCGroupCallEscalationStoreState"],(function(a,b,c,d,e,f,g){"use strict";var h=[d("ScotchRTCGroupCallEscalationStoreReducer").abortEscalation,d("ScotchRTCGroupCallEscalationStoreReducer").callStart,d("ScotchRTCGroupCallEscalationStoreReducer").clearStore,d("ScotchRTCGroupCallEscalationStoreReducer").onMultiwayConnectionSignaling,d("ScotchRTCGroupCallEscalationStoreReducer").onParticipantsConnected,d("ScotchRTCGroupCallEscalationStoreReducer").setP2PCallSummary,d("ScotchRTCGroupCallEscalationStoreReducer").setUsersToRing];a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.reduce=function(a,b){return h.reduce(function(a,c){return c(a,b)},a)},b)||babelHelpers.assertThisInitialized(c)}var d=b.prototype;d.getInitialState=function(){return new(c("ScotchRTCGroupCallEscalationStoreState"))()};d.isInProgress=function(){return this.getState().inProgress};d.isEscalated=function(){return this.getState().readyToTransition};d.logToP2PCallSummary=function(a){var b=this.getState();b=b.p2pCallSummary;b&&(a(b),b.save(c("ScotchFBRTCCallSummaryStore").getInstance()))};return b}(c("FluxReduceStore"));a.__moduleID=f.id;b=new a(c("ScotchRTCAppDispatcher"));g["default"]=b}),98);
__d("ScotchRTCP2PCallEscalationStore",["FluxReduceStore","ScotchRTCAppDispatcher","ScotchRTCP2PCallEscalationStoreReducers","ScotchRTCP2PCallEscalationStoreState","ScotchRTCP2PCallStore","ZenonUserCapabilities"],(function(a,b,c,d,e,f,g){"use strict";var h=[d("ScotchRTCP2PCallEscalationStoreReducers").Alice,d("ScotchRTCP2PCallEscalationStoreReducers").Bob,d("ScotchRTCP2PCallEscalationStoreReducers").common];a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.reduce=function(a,b){return h.reduce(function(a,c){return c(a,b)},a)},b)||babelHelpers.assertThisInitialized(c)}var d=b.prototype;d.getInitialState=function(){return new(c("ScotchRTCP2PCallEscalationStoreState"))()};d.didCurrentUserInitiate=function(){return this.getState().initiatedEscalation};d.isInProgress=function(){return this.getState().inProgress};d.isEscalated=function(){return this.getState().escalated};d.getEscalateMediaStream=function(){return this.getState().escalateMediaStream};d.remoteWillNotInitSDPUpdate=function(){return c("ScotchRTCP2PCallStore").getState().isPeerOnMobile||c("ScotchRTCP2PCallStore").getState().signalingExperiments.remoteSupport(c("ZenonUserCapabilities").VideoEscalationByUnmute)};d.isNegotiationAllowed=function(){var a=this.getState();return this.remoteWillNotInitSDPUpdate()||!a.request};d.isStarted=function(){var a=this.getState();return a.inProgress&&a.token!==null};d.getToken=function(){return this.getState().token};return b}(c("FluxReduceStore"));a.__moduleID=f.id;b=new a(c("ScotchRTCAppDispatcher"));g["default"]=b}),98);
__d("ScotchRTCP2PCallAdminMessageReducers",["FBRTCCallConstants","ScotchFBRTCAdminMessage","ScotchRTCAppDispatcher","ScotchRTCCallStore","ScotchRTCCallType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(b.type){case"SET_CALL_SUMMARY":c("ScotchRTCAppDispatcher").waitFor([c("ScotchRTCCallStore").getDispatchToken()]);b=c("ScotchRTCCallStore").getState();b=b.callSummary;return a.set("adminMessage",new(c("ScotchFBRTCAdminMessage"))(b.peerID,b.callID));default:return a}}function b(a,b){switch(b.type){case"SET_CONNECTION_STATUS":var c=a.adminMessage;c&&b.connectionStatus==="CONNECTED"&&c.onCallConnected();return a;default:return a}}function d(a,b){switch(b.type){case"SET_END_CALL_REASON":var d=a.adminMessage,e=a.escalationConferenceName;d&&(d.onCallEnded(),a.isCaller&&d.submit(a.callType===c("ScotchRTCCallType").AUDIO_ONLY?c("FBRTCCallConstants").FBRTCCallType.VOICE_CALL:c("FBRTCCallConstants").FBRTCCallType.VIDEO_CALL,b.endCallReason.getReasonID(),e));return a;default:return a}}g.processCallInit=a;g.processCallStart=b;g.processCallEnd=d}),98);
__d("ScotchRTCP2PCallStore",["FluxReduceStore","ScotchRTCAppDispatcher","ScotchRTCCallType","ScotchRTCP2PCallAdminMessageReducers","ScotchRTCP2PCallReducer","ScotchRTCP2PCallStoreState"],(function(a,b,c,d,e,f,g){"use strict";var h=[d("ScotchRTCP2PCallReducer").callEnd,d("ScotchRTCP2PCallReducer").callInit,d("ScotchRTCP2PCallReducer").processCallType,d("ScotchRTCP2PCallReducer").processConnectionStatus,d("ScotchRTCP2PCallReducer").processEndCallReason,d("ScotchRTCP2PCallReducer").processPoppedOutScreenContent,d("ScotchRTCP2PCallReducer").processMultiwayEscalationSupport,d("ScotchRTCP2PCallReducer").processSignalingExperiments,d("ScotchRTCP2PCallReducer").processMessage,d("ScotchRTCP2PCallReducer").processIsCaller,d("ScotchRTCP2PCallReducer").processWasConnected,d("ScotchRTCP2PCallReducer").processWasStarRatingDone,d("ScotchRTCP2PCallReducer").processPoorNetworkQuality,d("ScotchRTCP2PCallAdminMessageReducers").processCallInit,d("ScotchRTCP2PCallAdminMessageReducers").processCallStart,d("ScotchRTCP2PCallAdminMessageReducers").processCallEnd];a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.reduce=function(a,b){return h.reduce(function(a,c){return c(a,b)},a)},b)||babelHelpers.assertThisInitialized(c)}var d=b.prototype;d.getInitialState=function(){return new(c("ScotchRTCP2PCallStoreState"))()};d.isAudioOnly=function(){return this.getState().callType===c("ScotchRTCCallType").AUDIO_ONLY};d.isCaller=function(){return this.getState().isCaller};return b}(c("FluxReduceStore"));a.__moduleID=f.id;b=new a(c("ScotchRTCAppDispatcher"));g["default"]=b}),98);
__d("ScotchRTCP2PCallStoreState",["ScotchFBRTCUserCapabilities","ScotchRTCCallType","ScotchRTCP2PProtocolHandler","immutable"],(function(a,b,c,d,e,f,g){"use strict";a={adminMessage:null,callType:c("ScotchRTCCallType").AUDIO_ONLY,connectionStatus:"INIT",endCallReason:null,escalationConferenceName:null,isCaller:!1,isPeerOnMobile:!1,isPoorNetworkQualityShown:!1,isRedialFooterButtonShown:!1,isRemoteVideoSupported:!0,isScreenContentPoppedOut:!1,isStarRatingShown:!1,offerEscalationSupport:!1,protocolHandler:new(c("ScotchRTCP2PProtocolHandler"))(),signalingExperiments:new(c("ScotchFBRTCUserCapabilities"))(),wasConnected:!1,wasStarRatingDone:!1};b=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("immutable").Record(a));g["default"]=b}),98);
__d("MercuryPayloadSource",[],(function(a,b,c,d,e,f){a=Object.freeze({UNKNOWN:"unknown",CLIENT_CHANNEL_MESSAGE:"client_channel_message",CLIENT_SEND_MESSAGE:"client_send_message",CLIENT_CHANGE_ARCHIVED_STATUS:"client_change-archived_status",CLIENT_CHANGE_PINNED_MESSAGES:"client_change-pinned_messages",CLIENT_CHANGE_PINNED_STATUS:"client_change-pinned_status",CLIENT_CHANGE_PAGE_FOLLOW_UP_STATUS:"client_change_page_follow_up_status",CLIENT_CHANGE_FOLDER:"client_change_folder",CLIENT_CHANGE_MUTE_SETTINGS:"client_change_mute_settings",CLIENT_CHANGE_READ_STATUS:"client_change_read_status",CLIENT_CHANGE_CUSTOM_LIKE:"client_change_custom_like",CLIENT_MARK_THREAD_SEEN:"client_mark_thread_seen",CLIENT_ADD_PARTICIPANTS:"client_add_participants",CLIENT_FETCH_PARTICIPANTS:"client_fetch_participants",CLIENT_DELETE_MESSAGES:"client_delete_messages",CLIENT_DELETE_THREAD:"client_delete_thread",CLIENT_UPDATE_SNIPPET:"client_update_snippet",CLIENT_HANDLE_ERROR:"client_handle_error",CLIENT_CHANGE_FLAG:"client_change_flag",CLIENT_MOVE_PENDING_TO_INBOX:"client_move_pending_to_inbox",CLIENT_CREATE_PAGE_ADMIN_NOTE:"client_create_page_admin_note",CLIENT_UNWRAP_MESSAGE:"client_unwrap_message",CLIENT_UPDATE_COMM_STATUS:"client_update_comm_status",CLIENT_UPDATE_COMM_ITEM_OWNER:"client_update_comm_item_owner",CLIENT_CHANGE_SAVED_MESSAGE_STATUS:"client_update_saved_message_status",SERVER_INITIAL_DATA:"server_initial_data",SERVER_SEND_MESSAGE:"server_send_message",SERVER_CHANGE_ARCHIVED_STATUS:"server_change_archived_status",SERVER_CHANGE_PINNED_MESSAGES:"server_change-pinned_messages",SERVER_CHANGE_PINNED_STATUS:"server_change_pinned_status",SERVER_CHANGE_PAGE_FOLLOW_UP_STATUS:"server_change_page_follow_up_status",SERVER_CHANGE_READ_STATUS:"server_change_read_status",SERVER_MARK_FOLDER_READ:"server_mark_folder_read",SERVER_MARK_SEEN:"server_mark_seen",SERVER_FETCH_PARTICIPANTS:"server_fetch_participants",SERVER_FETCH_THREAD_INFO:"server_fetch_thread_info",SERVER_FETCH_THREADLIST_INFO:"server_fetch_threadlist_info",SERVER_STANDALONE_NOTIFICATIONS:"server_standalone_notifications",SERVER_THREAD_SYNC:"server_thread_sync",SERVER_TAB_PRESENCE:"server_tab_presence",SERVER_UNREAD_THREADS:"server_unread_threads",SERVER_UNSEEN_THREADS:"server_unseen_threads",SERVER_SEARCH:"server_search",SERVER_CHANGE_FLAG:"server_change_flag",SERVER_INVALIDATE_THREAD_STATE:"server_invalidate_thread_state",SERVER_INVALIDATE_GLOBAL_STATE:"server_invalidate_global_state"});f["default"]=a}),66);
__d("MessengerThreadFetchLoggerUtil",["FBLogger","MercuryIDs","QuickPerformanceLogger","performanceAbsoluteNow","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=1,i=new Map();a=function(a){try{c("QuickPerformanceLogger").markerStart(c("qpl")._(25296904,"8295"),h);a=d("MercuryIDs").isValid(a)?d("MercuryIDs").tokenize(a).value:a;i.set(a,h);h++}catch(a){c("FBLogger")("mercury").catching(a).warn("Logging thread info fetch encountered error")}};b=function(a,b){try{a=d("MercuryIDs").isValid(a)?d("MercuryIDs").tokenize(a).value:a;var e=i.get(a);e!=null&&(c("QuickPerformanceLogger").markerEnd(c("qpl")._(25296904,"8295"),b,e),i["delete"](a))}catch(a){c("FBLogger")("mercury").catching(a).warn("Logging thread info fetch encountered error")}};e=function(a,b,d){d===void 0&&(d=c("performanceAbsoluteNow")());a=i.get(a);a!=null&&c("QuickPerformanceLogger").markerPoint(c("qpl")._(25296904,"8295"),b,{instanceKey:a,timestamp:d})};g.markerStart=a;g.markerEnd=b;g.markerPoint=e}),98);
__d("MessengerThreadsWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"4674587265905870"};b.getQueryID=function(){return"3023319691284781"};return b}(b("WebGraphQLQueryBase"))}),null);
__d("bs_caml_external_polyfill",[],(function(a,b,c,d,e,f){"use strict";var g=function(){if(typeof globalThis!=="undefined")return globalThis;if(typeof self!=="undefined")return self;if(typeof window!=="undefined")return window;if(typeof a!=="undefined")return a;if(typeof this!=="undefined")return this;throw new Error("Unable to locate global `this`")};b=function(a){var b=g();if(b[a]===void 0)throw new Error(a+" not polyfilled by ReScript yet\n");return b[a]};c=function(a,b){var c=g();c[a]=b;return 0};f.getGlobalThis=g;f.resolve=b;f.register=c}),null);
__d("bs_caml_io",[],(function(a,b,c,d,e,f){"use strict";var g={buffer:"",output:function(a,b){a=b.length-1|0;if(typeof process!=="undefined"&&process.stdout&&process.stdout.write)return process.stdout.write(b);else{b[a]==="\n";return}}},h={buffer:"",output:function(a,b){a=b.length-1|0;b[a]==="\n"}};function i(a){if(a.buffer!==""){a.output(a,a.buffer);a.buffer="";return}}function j(a,b,c,d){b=c===0&&d===b.length?b:b.slice(c,d);if(typeof process!=="undefined"&&process.stdout&&process.stdout.write&&a===g)return process.stdout.write(b);c=b.lastIndexOf("\n");c<0?a.buffer=a.buffer+b:(a.buffer=a.buffer+b.slice(0,c+1|0),i(a),a.buffer=a.buffer+b.slice(c+1|0))}function a(a,b){return j(a,String.fromCharCode(b),0,1)}function b(a){return{hd:g,tl:{hd:h,tl:0}}}var k;f.stdin=k;f.stdout=g;f.stderr=h;f.caml_ml_flush=i;f.caml_ml_output=j;f.caml_ml_output_char=a;f.caml_ml_out_channels_list=b}),null);
__d("bs_caml_sys",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(typeof process==="undefined"||process.env===void 0)throw{RE_EXN_ID:"Not_found",Error:new Error()};a=process.env[a];if(a!==void 0)return a;throw{RE_EXN_ID:"Not_found",Error:new Error()}}var g=function(a){if(typeof process!=="undefined"&&process.platform==="win32")return"Win32";else return"Unix"};function b(a){if(typeof process==="undefined"||process.uptime===void 0)return-1;else return process.uptime()}function c(a){return 127}var h=function(a){return typeof process==="undefined"||process.cwd===void 0?"/":process.cwd()};function d(a){if(typeof process==="undefined")return["",[""]];a=process.argv;if(a==null)return["",[""]];else return[a[0],a]}function e(a){if(typeof process!=="undefined")return process.exit(a)}function i(a){throw{RE_EXN_ID:"Failure",_1:"caml_sys_is_directory not implemented",Error:new Error()}}function j(a){throw{RE_EXN_ID:"Failure",_1:"caml_sys_file_exists not implemented",Error:new Error()}}f.caml_sys_getenv=a;f.caml_sys_time=b;f.os_type=g;f.caml_sys_system_command=c;f.caml_sys_getcwd=h;f.caml_sys_get_argv=d;f.caml_sys_exit=e;f.caml_sys_is_directory=i;f.caml_sys_file_exists=j}),null);
__d("bs_pervasives",["bs_caml_bytes","bs_caml_exceptions","bs_caml_external_polyfill","bs_caml_format","bs_caml_io","bs_caml_js_exceptions","bs_caml_string","bs_caml_sys","bs_curry"],(function(a,b,c,d,e,f){"use strict";var g;function a(a){throw{RE_EXN_ID:"Failure",_1:a,Error:new Error()}}function c(a){throw{RE_EXN_ID:"Invalid_argument",_1:a,Error:new Error()}}var h=b("bs_caml_exceptions").create("Pervasives.Exit");function d(a){if(a>=0)return a;else return-a|0}function e(a){return a^-1}var i=-2147483648;function j(a){if(isFinite(a))if(Math.abs(a)>=22250738585072014e-324)return 0;else if(a!==0)return 1;else return 2;else if(isNaN(a))return 4;else return 3}function k(a){if(a<0||a>255)throw{RE_EXN_ID:"Invalid_argument",_1:"char_of_int",Error:new Error()};return a}function l(a){if(a)return"true";else return"false"}function m(a){switch(a){case"false":return!1;case"true":return!0;default:throw{RE_EXN_ID:"Invalid_argument",_1:"bool_of_string",Error:new Error()}}}function n(a){switch(a){case"false":return!1;case"true":return!0;default:return}}function o(a){try{return b("bs_caml_format").caml_int_of_string(a)}catch(c){a=b("bs_caml_js_exceptions").internalToOCamlException(c);if(a.RE_EXN_ID==="Failure")return;throw a}}function p(a){var c=a.length,d=0;while(!0){var e=d;if(e>=c)return a+".";var f=b("bs_caml_string").get(a,e);if(f>=48){if(f>=58)return a;d=e+1|0;continue}if(f!==45)return a;d=e+1|0;continue}}function q(a){return p(b("bs_caml_format").caml_format_float("%.12g",a))}function r(a){try{return b("bs_caml_format").caml_float_of_string(a)}catch(c){a=b("bs_caml_js_exceptions").internalToOCamlException(c);if(a.RE_EXN_ID==="Failure")return;throw a}}function s(a,b){if(a)return{hd:a.hd,tl:s(a.tl,b)};else return b}var t=(g=b("bs_caml_io")).stdin,u=g.stdout,v=g.stderr;function w(a,c,d){a=b("bs_caml_external_polyfill").resolve("caml_ml_open_descriptor_out")(b("bs_caml_external_polyfill").resolve("caml_sys_open")(d,a,c));b("bs_caml_external_polyfill").resolve("caml_ml_set_channel_name")(a,d);return a}function x(a){return w({hd:1,tl:{hd:3,tl:{hd:4,tl:{hd:7,tl:0}}}},438,a)}function y(a){return w({hd:1,tl:{hd:3,tl:{hd:4,tl:{hd:6,tl:0}}}},438,a)}function z(a){a=b("bs_caml_io").caml_ml_out_channels_list(void 0);while(!0){var c=a;if(!c)return;try{b("bs_caml_io").caml_ml_flush(c.hd)}catch(a){var d=b("bs_caml_js_exceptions").internalToOCamlException(a);if(d.RE_EXN_ID!=="Sys_error")throw d}a=c.tl;continue}}function A(a,c){return b("bs_caml_external_polyfill").resolve("caml_ml_output_bytes")(a,c,0,c.length)}function B(a,c){return b("bs_caml_io").caml_ml_output(a,c,0,c.length)}function C(a,c,d,e){if(d<0||e<0||d>(c.length-e|0))throw{RE_EXN_ID:"Invalid_argument",_1:"output",Error:new Error()};return b("bs_caml_external_polyfill").resolve("caml_ml_output_bytes")(a,c,d,e)}function D(a,c,d,e){if(d<0||e<0||d>(c.length-e|0))throw{RE_EXN_ID:"Invalid_argument",_1:"output_substring",Error:new Error()};return b("bs_caml_io").caml_ml_output(a,c,d,e)}function E(a,c){return b("bs_caml_external_polyfill").resolve("caml_output_value")(a,c,0)}function F(a){b("bs_caml_io").caml_ml_flush(a);return b("bs_caml_external_polyfill").resolve("caml_ml_close_channel")(a)}function G(a){try{b("bs_caml_io").caml_ml_flush(a)}catch(a){}try{return b("bs_caml_external_polyfill").resolve("caml_ml_close_channel")(a)}catch(a){return}}function H(a,c,d){a=b("bs_caml_external_polyfill").resolve("caml_ml_open_descriptor_in")(b("bs_caml_external_polyfill").resolve("caml_sys_open")(d,a,c));b("bs_caml_external_polyfill").resolve("caml_ml_set_channel_name")(a,d);return a}function I(a){return H({hd:0,tl:{hd:7,tl:0}},0,a)}function J(a){return H({hd:0,tl:{hd:6,tl:0}},0,a)}function K(a,c,d,e){if(d<0||e<0||d>(c.length-e|0))throw{RE_EXN_ID:"Invalid_argument",_1:"input",Error:new Error()};return b("bs_caml_external_polyfill").resolve("caml_ml_input")(a,c,d,e)}function L(a,c,d,e){while(!0){var f=e,g=d;if(f<=0)return;var h=b("bs_caml_external_polyfill").resolve("caml_ml_input")(a,c,g,f);if(h===0)throw{RE_EXN_ID:"End_of_file",Error:new Error()};e=f-h|0;d=g+h|0;continue}}function M(a,b,c,d){if(c<0||d<0||c>(b.length-d|0))throw{RE_EXN_ID:"Invalid_argument",_1:"really_input",Error:new Error()};return L(a,b,c,d)}function N(a,c){var d=b("bs_caml_bytes").caml_create_bytes(c);M(a,d,0,c);return b("bs_caml_bytes").bytes_to_string(d)}function O(a){var c=function(a,c,d){while(!0){var e=d,f=c;if(!e)return a;var g=e.hd,h=g.length;b("bs_caml_bytes").caml_blit_bytes(g,0,a,f-h|0,h);d=e.tl;c=f-h|0;continue}},d=function(d,e){while(!0){var f=e,g=d,h=b("bs_caml_external_polyfill").resolve("caml_ml_input_scan_line")(a);if(h===0){if(g)return c(b("bs_caml_bytes").caml_create_bytes(f),f,g);throw{RE_EXN_ID:"End_of_file",Error:new Error()}}if(h>0){var i=b("bs_caml_bytes").caml_create_bytes(h-1|0);b("bs_caml_external_polyfill").resolve("caml_ml_input")(a,i,0,h-1|0);b("bs_caml_external_polyfill").resolve("caml_ml_input_char")(a);if(!g)return i;var j=(f+h|0)-1|0;return c(b("bs_caml_bytes").caml_create_bytes(j),j,{hd:i,tl:g})}j=b("bs_caml_bytes").caml_create_bytes(-h|0);b("bs_caml_external_polyfill").resolve("caml_ml_input")(a,j,0,-h|0);e=f-h|0;d={hd:j,tl:g};continue}};return b("bs_caml_bytes").bytes_to_string(d(0,0))}function P(a){try{return b("bs_caml_external_polyfill").resolve("caml_ml_close_channel")(a)}catch(a){return}}function Q(a){return b("bs_caml_io").caml_ml_output_char(u,a)}function R(a){return B(u,a)}function S(a){return A(u,a)}function T(a){return B(u,String(a))}function U(a){return B(u,p(b("bs_caml_format").caml_format_float("%.12g",a)))}function V(a){b("bs_caml_io").caml_ml_output_char(u,10);return b("bs_caml_io").caml_ml_flush(u)}function W(a){return b("bs_caml_io").caml_ml_output_char(v,a)}function X(a){return B(v,a)}function aa(a){return A(v,a)}function ba(a){return B(v,String(a))}function ca(a){return B(v,p(b("bs_caml_format").caml_format_float("%.12g",a)))}function da(a){b("bs_caml_io").caml_ml_output_char(v,10);return b("bs_caml_io").caml_ml_flush(v)}function ea(a){b("bs_caml_io").caml_ml_flush(u);return O(t)}function fa(a){return b("bs_caml_format").caml_int_of_string((b("bs_caml_io").caml_ml_flush(u),O(t)))}function ga(a){return o((b("bs_caml_io").caml_ml_flush(u),O(t)))}function ha(a){return b("bs_caml_format").caml_float_of_string((b("bs_caml_io").caml_ml_flush(u),O(t)))}function ia(a){return r((b("bs_caml_io").caml_ml_flush(u),O(t)))}function ja(a){return a._1}var Y={contents:z};function ka(a){var c=Y.contents;Y.contents=function(d){b("bs_curry")._1(a,void 0);return b("bs_curry")._1(c,void 0)}}function Z(a){return b("bs_curry")._1(Y.contents,void 0)}function la(a){Z(void 0);return b("bs_caml_sys").caml_sys_exit(a)}var ma=2147483647,na=Infinity,oa=-Infinity,pa=17976931348623157e292,qa=22250738585072014e-324,ra=2220446049250313e-31,sa=g.caml_ml_flush,ta=g.caml_ml_output_char;g=g.caml_ml_output_char;function ua(a,c){return b("bs_caml_external_polyfill").resolve("caml_ml_output_int")(a,c)}function va(a,c){return b("bs_caml_external_polyfill").resolve("caml_ml_seek_out")(a,c)}function wa(a){return b("bs_caml_external_polyfill").resolve("caml_ml_pos_out")(a)}function xa(a){return b("bs_caml_external_polyfill").resolve("caml_ml_channel_size")(a)}function ya(a,c){return b("bs_caml_external_polyfill").resolve("caml_ml_set_binary_mode")(a,c)}function za(a){return b("bs_caml_external_polyfill").resolve("caml_ml_input_char")(a)}function Aa(a){return b("bs_caml_external_polyfill").resolve("caml_ml_input_char")(a)}function Ba(a){return b("bs_caml_external_polyfill").resolve("caml_ml_input_int")(a)}function Ca(a){return b("bs_caml_external_polyfill").resolve("caml_input_value")(a)}function Da(a,c){return b("bs_caml_external_polyfill").resolve("caml_ml_seek_in")(a,c)}function Ea(a){return b("bs_caml_external_polyfill").resolve("caml_ml_pos_in")(a)}function Fa(a){return b("bs_caml_external_polyfill").resolve("caml_ml_channel_size")(a)}function Ga(a){return b("bs_caml_external_polyfill").resolve("caml_ml_close_channel")(a)}function Ha(a,c){return b("bs_caml_external_polyfill").resolve("caml_ml_set_binary_mode")(a,c)}function $(a,c){return b("bs_caml_external_polyfill").resolve("caml_ml_seek_out_64")(a,c)}function Ia(a){return b("bs_caml_external_polyfill").resolve("caml_ml_pos_out_64")(a)}function Ja(a){return b("bs_caml_external_polyfill").resolve("caml_ml_channel_size_64")(a)}function Ka(a,c){return b("bs_caml_external_polyfill").resolve("caml_ml_seek_in_64")(a,c)}function La(a){return b("bs_caml_external_polyfill").resolve("caml_ml_pos_in_64")(a)}function Ma(a){return b("bs_caml_external_polyfill").resolve("caml_ml_channel_size_64")(a)}$={seek_out:$,pos_out:Ia,out_channel_length:Ja,seek_in:Ka,pos_in:La,in_channel_length:Ma};f.invalid_arg=c;f.failwith=a;f.Exit=h;f.abs=d;f.max_int=ma;f.min_int=i;f.lnot=e;f.infinity=na;f.neg_infinity=oa;f.max_float=pa;f.min_float=qa;f.epsilon_float=ra;f.classify_float=j;f.char_of_int=k;f.string_of_bool=l;f.bool_of_string=m;f.bool_of_string_opt=n;f.int_of_string_opt=o;f.string_of_float=q;f.float_of_string_opt=r;f.$at=s;f.stdin=t;f.stdout=u;f.stderr=v;f.print_char=Q;f.print_string=R;f.print_bytes=S;f.print_int=T;f.print_float=U;f.print_newline=V;f.prerr_char=W;f.prerr_string=X;f.prerr_bytes=aa;f.prerr_int=ba;f.prerr_float=ca;f.prerr_newline=da;f.read_line=ea;f.read_int=fa;f.read_int_opt=ga;f.read_float=ha;f.read_float_opt=ia;f.open_out=x;f.open_out_bin=y;f.open_out_gen=w;f.flush=sa;f.flush_all=z;f.output_char=ta;f.output_string=B;f.output_bytes=A;f.output=C;f.output_substring=D;f.output_byte=g;f.output_binary_int=ua;f.output_value=E;f.seek_out=va;f.pos_out=wa;f.out_channel_length=xa;f.close_out=F;f.close_out_noerr=G;f.set_binary_mode_out=ya;f.open_in=I;f.open_in_bin=J;f.open_in_gen=H;f.input_char=za;f.input_line=O;f.input=K;f.really_input=M;f.really_input_string=N;f.input_byte=Aa;f.input_binary_int=Ba;f.input_value=Ca;f.seek_in=Da;f.pos_in=Ea;f.in_channel_length=Fa;f.close_in=Ga;f.close_in_noerr=P;f.set_binary_mode_in=Ha;f.LargeFile=$;f.string_of_format=ja;f.exit=la;f.at_exit=ka;f.valid_float_lexem=p;f.unsafe_really_input=L;f.do_at_exit=Z}),null);
__d("MessengerGraphQLThreadFetcher.bs",["ChatReliabilityInstrumentation","MercuryServerRequestsConfig","MessengerServerPayloadTransformer.bs","MessengerThreadFetchLoggerUtil","MessengerThreadsWebGraphQLQuery","ODS","Promise","WebGraphQL","bs_caml_array","bs_caml_exceptions","bs_caml_format","bs_caml_option","bs_js_null_undefined","bs_pervasives","gkx"],(function(a,b,c,d,e,f){"use strict";var g={contents:!0};function h(a,c,d,e,f){if(a==null)if(e)return{actions:null,thread:void 0,end_of_history:{type:"user",fbid:c},roger:null,delivery_receipts:[]};else return{actions:null,thread:void 0,end_of_history:void 0,roger:null,delivery_receipts:[]};e=[];var g=b("MessengerServerPayloadTransformer.bs").getThreadFBID(a),h=b("MessengerServerPayloadTransformer.bs").getOtherUserID(a);g=h==null?g==null?b("bs_pervasives").failwith("No thread ID"):g:h;g!==c&&b("bs_pervasives").failwith("Thread ID mismatch");h=b("MessengerServerPayloadTransformer.bs").transformThread(d,a,f);g=b("bs_js_null_undefined").fromOption(b("MessengerServerPayloadTransformer.bs").transformMessages(d,a,f));f=b("MessengerServerPayloadTransformer.bs").transformReadReceipts(d,a);if(f!==void 0){d={};d[c]=b("bs_caml_option").valFromOption(f);f=d}else f=null;d=b("MessengerServerPayloadTransformer.bs").transformDeliveryReceipts(a);if(d.length>=1){d=b("bs_caml_array").get(d,0);h.is_canonical?e.push({other_user_fbid:c,thread_fbid:null,time:b("bs_caml_format").caml_float_of_string(d.timestamp_precise)}):e.push({other_user_fbid:null,thread_fbid:c,time:b("bs_caml_format").caml_float_of_string(d.timestamp_precise)})}d=b("MessengerServerPayloadTransformer.bs").getMessagePageInfo(a);if(d!==void 0)if(b("bs_caml_option").valFromOption(d).has_previous_page)return{actions:g,thread:h,end_of_history:void 0,roger:f,delivery_receipts:e};else return{actions:g,thread:h,end_of_history:{type:"thread",fbid:c},roger:f,delivery_receipts:e};else return{actions:g,thread:h,end_of_history:void 0,roger:f,delivery_receipts:e}}function i(a){b("MessengerThreadFetchLoggerUtil").markerPoint(a.id,"sendThreadInfoFetchRequest");return new(b("MessengerThreadsWebGraphQLQuery"))({id:a.id,message_limit:a.limit,load_messages:a.limit>0,load_read_receipts:a.loadReadReceipts,load_delivery_receipts:a.loadDeliveryReceipts,before:a.timestamp,is_work_teamwork_not_putting_muted_in_unreads:b("gkx")("1105011"),threadlistViewFieldsOnly:b("gkx")("1950744"),source:a.source})}var j=b("bs_caml_exceptions").create("MessengerGraphQLThreadFetcher.SessionLoggedOut");function a(a,c,d){if(!g.contents)return b("Promise").reject({RE_EXN_ID:j});var e=c.map(i);return b("Promise").all(b("WebGraphQL").execAll(e,{actorID:d?a:null,batchName:"MessengerGraphQLThreadFetcher",msgrRegion:b("MercuryServerRequestsConfig").msgrRegion,allowCrossPageTransition:!0}))["catch"](function(a){var d;try{d=b("bs_caml_array").get(a.errors,0).should_end_session}catch(a){d=!1}d&&(g.contents=!1);b("ODS").bumpEntityKey(2966,"messenger_webgraphql","fetch_thread.failure");c.forEach(function(a){b("MessengerThreadFetchLoggerUtil").markerEnd(a.id,"FAIL")});b("ChatReliabilityInstrumentation").logERROR("fetch_thread_fail");return b("Promise").reject(a)}).then(function(e){b("ODS").bumpEntityKey(2966,"messenger_webgraphql","fetch_thread.success");return e.map(function(e,f){e=e.message_thread;f=b("bs_caml_array").get(c,f);b("MessengerThreadFetchLoggerUtil").markerPoint(f.id,"getThreadInfoFetchResponse");return h(e,f.id,a,f.isCanonical,d)})})}f.canMakeRequests=g;f._transformPayload=h;f._getQuery=i;f.SessionLoggedOut=j;f.fetchAll=a}),null);
__d("MessengerThreadFetcher.bs",["FBIDCheck","LogHistory","MercuryDispatcher","MercuryIDs","MercuryPayloadSource","MercuryThreadIDMap","MessengerGraphQLThreadFetcher.bs","Promise","bs_belt_Array","bs_caml_option","bs_curry","gkx","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){"use strict";var g=new Map();function h(a,c){var d=c.other_user_fbid;if(d==null){c=c.thread_fbid;if(c==null)throw{RE_EXN_ID:"Invalid_argument",_1:"Encountered thread with no server identifier",Error:new Error()};c=[c,b("MercuryIDs").getThreadIDFromThreadFBID(c)]}else c=[d,b("MercuryIDs").getThreadIDFromUserID(d)];d=c[1];c=c[0];a=b("MercuryThreadIDMap").getForFBID(a);var e={},f=a.getClientIDFromServerIDNow(c);if(f==null){b("gkx")("1199097")&&b("LogHistory").getInstance("MessengerThreadFetcher").debug("setServerIDToClientID",d);a.setServerIDToClientID(c,d);e[c]=d;return[d,e]}else return[f,e]}function i(a,c,d){var e=!b("FBIDCheck").isUser_deprecated(a);return b("MessengerGraphQLThreadFetcher.bs").fetchAll(a,[{id:c,limit:0,loadReadReceipts:!1,loadDeliveryReceipts:!1,timestamp:null,isCanonical:d,source:null}],e).then(function(c){c=b("bs_belt_Array").get(c,0);if(c===void 0)return b("Promise").resolve(!1);c=b("bs_caml_option").valFromOption(c).thread;if(c==null)return b("Promise").resolve(!1);var d=h(a,c);b("MercuryDispatcher").getForFBID(a).handleUpdate({threads:[Object.assign(c,{thread_id:d[0]})],pinned_thread_ids:[],newlyAddedClientIDs:d[1],actions:[],preprocessed:!0,payload_source:b("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO});return b("Promise").resolve(!0)})}function j(a,c,d){return i(a,c,d).then(function(d){var e=g.get(a);if(e==null)return b("Promise").resolve(!1);var f=e.get(c);if(f==null)return b("Promise").resolve(!1);else{b("bs_belt_Array").forEach(f[1],function(a){return b("bs_curry")._1(a,d)});e["delete"](c);return b("Promise").resolve(d)}})["catch"](function(e){var f=g.get(a);if(f==null)return b("Promise").resolve(!1);e=f.get(c);if(e==null)return b("Promise").resolve(!1);var h=e[1];e=e[0];if(e<5||b("gkx")("678666")){var k=Math.imul(Math.pow(2,Math.min(e,5))|0,1e3),l=new(b("Promise"))(function(e,g){b("setTimeoutAcrossTransitions")(function(g){i(a,c,d).then(function(a){e(a);b("bs_belt_Array").forEach(h,function(c){return b("bs_curry")._1(c,a)});f["delete"](c);return b("Promise").resolve(a)})["catch"](function(b){return j(a,c,d)})},k)});f.set(c,[e+1|0,h]);return l}f["delete"](c);return b("Promise").resolve(!1)})}function a(a,b,c,d){var e=g.get(a);if(e==null){var f=new Map();f.set(b,[0,[d]]);g.set(a,f);j(a,b,c);return}f=e.get(b);f==null?(e.set(b,[0,[d]]),j(a,b,c)):f[1].push(d)}f.$$fetch=a}),null);
__d("ClientSyncProtocol_GroupsSyncAction",[],(function(a,b,c,d,e,f){a=Object.freeze({OPT_IN:0,OPT_OUT:1,UPDATE_EMOJI:2});f["default"]=a}),66);
__d("IrisProtocolMessageLifetime",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({TTL_OFF:0,TTL_ON_UNKNOWN:1,TTL_30SECONDS:3e4,TTL_1MINUTE:6e4,TTL_3MINUTES:18e4,TTL_5MINUTES:3e5,TTL_10MINUTES:6e5,TTL_15MINUTES:9e5,TTL_30MINUTES:18e5,TTL_1HOUR:36e5,TTL_2HOURS:72e5,TTL_4HOURS:144e5,TTL_8HOURS:288e5,TTL_12HOURS:432e5,TTL_24HOURS:864e5,TTL_36HOURS:1296e5,TTL_72HOURS:2592e5})}),null);
__d("MSuggestionDispatcher",["ExplicitRegistrationDispatcher"],(function(a,b,c,d,e,f,g){"use strict";a=new(c("ExplicitRegistrationDispatcher"))({strict:!1});g["default"]=a}),98);
__d("MSuggestionActions",["MSuggestionDispatcher","keyMirror"],(function(a,b,c,d,e,f,g){"use strict";var h=c("keyMirror")({SAVE_ALL_SUGGESTIONS:null,REMOVE_ALL_SUGGESTIONS:null,REMOVE_SUGGESTIONS_BY_TYPE:null});function a(a,b){c("MSuggestionDispatcher").dispatch({type:h.SAVE_ALL_SUGGESTIONS,threadID:a,suggestions:b})}function b(a){a&&c("MSuggestionDispatcher").dispatch({type:h.REMOVE_ALL_SUGGESTIONS,threadID:a})}function d(a,b){c("MSuggestionDispatcher").dispatch({type:h.REMOVE_SUGGESTIONS_BY_TYPE,threadID:a,typeID:b})}g.Types=h;g.saveAllSuggestions=a;g.removeAllSuggestions=b;g.removeSuggestionsByType=d}),98);
__d("MercuryGlobalActionType",[],(function(a,b,c,d,e,f){a=Object.freeze({MARK_ALL_READ:"mga-type:mark-all-read",MARK_ALL_SEEN:"mga-type:mark-all-seen"});f["default"]=a}),66);
__d("MercuryMessageCustomizations",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=JSON.parse(a),c=[];Object.keys(b).forEach(function(a){c.push({customization_type:a,customization_value:b[a]})});return c}f.parseCustomizations=a}),66);
__d("MercuryProfileRanges",[],(function(a,b,c,d,e,f){"use strict";function g(a){return!a.id&&a.i?{id:a.i,offset:a.o,length:a.l,type:a.t}:a}e.exports={extractFromDelta:function(a){a=(a=a)!=null?(a=a.data)!=null?a.prng:a:a;if(!a)return[];var b=[];try{b=JSON.parse(a);if(b.length>0)return b.map(g)}catch(a){}return b}}}),null);
__d("MessageThreadReadState",[],(function(a,b,c,d,e,f){"use strict";a={MARK_READ:1,MARK_UNREAD:2,KEEP_AS_IS:3};b=a;f["default"]=b}),66);
__d("MessageThreadReadStateEffect",["MessageThreadReadState"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var d=b.messageMetadata.threadReadStateEffect;if(d!=null){var e=c("MessageThreadReadState")[d];return e===void 0&&typeof d==="number"?d:e}d=b.messageMetadata.skipBumpThread;return d===!0?c("MessageThreadReadState").KEEP_AS_IS:a!==b.messageMetadata.actorFbId?c("MessageThreadReadState").MARK_UNREAD:c("MessageThreadReadState").KEEP_AS_IS}g.extractThreadStateEffectFromDelta=a}),98);
__d("MessagingThreadAction",[],(function(a,b,c,d,e,f){a=Object.freeze({ACTION_INVALID:"ACTION_INVALID",ACTION_ARCHIVED:"ACTION_ARCHIVED",ACTION_UNARCHIVED:"ACTION_UNARCHIVED"});f["default"]=a}),66);
__d("MessengerApprovalModeTypes",[],(function(a,b,c,d,e,f){a=Object.freeze({OPEN:0,APPROVALS:1});f["default"]=a}),66);
__d("MessengerApprovalQueueTypes",[],(function(a,b,c,d,e,f){a=Object.freeze({REQUESTED:"REQUESTED",REMOVED:"REMOVED"});f["default"]=a}),66);
__d("MessengerGroupRequestSource",[],(function(a,b,c,d,e,f){a=Object.freeze({ADD:0,JOIN_THROUGH_LINK:1});f["default"]=a}),66);
__d("MessengerMessageWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"4239714382793182"};b.getQueryID=function(){return"402346058046255"};return b}(b("WebGraphQLQueryBase"))}),null);
__d("MessengerThreadMetadataWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"4927382833942740"};b.getQueryID=function(){return"383890180015946"};return b}(b("WebGraphQLQueryBase"))}),null);
__d("MessengerMessageDFFFetcher.bs",["MessengerMessageTransformer.bs","MessengerMessageWebGraphQLQuery","MessengerThreadMetadataWebGraphQLQuery","Promise","WebGraphQL","bs_caml_array"],(function(a,b,c,d,e,f){"use strict";function a(a,c,d){return b("Promise").all(b("WebGraphQL").execAll([new(b("MessengerThreadMetadataWebGraphQLQuery"))({id:c.thread_id,source:c.source}),new(b("MessengerMessageWebGraphQLQuery"))({thread_and_message_id:{thread_id:c.thread_id,message_id:c.message_id},source:c.source})],{actorID:a,batchName:"MessengerMessageDFFFetcher"})).then(function(c){var e=b("bs_caml_array").get(c,0);c=b("bs_caml_array").get(c,1);e=e.message_thread;c=c.message;if(e==null)throw{RE_EXN_ID:"Not_found",Error:new Error()};if(!(c==null))return b("Promise").resolve(b("MessengerMessageTransformer.bs").transformMessage(a,c,{thread_id:null,thread_fbid:e.thread_key.thread_fbid,other_user_fbid:e.thread_key.other_user_id,folder:e.folder.toLowerCase()},d));throw{RE_EXN_ID:"Not_found",Error:new Error()}})}f.fetch_=a}),null);
__d("MessengerRealtimeAttachmentTransformer.bs",["MessengerAttachmentTransformer.bs","MessengerMessageTransformer.bs"],(function(a,b,c,d,e,f){"use strict";function a(a,c,d){var e=b("MessengerMessageTransformer.bs").unsafeCastBlobAttachments(c),f=c.extensible_attachment,g;if(f==null)g=null;else{var h=f.story_attachment,i=f.genie_attachment,j;if(i==null)j=null;else{i=i.genie_message;var k;if(i==null)k=null;else{i=i.story_attachment;k={story_attachment:i==null?null:b("MessengerMessageTransformer.bs").unsafeCastExtensibleAttachment(i)}}j={genie_message:k}}g={legacy_attachment_id:f.legacy_attachment_id,story_attachment:h==null?null:b("MessengerMessageTransformer.bs").unsafeCastExtensibleAttachment(h),genie_attachment:j}}return b("MessengerAttachmentTransformer.bs").transformAttachment(a,{extensible_attachment:g,blob_attachments:e,sticker:c.sticker},null,d)}f.transform=a}),null);
__d("MessengerWebDeltaEvents",[],(function(a,b,c,d,e,f){a=Object.freeze({DELTA_RECEIVED:"DELTA_RECEIVED",DELTA_IGNORED:"DELTA_IGNORED"});f["default"]=a}),66);
__d("PagesMessagingEventType",[],(function(a,b,c,d,e,f){a=Object.freeze({FLAG:1,CREATE_ADMIN_NOTE:2,PRIORITY_UPDATE:3});f["default"]=a}),66);
__d("RepliedToMessageStatusForGraphQL",[],(function(a,b,c,d,e,f){a=Object.freeze({VALID:"VALID",DELETED:"DELETED",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE"});f["default"]=a}),66);
__d("MessengerDeltaTransformer.bs",["Bootloader","ClientSyncProtocol_GroupsSyncAction","DateConsts","FBID.bs","FBIDCheck","IrisProtocolMessageLifetime","MSuggestionActions","MercuryActionType","MercuryDispatcher","MercuryGlobalActionType","MercuryIDs","MercuryLogMessageType","MercuryMessageCustomizations","MercuryPayloadSource","MercuryProfileRanges","MercuryServerRequests","MercurySyncDeltaTypes","MercuryThreadIDMap","MessageLiveLocationClientSyncProtocolStopReason","MessageThreadReadState","MessageThreadReadStateEffect","MessageUnsendabilityStatus.bs","MessagingThreadAction","MessengerApprovalModeTypes","MessengerApprovalQueueTypes","MessengerGroupRequestSource","MessengerGroupsSyncStatus","MessengerGroupsSyncStatus.bs","MessengerMessageDFFFetcher.bs","MessengerParticipantsFetcher.bs","MessengerRealtimeAttachmentTransformer.bs","MessengerState.bs","MessengerThreadFetcher.bs","MessengerWebDeltaEvents","MontageActions","PageCommItemStatus","PagesMessagingEventType","Promise","RepliedToMessageStatusForGraphQL","bs_belt_Array","bs_belt_Option","bs_caml_array","bs_caml_obj","bs_caml_option","bs_curry","bs_js_dict","bs_js_json","bs_js_null_undefined","gkx"],(function(a,b,c,d,e,f){"use strict";function g(a){try{return JSON.parse(a)}catch(a){return{}}}var h=b("gkx")("780647")?0:1;function i(a,c){var d=b("bs_belt_Option").map(b("bs_caml_option").nullable_to_opt(c.otherUserFbId),function(a){return a.toString()});c=b("bs_belt_Option").map(b("bs_caml_option").nullable_to_opt(c.threadFbId),function(a){return a.toString()});a=b("MercuryThreadIDMap").getForFBID(a);d=d!==void 0?[b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromUserID(b("FBID.bs").ofStringExn(d))),d]:c!==void 0?[b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromThreadFBID(b("FBID.bs").ofStringExn(c))),c]:[void 0,void 0];c=d[1];d=d[0];if(c!==void 0&&d!==void 0)if(a.hasClientIDForServerID(c))return b("bs_caml_option").nullable_to_opt(a.getClientIDFromServerIDNow(c));else return b("bs_caml_option").valFromOption(d)}function j(a,b,c,d){if(!(a==null))return[a.toString(),{otherUserFbId:null,threadFbId:a}];if(b==null)return[void 0,void 0];a=c.toString()!==d?c:b;return[a.toString(),{otherUserFbId:a,threadFbId:null}]}function k(a,c){var d=parseInt(c.messageMetadata.timestamp,10),e=b("MessageThreadReadStateEffect").extractThreadStateEffectFromDelta(a,c),f={contents:c.messageMetadata.actorFbId.toString()},h=!b("FBIDCheck").isUser_deprecated(a),j=c.attachments;j=j==null?[]:b("bs_belt_Array").keepMapU(j,function(c){var d=c.mercury;if(d==null){c=c.mercuryJSON;c=c==null?null:g(c)}else c=d;if(c==null)return;d=c.extensible_attachment;var e=c.blob_attachment;c=c.sticker_attachment;c=d==null?e==null?c==null?[]:b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{extensible_attachment:null,blob_attachments:null,sticker:c},h):b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{extensible_attachment:null,blob_attachments:[e],sticker:null},h):b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{extensible_attachment:b("bs_js_null_undefined").fromOption(d==null?void 0:b("bs_caml_option").some(d)),blob_attachments:null,sticker:null},h);e=b("bs_belt_Array").get(c,0);if(e!==void 0){d=b("bs_caml_option").valFromOption(e).share;if(d==null)c=f.contents;else{d=d.target;if(d==null)c=f.contents;else{d=d.genie_id;c=d==null?f.contents:d}}}else c=f.contents;f.contents=c;return e});var k=c.messageMetadata.tags;k=k==null?void 0:b("bs_js_null_undefined").fromOption(b("bs_belt_Array").get(k,0));var l=c.data,m;if(l==null)m=null;else{var n=b("bs_js_dict").get(l,"adminSignatureCreatorID");m=n!==void 0?{creatorID:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(l,"adminSignatureCreatorID")),creatorName:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(l,"adminSignatureCreatorName")),creatorType:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(l,"adminSignatureCreatorType")),labelType:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(l,"adminSignatureLabelType")),pageID:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(l,"adminSignaturePageID")),profileURI:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(l,"adminSignatureProfileURI"))}:null}n=f.contents;l=b("bs_caml_obj").caml_equal(e,b("MessageThreadReadState").MARK_UNREAD)&&a!==n;var o=i(a,c.messageMetadata.threadKey);if(o!==void 0){var p=c.ttl,q=c.messageMetadata.threadKey.threadFbId,r=c.messageMetadata.threadKey.otherUserFbId,s=c.body,t=c.data;if(t==null){var u=c.untypedData;u=u==null?!1:b("bs_belt_Option").getWithDefault(b("bs_js_dict").get(u,"is_sponsored"),"false")==="true"}else u=b("bs_belt_Option").getWithDefault(b("bs_js_dict").get(t,"is_sponsored"),"false")==="true";t=c.data;var v=c.data,w;if(v==null)w=null;else{v=b("bs_js_dict").get(v,"customization");w=v!==void 0?b("MercuryMessageCustomizations").parseCustomizations(v):null}v=c.data;var x=c.data,y=c.data,z;if(y==null)z=null;else{y=b("bs_js_dict").get(y,"mib_direct_message_data");z=y!==void 0?g(y):null}y=c.data;var A;if(y==null)A=null;else{y=b("bs_js_dict").get(y,"message_source_data");if(y!==void 0){y=g(y);y=b("bs_js_json").classify(y);if(typeof y==="number"||y.TAG!==2)A=null;else{y=b("bs_js_dict").get(y._0,"message_source");A=y!==void 0?b("bs_js_null_undefined").fromOption(y):null}}else A=null}y=c.messageMetadata.skipBumpThread;var B=c.data,C;if(B==null)C=null;else{B=b("bs_js_dict").get(B,"montage_reply_data");C=B!==void 0?g(B):null}B=c.data;var D;if(B==null)D=null;else{B=b("bs_js_dict").get(B,"meta_ranges");D=B!==void 0?g(B):null}return{message_id:c.messageMetadata.messageId,threading_id:null,offline_threading_id:c.messageMetadata.offlineThreadingId,author:b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(n)),author_email:n+"@facebook.com",ephemeral_ttl_mode:p==null?0:b("bs_belt_Option").getWithDefault(b("bs_js_dict").get(b("IrisProtocolMessageLifetime"),p),0),timestamp:d,is_unread:l,is_filtered_content:!1,is_filtered_content_bh:!1,is_filtered_content_account:!1,is_filtered_content_quasar:!1,is_filtered_content_invalid_app:!1,is_one_way_sent:b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(c.messageMetadata.tags),[]).some(function(a){return a==="one_way_message"}),is_forwarded:b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(c.messageMetadata.tags),[]).some(function(a){if(a==="action:copy_message"||a==="copy_self_message"||a==="action:copy_attachment")return!0;else return a==="copy_self_attachment"}),source:k,tags:c.messageMetadata.tags,is_spoof_warning:!1,folder:null,thread_fbid:q==null?null:q.toString(),other_user_fbid:r==null?null:r.toString(),body:s==null?"":s,html_body:null,subject:null,has_attachment:j.length!==0,attachments:j,ranges:void 0,thread_id:o,action_type:b("MercuryActionType").USER_GENERATED_MESSAGE,is_from_iris:!0,is_sponsored:u,commerce_message_type:t==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(t,"commerce_message_type")),customizations:w,platform_xmd:v==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(v,"platform_xmd")),profile_ranges:b("MercuryProfileRanges").extractFromDelta(c),verse_group_role_xmd:x==null?null:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(x,"verse_group_role_id")),mib_direct_message_data:z,message_source:A,skip_bump_thread:y==null?!1:y,thread_read_state_effect:e,montage_reply_data:C,meta_ranges:D,creator_info:m,message_unsendability_status:b("MessageUnsendabilityStatus.bs").fromNullableString(c.messageMetadata.unsendType),comm_status:h?b("PageCommItemStatus").TODO:null}}throw{RE_EXN_ID:"Invalid_argument",_1:"invalid thread id",Error:new Error()}}function l(a,c,d,e){b("Bootloader").loadModules(["MessengerWebDeltasTypedLogger.bs"],function(f){f=b("bs_curry")._1(f.messengerWebDeltasTypedLogger,void 0);f=f.setDeltaEvent(a).setDeltaType(c).setIgnoreReason(d).setSyncSeqID(e);f.log()},"MessengerDeltaTransformer.bs")}function m(a){return l(b("MessengerWebDeltaEvents").DELTA_RECEIVED,a,null,null)}function n(a,c){return l(b("MessengerWebDeltaEvents").DELTA_IGNORED,a,c,null)}function o(a,c,d,e,f){return b("MessengerThreadFetcher.bs").$$fetch(a,c,d,function(c){if(c){b("MercuryDispatcher").getForFBID(a).handleUpdate({actions:[e],pinned_thread_ids:[],newlyAddedClientIDs:{},preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});return m(f)}else return n(f,"thread fetch failed")})}function p(a,c,d,e){var f=c.other_user_fbid;if(f==null){var g=c.thread_fbid;if(g==null)throw{RE_EXN_ID:"Invalid_argument",_1:"invalid thread id",Error:new Error()};g=[g,!1]}else g=[f,!0];f=g[1];g=g[0];var h=b("MercuryThreadIDMap").getForFBID(a);h=h.getClientIDFromServerIDNow(g);var i=h==null?null:b("MessengerState.bs").getThreadMetaNow(a,h),j=b("gkx")("1143875");if(h==null)if(e)return o(a,g,f,c,d);else return n(d,"thread not already loaded, not required to be loaded");if(i==null)if(e){if(j)return o(a,g,f,c,d);if(j)return n(d,"thread not already loaded, not required to be loaded")}else if(j)return n(d,"thread not already loaded, not required to be loaded");b("MercuryDispatcher").getForFBID(a).handleUpdate({actions:[c],pinned_thread_ids:[],newlyAddedClientIDs:{},preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});return m(d)}function q(a,c){var d=a.threadId,e=b("MercuryIDs").isGroupChat(d);d=b("MercuryIDs").getThreadFBIDFromThreadID(d);e={action_type:b("MercuryActionType").PIN_MESSAGE,thread_fbid:e?d:null,other_user_fbid:e?null:d,thread_id:a.threadId,actor_fbid:a.actorFbid,pin_message_action:{message:{message_id:a.pinnedMessage.pinnedMessageId,pinning_time:a.pinnedMessage.timestamp,is_content_loaded:!0,message:c}}};return p(a.viewerFBID,e,"DeltaClientDelta.deltaUpdatePinnedMessage",h)}function r(a,c,d){var e=a.viewerFBID,f=a.pinnedMessage.pinnedMessageId,g=b("MessengerState.bs").getMessageFromID(a.viewerFBID,f);if(g!==void 0)return q(a,b("bs_caml_option").valFromOption(g));else{b("MessengerMessageDFFFetcher.bs").fetch_(e,{message_id:f,thread_id:b("MercuryIDs").getThreadFBIDFromThreadID(a.threadId),source:null},!1).then(function(d){q(a,d);b("bs_curry")._1(c,d);return b("Promise").resolve(void 0)})["catch"](function(c){q(a,null);b("bs_curry")._1(d,c);return b("Promise").resolve(void 0)});return}}function s(a,c){var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?void 0:b("bs_caml_option").some(d);d=d==null?[void 0,void 0]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];if(e===void 0)return;if(f===void 0)return;d=i(a,b("bs_caml_option").valFromOption(f));if(d!==void 0)return{thread_id:d,action_type:b("MercuryActionType").REACTION_UPDATE,messageId:c.messageId,offlineThreadingId:c.offlineThreadingId,reaction:c.reaction,senderId:c.senderId.toString(),thread_fbid:e.toString(),other_user_fbid:null,userId:c.userId.toString()}}function t(a){return a/Math.pow(10,8)}function u(a,c){var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d),f=c.threadKey.otherUserFbId,g=f==null?void 0:b("bs_caml_option").some(f);d=d==null?f==null?[void 0,void 0]:[g,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(g)}]:[e,{otherUserFbId:b("bs_js_null_undefined").fromOption(e),threadFbId:null}];f=d[1];g=d[0];if(g===void 0)return;if(f===void 0)return;e=i(a,b("bs_caml_option").valFromOption(f));if(e===void 0)return;if(c.messageLiveLocations.length!==1)return;d=b("bs_caml_array").get(c.messageLiveLocations,0);a=d.expirationTime;f=d.stopReason;c=f==null?Date.now()/b("DateConsts").MS_PER_SEC>a:!0;f=d.coordinate;f=f==null?null:{latitude:t(f.latitude),longitude:t(f.longitude)};var h=d.destination;h=h==null?null:{latitude:t(h.latitude),longitude:t(h.longitude),label:h.label};var j=d.stopReason;j=j==null?null:j===b("MessageLiveLocationClientSyncProtocolStopReason").EXPIRED||j===b("MessageLiveLocationClientSyncProtocolStopReason").CANCELED?"EXPIRED":j===b("MessageLiveLocationClientSyncProtocolStopReason").ARRIVED?"ARRIVED":null;return{thread_id:e,action_type:b("MercuryActionType").LIVE_LOCATION_UPDATE,thread_fbid:g.toString(),other_user_fbid:null,messageId:d.messageId,liveLocation:{live_location_id:d.id.toString(),is_expired:c,expiration_time:a,sender:{id:d.senderId.toString()},coordinate:f,location_title:d.locationTitle,sender_destination:h,stop_reason:j}}}function v(a,c){var d=c.threadKey.threadFbId;if(d==null)return;a=i(a,{otherUserFbId:null,threadFbId:d});if(a!==void 0)return{action_type:b("MercuryActionType").EVENT_RSVP_CHANGED,actor_fbid:c.actorFbId.toString(),rsvp_status:c.rsvpStatus,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a}}function w(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return;a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").UPDATE_COMM_STATUS,comm_status:c.isFollowUp?b("PageCommItemStatus").FOLLOW_UP:b("PageCommItemStatus").TODO,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a}}function x(a,c){var d=[];c.forEach(function(a){a=b("MercuryIDs").getUserIDFromParticipantID(a);if(!(a==null)){d.push(a);return}});return b("MessengerParticipantsFetcher.bs").$$fetch({ids:d}).then(function(c){var d=[],e=[];c.forEach(function(a){var b=a.id;a.is_messenger_blocked||a.is_facebook_blocked?d.push(b):e.push(b)});b("MercuryDispatcher").getForFBID(a).handleUpdate({from_client:!0,message_blocked_ids:d,message_unblocked_ids:e});return b("Promise").resolve(void 0)})["catch"](function(a){return b("Promise").resolve(void 0)})}function y(a,c){var d=c.actorFbid.toString(),e=b("FBID.bs").ofStringExn(d);if(b("bs_caml_obj").caml_notequal(e,a))e=b("bs_caml_option").some(b("MercuryIDs").getParticipantIDFromUserID(a));else{var f=c.threadKey.otherUserFbId;if(f==null)e=void 0;else{f=b("FBID.bs").ofString(f.toString());e=f!==void 0?b("bs_caml_option").some(b("MercuryIDs").getParticipantIDFromUserID(b("bs_caml_option").valFromOption(f))):void 0}}if(e===void 0)return;f=b("bs_caml_option").valFromOption(e);e=c.threadKey.otherUserFbId;if(e==null)return;x(a,[f]);a=i(a,{otherUserFbId:e,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").BLOCK_STATUS_CHANGED,actorFbid:d,canViewerReply:c.canViewerReply,reason:c.reason,message_blocked_ids:[f],other_user_fbid:e.toString(),thread_fbid:null,thread_id:a}}function z(a,c){var d=c.threadKey.threadFbId;if(d==null){var e=c.threadKey.otherUserFbId;e=e==null?[void 0,void 0]:[e.toString(),{otherUserFbId:e,threadFbId:null}]}else e=[d.toString(),{otherUserFbId:null,threadFbId:d}];d=e[1];e=e[0];if(e===void 0)return;if(d===void 0)return;a=i(a,b("bs_caml_option").valFromOption(d));if(a!==void 0)return{action_type:b("MercuryActionType").MONTAGE_DIRECT_EXPIRE,messageId:c.messageId,timestamp:c.timestamp,thread_fbid:e,other_user_fbid:null,keep_expiry_timestamp:c.keepExpiryTimestamp,thread_id:a}}function A(a,c){var d=k(a,c.message),e=c.repliedToMessage;if(e==null)return b("bs_caml_option").some(d);a=k(a,e);e=c.status;var f;if(e==null)f=void 0;else switch(e){case 0:f=b("bs_caml_option").some(b("RepliedToMessageStatusForGraphQL").VALID);break;case 1:f=b("bs_caml_option").some(b("RepliedToMessageStatusForGraphQL").DELETED);break;case 2:f=b("bs_caml_option").some(b("RepliedToMessageStatusForGraphQL").TEMPORARILY_UNAVAILABLE);break;default:f=void 0}if(f!==void 0)return b("bs_caml_option").some(Object.assign(d,{replied_to_message:{status:b("bs_caml_option").valFromOption(f),message:a}}))}function B(a,c){var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?void 0:b("bs_caml_option").some(d);d=d==null?[void 0,void 0]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];if(e===void 0)return;if(f===void 0)return;d=i(a,b("bs_caml_option").valFromOption(f));if(d!==void 0)return{action_type:b("MercuryActionType").GROUPS_SYNC_STATUS_CHANGED,thread_fbid:e.toString(),other_user_fbid:null,actor_fbid:c.actorFbid.toString(),groups_sync_status_string:b("MessengerGroupsSyncStatus.bs").fromNullableString(c.groupsSyncStatus),thread_id:d}}function C(a,c){var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?void 0:b("bs_caml_option").some(d);d=d==null?[void 0,void 0]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];d=c.syncAction===b("ClientSyncProtocol_GroupsSyncAction").OPT_IN?b("bs_caml_option").some(b("MessengerGroupsSyncStatus").OPT_IN):c.syncAction===b("ClientSyncProtocol_GroupsSyncAction").OPT_OUT?b("bs_caml_option").some(b("MessengerGroupsSyncStatus").OPT_OUT):void 0;if(e===void 0)return;if(d===void 0)return;if(f===void 0)return;a=i(a,b("bs_caml_option").valFromOption(f));if(a===void 0)return;f=c.syncedFbGroupId;return{action_type:b("MercuryActionType").GROUPS_SYNC_METADATA_UPDATE,thread_fbid:e.toString(),other_user_fbid:null,actor_fbid:c.actorFbid.toString(),groups_sync_action:b("bs_caml_option").valFromOption(d),source_surface:c.sourceSurface,fb_group_id:f==null?null:f.toString(),thread_id:a,emoji_codepoints:c.emojiCodePoints}}function D(a,c){var d=c.threadKey.threadFbId;if(d==null)return;a=i(a,{otherUserFbId:null,threadFbId:d});if(a!==void 0)return{action_type:b("MercuryActionType").DESCRIPTION_CHANGED,thread_fbid:d.toString(),other_user_fbid:null,group_thread_description_string:c.threadDescription,thread_id:a}}function E(a){return"#"+a.slice(2)}function F(a,c){var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?void 0:b("bs_caml_option").some(d);d=d==null?[void 0,void 0]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];if(e===void 0)return;if(f===void 0)return;d=i(a,b("bs_caml_option").valFromOption(f));if(d===void 0)return;a=c.fallbackColor!==""?E(c.fallbackColor):"";f=c.reactionPack;var g;if(f==null)g=[void 0,void 0];else{var h=f.reactionAssets;f=f.fontAsset;g=[h==null?void 0:h.map(function(a){return{reactionName:a.reactionName,reactionEmoji:a.reactionEmoji,keyframeAssetUri:a.keyframeAssetUri}}),f==null?void 0:f.assetUri]}h=g[1];f=g[0];g=c.gradientColors;if(!(g==null)&&g.length!==0){g=b("bs_belt_Array").map(g,E);return{action_type:b("MercuryActionType").UPDATE_THREAD_THEME,thread_fbid:e.toString(),other_user_fbid:null,theme_id:c.themeId.toString(),solid_color:a,header_color:b("bs_caml_array").get(g,0),footer_color:b("bs_caml_array").get(g,g.length-1|0),gradient_colors:g,thread_id:d,reactions:f,reactionFont:h}}return{action_type:b("MercuryActionType").UPDATE_THREAD_THEME,thread_fbid:e.toString(),other_user_fbid:null,theme_id:c.themeId.toString(),solid_color:a,header_color:a,footer_color:a,gradient_colors:[],thread_id:d,reactions:f,reactionFont:h}}function G(a,c,d){var e=c.pinnedMessage,f=j(c.threadKey.threadFbId,c.threadKey.otherUserFbId,c.actorFbid,a);f=f[1];var g=function(a){},h=function(a){d.contents={TAG:1,_0:"DeltaClientDelta.deltaUpdatePinnedMessage",_1:"error on fetching pinned message payload"}};if(f===void 0){d.contents={TAG:1,_0:"DeltaClientDelta.deltaUpdatePinnedMessage",_1:"transform failed"};return}f=i(a,b("bs_caml_option").valFromOption(f));if(f!==void 0)return r({viewerFBID:a,threadId:f,actorFbid:c.actorFbid.toString(),pinnedMessage:e},g,h);else{d.contents={TAG:1,_0:"DeltaClientDelta.deltaUpdatePinnedMessage",_1:"transform failed"};return}}function H(a,c){var d=j(c.threadKey.threadFbId,c.threadKey.otherUserFbId,c.actorFbid,a),e=d[1];d=d[0];if(d===void 0)return;if(e===void 0)return;e=b("bs_caml_option").valFromOption(e);a=i(a,e);if(a!==void 0)return{action_type:b("MercuryActionType").UNPIN_MESSAGE,thread_fbid:e.threadFbId===null?null:d,other_user_fbid:e.otherUserFbId===null?null:d,thread_id:a,unpin_message_action:{message_id:c.pinnedMessage.pinnedMessageId},actor_fbid:c.actorFbid.toString()}}function I(a,c){var d=c.threadKey.threadFbId;if(d==null){var e=c.threadKey.otherUserFbId;e=e==null?[void 0,void 0]:[e.toString(),{otherUserFbId:e,threadFbId:null}]}else e=[d.toString(),{otherUserFbId:null,threadFbId:d}];d=e[1];e=e[0];if(e===void 0)return;if(d===void 0)return;a=i(a,b("bs_caml_option").valFromOption(d));if(a!==void 0)return{action_type:b("MercuryActionType").CHANGE_PINNED_STATUS,thread_fbid:e,other_user_fbid:null,is_pinned:c.isPinned,thread_id:a,thread_pin_timestamp:c.timestamp}}function J(a,c){var d=c.threadKey.threadFbId,e=c.threadKey.otherUserFbId;e=d==null?e==null?[void 0,void 0]:[e.toString(),{otherUserFbId:e,threadFbId:null}]:[d.toString(),{otherUserFbId:null,threadFbId:d}];d=e[1];e=e[0];if(e===void 0)return;if(d===void 0)return;a=i(a,b("bs_caml_option").valFromOption(d));if(a!==void 0)return{action_type:b("MercuryActionType").MUTATE_TAGS,thread_fbid:e,other_user_fbid:null,thread_id:a,messageId:c.messageId,tags_to_add:c.isSaved?["message:save"]:[],tags_to_delete:c.isSaved?[]:["message:save"]}}function K(a,c){var d=c.threadKey.threadFbId;if(d==null)return;a=i(a,{otherUserFbId:null,threadFbId:d});if(a!==void 0)return{action_type:b("MercuryActionType").UPDATE_JOINABLE_LINK,joinable_link:c.privateGroupLink,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a}}function L(a){a=a.directives;if(a==null)return;a=b("bs_belt_Array").get(a,0);if(a===void 0)return;a=b("bs_caml_option").valFromOption(a).data;if(a==null)return;a=a.add_actions;if(a==null)return;var c=a.actions;if(c==null)return;c=b("bs_belt_Array").get(c,0);if(c===void 0)return;c=b("bs_caml_option").valFromOption(c).thread_key;if(c==null)return;var d=c.thread_fbid;c=c.other_user_fbid;if(d==null){if(c==null)return;c=c}else c=d;return{action_type:b("MercuryActionType").CREATE_OMNI_M_SUGGESTIONS,thread_fbid:b("MercuryIDs").getThreadIDFromThreadFBID(b("FBID.bs").ofStringExn(c)),other_user_fbid:null,thread_id:c,suggestions:a}}function M(a,c){var d=c.threadKey.threadFbId;if(d==null)return;a=i(a,{otherUserFbId:null,threadFbId:d});if(a!==void 0)return{action_type:b("MercuryActionType").PROMOTE_GROUP_ADMINS,thread_fbid:d.toString(),other_user_fbid:null,promoted_admins:b("bs_belt_Array").map(c.promotedAdmins,function(a){return{admin_fbid:a.adminFbId.toString(),admin_type:a.adminType}}),thread_id:a}}function N(a,c){var d=c.threadKey.threadFbId,e=c.threadKey.otherUserFbId;if(d==null){if(e==null)return;var f=i(a,{otherUserFbId:e,threadFbId:null});if(f!==void 0)return{action_type:b("MercuryActionType").REMOVE_MESSAGE,thread_fbid:null,messageId:c.messageID,other_user_fbid:e.toString(),removed_timestamp:c.deletionTimestamp,thread_id:f,author:b("MercuryIDs").getParticipantIDFromUserID(c.senderID)};else return}e=i(a,{otherUserFbId:null,threadFbId:d});if(e!==void 0)return{action_type:b("MercuryActionType").REMOVE_MESSAGE,thread_fbid:d.toString(),messageId:c.messageID,other_user_fbid:null,removed_timestamp:c.deletionTimestamp,thread_id:e,author:b("MercuryIDs").getParticipantIDFromUserID(c.senderID)}}function O(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return;a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").UNSUBSCRIBE_STATUS_UPDATE,page_unsubscribe_status:c.unSubscribeStatus,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a}}function P(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return;a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").BLURRED_IMAGE_STATUS,blurred_image_uri:c.blurredImageUri,image_message_id:c.messageId,image_id:c.imageId,should_show:c.shouldShow,thread_fbid:d.toString(),other_user_fbid:null,thread_id:a}}function Q(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return;a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").IS_PIN_PROTECTED,thread_fbid:d.toString(),other_user_fbid:null,is_pin_protected:c.isPinProtected,thread_id:a}}function R(a,c){var d=c.threadKey.otherUserFbId;if(d==null)return;a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").UPDATE_CONNECTIVITY_STATUS,other_user_fbid:d.toString(),subtitle_type:c.subtitleType,thread_connectivity_status:c.threadConnectivityStatus,thread_fbid:d.toString(),thread_id:a}}function S(a,c){var d=c.threadkey.otherUserFbId;if(d==null)return;a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").ADS_CONVERSION_UPDATE,other_user_fbid:d.toString(),thread_fbid:d.toString(),thread_id:a,conversion_detection_data:{is_eligible:c.isEligible,conversion_type:c.conversionType,currency_code:c.currencyCode,currency_amount:c.currencyAmount,timestamp:c.timestamp,classifier:c.classifier,page_reply:c.pageReply,icebreaker_key:c.icebreakerKey,icebreaker_message:c.icebreakerMessage,trigger_id:c.triggerId}}}function T(a,c){var d=c.threadkey.otherUserFbId;if(d==null)return;a=i(a,{otherUserFbId:d,threadFbId:null});if(a!==void 0)return{action_type:b("MercuryActionType").SUGGESTED_REPLY_UPDATE,other_user_fbid:d.toString(),thread_fbid:d.toString(),thread_id:a,suggested_reply_data:{suggestion_type:c.suggestionType,suggestion_content:c.suggestionContent,triggered_timestamp:c.triggeredTimestamp,trigger_id:c.triggerId}}}function U(a,c){var d=c.threadKey.threadFbId,e=d==null?void 0:b("bs_caml_option").some(d);if(d==null){d=c.threadKey.otherUserFbId;var f=d==null?void 0:b("bs_caml_option").some(d);d=d==null?[void 0,void 0]:[f,{otherUserFbId:b("bs_js_null_undefined").fromOption(f),threadFbId:null}]}else d=[e,{otherUserFbId:null,threadFbId:b("bs_js_null_undefined").fromOption(e)}];f=d[1];e=d[0];if(e===void 0)return;if(f===void 0)return;d=i(a,b("bs_caml_option").valFromOption(f));if(d!==void 0)return{thread_id:d,action_type:b("MercuryActionType").UPDATE_SECONDARY_LANGUAGE_BODY,messageId:c.messageId,thread_fbid:e.toString(),other_user_fbid:null,secondary_language_body:c.secondaryLanguageBody}}var V=function(a){return String.fromCharCode.apply(null,a)};function W(a,c){c=JSON.parse(V(c.payload));c=b("bs_js_json").classify(c);if(typeof c==="number")return{TAG:1,_0:"DeltaClientDelta",_1:"malformed payload"};if(c.TAG!==2)return{TAG:1,_0:"DeltaClientDelta",_1:"malformed payload"};c=b("bs_js_dict").get(c._0,"deltas");if(c===void 0)return{TAG:1,_0:"DeltaClientDelta",_1:"client delta has no deltas"};c=b("bs_js_json").classify(b("bs_caml_option").valFromOption(c));if(typeof c==="number")return{TAG:1,_0:"DeltaClientDelta",_1:"delta is not an array"};if(c.TAG!==3)return{TAG:1,_0:"DeltaClientDelta",_1:"delta is not an array"};c=b("bs_belt_Array").get(c._0,0);if(c===void 0)return{TAG:1,_0:"DeltaClientDelta",_1:"client delta is missing"};c=b("bs_js_json").classify(b("bs_caml_option").valFromOption(c));if(typeof c==="number")return{TAG:1,_0:"DeltaClientDelta",_1:"client delta is not an object"};if(c.TAG!==2)return{TAG:1,_0:"DeltaClientDelta",_1:"client delta is not an object"};c=c._0;var d=!1,e={contents:0},f=b("bs_js_dict").get(c,"deltaMessageReaction");if(f!==void 0){d=!0;f=s(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaMessageReaction",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaMessageReaction",_1:"transform failed"}}f=b("bs_js_dict").get(c,"liveLocationData");if(f!==void 0&&!d){d=!0;f=u(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.liveLocationData",h):e.contents={TAG:1,_0:"DeltaClientDelta.liveLocationData",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaUpdateGroupEventRSVPStatus");if(f!==void 0&&!d){d=!0;f=v(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateGroupEventRSVPStatus",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaUpdateGroupEventRSVPStatus",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaPageThreadFollowUpData");if(f!==void 0&&!d){d=!0;f=w(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPageThreadFollowUpData",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaPageThreadFollowUpData",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaChangeViewerStatus");if(f!==void 0&&!d){d=!0;f=y(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaChangeViewerStatus",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaChangeViewerStatus",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaMontageDirectExpire");if(f!==void 0&&!d){d=!0;f=z(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaMontageDirectExpire",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaMontageDirectExpire",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaMessageReply");if(f!==void 0&&!d){d=!0;f=A(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaMessageReply",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaMessageReply",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaUpdateGroupsSyncStatus");if(f!==void 0&&!d){d=!0;f=B(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateGroupsSyncStatus",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaUpdateGroupsSyncStatus",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaUpdateGroupsSyncMetadata");if(f!==void 0&&!d){d=!0;f=C(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateGroupsSyncMetadata",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaUpdateGroupsSyncMetadata",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaGroupThreadDescription");if(f!==void 0&&!d){d=!0;f=D(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaGroupThreadDescription",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaGroupThreadDescription",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaUpdateThreadTheme");if(f!==void 0&&!d){d=!0;f=F(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateThreadTheme",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaUpdateThreadTheme",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaUpdateSavedMessage");if(f!==void 0&&!d){d=!0;f=J(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdateSavedMessage",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaUpdateSavedMessage",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaUpdatePinnedThread");if(f!==void 0&&!d){d=!0;f=I(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdatePinnedThread",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaUpdatePinnedThread",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaUpdatePinnedMessage");if(f!==void 0&&!d){f=b("bs_caml_option").valFromOption(f);d=!0;if(f.pinnedMessageAction===0)G(a,f,e);else{f=H(a,f);f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdatePinnedMessage",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaUpdatePinnedMessage",_1:"transform failed"}}}f=b("bs_js_dict").get(c,"deltaUpdatePrivateGroupJoinableLink");if(f!==void 0&&!d){d=!0;f=K(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaUpdatePrivateGroupJoinableLink",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaUpdatePrivateGroupJoinableLink",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaOmniMDirectivesV2");if(f!==void 0&&!d){d=!0;f=L(b("bs_caml_option").valFromOption(f));if(f!==void 0){f=b("bs_caml_option").valFromOption(f);e.contents={TAG:0,_0:"DeltaClientDelta.deltaOmniMDirectivesV2"};b("MSuggestionActions").saveAllSuggestions(f.thread_id,f.suggestions)}else e.contents={TAG:1,_0:"DeltaClientDelta.deltaOmniMDirectivesV2",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaPromoteGroupThreadAdmin");if(f!==void 0&&!d){d=!0;f=M(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPromoteGroupThreadAdmin",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaPromoteGroupThreadAdmin",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaRecallMessageData");if(f!==void 0&&!d){d=!0;f=N(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaRecallMessageData",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaRecallMessageData",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaPageUnSubscribeStatus");if(f!==void 0&&!d){d=!0;f=O(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPageUnSubscribeStatus",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaPageUnSubscribeStatus",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaPageBlurredImageStatus");if(f!==void 0&&!d){d=!0;f=P(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPageBlurredImageStatus",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaPageBlurredImageStatus",_1:"transform failed"}}f=b("bs_js_dict").get(c,"deltaPaymentPinProtectionStatusData");if(f!==void 0){if(!d){d=!0;f=Q(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaPaymentPinProtectionStatusData",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaPaymentPinProtectionStatusData",_1:"transform failed"}}}else d||(e.contents={TAG:1,_0:"DeltaClientDelta",_1:"unknown delta type: "+Object.keys(c).join(",")});f=b("bs_js_dict").get(c,"deltaThreadConnectivityStatusUpdate");if(f!==void 0){if(!d){d=!0;f=R(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaThreadConnectivityStatusUpdateData",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaThreadConnectivityStatusUpdateData",_1:"transform failed"}}}else d||(e.contents={TAG:1,_0:"DeltaClientDelta",_1:"unknown delta type: "+Object.keys(c).join(",")});f=b("bs_js_dict").get(c,"deltaMessengerAdsConversionUpdate");if(f!==void 0){if(!d){d=!0;f=S(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaMessengerAdsConversionUpdate",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaMessengerAdsConversionUpdate",_1:"transform failed"}}}else d||(e.contents={TAG:1,_0:"DeltaClientDelta",_1:"unknown delta type: "+Object.keys(c).join(",")});f=b("bs_js_dict").get(c,"deltaMessengerBusinessSuggestedReplyUpdate");if(f!==void 0){if(!d){d=!0;f=T(a,b("bs_caml_option").valFromOption(f));f!==void 0?p(a,b("bs_caml_option").valFromOption(f),"DeltaClientDelta.deltaMessengerBusinessSuggestedReplyUpdate",h):e.contents={TAG:1,_0:"DeltaClientDelta.deltaMessengerBusinessSuggestedReplyUpdate",_1:"transform failed"}}}else d||(e.contents={TAG:1,_0:"DeltaClientDelta",_1:"unknown delta type: "+Object.keys(c).join(",")});f=b("bs_js_dict").get(c,"deltaSecondaryLanguageBody");if(f!==void 0&&!d){d=!0;c=U(a,b("bs_caml_option").valFromOption(f));c!==void 0?p(a,b("bs_caml_option").valFromOption(c),"DeltaClientDelta.secondaryLanguageBody",h):e.contents={TAG:1,_0:"DeltaClientDelta.secondaryLanguageBody",_1:"transform failed"}}return e.contents}function X(a,c){var d=[],e=[],f=c.folders,g=0;f==null||f.length===0?g=1:b("bs_belt_Array").forEachU(f,function(a){d.push({action_type:b("MercuryGlobalActionType").MARK_ALL_READ,action_id:null,folder:b("bs_js_dict").get(b("MessengerState.bs").irisMapping,a),timestamp:parseInt(c.watermarkTimestamp,10)})});g===1&&b("bs_belt_Array").forEachU(c.threadKeys,function(d){var f=i(a,d);if(f===void 0)return;var g=parseInt(c.watermarkTimestamp,10);b("MercuryServerRequests").getForFBID(a).updateLastActionTimestamp(g);e.push({thread_id:f,action_type:b("MercuryActionType").CHANGE_READ_STATUS,other_user_fbid:d.otherUserFbId,thread_fbid:d.threadFbId,mark_as_read:!0,timestamp:g,folder:"inbox"})});return[d,e]}function Y(a){if(a==null)return null;else return a.toString()}function Z(a){a=a.skipBumpThread;if(!(a==null)&&a)return h;else return 1}function $(a,c){var d;switch(c.TAG|0){case 0:var e=c._0,f=k(a,e);p(a,f,"deltaNewMessage",Z(e.messageMetadata));d=0;break;case 1:f=c._0;p(a,Object.assign(k(a,f.newMessage),{action_type:b("MercuryActionType").REPLACE_MESSAGE,replaced_message_id:f.replacedMessageId}),"deltaReplaceMessage",h);d=0;break;case 2:e=c._0;f=e.threadKey.otherUserFbId;var g;if(f==null){var j=e.threadKey.threadFbId;if(j==null)g=void 0;else{var l=b("MercuryThreadIDMap").getForFBID(a);l=l.getClientIDFromServerIDNow(j.toString());g=l==null?void 0:b("bs_caml_option").some(l)}}else{j=b("FBID.bs").ofString(f.toString());g=j!==void 0?b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromUserID(b("bs_caml_option").valFromOption(j))):void 0}if(g!==void 0){l={};f=parseInt(e.deliveredWatermarkTimestampMs,10);l[b("bs_caml_option").valFromOption(g)]=f;b("MercuryDispatcher").getForFBID(a).handleUpdate({delivery_receipts:l,pinned_thread_ids:[],newlyAddedClientIDs:{},actions:[],preprocessed:!0});d={TAG:0,_0:"DeltaDeliveryReceipt"}}else d={TAG:1,_0:"DeltaDeliveryReceipt",_1:"no thread id"};break;case 3:j=X(a,c._0);e=j[1];g=j[0];g.length!==0&&b("MercuryDispatcher").getForFBID(a).handleUpdate({actions:[],global_actions:g,pinned_thread_ids:[],newlyAddedClientIDs:{},preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});e.length!==0&&b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:e,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d=g.length===0&&e.length===0?{TAG:1,_0:"DeltaMarkRead",_1:"no local or global action"}:{TAG:0,_0:"DeltaMarkRead"};break;case 4:var o=c._0;f=b("bs_belt_Array").keepMapU(o.threadKeys,function(c){var d=i(a,c);if(d===void 0)return;var e=parseInt(o.watermarkTimestamp,10);b("MercuryServerRequests").getForFBID(a).updateLastActionTimestamp(e);return{thread_id:d,action_type:b("MercuryActionType").CHANGE_READ_STATUS,other_user_fbid:c.otherUserFbId,thread_fbid:c.threadFbId,mark_as_read:!1,timestamp:e,folder:"inbox"}});b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:f,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d={TAG:0,_0:"DeltaMarkUnread"};break;case 5:l=c._0;p(a,Object.assign(k(a,l),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:l.messageMetadata.adminText,log_message_data:{removed_participants:[b("MercuryIDs").getParticipantIDFromUserID(l.leftParticipantFbId)]},log_message_type:b("MercuryLogMessageType").UNSUBSCRIBE}),"DeltaParticipantLeftGroupThread",Z(l.messageMetadata));d=0;break;case 6:j=c._0;p(a,Object.assign(k(a,j),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:j.messageMetadata.adminText,log_message_data:{added_participants:b("bs_belt_Array").map(j.addedParticipants,function(a){return b("MercuryIDs").getParticipantIDFromUserID(a.userFbId)})},log_message_type:b("MercuryLogMessageType").SUBSCRIBE}),"DeltaParticipantsAddedToGroupThread",Z(j.messageMetadata));d=0;break;case 7:g=c._0;p(a,Object.assign(k(a,g),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:g.messageMetadata.adminText,log_message_data:{name:g.name},log_message_type:b("MercuryLogMessageType").THREAD_NAME}),"DeltaThreadName",Z(g.messageMetadata));d=0;break;case 8:e=c._0;f={watermark:parseInt(e.watermarkTimestampMs,10),action:parseInt(e.actionTimestampMs,10)};l=e.threadKey.otherUserFbId;j=l==null?b("bs_caml_option").nullable_to_opt(e.actorFbId):l.toString();g=e.threadKey.otherUserFbId;if(g==null){l=e.threadKey.threadFbId;e=l==null?void 0:l.toString()}else e=g.toString();if(j!==void 0)if(e!==void 0){l=b("MercuryThreadIDMap").getForFBID(a);g=l.getClientIDFromServerIDNow(e);if(g==null)d={TAG:1,_0:"DeltaReadReceipt",_1:"No clientID for serverID: "+e};else{l={};e={};j=b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(j));e[j]=f;l[g]=e;b("MercuryDispatcher").getForFBID(a).handleUpdate({roger:l,pinned_thread_ids:[],newlyAddedClientIDs:{},actions:[],preprocessed:!0});d={TAG:0,_0:"DeltaReadReceipt"}}}else d={TAG:1,_0:"DeltaReadReceipt",_1:"serverID is invalid"};else d={TAG:1,_0:"DeltaReadReceipt",_1:"userID is invalid"};break;case 9:j=c._0;p(a,Object.assign(k(a,j),{action_type:b("MercuryActionType").LOG_MESSAGE,log_message_body:j.messageMetadata.adminText,log_message_data:{message_type:j.type,untypedData:j.untypedData},log_message_type:b("MercuryLogMessageType").GENERIC_ADMIN_TEXT,message_unsendability_status:b("MessageUnsendabilityStatus.bs").fromNullableString(j.messageMetadata.unsendType)}),"DeltaAdminTextMessage",Z(j.messageMetadata));d=0;break;case 10:f=c._0;g=i(a,{otherUserFbId:f.threadKey.otherUserFbId,threadFbId:f.threadKey.threadFbId});e=g!==void 0?{action_type:b("MercuryActionType").DELETE_MESSAGES,message_ids:f.messageIds,other_user_fbid:Y(f.threadKey.otherUserFbId),thread_fbid:Y(f.threadKey.threadFbId),thread_id:g}:void 0;l=f.threadKey.threadFbId;j=f.folder;if(e!==void 0){g=b("bs_caml_option").valFromOption(e);l==null||j==null?(p(a,g,"DeltaMessageDelete",h),d=0):(j==="FOLDER_MONTAGE"?b("MontageActions").requestUpdate(l.toString()):p(a,g,"DeltaMessageDelete",h),d=0)}else d={TAG:1,_0:"DeltaMessageDelete",_1:"transform failed"};break;case 11:f=c._0;e=i(a,{otherUserFbId:f.threadKey.otherUserFbId,threadFbId:f.threadKey.threadFbId});if(e!==void 0){j=f.action;p(a,{action_type:b("MercuryActionType").CHANGE_ARCHIVED_STATUS,thread_fbid:Y(f.threadKey.threadFbId),other_user_fbid:Y(f.threadKey.otherUserFbId),archived:j==null?!1:j===b("MessagingThreadAction").ACTION_ARCHIVED,thread_id:e},"DeltaThreadAction",h);d=0}else d={TAG:1,_0:"DeltaThreadAction",_1:"transform failed"};break;case 12:l=b("bs_belt_Array").keepMapU(c._0.threadKeys,function(c){var d=i(a,c);if(d!==void 0)return{thread_id:d,action_type:b("MercuryActionType").DELETE_THREAD,other_user_fbid:c.otherUserFbId,thread_fbid:c.threadFbId}});b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:l,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d={TAG:0,_0:"DeltaThreadDelete"};break;case 13:g=c._0;f=i(a,{otherUserFbId:null,threadFbId:g.messageMetadata.threadKey.threadFbId});f!==void 0?(p(a,{action_type:b("MercuryActionType").REMOVE_GROUP_ADMINS,action_id:null,thread_fbid:Y(g.messageMetadata.threadKey.threadFbId),other_user_fbid:null,removed_admin_ids:g.removedAdminFbIds,thread_id:f},"DeltaAdminRemovedFromGroupThread",h),d=0):d={TAG:1,_0:"DeltaAdminRemovedFromGroupThread",_1:"transform failed"};break;case 14:j=c._0;e=i(a,j.threadKey);if(e!==void 0){l=[{thread_id:e,action_type:b("MercuryActionType").CHANGE_MUTE_SETTINGS,thread_fbid:j.threadKey.threadFbId,other_user_fbid:j.threadKey.otherUserFbId,mute_until:parseInt(j.expireTime,10)}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:l,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d={TAG:0,_0:"DeltaThreadMuteSettings"}}else d={TAG:1,_0:"DeltaThreadMuteSettings",_1:"invalid thread ID"};break;case 15:g=c._0;f=g.jsonBlob;if(f==null)d={TAG:1,_0:"DeltaPagesManagerEvent",_1:"no jsonBlob"};else{try{e=JSON.parse(f)}catch(a){e={}}j=b("bs_js_json").classify(e);if(typeof j==="number"||j.TAG!==2)d={TAG:1,_0:"DeltaPagesManagerEvent",_1:"jsonBlob is not an object"};else{l=j._0;f=b("bs_js_dict").get(l,"type");if(f!==void 0){e=b("bs_js_json").classify(b("bs_caml_option").valFromOption(f));if(typeof e==="number"||e.TAG!==1)d={TAG:1,_0:"DeltaPagesManagerEvent",_1:"type is not a number"};else if(e._0===b("PagesMessagingEventType").FLAG){j=b("bs_js_dict").get(l,"flagData");if(j!==void 0){f=b("bs_js_json").classify(b("bs_caml_option").valFromOption(j));if(typeof f==="number"||f.TAG!==2)e=!1;else{l=b("bs_js_dict").get(f._0,"state");if(l!==void 0){j=b("bs_js_json").classify(b("bs_caml_option").valFromOption(l));e=j===1}else e=!1}}else e=!1;f=i(a,g.threadKey);if(f!==void 0){l=[{thread_id:f,action_type:b("MercuryActionType").CHANGE_FLAG,mark_as_flag:e,other_user_fbid:g.threadKey.otherUserFbId,thread_fbid:g.threadKey.threadFbId}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:l,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d={TAG:0,_0:"DeltaPagesManagerEvent"}}else d={TAG:1,_0:"DeltaPagesManagerEvent",_1:"threadID is invalid"}}else d={TAG:1,_0:"DeltaPagesManagerEvent",_1:"type is not pagesFlag"}}else d={TAG:1,_0:"DeltaPagesManagerEvent",_1:"no type on jsonBlob"}}}break;case 16:j=c._0;f=i(a,{otherUserFbId:null,threadFbId:j.messageMetadata.threadKey.threadFbId});f!==void 0?(p(a,{action_type:b("MercuryActionType").APPROVAL_MODE,action_id:null,thread_fbid:Y(j.messageMetadata.threadKey.threadFbId),other_user_fbid:null,approval_mode:b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(b("MessengerApprovalModeTypes"),j.mode)),thread_id:f},"DeltaApprovalMode",h),d=0):d={TAG:1,_0:"DeltaApprovalMode",_1:"transform failed"};break;case 17:e=c._0;g=i(a,{otherUserFbId:e.messageMetadata.threadKey.otherUserFbId,threadFbId:e.messageMetadata.threadKey.threadFbId});if(g!==void 0){l=e.inviterFbId;if(l==null){j=e.recipientFbId;if(!(j==null)){f=b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(j));p(a,{action_type:b("MercuryActionType").APPROVAL_QUEUE,action_id:null,thread_fbid:Y(e.messageMetadata.threadKey.threadFbId),other_user_fbid:Y(e.messageMetadata.threadKey.otherUserFbId),removed_id:e.action===b("MessengerApprovalQueueTypes").REMOVED?f:null,added_id:e.action===b("MessengerApprovalQueueTypes").REQUESTED?f:null,thread_id:g},"DeltaApprovalQueue",h)}}else{if(e.action===b("MessengerApprovalQueueTypes").REQUESTED){j=e.requestSource;var q;if(j==null)q=b("MessengerGroupRequestSource").ADD;else switch(j){case"ADD":q=b("MessengerGroupRequestSource").ADD;break;case"JOIN_THROUGH_LINK":q=b("MessengerGroupRequestSource").JOIN_THROUGH_LINK;break;default:q=b("MessengerGroupRequestSource").ADD}f={requester:{id:e.recipientFbId},inviter:{id:l},request_source:q,request_timestamp:e.requestTimestamp}}else f=null;p(a,{action_type:b("MercuryActionType").APPROVAL_QUEUE,action_id:null,thread_fbid:Y(e.messageMetadata.threadKey.threadFbId),other_user_fbid:Y(e.messageMetadata.threadKey.otherUserFbId),removed_group_id:e.action===b("MessengerApprovalQueueTypes").REMOVED?e.recipientFbId:null,added_group_id:f,thread_id:g},"DeltaApprovalQueue",h)}d=0}else d={TAG:1,_0:"DeltaApprovalQueue",_1:"transform failed"};break;case 18:j=c._0;p(a,k(a,j.deltaNewMessage),"DeltaGenieMessage",Z(j.deltaNewMessage.messageMetadata));d=0;break;case 19:l=c._0;e=l.messageMetadata.threadKey;if(e==null)f=void 0;else{g=e.threadFbId;f=g==null?void 0:g}j=l.initiator;if(j==null)e=void 0;else{g=j.userFbId;e=g==null?void 0:g.toString()}j=i(a,{otherUserFbId:null,threadFbId:f});j!==void 0?(p(a,{action_type:b("MercuryActionType").UPDATE_RTC_CALL_DATA,thread_fbid:Y(f),other_user_fbid:null,call_state:l.callState,server_info_data:l.serverInfoData,initiator_fbid:e,thread_id:j},"DeltaRTCCallData",h),d=0):d={TAG:1,_0:"DeltaRTCCallData",_1:"transform failed"};break;case 20:g=c._0;f=i(a,g.threadKey);if(f!==void 0){l=[{thread_id:f,action_type:b("MercuryActionType").CHANGE_FOLDER,other_user_fbid:g.threadKey.otherUserFbId,new_folder:b("bs_js_dict").get(b("MessengerState.bs").irisMapping,g.folder)}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:l,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d={TAG:0,_0:"DeltaThreadFolder"}}else d={TAG:1,_0:"DeltaThreadFolder",_1:"threadID is invalid"};break;case 21:e=c._0;j=i(a,e.threadKey);if(j!==void 0){f=[{thread_id:j,action_type:b("MercuryActionType").MUTATE_TAGS,messageId:e.messageId,tags_to_add:e.tagsToAdd,tags_to_delete:e.tagsToDelete}];b("MercuryDispatcher").getForFBID(a).handleUpdate({pinned_thread_ids:[],newlyAddedClientIDs:{},actions:f,preprocessed:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});d={TAG:0,_0:"DeltaMutateMessageTags"}}else d={TAG:1,_0:"DeltaMutateMessageTags",_1:"threadID is invalid"};break;case 22:d=W(a,c._0);break}if(typeof d==="number")return;else if(d.TAG===0)return m(d._0);else return n(d._0,d._1)}function a(a,c){if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").NewMessage))return $(a,{TAG:0,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ReplaceMessage))return $(a,{TAG:1,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").DeliveryReceipt))return $(a,{TAG:2,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MarkRead))return $(a,{TAG:3,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MarkUnread))return $(a,{TAG:4,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ParticipantLeftGroupThread))return $(a,{TAG:5,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ParticipantsAddedToGroupThread))return $(a,{TAG:6,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadName))return $(a,{TAG:7,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ReadReceipt))return $(a,{TAG:8,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").AdminTextMessage))return $(a,{TAG:9,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MessageDelete))return $(a,{TAG:10,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadAction))return $(a,{TAG:11,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadDelete))return $(a,{TAG:12,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").AdminRemovedFromGroupThread))return $(a,{TAG:13,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadMuteSettings))return $(a,{TAG:14,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").PagesManagerEvent))return $(a,{TAG:15,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ApprovalMode))return $(a,{TAG:16,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ApprovalQueue))return $(a,{TAG:17,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ClientPayload))return $(a,{TAG:22,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").GenieMessage))return $(a,{TAG:18,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").RtcCallData))return $(a,{TAG:19,_0:c});else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").MarkFolderSeen)){m("DeltaMarkFolderSeen");return b("MessengerState.bs").send(b("bs_caml_option").some(a),[{TAG:0,_0:{TAG:66,_0:c}}])}else if(b("bs_caml_obj").caml_equal(c["class"],b("MercurySyncDeltaTypes").ThreadFolder))return $(a,{TAG:20,_0:c});else return}f.transform=a;f.fetchAndUpdatePinnedMessage=r}),null);
__d("JSSet.bs",[],(function(a,b,c,d,e,f){"use strict";function a(a){return Array.from(a.values())}f.values=a}),null);
__d("MercuryActionStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({UNSENT:0,SUCCESS:1,UNCONFIRMED:3,FAILED_UNKNOWN_REASON:4,UNABLE_TO_CONFIRM:5,RESENT:6,RESENDING:7,ERROR:10});f["default"]=a}),66);
__d("EmojiLikeConstants",["EmojiStaticConfig"],(function(a,b,c,d,e,f,g){"use strict";a=Object.freeze({XSMALL:"xsmall",SMALL:"small",MEDIUM:"medium",LARGE:"large"});b={dp16:"xsmall",dp32:"small",dp64:"medium",db64:"medium",dp128:"large"};d=Object.freeze({PICKER:"picker",HOT_LIKE:"hot_like"});e=[983040];f="hot_emoji_source";var h="hot_emoji_size",i="emoji_like",j="\ud83d\udc4d",k=[128077];g.sizeMap=c("EmojiStaticConfig").sizeMap;g.size=a;g.sizeMapTransfer=b;g.source=d;g.FB_THUMBS_UP_EMOJI=e;g.SOURCE_TAG_PREFIX=f;g.TAG_PREFIX_NEW=h;g.TAG_PREFIX_OLD=i;g.THUMBS_UP_EMOJI=j;g.THUMBS_UP_EMOJI_CODES=k}),98);
__d("MercuryTagHelper",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){a=a.find(function(a){return a!=null?a.startsWith(b):!1});return a==null?a:a.substr(a.indexOf(":")+1)}f.get=a}),66);
__d("EmojiLikeUtils",["EmojiLikeConstants","MercuryTagHelper"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){!a.tags?a.tags=[h(b)]:a.tags.push(h(b));return a}function h(a){var b=d("EmojiLikeConstants").TAG_PREFIX_NEW;return b+":"+a}function b(a,b){!a.tags?a.tags=[i(b)]:a.tags.push(i(b));return a}function i(a){return d("EmojiLikeConstants").SOURCE_TAG_PREFIX+":"+a}function c(a){return j(a)!=null}function j(a){if(!a.tags)return null;var b=d("MercuryTagHelper").get(a.tags,d("EmojiLikeConstants").TAG_PREFIX_NEW);return b?b:d("MercuryTagHelper").get(a.tags,d("EmojiLikeConstants").TAG_PREFIX_OLD)}g.setEmojiSize=a;g.setEmojiSource=b;g.isEmojiLike=c;g.getEmojiSize=j}),98);
__d("MercuryAttachment",["cx","EmojiLikeUtils","MercuryAudioType"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){return a===Object(a)},i="_1c_u",j=new Set(["animated_image","photo","video","third_party_sticker"]),k={getAttachIconClass:function(a){switch(a){case"attach:image":return"_y2-";case"attach:video":return"_y2_";case"attach:music":return"_y30";case"attach:voice":return"_y31";case"attach:text":return"_y32";case"attach:pdf":return"_1k9k";case"attach:richtext":return"_1k9l";case"attach:spreadsheet":return"_1k9p";case"attach:presentation":return"_1k9r";case"attach:archive":return"_1k9s";case"attach:ms:word":return"_y33";case"attach:ms:xls":return"_y34";case"attach:ms:ppt":return"_y35"}return"_y36"},getAttachIconClassByMime:function(a){return k.getAttachIconClass(k.getAttachTypeByMime(a))},getAttachTypeByMime:function(a){if(!a)return"attach:unknown";if(a.startsWith("image"))return"attach:image";else if(a.startsWith("video"))return"attach:video";else if(a.startsWith("audio"))return"attach:music";else if(a.startsWith("text/plain"))return"attach:text";else if(a=="text/pdf"||a=="application/pdf"||a=="application/vnd.pdf"||a=="application/x-pdf")return"attach:pdf";else if(a=="text/richtext"||a=="application/rtf"||a=="application/x-iwork-pages-sffkey")return"attach:richtext";else if(a=="text/csv"||a=="application/x-iwork-numbers-sffkey")return"attach:spreadsheet";else if(a=="application/x-iwork-keynote-sffkey")return"attach:presentation";else if(a=="application/vnd.ms-cab-compressed"||a=="application/x-7z-compressed"||a=="application/x-ace-compressed"||a=="application/x-apple-diskimage"||a=="application/x-compress"||a=="application/x-compressed"||a=="application/x-gzip"||a=="application/x-rar-compressed"||a=="application/x-tar"||a=="application/x-zip-compressed"||a=="application/zip")return"attach:archive";else if(a=="application/msword"||a.startsWith("application/vnd.ms-word")||a.startsWith("application/vnd.openxmlformats-officedocument.wordprocessingml"))return"attach:ms:word";else if(a.startsWith("application/vnd.ms-excel")||a.startsWith("application/vnd.openxmlformats-officedocument.spreadsheetml"))return"attach:ms:xls";else if(a.startsWith("application/vnd.ms-powerpoint")||a.startsWith("application/vnd.openxmlformats-officedocument.presentationml"))return"attach:ms:ppt";else return"attach:unknown"},convertRaw:function(a){var b=[];for(var c=0;c<a.length;c++){var d=a[c];if(d.attach_type==="photo")b.push(d);else if(d.filename){var e=k.getAttachTypeByMime(d.filetype);d={attach_type:"file",name:d.filename,icon_type:e,url:""};b.push(d)}}return b},get:function(a){var c=[];a.attachments?c=a.attachments:a.raw_attachments&&(c=k.convertRaw(a.raw_attachments));var d=b("EmojiLikeUtils").getEmojiSize(a);d&&(c=c.concat([{attach_type:"emoji_like",size:d}]));if(!(a.attachments&&a.attachments.length>0)){if(a.sticker_id)return c.concat([{attach_type:"sticker"}]);if(a.preview_attachments&&a.preview_attachments.length>0)return c.concat(a.preview_attachments)}return c},resizeContain:function(a,b){var c=a.width/a.height,d=b.width/b.height;if(d<c)return{width:Math.ceil(Math.min(a.height*d,b.width)),height:Math.ceil(Math.min(a.height,b.height))};else return{width:Math.ceil(Math.min(a.width,b.width)),height:Math.ceil(Math.min(a.width/d,b.height))}},isBubblePreferred:function(a){return k.isFileAttachment(a)},isPhotoAttachment:function(a){return(k==null?void 0:k.getAttachTypeByMime)&&k.getAttachTypeByMime(a.mime_type)==="attach:pdf"?!1:!!(a.attach_type=="photo"||a.attach_type=="animated_image"||a.attach_type=="third_party_sticker"||a.attach_type=="file"&&a.preview_url)},isPhotoGroupAttachment:function(a){return j.has(a.attach_type)},isSinglePhotoGroupAttachment:function(a){return!!(a.attachments&&a.attachments.length===1&&a.attachments[0]&&k.isPhotoGroupAttachment(a.attachments[0]))},isVideoAttachment:function(a){return a.attach_type=="video"},isShareAttachment:function(a){return a.attach_type=="share"},isFileAttachment:function(a){return a.attach_type=="file"},isErrorAttachment:function(a){return a.attach_type=="error"},isStickerAttachment:function(a){return a.attach_type=="sticker"},isEmojiLikeAttachment:function(a){return a.attach_type==="emoji_like"},isVoiceAttachment:function(a){return!a.metadata?!1:a.metadata.type===b("MercuryAudioType").AudioClip||a.metadata.type===b("MercuryAudioType").VoiceMessageWithTranscript},hasAttribution:function(a){return!!a.app_attribution},isLightweightActionAttachment:function(a){return!!(k.isShareAttachment(a)&&a.share&&a.share.target!=null&&a.share.target.lwa_type!=null)},isSingleVideoAttachment:function(a){a=k.get(a).filter(h).filter(function(a){return k.isVideoAttachment(a)});return a.length===1},isSharedVideoAttachment:function(a){a=a.attach_type==="share"&&a.share&&a.share.subattachments&&a.share.subattachments[0];return!!(a&&a.target&&a.target.video_id)},isGenieSharedVideoAttachment:function(a){return!!(a.attach_type==="share"&&a.share&&a.share.style_list.indexOf("genie_message")>-1&&a.share.target&&a.share.target.attachment&&k.isSharedVideoAttachment(a.share.target.attachment))},isSharedVideoAttachmentMessage:function(a){a=k.get(a).filter(h).filter(function(a){return k.isSharedVideoAttachment(a)||k.isGenieSharedVideoAttachment(a)});return a.length===1},getVideoElem:function(a,b){b=b.getMessageElement(a);if(!b)return null;a=b.getElementsByClassName(i);return a&&a.length?a[0]:b}};e.exports=k}),null);
__d("MercuryDisplayTimeFilterMessageRenderer",["fbt"],(function(a,b,c,d,e,f,g){"use strict";a={renderFilteredContent:function(a){if(a.is_filtered_content_bh)return g._("This message was removed because it includes a link that goes against our Community Standards.");if(a.is_filtered_content_account)return g._("This message has been temporarily removed because the sender's account requires verification.");if(a.is_filtered_content_quasar)return g._("This message was removed because it contains blocked or harmful content.");return a.is_filtered_content_invalid_app?g._("This message was removed because the app that it's being sent from is blocked from sending messages."):g._("This message has been temporarily removed because the sender's account requires verification, or it has been identified as abusive.")}};e.exports=a}),null);
__d("MercuryLocalIDs",["randomInt"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return"root:"+h(a)}function h(a){a=a!=null?a:Date.now();var b=c("randomInt")(0,4294967295);b=("0000000000000000000000"+b.toString(2)).slice(-22);a=a.toString(2)+b;return i(a.slice(-63))}function i(a){var b="";a=a;while(a!="0"){var c=0,d="";for(var e=0;e<a.length;e++)c=2*c+parseInt(a[e],10),c>=10?(d+="1",c-=10):d+="0";b=c.toString()+b;a=d.slice(d.indexOf("1"))}return b}g.generateThreadID=a;g.generateOfflineThreadingID=h}),98);
__d("MercuryMessageClientState",[],(function(a,b,c,d,e,f){a=Object.freeze({DO_NOT_SEND_TO_SERVER:"do_not_send_to_server",SEND_TO_SERVER:"send_to_server"});b=a;f["default"]=b}),66);
__d("MercuryMessageIDs.bs",["KeyedCallbackManager","bs_curry","bs_js_dict"],(function(a,b,c,d,e,f){"use strict";var g=new(b("KeyedCallbackManager"))();function a(a,c){var d=a.filter(function(a){return a.indexOf("id")===-1}),e=function(d){return b("bs_curry")._1(c,a.map(function(a){var c=b("bs_js_dict").get(d,a);if(c!==void 0)return c;else return a}))};return g.executeOrEnqueue(d,e)}function c(a,b){g.setResource(a,b)}f.getServerIDs=a;f.addServerID=c}),null);
__d("MercurySingletonProvider",["CurrentUser"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){this.$1={},this.$2=a}var c=a.prototype;c.getForFBID=function(a){this.$1[a]||(this.$1[a]=new this.$2(a));return this.$1[a]};c.get=function(){return this.getForFBID(b("CurrentUser").getID())};c.resetAll=function(){var a=this.$1;this.$1={};return a};a.mock=function(a){throw new Error("MercurySingletonProvider.mock() must only be used in tests.")};return a}();e.exports=a}),null);
__d("MessengerMQTTConnectionEvents",[],(function(a,b,c,d,e,f){"use strict";a="messenger-mqtt-delta";b="messenger-mqtt-stream-disconnect";c="messenger-mqtt-stream-connecting";d="messenger-mqtt-stream-connect";e="Connected";var g="Disconnected",h="Connecting",i="messenger-mqtt-typ";f.DELTA_EVENT=a;f.STREAM_DISCONNECT=b;f.STREAM_CONNECTING=c;f.STREAM_CONNECT=d;f.STATE_CONNECTED=e;f.STATE_DISCONNECTED=g;f.STATE_CONNECTING=h;f.TYP=i}),66);
__d("MercurySyncEventsProxy",["Arbiter","ChannelConstants","LogHistory","MercuryMessagingLightswitch","MercurySingletonProvider","MessengerMQTTConnectionEvents"],(function(a,b,c,d,e,f,g){"use strict";var h=d("LogHistory").getInstance("mercury_event_proxy"),i={DELTA:"DELTA",FAKE_DFF:"FAKE_DFF",FLOW:"FLOW",FLOW_REJECT:"FLOW_REJECT",INIT:"MercurySyncDeltaHandler/initSeqID",CONNECTED:"CONNECTED",RECONNECTING:"RECONNECTING",SHUTDOWN:"SHUTDOWN",TYP:"TYP"};a=function(){a.getArbiterTypeForFBID=function(a,b){return a+"/"+b};a.getForFBID=function(a){return j.getForFBID(a)};a.get=function(){return j.get()};function a(a){this.$2=[],this.$1=a,this.init()}var b=a.prototype;b.getArbiterType=function(b){return a.getArbiterTypeForFBID(this.$1,b)};b.init=function(){var a=this;this.$2.forEach(function(a){return c("Arbiter").unsubscribe(a)});this.$2=[c("Arbiter").subscribe(d("MessengerMQTTConnectionEvents").DELTA_EVENT,function(b){for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return c("Arbiter").inform.apply(c("Arbiter"),[a.getArbiterType(i.DELTA)].concat(e))}),c("Arbiter").subscribe(d("MessengerMQTTConnectionEvents").STREAM_CONNECT,function(b){for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return c("Arbiter").inform.apply(c("Arbiter"),[a.getArbiterType(i.CONNECTED)].concat(e))}),c("Arbiter").subscribe(d("MessengerMQTTConnectionEvents").STREAM_DISCONNECT,function(b){for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return c("Arbiter").inform.apply(c("Arbiter"),[a.getArbiterType(i.SHUTDOWN)].concat(e))}),c("Arbiter").subscribe(d("MessengerMQTTConnectionEvents").STREAM_CONNECTING,function(b){for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return c("Arbiter").inform.apply(c("Arbiter"),[a.getArbiterType(i.RECONNECTING)].concat(e))}),c("Arbiter").subscribe(d("ChannelConstants").getArbiterType(d("ChannelConstants").FAKE_DFF),function(b){c("MercuryMessagingLightswitch").guard(function(){h.debug("fakedff",JSON.stringify({fbid:a.$1}))});for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];c("Arbiter").inform.apply(c("Arbiter"),[a.getArbiterType(i.FAKE_DFF)].concat(e))}),c("Arbiter").subscribe(d("MessengerMQTTConnectionEvents").TYP,function(b){for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];c("Arbiter").inform.apply(c("Arbiter"),[a.getArbiterType(i.TYP)].concat(e))})]};return a}();a.Events=i;var j=new(c("MercurySingletonProvider"))(a);g["default"]=a}),98);
__d("MercuryThreadInfo",["MercuryIDs"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return!!(a.is_subscribed&&(a.can_reply===void 0||a.can_reply)&&!a.has_email_participant&&!a.read_only)}function h(a){return a.mute_until==null?void 0:a.mute_until}function i(a){return d("MercuryIDs").tokenize(a.thread_id).type==="root"&&!a.timestamp}function b(a){a=h(a);return a!=null&&(a>Date.now()/1e3||a===-1)}function c(a){return a.mentions_mute_mode===1}function e(a){return a.reactions_mute_mode===1}function f(a){return!!(i(a)&&a.participants&&a.participants.length===0)}function j(a){return!!((a.can_reply||!a.cannot_reply_reason||a.cannot_reply_reason.toLowerCase()==="blocked"||a.cannot_reply_reason.toLowerCase()==="messenger_blockee")&&!a.has_email_participant&&!a.read_only&&a.is_subscribed)}function k(a){return!!(a.is_canonical_user&&(a.message_count===0||!a.timestamp))}g.canReply=a;g.getMuteSetting=h;g.isEmptyLocalThread=i;g.isMuted=b;g.areMentionsMuted=c;g.areReactionsMuted=e;g.isNewEmptyLocalThread=f;g.showSettingsMenu=j;g.isColdOpen=k}),98);
__d("MercuryThreadInformer",["ArbiterMixin","LogHistory","MercuryAssert","MercuryMessagingLightswitch","MercurySingletonProvider","mixin"],(function(a,b,c,d,e,f,g){"use strict";var h=d("LogHistory").getInstance("mercury_informer");a=function(a){babelHelpers.inheritsLoose(b,a);b.get=function(){return i.get()};b.getForFBID=function(a){return i.getForFBID(a)};function b(b){var c;c=a.call(this)||this;c.$MercuryThreadInformer1=b;c.$MercuryThreadInformer2={};c.$MercuryThreadInformer3={};c.$MercuryThreadInformer4={};c.$MercuryThreadInformer5={};c.$MercuryThreadInformer6=!1;c.$MercuryThreadInformer7=!1;c.$MercuryThreadInformer8=!1;c.$MercuryThreadInformer9=!1;c.$MercuryThreadInformer10={};c.$MercuryThreadInformer11={};c.$MercuryThreadInformer12={};c.$MercuryThreadInformer13={};c.$MercuryThreadInformer14=0;return c}var e=b.prototype;e.informNewMessage=function(a,b){this.inform("new-message",{threadID:a,message:b})};e.informNewLogMessage=function(a,b){this.inform("new-log-message",{threadID:a,message:b})};e.updatedThread=function(a){this.$MercuryThreadInformer3[a]=!0,this.$MercuryThreadInformer15()};e.invalidatedThread=function(a){this.$MercuryThreadInformer4[a]=!0,this.$MercuryThreadInformer15()};e.deletedThread=function(a){this.$MercuryThreadInformer2[a]=!0,this.$MercuryThreadInformer15()};e.updatedThreadlist=function(){this.$MercuryThreadInformer6=!0,this.$MercuryThreadInformer15()};e.updatedUnseenState=function(){this.$MercuryThreadInformer7=!0,this.$MercuryThreadInformer15()};e.updatedUnseenTimestamp=function(){this.$MercuryThreadInformer8=!0,this.$MercuryThreadInformer15()};e.updatedUnreadState=function(){this.$MercuryThreadInformer9=!0,this.$MercuryThreadInformer15()};e.changedThreadReadState=function(a,b,c){(!this.$MercuryThreadInformer5[a]||this.$MercuryThreadInformer5[a].timestamp<c)&&(this.$MercuryThreadInformer5[a]={mark_as_read:b,timestamp:c}),this.$MercuryThreadInformer15()};e.receivedMessage=function(a){d("MercuryAssert").isThreadID(a.thread_id);var b=a.thread_id;this.$MercuryThreadInformer10[b]||(this.$MercuryThreadInformer10[b]=[]);this.$MercuryThreadInformer10[b].push(a);this.updatedThread(b)};e.reorderedMessages=function(a,b){this.$MercuryThreadInformer11[a]={source:b},this.$MercuryThreadInformer15()};e.updatedMessage=function(a,b,c){this.$MercuryThreadInformer12[a]||(this.$MercuryThreadInformer12[a]={}),this.$MercuryThreadInformer12[a][b]={source:c},this.updatedThread(a)};e.deletedMessage=function(a,b,c,d){this.$MercuryThreadInformer13[a]||(this.$MercuryThreadInformer13[a]={}),this.$MercuryThreadInformer13[a][b]={attachmentIDs:d,source:c},this.updatedThread(a)};e.synchronizeInforms=function(a){this.$MercuryThreadInformer14++;try{a()}catch(a){throw a}finally{this.$MercuryThreadInformer14--,this.$MercuryThreadInformer15()}};e.listen=function(a,b){return this.subscribe("threads-updated",function(c,d){d[a]&&b(a)})};e.$MercuryThreadInformer15=function(){if(!this.$MercuryThreadInformer14){var a=this.$MercuryThreadInformer2,b=this.$MercuryThreadInformer3,c=this.$MercuryThreadInformer4,d=this.$MercuryThreadInformer5,e=this.$MercuryThreadInformer6,f=this.$MercuryThreadInformer7,g=this.$MercuryThreadInformer8,h=this.$MercuryThreadInformer9,i=this.$MercuryThreadInformer10,j=this.$MercuryThreadInformer11,k=this.$MercuryThreadInformer12,l=this.$MercuryThreadInformer13;this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4={};this.$MercuryThreadInformer5={};this.$MercuryThreadInformer6=!1;this.$MercuryThreadInformer7=!1;this.$MercuryThreadInformer8=!1;this.$MercuryThreadInformer9=!1;this.$MercuryThreadInformer10={};this.$MercuryThreadInformer11={};this.$MercuryThreadInformer12={};this.$MercuryThreadInformer13={};var m=Object.keys(b);(m.length||e)&&this.inform("threadlist-updated",m);m.length&&this.$MercuryThreadInformer16("threads-updated",b);for(var e in c){this.$MercuryThreadInformer16("thread-invalidated",c);break}for(var e in d){this.$MercuryThreadInformer16("thread-read-changed",d);break}for(e in a){this.$MercuryThreadInformer16("threads-deleted",a);break}f&&this.$MercuryThreadInformer16("unseen-updated",null);g&&this.$MercuryThreadInformer16("unseen-timestamp-updated",null);h&&this.$MercuryThreadInformer16("unread-updated",null);for(e in i){this.$MercuryThreadInformer16("messages-received",i);break}for(e in j){this.$MercuryThreadInformer16("messages-reordered",j);break}for(e in k){this.$MercuryThreadInformer16("messages-updated",k);break}for(e in l){this.$MercuryThreadInformer16("messages-deleted",l);break}}};e.$MercuryThreadInformer16=function(a,b){a==="threads-updated"&&c("MercuryMessagingLightswitch").guard(function(){h.debug(a,JSON.stringify(b))}),this.inform(a,b)};return b}(c("mixin")(d("ArbiterMixin")));var i=new(c("MercurySingletonProvider"))(a);g["default"]=a}),98);
__d("MercuryViewer",["CurrentUser","MercuryAssert"],(function(a,b,c,d,e,f,g){"use strict";var h="fbid:"+c("CurrentUser").getID();function a(){return h}function b(a){d("MercuryAssert").isParticipantID(a);return a===h}g.getID=a;g.isViewer=b}),98);
__d("ThreadConnectivityStatusGraphQLType.bs",[],(function(a,b,c,d,e,f){"use strict";a="UNCONNECTED";b="IMPLICIT_OR_TWO_WAY_MESSAGING";f.unconnected=a;f.implicitOrTwoWayMessaging=b}),null);
__d("ThreadConnectivityStatusGraphQLType.re",["ThreadConnectivityStatusGraphQLType.bs"],(function(a,b,c,d,e,f){a=b("ThreadConnectivityStatusGraphQLType.bs").unconnected;f.unconnected=a;c=b("ThreadConnectivityStatusGraphQLType.bs").implicitOrTwoWayMessaging;f.implicitOrTwoWayMessaging=c}),null);
__d("getPageIDFromThreadID",["FBIDCheck","MercuryIDs"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=d("MercuryIDs").getUserIDFromThreadID(a);return!a||d("FBIDCheck").isUser_deprecated(a)?null:a}g["default"]=a}),98);
__d("MessageRequestUtils",["CurrentUser","MercuryIDs","MessagingTag","ThreadConnectivityStatusGraphQLType.re","getPageIDFromThreadID"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return(a.folder===c("MessagingTag").PENDING||a.folder===c("MessagingTag").OTHER)&&a.can_reply}function b(a){return a.folder===c("MessagingTag").OTHER}function e(a){return this.isMessageRequest(a)&&(d("MercuryIDs").isGroupChat(a.thread_id)||!!c("getPageIDFromThreadID")(a.thread_id)||c("CurrentUser").isWorkUser())}function f(a){var b;return!c("CurrentUser").isWorkUser()&&c("CurrentUser").getID()!==a.other_user_fbid&&((b=a.thread_connectivity_data)==null?void 0:b.connectivity_status)===d("ThreadConnectivityStatusGraphQLType.re").unconnected&&((b=a.thread_connectivity_data)==null?void 0:b.first_sender_id)===a.other_user_fbid}function h(a){if(!a)return!1;if(this.isMessageRequest(a))return!1;return c("CurrentUser").isWorkUser()||d("MercuryIDs").isGroupChat(a.thread_id)?!0:((a=a.thread_connectivity_data)==null?void 0:a.connectivity_status)===d("ThreadConnectivityStatusGraphQLType.re").implicitOrTwoWayMessaging}g.isMessageRequest=a;g.isFiltered=b;g.shouldShowComposerPendingActions=e;g.shouldShowUnconnectedThreadInfoText=f;g.shouldSendTypingIndicators=h}),98);
__d("MessengerDesktopNotificationPermissions",[],(function(a,b,c,d,e,f){a=Object.freeze({DEFAULT:"default",DENIED:"denied",GRANTED:"granted"});f["default"]=a}),66);
__d("MessengerDesktopNotifications",["MessengerDesktopNotificationPermissions","Run","UserAgent","WorkplaceChatHelper"],(function(a,b,c,d,e,f,g){"use strict";var h=5e3,i=new Map();function a(){i.forEach(function(a,b,c){a.close&&a.close()})}var j=null;function b(){return!!window.Notification}function e(){if(window.Notification)return window.Notification.permission}function f(){return c("UserAgent").isBrowser("FireFox")&&c("UserAgent").isPlatform("Mac OS X")}function k(){return this.checkPermission()===c("MessengerDesktopNotificationPermissions").DENIED}function l(){return this.checkPermission()===c("MessengerDesktopNotificationPermissions").GRANTED}function m(a){window.Notification&&window.Notification.requestPermission(a)}function n(a){if(this.isGranted()){var b=window.Notification?new window.Notification(a.title,{body:a.body,icon:a.icon,tag:a.tag,silent:a.silent}):{};i.set(a.tag,b);a.onShow&&a.onShow();b.onclick=function(){d("WorkplaceChatHelper").isDesktopChatApp()&&d("WorkplaceChatHelper").showWindow(),a.onClick()};b.onclose=function(){i["delete"](a.tag)};this._closeTimer=setTimeout(function(){b.close()},a.closeTime||h);return b}else return null}function o(a){a=i.get(a);a&&a.close()}d("Run").onUnload(a);g._closeTimer=j;g.isSupported=b;g.checkPermission=e;g.hasDefaultSound=f;g.isDenied=k;g.isGranted=l;g.requestPermission=m;g.showNotification=n;g.removeNotification=o}),98);
__d("MessengerFolders.bs",["MercuryFoldersConfig","MessagingThreadType","MessengerEnvironment","gkx","qex"],(function(a,b,c,d,e,f){"use strict";d=b("qex")._("998180")===!0&&b("MessengerEnvironment").messengerdotcom?["inbox","pending","other","action:archived","marketplace_folder"]:["inbox","pending","other","action:archived"];var g=d.filter(function(a){if(a==="pending")return!b("MercuryFoldersConfig").hide_message_filtered;else if(a==="other")return!b("MercuryFoldersConfig").hide_message_requests;else return!0});function a(a){return[].concat(g)}function c(a){if(a.is_archived)return"action:archived";var c=a.thread_type;if(!(c==null)&&c===b("MessagingThreadType").MARKETPLACE&&b("gkx")("965951"))return"marketplace_folder";else return a.folder}f.getSupportedFolders=a;f.getFromMeta=c}),null);
__d("MercuryMessageDeliveryState",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({SENDING:1,SENT:2,DELIVERED:3,ERROR:0,UNKNOWN:-1});f["default"]=a}),66);
__d("Utils.bs",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(a==null)return!1;else return a}function b(a){if(a!==void 0)return a;else return!1}f.isTruthy=a;f.optionBoolToBool=b}),null);
__d("MessengerMessage.bs",["MercuryActionStatus","MercuryActionType","MercuryLogMessageType","MercuryMessageDeliveryState","MercuryPayloadSource","MercuryViewer","URI","Utils.bs","bs_caml","bs_caml_obj","bs_caml_option","bs_js_dict","bs_js_json","isMessengerDotComURI"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,b,c,d,e,f){b={thread_id:b,thread_fbid:null,other_user_fbid:null,action_type:d,message_id:a,secondary_language_body:null,threading_id:null,offline_threading_id:null,author:c,author_email:"",ephemeral_ttl_mode:null,timestamp:e,is_unread:null,is_filtered_content:!1,is_filtered_content_bh:!1,is_filtered_content_account:!1,is_filtered_content_quasar:!1,is_filtered_content_invalid_app:!1,is_sponsored:!1,is_one_way_sent:!1,ad_id:null,ad_client_token:null,commerce_message_type:null,customizations:[],source:"",source_tags:[],m_suggestions:null,tags:[],is_spoof_warning:!1,folder:"inbox",platform_xmd:null,message_source:null,montage_reply_data:null,replied_to_message:null,skip_bump_thread:!1,profile_ranges:null,reactions:null,attachments:null,ranges:null,meta_ranges:null,status:null,log_message_type:null,log_message_data:null,log_message_body:null,raw_attachments:null,body:null,subject:null,has_attachment:null,creator_info:null,error_data:null,removed_timestamp:null,unsender:null,verse_group_role_xmd:null,message_unsendability_status:null,is_forwarded:!1,preview_attachments:null,sticker_id:null,mib_direct_message_data:null};return Object.assign(b,f)}function c(a){var b=a.offline_threading_id;if(b==null)return!1;else return b===a.message_id}function d(a){if(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE))return!0;a=a.log_message_type;if(a==null)return!0;else return!(b("bs_caml_obj").caml_equal(a,b("MercuryLogMessageType").SUBSCRIBE)||b("bs_caml_obj").caml_equal(a,b("MercuryLogMessageType").UNSUBSCRIBE)||b("bs_caml_obj").caml_equal(a,b("MercuryLogMessageType").SERVER_ERROR)||b("bs_caml_obj").caml_equal(a,b("MercuryLogMessageType").LIVE_LISTEN))}function e(a){var c=a.ranges;if(c==null)return;c=c.map(function(a){var c=a.entity;if(c==null)return a;var d=b("Utils.bs").isTruthy(c.external),e=c.url;if(d)return a;if(e==null)return a;d=new(g||(g=b("URI")))(e);e=b("isMessengerDotComURI")(g.getRequestURI());var f=d.getDomain();if(!e)return a;return!(f==null)&&f!==""?a:Object.assign(Object.assign({},a),{entity:Object.assign(Object.assign({},c),{url:d.setProtocol("https").setDomain("www.facebook.com").toString()})})});Object.assign(a,{ranges:c})}function h(a){if(b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").UNKNOWN)||b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").SERVER_INITIAL_DATA)||b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO))return!0;else return b("bs_caml_obj").caml_equal(a,b("MercuryPayloadSource").SERVER_THREAD_SYNC)}function i(a){a=a.author;if(a==null)return!1;else return a===b("MercuryViewer").getID()}function j(a){a=a.author;if(a==null)return!1;else return a!==b("MercuryViewer").getID()}function k(a){a=a.status;if(a==null)return!1;else if(b("bs_caml_obj").caml_equal(a,b("MercuryActionStatus").UNSENT)||b("bs_caml_obj").caml_equal(a,b("MercuryActionStatus").UNCONFIRMED)||b("bs_caml_obj").caml_equal(a,b("MercuryActionStatus").UNABLE_TO_CONFIRM))return!0;else return b("bs_caml_obj").caml_equal(a,b("MercuryActionStatus").RESENDING)}function l(a){a=a.status;if(a==null)return!0;else return b("bs_caml_obj").caml_equal(a,b("MercuryActionStatus").SUCCESS)}function m(a,c){return b("bs_caml").caml_float_compare(a.timestamp,c.timestamp)}function n(a){a=a.status;if(a==null)return!1;else if(b("bs_caml_obj").caml_equal(a,b("MercuryActionStatus").FAILED_UNKNOWN_REASON)||b("bs_caml_obj").caml_equal(a,b("MercuryActionStatus").UNABLE_TO_CONFIRM))return!0;else return b("bs_caml_obj").caml_equal(a,b("MercuryActionStatus").ERROR)}function o(a){a=a.error_data;if(!(a==null))return b("bs_caml_option").nullable_to_opt(a.description)}function p(a,c){if(n(a))return b("MercuryMessageDeliveryState").ERROR;else if(k(a))return b("MercuryMessageDeliveryState").SENDING;else if(l(a))if(a.is_one_way_sent||a.timestamp>c)return b("MercuryMessageDeliveryState").SENT;else return b("MercuryMessageDeliveryState").DELIVERED;else return b("MercuryMessageDeliveryState").UNKNOWN}function q(a,b){if(n(a))return 4;else if(k(a))return 1;else if(l(a))if(a.timestamp<=b&&!a.is_one_way_sent)return 3;else return 2;else return 0}function r(a){try{a=b("bs_caml_option").some(JSON.parse(a))}catch(b){a=void 0}if(a===void 0)return;a=b("bs_js_json").classify(b("bs_caml_option").valFromOption(a));if(typeof a==="number")return;if(a.TAG!==2)return;a=b("bs_js_dict").get(a._0,"persona");if(a===void 0)return;a=b("bs_js_json").classify(b("bs_caml_option").valFromOption(a));if(typeof a==="number"||a.TAG!==2)return;else return b("bs_caml_option").some(a._0)}function s(a){if(a==null)return null;a=a.platform_xmd;if(a==null)return null;a=r(a);if(a===void 0)return null;a=b("bs_caml_option").valFromOption(a);var c=b("bs_js_dict").get(a,"id"),d=b("bs_js_dict").get(a,"name");a=b("bs_js_dict").get(a,"profile_picture_url");if(c!==void 0&&d!==void 0&&a!==void 0)return{id:b("bs_caml_option").valFromOption(c),name:b("bs_caml_option").valFromOption(d),profile_picture_url:b("bs_caml_option").valFromOption(a)};else return null}function t(a){var c=a.log_message_type;if(!(c==null)&&b("bs_caml_obj").caml_equal(c,b("MercuryLogMessageType").SERVER_ERROR))return b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").LOG_MESSAGE);else return!1}function u(a,b){var c=a.thread_fbid,d=a.other_user_fbid;a=a.is_from_iris;if(!(b==null)&&b)return!1;if(!(c==null)||!(d==null)||a)return!0;else return!1}f.makeFakeMessage=a;f.isLocalMessage=c;f.isTitanMessage=d;f.finalizeRanges=e;f.shouldSortForPayloadSource=h;f.isOutbound=i;f.isInbound=j;f.isSending=k;f.isSent=l;f.compare=m;f.hasError=n;f.getError=o;f.getDeliveryState=p;f.getGutterItemStatus=q;f.getPersonaData=r;f.getPersona=s;f.isErrorLogMessage=t;f.hasServerTimestamp=u}),null);
__d("MessengerPersonas.bs",["bs_js_dict","bs_js_null_undefined"],(function(a,b,c,d,e,f){"use strict";var g={};function a(a){if(a==null)return;var c=b("bs_js_dict").get(g,a.id);if(c!==void 0)return;else{g[a.id]=a;return}}function c(a){return b("bs_js_null_undefined").fromOption(b("bs_js_dict").get(g,a))}f.personas=g;f.addPersona=a;f.getNow=c}),null);
__d("MessengerSharedMediaActionsLoader",["JSResource"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("JSResource").loadAll([c("JSResource")("MessengerSharedMediaActions").__setRef("MessengerSharedMediaActionsLoader")],function(c){c.deletePhotos(a,b)})}g.deletePhotos=a}),98);
__d("MessengerSharedPhotosVideosBaseData.bs",["bs_js_dict"],(function(a,b,c,d,e,f){"use strict";var g={};function a(a){return b("bs_js_dict").get(g,a)}function h(a,b){g[a]=b}function c(a,c){var d=b("bs_js_dict").get(g,a);if(d===void 0)return;var e=d.actualData;if(e===void 0)return;var f=e.edges;if(f.length===0)return;f=f.filter(function(a){return!c.some(function(b){return b===a.node.legacy_attachment_id})});d=d.fetchingState;f={edges:f,newestItemCursor:e.newestItemCursor,oldestItemCursor:e.oldestItemCursor,hasNextPage:e.hasNextPage};e={fetchingState:d,actualData:f};return h(a,e)}f.data=g;f.get=a;f.set=h;f.localRemove=c}),null);
__d("MessengerJoinableModeType",[],(function(a,b,c,d,e,f){a=Object.freeze({PRIVATE:0,JOINABLE:1});f["default"]=a}),66);
__d("MessengerThreadUtils.bs",["CurrentUser","FBID.bs","ImmutableObject","MercuryIDs","MercuryParticipantTypes","MessengerJoinableModeType","MessengerObjectAssociationType","MessengerParticipants.bs","MessengerThreadCannotReplyReason","bs_caml_obj"],(function(a,b,c,d,e,f){"use strict";function g(a,c){return c.filter(function(c){return b("bs_caml_obj").caml_notequal(c,a)}).length<=1}function h(a,c,d,e){var f=b("MercuryIDs").tokenize(c),h=f.type;f=f.value;var i=d.find(function(b){return b!==a});i=i!==void 0?b("MessengerParticipants.bs").getNow(i):null;var j=b("CurrentUser").isWorkUser();j=!(i==null)&&j&&i.work_foreign_entity_info==null&&i.user_type===b("MercuryParticipantTypes").USER?[!1,b("MessengerThreadCannotReplyReason").RECIPIENTS_INVALID]:[!0,null];return new(b("ImmutableObject"))({thread_id:c,participants:Array.from(d),preloaded_participants:[],admins:{},name:"",snippet:"",snippet_sender:null,unread_count:e==null?0:e,message_count:0,image_src:null,square_image_src:null,timestamp:0,other_user_fbid:h==="user"?b("FBID.bs").ofStringExn(f):null,is_canonical_user:h==="user",is_canonical:g(a,d),is_subscribed:!0,is_other_recipient_page:!1,folder:"inbox",is_archived:!1,is_page_follow_up:!1,is_page_unresponded_thread:!1,admin_model_status:null,approval_mode:0,approval_queue_ids:[],associated_object:null,can_reply:j[0],cannot_reply_reason:j[1],can_viewer_report:!1,comm_item_owners:null,comm_source_id:null,comm_status:null,comm_icon_type:[],composer_input_disabled:null,custom_like_icon:null,custom_nickname:null,customization_enabled:!1,description:null,ephemeral_ttl_mode:0,footer_color:null,game_id:null,group_approval_queue:null,work_associated_group:null,pinned_messages:null,groups_sync_status:null,group_thread_subtype:null,has_email_participant:!1,has_montage:!1,unread_mentions_count:0,header_color:null,is_canonical_neo_user:!1,is_from_weak_entry_point:!1,is_pin_protected:!1,is_pinned:!1,is_thread_queue_enabled:!1,joinable_mode:{mode:0,link:""},last_message_timestamp:0,last_message_id:null,last_message_type:null,last_read_timestamp:0,last_message_admin_text_type:null,last_message_unsendability_status:null,lightweight_event:null,lightweight_events:{},marketplace_thread_data:null,mentions_mute_mode:0,mute_until:null,object_association_type:null,page_comm_item_id:null,page_thread_info:null,page_unsubscribe_status:!1,participant_add_mode:null,participants_event_status:null,reactions_mute_mode:0,read_only:!1,recipients_loadable:!1,rtc_call_data:null,server_timestamp:0,snippet_attachments:[],solid_color:null,subtitle:null,theme_id:null,reactions:void 0,thread_connectivity_data:null,thread_fbid:null,thread_pin_timestamp:null,thread_type:null,thread_unsendability_status:null,gradient_colors:[],accessibility_label:null,reverse_gradients_for_radial:null,joinable_link:null,linked_mentorship_programs:null,is_business_page_active:!1,thread_associated_job_applications:null,thread_associated_page_admin:null,graphql_token:null,conversion_detection_data:null,suggested_reply_data:null})}function a(a,c,d,e){a=h(a,c,d,null);return b("ImmutableObject").set(a,{associated_object:e,name:e.name,joinable_mode:{mode:b("MessengerJoinableModeType").JOINABLE,link:""},object_association_type:b("MessengerObjectAssociationType").GENERAL_CHAT})}f.isCanonicalFromInitialParticipants=g;f.createNewLocalThread=h;f.createNewLocalGroupGeneralThread=a}),null);
__d("MessengerWebEvent",[],(function(a,b,c,d,e,f){a=Object.freeze({RENDER_FIRST_THREAD_CONTENT:"render_first_thread_content",SEND_MSG:"send_msg",SENT_MSG:"sent_msg",RENDER_INCOMING_MSG:"render_incoming_msg",RENDER_INBOX:"render_inbox",RENDER_INBOX_TRAY:"render_inbox_tray",SHOW_SIDEBAR_CONTACTS:"show_sidebar_contacts",SEARCH_RENDER_RESULT:"search_render_result",CREATE_THREAD:"create_thread",SEARCH_CLICK_RESULT:"search_click_result",CHANGE_NICKNAME:"change_nickname",SUPPRESS_NEW_MESSAGE:"suppress_new_message",DELIVERY_RECEIPT:"delivery_receipt",INBOX_TRAY_SCROLL:"inbox_tray_scroll",OPEN_CHAT_TAB:"open_chat_tab",SWITCH_CHAT_TAB:"switch_chat_tab",MINIMIZE_CHAT_TAB:"minimize_chat_tab",LOAD_TAB_FROM_COOKIE:"load_tab_from_cookie",OPEN_THREAD_SETTINGS_MENU:"open_thread_settings_menu",OPEN_EMOJI_FLYOUT:"open_emoji_flyout",OPEN_STICKER_FLYOUT:"open_sticker_flyout",MINIMIZE_ALL_CHAT_TABS:"minimize_all_chat_tabs",CLOSE_ALL_CHAT_TABS:"close_all_chat_tabs",ADD_PARTICIPANT:"add_participant",SELECT_FILE_FOR_UPLOAD:"select_file_for_upload",UPLOAD_FILE_SUCCESS:"upload_file_success",HIT_SEND_MESSAGE_WITH_FILES_PENDING:"hit_send_message_with_files_pending",HIT_SEND_MESSAGE_WITH_ALL_FILES_UPLOADED:"hit_send_message_with_all_files_uploaded",SEND_FILES:"send_files",RENDER_QUICK_REPLIES:"render_quick_replies",CLICK_ICEBKREAKER:"click_icebreaker",OPEN_MEDIA_AND_FILES:"open_media_and_files",OPEN_MEDIA_TAB:"open_media_tab",OPEN_FILES_TAB:"open_files_tab",OPEN_LINKS_TAB:"open_links_tab",SHARED_MEDIA_CLICK:"shared_media_click",SHARED_FILE_CLICK:"shared_file_click",SHARED_LINK_CLICK:"shared_link_click",IDB_NOT_SUPPORTED:"idb_not_supported",LOCAL_STORAGE_NOT_SUPPORTED:"local_storage_not_supported",MULTI_TAB_MUTEX_NO_PERMISSION_LOCALTAKEOVER:"multi_tab_mutex_no_permission_localtakeover",MULTI_TAB_MUTEX_NO_PERMISSION_INIT:"multi_tab_mutex_no_permission_init",MULTI_TAB_MUTEX_NO_PERMISSION_REINIT:"multi_tab_mutex_no_permission_reinit"});f["default"]=a}),66);
__d("ParticipantId.bs",["bs_belt_Id","bs_string"],(function(a,b,c,d,e,f){"use strict";a=b("bs_string").compare;c=b("bs_belt_Id").MakeComparable({cmp:a});d=c.cmp;f.cmp=d}),null);
__d("RemoteAction.bs",["bs_curry"],(function(a,b,c,d,e,f){"use strict";function g(a){}function a(a){return{send:g}}function c(a,b){if(b.send===g){b.send=a;return b}}function d(a){a.send=g}function e(a,c){return b("bs_curry")._1(a.send,c)}f.create=a;f.subscribe=c;f.unsubscribe=d;f.send=e}),null);
__d("ThreadConnectivityStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({UNCONNECTED:0,IMPLICIT_OR_TWO_WAY_MESSAGING:1});f["default"]=a}),66);
__d("ThreadConnectivityStatus.bs",["ThreadConnectivityStatus","ThreadConnectivityStatusGraphQLType.bs","bs_caml_obj"],(function(a,b,c,d,e,f){"use strict";function a(a){if(b("bs_caml_obj").caml_equal(a,b("ThreadConnectivityStatus").UNCONNECTED))return b("ThreadConnectivityStatusGraphQLType.bs").unconnected;else return b("ThreadConnectivityStatusGraphQLType.bs").implicitOrTwoWayMessaging}f.toGraphQLValue=a}),null);
__d("ThreadId.bs",["bs_belt_Id","bs_string"],(function(a,b,c,d,e,f){"use strict";a=b("bs_string").compare;c=b("bs_belt_Id").MakeComparable({cmp:a});d=c.cmp;f.cmp=d}),null);
__d("TypingStates",[],(function(a,b,c,d,e,f){a=Object.freeze({INACTIVE:0,TYPING:1,QUITTING:2});f["default"]=a}),66);
__d("XGroupsController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/groups/{idorvanity}/{?view}/{?post_id}/",{comment_id:{type:"Int"},reply_comment_id:{type:"Int"},idorvanity:{type:"String",required:!0},view:{type:"Enum",enumType:1},post_id:{type:"Int"},story_title:{type:"String"},rule_id:{type:"Int"},ref:{type:"String"},source_id:{type:"String"},notif_t:{type:"String"},nux:{type:"Enum",enumType:1},tip_id:{type:"Int"},feedback_id:{type:"FBID"},member_tag_id:{type:"FBID"},section:{type:"Enum",enumType:1},thread_id:{type:"String"},support_thread_id:{type:"String"},mentorship_profile_id:{type:"FBID"},autopopup_create_chat_dialog:{type:"Bool",defaultValue:!1},sorting_setting:{type:"String"},multi_events:{type:"String"},stories:{type:"Exists",defaultValue:!1},topics:{type:"Exists",defaultValue:!1},highlight_location:{type:"Exists",defaultValue:!1},highlight_sections:{type:"Exists",defaultValue:!1},highlight_groupapps:{type:"Exists",defaultValue:!1},highlight_pixel:{type:"Exists",defaultValue:!1},highlight_mentorship_option:{type:"Exists",defaultValue:!1},highlight_fundraiser_option:{type:"Exists",defaultValue:!1},highlight_auto_approval:{type:"Exists",defaultValue:!1},highlight_page_member:{type:"Exists",defaultValue:!1},highlight_units_edit_bar:{type:"Exists",defaultValue:!1},highlight_keyword_alerts:{type:"Exists",defaultValue:!1},queue:{type:"Enum",enumType:1},composer_prefill:{type:"String"},hide_workplace_pagelet:{type:"Bool",defaultValue:!1},permalink_add_comment_nux_shown:{type:"Bool",defaultValue:!1},work_learning_entry_point:{type:"Enum",enumType:1},chained_wp:{type:"Bool",defaultValue:!1},hoist_pending_member_ids_suggested_order:{type:"FBIDKeyset"},hashtags:{type:"Exists",defaultValue:!1},sale_post_id:{type:"FBID"},exp:{type:"String"},invite_short_link_key:{type:"String"}})}),null);
__d("XMercuryThreadLikeIconController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/mercury/like_icon/",{emoji:{type:"String",defaultValue:""}})}),null);
__d("bs_belt_SortArray",["bs_belt_Array","bs_curry"],(function(a,b,c,d,e,f){"use strict";function g(a,b,c,d,e){while(!0){var f=c,g=b;if(f>=d)return f;var h=a[f];if(!e(h,g))return f;c=f+1|0;b=h;continue}}function h(a,b){var c=a.length;if(c===0||c===1)return c;var d=a[0],e=a[1];if(b(d,e)){var f=e,h=2;while(!0){var i=h,j=f;if(i>=c)return i;var k=a[i];if(!b(j,k))return i;h=i+1|0;f=k;continue}}else if(b(e,d))return-g(a,e,2,c,b)|0;else return 1}function a(a,c){return h(a,b("bs_curry").__2(c))}function i(a,b){var c=a.length;if(c===0)return!0;else{var d=0;c=c-1|0;while(!0){var e=d;if(e===c)return!0;if(b(a[e],a[e+1|0])>0)return!1;d=e+1|0;continue}}}function c(a,c){return i(a,b("bs_curry").__2(c))}function j(a,c,d,e,f,g,h,i,j){d=c+d|0;g=f+g|0;var k=c;c=a[c];var l=f;f=e[f];i=i;while(!0){var m=i,n=f,o=l,p=c,q=k;if(j(p,n)<=0){h[m]=p;p=q+1|0;if(p>=d)return b("bs_belt_Array").blitUnsafe(e,o,h,m+1|0,g-o|0);i=m+1|0;c=a[p];k=p;continue}h[m]=n;p=o+1|0;if(p>=g)return b("bs_belt_Array").blitUnsafe(a,q,h,m+1|0,d-q|0);i=m+1|0;f=e[p];l=p;continue}}function k(a,c,d,e,f,g,h,i,j){d=c+d|0;g=f+g|0;var k=c;c=a[c];var l=f;f=e[f];i=i;while(!0){var m=i,n=f,o=l,p=c,q=k,r=j(p,n);if(r<0){h[m]=p;var s=q+1|0,t=m+1|0;if(s<d){i=t;c=a[s];k=s;continue}b("bs_belt_Array").blitUnsafe(e,o,h,t,g-o|0);return(t+g|0)-o|0}if(r===0){h[m]=p;s=q+1|0;t=o+1|0;r=m+1|0;if(!(s<d&&t<g))if(s===d){b("bs_belt_Array").blitUnsafe(e,t,h,r,g-t|0);return(r+g|0)-t|0}else{b("bs_belt_Array").blitUnsafe(a,s,h,r,d-s|0);return(r+d|0)-s|0}i=r;f=e[t];l=t;c=a[s];k=s;continue}h[m]=n;p=o+1|0;r=m+1|0;if(p<g){i=r;f=e[p];l=p;continue}b("bs_belt_Array").blitUnsafe(a,q,h,r,d-q|0);return(r+d|0)-q|0}}function d(a,c,d,e,f,g,h,i,j){return k(a,c,d,e,f,g,h,i,b("bs_curry").__2(j))}function l(a,b,c,d,e,f,g,h,i){c=b+c|0;f=e+f|0;var j=b;b=a[b];var k=e;e=d[e];h=h;while(!0){var l=h,m=e,n=k,o=b,p=j;m=i(o,m);if(m<0){var q=p+1|0;if(q>=c)return l;b=a[q];j=q;continue}if(m===0){g[l]=o;q=p+1|0;m=n+1|0;o=l+1|0;if(!(q<c&&m<f))return o;h=o;e=d[m];k=m;b=a[q];j=q;continue}p=n+1|0;if(p>=f)return l;e=d[p];k=p;continue}}function e(a,c,d,e,f,g,h,i,j){return l(a,c,d,e,f,g,h,i,b("bs_curry").__2(j))}function m(a,c,d,e,f,g,h,i,j){d=c+d|0;g=f+g|0;var k=c;c=a[c];var l=f;f=e[f];i=i;while(!0){var m=i,n=f,o=l,p=c,q=k;n=j(p,n);if(n<0){h[m]=p;p=m+1|0;var r=q+1|0;if(r>=d)return p;i=p;c=a[r];k=r;continue}if(n===0){p=q+1|0;r=o+1|0;if(!(p<d&&r<g))if(p===d)return m;else{b("bs_belt_Array").blitUnsafe(a,p,h,m,d-p|0);return(m+d|0)-p|0}f=e[r];l=r;c=a[p];k=p;continue}n=o+1|0;if(n<g){f=e[n];l=n;continue}b("bs_belt_Array").blitUnsafe(a,q,h,m,d-q|0);return(m+d|0)-q|0}}function n(a,c,d,e,f,g,h,i,j){return m(a,c,d,e,f,g,h,i,b("bs_curry").__2(j))}function o(a,b,c,d,e,f){for(var g=0;g<e;++g){var h=a[b+g|0],i=(d+g|0)-1|0;while(i>=d&&f(c[i],h)>0)c[i+1|0]=c[i],i=i-1|0;c[i+1|0]=h}}function p(a,b,c,d,e,f){if(e<=5)return o(a,b,c,d,e,f);var g=e/2|0;e=e-g|0;p(a,b+g|0,c,d+g|0,e,f);p(a,b,a,b+e|0,g,f);return j(a,b+e|0,g,c,d+g|0,e,c,d,f)}function q(a,b){var c=a.length;if(c<=5)return o(a,0,a,0,c,b);var d=c/2|0;c=c-d|0;var e=new Array(c);p(a,d,e,0,c,b);p(a,0,a,c,d,b);return j(a,c,d,e,0,c,a,0,b)}function r(a,c){return q(a,b("bs_curry").__2(c))}function s(a,b){a=a.slice(0);q(a,b);return a}function t(a,c){return s(a,b("bs_curry").__2(c))}function u(a,b,c){var d=a.length;if(d===0)return-1;var e=a[0];e=c(b,e);if(e<0)return-1;e=a[d-1|0];e=c(b,e);if(e>0)return-(d+1|0)|0;else{e=0;d=d-1|0;while(!0){var f=d,g=e,h=(g+f|0)/2|0,i=a[h];i=c(b,i);if(i===0)return h;if(i<0){if(f===h)if(c(a[g],b)===0)return g;else return-(f+1|0)|0;d=h;continue}if(g===h)if(c(a[f],b)===0)return f;else return-(f+1|0)|0;e=h;continue}}}function v(a,c,d){return u(a,c,b("bs_curry").__2(d))}var w,x;f.Int=w;f.$$String=x;f.strictlySortedLengthU=h;f.strictlySortedLength=a;f.isSortedU=i;f.isSorted=c;f.stableSortInPlaceByU=q;f.stableSortInPlaceBy=r;f.stableSortByU=s;f.stableSortBy=t;f.binarySearchByU=u;f.binarySearchBy=v;f.unionU=k;f.union=d;f.intersectU=l;f.intersect=e;f.diffU=m;f.diff=n}),null);
__d("bs_belt_internalAVLtree",["bs_belt_SortArray","bs_caml_option","bs_curry"],(function(a,b,c,d,e,f){"use strict";function g(a){if(a!==void 0)return a.h;else return 0}function h(a){if(a!==void 0)return{k:a.k,v:a.v,h:a.h,l:h(a.l),r:h(a.r)};else return a}function i(a,b,c,d){var e=g(a),f=g(d);return{k:b,v:c,h:e>=f?e+1|0:f+1|0,l:a,r:d}}function j(a,b){return{k:a,v:b,h:1,l:void 0,r:void 0}}function k(a,b){if(b!==void 0)if(a!==void 0)return a.h>=b.h;else return!1;else return!0}function a(a,b){if(a.v===b)return a;else return{k:a.k,v:b,h:a.h,l:a.l,r:a.r}}function l(a,b,c,d){var e=a!==void 0?a.h:0,f=d!==void 0?d.h:0;if(e>(f+2|0)){var h=a.l,j=a.r;if(g(h)>=g(j))return i(h,a.k,a.v,i(j,b,c,d));else return i(i(h,a.k,a.v,j.l),j.k,j.v,i(j.r,b,c,d))}if(f<=(e+2|0))return{k:b,v:c,h:e>=f?e+1|0:f+1|0,l:a,r:d};h=d.l;j=d.r;if(g(j)>=g(h))return i(i(a,b,c,h),d.k,d.v,j);else return i(i(a,b,c,h.l),h.k,h.v,i(h.r,d.k,d.v,j))}function m(a){while(!0){var b=a,c=b.l;if(c===void 0)return b.k;a=c;continue}}function c(a){if(a!==void 0)return b("bs_caml_option").some(m(a))}function d(a){if(a!==void 0)return m(a)}function n(a){while(!0){var b=a,c=b.r;if(c===void 0)return b.k;a=c;continue}}function e(a){if(a!==void 0)return b("bs_caml_option").some(n(a))}function o(a){if(a!==void 0)return n(a)}function p(a){while(!0){var b=a,c=b.l;if(c===void 0)return[b.k,b.v];a=c;continue}}function q(a){if(a!==void 0)return p(a)}function r(a){if(a!==void 0)return p(a)}function s(a){while(!0){var b=a,c=b.r;if(c===void 0)return[b.k,b.v];a=c;continue}}function t(a){if(a!==void 0)return s(a)}function aa(a){if(a!==void 0)return s(a)}function u(a,b,c){var d=a.l;if(d!==void 0)return l(u(d,b,c),a.k,a.v,a.r);else{b.contents=a.k;c.contents=a.v;return a.r}}function ba(a){return a===void 0}function v(a,b){while(!0){var c=b,d=a;if(d===void 0)return c;b={hd:d,tl:c};a=d.l;continue}}function w(a,b){if(a===void 0)return;var c=w(a.l,b);if(c!==void 0)return c;c=a.k;var d=a.v,e=b(c,d);if(e)return[c,d];e=w(a.r,b);if(e!==void 0)return e}function ca(a,c){return w(a,b("bs_curry").__2(c))}function x(a,b){while(!0){var c=a;if(c===void 0)return;x(c.l,b);b(c.k,c.v);a=c.r;continue}}function da(a,c){return x(a,b("bs_curry").__2(c))}function y(a,b){if(a===void 0)return;var c=y(a.l,b),d=b(a.v);b=y(a.r,b);return{k:a.k,v:d,h:a.h,l:c,r:b}}function ea(a,c){return y(a,b("bs_curry").__1(c))}function z(a,b){if(a===void 0)return;var c=a.k,d=z(a.l,b),e=b(c,a.v);b=z(a.r,b);return{k:c,v:e,h:a.h,l:d,r:b}}function fa(a,c){return z(a,b("bs_curry").__2(c))}function A(a,b,c){while(!0){var d=b,e=a;if(e===void 0)return d;var f=e.k,g=e.v,h=e.l;e=e.r;b=c(A(h,d,c),f,g);a=e;continue}}function ga(a,c,d){return A(a,c,b("bs_curry").__3(d))}function B(a,b){while(!0){var c=a;if(c===void 0)return!0;if(!b(c.k,c.v))return!1;if(!B(c.l,b))return!1;a=c.r;continue}}function ha(a,c){return B(a,b("bs_curry").__2(c))}function C(a,b){while(!0){var c=a;if(c===void 0)return!1;if(b(c.k,c.v))return!0;if(C(c.l,b))return!0;a=c.r;continue}}function ia(a,c){return C(a,b("bs_curry").__2(c))}function D(a,b,c){if(a!==void 0)return l(D(a.l,b,c),a.k,a.v,a.r);else return j(b,c)}function E(a,b,c){if(a!==void 0)return l(a.l,a.k,a.v,E(a.r,b,c));else return j(b,c)}function F(a,b,c,d){if(a===void 0)return D(d,b,c);if(d===void 0)return E(a,b,c);var e=a.k,f=a.v,g=a.h,h=a.l,j=a.r,k=d.k,m=d.v,n=d.h,o=d.l,p=d.r;if(g>(n+2|0))return l(h,e,f,F(j,b,c,d));else if(n>(g+2|0))return l(F(a,b,c,o),k,m,p);else return i(a,b,c,d)}function G(a,b){if(a===void 0)return b;if(b===void 0)return a;var c={contents:b.k},d={contents:b.v};b=u(b,c,d);return F(a,c.contents,d.contents,b)}function ja(a,c,d,e){if(d!==void 0)return F(a,c,b("bs_caml_option").valFromOption(d),e);else return G(a,e)}function H(a,b){if(a===void 0)return;var c=a.k,d=a.v,e=H(a.l,b),f=b(c,d);a=H(a.r,b);if(f)return F(e,c,d,a);else return G(e,a)}function ka(a,c){return H(a,b("bs_curry").__2(c))}function I(a,c){if(a===void 0)return;var d=a.k,e=a.v,f=I(a.l,c);e=c(d,e);a=I(a.r,c);if(e!==void 0)return F(f,d,b("bs_caml_option").valFromOption(e),a);else return G(f,a)}function la(a,c){return I(a,b("bs_curry").__2(c))}function J(a,b){if(a===void 0)return[void 0,void 0];var c=a.k,d=a.v,e=J(a.l,b),f=e[1];e=e[0];var g=b(c,d);a=J(a.r,b);b=a[1];a=a[0];if(g)return[F(e,c,d,a),G(f,b)];else return[G(e,a),F(f,c,d,b)]}function ma(a,c){return J(a,b("bs_curry").__2(c))}function K(a){var b=a.l;a=a.r;b=b!==void 0?K(b):0;a=a!==void 0?K(a):0;return(1+b|0)+a|0}function L(a){if(a!==void 0)return K(a);else return 0}function M(a,b){while(!0){var c=b,d=a;if(d===void 0)return c;var e=d.k,f=d.v,g=d.l;d=d.r;b={hd:[e,f],tl:M(d,c)};a=g;continue}}function na(a){return M(a,0)}function N(a){while(!0){var b=a;if(b===void 0)return;var c=b.l;b=b.r;var d=g(c)-g(b)|0;if(!(d<=2&&d>=-2))throw{RE_EXN_ID:"Assert_failure",_1:["belt_internalAVLtree.ml",373,4],Error:new Error()};N(c);a=b;continue}}function O(a,b,c){while(!0){var d=b,e=a,f=e.k,g=e.l;e=e.r;g=g!==void 0?O(g,d,c):d;c[g]=f;d=g+1|0;if(e===void 0)return d;b=d;a=e;continue}}function P(a,b,c){while(!0){var d=b,e=a,f=e.l,g=e.r;f=f!==void 0?P(f,d,c):d;c[f]=e.v;d=f+1|0;if(g===void 0)return d;b=d;a=g;continue}}function Q(a,b,c){while(!0){var d=b,e=a,f=e.l,g=e.k,h=e.r;f=f!==void 0?Q(f,d,c):d;c[f]=[g,e.v];d=f+1|0;if(h===void 0)return d;b=d;a=h;continue}}function oa(b){if(b===void 0)return[];var a=K(b);a=new Array(a);Q(b,0,a);return a}function pa(b){if(b===void 0)return[];var a=K(b);a=new Array(a);O(b,0,a);return a}function qa(b){if(b===void 0)return[];var a=K(b);a=new Array(a);P(b,0,a);return a}function R(a,b,c){switch(c){case 0:return;case 1:var d=a[b];return j(d[0],d[1]);case 2:d=a[b];var e=a[b-1|0];e=e;d=d;return{k:e[0],v:e[1],h:2,l:j(d[0],d[1]),r:void 0};case 3:e=a[b];d=a[b-1|0];var f=a[b-2|0];f=f;d=d;e=e;return{k:d[0],v:d[1],h:2,l:j(e[0],e[1]),r:j(f[0],f[1])};default:d=c/2|0;e=R(a,b,d);f=a[b-d|0];a=R(a,(b-d|0)-1|0,(c-d|0)-1|0);return i(e,f[0],f[1],a)}}function S(a,b,c){switch(c){case 0:return;case 1:var d=a[b];return j(d[0],d[1]);case 2:d=a[b];var e=a[b+1|0];e=e;d=d;return{k:e[0],v:e[1],h:2,l:j(d[0],d[1]),r:void 0};case 3:e=a[b];d=a[b+1|0];var f=a[b+2|0];f=f;d=d;e=e;return{k:d[0],v:d[1],h:2,l:j(e[0],e[1]),r:j(f[0],f[1])};default:d=c/2|0;e=S(a,b,d);f=a[b+d|0];a=S(a,(b+d|0)+1|0,(c-d|0)-1|0);return i(e,f[0],f[1],a)}}function ra(a){return S(a,0,a.length)}function T(a,b,c,d){var e=L(a),f=L(b);if(e===f){a=v(a,0);b=v(b,0);while(!0){var g=b,h=a;if(!h)return 0;if(!g)return 0;var i=g.hd,j=h.hd,k=c(j.k,i.k);if(k!==0)return k;k=d(j.v,i.v);if(k!==0)return k;b=v(i.r,g.tl);a=v(j.r,h.tl);continue}}else if(e<f)return-1;else return 1}function sa(a,c,d,e){return T(a,c,d,b("bs_curry").__2(e))}function U(a,b,c,d){var e=L(a),f=L(b);if(e===f){e=v(a,0);f=v(b,0);while(!0){a=f;b=e;if(!b)return!0;if(!a)return!0;var g=a.hd,h=b.hd;if(!(c(h.k,g.k)===0&&d(h.v,g.v)))return!1;f=v(g.r,a.tl);e=v(h.r,b.tl);continue}}else return!1}function ta(a,c,d,e){return U(a,c,d,b("bs_curry").__2(e))}function ua(c,d,a){while(!0){var e=c;if(e===void 0)return;var f=e.k;f=a(d,f);if(f===0)return b("bs_caml_option").some(e.v);c=f<0?e.l:e.r;continue}}function va(b,c,a){while(!0){var d=b;if(d===void 0)return;var e=d.k;e=a(c,e);if(e===0)return d.v;b=e<0?d.l:d.r;continue}}function wa(b,c,a){while(!0){var d=b;if(d!==void 0){var e=d.k;e=a(c,e);if(e===0)return d.v;b=e<0?d.l:d.r;continue}throw{RE_EXN_ID:"Not_found",Error:new Error()}}}function xa(b,c,d,a){while(!0){var e=b;if(e===void 0)return d;var f=e.k;f=a(c,f);if(f===0)return e.v;b=f<0?e.l:e.r;continue}}function ya(b,c,a){while(!0){var d=b;if(d===void 0)return!1;var e=d.k;e=a(c,e);if(e===0)return!0;b=e<0?d.l:d.r;continue}}function V(a){var b=a.l;a.l=b.r;b.r=a;var c=g(a.l),d=g(a.r);a.h=(c>d?c:d)+1|0;c=g(b.l);d=a.h;b.h=(c>d?c:d)+1|0;return b}function W(a){var b=a.r;a.r=b.l;b.l=a;var c=g(a.l),d=g(a.r);a.h=(c>d?c:d)+1|0;c=g(b.r);d=a.h;b.h=(c>d?c:d)+1|0;return b}function za(a){var b=a.l;b=W(b);a.l=b;return V(a)}function Aa(a){var b=a.r;b=V(b);a.r=b;return W(a)}function X(a){var b=g(a.l),c=g(a.r);a.h=(b>c?b:c)+1|0;return a}function Y(a){var b=a.l,c=a.r,d=g(b),e=g(c);if(d>(2+e|0)){var f=b.l;b=b.r;if(k(f,b))return X(V(a));else return X(za(a))}if(e>(2+d|0)){f=c.l;b=c.r;if(k(b,f))return X(W(a));else return X(Aa(a))}a.h=(d>e?d:e)+1|0;return a}function Z(b,c,d,a){if(b===void 0)return j(c,d);var e=b.k;e=a(c,e);if(e===0){b.v=d;return b}var f=b.l,g=b.r;if(e<0){e=Z(f,c,d,a);b.l=e}else b.r=Z(g,c,d,a);return Y(b)}function Ba(c,a){var d=c.length;if(d===0)return;var e=b("bs_belt_SortArray").strictlySortedLengthU(c,function(b,c){return a(b[0],c[0])<0}),f;e>=0?f=S(c,0,e):(e=-e|0,f=R(c,e-1|0,e));for(var e=e;e<d;++e){var g=c[e];f=Z(f,g[0],g[1],a)}return f}function $(a,b){var c=b.r,d=b.l;if(d!==void 0){b.l=$(a,d);return Y(b)}else{a.k=b.k;a.v=b.v;return c}}f.copy=h;f.create=i;f.bal=l;f.singleton=j;f.updateValue=a;f.minKey=c;f.minKeyUndefined=d;f.maxKey=e;f.maxKeyUndefined=o;f.minimum=q;f.minUndefined=r;f.maximum=t;f.maxUndefined=aa;f.removeMinAuxWithRef=u;f.isEmpty=ba;f.stackAllLeft=v;f.findFirstByU=w;f.findFirstBy=ca;f.forEachU=x;f.forEach=da;f.mapU=y;f.map=ea;f.mapWithKeyU=z;f.mapWithKey=fa;f.reduceU=A;f.reduce=ga;f.everyU=B;f.every=ha;f.someU=C;f.some=ia;f.join=F;f.concat=G;f.concatOrJoin=ja;f.keepSharedU=H;f.keepShared=ka;f.keepMapU=I;f.keepMap=la;f.partitionSharedU=J;f.partitionShared=ma;f.lengthNode=K;f.size=L;f.toList=na;f.checkInvariantInternal=N;f.fillArray=Q;f.toArray=oa;f.keysToArray=pa;f.valuesToArray=qa;f.fromSortedArrayAux=S;f.fromSortedArrayRevAux=R;f.fromSortedArrayUnsafe=ra;f.cmpU=T;f.cmp=sa;f.eqU=U;f.eq=ta;f.get=ua;f.getUndefined=va;f.getWithDefault=xa;f.getExn=wa;f.has=ya;f.fromArray=Ba;f.updateMutate=Z;f.balMutate=Y;f.removeMinAuxWithRootMutate=$}),null);
__d("bs_belt_MapDict",["bs_belt_internalAVLtree","bs_caml_option","bs_curry"],(function(a,b,c,d,e,f){"use strict";var g;function h(c,d,e,a){if(c===void 0)return b("bs_belt_internalAVLtree").singleton(d,e);var f=c.k,g=a(d,f);if(g===0)return b("bs_belt_internalAVLtree").updateValue(c,e);var i=c.l,j=c.r;c=c.v;if(g<0)return b("bs_belt_internalAVLtree").bal(h(i,d,e,a),f,c,j);else return b("bs_belt_internalAVLtree").bal(i,f,c,h(j,d,e,a))}function i(c,d,e,a){if(c!==void 0){var f=c.k,g=a(d,f);if(g===0){var h=e(b("bs_caml_option").some(c.v));if(h!==void 0)return b("bs_belt_internalAVLtree").updateValue(c,b("bs_caml_option").valFromOption(h));h=c.l;var j=c.r;if(h===void 0)return j;if(j===void 0)return h;var k={contents:j.k},l={contents:j.v};j=b("bs_belt_internalAVLtree").removeMinAuxWithRef(j,k,l);return b("bs_belt_internalAVLtree").bal(h,k.contents,l.contents,j)}h=c.l;k=c.r;l=c.v;if(g<0){j=i(h,d,e,a);if(h===j)return c;else return b("bs_belt_internalAVLtree").bal(j,f,l,k)}g=i(k,d,e,a);if(k===g)return c;else return b("bs_belt_internalAVLtree").bal(h,f,l,g)}j=e(void 0);if(j!==void 0)return b("bs_belt_internalAVLtree").singleton(d,b("bs_caml_option").valFromOption(j));else return c}function a(c,d,e,a){return i(c,d,b("bs_curry").__1(e),a)}function j(c,d,a){var e=c.k,f=c.l,g=c.r,h=a(d,e);if(h===0){if(f===void 0)return g;if(g===void 0)return f;var i={contents:g.k},k={contents:g.v},l=b("bs_belt_internalAVLtree").removeMinAuxWithRef(g,i,k);return b("bs_belt_internalAVLtree").bal(f,i.contents,k.contents,l)}if(h<0){if(f===void 0)return c;i=j(f,d,a);if(i===f)return c;else return b("bs_belt_internalAVLtree").bal(i,e,c.v,g)}if(g===void 0)return c;k=j(g,d,a);if(k===g)return c;else return b("bs_belt_internalAVLtree").bal(f,e,c.v,k)}function c(b,c,a){if(b!==void 0)return j(b,c,a)}function d(b,c,a){var d=c.length;b=b;for(var e=0;e<d;++e){var f=c[e];b=h(b,f[0],f[1],a)}return b}function k(c,d,e,a){var f=c.k,g=c.v,h=c.l,i=c.r,j=a(d,f);if(j===0){e.contents=b("bs_caml_option").some(g);return[h,i]}if(j<0){if(h===void 0)return[void 0,c];j=k(h,d,e,a);return[j[0],b("bs_belt_internalAVLtree").join(j[1],f,g,i)]}if(i===void 0)return[c,void 0];j=k(i,d,e,a);return[b("bs_belt_internalAVLtree").join(h,f,g,j[0]),j[1]]}function e(b,c,a){if(b===void 0)return[[void 0,void 0],void 0];var d={contents:void 0};b=k(b,c,d,a);return[b,d.contents]}function l(c,d,e,a){if(c===void 0)if(d!==void 0)return b("bs_belt_internalAVLtree").keepMapU(d,function(a,c){return e(a,void 0,b("bs_caml_option").some(c))});else return;if(d===void 0)return b("bs_belt_internalAVLtree").keepMapU(c,function(a,c){return e(a,b("bs_caml_option").some(c),void 0)});if(c.h>=d.h){var f=c.k,g=c.v,h=c.l,i=c.r,j={contents:void 0},m=k(d,f,j,a);j=j.contents;h=l(h,m[0],e,a);g=e(f,b("bs_caml_option").some(g),j);j=l(i,m[1],e,a);return b("bs_belt_internalAVLtree").concatOrJoin(h,f,g,j)}i=d.k;m=d.v;h=d.l;f=d.r;g={contents:void 0};j=k(c,i,g,a);d=g.contents;c=l(j[0],h,e,a);g=e(i,d,b("bs_caml_option").some(m));h=l(j[1],f,e,a);return b("bs_belt_internalAVLtree").concatOrJoin(c,i,g,h)}function m(c,d,e,a){return l(c,d,b("bs_curry").__3(e),a)}function n(b,c,a){var d=c.length;if(b!==void 0){b=b;var e=0;while(!0){var f=e,g=b;if(f>=d)return g;var h=c[f];g=j(g,h,a);if(g===void 0)return g;e=f+1|0;b=g;continue}}}var o,p=(g=b("bs_belt_internalAVLtree")).isEmpty,q=g.has,r=g.cmpU,s=g.cmp,t=g.eqU,u=g.eq,v=g.findFirstByU,w=g.findFirstBy,x=g.forEachU,y=g.forEach,z=g.reduceU,A=g.reduce,B=g.everyU,C=g.every,D=g.someU,E=g.some,F=g.size,G=g.toList,H=g.toArray,I=g.fromArray,J=g.keysToArray,K=g.valuesToArray,L=g.minKey,M=g.minKeyUndefined,N=g.maxKey,O=g.maxKeyUndefined,P=g.minimum,Q=g.minUndefined,R=g.maximum,S=g.maxUndefined,T=g.get,U=g.getUndefined,V=g.getWithDefault,W=g.getExn,X=g.checkInvariantInternal,Y=g.keepSharedU,Z=g.keepShared,$=g.partitionSharedU,aa=g.partitionShared,ba=g.mapU,ca=g.map,da=g.mapWithKeyU;g=g.mapWithKey;f.empty=o;f.isEmpty=p;f.has=q;f.cmpU=r;f.cmp=s;f.eqU=t;f.eq=u;f.findFirstByU=v;f.findFirstBy=w;f.forEachU=x;f.forEach=y;f.reduceU=z;f.reduce=A;f.everyU=B;f.every=C;f.someU=D;f.some=E;f.size=F;f.toList=G;f.toArray=H;f.fromArray=I;f.keysToArray=J;f.valuesToArray=K;f.minKey=L;f.minKeyUndefined=M;f.maxKey=N;f.maxKeyUndefined=O;f.minimum=P;f.minUndefined=Q;f.maximum=R;f.maxUndefined=S;f.get=T;f.getUndefined=U;f.getWithDefault=V;f.getExn=W;f.checkInvariantInternal=X;f.remove=c;f.removeMany=n;f.set=h;f.updateU=i;f.update=a;f.mergeU=l;f.merge=m;f.mergeMany=d;f.keepU=Y;f.keep=Z;f.partitionU=$;f.partition=aa;f.split=e;f.mapU=ba;f.map=ca;f.mapWithKeyU=da;f.mapWithKey=g}),null);
__d("bs_belt_Map",["bs_belt_MapDict","bs_curry"],(function(a,b,c,d,e,f){"use strict";function a(a,c){c=c.cmp;return{cmp:c,data:b("bs_belt_MapDict").fromArray(a,c)}}function c(c,d){var e=c.data,a=c.cmp;d=b("bs_belt_MapDict").remove(e,d,a);if(d===e)return c;else return{cmp:a,data:d}}function d(c,d){var a=c.cmp;c=b("bs_belt_MapDict").removeMany(c.data,d,a);return{cmp:a,data:c}}function e(c,d,e){var a=c.cmp;return{cmp:a,data:b("bs_belt_MapDict").set(c.data,d,e,a)}}function g(c,d){var a=c.cmp;return{cmp:a,data:b("bs_belt_MapDict").mergeMany(c.data,d,a)}}function h(c,d,e){var a=c.cmp;return{cmp:a,data:b("bs_belt_MapDict").updateU(c.data,d,e,a)}}function i(a,c,d){return h(a,c,b("bs_curry").__1(d))}function j(c,d){var a=c.cmp;c=b("bs_belt_MapDict").split(c.data,d,a);d=c[0];return[[{cmp:a,data:d[0]},{cmp:a,data:d[1]}],c[1]]}function k(c,d,e){var a=c.cmp;return{cmp:a,data:b("bs_belt_MapDict").mergeU(c.data,d.data,e,a)}}function l(a,c,d){return k(a,c,b("bs_curry").__3(d))}function m(a){return{cmp:a.cmp,data:void 0}}function n(a){return b("bs_belt_MapDict").isEmpty(a.data)}function o(a,c){return b("bs_belt_MapDict").findFirstByU(a.data,c)}function p(a,c){return b("bs_belt_MapDict").findFirstByU(a.data,b("bs_curry").__2(c))}function q(a,c){return b("bs_belt_MapDict").forEachU(a.data,c)}function r(a,c){return b("bs_belt_MapDict").forEachU(a.data,b("bs_curry").__2(c))}function s(a,c,d){return b("bs_belt_MapDict").reduceU(a.data,c,d)}function t(a,c,d){return s(a,c,b("bs_curry").__3(d))}function u(a,c){return b("bs_belt_MapDict").everyU(a.data,c)}function v(a,c){return b("bs_belt_MapDict").everyU(a.data,b("bs_curry").__2(c))}function w(a,c){return b("bs_belt_MapDict").someU(a.data,c)}function x(a,c){return b("bs_belt_MapDict").someU(a.data,b("bs_curry").__2(c))}function y(a,c){return{cmp:a.cmp,data:b("bs_belt_MapDict").keepU(a.data,c)}}function z(a,c){return y(a,b("bs_curry").__2(c))}function A(c,d){var a=c.cmp;c=b("bs_belt_MapDict").partitionU(c.data,d);return[{cmp:a,data:c[0]},{cmp:a,data:c[1]}]}function B(a,c){return A(a,b("bs_curry").__2(c))}function C(a,c){return{cmp:a.cmp,data:b("bs_belt_MapDict").mapU(a.data,c)}}function D(a,c){return C(a,b("bs_curry").__1(c))}function E(a,c){return{cmp:a.cmp,data:b("bs_belt_MapDict").mapWithKeyU(a.data,c)}}function F(a,c){return E(a,b("bs_curry").__2(c))}function G(a){return b("bs_belt_MapDict").size(a.data)}function H(a){return b("bs_belt_MapDict").toList(a.data)}function I(a){return b("bs_belt_MapDict").toArray(a.data)}function J(a){return b("bs_belt_MapDict").keysToArray(a.data)}function K(a){return b("bs_belt_MapDict").valuesToArray(a.data)}function L(a){return b("bs_belt_MapDict").minKey(a.data)}function M(a){return b("bs_belt_MapDict").minKeyUndefined(a.data)}function N(a){return b("bs_belt_MapDict").maxKey(a.data)}function O(a){return b("bs_belt_MapDict").maxKeyUndefined(a.data)}function P(a){return b("bs_belt_MapDict").minimum(a.data)}function Q(a){return b("bs_belt_MapDict").minUndefined(a.data)}function R(a){return b("bs_belt_MapDict").maximum(a.data)}function S(a){return b("bs_belt_MapDict").maxUndefined(a.data)}function T(a,c){return b("bs_belt_MapDict").get(a.data,c,a.cmp)}function U(a,c){return b("bs_belt_MapDict").getUndefined(a.data,c,a.cmp)}function V(a,c,d){return b("bs_belt_MapDict").getWithDefault(a.data,c,d,a.cmp)}function W(a,c){return b("bs_belt_MapDict").getExn(a.data,c,a.cmp)}function X(a,c){return b("bs_belt_MapDict").has(a.data,c,a.cmp)}function Y(a){return b("bs_belt_MapDict").checkInvariantInternal(a.data)}function Z(a,c,d){return b("bs_belt_MapDict").eqU(a.data,c.data,a.cmp,d)}function aa(a,c,d){return Z(a,c,b("bs_curry").__2(d))}function $(a,c,d){return b("bs_belt_MapDict").cmpU(a.data,c.data,a.cmp,d)}function ba(a,c,d){return $(a,c,b("bs_curry").__2(d))}function ca(a){return a.data}function da(a){a=a.cmp;return{cmp:a}}function ea(a,b){return{cmp:a.cmp,data:b}}var fa,ga,ha;f.Int=fa;f.$$String=ga;f.Dict=ha;f.make=m;f.isEmpty=n;f.has=X;f.cmpU=$;f.cmp=ba;f.eqU=Z;f.eq=aa;f.findFirstByU=o;f.findFirstBy=p;f.forEachU=q;f.forEach=r;f.reduceU=s;f.reduce=t;f.everyU=u;f.every=v;f.someU=w;f.some=x;f.size=G;f.toArray=I;f.toList=H;f.fromArray=a;f.keysToArray=J;f.valuesToArray=K;f.minKey=L;f.minKeyUndefined=M;f.maxKey=N;f.maxKeyUndefined=O;f.minimum=P;f.minUndefined=Q;f.maximum=R;f.maxUndefined=S;f.get=T;f.getUndefined=U;f.getWithDefault=V;f.getExn=W;f.remove=c;f.removeMany=d;f.set=e;f.updateU=h;f.update=i;f.mergeMany=g;f.mergeU=k;f.merge=l;f.keepU=y;f.keep=z;f.partitionU=A;f.partition=B;f.split=j;f.mapU=C;f.map=D;f.mapWithKeyU=E;f.mapWithKey=F;f.getData=ca;f.getId=da;f.packIdData=ea;f.checkInvariantInternal=Y}),null);
__d("bs_belt_internalMapString",["bs_belt_SortArray","bs_belt_internalAVLtree","bs_caml","bs_caml_option","bs_curry"],(function(a,b,c,d,e,f){"use strict";function g(a,c,d){if(a===void 0)return b("bs_belt_internalAVLtree").singleton(c,d);var e=a.k;if(c===e)return b("bs_belt_internalAVLtree").updateValue(a,d);var f=a.v;if(c<e)return b("bs_belt_internalAVLtree").bal(g(a.l,c,d),e,f,a.r);else return b("bs_belt_internalAVLtree").bal(a.l,e,f,g(a.r,c,d))}function a(a,c){while(!0){var d=a;if(d===void 0)return;var e=d.k;if(c===e)return b("bs_caml_option").some(d.v);a=c<e?d.l:d.r;continue}}function c(a,b){while(!0){var c=a;if(c===void 0)return;var d=c.k;if(b===d)return c.v;a=b<d?c.l:c.r;continue}}function d(a,b){while(!0){var c=a;if(c!==void 0){var d=c.k;if(b===d)return c.v;a=b<d?c.l:c.r;continue}throw{RE_EXN_ID:"Not_found",Error:new Error()}}}function e(a,b,c){while(!0){var d=a;if(d===void 0)return c;var e=d.k;if(b===e)return d.v;a=b<e?d.l:d.r;continue}}function h(a,b){while(!0){var c=a;if(c===void 0)return!1;var d=c.k;if(b===d)return!0;a=b<d?c.l:c.r;continue}}function i(a,c){if(a===void 0)return a;var d=a.k,e=a.l,f=a.r;if(c!==d)if(c<d)return b("bs_belt_internalAVLtree").bal(i(e,c),d,a.v,f);else return b("bs_belt_internalAVLtree").bal(e,d,a.v,i(f,c));if(e===void 0)return f;if(f===void 0)return e;d={contents:f.k};a={contents:f.v};c=b("bs_belt_internalAVLtree").removeMinAuxWithRef(f,d,a);return b("bs_belt_internalAVLtree").bal(e,d.contents,a.contents,c)}function j(a,c){var d=c.k,e=c.v,f=c.l,g=c.r;if(a===d)return[f,b("bs_caml_option").some(e),g];if(a<d){if(f===void 0)return[void 0,void 0,c];var h=j(a,f);return[h[0],h[1],b("bs_belt_internalAVLtree").join(h[2],d,e,g)]}if(g===void 0)return[c,void 0,void 0];h=j(a,g);return[b("bs_belt_internalAVLtree").join(f,d,e,h[0]),h[1],h[2]]}function k(a,b){if(b!==void 0)return j(a,b);else return[void 0,void 0,void 0]}function l(a,c,d){if(a!==void 0){if(a.h>=(c!==void 0?c.h:0)){var e=a.k,f=a.v,g=a.l,h=a.r,i=k(e,c);return b("bs_belt_internalAVLtree").concatOrJoin(l(g,i[0],d),e,d(e,b("bs_caml_option").some(f),i[1]),l(h,i[2],d))}}else if(c===void 0)return;g=c.k;e=c.v;f=c.l;h=c.r;i=k(g,a);return b("bs_belt_internalAVLtree").concatOrJoin(l(i[0],f,d),g,d(g,i[1],b("bs_caml_option").some(e)),l(i[2],h,d))}function m(a,c,d){return l(a,c,b("bs_curry").__3(d))}function n(a,c,d){while(!0){var e=c,f=a;if(!f)return 0;if(!e)return 0;var g=e.hd,h=f.hd,i=b("bs_caml").caml_string_compare(h.k,g.k);if(i!==0)return i;i=d(h.v,g.v);if(i!==0)return i;c=b("bs_belt_internalAVLtree").stackAllLeft(g.r,e.tl);a=b("bs_belt_internalAVLtree").stackAllLeft(h.r,f.tl);continue}}function o(c,d,a){var e=b("bs_belt_internalAVLtree").size(c),f=b("bs_belt_internalAVLtree").size(d);if(e===f)return n(b("bs_belt_internalAVLtree").stackAllLeft(c,0),b("bs_belt_internalAVLtree").stackAllLeft(d,0),a);else if(e<f)return-1;else return 1}function p(a,c,d){return o(a,c,b("bs_curry").__2(d))}function q(c,d,a){while(!0){var e=d,f=c;if(!f)return!0;if(!e)return!0;var g=e.hd,h=f.hd;if(!(h.k===g.k&&a(h.v,g.v)))return!1;d=b("bs_belt_internalAVLtree").stackAllLeft(g.r,e.tl);c=b("bs_belt_internalAVLtree").stackAllLeft(h.r,f.tl);continue}}function r(c,d,a){var e=b("bs_belt_internalAVLtree").size(c),f=b("bs_belt_internalAVLtree").size(d);if(e===f)return q(b("bs_belt_internalAVLtree").stackAllLeft(c,0),b("bs_belt_internalAVLtree").stackAllLeft(d,0),a);else return!1}function s(a,c,d){return r(a,c,b("bs_curry").__2(d))}function t(a,c,d){if(a===void 0)return b("bs_belt_internalAVLtree").singleton(c,d);var e=a.k;if(c===e){a.k=c;a.v=d;return a}var f=a.l,g=a.r;if(c<e){e=t(f,c,d);a.l=e}else a.r=t(g,c,d);return b("bs_belt_internalAVLtree").balMutate(a)}function u(a){var c=a.length;if(c===0)return;var d=b("bs_belt_SortArray").strictlySortedLengthU(a,function(a,b){return a[0]<b[0]}),e;d>=0?e=b("bs_belt_internalAVLtree").fromSortedArrayAux(a,0,d):(d=-d|0,e=b("bs_belt_internalAVLtree").fromSortedArrayRevAux(a,d-1|0,d));for(var d=d;d<c;++d){var f=a[d];e=t(e,f[0],f[1])}return e}var v,w,x;f.N=v;f.A=w;f.S=x;f.add=g;f.get=a;f.getUndefined=c;f.getExn=d;f.getWithDefault=e;f.has=h;f.remove=i;f.splitAux=j;f.split=k;f.mergeU=l;f.merge=m;f.compareAux=n;f.cmpU=o;f.cmp=p;f.eqAux=q;f.eqU=r;f.eq=s;f.addMutate=t;f.fromArray=u}),null);
__d("bs_belt_MapString",["bs_belt_internalAVLtree","bs_belt_internalMapString","bs_caml_option","bs_curry"],(function(a,b,c,d,e,f){"use strict";var g,h;function i(a,c,d){if(a===void 0)return b("bs_belt_internalAVLtree").singleton(c,d);var e=a.k;if(c===e)return b("bs_belt_internalAVLtree").updateValue(a,d);var f=a.v;if(c<e)return b("bs_belt_internalAVLtree").bal(i(a.l,c,d),e,f,a.r);else return b("bs_belt_internalAVLtree").bal(a.l,e,f,i(a.r,c,d))}function j(a,c,d){if(a!==void 0){var e=a.k;if(c===e){var f=d(b("bs_caml_option").some(a.v));if(f!==void 0)return b("bs_belt_internalAVLtree").updateValue(a,b("bs_caml_option").valFromOption(f));f=a.l;var g=a.r;if(f===void 0)return g;if(g===void 0)return f;var h={contents:g.k},i={contents:g.v};g=b("bs_belt_internalAVLtree").removeMinAuxWithRef(g,h,i);return b("bs_belt_internalAVLtree").bal(f,h.contents,i.contents,g)}f=a.v;h=a.l;i=a.r;if(c<e){g=j(h,c,d);if(h===g)return a;else return b("bs_belt_internalAVLtree").bal(g,e,f,i)}g=j(i,c,d);if(i===g)return a;else return b("bs_belt_internalAVLtree").bal(h,e,f,g)}i=d(void 0);if(i!==void 0)return b("bs_belt_internalAVLtree").singleton(c,b("bs_caml_option").valFromOption(i));else return a}function a(a,c,d){return j(a,c,b("bs_curry").__1(d))}function k(a,c){var d=a.k,e=a.l,f=a.r;if(c===d){if(e===void 0)return f;if(f===void 0)return e;var g={contents:f.k},h={contents:f.v},i=b("bs_belt_internalAVLtree").removeMinAuxWithRef(f,g,h);return b("bs_belt_internalAVLtree").bal(e,g.contents,h.contents,i)}if(c<d){if(e===void 0)return a;g=k(e,c);if(g===e)return a;else return b("bs_belt_internalAVLtree").bal(g,d,a.v,f)}if(f===void 0)return a;h=k(f,c);return b("bs_belt_internalAVLtree").bal(e,d,a.v,h)}function c(a,b){if(a!==void 0)return k(a,b)}function d(a,b){var c=b.length;if(a!==void 0){a=a;var d=0;while(!0){var e=d,f=a;if(e>=c)return f;var g=b[e];f=k(f,g);if(f===void 0)return f;d=e+1|0;a=f;continue}}}function e(a,b){var c=b.length;a=a;for(var d=0;d<c;++d){var e=b[d];a=i(a,e[0],e[1])}return a}var l,m=(g=b("bs_belt_internalAVLtree")).isEmpty,n=(h=b("bs_belt_internalMapString")).has,o=h.cmpU,p=h.cmp,q=h.eqU,r=h.eq,s=g.findFirstByU,t=g.findFirstBy,u=g.forEachU,v=g.forEach,w=g.reduceU,x=g.reduce,y=g.everyU,z=g.every,A=g.someU,B=g.some,C=g.size,D=g.toList,E=g.toArray,F=h.fromArray,G=g.keysToArray,H=g.valuesToArray,I=g.minKey,J=g.minKeyUndefined,K=g.maxKey,L=g.maxKeyUndefined,M=g.minimum,N=g.minUndefined,O=g.maximum,P=g.maxUndefined,Q=h.get,R=h.getUndefined,S=h.getWithDefault,T=h.getExn,U=g.checkInvariantInternal,V=h.mergeU,W=h.merge,X=g.keepSharedU,Y=g.keepShared,Z=g.partitionSharedU,$=g.partitionShared;h=h.split;var aa=g.mapU,ba=g.map,ca=g.mapWithKeyU;g=g.mapWithKey;f.empty=l;f.isEmpty=m;f.has=n;f.cmpU=o;f.cmp=p;f.eqU=q;f.eq=r;f.findFirstByU=s;f.findFirstBy=t;f.forEachU=u;f.forEach=v;f.reduceU=w;f.reduce=x;f.everyU=y;f.every=z;f.someU=A;f.some=B;f.size=C;f.toList=D;f.toArray=E;f.fromArray=F;f.keysToArray=G;f.valuesToArray=H;f.minKey=I;f.minKeyUndefined=J;f.maxKey=K;f.maxKeyUndefined=L;f.minimum=M;f.minUndefined=N;f.maximum=O;f.maxUndefined=P;f.get=Q;f.getUndefined=R;f.getWithDefault=S;f.getExn=T;f.checkInvariantInternal=U;f.remove=c;f.removeMany=d;f.set=i;f.updateU=j;f.update=a;f.mergeU=V;f.merge=W;f.mergeMany=e;f.keepU=X;f.keep=Y;f.partitionU=Z;f.partition=$;f.split=h;f.mapU=aa;f.map=ba;f.mapWithKeyU=ca;f.mapWithKey=g}),null);
__d("bs_belt_internalAVLset",["bs_belt_SortArray","bs_caml_option","bs_curry"],(function(a,b,c,d,e,f){"use strict";function g(a){if(a!==void 0)return{v:a.v,h:a.h,l:g(a.l),r:g(a.r)};else return a}function h(a,b,c){var d=a!==void 0?a.h:0,e=c!==void 0?c.h:0;return{v:b,h:(d>=e?d:e)+1|0,l:a,r:c}}function i(a){return{v:a,h:1,l:void 0,r:void 0}}function j(a,b){if(b!==void 0)if(a!==void 0)return a.h>=b.h;else return!1;else return!0}function k(a,b,c){var d=a!==void 0?a.h:0,e=c!==void 0?c.h:0;if(d>(e+2|0)){var f=a.l,g=a.r;if(j(f,g))return h(f,a.v,h(g,b,c));else return h(h(f,a.v,g.l),g.v,h(g.r,b,c))}if(e<=(d+2|0))return{v:b,h:(d>=e?d:e)+1|0,l:a,r:c};f=c.l;g=c.r;if(j(g,f))return h(h(a,b,f),c.v,g);else return h(h(a,b,f.l),f.v,h(f.r,c.v,g))}function l(a){while(!0){var b=a,c=b.l;if(c===void 0)return b.v;a=c;continue}}function a(a){if(a!==void 0)return b("bs_caml_option").some(l(a))}function c(a){if(a!==void 0)return l(a)}function m(a){while(!0){var b=a,c=b.r;if(c===void 0)return b.v;a=c;continue}}function d(a){if(a!==void 0)return b("bs_caml_option").some(m(a))}function e(a){if(a!==void 0)return m(a)}function n(a,b){var c=a.l;if(c!==void 0)return k(n(c,b),a.v,a.r);else{b.contents=a.v;return a.r}}function o(a){return a===void 0}function p(a,b){while(!0){var c=b,d=a;if(d===void 0)return c;b={hd:d,tl:c};a=d.l;continue}}function q(a,b){while(!0){var c=a;if(c===void 0)return;q(c.l,b);b(c.v);a=c.r;continue}}function r(a,c){return q(a,b("bs_curry").__1(c))}function s(a,b,c){while(!0){var d=b,e=a;if(e===void 0)return d;b=c(s(e.l,d,c),e.v);a=e.r;continue}}function t(a,c,d){return s(a,c,b("bs_curry").__2(d))}function u(a,b){while(!0){var c=a;if(c===void 0)return!0;if(!b(c.v))return!1;if(!u(c.l,b))return!1;a=c.r;continue}}function v(a,c){return u(a,b("bs_curry").__1(c))}function w(a,b){while(!0){var c=a;if(c===void 0)return!1;if(b(c.v))return!0;if(w(c.l,b))return!0;a=c.r;continue}}function x(a,c){return w(a,b("bs_curry").__1(c))}function y(a,b){if(a!==void 0)return k(y(a.l,b),a.v,a.r);else return i(b)}function z(a,b){if(a!==void 0)return k(a.l,a.v,z(a.r,b));else return i(b)}function A(a,b,c){if(a===void 0)return y(c,b);if(c===void 0)return z(a,b);var d=a.h,e=c.h;if(d>(e+2|0))return k(a.l,a.v,A(a.r,b,c));else if(e>(d+2|0))return k(A(a,b,c.l),c.v,c.r);else return h(a,b,c)}function B(a,b){if(a===void 0)return b;if(b===void 0)return a;var c={contents:b.v};b=n(b,c);return A(a,c.contents,b)}function C(a,b){if(a===void 0)return[void 0,void 0];var c=a.v,d=C(a.l,b),e=d[1];d=d[0];var f=b(c);a=C(a.r,b);b=a[1];a=a[0];if(f)return[A(d,c,a),B(e,b)];else return[B(d,a),A(e,c,b)]}function D(a,c){return C(a,b("bs_curry").__1(c))}function E(a){var b=a.l;a=a.r;b=b!==void 0?E(b):0;a=a!==void 0?E(a):0;return(1+b|0)+a|0}function F(a){if(a!==void 0)return E(a);else return 0}function G(a,b){while(!0){var c=b,d=a;if(d===void 0)return c;b={hd:d.v,tl:G(d.r,c)};a=d.l;continue}}function H(a){return G(a,0)}function I(a){while(!0){var b=a;if(b===void 0)return;var c=b.l;b=b.r;var d=(c!==void 0?c.h:0)-(b!==void 0?b.h:0)|0;if(!(d<=2&&d>=-2))throw{RE_EXN_ID:"Assert_failure",_1:["belt_internalAVLset.ml",290,4],Error:new Error()};I(c);a=b;continue}}function J(a,b,c){while(!0){var d=b,e=a,f=e.v,g=e.l;e=e.r;g=g!==void 0?J(g,d,c):d;c[g]=f;d=g+1|0;if(e===void 0)return d;b=d;a=e;continue}}function K(a,b,c,d){while(!0){var e=a,f=e.v,g=e.l;e=e.r;g!==void 0&&K(g,b,c,d);if(d(f)){g=b.forward;c[g]=f;b.forward=g+1|0}else{g=b.backward;c[g]=f;b.backward=g-1|0}if(e===void 0)return;a=e;continue}}function L(a,b,c,d){while(!0){var e=b,f=a,g=f.v,h=f.l;f=f.r;h=h!==void 0?L(h,e,c,d):e;e=d(g)?(c[h]=g,h+1|0):h;if(f===void 0)return e;b=e;a=f;continue}}function M(b){if(b===void 0)return[];var a=E(b);a=new Array(a);J(b,0,a);return a}function N(a,b,c){switch(c){case 0:return;case 1:return i(a[b]);case 2:var d=a[b],e=a[b-1|0];return{v:e,h:2,l:i(d),r:void 0};case 3:e=a[b];d=a[b-1|0];var f=a[b-2|0];return{v:d,h:2,l:i(e),r:i(f)};default:d=c/2|0;e=N(a,b,d);f=a[b-d|0];a=N(a,(b-d|0)-1|0,(c-d|0)-1|0);return h(e,f,a)}}function O(a,b,c){switch(c){case 0:return;case 1:return i(a[b]);case 2:var d=a[b],e=a[b+1|0];return{v:e,h:2,l:i(d),r:void 0};case 3:e=a[b];d=a[b+1|0];var f=a[b+2|0];return{v:d,h:2,l:i(e),r:i(f)};default:d=c/2|0;e=O(a,b,d);f=a[b+d|0];a=O(a,(b+d|0)+1|0,(c-d|0)-1|0);return h(e,f,a)}}function P(a){return O(a,0,a.length)}function Q(a,b){if(a===void 0)return;var c=a.v,d=a.l,e=a.r,f=Q(d,b),g=b(c);b=Q(e,b);if(g)if(d===f&&e===b)return a;else return A(f,c,b);else return B(f,b)}function aa(a,c){return Q(a,b("bs_curry").__1(c))}function R(b,c){if(b===void 0)return;var a=E(b);a=new Array(a);b=L(b,0,a,c);return O(a,0,b)}function ba(a,c){return R(a,b("bs_curry").__1(c))}function S(b,c){if(b===void 0)return[void 0,void 0];var a=E(b),d=new Array(a),e=a-1|0,f={forward:0,backward:e};K(b,f,d,c);b=f.forward;return[O(d,0,b),N(d,e,a-b|0)]}function ca(a,c){return S(a,b("bs_curry").__1(c))}function da(b,c,a){while(!0){var d=b;if(d===void 0)return!1;var e=d.v;e=a(c,e);if(e===0)return!0;b=e<0?d.l:d.r;continue}}function T(a,b,c){var d=F(a),e=F(b);if(d===e){a=p(a,0);b=p(b,0);while(!0){var f=b,g=a;if(!g)return 0;if(!f)return 0;var h=f.hd,i=g.hd,j=c(i.v,h.v);if(j!==0)return j;b=p(h.r,f.tl);a=p(i.r,g.tl);continue}}else if(d<e)return-1;else return 1}function ea(a,b,c){return T(a,b,c)===0}function U(b,c,a){while(!0){var d=c,e=b;if(e===void 0)return!0;if(d===void 0)return!1;var f=e.v,g=e.l;e=e.r;var i=d.v,j=d.l;d=d.r;i=a(f,i);if(i===0){if(!U(g,j,a))return!1;c=d;b=e;continue}if(i<0){if(!U(h(g,f,void 0),j,a))return!1;b=e;continue}if(!U(h(void 0,f,e),d,a))return!1;b=g;continue}}function fa(c,d,a){while(!0){var e=c;if(e===void 0)return;var f=e.v,g=a(d,f);if(g===0)return b("bs_caml_option").some(f);c=g<0?e.l:e.r;continue}}function ga(b,c,a){while(!0){var d=b;if(d===void 0)return;var e=d.v,f=a(c,e);if(f===0)return e;b=f<0?d.l:d.r;continue}}function ha(b,c,a){while(!0){var d=b;if(d!==void 0){var e=d.v,f=a(c,e);if(f===0)return e;b=f<0?d.l:d.r;continue}throw{RE_EXN_ID:"Not_found",Error:new Error()}}}function V(a){var b=a.l;a.l=b.r;b.r=a;var c=a.l;c=c!==void 0?c.h:0;var d=a.r;d=d!==void 0?d.h:0;a.h=(c>d?c:d)+1|0;c=b.l;d=c!==void 0?c.h:0;c=a.h;b.h=(d>c?d:c)+1|0;return b}function W(a){var b=a.r;a.r=b.l;b.l=a;var c=a.l;c=c!==void 0?c.h:0;var d=a.r;d=d!==void 0?d.h:0;a.h=(c>d?c:d)+1|0;c=b.r;d=c!==void 0?c.h:0;c=a.h;b.h=(d>c?d:c)+1|0;return b}function ia(a){var b=a.l;b=W(b);a.l=b;return V(a)}function ja(a){var b=a.r;b=V(b);a.r=b;return W(a)}function X(a){var b=a.l;b=b!==void 0?b.h:0;var c=a.r;c=c!==void 0?c.h:0;a.h=(b>c?b:c)+1|0;return a}function Y(a){var b=a.l,c=a.r,d=b!==void 0?b.h:0,e=c!==void 0?c.h:0;if(d>(2+e|0)){var f=b.l;b=b.r;if(j(f,b))return X(V(a));else return X(ia(a))}if(e>(2+d|0)){f=c.l;b=c.r;if(j(b,f))return X(W(a));else return X(ja(a))}a.h=(d>e?d:e)+1|0;return a}function Z(a,b,c){if(b===void 0)return i(c);var d=b.v;d=a(c,d);if(d===0)return b;var e=b.l,f=b.r;if(d<0){d=Z(a,e,c);b.l=d}else b.r=Z(a,f,c);return Y(b)}function ka(c,a){var d=c.length;if(d===0)return;var e=b("bs_belt_SortArray").strictlySortedLengthU(c,function(b,c){return a(b,c)<0}),f;e>=0?f=O(c,0,e):(e=-e|0,f=N(c,e-1|0,e));for(var e=e;e<d;++e)f=Z(a,f,c[e]);return f}function $(a,b){var c=b.l,d=b.r;if(c!==void 0){b.l=$(a,c);return Y(b)}else{a.v=b.v;return d}}f.copy=g;f.create=h;f.bal=k;f.singleton=i;f.minimum=a;f.minUndefined=c;f.maximum=d;f.maxUndefined=e;f.removeMinAuxWithRef=n;f.isEmpty=o;f.stackAllLeft=p;f.forEachU=q;f.forEach=r;f.reduceU=s;f.reduce=t;f.everyU=u;f.every=v;f.someU=w;f.some=x;f.joinShared=A;f.concatShared=B;f.keepSharedU=Q;f.keepShared=aa;f.keepCopyU=R;f.keepCopy=ba;f.partitionSharedU=C;f.partitionShared=D;f.partitionCopyU=S;f.partitionCopy=ca;f.lengthNode=E;f.size=F;f.toList=H;f.checkInvariantInternal=I;f.fillArray=J;f.toArray=M;f.fromSortedArrayAux=O;f.fromSortedArrayRevAux=N;f.fromSortedArrayUnsafe=P;f.has=da;f.cmp=T;f.eq=ea;f.subset=U;f.get=fa;f.getUndefined=ga;f.getExn=ha;f.fromArray=ka;f.addMutate=Z;f.balMutate=Y;f.removeMinAuxWithRootMutate=$}),null);
__d("bs_belt_SetDict",["bs_belt_internalAVLset"],(function(a,b,c,d,e,f){"use strict";function g(c,d,a){if(c===void 0)return b("bs_belt_internalAVLset").singleton(d);var e=c.v,f=a(d,e);if(f===0)return c;var h=c.l,i=c.r;if(f<0){f=g(h,d,a);if(f===h)return c;else return b("bs_belt_internalAVLset").bal(f,e,i)}f=g(i,d,a);if(f===i)return c;else return b("bs_belt_internalAVLset").bal(h,e,f)}function h(c,d,a){if(c===void 0)return c;var e=c.v,f=c.l,g=c.r,i=a(d,e);if(i===0){if(f===void 0)return g;if(g===void 0)return f;var j={contents:g.v},k=b("bs_belt_internalAVLset").removeMinAuxWithRef(g,j);return b("bs_belt_internalAVLset").bal(f,j.contents,k)}if(i<0){j=h(f,d,a);if(j===f)return c;else return b("bs_belt_internalAVLset").bal(j,e,g)}k=h(g,d,a);if(k===g)return c;else return b("bs_belt_internalAVLset").bal(f,e,k)}function a(b,c,a){var d=c.length;b=b;for(var e=0;e<d;++e){var f=c[e];b=g(b,f,a)}return b}function c(b,c,a){var d=c.length;b=b;for(var e=0;e<d;++e){var f=c[e];b=h(b,f,a)}return b}function i(a,c,d){var e=c.v,f=c.l,g=c.r,h=a(d,e);if(h===0)return[f,g];if(h<0){if(f===void 0)return[void 0,c];h=i(a,f,d);return[h[0],b("bs_belt_internalAVLset").joinShared(h[1],e,g)]}if(g===void 0)return[c,void 0];h=i(a,g,d);return[b("bs_belt_internalAVLset").joinShared(f,e,h[0]),h[1]]}function j(a,c,d,e){var f=c.v,g=c.l,h=c.r,i=a(d,f);if(i===0){e.contents=!0;return[g,h]}if(i<0){if(g===void 0)return[void 0,c];i=j(a,g,d,e);return[i[0],b("bs_belt_internalAVLset").joinShared(i[1],f,h)]}if(h===void 0)return[c,void 0];i=j(a,h,d,e);return[b("bs_belt_internalAVLset").joinShared(g,f,i[0]),i[1]]}function d(b,c,a){if(b===void 0)return[[void 0,void 0],!1];var d={contents:!1};a=j(a,b,c,d);return[a,d.contents]}function k(c,d,a){if(c===void 0)return d;if(d===void 0)return c;var e=c.h,f=d.h;if(e>=f){if(f===1)return g(c,d.v,a);f=c.v;var h=c.l,j=c.r,l=i(a,d,f);return b("bs_belt_internalAVLset").joinShared(k(h,l[0],a),f,k(j,l[1],a))}if(e===1)return g(d,c.v,a);h=d.v;f=d.l;j=d.r;l=i(a,c,h);return b("bs_belt_internalAVLset").joinShared(k(l[0],f,a),h,k(l[1],j,a))}function l(c,d,a){if(c===void 0)return;if(d===void 0)return;var e=c.v,f=c.l;c=c.r;var g={contents:!1};d=j(a,d,e,g);f=l(f,d[0],a);c=l(c,d[1],a);if(g.contents)return b("bs_belt_internalAVLset").joinShared(f,e,c);else return b("bs_belt_internalAVLset").concatShared(f,c)}function m(c,d,a){if(c===void 0)return c;if(d===void 0)return c;var e=c.v,f=c.l;c=c.r;var g={contents:!1};d=j(a,d,e,g);f=m(f,d[0],a);c=m(c,d[1],a);if(g.contents)return b("bs_belt_internalAVLset").concatShared(f,c);else return b("bs_belt_internalAVLset").joinShared(f,e,c)}var n,o=(e=b("bs_belt_internalAVLset")).fromArray,p=e.fromSortedArrayUnsafe,q=e.isEmpty,r=e.has,s=e.subset,t=e.cmp,u=e.eq,v=e.forEachU,w=e.forEach,x=e.reduceU,y=e.reduce,z=e.everyU,A=e.every,B=e.someU,C=e.some,D=e.keepSharedU,E=e.keepShared,F=e.partitionSharedU,G=e.partitionShared,H=e.size,I=e.toList,J=e.toArray,K=e.minimum,L=e.minUndefined,M=e.maximum,N=e.maxUndefined,O=e.get,P=e.getUndefined,Q=e.getExn;e=e.checkInvariantInternal;f.empty=n;f.fromArray=o;f.fromSortedArrayUnsafe=p;f.isEmpty=q;f.has=r;f.add=g;f.mergeMany=a;f.remove=h;f.removeMany=c;f.union=k;f.intersect=l;f.diff=m;f.subset=s;f.cmp=t;f.eq=u;f.forEachU=v;f.forEach=w;f.reduceU=x;f.reduce=y;f.everyU=z;f.every=A;f.someU=B;f.some=C;f.keepU=D;f.keep=E;f.partitionU=F;f.partition=G;f.size=H;f.toList=I;f.toArray=J;f.minimum=K;f.minUndefined=L;f.maximum=M;f.maxUndefined=N;f.get=O;f.getUndefined=P;f.getExn=Q;f.split=d;f.checkInvariantInternal=e}),null);
__d("bs_belt_Set",["bs_belt_SetDict","bs_curry"],(function(a,b,c,d,e,f){"use strict";function a(a,c){c=c.cmp;return{cmp:c,data:b("bs_belt_SetDict").fromArray(a,c)}}function c(c,d){var e=c.data,a=c.cmp;d=b("bs_belt_SetDict").remove(e,d,a);if(d===e)return c;else return{cmp:a,data:d}}function d(c,d){var e=c.data,a=c.cmp;d=b("bs_belt_SetDict").add(e,d,a);if(d===e)return c;else return{cmp:a,data:d}}function e(c,d){var a=c.cmp;return{cmp:a,data:b("bs_belt_SetDict").mergeMany(c.data,d,a)}}function g(c,d){var a=c.cmp;return{cmp:a,data:b("bs_belt_SetDict").removeMany(c.data,d,a)}}function h(c,d){var a=c.cmp;return{cmp:a,data:b("bs_belt_SetDict").union(c.data,d.data,a)}}function i(c,d){var a=c.cmp;return{cmp:a,data:b("bs_belt_SetDict").intersect(c.data,d.data,a)}}function j(c,d){var a=c.cmp;return{cmp:a,data:b("bs_belt_SetDict").diff(c.data,d.data,a)}}function k(c,d){var a=c.cmp;return b("bs_belt_SetDict").subset(c.data,d.data,a)}function l(c,d){var a=c.cmp;c=b("bs_belt_SetDict").split(c.data,d,a);d=c[0];return[[{cmp:a,data:d[0]},{cmp:a,data:d[1]}],c[1]]}function m(a){return{cmp:a.cmp,data:void 0}}function n(a){return b("bs_belt_SetDict").isEmpty(a.data)}function o(a,c){var d=a.cmp;return b("bs_belt_SetDict").cmp(a.data,c.data,d)}function p(a,c){return b("bs_belt_SetDict").eq(a.data,c.data,a.cmp)}function q(a,c){return b("bs_belt_SetDict").forEachU(a.data,c)}function r(a,c){return b("bs_belt_SetDict").forEachU(a.data,b("bs_curry").__1(c))}function s(a,c,d){return b("bs_belt_SetDict").reduceU(a.data,c,d)}function t(a,c,d){return s(a,c,b("bs_curry").__2(d))}function u(a,c){return b("bs_belt_SetDict").everyU(a.data,c)}function v(a,c){return b("bs_belt_SetDict").everyU(a.data,b("bs_curry").__1(c))}function w(a,c){return b("bs_belt_SetDict").someU(a.data,c)}function x(a,c){return b("bs_belt_SetDict").someU(a.data,b("bs_curry").__1(c))}function y(a,c){return{cmp:a.cmp,data:b("bs_belt_SetDict").keepU(a.data,c)}}function z(a,c){return y(a,b("bs_curry").__1(c))}function A(a,c){c=b("bs_belt_SetDict").partitionU(a.data,c);a=a.cmp;return[{cmp:a,data:c[0]},{cmp:a,data:c[1]}]}function B(a,c){return A(a,b("bs_curry").__1(c))}function C(a){return b("bs_belt_SetDict").size(a.data)}function D(a){return b("bs_belt_SetDict").toList(a.data)}function E(a){return b("bs_belt_SetDict").toArray(a.data)}function F(a){return b("bs_belt_SetDict").minimum(a.data)}function G(a){return b("bs_belt_SetDict").minUndefined(a.data)}function H(a){return b("bs_belt_SetDict").maximum(a.data)}function I(a){return b("bs_belt_SetDict").maxUndefined(a.data)}function J(a,c){return b("bs_belt_SetDict").get(a.data,c,a.cmp)}function K(a,c){return b("bs_belt_SetDict").getUndefined(a.data,c,a.cmp)}function L(a,c){return b("bs_belt_SetDict").getExn(a.data,c,a.cmp)}function M(a,c){return b("bs_belt_SetDict").has(a.data,c,a.cmp)}function N(a,c){return{cmp:c.cmp,data:b("bs_belt_SetDict").fromSortedArrayUnsafe(a)}}function O(a){return a.data}function P(a){a=a.cmp;return{cmp:a}}function Q(a,b){return{cmp:a.cmp,data:b}}function R(a){return b("bs_belt_SetDict").checkInvariantInternal(a.data)}var S,T,U;f.Int=S;f.$$String=T;f.Dict=U;f.make=m;f.fromArray=a;f.fromSortedArrayUnsafe=N;f.isEmpty=n;f.has=M;f.add=d;f.mergeMany=e;f.remove=c;f.removeMany=g;f.union=h;f.intersect=i;f.diff=j;f.subset=k;f.cmp=o;f.eq=p;f.forEachU=q;f.forEach=r;f.reduceU=s;f.reduce=t;f.everyU=u;f.every=v;f.someU=w;f.some=x;f.keepU=y;f.keep=z;f.partitionU=A;f.partition=B;f.size=C;f.toArray=E;f.toList=D;f.minimum=F;f.minUndefined=G;f.maximum=H;f.maxUndefined=I;f.get=J;f.getUndefined=K;f.getExn=L;f.split=l;f.checkInvariantInternal=R;f.getData=O;f.getId=P;f.packIdData=Q}),null);
__d("MessengerState.bs",["invariant","Arbiter","AsyncRequest","ChannelConstants","ChatConfig","ChatReliabilityInstrumentation","CurrentUser","FBID.bs","FBIDCheck","FBJSON","ImmutableObject","JSSet.bs","MWChatDeleteMessageEventEmitter","MercuryActionStatus","MercuryActionType","MercuryAssert","MercuryAttachment","MercuryDispatcher","MercuryDisplayTimeFilterMessageRenderer","MercuryFilters.bs","MercuryGlobalActionType","MercuryIDs","MercuryLocalIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryMessageIDs.bs","MercuryPayloadSource","MercuryServerRequests","MercurySyncEventsProxy","MercuryThreadIDMap","MercuryThreadInfo","MercuryThreadInformer","MercuryThreadlistConstants","MercuryViewer","MessageProfileRangeType","MessageRequestUtils","MessageUnsendabilityStatus","MessagingGenericAdminTextType","MessagingTag","MessagingThreadType","MessengerDesktopNotifications","MessengerEnvironment","MessengerFolders.bs","MessengerGroupsSyncStatus","MessengerMessage.bs","MessengerPersonas.bs","MessengerSharedMediaActionsLoader","MessengerSharedPhotosVideosBaseData.bs","MessengerThreadCannotReplyReason.bs","MessengerThreadUtils.bs","MessengerWebEvent","PageCommItemStatus","ParticipantId.bs","RemoteAction.bs","RemovedMessageTombstoneContent","RepliedToMessageStatusForGraphQL","ThreadConnectivityStatus.bs","ThreadId.bs","TypingStates","URI","Utils.bs","XGroupsController","XMercuryThreadLikeIconController","bs_array","bs_belt_Array","bs_belt_Map","bs_belt_MapString","bs_belt_Option","bs_belt_Set","bs_caml","bs_caml_array","bs_caml_obj","bs_caml_option","bs_curry","bs_js_dict","bs_js_null_undefined","bs_pervasives","cr:11271","gkx","immutable","qex","react","recoverableViolation","setTimeoutAcrossTransitions","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||b("react"),k=b("MessagingTag").IRIS_MAPPING;function l(a){var c={};b("bs_belt_Map").forEach(a,function(b,a){c[b]=a});return c}function a(a){return l(a.threads)}function m(a,c){return b("bs_js_null_undefined").fromOption(b("bs_belt_Map").get(a.threads,c))}function c(a){return a.fbid}function d(a){return a.deliveryReceipts}function e(a){return a.readReceiptsPerThread}function n(a){return a.ignoredIds}function o(a){return a.blockedIds}function p(a){return a.pendingFolderUnseenCount}function aa(a){return a.typing}function q(a){return a.pendingReadStatusThreads}function r(a){return a.messages}function s(a){return a.localIDsMap}function ba(a){return a.messagesWithUploadsInFlight}function ca(a){return a.threadlistOrderMap}function t(a){return a.pinnedThreads}function da(a){return a.montage}function ea(a){return a.orderedMessageLists}function fa(a){return a.unreadCounts}function ga(a){return a.initialUnreadCounts}function ha(a){return a.unseenTimestamp}function ia(a){b("ChatReliabilityInstrumentation").logMESSAGE_RECEIVED(b("FBJSON").stringify({otid:a.offline_threading_id,message_id:a.message_id,other_user_fbid:a.other_user_fbid}))}function ja(a,c,d){d=d.reduce(b("bs_belt_Set").remove,c.reduce(b("bs_belt_Set").add,a.ignoredIds));if(d===a.ignoredIds)return a;else return{fbid:a.fbid,deliveryReceipts:a.deliveryReceipts,readReceiptsPerThread:a.readReceiptsPerThread,ignoredIds:d,blockedIds:a.blockedIds,pendingFolderUnseenCount:a.pendingFolderUnseenCount,typing:a.typing,threads:a.threads,pendingReadStatusThreads:a.pendingReadStatusThreads,messages:a.messages,localIDsMap:a.localIDsMap,messagesWithUploadsInFlight:a.messagesWithUploadsInFlight,threadlistOrderMap:a.threadlistOrderMap,pinnedThreads:a.pinnedThreads,montage:a.montage,orderedMessageLists:a.orderedMessageLists,unreadCounts:a.unreadCounts,initialUnreadCounts:a.initialUnreadCounts,unseenTimestamp:a.unseenTimestamp}}var ka=function(a,b){delete a[b];return 0};function la(a,c,d){var e=b("bs_belt_MapString").get(a,c);if(e===void 0)return a;e=b("bs_caml_option").valFromOption(e);var f=b("bs_belt_Map").get(e,d);if(f!==void 0)return b("bs_belt_MapString").set(a,c,b("bs_belt_Map").remove(e,d));else return a}function ma(a,c){var d=c.thread_fbid;if(d==null){if(!(c.type==="typ"||c.type==="page_typing"))return null;c=b("FBID.bs").ofString(c.from.toString());if(c!==void 0)return b("MercuryIDs").getThreadIDFromUserID(b("bs_caml_option").valFromOption(c));else return null}c=b("MercuryThreadIDMap").getForFBID(a);return c.getClientIDFromServerIDNow(d.toString())}var na=b("gkx")("1275193")?b("MercuryFilters.bs").getSupportedFilters(void 0).concat([b("MercuryFilters.bs").all,b("MercuryFilters.bs").groups,b("MercuryFilters.bs").named,b("MercuryFilters.bs").unnamed]):b("gkx")("1660458")?b("MercuryFilters.bs").getSupportedFilters(void 0).concat([b("MercuryFilters.bs").all,b("MercuryFilters.bs").groups,b("MercuryFilters.bs").unsyncedChat]):b("MercuryFilters.bs").getSupportedFilters(void 0).concat([b("MercuryFilters.bs").all,b("MercuryFilters.bs").groups]),oa=b("MessengerFolders.bs").getSupportedFolders(void 0).concat(["spam","page_background"]);function pa(a){var b={};oa.forEach(function(a){var c={};na.forEach(function(a){c[a]={threadlist:[],reachedEnd:!1,existingIDs:new Set()}});b[a]=c});return b}function qa(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.invalidatedThread(c)}function u(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.updatedThread(c)}function ra(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.deletedThread(c)}function sa(a,c,d,e){a=b("MercuryThreadInformer").getForFBID(a);a.changedThreadReadState(c,d,e)}function v(a,c){var d=new Map();c.forEach(function(a,b){d.set(a,b)});return c.sort(function(c,e){var f=b("bs_belt_Map").get(a.threads,c),g=b("bs_belt_Map").get(a.threads,e);if(f!==void 0&&g!==void 0){g=b("bs_caml_option").valFromOption(g).timestamp-b("bs_caml_option").valFromOption(f).timestamp;if(g>0)return 1;else if(g<0)return-1;else return 0}f=d.get(c);g=d.get(e);return b("bs_belt_Option").getExn(f==null?void 0:b("bs_caml_option").some(f))-b("bs_belt_Option").getExn(g==null?void 0:b("bs_caml_option").some(g))|0})}function ta(a,c,d,e){a=b("bs_js_dict").get(a.threadlistOrderMap,d);if(a===void 0)return;d=b("bs_js_dict").get(b("bs_caml_option").valFromOption(a),e);if(d===void 0)return;var f=b("bs_caml_option").valFromOption(d);c.forEach(function(a){if(!f.existingIDs.has(a))return;f.existingIDs["delete"](a);a=f.threadlist.indexOf(a);f.threadlist.splice(a,1)})}function w(c,d,e,f){c=c!==void 0?c:function(a){return!0};var a=b("bs_belt_Map").get(d.threads,e);if(a===void 0)return d;a=b("bs_caml_option").valFromOption(a);if(!b("bs_curry")._1(c,a))return d;c=b("ImmutableObject").set(a,f);a=b("bs_belt_Map").set(d.threads,e,c);u(d.fbid,e);return{fbid:d.fbid,deliveryReceipts:d.deliveryReceipts,readReceiptsPerThread:d.readReceiptsPerThread,ignoredIds:d.ignoredIds,blockedIds:d.blockedIds,pendingFolderUnseenCount:d.pendingFolderUnseenCount,typing:d.typing,threads:a,pendingReadStatusThreads:d.pendingReadStatusThreads,messages:d.messages,localIDsMap:d.localIDsMap,messagesWithUploadsInFlight:d.messagesWithUploadsInFlight,threadlistOrderMap:d.threadlistOrderMap,pinnedThreads:d.pinnedThreads,montage:d.montage,orderedMessageLists:d.orderedMessageLists,unreadCounts:d.unreadCounts,initialUnreadCounts:d.initialUnreadCounts,unseenTimestamp:d.unseenTimestamp}}function ua(c,a,d){var e=new Set(a.participants);Object.assign(a,{participants:Array.from(a.participants)});d.forEach(function(d){if(!e.has(d)){a.participants.push(d);if(b("bs_caml_obj").caml_equal(d,c)){Object.assign(a,{is_subscribed:!0,can_reply:!0,cannot_reply_reason:null});return}else return}})}var va=b("XGroupsController");function wa(a){var c=[b("MercuryFilters.bs").all];a.unread_count>0&&c.push(b("MercuryFilters.bs").unread);a.is_canonical||c.push(b("MercuryFilters.bs").groups);if(b("gkx")("1660458")){var d=a.groups_sync_status;!(d==null)&&b("bs_caml_obj").caml_equal(d,b("MessengerGroupsSyncStatus").OPT_IN)||c.push(b("MercuryFilters.bs").unsyncedChat)}if(b("gkx")("1275193"))if(a.name.length!==0){c.push(b("MercuryFilters.bs").named);return c}else{c.push(b("MercuryFilters.bs").unnamed);return c}else return c}function xa(a,c,d,e){oa.forEach(function(b){if(b!==d)return ta(a,c,b,e)});var f=b("bs_js_dict").get(a.threadlistOrderMap,d);if(f!==void 0){f=b("bs_js_dict").get(b("bs_caml_option").valFromOption(f),e);if(f!==void 0){f=b("bs_caml_option").valFromOption(f);f=[f.threadlist,f.existingIDs]}else f=[[],new Set()]}else f=[[],new Set()];var g=f[1],h=f[0];c.forEach(function(a){if(!g.has(a)){g.add(a);h.push(a);return}});return[v(a,h),g]}function ya(a,c,d,e){c=b("gkx")("1275193")||b("gkx")("1660458")?c.filter(function(c){c=b("bs_belt_Map").get(a.threads,c);if(c===void 0)return!1;c=wa(b("bs_caml_option").valFromOption(c));return c.some(function(a){return a===e})}):c;return xa(a,c,d,e)}function za(a,c,d){if(d===void 0)return;var e=b("bs_js_dict").get(a.unreadCounts,c);if(e!==void 0){b("bs_caml_option").valFromOption(e).add(b("bs_caml_option").valFromOption(d));e=b("MercuryThreadInformer").getForFBID(a.fbid);e.updatedUnreadState();return}d=b("MercuryServerRequests").getForFBID(a.fbid);d.fetchUnreadThreadIDs(c)}var Aa=b("MessengerFolders.bs").getSupportedFolders(void 0).filter(function(a){return a!=="action:archived"});function Ba(a,c,d){if(d===void 0)return;var e=b("bs_js_dict").get(a.unreadCounts,c);if(e!==void 0){b("bs_caml_option").valFromOption(e)["delete"](b("bs_caml_option").valFromOption(d));e=b("MercuryThreadInformer").getForFBID(a.fbid);e.updatedUnreadState();return}d=b("MercuryServerRequests").getForFBID(a.fbid);d.fetchUnreadThreadIDs(c)}function Ca(c,a,d){var e=b("MessengerFolders.bs").getFromMeta(a);if(d!==e){Aa.includes(e)&&a.unread_count>0&&za(c,e,b("bs_caml_option").some(a.thread_id));if(Aa.includes(d))return Ba(c,d,b("bs_caml_option").some(a.thread_id));else return}}function Da(a,c,d,e,f){var g=b("gkx")("1275193"),h=b("gkx")("1660458"),i=a.threadlistOrderMap[c][d],j=i.existingIDs.has(e);!f&&(g||h)?ya(a,[e],c,d):xa(a,[e],c,d);if(!(!g&&!h||i.threadlist.length!==0))return;f=b("bs_caml_array").get(i.threadlist,i.threadlist.length-1|0)===e;if(!i.reachedEnd&&!j&&f)return ta(a,[e],c,d)}function Ea(a,c,d){if(oa.includes(c))if((c==="inbox"||c==="action:archived"||c==="pending")&&(b("gkx")("1275193")||b("gkx")("1660458")))return Da(a,c,b("MercuryFilters.bs").unread,d,!0);else{xa(a,[d],c,b("MercuryFilters.bs").unread);return}}function Fa(c,a){var d=b("MessengerFolders.bs").getFromMeta(a);if(oa.includes(d)){na.forEach(function(b){return Da(c,d,b,a.thread_id,!1)});return}}function Ga(d,e,f,g){var a=b("bs_belt_Map").get(d.threads,e);if(a===void 0)return d;a=b("bs_caml_option").valFromOption(a);var h=b("MessengerFolders.bs").getFromMeta(a);if(h!==f){if(g){g=a.comm_status;g=g==null?b("ImmutableObject").set(a,{folder:f}):f==="other"?b("ImmutableObject").set(a,{folder:f,comm_status:b("PageCommItemStatus").SPAM}):f==="inbox"?b("ImmutableObject").set(a,{folder:f,comm_status:b("PageCommItemStatus").TODO}):b("ImmutableObject").set(a,{folder:f})}else g=a;var c=a.other_user_fbid;c=c==null?[]:f==="other"?[b("MercuryIDs").getParticipantIDFromUserID(c)]:[];var i=a.other_user_fbid;f=i==null?[]:f==="other"?[]:[b("MercuryIDs").getParticipantIDFromUserID(i)];i=ja(d,c,f);c=b("bs_belt_Map").set(i.threads,e,g);Ca(i,g,h);Fa(i,g);u(i.fbid,e);return{fbid:i.fbid,deliveryReceipts:i.deliveryReceipts,readReceiptsPerThread:i.readReceiptsPerThread,ignoredIds:i.ignoredIds,blockedIds:i.blockedIds,pendingFolderUnseenCount:i.pendingFolderUnseenCount,typing:i.typing,threads:c,pendingReadStatusThreads:i.pendingReadStatusThreads,messages:i.messages,localIDsMap:i.localIDsMap,messagesWithUploadsInFlight:i.messagesWithUploadsInFlight,threadlistOrderMap:i.threadlistOrderMap,pinnedThreads:i.pinnedThreads,montage:i.montage,orderedMessageLists:i.orderedMessageLists,unreadCounts:i.unreadCounts,initialUnreadCounts:i.initialUnreadCounts,unseenTimestamp:i.unseenTimestamp}}Fa(d,a);return d}function Ha(a,c,d){d=c.is_filtered_content?b("MercuryDisplayTimeFilterMessageRenderer").renderFilteredContent(c):d!==void 0?d:c.body;var e=c.raw_attachments;e=!(e==null)&&e.length!==0?b("MercuryAttachment").convertRaw(e):c.attachments;var f=c.removed_timestamp;if(f==null){f=c.log_message_type;d={snippet:d,snippet_attachments:e,snippet_sender:f==null?c.author:null}}else d={snippet:b("RemovedMessageTombstoneContent").getTombstoneContentForSnippet(c.author),snippet_attachments:null,snippet_sender:null};return Object.assign(a,d)}function x(a,c,d){var e=a.event_title,f=a.event_time;a=a.event_location_name;return{creator_id:null,latitude:null,location_address:null,longitude:null,note:"",related_event:{id:""},repeat_mode:null,seconds_to_notify_before:0,status:null,track_rsvp:c.track_rsvp,title:e==null?c.title:e,event_time:f==null?c.event_time:parseInt(f,10),location_name:a==null?c.location_name:a,event_members:d!==void 0?b("bs_caml_option").valFromOption(d):c.event_members,oid:c.oid,event_type:c.event_type}}function Ia(b,a){var c={};Object.keys(b).forEach(function(a){c[a]=b[a]});c[a.guest_id]=a.guest_status;return c}var y=function(a,b){delete a[b];return 0},z=function(a,b){delete a[b];return 0};function A(a){var c={contents:-1},d={contents:null},e=Math.floor(Date.now()/1e3);b("bs_js_dict").entries(a).forEach(function(a){a=a[1];var b=a.event_time;if(b>e&&(c.contents<0||c.contents>b)){c.contents=b;d.contents=a;return}});return d.contents}var B=b("XMercuryThreadLikeIconController");function Ja(a,c,d){d=B.getURIBuilder().setString("emoji",d).getURI();new(b("AsyncRequest"))(d).setHandler(function(d){var e=b("MercuryDispatcher").getForFBID(a);e.handleUpdate({actions:[{action_type:b("MercuryActionType").UPDATE_CUSTOM_LIKE,thread_id:c,custom_like:d.getPayload()}],from_client:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANGE_CUSTOM_LIKE})}).send()}function Ka(d,a,c,e){c=c.log_message_data;if(c==null)return;var f=c.untypedData;if(c.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_NICKNAME){var g=a.custom_nickname;if(!(g==null)){g=b("bs_js_dict").fromArray(b("bs_js_dict").entries(g));var h=f.nickname;h.trim().length>0?g[f.participant_id]=h:z(g,f.participant_id);Object.assign(a,{custom_nickname:g})}u(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_ICON)Ja(d,e,f.thread_icon);else if(c.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_THEME){if(!b("ChatConfig").get("chat_tab_has_gradients")){h=f.theme_color;if(h==null)Object.assign(a,{solid_color:null,header_color:null,footer_color:null,gradient_colors:[]});else if(h.length>0){g="#"+h.slice(2);Object.assign(a,{solid_color:g,header_color:g,footer_color:g,gradient_colors:[g]})}else Object.assign(a,{solid_color:null,header_color:null,footer_color:null,gradient_colors:[]});u(d,e)}}else if(f!==void 0)if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_CREATE){var i={},j=f.event_creator_id;a.participants.forEach(function(a){a=b("MercuryIDs").getUserIDFromParticipantID(a);if(!(a==null)){i[a]=b("bs_caml_obj").caml_equal(a,j)?"GOING":"INVITED";return}});h=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));g=f.event_time;g={track_rsvp:f.event_track_rsvp,title:f.event_title,event_time:g==null?0:parseInt(g,10),location_name:f.event_location_name,event_members:i,oid:f.event_id,event_type:f.event_type};Object.assign(a,{lightweight_event:g});h[f.event_id]=Object.assign({},g);Object.assign(a,{lightweight_events:h});u(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TIME||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TITLE||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_LOCATION){g=a.lightweight_event;if(!(g==null)){h=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));g.oid===f.event_id&&Object.assign(a,{lightweight_event:x(f,g,b("bs_caml_option").some(g.event_members))});g=b("bs_js_dict").get(h,f.event_id);g!==void 0&&(h[f.event_id]=x(f,b("bs_caml_option").valFromOption(g),void 0),Object.assign(a,{lightweight_events:h}))}u(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_RSVP){g=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));h=a.lightweight_event;if(!(h==null)&&h.oid===f.event_id){var k=Ia(h.event_members,f);Object.assign(a,{lightweight_event:x(f,h,b("bs_caml_option").some(k))})}h=b("bs_js_dict").get(g,f.event_id);if(h!==void 0){k=b("bs_caml_option").valFromOption(h);h=Ia(k.event_members,f);g[f.event_id]=x(f,k,b("bs_caml_option").some(h));Object.assign(a,{lightweight_events:g})}u(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_DELETE||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_NOTIFY){k=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));y(k,f.event_id);Object.assign(a,{lightweight_event:A(k),lightweight_events:k});u(d,e)}}function La(c,d,e,f){if(b("CurrentUser").isWorkUser()&&b("gkx")("1179386")){var a=b("bs_belt_Map").get(c.threads,d);if(a!==void 0){a=b("bs_caml_option").valFromOption(a);var g=a.pinned_messages;g=g==null?void 0:g.map(function(a){if(e.findIndex(function(b){return b===a.message_id})!==-1){b("gkx")("1921671")&&f&&c.messages["delete"](a.message_id);return{message_id:a.message_id,pinning_time:a.pinning_time,message:null}}else return a});if(g!==void 0){a=b("ImmutableObject").set(a,{pinned_messages:g});g=b("bs_belt_Map").set(c.threads,d,a);u(c.fbid,d);a=g}else a=c.threads}else a=c.threads;return{fbid:c.fbid,deliveryReceipts:c.deliveryReceipts,readReceiptsPerThread:c.readReceiptsPerThread,ignoredIds:c.ignoredIds,blockedIds:c.blockedIds,pendingFolderUnseenCount:c.pendingFolderUnseenCount,typing:c.typing,threads:a,pendingReadStatusThreads:c.pendingReadStatusThreads,messages:c.messages,localIDsMap:c.localIDsMap,messagesWithUploadsInFlight:c.messagesWithUploadsInFlight,threadlistOrderMap:c.threadlistOrderMap,pinnedThreads:c.pinnedThreads,montage:c.montage,orderedMessageLists:c.orderedMessageLists,unreadCounts:c.unreadCounts,initialUnreadCounts:c.initialUnreadCounts,unseenTimestamp:c.unseenTimestamp}}else return c}function C(a,c,d,e){a=b("MercuryThreadInformer").getForFBID(a);a.updatedMessage(c,d,b("bs_js_null_undefined").fromOption(e))}function D(c,a){c=b("MercuryThreadInformer").getForFBID(c);c.receivedMessage(a)}function Ma(a,c,d){a=b("MercuryThreadInformer").getForFBID(a);a.reorderedMessages(c,d)}function Na(a,c,d,e,f){a=b("MercuryThreadInformer").getForFBID(a);f=b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(f==null?void 0:b("bs_caml_option").some(f),function(a){return b("bs_belt_Array").keepMap(a,function(a){return b("bs_caml_option").nullable_to_opt(a.message_file_fbid)})}),[]);b("MWChatDeleteMessageEventEmitter").emit(d);a.deletedMessage(c,d,b("bs_js_null_undefined").fromOption(e),f)}function Oa(a,c,d,e){a=b("MercuryThreadInformer").getForFBID(a);a.deletedMessage(c,d,b("bs_js_null_undefined").fromOption(e),null)}var Pa=function(a,b){delete a[b];return 0};function E(c,a){var d=c.localIDsMap.get(a);return b("bs_caml_option").nullable_to_opt(c.messages.get(b("bs_belt_Option").getWithDefault(d==null?void 0:b("bs_caml_option").some(d),a)))}function F(a,c,d){a=a!==void 0?a:!1;d=b("bs_belt_Array").keepMap(d,function(a){return E(c,a)});if(a)return d.slice().reverse();else return d}function Qa(a,c){return b("bs_belt_Array").keepMap(c,function(b){return E(a,b)}).sort(function(a,c){return b("MessengerMessage.bs").compare(c,a)}).map(function(a){return a.message_id})}function G(a,b){return{fbid:a.fbid,deliveryReceipts:a.deliveryReceipts,readReceiptsPerThread:a.readReceiptsPerThread,ignoredIds:a.ignoredIds,blockedIds:a.blockedIds,pendingFolderUnseenCount:a.pendingFolderUnseenCount,typing:a.typing,threads:a.threads,pendingReadStatusThreads:a.pendingReadStatusThreads,messages:a.messages.set(b[0],b[1]),localIDsMap:a.localIDsMap,messagesWithUploadsInFlight:a.messagesWithUploadsInFlight,threadlistOrderMap:a.threadlistOrderMap,pinnedThreads:a.pinnedThreads,montage:a.montage,orderedMessageLists:a.orderedMessageLists,unreadCounts:a.unreadCounts,initialUnreadCounts:a.initialUnreadCounts,unseenTimestamp:a.unseenTimestamp}}function H(b,a){b.localIDsMap.set(a.message_id,a.message_id);return{fbid:b.fbid,deliveryReceipts:b.deliveryReceipts,readReceiptsPerThread:b.readReceiptsPerThread,ignoredIds:b.ignoredIds,blockedIds:b.blockedIds,pendingFolderUnseenCount:b.pendingFolderUnseenCount,typing:b.typing,threads:b.threads,pendingReadStatusThreads:b.pendingReadStatusThreads,messages:b.messages,localIDsMap:b.localIDsMap,messagesWithUploadsInFlight:b.messagesWithUploadsInFlight,threadlistOrderMap:b.threadlistOrderMap,pinnedThreads:b.pinnedThreads,montage:b.montage,orderedMessageLists:b.orderedMessageLists,unreadCounts:b.unreadCounts,initialUnreadCounts:b.initialUnreadCounts,unseenTimestamp:b.unseenTimestamp}}var I=function(a,b){delete a[b];return 0};function J(c,d){var a=c.orderedMessageLists;Object.keys(d).forEach(function(e){var f=b("bs_js_dict").get(d,e);if(f===void 0)return;var g=f[0],h=g.limit,i=g.offset;g=a.get(g.threadID);if(g==null)return;g=g.messageIDs;if(g.length>=(i+h|0)){I(d,e);return b("bs_curry")._1(f[1],F(!0,c,g.slice(i,i+h|0)))}})}function Ra(d,c,e){var a=e[1],f=e[0];b("MessengerMessage.bs").finalizeRanges(a);var g=a.offline_threading_id;if(!(g==null)&&g!==a.message_id){d.localIDsMap.set(g,a.message_id);b("MercuryMessageIDs.bs").addServerID(g,a.message_id);g=a.threading_id;g==null||b("MercuryMessageIDs.bs").addServerID(g,a.message_id)}g=d.messages.has(f);var h=d.fbid,i=d.deliveryReceipts,j=d.readReceiptsPerThread,k=d.ignoredIds,l=d.blockedIds,m=d.pendingFolderUnseenCount,n=d.typing,o=d.threads,p=d.pendingReadStatusThreads,aa=d.messages.set(f,a),q=d.localIDsMap,r=d.messagesWithUploadsInFlight,s=d.threadlistOrderMap,ba=d.pinnedThreads,ca=d.montage,t=d.orderedMessageLists,da=d.unreadCounts,ea=d.initialUnreadCounts;d=d.unseenTimestamp;h={fbid:h,deliveryReceipts:i,readReceiptsPerThread:j,ignoredIds:k,blockedIds:l,pendingFolderUnseenCount:m,typing:n,threads:o,pendingReadStatusThreads:p,messages:aa,localIDsMap:q,messagesWithUploadsInFlight:r,threadlistOrderMap:s,pinnedThreads:ba,montage:ca,orderedMessageLists:t,unreadCounts:da,initialUnreadCounts:ea,unseenTimestamp:d};if(!g&&e[2]===1){i=b("bs_belt_Option").getWithDefault(b("bs_belt_Option").flatMap(b("bs_caml_option").nullable_to_opt(a.thread_id),function(a){return b("bs_caml_option").nullable_to_opt(t.get(a))}),{messageLoadingState:b("MercuryIDs").isLocalThread(a.thread_id)?1:0,messageIDs:[]});j=a.thread_id;if(!(j==null)){k=Qa(h,[f].concat(i.messageIDs.filter(function(c){return b("bs_caml_obj").caml_notequal(c,a.offline_threading_id)})));t.set(j,{messageLoadingState:i.messageLoadingState,messageIDs:k})}J(h,c.messageCallbacks.contents)}return h}function K(b,c,a){b.messagesWithUploadsInFlight.set(c,a);return{fbid:b.fbid,deliveryReceipts:b.deliveryReceipts,readReceiptsPerThread:b.readReceiptsPerThread,ignoredIds:b.ignoredIds,blockedIds:b.blockedIds,pendingFolderUnseenCount:b.pendingFolderUnseenCount,typing:b.typing,threads:b.threads,pendingReadStatusThreads:b.pendingReadStatusThreads,messages:b.messages,localIDsMap:b.localIDsMap,messagesWithUploadsInFlight:b.messagesWithUploadsInFlight,threadlistOrderMap:b.threadlistOrderMap,pinnedThreads:b.pinnedThreads,montage:b.montage,orderedMessageLists:b.orderedMessageLists,unreadCounts:b.unreadCounts,initialUnreadCounts:b.initialUnreadCounts,unseenTimestamp:b.unseenTimestamp}}function Sa(a,c){var d=c[1];c=c[0];var e=a.messagesWithUploadsInFlight.get(c);b("bs_belt_Option").isSome(e==null?void 0:b("bs_caml_option").some(e))||g(0,1777);a.messagesWithUploadsInFlight["delete"](c);if(e==null)return b("bs_pervasives").failwith("Message must exist to update");else return Object.assign(e,{image_ids:d.image_ids,file_ids:d.file_ids,audio_ids:d.audio_ids,gif_ids:d.gif_ids,video_ids:d.video_ids,client_state:b("MercuryMessageClientState").SEND_TO_SERVER})}function Ta(a,c){var d=c[1],e=c[0],f=a.orderedMessageLists.get(e);if(f==null)return a;var g=b("bs_belt_Array").keepMap(d,function(b){return E(a,b)}).map(function(a){return a.message_id}),h=Qa(a,f.messageIDs.filter(function(a){return g.indexOf(a)===-1}));a.orderedMessageLists.set(e,{messageLoadingState:f.messageLoadingState,messageIDs:h});Ma(a.fbid,e,b("bs_js_null_undefined").fromOption(c[2]));f=La(a,e,d,!0);return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp}}function Ua(c,d){var e={snippet:"...",snippet_attachments:null,snippet_sender:null};d=b("bs_belt_Option").flatMap(b("bs_caml_option").nullable_to_opt(c.orderedMessageLists.get(d)),function(a){return b("bs_belt_Array").get(F(void 0,c,a.messageIDs),0)});if(d!==void 0){var a=b("bs_caml_option").valFromOption(d);a=a.is_filtered_content?b("MercuryDisplayTimeFilterMessageRenderer").renderFilteredContent(a):a.body}else a=null;if(d===void 0)return e;d=b("bs_caml_option").valFromOption(d);var f=d.removed_timestamp;if(!(f==null))return{snippet:b("RemovedMessageTombstoneContent").getTombstoneContentForSnippet(d.author),snippet_attachments:null,snippet_sender:null};if(a==null)return e;f=d.log_message_type;return{snippet:a,snippet_attachments:d.attachments,snippet_sender:f==null?d.author:null}}function Va(c,a){var d=a.attachments;if(d==null)return;var e=b("bs_belt_Array").keepMap(d,function(a){if(!(b("MercuryAttachment").isPhotoAttachment(a)||b("MercuryAttachment").isVideoAttachment(a)))return;a=a.metadata;if(!(a==null))return b("bs_caml_option").nullable_to_opt(a.fbid)});b("MessengerSharedMediaActionsLoader").deletePhotos(b("MercuryIDs").getThreadFBIDFromThreadID(a.thread_id),e);if(c!==void 0)return b("MessengerSharedPhotosVideosBaseData.bs").localRemove(b("bs_caml_option").valFromOption(c),b("bs_belt_Array").keepMap(d,function(a){if(!(b("MercuryAttachment").isPhotoAttachment(a)||b("MercuryAttachment").isVideoAttachment(a)))return;a=a.metadata;if(!(a==null))return b("bs_caml_option").nullable_to_opt(a.fbid)}))}function Wa(a,c,d){d=a.orderedMessageLists.get(d);if(d==null)return a;d=d.messageIDs;var e={contents:!0};return b("bs_belt_Array").reduce(d,a,function(d,a){if(!e.contents)return d;var f=d.localIDsMap.get(a);f=b("bs_belt_Option").getWithDefault(f==null?void 0:b("bs_caml_option").some(f),a);if(f===c){e.contents=!1;return d}a=E(d,f);if(a===void 0)return d;a=b("bs_caml_option").valFromOption(a);var g=a.replied_to_message,h;if(g==null)h=void 0;else{g=g.message;if(g==null)h=void 0;else{var i=d.localIDsMap.get(g.message_id);h=b("bs_belt_Option").getWithDefault(i==null?void 0:b("bs_caml_option").some(i),g.message_id)}}if(h===void 0)return d;if(h!==c)return d;i={status:b("RepliedToMessageStatusForGraphQL").DELETED,message:null};g=Object.assign(Object.assign({},a),{replied_to_message:i});return G(d,[f,g])})}function Xa(a,c){if(a==null)return 0;if(a.length===0)return 0;a=b("bs_array").map(function(a){var d=a.type;if(b("bs_caml_obj").caml_equal(d,b("MessageProfileRangeType").THREAD_ACTIVE)||b("bs_caml_obj").caml_equal(d,b("MessageProfileRangeType").THREAD))return b("gkx")("678578");d=a.id;if(d==null)return!1;else return b("bs_caml_obj").caml_equal(b("FBID.bs").ofStringExn(d),c)},a);return b("bs_array").fold_left(function(a,b){if(b)return a+1|0;else return a},0,a)}function Ya(a,c,d){if(b("cr:11271")==null)return;var e=b("MercuryIDs").getThreadFBIDFromThreadID(a);return b("bs_curry")._1(b("cr:11271").log,function(){return{event_name:b("MessengerWebEvent").SENT_MSG,mid:c,offline_threading_id:d,other_user_fbid:b("MercuryIDs").isCanonical(a)?e:null,thread_fbid:b("MercuryIDs").isGroupChat(a)?e:null}})}function Za(d,c,e,f){var g=e.client_message_id,h;if(g==null)h=d;else{var i=E(d,g);if(i!==void 0){i=b("bs_caml_option").valFromOption(i);var j=e.message_id,k=e.status;if(b("bs_caml_obj").caml_equal(i.status,b("MercuryActionStatus").SUCCESS))h=d;else if(d.messages.has(j)){var a=Object.assign(Object.assign({},i),e);C(d.fbid,a.thread_id,a.message_id,f);h=G(d,[j,a])}else{a=b("bs_caml_obj").caml_equal(e.status,b("MercuryActionStatus").SUCCESS)?e.error_data:null;b("MercuryMessageIDs.bs").addServerID(g,j);d.localIDsMap.set(g,j);i=Object.assign(Object.assign({},i),{status:k,error_data:a,timestamp:e.timestamp,log_message_data:e.log_message_data,ranges:e.ranges,attachments:e.attachments,has_attachment:e.has_attachment,is_one_way_sent:e.is_one_way_sent,is_forwarded:e.is_forwarded});b("MessengerMessage.bs").finalizeRanges(i);k=G(d,[j,i]);k.messages.set(g,{});k.messages["delete"](g);a=i.thread_id;var l=k.orderedMessageLists.get(a);if(!(l==null)){var m=Qa(k,l.messageIDs);k.orderedMessageLists.set(a,{messageLoadingState:l.messageLoadingState,messageIDs:m})}C(k.fbid,i.thread_id,i.message_id,f);a=b("MessengerMessage.bs").isTitanMessage(i);l=c.localTitanMessageCount.get(i.thread_id);a&&!(l==null)&&c.localTitanMessageCount.set(i.thread_id,l-1|0);h={fbid:k.fbid,deliveryReceipts:k.deliveryReceipts,readReceiptsPerThread:k.readReceiptsPerThread,ignoredIds:k.ignoredIds,blockedIds:k.blockedIds,pendingFolderUnseenCount:k.pendingFolderUnseenCount,typing:k.typing,threads:k.threads,pendingReadStatusThreads:k.pendingReadStatusThreads,messages:k.messages,localIDsMap:k.localIDsMap.set(g,j),messagesWithUploadsInFlight:k.messagesWithUploadsInFlight,threadlistOrderMap:k.threadlistOrderMap,pinnedThreads:k.pinnedThreads,montage:k.montage,orderedMessageLists:k.orderedMessageLists,unreadCounts:k.unreadCounts,initialUnreadCounts:k.initialUnreadCounts,unseenTimestamp:k.unseenTimestamp}}}else h=d}m={};f=e.log_message_type;if(f==null)Object.assign(m,{snippet_attachments:e.attachments});else{if(b("bs_caml_obj").caml_equal(f,b("MercuryLogMessageType").THREAD_IMAGE)){a=e.log_message_data;if(a==null)c=null;else{i=a.image;c=i==null?null:i.preview_url}Object.assign(m,{image_src:c});u(h.fbid,e.thread_id)}b("bs_caml_obj").caml_notequal(f,b("MercuryLogMessageType").SUBSCRIBE)&&b("bs_caml_obj").caml_notequal(f,b("MercuryLogMessageType").UNSUBSCRIBE)&&Object.assign(m,{snippet_attachments:e.attachments})}Ya(e.thread_id,e.message_id,e.offline_threading_id);return w(void 0,h,e.thread_id,m)}function $a(c,a,d,e){if(b("bs_caml_obj").caml_equal(d.action_type,b("MercuryActionType").SEND_MESSAGE))return Za(c,a,d,e);var f=d.offline_threading_id;f=b("bs_belt_Option").flatMap(f==null?void 0:b("bs_caml_option").some(f),function(a){return b("bs_caml_option").nullable_to_opt(c.localIDsMap.get(a))});var g=E(c,d.message_id);if(f!==void 0){if(g===void 0)return c;f=b("bs_caml_option").valFromOption(g);if(b("bs_caml_option").nullable_to_opt(f.sticker_id)===void 0)return c;var h=Object.assign(f,{attachments:d.attachments});return G(c,[f.message_id,h])}if(g!==void 0)return c;f=b("bs_caml_obj").caml_equal(e,b("bs_caml_option").some(b("MercuryPayloadSource").CLIENT_SEND_MESSAGE))?H(c,d):c;h=b("bs_caml_obj").caml_equal(d.client_state,b("MercuryMessageClientState").DO_NOT_SEND_TO_SERVER);g=d.upload_id;e=h&&!(g==null)?K(f,g,d):f;h=b("MessengerMessage.bs").isErrorLogMessage(d);g=d.thread_id;h&&!(g==null)&&(a.failedHistoryFetchThreads.contents[g]=!0);f=d.manual_retry_cnt;h=d.thread_id;!(f==null)&&!(h==null)&&f>0&&Ma(e.fbid,h,b("MercuryPayloadSource").CLIENT_SEND_MESSAGE);g=Ra(e,a,[d.message_id,d,1]);D(g.fbid,d);return g}function ab(a,c,d,e){if(c===void 0)return;c=b("bs_caml_obj").caml_equal(b("bs_caml_option").valFromOption(c),b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE);var f=d.thread_id;if(!c){!(f==null);return}if(f==null)return;c=b("MercuryThreadInformer").getForFBID(a);return b("bs_curry")._3(e,c,f,d)}function bb(a,b){var c=a.participants.indexOf(b);if(c>0){Object.assign(a,{participants:[b].concat(a.participants.slice(0,c),a.participants.slice(c+1|0))});return}}function cb(c,d,e,f){var g=d.thread_id;if(g==null)return c;var a=b("bs_belt_Map").get(c.threads,g);if(a===void 0)return c;a=b("bs_caml_option").valFromOption(a);var h={};if(!d.skip_bump_thread&&b("bs_caml_obj").caml_notequal(e,b("bs_caml_option").some(b("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO))){Ha(h,d,b("bs_caml_option").nullable_to_opt(d.log_message_body));if(d.timestamp>a.timestamp){Object.assign(h,{timestamp:d.timestamp});if(d.is_unread){Object.assign(h,{unread_count:a.unread_count+1|0});e=Xa(d.profile_ranges,c.fbid);e>0&&Object.assign(h,{unread_mentions_count:a.unread_mentions_count+e|0})}}Object.assign(h,{message_count:a.message_count+1|0,is_archived:!1})}f!==!0&&d.timestamp>h.server_timestamp&&Object.assign(h,{server_timestamp:d.timestamp});if(b("bs_caml_obj").caml_notequal(h,{}))return w(void 0,c,g,h);else return c}function db(b,a,c){var d=new Set(c);Object.assign(a,{participants:a.participants.filter(function(a){return!d.has(a)})});if(d.has(b)){Object.assign(a,{can_reply:!1,is_subscribed:!1});return}}function L(c,a,d){a=a.specific_to_list;if(!(a==null))return a;a=b("MercuryIDs").tokenize(d);if(a.type!=="user"||a.value.length===0)return[c];else return[b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(a.value)),c]}function M(c,a,d){var e=b("MercuryIDs").tokenize(d),f=e.type==="user",g=a.specific_to_list;g=f?!0:g==null?!1:b("MessengerThreadUtils.bs").isCanonicalFromInitialParticipants(c,g);if(g||f)c=L(c,a,d);else{var h=a.specific_to_list;c=h==null?[]:h}return new(b("ImmutableObject"))({admins:{},admin_model_status:null,approval_mode:0,approval_queue_ids:[],associated_object:null,can_reply:!0,cannot_reply_reason:null,can_viewer_report:!1,comm_item_owners:null,comm_source_id:null,comm_status:null,comm_icon_type:[],composer_input_disabled:null,custom_like_icon:null,custom_nickname:null,customization_enabled:!1,description:null,ephemeral_ttl_mode:0,footer_color:null,game_id:null,gradient_colors:[],accessibility_label:null,reverse_gradients_for_radial:null,group_approval_queue:null,group_thread_subtype:null,work_associated_group:null,pinned_messages:null,groups_sync_status:null,has_email_participant:!1,has_montage:!1,unread_mentions_count:0,header_color:null,is_canonical_neo_user:!1,is_from_weak_entry_point:!1,is_pin_protected:!1,is_pinned:!1,is_thread_queue_enabled:!1,joinable_mode:{link:"",mode:0},last_message_timestamp:0,last_message_type:null,last_message_admin_text_type:null,last_message_unsendability_status:null,last_message_id:null,last_read_timestamp:0,lightweight_event:null,lightweight_events:{},marketplace_thread_data:null,mentions_mute_mode:0,mute_until:null,page_comm_item_id:null,page_thread_info:null,page_unsubscribe_status:!1,participant_add_mode:null,participants_event_status:null,reactions_mute_mode:0,read_only:!1,recipients_loadable:!0,rtc_call_data:null,server_timestamp:0,solid_color:null,subtitle:null,theme_id:null,reactions:void 0,thread_associated_job_applications:null,thread_associated_page_admin:null,thread_connectivity_data:null,thread_fbid:null,thread_type:null,thread_pin_timestamp:null,thread_id:d,participants:c,preloaded_participants:[],name:"",snippet:a.body,snippet_attachments:[],snippet_sender:a.author,unread_count:0,message_count:0,image_src:null,square_image_src:null,timestamp:a.timestamp,other_user_fbid:f?b("FBID.bs").ofStringExn(e.value):null,is_canonical_user:f,is_other_recipient_page:!1,is_canonical:g,is_subscribed:!0,folder:"inbox",is_archived:!1,is_page_follow_up:!1,is_page_unresponded_thread:!1,object_association_type:null,joinable_link:null,linked_mentorship_programs:null,thread_unsendability_status:null,is_business_page_active:!1,graphql_token:null,conversion_detection_data:null,suggested_reply_data:null})}function eb(c,d,a,e){e=b("MessengerMessage.bs").hasServerTimestamp(a,e);var f=a.thread_id;if(f==null)return;b("MercuryAssert").isThreadID(f);d=b("bs_belt_Map").get(d,f);if(d!==void 0)return b("bs_caml_option").some(b("bs_caml_option").valFromOption(d));else if(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)&&!e)return b("bs_caml_option").some(M(b("MercuryIDs").getParticipantIDFromUserID(c),a,f));else return}function fb(c,d){var a=d.other_user_fbid;if(a==null){var e=d.thread_fbid;e=e==null?void 0:b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromThreadFBID(e))}else e=b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromUserID(a));a=d.thread_id;e=a==null?e:a==null?void 0:b("bs_caml_option").some(a);a=d.thread_id;var f;if(a==null)f="";else{a=b("bs_belt_Map").get(c.threads,a);f=a!==void 0?b("MessengerFolders.bs").getFromMeta(b("bs_caml_option").valFromOption(a)):d.folder}Aa.includes(f)&&(b("bs_caml_obj").caml_equal(d.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)||b("bs_caml_obj").caml_equal(d.action_type,b("MercuryActionType").LOG_MESSAGE))&&d.is_unread&&za(c,f,e);return{fbid:c.fbid,deliveryReceipts:c.deliveryReceipts,readReceiptsPerThread:c.readReceiptsPerThread,ignoredIds:c.ignoredIds,blockedIds:c.blockedIds,pendingFolderUnseenCount:c.pendingFolderUnseenCount,typing:c.typing,threads:c.threads,pendingReadStatusThreads:c.pendingReadStatusThreads,messages:c.messages,localIDsMap:c.localIDsMap,messagesWithUploadsInFlight:c.messagesWithUploadsInFlight,threadlistOrderMap:c.threadlistOrderMap,pinnedThreads:c.pinnedThreads,montage:c.montage,orderedMessageLists:c.orderedMessageLists,unreadCounts:c.unreadCounts,initialUnreadCounts:c.initialUnreadCounts,unseenTimestamp:c.unseenTimestamp}}var gb=function(a,b){delete a[b];return 0};function hb(a,c){Object.keys(c).forEach(function(d){var e=b("bs_js_dict").get(c,d);if(e===void 0)return;var f=e[0],g=l(f.reduce(function(c,d){var e=b("bs_belt_Map").get(a,d);if(e!==void 0)return b("bs_belt_Map").set(c,d,b("bs_caml_option").valFromOption(e));else return c},b("bs_belt_Map").make(b("ThreadId.bs"))));if(Object.keys(g).length===f.length){gb(c,d);return b("bs_curry")._1(e[1],g)}})}function ib(c,a,d,e,f){var g=c.fbid;d!==0&&sa(g,a.thread_id,f,d);if(a.timestamp===0){b("ChatReliabilityInstrumentation").logERROR("thread timestamp is 0");e.add(a.thread_id);return}d=a.unread_count===0;if(d===f)return;u(g,a.thread_id);if(f)e=0;else{d=b("bs_belt_Option").flatMap(b("bs_caml_option").nullable_to_opt(c.orderedMessageLists.get(a.thread_id)),function(a){return b("bs_belt_Array").get(F(void 0,c,a.messageIDs),0)});g=d!==void 0?b("bs_caml_option").valFromOption(d).profile_ranges:null;e=Xa(g,c.fbid)}return{unread_count:f?0:1,unread_mentions_count:e}}function jb(a,c,d,e,f){f=b("gkx")("1275193")||b("gkx")("1660458")?ya(a,f,c,d):xa(a,f,c,d);a=a.threadlistOrderMap[c];c=b("bs_js_dict").get(a,d);c=c!==void 0?b("bs_caml_option").valFromOption(c).reachedEnd:!1;a[d]={reachedEnd:e.contents?e.contents:c,threadlist:f[0],existingIDs:f[1]}}function kb(a,c,d,e){var f=b("bs_belt_Array").make(e.length,[]),g={contents:!1};d.forEach(function(d){d.thread_ids.forEach(function(c){var h=b("bs_belt_Map").get(a.threads,c);if(h===void 0)return;h=wa(b("bs_caml_option").valFromOption(h));for(var g=0,d=e.length;g<d;++g){var i=h.find(function(a){return function(c){return c===b("bs_caml_array").get(e,a)}}(g));(i===void 0?void 0:b("bs_caml_option").some(i))!==void 0&&b("bs_caml_array").get(f,g).push(c)}});d=d.limit;var h=e.find(function(a){return a===b("MercuryFilters.bs").all});h=h===void 0?void 0:b("bs_caml_option").some(h);for(var i=0,c=f.length;i<c;++i)(h===void 0&&b("bs_caml_array").get(f,i).length<d||b("bs_caml_array").get(e,i)===b("MercuryFilters.bs").all&&b("bs_caml_array").get(f,i).length<d)&&(g.contents=!0)});for(var d=0,h=e.length;d<h;++d)jb(a,c,b("bs_caml_array").get(e,d),g,b("bs_caml_array").get(f,d))}function N(c,a){var d;if(a.is_archived)d="action:archived";else{var e=a.thread_type;d=e==null||e!==b("MessagingThreadType").MARKETPLACE?a.folder:"marketplace_folder"}e=b("bs_js_dict").get(c.threadlistOrderMap,d);if(e!==void 0)return d}function lb(a,c){var d={};oa.forEach(function(a){var b={};na.forEach(function(a){b[a]=[]});d[a]=b});c.forEach(function(c){var e=b("bs_belt_Map").get(a.threads,c.thread_id);if(e===void 0)return;var f=b("bs_caml_option").valFromOption(e),g=N(a,f);if(g!==void 0){wa(f).forEach(function(a){if(f.timestamp!==0){d[g][a].push(c.thread_id);return}});return}});oa.forEach(function(c){na.forEach(function(e){var f=d[c][e];b("gkx")("1275193")||b("gkx")("1660458")?ya(a,f,c,e):xa(a,f,c,e)})});return{fbid:a.fbid,deliveryReceipts:a.deliveryReceipts,readReceiptsPerThread:a.readReceiptsPerThread,ignoredIds:a.ignoredIds,blockedIds:a.blockedIds,pendingFolderUnseenCount:a.pendingFolderUnseenCount,typing:a.typing,threads:a.threads,pendingReadStatusThreads:a.pendingReadStatusThreads,messages:a.messages,localIDsMap:a.localIDsMap,messagesWithUploadsInFlight:a.messagesWithUploadsInFlight,threadlistOrderMap:a.threadlistOrderMap,pinnedThreads:a.pinnedThreads,montage:a.montage,orderedMessageLists:a.orderedMessageLists,unreadCounts:a.unreadCounts,initialUnreadCounts:a.initialUnreadCounts,unseenTimestamp:a.unseenTimestamp}}function mb(a){b("bs_belt_Map").map(a.threads,function(c){c=b("bs_belt_Map").get(a.threads,c.thread_id);if(c===void 0)return;c=b("bs_caml_option").valFromOption(c);if(b("bs_caml_option").nullable_to_opt(c.thread_type)!==b("MessagingThreadType").MARKETPLACE)return;c=b("ImmutableObject").set(c,{folder:"marketplace_folder"});lb(a,[c])})}function nb(c,a,d){var e=function(a){return a.timestamp>(d&&c.unseenTimestamp<=a.last_read_timestamp?a.last_read_timestamp:c.unseenTimestamp)},f=function(a){var d;return(d=b("bs_belt_Option")).mapWithDefault(d.flatMap(d.map(d.map(b("bs_caml_option").nullable_to_opt(c.orderedMessageLists.get(a.thread_id)),function(a){return b("bs_caml_array").get(a.messageIDs,0)}),function(a){return b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(c.localIDsMap.get(a)),a)}),function(a){return b("bs_caml_option").nullable_to_opt(c.messages.get(a))}),!1,function(a){return a.author===b("MercuryIDs").getParticipantIDFromUserID(c.fbid)})},g=function(a,c){if(e(a)&&!b("MercuryThreadInfo").isMuted(a)&&!f(a))return c+1|0;else return c};return b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_js_dict").get(c.threadlistOrderMap,"inbox"),function(a){return b("bs_js_dict").get(a,b("MercuryFilters.bs").all)}),function(d){d=d.threadlist;if(d.length!==0)return d.reduce(function(a,d){d=b("bs_belt_Map").get(c.threads,d);if(d!==void 0)return g(b("bs_caml_option").valFromOption(d),a);else return a},0);else if(b("bs_belt_Map").isEmpty(c.threads))return a.fallbackUnseenCount.contents;else return b("bs_belt_Map").reduce(c.threads,0,function(b,d,a){d=N(c,a);if(d==="inbox")return g(a,b);else return b})}),a.fallbackUnseenCount.contents)}function O(c,a){return b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_js_dict").get(c.threadlistOrderMap,"inbox"),function(a){return b("bs_js_dict").get(a,b("MercuryFilters.bs").all)}),function(d){if(d.threadlist.length===0)if(b("bs_belt_Map").isEmpty(c.threads))return a.fallbackUnseenCount.contents;else return b("bs_belt_Map").reduce(c.threads,0,function(d,e,a){var f=N(c,a);if(f===void 0)return d;if(f!=="inbox")return d;if(!(a.timestamp>c.unseenTimestamp&&!b("MercuryThreadInfo").isMuted(a)))return d;f=b("bs_js_dict").get(c.unreadCounts,"inbox");if(f!==void 0&&b("bs_caml_option").valFromOption(f).has(e))return d+1|0;else return d});else return d.threadlist.reduce(function(d,e){var a=b("bs_belt_Map").get(c.threads,e);if(a===void 0)return d;a=b("bs_caml_option").valFromOption(a);if(!(a.timestamp>c.unseenTimestamp&&!b("MercuryThreadInfo").isMuted(a)))return d;a=b("bs_js_dict").get(c.unreadCounts,"inbox");if(a!==void 0&&b("bs_caml_option").valFromOption(a).has(e))return d+1|0;else return d},0)}),a.fallbackUnseenCount.contents)}function ob(c,a,d){if(d==="pending")return{fbid:c.fbid,deliveryReceipts:c.deliveryReceipts,readReceiptsPerThread:c.readReceiptsPerThread,ignoredIds:c.ignoredIds,blockedIds:c.blockedIds,pendingFolderUnseenCount:0,typing:c.typing,threads:c.threads,pendingReadStatusThreads:c.pendingReadStatusThreads,messages:c.messages,localIDsMap:c.localIDsMap,messagesWithUploadsInFlight:c.messagesWithUploadsInFlight,threadlistOrderMap:c.threadlistOrderMap,pinnedThreads:c.pinnedThreads,montage:c.montage,orderedMessageLists:c.orderedMessageLists,unreadCounts:c.unreadCounts,initialUnreadCounts:c.initialUnreadCounts,unseenTimestamp:c.unseenTimestamp};if(b("gkx")("969964")){d=b("MercuryThreadInformer").getForFBID(c.fbid);d.updatedUnseenTimestamp()}return{fbid:c.fbid,deliveryReceipts:c.deliveryReceipts,readReceiptsPerThread:c.readReceiptsPerThread,ignoredIds:c.ignoredIds,blockedIds:c.blockedIds,pendingFolderUnseenCount:c.pendingFolderUnseenCount,typing:c.typing,threads:c.threads,pendingReadStatusThreads:c.pendingReadStatusThreads,messages:c.messages,localIDsMap:c.localIDsMap,messagesWithUploadsInFlight:c.messagesWithUploadsInFlight,threadlistOrderMap:c.threadlistOrderMap,pinnedThreads:c.pinnedThreads,montage:c.montage,orderedMessageLists:c.orderedMessageLists,unreadCounts:c.unreadCounts,initialUnreadCounts:c.initialUnreadCounts,unseenTimestamp:a}}function P(a,c,d){var e=[];return b("bs_array").fold_left(function(f,g){switch(g.TAG|0){case 0:e.push(g._0.TAG|0);break;case 1:case 2:break}switch(g.TAG|0){case 0:var h=g._0;if(typeof h==="number"){a.threadCallbacks.contents={};a.threadSubToken.contents=a.threadSubToken.contents;a.failedHistoryFetchThreads.contents={};a.localTitanMessageCount.clear();b("bs_belt_Map").keysToArray(f.threads).forEach(function(a){return qa(f.fbid,a)});return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:void 0,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:b("bs_belt_Map").make(b("ThreadId.bs")),pendingReadStatusThreads:new Set(),messages:new Map(),localIDsMap:new Map(),messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:pa(void 0),pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:new Map(),unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp}}switch(h.TAG|0){case 0:var j=h._0,n={contents:!1},o={contents:f.deliveryReceipts};Object.keys(j).forEach(function(a){var c=j[a],d=b("bs_belt_Option").getWithDefault(b("bs_belt_MapString").get(o.contents,a),0);if(c>d){n.contents=!0;o.contents=b("bs_belt_MapString").set(o.contents,a,c);return}});if(n.contents)return{fbid:f.fbid,deliveryReceipts:o.contents,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};else return f;case 1:return ja(f,h._0,[]);case 2:var p=h._0,q=h._1;q=q.reduce(b("bs_belt_Set").remove,p.reduce(b("bs_belt_Set").add,f.blockedIds));if(q===f.blockedIds)return f;else return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:q,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 3:p=h._0;q=p.reduce(function(a,c){var d=c.is_messenger_ignored;if(d==null)return a;else if(d)return b("bs_belt_Set").add(a,b("MercuryIDs").getParticipantIDFromUserID(c.fbid));else return b("bs_belt_Set").remove(a,b("MercuryIDs").getParticipantIDFromUserID(c.fbid))},f.ignoredIds);if(q===f.ignoredIds)return f;else return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:q,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 4:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("SetInitialPendingFolderUnseenCount");p=h._0;return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:p,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 5:q=h._0;p=ma(f.fbid,q);if(p==null)return f;var r=b("FBID.bs").ofString(q.from.toString());if(r===void 0)return f;b("MessengerPersonas.bs").addPersona(q.persona);var s=q.persona;r=s==null?b("MercuryIDs").getParticipantIDFromUserID(b("bs_caml_option").valFromOption(r)):b("MercuryIDs").getParticipantIDFromUserID(s.id);if(q.st===b("TypingStates").TYPING){s=b("bs_belt_MapString").get(f.typing,p);if(s!==void 0)return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:b("bs_belt_MapString").set(f.typing,p,b("bs_belt_Map").set(b("bs_caml_option").valFromOption(s),r,Date.now())),threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};s=b("bs_belt_Map").set(b("bs_belt_Map").make(b("ParticipantId.bs")),r,Date.now());return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:b("bs_belt_MapString").set(f.typing,p,s),threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp}}if(q.st!==b("TypingStates").INACTIVE)return f;s=la(f.typing,p,r);if(s!==f.typing)return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:s,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};else return f;case 6:var ba=h._0,ca={contents:!1},t={contents:f.readReceiptsPerThread};Object.keys(ba).forEach(function(a){Object.keys(ba[a]).forEach(function(c){var d=b("bs_belt_MapString").get(t.contents,a);d=d!==void 0?b("bs_caml_option").valFromOption(d):b("immutable").OrderedMap();var e=d.get(c),f=ba[a][c];if(!(e==null)&&f.watermark<=e.watermark)return;ca.contents=!0;t.contents=b("bs_belt_MapString").set(t.contents,a,d.set(c,f))});var c=b("bs_belt_MapString").get(t.contents,a);if(c!==void 0){ca.contents=!0;t.contents=b("bs_belt_MapString").set(t.contents,a,b("bs_caml_option").valFromOption(c).sort(function(a,c){return b("bs_caml").caml_float_compare(a.watermark,c.watermark)}));return}});if(ca.contents)return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:t.contents,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};else return f;case 7:q=h._0;if(q.length===0)return f;p=f.threads;r=q.reduce(function(c,a){return b("bs_belt_Map").set(c,a.thread_id,new(b("ImmutableObject"))(a))},p);hb(r,a.threadCallbacks.contents);q.forEach(function(a){return u(f.fbid,a.thread_id)});return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:r,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 8:s=h._0;if(s.length===0)return f;var da=f.pendingReadStatusThreads,ea=b("MercuryServerRequests").getForFBID(f.fbid);s.forEach(function(a){var b=a.thread_id;if(da.has(b)){da["delete"](b);if(a.unread_count>0){ea.changeThreadReadStatus(b,!0,null,null,null,null);return}else return}});return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:da,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 9:var fa=h._0;b("qex")._("998180")===!0&&b("MessengerEnvironment").messengerdotcom&&mb(f);oa.forEach(function(a){na.forEach(function(c){var d=fa.filter(function(d){var e=d.filter;e=e==null?b("MercuryFilters.bs").all:e;d=d.folder;d=d==null?a==="inbox":d===a;if(d)return e===c;else return!1});if(!b("gkx")("1275193")&&!b("gkx")("1660458")||a!=="inbox"&&a!=="action:archived"&&a!=="pending"||c===b("MercuryFilters.bs").groups){var e=[],g={contents:!1};d.forEach(function(a){a.thread_ids.forEach(function(a){e.push(a)});var b=a.limit;if(a.thread_ids.length<b){g.contents=!0;return}});return jb(f,a,c,g,e)}if(c!==b("MercuryFilters.bs").all)return kb(f,a,d,[b("MercuryFilters.bs").all,c]);var h=b("gkx")("1275193")?[b("MercuryFilters.bs").all,b("MercuryFilters.bs").unread,b("MercuryFilters.bs").named,b("MercuryFilters.bs").unnamed]:[b("MercuryFilters.bs").all,b("MercuryFilters.bs").unread,b("MercuryFilters.bs").unsyncedChat];return kb(f,a,d,h)})});return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 10:return lb(f,h._0);case 11:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdatePinnedThreads");p=h._0;if(p.length===0)return f;p.forEach(function(b){if(!a.existingPinnedThreads.has(b)){f.pinnedThreads.push(b);a.existingPinnedThreads.add(b);return}});q=b("MercuryThreadInformer").getForFBID(f.fbid);q.updatedThreadlist();return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 12:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UnSubscribeStatusUpdate");r=h._0;var ga=h._1;return w(function(a){return a.page_unsubscribe_status!==ga},f,r,{page_unsubscribe_status:ga});case 13:s=h._0;p=h._1;q=h._2;return w(void 0,f,s,{can_reply:p,cannot_reply_reason:q});case 14:r=h._0;s=h._1;p=b("bs_belt_Map").get(f.threads,r);if(p===void 0)return f;q=Object.assign({},b("bs_caml_option").valFromOption(p));ua(b("MercuryIDs").getParticipantIDFromUserID(f.fbid),q,s);return w(void 0,f,r,q);case 15:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeFlag");p=h._0;s=h._1;r=b("bs_belt_Map").get(f.threads,p);if(r===void 0)return f;q=b("bs_caml_option").valFromOption(r);r=q.page_thread_info;q=b("ImmutableObject").set(q,{page_thread_info:Object.assign(r==null?{}:r,{flagged:s})});r=b("bs_belt_Map").set(f.threads,p,q);u(f.fbid,p);return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:r,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 16:s=h._0;return w(function(a){return b("MessageRequestUtils").isMessageRequest(a)},f,s,{folder:"inbox"});case 17:q=h._0;p=h._1;return w(void 0,f,q,{custom_like_icon:p});case 18:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("PromoteGroupAdmins");r=h._0;s=h._1;q=b("bs_belt_Map").get(f.threads,r);if(q===void 0)return f;p=b("bs_caml_option").valFromOption(q);q=b("bs_js_dict").fromArray(b("bs_js_dict").entries(p.admins));p=b("ImmutableObject").set(p,{admins:b("bs_array").fold_left(function(a,b){a[b.admin_fbid]=b.admin_type;return a},q,s)});q=b("bs_belt_Map").set(f.threads,r,p);u(f.fbid,r);return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:q,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 19:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("RemoveGroupAdmins");s=h._0;p=h._1;r=b("bs_belt_Map").get(f.threads,s);if(r===void 0)return f;q=b("bs_caml_option").valFromOption(r);r=b("bs_js_dict").fromArray(b("bs_js_dict").entries(q.admins));q=b("ImmutableObject").set(q,{admins:b("bs_array").fold_left(function(c,a){var d=b("bs_js_dict").get(c,a);d!==void 0&&ka(c,a);return c},r,p)});r=b("bs_belt_Map").set(f.threads,s,q);u(f.fbid,s);return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:r,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 20:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("JoinableMode");p=h._0;q=h._1;return w(void 0,f,p,{joinable_mode:q});case 21:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ApprovalMode");s=h._0;r=h._1;return w(void 0,f,s,{approval_mode:r});case 22:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ApprovalQueue");p=h._0;q=h._1;s=h._2;var ia=h._3,sa=h._4;r=b("bs_belt_Map").get(f.threads,p);if(r===void 0)return f;r=b("bs_caml_option").valFromOption(r);var v=r.group_approval_queue;r={approval_queue_ids:r.approval_queue_ids.slice(),group_approval_queue:v==null?null:v.slice()};!(q==null)&&r.approval_queue_ids.indexOf(q)===-1&&Object.assign(r,{approval_queue_ids:r.approval_queue_ids.concat([q])});if(!(s==null)){v=r.group_approval_queue;v==null?Object.assign(r,{group_approval_queue:[s]}):v.map(function(a){return a.requester.id}).indexOf(s.requester.id)===-1&&Object.assign(r,{group_approval_queue:v.concat([s])})}ia==null||Object.assign(r,{approval_queue_ids:r.approval_queue_ids.filter(function(a){return b("bs_caml_obj").caml_notequal(a,ia)})});if(!(sa==null)){q=r.group_approval_queue;Object.assign(r,{group_approval_queue:(q==null?[]:q).filter(function(a){return a.requester.id!==sa})})}return w(void 0,f,p,r);case 23:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("IsPinProtected");v=h._0;s=h._1;return w(void 0,f,v,{is_pin_protected:s});case 24:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateRtcCallData");q=h._0;p=h._1;r=h._2;v=h._3;s=b("bs_belt_Map").get(f.threads,q);if(s===void 0)return f;if(p==null){s=b("bs_caml_option").valFromOption(s).rtc_call_data;s=s==null?void 0:p}else s=p;return w(void 0,f,q,{rtc_call_data:new(b("ImmutableObject"))({call_state:r,server_info_data:v,initiator_fbid:s})});case 25:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateCommStatus");p=h._0;q=h._1;return w(void 0,f,p,{comm_status:q});case 26:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateCommItemOwner");r=h._0;v=h._1;s=h._2;p=h._3;q=v==null?{nodes:[]}:{nodes:[{admin:{id:v,name:s,profile_picture:{uri:p}}}]};w(void 0,f,r,{comm_item_owners:q});if(v==null)return w(void 0,f,r,{thread_associated_page_admin:null});else return w(void 0,f,r,{thread_associated_page_admin:{id:v,name:s,profile_picture:{uri:p}}});case 27:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("EventRsvpChanged");q=h._0;var wa=h._1;r=h._2;v=b("bs_belt_Map").get(f.threads,q);if(v===void 0)return f;s=b("bs_caml_option").valFromOption(v).participants_event_status;p=(s==null?[]:s).filter(function(a){return b("bs_caml_obj").caml_notequal(a.participant_id,wa)});p.push({participant_id:wa,event_status:r});return w(void 0,f,q,{participants_event_status:p});case 28:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("GroupsSyncStatusChanged");v=h._0;s=h._1;r=h._2;return!(r==null)&&b("bs_caml_obj").caml_equal(r,b("MessengerGroupsSyncStatus").OPT_IN)?w(void 0,f,v,{groups_sync_status:s}):w(void 0,f,v,{groups_sync_status:s,work_associated_group:null});case 29:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("GroupsSyncMetadataUpdate");q=h._0;p=h._1;r=h._2;v=h._3;if(p==null)return w(void 0,f,q,{work_associated_group:null});if(!b("bs_caml_obj").caml_equal(p,b("MessengerGroupsSyncStatus").OPT_IN))if(b("bs_caml_obj").caml_equal(p,b("MessengerGroupsSyncStatus").UPDATE_EMOJI))return w(void 0,f,q,{work_associated_group:{id:r,group_icon:{emoji_codepoints:v}}});else return w(void 0,f,q,{work_associated_group:null});s=new(i||(i=b("URI")))(document.URL);p=s.getDomain();v=va.getURIBuilder().setString("idorvanity",r).getURI().setDomain(p==null?"":p.replace("messenger.com","facebook.com")).setPort(s.getPort()).setProtocol("https");return w(void 0,f,q,{work_associated_group:{id:r,url:v.toString(),group_saves:{count:0},group_events:{count:0}}});case 30:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("DescriptionChanged");p=h._0;s=h._1;return w(void 0,f,p,{description:s});case 31:q=h._0;r=h._1;return w(void 0,f,q,{solid_color:r.solid_color,header_color:r.header_color,footer_color:r.footer_color,gradient_colors:r.gradient_colors,theme_id:r.theme_id,reactions:r.reactions});case 32:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateJoinableLink");v=h._0;p=h._1;return w(void 0,f,v,{joinable_link:p});case 33:var ya=h._0;s=b("bs_belt_Map").toArray(f.threads).reduce(function(c,d){var a=d[1];d=d[0];if(a.folder===ya){u(f.fbid,d);return b("bs_belt_Map").set(c,d,b("ImmutableObject").set(a,{unread_count:0,unread_mentions_count:0}))}else return c},f.threads);f.unreadCounts[ya]=new Set();q=b("MercuryThreadInformer").getForFBID(f.fbid);q.updatedUnreadState();return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:s,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 34:var Da=h._0;b("gkx")("1199097")&&b("ChatReliabilityInstrumentation").logDELETE_THREAD(Da);r=b("bs_belt_Map").remove(f.threads,Da);f.orderedMessageLists["delete"](Da);f.messages.forEach(function(a,c,d){if(!b("bs_caml_obj").caml_equal(a.thread_id,Da))return;f.messages["delete"](a.message_id);c=a.offline_threading_id;if(!(c==null)){d=f.localIDsMap.get(c);d==null||(f.messages["delete"](d),f.localIDsMap["delete"](c))}f.localIDsMap["delete"](a.message_id)});qa(f.fbid,Da);return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:r,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 35:v=h._0;return Ra(f,a,[v.message_id,v,h._1]);case 36:p=[h._0,h._1,h._2];var Ha=p[2];q=p[1];var x=p[0];if(q.length===0)return f;s=Ta(f,[x,q,Ha]);r=0;Ha!==void 0&&b("bs_caml_obj").caml_equal(b("bs_caml_option").valFromOption(Ha),b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)||(r=1);r===1&&b("MercuryServerRequests").getForFBID(s.fbid).deleteMessages(x,q);return b("bs_belt_Array").reduce(q,s,function(d,e){var c=E(d,e),a=b("bs_belt_Map").get(d.threads,x);if(a!==void 0){a=b("bs_caml_option").valFromOption(a);a=b("ImmutableObject").set(b("ImmutableObject").set(a,Ua(d,x)),{message_count:a.message_count-1|0});a=b("bs_belt_Map").set(d.threads,x,a);u(d.fbid,x);a={fbid:d.fbid,deliveryReceipts:d.deliveryReceipts,readReceiptsPerThread:d.readReceiptsPerThread,ignoredIds:d.ignoredIds,blockedIds:d.blockedIds,pendingFolderUnseenCount:d.pendingFolderUnseenCount,typing:d.typing,threads:a,pendingReadStatusThreads:d.pendingReadStatusThreads,messages:d.messages,localIDsMap:d.localIDsMap,messagesWithUploadsInFlight:d.messagesWithUploadsInFlight,threadlistOrderMap:d.threadlistOrderMap,pinnedThreads:d.pinnedThreads,montage:d.montage,orderedMessageLists:d.orderedMessageLists,unreadCounts:d.unreadCounts,initialUnreadCounts:d.initialUnreadCounts,unseenTimestamp:d.unseenTimestamp}}else a=d;if(c!==void 0){d=b("bs_caml_option").valFromOption(c);Va(b("bs_caml_option").some(x),d);Na(a.fbid,x,e,Ha,d.attachments)}return a});case 37:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeFolder");return Ga(f,h._0,h._1,1);case 38:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeMuteSettings");v=h._0;p=h._1;r=b("bs_belt_Map").get(f.threads,v);if(r===void 0)return f;q=b("bs_caml_option").valFromOption(r);var Ia;switch(p.TAG|0){case 0:Ia=b("ImmutableObject").set(q,{reactions_mute_mode:p._0?1:0});break;case 1:Ia=b("ImmutableObject").set(q,{mentions_mute_mode:p._0?1:0});break;case 2:s=p._0;Ia=b("ImmutableObject").set(q,{mute_until:s===0?void 0:s});break}r=b("bs_belt_Map").set(f.threads,v,Ia);u(f.fbid,v);return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:r,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 39:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeArchivedStatus");p=h._0;q=h._1;s=b("bs_belt_Map").get(f.threads,p);if(s===void 0)return f;v=b("bs_caml_option").valFromOption(s);if(v.is_archived===q)return f;r=b("MessengerFolders.bs").getFromMeta(v);s=v.comm_status;s=s==null?b("ImmutableObject").set(v,{is_archived:q}):b("ImmutableObject").set(v,{is_archived:q,comm_status:q?b("PageCommItemStatus").DONE:b("PageCommItemStatus").TODO});v=b("bs_belt_Map").set(f.threads,p,s);Ca(f,s,r);Fa(f,s);u(f.fbid,p);return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:v,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 40:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangePageFollowUpStatus");q=h._0;r=h._1;s=b("bs_belt_Map").get(f.threads,q);if(s===void 0)return f;p=b("bs_caml_option").valFromOption(s);if(p.is_page_follow_up===r)return f;v=b("ImmutableObject").set(p,{is_page_follow_up:r});s=b("bs_belt_Map").set(f.threads,q,v);u(f.fbid,q);return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:s,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 41:p=h._0;r=h._1;v=h._2;q=h._3;s=h._4;var y=b("bs_belt_Map").get(f.threads,p);if(y===void 0)return f;y=b("bs_caml_option").valFromOption(y);v=ib(f,y,v,f.pendingReadStatusThreads,r);v=v!==void 0&&y.last_message_timestamp>y.last_read_timestamp?b("bs_caml_option").some(Object.assign(b("bs_caml_option").valFromOption(v),{last_read_timestamp:y.last_message_timestamp})):v;if(v!==void 0){v=b("ImmutableObject").set(y,b("bs_caml_option").valFromOption(v));var z=b("bs_belt_Map").set(f.threads,p,v);if(q){q=!y.read_only&&y.folder==="inbox";var A=b("MercuryServerRequests").getForFBID(f.fbid);A.changeThreadReadStatus(v.thread_id,r,s,v.last_read_timestamp,q,v.last_message_type)}A=z}else A=f.threads;s=b("MessengerFolders.bs").getFromMeta(y);r?(ta(f,[p],s,b("MercuryFilters.bs").unread),Ba(f,s,b("bs_caml_option").some(p))):(b("gkx")("1275193")||b("gkx")("1660458")?Ea(f,s,p):xa(f,[p],s,b("MercuryFilters.bs").unread),za(f,s,b("bs_caml_option").some(p)));return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:A,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 42:var B=h._0;q=b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_caml_option").nullable_to_opt(f.orderedMessageLists.get(B)),function(a){return{messageLoadingState:a.messageLoadingState,messageIDs:[]}}),{messageLoadingState:0,messageIDs:[]});f.orderedMessageLists.set(B,q);v=b("bs_belt_Option").map(b("bs_belt_Map").get(f.threads,B),function(a){return b("ImmutableObject").set(a,{message_count:0})});if(v!==void 0){var Ja=b("bs_caml_option").valFromOption(v);z=b("bs_belt_Map").set(f.threads,B,Ja);na.forEach(function(a){return ta(f,[B],b("MessengerFolders.bs").getFromMeta(Ja),a)});y=z}else y=f.threads;Aa.forEach(function(a){a=b("bs_js_dict").get(f.unreadCounts,a);if(a!==void 0){b("bs_caml_option").valFromOption(a)["delete"](B);return}});ra(f.fbid,B);return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:y,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 43:r=[h._0,h._1,h._2];s=Sa(f,[r[0],r[1]]);p=s.thread_id;A=Ta(f,[p,[s.message_id],r[2]]);q=a.localTitanMessageCount.get(p);q==null||a.localTitanMessageCount.set(p,Math.max(0,q-1|0));return A;case 44:v=[h._0,h._1];z=Sa(f,[v[0],v[1]]);b("MercuryServerRequests").getForFBID(f.fbid).sendNewMessage(Object.assign(z,{preview_attachments:void 0}));return f;case 45:y=[h._0,h._1,h._2,h._3];s=y[2];r=y[1];p=y[0];q=E(f,p);if(q===void 0)return f;A=b("bs_caml_option").valFromOption(q);v=b("bs_js_dict").map(function(a){return a},b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(A.reactions),{}));r!==void 0?v[s]=r:Pa(v,s);z=Object.assign(Object.assign({},A),{reactions:v});q=A.thread_id;q==null||C(f.fbid,q,p,y[3]);return G(f,[p,z]);case 46:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("MontageDirectExpire");r=h._0;s=E(f,r);if(s===void 0)return f;v=b("bs_caml_option").valFromOption(s);A=v.attachments;if(A==null)return f;if(A.length===0)return f;q=b("bs_caml_array").get(A,0);y=q.share;if(y==null)return f;p=y.target;if(p==null)return f;z=p.message_state;if(z==null)return f;s=Object.assign(Object.assign({},v),{attachments:b("bs_caml_array").set(b("bs_array").copy(A),0,Object.assign(Object.assign({},q),{share:Object.assign(Object.assign({},y),{target:Object.assign(Object.assign({},p),{message_state:"EXPIRED"})})}))});return G(f,[r,s]);case 47:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("LiveLocationUpdate");z=[h._0,h._1,h._2];v=z[0];A=E(f,v);if(A===void 0)return f;q=b("bs_caml_option").valFromOption(A);y=q.attachments;if(y==null)return f;if(y.length===0)return f;p=b("bs_caml_array").get(y,0);r=p.share;if(r==null)return f;s=r.target;if(s==null)return f;A=b("bs_array").copy(y);b("bs_caml_array").set(A,0,Object.assign(Object.assign({},p),{share:Object.assign(Object.assign({},r),{target:Object.assign(Object.assign({},z[1]),{live_location_id:s.live_location_id})})}));y=Object.assign(Object.assign({},q),{attachments:A});p=q.thread_id;p==null||C(f.fbid,p,v,z[2]);return G(f,[v,y]);case 48:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ReplaceMessage");r=h._0;s=h._1;var D=r.replaced_message_id;if(D==null)return f;A=E(f,D);if(A===void 0)return f;q=r.message_id;p={timestamp:r.timestamp};z=b("bs_caml_option").nullable_to_opt(r.status);z!==void 0&&(p.status=b("bs_caml_option").valFromOption(z));v=b("bs_caml_option").nullable_to_opt(r.log_message_data);v!==void 0&&(p.log_message_data=b("bs_caml_option").valFromOption(v));y=b("bs_caml_option").nullable_to_opt(r.meta_ranges);y!==void 0&&(p.meta_ranges=b("bs_caml_option").valFromOption(y));z=b("bs_caml_option").nullable_to_opt(r.ranges);z!==void 0&&(p.ranges=b("bs_caml_option").valFromOption(z));v=b("bs_caml_option").nullable_to_opt(r.raw_attachments);v!==void 0&&(p.raw_attachments=b("bs_caml_option").valFromOption(v));y=b("bs_caml_option").nullable_to_opt(r.attachments);y!==void 0&&(p.attachments=b("bs_caml_option").valFromOption(y));z=b("bs_caml_option").nullable_to_opt(r.body);z!==void 0&&(p.body=z);v=b("bs_caml_option").nullable_to_opt(r.platform_xmd);v!==void 0&&(p.platform_xmd=v);y=b("bs_caml_option").nullable_to_opt(r.profile_ranges);y!==void 0&&(p.profile_ranges=b("bs_caml_option").valFromOption(y));z=p;v=Object.assign(Object.assign({},b("bs_caml_option").valFromOption(A)),z);b("MercuryMessageIDs.bs").addServerID(q,q);var F=G(f,[q,v]);if(q!==D){F.messages["delete"](D);F.localIDsMap.set(D,q);y=b("bs_belt_Option").flatMap(b("bs_caml_option").nullable_to_opt(r.thread_id),function(a){return b("bs_caml_option").nullable_to_opt(F.orderedMessageLists.get(a))});p=r.thread_id;if(y!==void 0&&!(p==null)){A=Qa(F,[q].concat(y.messageIDs.filter(function(a){return a!==D})));F.orderedMessageLists.set(p,{messageLoadingState:y.messageLoadingState,messageIDs:A})}}z=r.message_id;v=r.thread_id;v==null||(C(F.fbid,v,D,s),C(F.fbid,v,z,s));return{fbid:F.fbid,deliveryReceipts:F.deliveryReceipts,readReceiptsPerThread:F.readReceiptsPerThread,ignoredIds:F.ignoredIds,blockedIds:F.blockedIds,pendingFolderUnseenCount:F.pendingFolderUnseenCount,typing:F.typing,threads:F.threads,pendingReadStatusThreads:F.pendingReadStatusThreads,messages:F.messages,localIDsMap:F.localIDsMap,messagesWithUploadsInFlight:F.messagesWithUploadsInFlight,threadlistOrderMap:F.threadlistOrderMap,pinnedThreads:F.pinnedThreads,montage:F.montage,orderedMessageLists:F.orderedMessageLists,unreadCounts:F.unreadCounts,initialUnreadCounts:F.initialUnreadCounts,unseenTimestamp:F.unseenTimestamp};case 49:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateLocalTitanMessagesCount");q=[h._0,h._1];p=q[0];y=E(f,q[1]);if(y!==void 0&&b("MessengerMessage.bs").isTitanMessage(b("bs_caml_option").valFromOption(y))){A=a.localTitanMessageCount.get(p);A==null?a.localTitanMessageCount.set(p,1):a.localTitanMessageCount.set(p,1+A|0)}return f;case 50:return Za(f,a,h._0,h._1);case 51:r=h._0;v=h._1;z=h._2;s=r.author;if(s==null)q=!1;else{y=b("MercuryIDs").getUserIDFromParticipantID(s);q=y==null?!1:y===b("CurrentUser").getID()}p=r.offline_threading_id;A=p==null?void 0:b("bs_caml_option").nullable_to_opt(f.localIDsMap.get(p));s=A!==void 0;if(b("gkx")("1491696")&&!q&&b("bs_caml_obj").caml_equal(v,b("bs_caml_option").some(b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE))&&s)return f;y=cb(f,r,v,z==null?void 0:b("bs_caml_option").some(z));ab(y.fbid,v,r,function(a,b,c){a.informNewMessage(b,c)});p=y.fbid;if(r.folder==="pending"&&b("bs_caml_obj").caml_equal(v,b("bs_caml_option").some(b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)))A={fbid:y.fbid,deliveryReceipts:y.deliveryReceipts,readReceiptsPerThread:y.readReceiptsPerThread,ignoredIds:y.ignoredIds,blockedIds:y.blockedIds,pendingFolderUnseenCount:y.pendingFolderUnseenCount+1|0,typing:y.typing,threads:y.threads,pendingReadStatusThreads:y.pendingReadStatusThreads,messages:y.messages,localIDsMap:y.localIDsMap,messagesWithUploadsInFlight:y.messagesWithUploadsInFlight,threadlistOrderMap:y.threadlistOrderMap,pinnedThreads:y.pinnedThreads,montage:y.montage,orderedMessageLists:y.orderedMessageLists,unreadCounts:y.unreadCounts,initialUnreadCounts:y.initialUnreadCounts,unseenTimestamp:y.unseenTimestamp};else if(r.folder==="inbox"){q=r.thread_id;A=q==null?y:Ga(y,q,r.folder,0)}else{s=r.thread_id;if(s==null)A=y;else{q=eb(y.fbid,y.threads,r,z);if(q!==void 0){z=b("bs_caml_option").valFromOption(q);q=y.fbid;var H=y.deliveryReceipts,I=y.readReceiptsPerThread,J=y.ignoredIds,K=y.blockedIds,L=y.pendingFolderUnseenCount,M=y.typing,N=b("bs_belt_Map").set(y.threads,z.thread_id,z),O=y.pendingReadStatusThreads,P=y.messages,Q=y.localIDsMap,R=y.messagesWithUploadsInFlight,S=y.threadlistOrderMap,T=y.pinnedThreads,U=y.montage,V=y.orderedMessageLists,W=y.unreadCounts,X=y.initialUnreadCounts,Y=y.unseenTimestamp;q={fbid:q,deliveryReceipts:H,readReceiptsPerThread:I,ignoredIds:J,blockedIds:K,pendingFolderUnseenCount:L,typing:M,threads:N,pendingReadStatusThreads:O,messages:P,localIDsMap:Q,messagesWithUploadsInFlight:R,threadlistOrderMap:S,pinnedThreads:T,montage:U,orderedMessageLists:V,unreadCounts:W,initialUnreadCounts:X,unseenTimestamp:Y};if(b("bs_caml_obj").caml_equal(v,b("bs_caml_option").some(b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE))){H=r.offline_threading_id;H==null?Object.assign(r,{folder:z.folder}):b("bs_caml_obj").caml_equal(b("bs_caml_option").nullable_to_opt(Q.get(H)),H)?Object.assign(r,{client_message_id:r.offline_threading_id,status:b("MercuryActionStatus").SUCCESS,action_type:b("MercuryActionType").SEND_MESSAGE}):Object.assign(r,{folder:z.folder})}Fa(q,z);I=Object.assign({},z);J=r.offline_threading_id;if(!(J==null)){if(J!==r.message_id){Object.assign(I,{last_message_timestamp:r.timestamp});K=r.comm_status;K==null||Object.assign(I,{last_message_id:r.message_id})}L=r.author;if(!(b("cr:11271")==null)&&!(L==null)){M=b("MercuryIDs").getParticipantIDFromUserID(p);r.has_attachment&&M===L&&Ya(s,r.message_id,J)}}N=r.comm_status;O=I.comm_status;!(N==null)&&!(O==null)&&b("bs_caml_obj").caml_notequal(O,b("PageCommItemStatus").FOLLOW_UP)&&Object.assign(I,{comm_status:N});P=r.creator_info;!(P==null)&&b("bs_caml_obj").caml_equal(P.pageID,p)&&Object.assign(I,{folder:r.folder});R=r.author;R==null||bb(I,R);A=w(void 0,q,s,I)}else A=y}}S=$a(A,a,r,v);T=fb(S,r);U=b("bs_caml_obj").caml_notequal(r.author,b("MercuryViewer").getID());V=r.thread_id;W=r.author;if(!U)return T;if(V==null)return T;if(W==null)return T;X=la(T.typing,V,W);if(X!==T.typing)return{fbid:T.fbid,deliveryReceipts:T.deliveryReceipts,readReceiptsPerThread:T.readReceiptsPerThread,ignoredIds:T.ignoredIds,blockedIds:T.blockedIds,pendingFolderUnseenCount:T.pendingFolderUnseenCount,typing:X,threads:T.threads,pendingReadStatusThreads:T.pendingReadStatusThreads,messages:T.messages,localIDsMap:T.localIDsMap,messagesWithUploadsInFlight:T.messagesWithUploadsInFlight,threadlistOrderMap:T.threadlistOrderMap,pinnedThreads:T.pinnedThreads,montage:T.montage,orderedMessageLists:T.orderedMessageLists,unreadCounts:T.unreadCounts,initialUnreadCounts:T.initialUnreadCounts,unseenTimestamp:T.unseenTimestamp};else return T;case 52:Y=h._0;Q=h._1;H=h._2;z=b("bs_caml_obj").caml_notequal(H==null?void 0:b("bs_caml_option").some(H),!1);K=b("bs_caml_obj").caml_equal(H==null?void 0:b("bs_caml_option").some(H),!0);M=f.fbid;L=b("MercuryIDs").getParticipantIDFromUserID(M);J=$a(f,a,Y,Q);ab(J.fbid,Q,Y,function(a,b,c){a.informNewLogMessage(b,c)});O=cb(J,Y,Q,H==null?void 0:b("bs_caml_option").some(H));N=Y.thread_id;if(N==null)P=O;else{p=b("bs_belt_Map").get(O.threads,N);if(p!==void 0){R=Object.assign({},b("bs_caml_option").valFromOption(p));Fa(O,R);R.last_message_timestamp<Y.timestamp&&Object.assign(R,{last_message_timestamp:Y.timestamp});if(Y.timestamp>=R.timestamp||b("gkx")("1183082")){q=Y.log_message_type;if(!(q==null))if(b("bs_caml_obj").caml_equal(q,b("MercuryLogMessageType").SUBSCRIBE)&&!K){s=Y.log_message_data;if(s==null)I=[];else{y=s.added_participants;I=y==null?[]:y}ua(L,R,I);u(M,N)}else if(b("bs_caml_obj").caml_equal(q,b("MercuryLogMessageType").UNSUBSCRIBE)&&!K){A=Y.log_message_data;if(A==null)v=[];else{S=A.removed_participants;v=S==null?[]:S}db(L,R,v);u(M,N)}else if(b("bs_caml_obj").caml_equal(q,b("MercuryLogMessageType").THREAD_IMAGE)){if(!z){r=Y.log_message_data;if(r==null)U=null;else{V=r.image;U=V==null?null:V.preview_url}Object.assign(R,{image_src:U})}}else if(b("bs_caml_obj").caml_equal(q,b("MercuryLogMessageType").THREAD_NAME)){W=Y.log_message_data;if(!(W==null)){X=W.name;!(X==null)&&R.name===X||u(M,N);Object.assign(R,{name:W.name})}}else b("bs_caml_obj").caml_equal(q,b("MercuryLogMessageType").GENERIC_ADMIN_TEXT)&&Ka(M,R,Y,N)}P=w(void 0,O,N,R)}else P=O}return fb(P,Y);case 53:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("PinMessage");if(b("gkx")("1179386")){T=h._0;J=h._1;Q=b("bs_belt_Map").get(f.threads,T);if(Q!==void 0&&!(J==null)){H=b("ImmutableObject").set(b("bs_caml_option").valFromOption(Q),{pinned_messages:[J.message]});p=b("bs_belt_Map").set(f.threads,T,H);s=J.message.message_id;y=J.message.message;I=y==null?f:Ra(f,a,[s,y,0]);u(f.fbid,T);K=[I,p]}else K=[f,f.threads];A=K[0];return{fbid:A.fbid,deliveryReceipts:A.deliveryReceipts,readReceiptsPerThread:A.readReceiptsPerThread,ignoredIds:A.ignoredIds,blockedIds:A.blockedIds,pendingFolderUnseenCount:A.pendingFolderUnseenCount,typing:A.typing,threads:K[1],pendingReadStatusThreads:A.pendingReadStatusThreads,messages:A.messages,localIDsMap:A.localIDsMap,messagesWithUploadsInFlight:A.messagesWithUploadsInFlight,threadlistOrderMap:A.threadlistOrderMap,pinnedThreads:A.pinnedThreads,montage:A.montage,orderedMessageLists:A.orderedMessageLists,unreadCounts:A.unreadCounts,initialUnreadCounts:A.initialUnreadCounts,unseenTimestamp:A.unseenTimestamp}}else return f;case 54:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UnpinMessage");if(b("gkx")("1179386")){S=h._0;var pb=h._1;L=b("bs_belt_Map").get(f.threads,S);if(L!==void 0&&!(pb==null)){v=b("bs_caml_option").valFromOption(L);z=v.pinned_messages;r=z==null?void 0:z.filter(function(a){return a.message_id!==pb.message_id});if(r!==void 0){V=b("ImmutableObject").set(v,{pinned_messages:b("bs_belt_Option").getExn(r)});U=b("bs_belt_Map").set(f.threads,S,V);u(f.fbid,S);X=U}else X=f.threads}else X=f.threads;return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:X,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp}}else return f;case 55:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangePinnedStatus");W=h._0;q=h._1;M=h._2;N=b("bs_belt_Map").get(f.threads,W);R=!1;if(q&&!a.existingPinnedThreads.has(W))f.pinnedThreads.push(W),a.existingPinnedThreads.add(W),R=!0;else if(!q&&a.existingPinnedThreads.has(W)){O=f.pinnedThreads.indexOf(W);O>-1&&f.pinnedThreads.splice(O,1);a.existingPinnedThreads["delete"](W);R=!0}if(N!==void 0){P=b("bs_caml_option").valFromOption(N);Y=b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(P.thread_pin_timestamp),0);if(P.is_pinned!==q||Y!==M){Q=b("ImmutableObject").set(P,{is_pinned:q,thread_pin_timestamp:M});H=b("bs_belt_Map").set(f.threads,W,Q);u(f.fbid,W);R=!0;J=H}else J=f.threads}else J=f.threads;if(R)return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:J,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};else return f;case 56:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("InvalidateMontageState");s=h._0;y=b("bs_js_dict").fromArray(b("bs_js_dict").entries(f.montage));y[s]=[];return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:y,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 57:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("NewMontageMessage");T=h._0;I=b("bs_js_dict").fromArray(b("bs_js_dict").entries(f.montage));p=T.actor.id;K=b("bs_js_dict").get(I,p);K!==void 0?(K.push(T),I[p]=K):I[p]=[T];return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:I,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 58:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("InstantiateMontageThread");A=h._0;L=b("bs_js_dict").fromArray(b("bs_js_dict").entries(f.montage));z=b("bs_js_dict").get(L,A);z!==void 0||(L[A]=[]);return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:L,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 59:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("DeleteMontageMessage");var qb=h._0,Z=b("bs_js_dict").fromArray(b("bs_js_dict").entries(f.montage));v=Object.keys(Z);v.forEach(function(a){var c=b("bs_js_dict").get(Z,a);if(c===void 0)return;c=c.filter(function(a){return a.id!==qb.messageFBID});Z[a]=c});return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:Z,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 60:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("AddFetchedAllHistoryMarkers");r=[h._0,h._1];var sb=r[1];r[0].forEach(function(a){var b=f.orderedMessageLists.get(a);b==null?f.orderedMessageLists.set(a,{messageLoadingState:1,messageIDs:[]}):f.orderedMessageLists.set(a,{messageLoadingState:1,messageIDs:b.messageIDs});return Ma(f.fbid,a,sb)});return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 61:V=h._0;V.forEach(function(c){var a=c.folder;if(!Aa.includes(a))return;c=c.thread_fbids.map(function(a){return b("MercuryIDs").getThreadIDFromThreadFBID(a)}).concat(c.other_user_fbids.map(function(a){return b("MercuryIDs").getThreadIDFromUserID(a)}));f.unreadCounts[a]=new Set(c);a=b("MercuryThreadInformer").getForFBID(f.fbid);a.updatedUnreadState()});return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 62:S=h._0;var d={contents:f.unseenTimestamp};S.forEach(function(c){f.initialUnreadCounts[c.folder]=c.unread_count;c.unread_count===0&&(f.unreadCounts[c.folder]=new Set());c.folder==="inbox"&&(d.contents=b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(c.seen_timestamp),d.contents),a.fallbackUnseenCount.contents=c.unseen_count);c=b("MercuryThreadInformer").getForFBID(f.fbid);c.updatedUnreadState();c.updatedUnseenState()});return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:d.contents};case 63:var $=h._0;Aa.forEach(function(a){a=b("bs_js_dict").get(f.unreadCounts,a);if(a===void 0)return;var c=b("bs_caml_option").valFromOption(a);b("bs_js_dict").entries($).forEach(function(a){var b=a[0];if(c.has(b)){c.add(a[1]);c["delete"](b);return}})});return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 64:U=h._0;X=h._1;O=h._2;N=h._3;Y=h._4;P=La(f,U,[X],!1);q=E(P,X);if(q!==void 0){M=b("bs_caml_option").valFromOption(q);Va(b("bs_caml_option").some(U),M);Q=b("MessengerMessage.bs").makeFakeMessage(M.message_id,M.thread_id,M.author,M.action_type,M.timestamp,{removed_timestamp:N,message_unsendability_status:b("MessageUnsendabilityStatus").DENY_TOMBSTONE_MESSAGE,unsender:{id:O}});W=G(P,[X,Q]);H=M.thread_id;if(H==null)return W;R=Wa(W,X,H);C(R.fbid,H,X,Y);Na(R.fbid,H,X,Y,M.attachments);J=b("bs_belt_Map").get(R.threads,H);if(J===void 0)return R;s=b("bs_caml_option").valFromOption(J);y=Xa(M.profile_ranges,R.fbid);K=b("ImmutableObject").set(b("ImmutableObject").set(s,Ua(R,H)),{unread_mentions_count:s.unread_mentions_count-y|0});p=b("bs_belt_Map").set(R.threads,H,K);u(R.fbid,H);return{fbid:R.fbid,deliveryReceipts:R.deliveryReceipts,readReceiptsPerThread:R.readReceiptsPerThread,ignoredIds:R.ignoredIds,blockedIds:R.blockedIds,pendingFolderUnseenCount:R.pendingFolderUnseenCount,typing:R.typing,threads:p,pendingReadStatusThreads:R.pendingReadStatusThreads,messages:R.messages,localIDsMap:R.localIDsMap,messagesWithUploadsInFlight:R.messagesWithUploadsInFlight,threadlistOrderMap:R.threadlistOrderMap,pinnedThreads:R.pinnedThreads,montage:R.montage,orderedMessageLists:R.orderedMessageLists,unreadCounts:R.unreadCounts,initialUnreadCounts:R.initialUnreadCounts,unseenTimestamp:R.unseenTimestamp}}Oa(P.fbid,U,X,Y);return P;case 65:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateConnectivityStatus");T=h._0;I=h._1;z=b("ThreadConnectivityStatus.bs").toGraphQLValue(I);A=b("bs_belt_Map").get(f.threads,T);if(A===void 0)return f;L=b("bs_caml_option").valFromOption(A);v=L.thread_connectivity_data;r=v==null?b("ImmutableObject").set(L,{thread_connectivity_data:{connectivity_status:z,first_sender_id:null}}):b("ImmutableObject").set(L,{thread_connectivity_data:{connectivity_status:z,first_sender_id:v.first_sender_id}});return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:b("bs_belt_Map").set(f.threads,T,r),pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 66:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("DeltaMarkFolderSeen");var tb=h._0;return b("bs_belt_Array").reduceU(tb.folders,f,function(c,a){a=b("bs_js_dict").get(k,a);if(a!==void 0)return ob(c,Number(tb.timestamp),a);else return c});case 67:V=[h._0,h._1,h._2,h._3];var ub=V[2];S=V[0];q=E(f,S);if(q===void 0)return f;N=b("bs_caml_option").valFromOption(q);O=V[1].concat(N.tags).filter(function(a){return ub.indexOf(a)===-1});Q=Object.assign(Object.assign({},N),{tags:O});W=N.thread_id;W==null||C(f.fbid,W,S,V[3]);return G(f,[S,Q]);case 68:J=h._0;M=h._1;return w(void 0,f,J,{conversion_detection_data:M});case 69:s=[h._0,h._1,h._2,h._3,h._4];y=s[0];K=E(f,y);if(K===void 0)return f;H=b("bs_caml_option").valFromOption(K);p=H.attachments;if(p==null)return f;if(p.length!==1)return f;R=p[0];U=s[2]?[Object.assign(Object.assign({},R),{blurred_image_uri:void 0})]:[Object.assign(Object.assign({},R),{blurred_image_uri:s[3]})];X=Object.assign(Object.assign({},H),{attachments:U});Y=H.thread_id;Y==null||C(f.fbid,Y,y,s[4]);return G(f,[y,X]);case 70:P=h._0;I=h._1;return w(void 0,f,P,{suggested_reply_data:I});case 71:A=[h._0,h._1,h._2];L=A[0];z=E(f,L);if(z===void 0)return f;v=b("bs_caml_option").valFromOption(z);T=v.secondary_language_body;if(!(T==null))return f;r=Object.assign(Object.assign({},v),{secondary_language_body:A[1],is_secondary_language_body_decrypted:!1});q=v.thread_id;q==null||C(f.fbid,q,L,A[2]);return G(f,[L,r])}case 1:O=g._0;if(typeof O==="number")if(O===0){var vb=[];b("bs_belt_MapString").forEach(f.typing,function(a,c){return b("bs_belt_Map").forEach(c,function(b,c){if(c<Date.now()-3e4){vb.push([a,b]);return}})});if(vb.length===0)return f;var c={contents:f.typing};vb.forEach(function(a){c.contents=la(c.contents,a[0],a[1])});return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:c.contents,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp}}else{if(nb(f,a,!1)<=0)return f;N=b("MercuryServerRequests").getForFBID(f.fbid);N.markSeen();return ob(f,N.getLastActionTimestamp(),"inbox")}switch(O.TAG|0){case 0:W=O._0;V=O._1;S=O._2;Q=O._3;var wb=f.threads,xb=[];J=l(W.reduce(function(d,c){var a=b("bs_belt_Map").get(wb,c);if(a!==void 0)return b("bs_belt_Map").set(d,c,b("bs_caml_option").valFromOption(a));else{xb.push(c);return d}},b("bs_belt_Map").make(b("ThreadId.bs"))));if(xb.length!==0){M=a.threadSubToken;K=M.contents.toString();a.threadSubToken.contents=M.contents+1|0;a.threadCallbacks.contents[K]=[W,S];p=b("MercuryServerRequests").getForFBID(f.fbid);R=xb.reduce(function(d,c){var e=b("MercuryIDs").tokenize(c),g=e.type;e=e.value;if(g!=="user")return d;g=b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(e));e=b("MercuryIDs").getParticipantIDFromUserID(f.fbid);e=b("MessengerThreadUtils.bs").createNewLocalThread(e,c,b("bs_caml_obj").caml_equal(g,e)?[e]:[e,g],null);g=b("bs_belt_Map").set(d,c,e);b("gkx")("1074761")||hb(g,a.threadCallbacks.contents);return g},f.threads);p.fetchThreadData(xb,Q);b("bs_curry")._1(V,K);if(R===f.threads)return f;else return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:R,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp}}b("bs_curry")._1(S,J);return f;case 1:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UnsubscribeThread");U=a.threadCallbacks.contents;gb(U,O._0);a.threadCallbacks.contents=U;return f;case 2:H=O._0;Y=b("bs_belt_Array").keepMap(H,function(a){a=E(f,a);if(a!==void 0)return b("bs_caml_option").nullable_to_opt(b("bs_caml_option").valFromOption(a).offline_threading_id)});Y.forEach(function(a){f.localIDsMap["delete"](a)});return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 3:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("MontagePollStickerVoted");var yb=O._0;s=b("bs_js_dict").fromArray(b("bs_js_dict").entries(f.montage));y=yb.montageActorID;X=b("bs_js_dict").get(s,y);if(X!==void 0){P=X.map(function(a){if(b("bs_caml_obj").caml_equal(yb.montageMessageID,a.id)){var c=a.montage_overlays.map(function(a){if(!b("bs_caml_obj").caml_equal(a.poll.id,yb.pollID))return a;var c=a.poll.poll_options.map(function(a,c){if(c===yb.optionVotedIndex)return new(b("ImmutableObject"))({text:a.text,vote_count:a.vote_count+1|0});else return a});c=new(b("ImmutableObject"))({can_viewer_vote:a.poll.can_viewer_vote,id:a.poll.id,poll_options:c,viewer_vote_index:yb.optionVotedIndex});return b("ImmutableObject").set(new(b("ImmutableObject"))(a),{poll:c})});return b("ImmutableObject").set(new(b("ImmutableObject"))(a),{montage_overlays:c})}else return a});s[y]=P}return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:s,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 4:I=b("bs_belt_Map").set(f.threads,O._0,O._1);return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:I,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 5:b("MercuryServerRequests").getForFBID(f.fbid).updateLastActionTimestamp(O._0);return f}case 2:h=g._0;switch(h.TAG|0){case 0:b("bs_curry")._1(h._0,{blocked_ids:f.blockedIds});break;case 1:b("bs_curry")._1(h._1,b("bs_belt_Map").get(f.threads,h._0));break;case 2:b("bs_curry")._1(h._0,f.pinnedThreads.concat([]));break;case 3:b("bs_curry")._2(h._0,f,a);break}return f}},d,c)}function Q(a){var c=[b("MercurySyncEventsProxy").getArbiterTypeForFBID(a,"TYP")];b("FBIDCheck").isUser_deprecated(a)||c.push(b("ChannelConstants").getArbiterType("page_typing"));return c}function R(a){return{fbid:a,deliveryReceipts:void 0,readReceiptsPerThread:void 0,ignoredIds:b("bs_belt_Set").make(b("ParticipantId.bs")),blockedIds:b("bs_belt_Set").make(b("ParticipantId.bs")),pendingFolderUnseenCount:0,typing:void 0,threads:b("bs_belt_Map").make(b("ThreadId.bs")),pendingReadStatusThreads:new Set(),messages:new Map(),localIDsMap:new Map(),messagesWithUploadsInFlight:new Map(),threadlistOrderMap:pa(void 0),pinnedThreads:[],montage:{},orderedMessageLists:new Map(),unreadCounts:{},initialUnreadCounts:{},unseenTimestamp:0}}var S={contents:{}},T={contents:0},U=new Map(),V={contents:{}},W={contents:0},X=new Set(),Y={contents:{}},pb={contents:0},qb={threadCallbacks:S,threadSubToken:T,localTitanMessageCount:U,messageCallbacks:V,messageSubToken:W,existingPinnedThreads:X,failedHistoryFetchThreads:Y,fallbackUnseenCount:pb},rb={contents:0},Z={};function sb(a,c,d){d=c!==void 0?b("bs_caml_option").valFromOption(c):b("RemoteAction.bs").create(void 0);c=b("bs_js_dict").get(Z,a);if(c!==void 0)return;Z[a]={subscriptions:new Set(),state:R(a),remoteAction:d};b("RemoteAction.bs").subscribe(function(c){var d=b("bs_js_dict").get(Z,a);if(d!==void 0){var e=d.state;c=P(qb,c,e);Z[a]={subscriptions:d.subscriptions,state:c,remoteAction:d.remoteAction};if(c===e)return;d=b("bs_js_dict").get(Z,a);d!==void 0?d.subscriptions.forEach(function(a){return b("bs_curry")._1(a.fn,void 0)}):b("recoverableViolation")("Subscriptions deleted after createion","messenger_comet");return}b("recoverableViolation")("State deleted after creation","messenger_comet")},d);var e=b("bs_caml_option").some(a),f=function(a){return $(e,a)},g=function(a){b("bs_curry")._1(f,[{TAG:0,_0:{TAG:5,_0:a}}]),b("setTimeoutAcrossTransitions")(function(a){return b("bs_curry")._1(f,[{TAG:1,_0:0}])},3e4)};b("Arbiter").subscribe(Q(a),function(b,c){b=c.obj;c=b.to;if(!(c==null)&&c.toString()!==a)return;else{g(b);return}})}function $(a,c){a=a!==void 0?b("bs_caml_option").valFromOption(a):b("CurrentUser").getID();sb(a,void 0,void 0);a=b("bs_js_dict").get(Z,a);if(a!==void 0)return b("RemoteAction.bs").send(a.remoteAction,c);else{b("recoverableViolation")("Subscriptions deleted after createion","messenger_comet");return}}function tb(a,c,d,e){var f=a!==void 0?b("bs_caml_option").valFromOption(a):b("CurrentUser").getID();e=c!==void 0?b("bs_caml_option").valFromOption(c):b("RemoteAction.bs").create(void 0);sb(f,b("bs_caml_option").some(e),void 0);a=j.useState(function(){var a=b("bs_js_dict").get(Z,f);if(a!==void 0)return a.state;else return b("unrecoverableViolation")("Rendering without state initialized","messenger_comet")});var g=a[1],h=a[0];c=b("bs_js_dict").get(Z,f);var i=j.useCallback(function(a){a=b("bs_js_dict").get(Z,f);var c=a!==void 0?a.state:b("unrecoverableViolation")("Rendering without state initialized","messenger_comet");if(d!==void 0)if(b("bs_curry")._2(d,h,c))return b("bs_curry")._1(g,function(a){return c});else return;else return b("bs_curry")._1(g,function(a){return c})},[d,h,g,c,f]);j.useEffect(function(){rb.contents=rb.contents+1|0;var a=rb.contents,c={id:a,fn:i};a=b("bs_js_dict").get(Z,f);a!==void 0?a.subscriptions.add(c):b("recoverableViolation")("Subscriptions deleted after createion, can't add subscription","messenger_comet");b("bs_curry")._1(i,void 0);return function(a){a=b("bs_js_dict").get(Z,f);a!==void 0?a.subscriptions["delete"](c):b("recoverableViolation")("Subscriptions deleted after createion, can't remove subscription","messenger_comet")}},[i,f]);return h}function ub(a){var c=a.shouldUpdate,d=a.remoteAction,e=a.fbid;a=a.children;e=e!==void 0?b("bs_caml_option").valFromOption(e):b("CurrentUser").getID();return b("bs_curry")._1(a,tb(b("bs_caml_option").some(e),d,c,void 0))}function vb(a){b("gkx")("1463539")&&b("recoverableViolation")("messenger state is not allowed when lightspeed is enabled","gemini_chat");return tb(b("bs_caml_option").some(a),void 0,void 0,void 0)}function wb(a,c){return $(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:0,_0:c}}])}function xb(a,c){b("MercuryAssert").isThreadID(c);var d={contents:void 0},e=function(a){d.contents=a};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:1,_0:c,_1:e}}]);return b("bs_js_null_undefined").fromOption(d.contents)}function yb(a,c,d,e){if(c.length!==0){b("MercuryAssert").allThreadID(c);var f={contents:null},g=function(a){f.contents=a};$(b("bs_caml_option").some(a),[{TAG:1,_0:{TAG:0,_0:c,_1:g,_2:d,_3:e}}]);return f.contents}b("bs_curry")._1(d,{});return null}function zb(a,c,d,e){return yb(a,[c],function(a){return b("bs_curry")._1(d,a[c])},e)}function Ab(a,c,d,e){var f={contents:void 0},g=function(a){f.contents=a};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:1,_0:c,_1:g}}]);g=f.contents;if(g!==void 0)return b("bs_caml_option").valFromOption(g);g=b("MessengerThreadUtils.bs").createNewLocalThread(b("MercuryIDs").getParticipantIDFromUserID(a),c,d,e);$(b("bs_caml_option").some(a),[{TAG:1,_0:{TAG:4,_0:c,_1:g}}]);return g}function Bb(a){var c=b("MercuryLocalIDs").generateThreadID(null);Ab(a,c,[],null);return c}function Cb(a,c,d,e){var f={contents:void 0},g=function(a){f.contents=a};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:1,_0:c,_1:g}}]);g=f.contents;if(g!==void 0)return b("bs_caml_option").valFromOption(g);g=b("MessengerThreadUtils.bs").createNewLocalGroupGeneralThread(b("MercuryIDs").getParticipantIDFromUserID(a),c,d,e);$(b("bs_caml_option").some(a),[{TAG:1,_0:{TAG:4,_0:c,_1:g}}]);return g}function Db(a,c,d){var e=b("MercuryLocalIDs").generateThreadID(null);Cb(a,e,c,d);return e}function Eb(a,c){var d={contents:void 0},e=function(a){d.contents=a};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:1,_0:c,_1:e}}]);a=d.contents;if(a!==void 0)return b("MercuryThreadInfo").isEmptyLocalThread(b("bs_caml_option").valFromOption(a));else return!1}function Fb(a,c){var d={contents:void 0},e=function(a){d.contents=a};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:1,_0:c,_1:e}}]);a=d.contents;if(a!==void 0)return b("MercuryThreadInfo").isNewEmptyLocalThread(b("bs_caml_option").valFromOption(a));else return!1}function Gb(c){var a={contents:[]},d=function(b){a.contents=b};$(b("bs_caml_option").some(c),[{TAG:2,_0:{TAG:2,_0:d}}]);return a.contents}function Hb(a,c){return $(b("bs_caml_option").some(a),[{TAG:1,_0:{TAG:1,_0:c}}])}function Ib(a){var c=a.payload_source;if(c==null)return!1;if(b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_CHANGE_ARCHIVED_STATUS)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_SEND_MESSAGE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_SEND_MESSAGE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_FETCH_THREADLIST_INFO)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_THREAD_SYNC)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_CHANGE_PINNED_STATUS)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_CHANGE_PINNED_MESSAGES)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_UPDATE_COMM_STATUS))return!0;if(!b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_INITIAL_DATA))return!1;c=a.ordered_threadlists;return!(c==null)}function Jb(a,c){c={TAG:1,_0:{TAG:3,_0:c}};return $(b("bs_caml_option").some(a),[c])}function Kb(a,c){return $(a==null?void 0:b("bs_caml_option").some(a),c)}function Lb(a){var c=[],d=!1;if(!(a==null)){var e=a.payload_source;!(e==null)&&b("bs_caml_obj").caml_equal(e,b("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE)&&(d=!0);e=a.newlyAddedClientIDs;!(e==null)&&Object.keys(e).length>0&&c.push({TAG:0,_0:{TAG:63,_0:e}});e=a.delivery_receipts;e==null||c.push({TAG:0,_0:{TAG:0,_0:e}});e=a.message_ignored_ids;e==null||c.push({TAG:0,_0:{TAG:1,_0:e}});e=a.threads;if(!(e==null)){var f=a.payload_source;f==null||(b("bs_caml_obj").caml_equal(f,b("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO)&&c.push({TAG:0,_0:{TAG:8,_0:e}}),b("bs_caml_obj").caml_equal(f,b("MercuryPayloadSource").SERVER_INVALIDATE_THREAD_STATE)&&e.length>0&&c.unshift({TAG:0,_0:{TAG:34,_0:b("bs_caml_array").get(e,0).thread_id}}));c.push({TAG:0,_0:{TAG:7,_0:e}})}f=a.participants;if(!(f==null)){c.push({TAG:0,_0:{TAG:3,_0:f}});var g=[],h=[];f.forEach(function(a){a.is_messenger_blocked||a.is_facebook_blocked?g.push(b("MercuryIDs").getParticipantIDFromUserID(a.fbid)):h.push(b("MercuryIDs").getParticipantIDFromUserID(a.fbid))});e=0;(g.length!==0||h.length!==0)&&(e=1);e===1&&c.push({TAG:0,_0:{TAG:2,_0:g,_1:h}})}f=a.message_blocked_ids;!(f==null)&&f.length>0&&c.push({TAG:0,_0:{TAG:2,_0:f,_1:[]}});e=a.message_unblocked_ids;!(e==null)&&e.length>0&&c.push({TAG:0,_0:{TAG:2,_0:[],_1:e}});f=a.pending_folder_unseen_count;f==null||c.push({TAG:0,_0:{TAG:4,_0:f}});e=a.global_actions;e==null||e.forEach(function(a){if(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryGlobalActionType").MARK_ALL_READ)){c.push({TAG:0,_0:{TAG:33,_0:a.folder}});return}});if(Ib(a)){f=a.ordered_threadlists;e=0;f==null||f.length===0?e=1:c.push({TAG:0,_0:{TAG:9,_0:f}});if(e===1){f=a.threads;e=a.payload_source;!(f==null)&&!(e==null)&&f.length>0&&e!==b("MercuryPayloadSource").SERVER_CHANGE_PINNED_STATUS&&c.push({TAG:0,_0:{TAG:10,_0:f}})}}e=a.pinned_thread_ids;!(e==null)&&e.length>0&&Ib(a)&&c.push({TAG:0,_0:{TAG:11,_0:e}});f=a.roger;f==null||c.push({TAG:0,_0:{TAG:6,_0:f}});e=a.montage_delete_message_delta;e==null||c.push({TAG:0,_0:{TAG:59,_0:e}});f=a.montage_new_message_delta;f==null||c.push({TAG:0,_0:{TAG:57,_0:f}});e=a.montage_poll_sticker_vote;e==null||e.forEach(function(a){c.push({TAG:1,_0:{TAG:3,_0:a}})});f=a.current_montage_thread;if(!(f==null)){e=f.user;if(!(e==null)){f=e.messenger_montage_thread;f==null||(c.push({TAG:0,_0:{TAG:58,_0:e.id}}),f.montage_messages.edges.forEach(function(a){c.push({TAG:0,_0:{TAG:57,_0:a.node}})}))}}e=a.unread_thread_fbids;e==null||c.push({TAG:0,_0:{TAG:61,_0:e}});f=a.message_counts;f==null||c.push({TAG:0,_0:{TAG:62,_0:f}});e=a.actions;if(!(e==null)){var i=a.payload_source,j=i==null?void 0:b("bs_caml_option").some(i);e.forEach(function(d){var e=d.action_type,f=0;(i==null||!i.startsWith("server"))&&(f=1);f===1&&c.push({TAG:1,_0:{TAG:5,_0:d.timestamp}});if(b("bs_caml_obj").caml_equal(j,b("bs_caml_option").some(b("MercuryPayloadSource").SERVER_SEARCH))){c.push({TAG:0,_0:{TAG:35,_0:d,_1:0}});return}if(b("bs_caml_obj").caml_equal(b("bs_caml_option").nullable_to_opt(d.client_state),b("bs_caml_option").some(b("MercuryMessageClientState").SEND_TO_SERVER))){c.push({TAG:0,_0:{TAG:35,_0:d,_1:0}});return}f=d.thread_id;var g=d.upload_id,h=d.upload_data,k=d.message_ids;ia(d);if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").DELETE_MESSAGES))if(!(f==null)&&!(k==null)){c.push({TAG:0,_0:{TAG:36,_0:f,_1:k,_2:j}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_FOLDER)){k=d.new_folder;if(!(f==null)&&!(k==null)){c.push({TAG:0,_0:{TAG:37,_0:f,_1:k}});return}else return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_ARCHIVED_STATUS))if(!(f==null)){c.push({TAG:0,_0:{TAG:39,_0:f,_1:d.archived}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_MUTE_SETTINGS)){k=d.reactions_mute_mode;var l=d.mentions_mute_mode,m=d.mute_until;l=k==null?l==null?m==null?void 0:{TAG:2,_0:m}:m==null?{TAG:1,_0:l===1}:void 0:!(l==null)||!(m==null)?void 0:{TAG:0,_0:k===1};if(!(f==null)&&l!==void 0){c.push({TAG:0,_0:{TAG:38,_0:f,_1:l}});return}else return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_READ_STATUS)){if(f==null)return;m=a.from_client;c.push({TAG:0,_0:{TAG:41,_0:f,_1:d.mark_as_read,_2:d.timestamp,_3:m==null?!1:m,_4:d.source}});return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_PAGE_FOLLOW_UP_STATUS))if(!(f==null)){c.push({TAG:0,_0:{TAG:40,_0:f,_1:d.is_page_follow_up}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").BLOCK_STATUS_CHANGED)){if(f==null)return;k=d.canViewerReply?null:b("MessengerThreadCannotReplyReason.bs").fromMessageThreadCannotReplyReason(d.reason);c.push({TAG:0,_0:{TAG:13,_0:f,_1:d.canViewerReply,_2:k}});return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").DELETE_THREAD))if(!(f==null)){c.push({TAG:0,_0:{TAG:42,_0:f}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REACTION_UPDATE)){l=d.messageId;m=d.userId;if(!(l==null)&&!(m==null)){c.push({TAG:0,_0:{TAG:45,_0:l,_1:b("bs_caml_option").nullable_to_opt(d.reaction),_2:m,_3:j}});return}else return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").MONTAGE_DIRECT_EXPIRE)){k=d.messageId;if(!(k==null)){c.push({TAG:0,_0:{TAG:46,_0:k,_1:j}});return}else return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").LIVE_LOCATION_UPDATE)){l=d.messageId;m=d.liveLocation;if(!(l==null)&&!(m==null)){c.push({TAG:0,_0:{TAG:47,_0:l,_1:m,_2:j}});return}else return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REPLACE_MESSAGE)){c.push({TAG:0,_0:{TAG:48,_0:d,_1:j}});return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CONFIRM_ATTACHMENT_PLACEHOLDER))if(!(g==null)&&!(h==null)){c.push({TAG:0,_0:{TAG:44,_0:g,_1:h}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CANCEL_ATTACHMENT_PLACEHOLDER))if(!(g==null)&&!(h==null)){c.push({TAG:0,_0:{TAG:43,_0:g,_1:h,_2:j}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").SEND_MESSAGE)){c.push({TAG:0,_0:{TAG:50,_0:d,_1:j}});return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").USER_GENERATED_MESSAGE)){c.push({TAG:0,_0:{TAG:51,_0:d,_1:j,_2:a.from_client}});return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").LOG_MESSAGE))if(!b("MessengerMessage.bs").isLocalMessage(d)){c.push({TAG:0,_0:{TAG:52,_0:d,_1:j,_2:a.from_client}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_PINNED_STATUS))if(!(f==null)){c.push({TAG:0,_0:{TAG:55,_0:f,_1:d.is_pinned,_2:d.thread_pin_timestamp}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").PIN_MESSAGE))if(!(f==null)){c.push({TAG:0,_0:{TAG:53,_0:f,_1:d.pin_message_action}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UNPIN_MESSAGE))if(!(f==null)){c.push({TAG:0,_0:{TAG:54,_0:f,_1:d.unpin_message_action}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REMOVE_MESSAGE)){k=d.thread_id;l=d.messageId;m=d.removed_timestamp;g=d.author;if(!(k==null)&&!(l==null)&&!(m==null)&&!(g==null)){c.push({TAG:0,_0:{TAG:64,_0:k,_1:l,_2:g,_3:m,_4:j}});b("MessengerDesktopNotifications").removeNotification(l);return}else return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UNSUBSCRIBE_STATUS_UPDATE))if(!(f==null)){c.push({TAG:0,_0:{TAG:12,_0:f,_1:d.page_unsubscribe_status}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").BLURRED_IMAGE_STATUS)){h=d.image_message_id;k=d.image_id;g=d.should_show;m=d.blurred_image_uri;if(!(h==null)&&!(k==null)&&!(g==null)&&!(m==null)){c.push({TAG:0,_0:{TAG:69,_0:h,_1:k,_2:g,_3:m,_4:j}});return}else return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").ADD_PARTICIPANTS))if(!(f==null)){c.push({TAG:0,_0:{TAG:14,_0:f,_1:d.participants}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_FLAG))if(!(f==null)){c.push({TAG:0,_0:{TAG:15,_0:f,_1:d.mark_as_flag}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").MOVE_PENDING_TO_INBOX))if(!(f==null)){c.push({TAG:0,_0:{TAG:16,_0:f}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_CUSTOM_LIKE))if(!(f==null)){c.push({TAG:0,_0:{TAG:17,_0:f,_1:d.custom_like}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").PROMOTE_GROUP_ADMINS)){l=d.promoted_admins;if(!(f==null)&&!(l==null)){c.push({TAG:0,_0:{TAG:18,_0:f,_1:l}});return}else return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REMOVE_GROUP_ADMINS)){h=d.removed_admin_ids;if(!(f==null)&&!(h==null)){c.push({TAG:0,_0:{TAG:19,_0:f,_1:h}});return}else return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").JOINABLE_MODE))if(!(f==null)){c.push({TAG:0,_0:{TAG:20,_0:f,_1:d.joinable_mode}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").APPROVAL_MODE))if(!(f==null)){c.push({TAG:0,_0:{TAG:21,_0:f,_1:d.approval_mode}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").APPROVAL_QUEUE))if(!(f==null)){c.push({TAG:0,_0:{TAG:22,_0:f,_1:d.added_id,_2:d.added_group_id,_3:d.removed_id,_4:d.removed_group_id}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").IS_PIN_PROTECTED))if(!(f==null)){c.push({TAG:0,_0:{TAG:23,_0:f,_1:d.is_pin_protected}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_RTC_CALL_DATA))if(!(f==null)){c.push({TAG:0,_0:{TAG:24,_0:f,_1:d.initiator_fbid,_2:d.call_state,_3:d.server_info_data}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_COMM_STATUS))if(!(f==null)){c.push({TAG:0,_0:{TAG:25,_0:f,_1:d.comm_status}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_COMM_ITEM_OWNER))if(!(f==null)){c.push({TAG:0,_0:{TAG:26,_0:f,_1:d.id,_2:d.name,_3:d.profile_pic_uri}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").EVENT_RSVP_CHANGED))if(!(f==null)){c.push({TAG:0,_0:{TAG:27,_0:f,_1:d.actor_fbid,_2:d.rsvp_status}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_CONNECTIVITY_STATUS)){k=d.thread_connectivity_status;if(!(f==null)&&!(k==null)){c.push({TAG:0,_0:{TAG:65,_0:f,_1:k}});return}else return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").GROUPS_SYNC_STATUS_CHANGED))if(!(f==null)){c.push({TAG:0,_0:{TAG:28,_0:f,_1:d.groups_sync_action,_2:d.groups_sync_status_string}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").GROUPS_SYNC_METADATA_UPDATE))if(!(f==null)){c.push({TAG:0,_0:{TAG:29,_0:f,_1:d.groups_sync_action,_2:d.fb_group_id,_3:d.emoji_codepoints}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").DESCRIPTION_CHANGED))if(!(f==null)){c.push({TAG:0,_0:{TAG:30,_0:f,_1:d.group_thread_description_string}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_THREAD_THEME))if(!(f==null)){c.push({TAG:0,_0:{TAG:31,_0:f,_1:{solid_color:d.solid_color,header_color:d.header_color,footer_color:d.footer_color,gradient_colors:d.gradient_colors,theme_id:d.theme_id,reactions:d.reactions}}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_JOINABLE_LINK))if(!(f==null)){c.push({TAG:0,_0:{TAG:32,_0:f,_1:d.joinable_link}});return}else return;if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").MUTATE_TAGS)){g=d.tags_to_add;m=g==null?[]:g;l=d.tags_to_delete;h=l==null?[]:l;k=d.messageId;if(!(k==null)){c.push({TAG:0,_0:{TAG:67,_0:k,_1:m,_2:h,_3:j}});return}else return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").ADS_CONVERSION_UPDATE)){g=d.conversion_detection_data;if(!(f==null)&&!(g==null)){c.push({TAG:0,_0:{TAG:68,_0:f,_1:g}});return}else return}if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").SUGGESTED_REPLY_UPDATE)){l=d.suggested_reply_data;if(!(f==null)&&!(l==null)){c.push({TAG:0,_0:{TAG:70,_0:f,_1:l}});return}else return}if(!b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_SECONDARY_LANGUAGE_BODY))return;k=d.secondary_language_body;m=d.messageId;if(!(k==null)&&!(m==null)){c.push({TAG:0,_0:{TAG:71,_0:m,_1:k,_2:j}});return}});b("Utils.bs").isTruthy(a.from_client)&&e.forEach(function(a){var b=a.thread_id;if(!(b==null)){c.push({TAG:0,_0:{TAG:49,_0:b,_1:a.message_id}});return}})}f=a.end_of_history;f==null||c.push({TAG:0,_0:{TAG:60,_0:f,_1:a.payload_source}})}d&&c.unshift({TAG:0,_0:0});return c}function Mb(c,d){var a={contents:[]},e=function(b,c){c=b.orderedMessageLists.get(d);if(!(c==null)){a.contents=F(!0,b,c.messageIDs);return}};$(b("bs_caml_option").some(c),[{TAG:2,_0:{TAG:3,_0:e}}]);return a.contents}function Nb(c,d){var a={contents:d},e=function(b,c){c=b.localIDsMap.get(d);if(!(c==null)){a.contents=c;return}};$(b("bs_caml_option").some(c),[{TAG:2,_0:{TAG:3,_0:e}}]);return a.contents}function Ob(a,c){var d={contents:void 0},e=function(a,b){d.contents=a};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:3,_0:e}}]);a=d.contents;if(a!==void 0)return F(!1,a,c);else return[]}function Pb(a,c){var d={contents:void 0},e=function(a,b){d.contents=a};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:3,_0:e}}]);a=d.contents;if(a!==void 0)return b("bs_caml_option").nullable_to_opt(a.messages.get(c))}function Qb(a,c,d){var e={contents:!1},f=function(a,b){b=a.orderedMessageLists.get(c);if(b==null)return;a=b.messageLoadingState;b=b.messageIDs.length;a?e.contents=!0:e.contents=b>=d};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:3,_0:f}}]);return e.contents}function Rb(a,c){var d={contents:!1},e=function(a,b){b=a.orderedMessageLists.get(c);if(b==null)return;a=b.messageLoadingState;a?d.contents=!0:d.contents=!1};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:3,_0:e}}]);return d.contents}function Sb(a,c){return $(b("bs_caml_option").some(a),[{TAG:1,_0:{TAG:2,_0:c}}])}function Tb(a,c,d,e){var f=[],g=function(g,h){h=g.orderedMessageLists.get(c);if(h==null)return;h=h.messageIDs;for(var i=d,j=d+e|0;i<=j;++i){var a=b("bs_belt_Option").flatMap(b("bs_belt_Array").get(h,i),function(a){return E(g,a)});a!==void 0&&f.push(b("bs_caml_option").valFromOption(a))}};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:3,_0:g}}]);return f}var Ub={contents:void 0};function Vb(a,c,d,e,f,g,h){var i=function(j,i){Ub.contents=[c,d,e];var k=j.orderedMessageLists.get(c);k=k==null?[[],void 0]:[k.messageIDs,k.messageLoadingState];var l=k[0];if(b("bs_js_dict").get(i.failedHistoryFetchThreads.contents,c)!==!0){var m=l.length-b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(i.localTitanMessageCount.get(c)),0)|0;m>0&&b("ChatReliabilityInstrumentation").logERROR("fetch made with message in flight");var n=m-d|0;n=e-n|0;if(!(n>0&&b("bs_caml_obj").caml_notequal(k[1],1)))return b("bs_curry")._1(f,b("bs_belt_Array").keepMap(l,function(a){return E(j,a)}).slice(d,e));k=b("MercuryServerRequests").getForFBID(a);l=b("bs_js_null_undefined").fromOption(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_belt_Array").get(l,m-1|0),function(a){return E(j,a)}),function(a){return a.timestamp}));var o=i.messageSubToken.contents;i.messageSubToken.contents=o+1|0;i.messageCallbacks.contents[String(o)]=[{threadID:c,offset:d,limit:e},f];if(b("bs_caml_obj").caml_equal([c,d,e],Ub.contents)){k.fetchThreadMessages(c,m,n,l,g,h);return}else return}Ub.contents=void 0;i.failedHistoryFetchThreads.contents[c]=!1};return $(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:3,_0:i}}])}function Wb(a,b,c,d,e,f,g){if(!Rb(a,b))return Vb(a,b,c,d,e,f,g)}function Xb(a){var c={contents:0},d=function(d,a){c.contents=b("bs_caml").caml_int_min(O(d,a),b("MercuryThreadlistConstants").MAX_UNSEEN_COUNT)};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:3,_0:d}}]);return c.contents}function Yb(a){var c={contents:0},d=function(b,a){c.contents=O(b,a)};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:3,_0:d}}]);return c.contents}function Zb(a){var c={contents:0},d=function(d,a){c.contents=b("bs_caml").caml_int_min(nb(d,a,!0),b("MercuryThreadlistConstants").MAX_UNSEEN_COUNT)};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:3,_0:d}}]);return c.contents}function $b(a){return $(b("bs_caml_option").some(a),[{TAG:1,_0:1}])}function ac(a,c){var d={contents:null},e=function(a,e){e=b("bs_js_dict").get(a.unreadCounts,c);d.contents=e!==void 0?b("bs_belt_Array").keepMap(b("JSSet.bs").values(b("bs_caml_option").valFromOption(e)),function(c){return b("bs_caml_option").nullable_to_opt(m(a,c))}).filter(function(a){var c=!b("MercuryThreadInfo").isMuted(a);if(b("gkx")("1696"))return c;else if(c)return a.unread_count>0;else return!1}).length:null};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:3,_0:e}}]);return d.contents}function bc(a){var c={contents:[]},d=function(a,d){c.contents=b("bs_belt_Map").keysToArray(a.threads)};$(b("bs_caml_option").some(a),[{TAG:2,_0:{TAG:3,_0:d}}]);return c.contents}S={make:ub};T=ub;f.irisMapping=k;f.fbid=c;f.deliveryReceipts=d;f.readReceiptsPerThread=e;f.ignoredIds=n;f.blockedIds=o;f.pendingFolderUnseenCount=p;f.typing=aa;f.pendingReadStatusThreads=q;f.messages=r;f.localIDsMap=s;f.messagesWithUploadsInFlight=ba;f.threadlistOrderMap=ca;f.pinnedThreads=t;f.montage=da;f.orderedMessageLists=ea;f.unreadCounts=fa;f.initialUnreadCounts=ga;f.unseenTimestamp=ha;f.threads=a;f.thread=m;f.send=$;f.compute=wb;f.getThreadMetaNow=xb;f.getMultiThreadMeta=yb;f.getThreadMeta=zb;f.createNewLocalThread=Ab;f.createNewLocalThreadGenerateID=Bb;f.createNewLocalGroupGeneralThreadGenerateID=Db;f.isEmptyLocalThread=Eb;f.isNewEmptyLocalThread=Fb;f.getPinnedThreadlist=Gb;f.unsubscribeThread=Hb;f.sendJS=Kb;f.invalidateSearchedMessages=Sb;f.hasLoadedNMessages=Qb;f.hasLoadedAllMessages=Rb;f.getCurrentlyLoadedMessages=Mb;f.getServerMessageID=Nb;f.getMessagesFromIDs=Ob;f.getMessageFromID=Pb;f.getThreadMessagesRange=Vb;f.getThreadMessagesRangeNow=Tb;f.fetchMoreMessages=Wb;f.processPollStickerVoted=Jb;f.getUnseenUnreadCount=Xb;f.getUnseenUnreadCountRaw=Yb;f.getUnseenCount=Zb;f.getThreadIDs_debug=bc;f.getUnreadThreadCount=ac;f.markAsSeen=$b;f.processJSActions=Lb;f.Provider=S;f.jsComponent=T;f.useHook=vb}),null);
__d("MessengerState.re",["MessengerState.bs","bs_curry"],(function(a,b,c,d,e,f){c=(a=b("MessengerState.bs")).fbid;f.fbid=c;d=a.deliveryReceipts;f.deliveryReceipts=d;e=a.readReceiptsPerThread;f.readReceiptsPerThread=e;c=a.ignoredIds;f.ignoredIds=c;d=a.blockedIds;f.blockedIds=d;e=a.pendingFolderUnseenCount;f.pendingFolderUnseenCount=e;c=a.typing;f.typing=c;d=a.pendingReadStatusThreads;f.pendingReadStatusThreads=d;e=a.messages;f.messages=e;c=a.localIDsMap;f.localIDsMap=c;d=a.messagesWithUploadsInFlight;f.messagesWithUploadsInFlight=d;e=a.threadlistOrderMap;f.threadlistOrderMap=e;c=a.pinnedThreads;f.pinnedThreads=c;d=a.montage;f.montage=d;e=a.orderedMessageLists;f.orderedMessageLists=e;c=a.unreadCounts;f.unreadCounts=c;d=a.initialUnreadCounts;f.initialUnreadCounts=d;e=a.unseenTimestamp;f.unseenTimestamp=e;c=a.threads;f.threads=c;d=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").thread,a,c);return a};f.thread=d;e=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").compute,a,c);return a};f.compute=e;c=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getThreadMetaNow,a,c);return a};f.getThreadMetaNow=c;d=function(a,c,d,e){a=b("bs_curry")._4(b("MessengerState.bs").getMultiThreadMeta,a,c,d,e);return a};f.getMultiThreadMeta=d;e=function(a,c,d,e){a=b("bs_curry")._4(b("MessengerState.bs").getThreadMeta,a,c,d,e);return a};f.getThreadMeta=e;c=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").isEmptyLocalThread,a,c);return a};f.isEmptyLocalThread=c;d=a.getPinnedThreadlist;f.getPinnedThreadlist=d;e=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").unsubscribeThread,a,c);return a};f.unsubscribeThread=e;c=function(a,c,d){a=b("bs_curry")._3(b("MessengerState.bs").hasLoadedNMessages,a,c,d);return a};f.hasLoadedNMessages=c;d=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getCurrentlyLoadedMessages,a,c);return a};f.getCurrentlyLoadedMessages=d;e=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getServerMessageID,a,c);return a};f.getServerMessageID=e;c=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getMessagesFromIDs,a,c);return a};f.getMessagesFromIDs=c;d=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getMessageFromID,a,c);return a};f.getMessageFromID=d;e=function(a,c,d,e,f,g,h){a=b("bs_curry")._7(b("MessengerState.bs").getThreadMessagesRange,a,c,d,e,f,g,h);return a};f.getThreadMessagesRange=e;c=function(a,c,d,e){a=b("bs_curry")._4(b("MessengerState.bs").getThreadMessagesRangeNow,a,c,d,e);return a};f.getThreadMessagesRangeNow=c;d=function(a,c,d,e,f,g,h){a=b("bs_curry")._7(b("MessengerState.bs").fetchMoreMessages,a,c,d,e,f,g,h);return a};f.fetchMoreMessages=d;e=a.getUnseenUnreadCount;f.getUnseenUnreadCount=e;c=a.getUnseenCount;f.getUnseenCount=c;d=a.getThreadIDs_debug;f.getThreadIDs_debug=d;e=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getUnreadThreadCount,a,c);return a};f.getUnreadThreadCount=e;c=a.jsComponent;f.jsComponent=c;d=a.useHook;f.useHook=d}),null);
__d("MercuryDelayedDispatcher",["MercuryDispatcher","MercuryServerPayloadPreprocessor","MercuryServerRequests","MercurySingletonProvider","MercuryThreadIDMap"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){var b=this;this.$1=a;this.$2=[];this.$3=c("MercuryThreadIDMap").getForFBID(this.$1);this.$4=c("MercuryDispatcher").getForFBID(this.$1);this.$5=c("MercuryServerRequests").getForFBID(this.$1);this.$6=c("MercuryServerPayloadPreprocessor").getForFBID(this.$1);this.$4.subscribe("model-update-completed",function(a,c){return b.$7()})}a.getForFBID=function(a){return h.getForFBID(a)};a.get=function(){return h.get()};var b=a.prototype;b.handleUpdateWaitForThread=function(a,b){var c=this,d=this.$3.getClientIDFromServerIDNow(b);if(d){this.$8(a);return}this.$3.getClientIDFromServerID(b,function(){return c.$2.push({thread_fbid:b,payload:a})});this.$5.ensureThreadIsFetched(b)};b.$7=function(){if(this.$2&&this.$2.length){var a=this.$2.shift(),b=a.thread_fbid;a=a.payload;this.handleUpdateWaitForThread(a,b)}};b.$8=function(a){a.from_client?this.$4.handleUpdate(a):this.$6.handleUpdate(a)};return a}();var h=new(c("MercurySingletonProvider"))(a);g["default"]=a}),98);
__d("MercuryDispatcher",["invariant","ArbiterMixin","LogHistory","MercuryMessagingLightswitch","MercurySingletonProvider","MercuryThreadInformer","MessengerParticipants.bs","MessengerState.bs","gkx","isEmpty","mixin"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("LogHistory").getInstance("mercury_dispatcher");a=function(a){babelHelpers.inheritsLoose(b,a);b.getForFBID=function(a){return j.getForFBID(a)};b.get=function(){return j.get()};function b(b){var c;c=a.call(this)||this;c.$MercuryDispatcher1=b;return c}var e=b.prototype;e.handlePreprocessedUpdate=function(a){a.preprocessed=!0,this.handleUpdate(a)};e.handleUpdate=function(a){var b=this;this.$MercuryDispatcher2(a);!!a.from_client!==!!a.preprocessed||h(0,5757);delete a.preprocessed;c("isEmpty")(a)||c("MercuryThreadInformer").getForFBID(this.$MercuryDispatcher1).synchronizeInforms(function(){a.payload_source==="server_invalidate_global_state"&&(b.inform("invalidate-global-state",{}),d("MessengerParticipants.bs").reset());if(a.payload_source==="server_invalidate_thread_state"){var e=a.threads&&a.threads.length>0&&a.threads[0]&&a.threads[0].thread_id;e&&b.inform("invalidate-thread-state",e)}a.threads&&Array.isArray(a.threads)&&a.threads.length>0&&c("gkx")("1443200")&&d("MessengerParticipants.bs").addPreloadedParticipants(a.threads[0]);d("MessengerParticipants.bs").addParticipants(a);d("MessengerState.bs").sendJS(b.$MercuryDispatcher1,d("MessengerState.bs").processJSActions(a));b.inform("update-threadlist",a);b.inform("update-messages",a);b.inform("model-update-completed",null)})};e.$MercuryDispatcher2=function(a){var b=a.payload_source;if(b==="client_change_read_status"||b==="client_mark_thread_seen")return;var d={from_client:a.from_client,messages:null};if(a.actions){a=a.actions.filter(function(a){return a.action_type==="ma-type:user-generated-message"||a.action_type==="ma-type:log-message"}).map(function(a){return{action_type:a.action_type,other_user_fbid:a.other_user_fbid,thread_fbid:a.thread_fbid,message_id:a.message_id}});a.length&&(d.messages=a)}c("MercuryMessagingLightswitch").guard(function(){i.debug("update:"+b,JSON.stringify(d))})};return b}(c("mixin")(d("ArbiterMixin")));var j=new(c("MercurySingletonProvider"))(a);g["default"]=a}),98);
__d("MercurySendErrorLogger",["Banzai","BanzaiLogger","MercuryMessagingLightswitch"],(function(a,b,c,d,e,f,g){var h=c("BanzaiLogger").create({retry:!0}),i=c("Banzai").isEnabled("mercury_send_error_logging");a={log:function(a){if(!i)return;c("MercuryMessagingLightswitch").guard(function(){var b={message_id:a.message_id,timestamp_client:Date.now(),error_type:a.error_data.type,error_code:a.error_data.code,error_description:a.error_data.description,is_transient:a.error_data.is_transient};h.log("MercurySendErrorLoggerConfig",b)})}};b=a;g["default"]=b}),98);
__d("MercuryServerPayloadPreprocessor",["invariant","ChatReliabilityInstrumentation","LogHistory","MercuryAttachment","MercuryDispatcher","MercuryIDs","MercuryMessagingLightswitch","MercurySendErrorLogger","MercurySingletonProvider","MercuryThreadIDMap","MessengerEnvironment","MessengerState.re","URI","gkx"],(function(a,b,c,d,e,f,g,h){"use strict";a=function(){function a(a){this.$4=d("LogHistory").getInstance("MercuryServerPayloadPreprocessor"),this.$1=a,this.$2=c("MercuryThreadIDMap").getForFBID(this.$1),this.$3=c("MercuryDispatcher").getForFBID(this.$1)}a.getForFBID=function(a){return i.getForFBID(a)};a.get=function(){return i.get()};var b=a.prototype;b.handleUpdate=function(a){var b=this,f={};a.from_client&&h(0,2150);(a.threads||[]).forEach(function(a){b.$5(a,f);var c=b.$2.getServerIDFromClientIDNow(a.thread_id);e(["MercuryServerRequests"],function(d){d=d.getForFBID(b.$1);d.markThreadFetched(a.thread_id);c&&d.markThreadFetched(c);d.updateLastActionTimestamp(a.timestamp)})});a.pinned_thread_ids=(a.pinned_thread_ids||[]).map(function(a){return b.$2.getClientIDFromServerIDNow(a)});(a.ordered_threadlists||[]).forEach(function(a){var c=a.thread_fbids||[];c=c.concat(a.other_user_fbids||[]);a.thread_ids=c.map(function(a){return b.$2.getClientIDFromServerIDNow(a.toString())})});if(a.delivery_receipts){var g={};for(var i=a.delivery_receipts,j=Array.isArray(i),k=0,i=j?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var l;if(j){if(k>=i.length)break;l=i[k++]}else{k=i.next();if(k.done)break;l=k.value}l=l;var m=l.other_user_fbid?d("MercuryIDs").getThreadIDFromUserID(l.other_user_fbid):this.$2.getClientIDFromServerIDNow(l.thread_fbid);m&&(g[m]=l.time)}a.delivery_receipts=g}a.actions=a.actions||[];a.actions.forEach(function(g){g.action_type==="ma-type:send-message"&&g.status===10&&c("MercuryMessagingLightswitch").guard(function(){c("MercurySendErrorLogger").log(g)});var i=null,j=null;g.other_user_fbid?(j=d("MercuryIDs").getThreadIDFromUserID(g.other_user_fbid),i=g.other_user_fbid):g.thread_fbid?(j=d("MercuryIDs").getThreadIDFromThreadFBID(g.thread_fbid),i=g.thread_fbid):g.thread_id?(j=d("MercuryIDs").getThreadIDFromThreadFBID(g.thread_id),i=g.thread_id):g.status&&g.status!=1&&g.client_thread_id?j=g.client_thread_id:h(0,2151,g.action_type,g.status);i=i&&i.toString();g.thread_id=b.$2.hasClientIDForServerID(i)?b.$2.getClientIDFromServerIDNow(i):j;g.action_type=="ma-type:send-message"&&g.client_thread_id&&i&&(g.thread_id=g.client_thread_id,b.$6("forceSetServerIDToClientID",i,g.client_thread_id)&&d("ChatReliabilityInstrumentation").logSET_THREAD_ID_MAP(i+":"+g.client_thread_id),b.$2.forceSetServerIDToClientID(i,g.client_thread_id),f[i]=g.client_thread_id);g.thread_id||h(0,2152,g.action_type);(!a.payload_source||!a.payload_source.startsWith("server"))&&e(["MercuryServerRequests"],function(a){a.getForFBID(b.$1).updateLastActionTimestamp(g.timestamp)})});this.$7(a);this.$8(a);if(a.end_of_history){m=[];for(var l=0;l<a.end_of_history.length;l++){k=a.end_of_history[l];k.type=="user"?m.push("user:"+k.fbid):k.type=="thread"&&this.$2.hasClientIDForServerID(k.fbid)&&m.push(this.$2.getClientIDFromServerIDNow(k.fbid))}a.end_of_history=m}if(a.roger){var n={};Object.keys(a.roger).forEach(function(c){var e=Object.keys(a.roger[c]),f;c?f=b.$2.getClientIDFromServerIDNow(c):e.length===1&&(f=d("MercuryIDs").getThreadIDFromUserID(e[0]));if(f){e=a.roger[c];n[f]={};for(var g in e)if(Object.prototype.hasOwnProperty.call(e,g)){c=d("MercuryIDs").getParticipantIDFromUserID(g);n[f][c]=e[g]}}});a.roger=n}a.newlyAddedClientIDs=f;a.preprocessed=!0;this.$3.handleUpdate(a)};b.$6=function(a,b,e){var f=this;if(!c("gkx")("1199097"))return;var g=d("MessengerState.re").getThreadMetaNow(this.$1,e);if(g==null){c("MercuryMessagingLightswitch").guard(function(){f.$4.debug(a,b+":"+e)});return!0}return!1};b.$5=function(a,b){var c=a.other_user_fbid?a.other_user_fbid:a.thread_fbid;c||h(0,2153);var e=this.$2.getClientIDFromServerIDNow(c);e||(e=a.other_user_fbid?d("MercuryIDs").getThreadIDFromUserID(a.other_user_fbid):d("MercuryIDs").getThreadIDFromThreadFBID(a.thread_fbid),this.$6("setServerIDToClientID",c,e),this.$2.setServerIDToClientID(c,e),this.$2.setDeprecatedServerIDToClientID(a.thread_id,e),b[c]=e);a.thread_id=e};b.$7=function(a){a.actions.forEach(function(a){a.action_type==="ma-type:user-generated-message"&&(a.attachments=a.attachments||[],a.attachments.forEach(function(a){if(d("MercuryAttachment").isShareAttachment(a)&&a.share&&c("MessengerEnvironment").messengerui){var b=new(c("URI"))(a.share.uri);b.getDomain()||(a.share.uri=b.setDomain("facebook.com").setSubdomain(c("URI").getRequestURI().getSubdomain()).setProtocol("https").toString())}}))})};b.$8=function(a){a.actions.forEach(function(a){if(a.action_type!=="ma-type:user-generated-message")return;a=a;if(!a.has_attachment||!a.attachments)return;for(var b=a.attachments.length-1;b>=0;b-=1){var c=a.attachments[b];if(!c.share||!c.share.style_list||c.share.style_list[0]!="genie_message")continue;c.share.target.genie_id&&(a.author=d("MercuryIDs").getParticipantIDFromUserID(c.share.target.genie_id));c.share.target&&!c.share.target.attachment&&(a.attachments.splice(b,1),a.has_attachment=a.attachments.length>0)}})};return a}();var i=new(c("MercurySingletonProvider"))(a);g["default"]=a}),98);
__d("MercuryServerSendMessageQueueOptions",[],(function(a,b,c,d,e,f){a=function(a,b,c,d,e,f){this.success_handler=a,this.error_handler=b,this.transport_error_handler=c,this.timeout_handler=d,this.timeout=e,this.connection_retries=f};f["default"]=a}),66);
__d("MercurySyncDeltaHolder",["MercurySingletonProvider"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$2=new Map(),this.$3=[],this.$1=0}a.getForFBID=function(a){return h.getForFBID(a)};a.get=function(){return h.get()};var b=a.prototype;b.peek=function(){this.$3=this.$3.sort(function(a,b){return a-b});return this.$3[0]};b.getTop=function(){this.$3=this.$3.sort(function(a,b){return a-b});return this.$3.reverse()[0]};b.pop=function(){this.$3=this.$3.sort(function(a,b){return a-b});if(this.$3.length===0)return void 0;var a=this.$3.shift(),b=this.$2.get(a);this.$2["delete"](a);return{seqID:a,delta:b}};b.push=function(a,b){if(this.$2.has(a))return;this.$2.set(a,b);this.$3.push(a)};b.getLastSeqID=function(){return this.$1};b.updateLastSeqID=function(a){this.$1=a};b.updateLastSeqIDAndClearHistory=function(a){this.$2=new Map(),this.$3=[],this.$1=a};return a}();var h=new(c("MercurySingletonProvider"))(a);g["default"]=a}),98);
__d("XMercuryUnseenThreadIDsController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/mercury/unseen_thread_ids/",{})}),null);
__d("XMessagingChangeMentionsMuteModeController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/ajax/mercury/change_mentions_mute_thread/",{})}),null);
__d("XMessagingChangeReactionsMuteModeController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/ajax/mercury/change_reactions_mute_thread/",{})}),null);
__d("MercuryServerRequests",["errorCode","invariant","Arbiter","AsyncResponse","AvailableListConstants","Bootloader","ChannelConstants","ChatReliabilityInstrumentation","CurrentUser","Env","LogHistory","MercuryAPIArgsSource","MercuryAssert","MercuryDispatcher","MercuryIDs","MercuryMessageClientState","MercuryMessageIDs.bs","MercuryMessagingLightswitch","MercurySendErrorLogger","MercuryServerDispatcher","MercuryServerPayloadPreprocessor","MercuryServerRequestsConfig","MercuryServerSendMessageQueueOptions","MercuryServerSendMessageQueueRouter","MercuryServerURIs","MercurySingletonProvider","MercurySyncDeltaHolder","MercuryTagHelper","MercuryThreadIDMap","MessagingConfig","MessagingTag","MessengerEnvironment","MessengerWebEventsFalcoEvent","ODS","PresenceStatus","Promise","ScriptPath","XMercuryUnseenThreadIDsController","XMessagingChangeMentionsMuteModeController","XMessagingChangeReactionsMuteModeController","createObjectFrom","gkx","promiseDone","qpl","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("LogHistory").getInstance("mercury_server"),k=30*1e3;function l(a){return a.getError()?"_"+a.getError():""}function m(a,b){var d=babelHelpers["extends"]({},a),e;if(b.threads){d.threads||(d.threads={});for(e in b.threads)d.threads[e]=Object.keys(c("createObjectFrom")((d.threads[e]||[]).concat(b.threads[e]||[])))}if(b.messages){d.messages||(d.messages={});for(e in b.messages){d.messages[e]||(d.messages[e]={});for(var f in b.messages[e])d.messages[e][f]?d.messages[e][f]=q(d.messages[e][f],b.messages[e][f]):d.messages[e][f]=b.messages[e][f]}}d.client=a.client||b.client;return d}function n(a,b){var d=Object.assign(c("createObjectFrom")(a.folders,!0),c("createObjectFrom")(b.folders,!0));a=a.client||b.client;return{folders:Object.keys(d),client:a}}function o(a,b){for(var c in b)if(a[c]&&typeof a[c]==="object")a[c]=q(a[c],b[c]);else if(b[c]&&typeof b[c]==="object"){var d={};Object.assign(d,b[c]);a[c]=d}return a}function p(a,b){return b}function q(a,b){var c=Math.max(a.limit,b.limit),d;!a.timestamp?d=b.timestamp:!b.timestamp?d=a.timestamp:d=Math.min(a.timestamp,b.timestamp);return{limit:c,timestamp:d}}function r(a,b){var c=a.client||b.client;c={ids:{},client:c};Object.assign(c.ids,a.ids,b.ids);return c}function s(a,b){var d={},e,f=a.client||b.client;delete a.client;delete b.client;for(e in a)Object.assign(d,c("createObjectFrom")(a[e],e));for(e in b)Object.assign(d,c("createObjectFrom")(b[e],e));a={client:f};for(var g in d)e=d[g],a[e]||(a[e]=[]),a[e].push(g);return a}function t(a,b){var d=a.client||b.client;a=c("createObjectFrom")(a.ids,!0);b=c("createObjectFrom")(b.ids,!0);a=Object.assign(a,b);return{ids:Object.keys(a),client:d}}a=function(){function a(a){var b=this;this.$1=a;this.$2=0;this.$3={};this.$4={};this.__threadIDMap=c("MercuryThreadIDMap").getForFBID(this.$1);this.$5=c("MercuryDispatcher").getForFBID(this.$1);this.$6=c("MercuryServerPayloadPreprocessor").getForFBID(this.$1);this.$7=new(c("MercuryServerSendMessageQueueOptions"))(function(a,c){b.__handleUpdate(a,c)},function(a){return b.$9(a)},function(a){b.$10(a)},function(a){return b.$11(a)},d("MercuryServerRequestsConfig").sendMessageTimeout,d("MessagingConfig").SEND_CONNECTION_RETRIES);this.$8=c("MercurySyncDeltaHolder").getForFBID(this.$1);this.$12()}a.getForFBID=function(a){return u.getForFBID(a)};a.get=function(){return u.get()};var e=a.prototype;e.fetchThreadlistInfo=function(a,b,e,f,g,h){e===void 0&&(e=c("MessagingTag").INBOX);g===void 0&&(g=c("MercuryAPIArgsSource").MERCURY);var i=f?d("MercuryServerDispatcher").IMMEDIATE:null;g={client:g};g[e]={offset:a,limit:b,filter:f,before:h};this.__sendRequest(d("MercuryServerURIs").THREADLIST_INFO,g,i)};e.fetchUnseenThreadIDs=function(a,b){a===void 0&&c("MessagingTag").INBOX,b===void 0&&(b=c("MercuryAPIArgsSource").MERCURY),this.__sendRequest(c("XMercuryUnseenThreadIDsController").getURIBuilder().getURI().toString(),{})};e.fetchUnreadThreadIDs=function(a,b){b===void 0&&(b=c("MercuryAPIArgsSource").MERCURY),this.__sendRequest(d("MercuryServerURIs").UNREAD_THREADS,{folders:[a],client:b})};e.fetchThreadData=function(a,b){var e=this;b===void 0&&(b=c("MercuryAPIArgsSource").MERCURY);d("MercuryAssert").allThreadID(a);var f={threads:{},client:b},g=[],h=[];a.forEach(function(a){if(e.$3[a])return;e.$3[a]=!0;var b=e.__threadIDMap.getServerIDFromClientIDNow(a);a=d("MercuryIDs").tokenize(a);if(a.type=="user")g.push(a.value),f.threads.user_ids=g;else if(a.type=="thread")b?h.push(b):h.push(a.value),f.threads.thread_fbids=h;else if(a.type=="root")b&&(h.push(b),f.threads.thread_fbids=h);else if(a.type!="pending")throw new Error("Unknown thread type",a)});f.threads.user_ids&&f.threads.user_ids.forEach(function(a){a||(c("MercuryMessagingLightswitch").guard(function(){j.error("empty user id",JSON.stringify(g))}),d("ChatReliabilityInstrumentation").logERROR("Invalid user ID sent to thread_info.php: "+JSON.stringify(g)))});f.threads.thread_fbids&&f.threads.thread_fbids.forEach(function(b){b||d("ChatReliabilityInstrumentation").logERROR("Invalid FBID sent to thread_info.php: "+JSON.stringify(a))});for(var i in f.threads){this.__sendRequest(d("MercuryServerURIs").THREAD_INFO,f);break}};e.ensureThreadIsFetched=function(a,b){b===void 0&&(b=c("MercuryAPIArgsSource").MERCURY);if(!this.__threadIDMap.getClientIDFromServerIDNow(a)&&!this.$3[a]){if(!a){d("ChatReliabilityInstrumentation").logERROR("Ensure invalid FBID sent to thread_info.php");j.error("attempting to fetch empty thread_fbid. Bad idea!");return}this.$3[a]=!0;this.__sendRequest(d("MercuryServerURIs").THREAD_INFO,{threads:{thread_fbids:[a]},client:b})}};e.fetchThreadMessages=function(a,b,e,f,g,h){var i=this;h===void 0&&(h=c("MercuryAPIArgsSource").MERCURY);d("MercuryAssert").isThreadID(a);var j;b=d("MercuryIDs").tokenize(a);var k=this.__threadIDMap.getServerIDFromClientIDNow(a),l=!1;if(k)k=k,j=b.type=="user"?"user_ids":"thread_fbids";else{k=b.value;switch(b.type){case"user":j="user_ids";l=!0;break;case"thread":j="thread_fbids";break}}var m={messages:{},threads:{},client:h};j?(m.messages[j]={},m.messages[j][k]={timestamp:f,limit:e},l&&(m.threads[j]=[k]),this.__sendRequest(d("MercuryServerURIs").THREAD_INFO,m,g)):this.__threadIDMap.getServerIDFromClientID(a,function(a){m.messages.thread_fbids={},m.messages.thread_fbids[a]={timestamp:f,limit:e},i.__sendRequest(d("MercuryServerURIs").THREAD_INFO,m,g)})};e.handleThreadInfoError=function(a,b){var e=a.getData();b=[];if(e.messages&&!c("gkx")("1738138")){for(var f in e.messages.thread_fbids){a=this.__threadIDMap.getClientIDFromServerIDNow(f);a&&b.push(this.$13(a))}for(var g in e.messages.user_ids)b.push(this.$13("user:"+g));for(var h in e.messages.group_ids)b.push(this.$13("group:"+h))}b.length&&this.$5.handleUpdate({actions:b,from_client:!0,payload_source:"client_channel_message"});if(e.threads&&(e.threads.user_ids||e.threads.thread_fbids||e.threads.group_ids||e.threads.thread_ids)){a=5;b=!0;e.retry_count||(e.retry_count=0,e.messages&&delete e.messages);if(b){b=Math.pow(2,Math.min(e.retry_count,a))*1e3;c("setTimeoutAcrossTransitions")(function(){j.log("retry_thread","{}"),this.__sendRequest(d("MercuryServerURIs").THREAD_INFO,e)}.bind(this),b);e.retry_count++}}};e.markFolderAsRead=function(a){this.__sendRequest(d("MercuryServerURIs").MARK_FOLDER_READ,{folder:a});a=[{action_type:"mga-type:mark-all-read",folder:a}];this.$5.handleUpdate({global_actions:a,from_client:!0,payload_source:"client_change_read_status"})};e.changeThreadReadStatus=function(a,b,e,f,g,h){var i=this;d("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(k){var l;l={ids:(l={},l[k]=b,l),source:e,watermarkTimestamp:f,shouldSendReadReceipt:g,commerce_last_message_type:h};c("MercuryMessagingLightswitch").guard(function(){j.log("initiate_change_read_status",JSON.stringify({thread_id:a,thread_fbid:k,mark_as_read:b,watermarkTimestamp:f}))});i.__sendRequest(d("MercuryServerURIs").CHANGE_READ_STATUS,l)})};e.changeThreadArchivedStatus=function(a,b,c){var e=this;d("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){var f={ids:{},source:c};f.ids[a]=b;e.__sendRequest(d("MercuryServerURIs").CHANGE_ARCHIVED_STATUS,f)})};e.changeThreadPinnedStatus=function(a,b,c){var e=this;d("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){var f={ids:{},source:c};f.ids[a]=b;e.__sendRequest(d("MercuryServerURIs").CHANGE_PINNED_STATUS,f)})};e.changeThreadPageFollowUpStatus=function(a,b,c){var e=this;d("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){var f={ids:{},source:c};f.ids[a]=b;e.__sendRequest(d("MercuryServerURIs").CHANGE_PAGE_FOLLOW_UP_STATUS,f)})};e.changeThreadFolder=function(a,b){var c=this;d("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){var e={};e[b]=[a];c.__sendRequest(d("MercuryServerURIs").MOVE_THREAD,e)})};e.changeMutingOnThread=function(a,b){var e=this;d("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){e.__sendRequest(d("MercuryServerURIs").CHANGE_MUTE_THREAD,{thread_fbid:a,mute_settings:b,payload_source:c("MercuryAPIArgsSource").MERCURY})})};e.changeMentionsMutingOnThread=function(a,b){var e=this;d("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){e.__sendRequest(c("XMessagingChangeMentionsMuteModeController").getURIBuilder().getURI(),{thread_fbid:a,mentions_mute_mode:b,payload_source:c("MercuryAPIArgsSource").MERCURY})})};e.changeReactionsMutingOnThread=function(a,b){var e=this;d("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){e.__sendRequest(c("XMessagingChangeReactionsMuteModeController").getURIBuilder().getURI(),{thread_fbid:a,reactions_mute_mode:b,payload_source:c("MercuryAPIArgsSource").MERCURY})})};e.markThreadSpam=function(a,b){var c=this;d("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){c.__sendRequest(d("MercuryServerURIs").MARK_SPAM,{id:a,source:b})})};e.unmarkThreadSpam=function(a,b){var c=this;d("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){c.__sendRequest(d("MercuryServerURIs").UNMARK_SPAM,{id:a,source:b})})};e.deleteThread=function(a,b){this.deleteThreads([a],b)};e.deleteThreads=function(a,e){var f=this;c("promiseDone")(b("Promise").all(a.map(function(a){d("MercuryAssert").isThreadID(a);return new(b("Promise"))(function(b){return f.__threadIDMap.getServerIDFromClientID(a,b)})})).then(function(a){f.__sendRequest(d("MercuryServerURIs").DELETE_THREAD,{ids:a,source:e})}))};e.deleteMessages=function(a,b){d("MercuryMessageIDs.bs").getServerIDs(b||[],function(a){this.__sendRequest(d("MercuryServerURIs").DELETE_MESSAGES,{message_ids:a})}.bind(this))};e.sendDeliveryReceipts=function(a,b){d("MercuryMessageIDs.bs").getServerIDs(a||[],function(a){this.__sendRequest(d("MercuryServerURIs").DELIVERY_RECEIPTS,{message_ids:a,thread_ids:b})}.bind(this))};e.sendNewMessage=function(a,b){var e=this;b===void 0&&(b=c("MercuryAPIArgsSource").MERCURY);a.offline_threading_id||d("ODS").bumpEntityKey(3303,"chat.web","missing_otid_on_send");if(a.client_state&&a.client_state!==c("MercuryMessageClientState").SEND_TO_SERVER)return;var f=d("MercuryIDs").tokenize(a.thread_id),g=f.type,h=babelHelpers["extends"]({},a);h.thread_id=null;g=="user"?(h.other_user_fbid=f.value,this.$14(h,b)):g=="thread"?(h.thread_fbid=f.value,this.$14(h,b)):g=="root"&&f.value==h.offline_threading_id?(h.client_thread_id=a.thread_id,this.$14(h,b)):(d("MercuryIDs").isLocalThread(a.thread_id)||i(0,5587,a.thread_id),this.__threadIDMap.getServerIDFromClientID(a.thread_id,function(a){h.thread_fbid=a,e.$14(h,b)}));this.$15("send_msg",a);c("MercuryMessagingLightswitch").guard(function(){c("Bootloader").loadModules(["QuickPerformanceLogger"],function(b){b.markerStart(c("qpl")._(25296903,"1856"),a.offline_threading_id)},"MercuryServerRequests")})};e.$15=function(a,b){try{var e,f=c("Env").isCQuick?"Comet Inbox":c("MessengerEnvironment").messengerdotcom?"messenger_dot_com":c("MessengerEnvironment").facebookdotcom?"Facebook Messenger (other)":"Other",g=d("MercuryTagHelper").get(b.tags||[],"entrypoint"),h=d("MercuryIDs").getThreadFBIDFromThreadID(b.thread_id),i=(c("PresenceStatus").get(h)===c("AvailableListConstants").ACTIVE).toString(),j=(e=(e=d("ScriptPath").getScriptPath())==null?void 0:e.toString())!=null?e:"";c("MessengerWebEventsFalcoEvent").log(function(){return{attachment_infos:void 0,client_timestamp:Date.now().toString(),entry_point:g,event_name:a,first_attachment_type:void 0,"interface":f,mid:b.message_id,offline_threading_id:b.offline_threading_id,other_user_fbid:d("MercuryIDs").isGroupChat(b.thread_id)?void 0:h,thread_fbid:d("MercuryIDs").isGroupChat(b.thread_id)?h:void 0,extra_data:{pathName:j,isActiveNow:i}}})}catch(a){d("ODS").bumpEntityKey(3303,"chat.web","logging_error")}};e.$14=function(a,b){c("Arbiter").inform(d("ChannelConstants").ATTEMPT_RECONNECT),this.$4[a.message_id]=Date.now(),c("MercuryServerSendMessageQueueRouter").getForFBID(this.$1).enqueue(a.other_user_fbid||a.thread_fbid||a.client_thread_id,this.$7,b,a)};e.__getSendMessageQueueOptions=function(){return this.$7};e.markSeen=function(){var a=this.$2;this.__sendRequest(d("MercuryServerURIs").MARK_SEEN,{seen_timestamp:a})};e.$16=function(a,b,e,f){a=a.getData();var g=a.message_batch||[a];c("MercuryMessagingLightswitch").guard(function(){j.debug("handle_send_message_error_common",JSON.stringify({reliability_error_status:e,request_error_status:b,error_data:f,message_list:g}))});d("ChatReliabilityInstrumentation").logERROR("send_message_fail");var h=g.map(function(a){a={action_type:"ma-type:send-message",other_user_fbid:a.other_user_fbid,thread_fbid:a.thread_fbid,client_message_id:a.message_id,message_id:a.message_id,client_thread_id:a.client_thread_id,status:b,error_data:f};return a});h.forEach(function(a){a.action_type==="ma-type:send-message"&&a.status===10&&this.__logMercurySendError(a)},this);a={actions:h,payload_source:"client_handle_error"};c("MercuryMessagingLightswitch").guard(function(){c("Bootloader").loadModules(["QuickPerformanceLogger"],function(a){h.map(function(b){a.markerEnd(c("qpl")._(25296903,"1856"),"FAIL",b.client_message_id)})},"MercuryServerRequests")});this.$6.handleUpdate(a)};e.handleSendMessageError=function(a){var b=a.getPayload(),d=null,e=null;b&&b.error_payload?(d=3,e="send_error"):(d=10,e="request_error"+l(a));b=a.error;b===1404102?c("AsyncResponse").verboseErrorHandler(a):(b===1545052||b===1409009||b===1409008||b===1409007||b===1409006||b===1545083||b===1545084)&&c("AsyncResponse").defaultErrorHandler(a);b=/<.*>/.test(a.getErrorDescription())?a.getErrorSummary():a.getErrorDescription();this.$16(a.getRequest(),d,e,{type:1,code:a.getError(),description:b,is_transient:a.isTransient()})};e.handleSendMessageTransportError=function(a){this.$16(a.getRequest(),10,"transport_error"+l(a),{type:2,code:a.getError(),is_transient:!0})};e.handleSendMessageTimeout=function(a){this.$16(a,10,"transport_timeout",{type:3,is_transient:!0})};e.getLastActionTimestamp=function(){return this.$2};e.__logMercurySendError=function(a){c("MercurySendErrorLogger").log(a)};e.updateLastActionTimestamp=function(a){var b=Date.now()-1e3*60*60*24;a&&a>b&&(this.$2=Math.max(this.$2,a))};e.markThreadFetched=function(a){delete this.$3[a]};e.$13=function(a){return{action_type:"ma-type:log-message",thread_id:a,message_id:a,timestamp:Date.now(),is_unread:!1,source:"source:unknown",log_message_body:"",log_message_type:"log:error-msg",log_message_data:{}}};e.__getForAsyncRequest=function(b){b=b.getData();b=b.request_user_id?b.request_user_id:c("CurrentUser").getID();return a.getForFBID(b)};e.__handleUpdate=function(a,b){a.payload_source==="server_send_message"&&c("MercuryMessagingLightswitch").guard(function(){c("Bootloader").loadModules(["QuickPerformanceLogger"],function(b){var d=a.actions&&a.actions[0]&&a.actions[0].client_message_id;d&&b.markerEnd(c("qpl")._(25296903,"1856"),"SUCCESS",d)},"MercuryServerRequests")}),this.__getForAsyncRequest(b).$6.handleUpdate(a)};e.$17=function(a){var b=this.__getForAsyncRequest(a);b.handleThreadInfoError(a)};e.$18=function(a){var b=this.__getForAsyncRequest(a);b.handleThreadInfoError(a,!0)};e.$9=function(a){var b=this.__getForAsyncRequest(a.getRequest());b.handleSendMessageError(a)};e.$10=function(a){var b=this.__getForAsyncRequest(a.getRequest());b.handleSendMessageTransportError(a)};e.$11=function(a){var b=this.__getForAsyncRequest(a);b.handleSendMessageTimeout(a)};e.$12=function(){var a=this,b,e=null;d("MercuryServerRequestsConfig").msgrRegion&&(e={name:"X-MSGR-Region",value:d("MercuryServerRequestsConfig").msgrRegion});b=(b={},b[d("MercuryServerURIs").THREAD_INFO]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").BATCH_DEFERRED_MULTI,customHeader:e,batch_function:m,handler:function(b,c){return a.__handleUpdate(b,c)},error_handler:function(b){return a.$17(b.getRequest())},timeout_handler:function(b){return a.$18(b)},timeout:k},b[d("MercuryServerURIs").MARK_FOLDER_READ]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").IMMEDIATE,customHeader:e,handler:function(b,c){return a.__handleUpdate(b,c)}},b[d("MercuryServerURIs").CHANGE_READ_STATUS]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").IMMEDIATE,customHeader:e,handler:function(b,d){a.__handleUpdate(b,d);var e=(b.threads||[]).map(function(a){return a&&a.thread_id});c("MercuryMessagingLightswitch").guard(function(){j.log("response_change_read_status",JSON.stringify({threads:e}))})}},b[d("MercuryServerURIs").MARK_SEEN]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:e,batch_function:p,handler:function(b,c){return a.__handleUpdate(b,c)}},b[d("MercuryServerURIs").THREADLIST_INFO]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").BATCH_SUCCESSIVE_UNIQUE,customHeader:e,batch_function:o,handler:function(b,c){return a.__handleUpdate(b,c)}},b[d("MercuryServerURIs").MARK_SPAM]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").IMMEDIATE,customHeader:e,handler:function(b,c){return a.__handleUpdate(b,c)}},b[d("MercuryServerURIs").UNMARK_SPAM]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").IMMEDIATE,customHeader:e,handler:function(b,c){return a.__handleUpdate(b,c)}},b[d("MercuryServerURIs").UNREAD_THREADS]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").BATCH_SUCCESSIVE_UNIQUE,customHeader:e,batch_function:n,handler:function(b,c){return a.__handleUpdate(b,c)}},b[d("MercuryServerURIs").CHANGE_ARCHIVED_STATUS]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:e,batch_function:r,handler:function(b,c){return a.__handleUpdate(b,c)}},b[d("MercuryServerURIs").CHANGE_PINNED_STATUS]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:e,batch_function:r,handler:function(b,c){return a.__handleUpdate(b,c)}},b[d("MercuryServerURIs").CHANGE_PAGE_FOLLOW_UP_STATUS]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:e,batch_function:r,handler:function(b,c){return a.__handleUpdate(b,c)}},b[d("MercuryServerURIs").DELETE_THREAD]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:e,batch_function:t,handler:function(b,c){return a.__handleUpdate(b,c)}},b[d("MercuryServerURIs").DELETE_MESSAGES]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").IMMEDIATE,customHeader:e,handler:function(b,c){return a.__handleUpdate(b,c)}},b[d("MercuryServerURIs").DELIVERY_RECEIPTS]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").IMMEDIATE,customHeader:e,handler:function(b,c){return a.__handleUpdate(b,c)}},b[d("MercuryServerURIs").MOVE_THREAD]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:e,batch_function:s,handler:function(b,c){return a.__handleUpdate(b,c)}},b[d("MercuryServerURIs").CHANGE_MUTE_THREAD]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").IMMEDIATE,customHeader:e,handler:function(b,c){return a.__handleUpdate(b,c)}},b);var f=c("XMercuryUnseenThreadIDsController").getURIBuilder().getURI().toString();b[f]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").IMMEDIATE,customHeader:e,handler:function(b,c){return a.__handleUpdate(b,c)}};f=c("XMessagingChangeMentionsMuteModeController").getURIBuilder().getURI().toString();b[f]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").IMMEDIATE,customHeader:e,handler:function(b,c){return a.__handleUpdate(b,c)}};f=c("XMessagingChangeReactionsMuteModeController").getURIBuilder().getURI().toString();b[f]={request_user_id:this.$1,mode:d("MercuryServerDispatcher").IMMEDIATE,customHeader:e,handler:function(b,c){return a.__handleUpdate(b,c)}};d("MercuryServerDispatcher").registerEndpoints(b)};e.__sendRequest=function(a,b,c){if(this.$8)switch(a){case d("MercuryServerURIs").THREADLIST_INFO:case d("MercuryServerURIs").THREAD_INFO:b.cachius_min_seq_id=this.$8.getLastSeqID();break;default:break}d("MercuryServerDispatcher").trySend(a,b,c,this.$1)};e.__getFBID=function(){return this.$1};return a}();var u=new(c("MercurySingletonProvider"))(a);g["default"]=a}),98);
__d("MercuryThreadIDMap",["KeyedCallbackManager","MercuryAssert","MercuryIDs","MercurySingletonProvider"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){var b=this;this.canLinkExternally=function(a){d("MercuryAssert").isThreadID(a);var c=d("MercuryIDs").tokenize(a);return c.type=="user"||!!b.getServerIDFromClientIDNow(a)};this.$1=a;this.$2=new(c("KeyedCallbackManager"))();this.$3=new(c("KeyedCallbackManager"))()}a.getForFBID=function(a){return h.getForFBID(a)};a.get=function(){return h.get()};var b=a.prototype;b.setServerIDToClientID=function(a,b){var c=this.getClientIDFromServerIDNow(a);if(c)return;this.forceSetServerIDToClientID(a,b)};b.forceSetServerIDToClientID=function(a,b){this.$2.setResource(a,b),this.$3.setResource(b,a)};b.setDeprecatedServerIDToClientID=function(a,b){a&&this.$2.setResource(a,b)};b.getClientIDFromServerIDNow=function(a){return this.$2.getResource(a)};b.getClientIDFromServerID=function(a,b){var c=this;this.$2.executeOrEnqueue(a,b);e(["MercuryServerRequests"],function(b){b.getForFBID(c.$1).ensureThreadIsFetched(a)})};b.getServerIDFromClientIDNow=function(a){return this.$3.getResource(a)};b.getServerIDFromClientID=function(a,b){var c=this;d("MercuryAssert").isThreadID(a);var f=this.$3.executeOrEnqueue(a,b);e(["MercuryServerRequests"],function(b){var e=c.$3.getUnavailableResources(f),g=d("MercuryIDs").tokenize(a);e.length&&g.type!="root"&&b.getForFBID(c.$1).fetchThreadData(e)})};b.hasClientIDForServerID=function(a){return!!this.getClientIDFromServerIDNow(a)};b.convertThreadIDIfAvailable=function(a){var b=this.getClientIDFromServerIDNow(a);return b||a};b.reset=function(){this.$3.reset(),this.$2.reset()};return a}();var h=new(c("MercurySingletonProvider"))(a);g["default"]=a}),98);
__d("MercuryLoggingHelper",[],(function(a,b,c,d,e,f){a={obfuscateThread:function(a){var b=babelHelpers["extends"]({},a);a&&a.snippet&&a.snippet.length>0&&(b.snippet="*** [redacted] ***");return b},obfuscateMessage:function(a){var b=babelHelpers["extends"]({},a);a&&a.body&&a.body.length>0&&(b.body="*** [redacted] ***");return b}};e.exports=a}),null);
__d("MercuryServerSendMessageQueueSimulatedError",["AsyncRequest","AsyncResponse"],(function(a,b,c,d,e,f){var g=9999;a={create:function(a){a=new(b("AsyncRequest"))(this.endpoint_uri).setData({message_batch:[a],client:this.client});var c=new(b("AsyncResponse"))(a,{});Object.assign(c,{error:g,silentError:!1,transientError:!0,request:a});return c}};e.exports=a}),null);
__d("MessengerAttachmentTransformerForSend.bs",["MercuryAttachmentType","MessengerAttachmentTransformer.bs","MessengerMessageTransformer.bs"],(function(a,b,c,d,e,f){"use strict";function g(a,c,d,e){c=c.node;if(c==null)return{attach_type:b("MercuryAttachmentType").ERROR};if(c.__typename==="ExtensibleMessageAttachment"){var f=c.story_attachment,g=c.genie_attachment,h;if(g==null)h=null;else{g=g.genie_message;var i;if(g==null)i=null;else{g=g.story_attachment;i={story_attachment:g==null?null:b("MessengerMessageTransformer.bs").unsafeCastExtensibleAttachment(g)}}h={genie_message:i}}g={legacy_attachment_id:c.legacy_attachment_id,story_attachment:f==null?null:b("MessengerMessageTransformer.bs").unsafeCastExtensibleAttachment(f),genie_attachment:h}}else g=null;i=c.__typename==="Sticker"?c:null;f=c.__typename;var j;switch(f){case"MessageAnimatedImage":case"MessageAudio":case"MessageFile":case"MessageImage":case"MessageVideo":j=[c];break;default:j=null}h=b("MessengerMessageTransformer.bs").unsafeCastBlobAttachments({blob_attachments:j});f=b("MessengerAttachmentTransformer.bs").transformAttachment(a,{extensible_attachment:g,blob_attachments:h,sticker:i},d,e);if(f.length!==0)return f[0];else return{}}function a(a,b,c,d){return b.map(function(b){return g(a,b,c,d)})}f._transform=g;f.transform=a}),null);
__d("XMessagingSendController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/messaging/send/",{privacy_mutation_token:{type:"String"}})}),null);
__d("MercuryServerSendMessageQueue",["fbt","ChatReliabilityInstrumentation","CurrentUser","LogHistory","MercuryIDs","MercuryLoggingHelper","MercuryMessagingLightswitch","MercuryServerDispatcher","MercuryServerRequestsConfig","MercuryServerSendMessageQueueSimulatedError","MercurySyncDeltaHandler","MessengerAttachmentTransformerForSend.bs","MessengerObjectAssociationType","MessengerState.bs","ODS","Run","XMessagingSendController"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("LogHistory").getInstance("mercury_server_send_message_queue");a=function(){function a(a,b,e,f){var g=this;this.pending_message=null;this.queue=[];this.$6=function(){return g.queue.length||g.pending_message?h._("You haven't sent your message yet. Do you want to leave without sending?"):void 0};this.sender_id=a;this.queue_id=b;this.$2=e.success_handler;this.$1=e.error_handler;this.$4=e.transport_error_handler;this.$3=e.timeout_handler;this.$5=c("MercurySyncDeltaHandler").getForFBID(this.sender_id);this.client=f;d("Run").onBeforeUnload(this.$6,!1);a=null;d("MercuryServerRequestsConfig").msgrRegion&&(a={name:"X-MSGR-Region",value:d("MercuryServerRequestsConfig").msgrRegion});b=this.__getSendURI();b=(f={},f[b]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:d("MercuryServerDispatcher").IMMEDIATE,customHeader:a,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:e.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:e.connection_retries},f);d("MercuryServerDispatcher").registerEndpoints(b)}var b=a.prototype;b.__getSendURI=function(){return c("XMessagingSendController").getURIBuilder().getURI().toString()};b.__preparePayload=function(a){var b;b=(b=a)!=null?(b=b.replied_to_message)!=null?(b=b.message)!=null?b.message_id:b:b:b;var e=null,f=a.client_thread_id;if(d("MercuryIDs").isLocalThread(f)){f=d("MessengerState.bs").getThreadMetaNow(c("CurrentUser").getID(),f);if(f&&f.message_count===1&&f.object_association_type===c("MessengerObjectAssociationType").GENERAL_CHAT){e=(f=f)!=null?(f=f.associated_object)!=null?f.id:f:f}}f=b?d("MessengerState.bs").getServerMessageID(c("CurrentUser").getID(),b):null;return{client:this.client,action_type:a.action_type,app_id:a.app_id,audio_ids:a.audio_ids,body:a.body,client_thread_id:a.client_thread_id,ephemeral_ttl_mode:a.ephemeral_ttl_mode,file_ids:a.file_ids,gif_ids:a.gif_ids,has_attachment:a.has_attachment,image_ids:a.image_ids,location_attachment:a.location_attachment,lightweight_action_attachment:a.lightweight_action_attachment,log_message_data:a.log_message_data,log_message_type:a.log_message_type,message_id:a.message_id,message_source_data:a.message_source_data,montage_reply_data:a.montage_reply_data,offline_threading_id:a.offline_threading_id,other_user_fbid:a.other_user_fbid,photo_fbids:a.photo_fbids,shareable_attachment:a.shareable_attachment,signature_id:a.signatureID,source:a.source,specific_to_list:a.specific_to_list,sticker_id:a.sticker_id,tags:a.tags,thread_fbid:a.thread_fbid,timestamp:a.timestamp,ui_push_phase:a.ui_push_phase,video_ids:a.video_ids,platform_xmd:a.platform_xmd,profile_xmd:a.profile_xmd,replied_to_message_id:f,work_synced_group_id:e,to_list_md5:a.to_list_md5,mib_direct_message_data:a.mib_direct_message_data,secondary_language_body:a.secondary_language_body}};b.enqueue=function(a){this.queue.push(a),this.$7()};b.$7=function(){if(this.pending_message||!this.queue.length){this.pending_message&&this.$8();return}this.pending_message=this.queue.shift();var a=this.__preparePayload(this.pending_message);for(var b in a)(a[b]===void 0||a[b]===null)&&delete a[b];if(!a.action_type){var e=d("MercuryLoggingHelper").obfuscateMessage(a);d("ChatReliabilityInstrumentation").logERROR("missing action type before sending to send controller");c("MercuryMessagingLightswitch").guard(function(){i.debug("missing_action_type",JSON.stringify(e))})}if(!a.message_id){var f=d("MercuryLoggingHelper").obfuscateMessage(a);d("ChatReliabilityInstrumentation").logERROR("missing action type before sending to send controller"+JSON.stringify(f));c("MercuryMessagingLightswitch").guard(function(){i.debug("missing_message_id",JSON.stringify(f))})}this.$9();d("MercuryServerDispatcher").trySend(this.__getSendURI(),a,null,this.sender_id,this.queue_id)};b.$10=function(){while(this.queue.length)this.$11(this.queue.shift())};b.$11=function(a){var b=this;this.$1(d("MercuryServerSendMessageQueueSimulatedError").create(a));c("MercuryMessagingLightswitch").guard(function(){i.error("mark_as_failed",JSON.stringify({fbid:b.sender_id,queue_id:b.queue_id,message:d("MercuryLoggingHelper").obfuscateMessage(a)}))})};b.handleSuccess=function(a,b){var c=this;this.pending_message=null;var e=(a.actions||[]).map(function(a){var b=babelHelpers["extends"]({},a);if(a.graphql_payload&&a.graphql_payload.length>0){var e=d("MessengerAttachmentTransformerForSend.bs").transform(c.sender_id,a.graphql_payload,a.message_id,a.for_page);b=Object.assign(b,{attachments:e})}e=(e=a)!=null?(e=e.log_message_data)!=null?e.graphql_image:e:e;if(e){e=d("MessengerAttachmentTransformerForSend.bs").transform(c.sender_id,[e],a.message_id,a.for_page);b=Object.assign(b,{log_message_data:{image:e[0]}})}return b});a.actions=e;this.resumeAfterSuccess(a,b)};b.resumeAfterSuccess=function(a,b){this.$2(a,b),this.$12(),this.$7()};b.handleError=function(a){this.pending_message=null,this.$12(),this.$1(a),this.$10()};b.handleTransportError=function(a){this.pending_message=null,this.$12(),this.$4(a),this.$10()};b.handleTimeout=function(a){this.pending_message=null,this.$12(),this.$3(a),this.$10()};b.$9=function(){this.$5.pause()};b.$12=function(){this.$5.resume()};b.$8=function(){var a=this;c("MercuryMessagingLightswitch").guard(function(){i.debug("maybe_send_next_pending_message",JSON.stringify({fbid:a.sender_id,queue_id:a.queue_id,pending_message:d("MercuryLoggingHelper").obfuscateMessage(a.pending_message),queue:a.queue.map(function(a){return d("MercuryLoggingHelper").obfuscateMessage(a)})}))});var b="send_queue.delayed.queue_length."+this.queue.length.toString();d("ODS").bumpEntityKey(3303,"chat.web",b)};return a}();g["default"]=a}),98);
__d("MercurySingletonMixin",["CurrentUser"],(function(a,b,c,d,e,f){a={_getInstances:function(){this._instances||(this._instances={});return this._instances},get:function(){return this.getForFBID(b("CurrentUser").getID())},getForFBID:function(a){var b=this._getInstances();b[a]||(b[a]=new this(a));return b[a]}};e.exports=a}),null);
__d("MercuryServerSendMessageQueueRouter",["LogHistory","MercuryServerSendMessageQueue","MercurySingletonMixin","ODS"],(function(a,b,c,d,e,f,g){var h=d("LogHistory").getInstance("mercury_server_send_message_queue_router"),i="chat.web.send_queue_router";d("ODS").setEntitySample(i,.1);a=function(){function a(a){this.queues=new Map(),this.fbid=a}var b=a.prototype;b.enqueue=function(a,b,e,f){var g=this.queues.get(a);g===void 0&&(g=new(c("MercuryServerSendMessageQueue"))(this.fbid,a,b,e),this.queues.set(a,g),h.debug("added queue",JSON.stringify({fbid:this.fbid,queue_id:a})),d("ODS").bumpEntityKey(3303,i,"new_queue"));g.enqueue(f)};return a}();Object.assign(a,d("MercurySingletonMixin"));g["default"]=a}),98);
__d("MercurySyncDataFetcherImpl",["invariant","AsyncResponse","Bootloader","CurrentUser","FBIDCheck","MercuryConfig","MercuryThreadlistConstants","MessagingConfig","Promise","UserActivity","clearTimeout","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g,h){"use strict";var i=null,j=null,k=null,l={limit:d("MercuryThreadlistConstants").WEBMESSENGER_THREAD_COUNT+1,folder:"inbox",tags:["INBOX"],timestamp:null,filter:null,includeDeliveryReceipts:!1,includeSeqID:!0},m={};function a(a){return new(b("Promise"))(function(b,c){n(a,b,c,0)})}function n(a,b,e,f){if(!c("CurrentUser").isLoggedInNow()||f>d("MessagingConfig").syncFetchRetries){c("clearTimeout")(m[a]);e();return}var g=f===0?0:d("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(d("MessagingConfig").syncFetchTimeoutMultiplier,f);c("UserActivity").isOnTab()||(g+=c("MercuryConfig").DFFD*Math.random());c("clearTimeout")(m[a]);m[a]=c("setTimeoutAcrossTransitions")(function(){var g=!1,o=function(d){if(g)return;if(d.errors&&d.errors.length>0){var i=d.errors[0].message;if(i){var l=function(){k&&j||h(0,3650),new k().setErrorMessage(i).setEvent(j.DFF_FAILURE).setQueryParams(a).log()};k&&j?l():c("Bootloader").loadModules(["MessengerWebGraphQLTypedLogger","MessengerWebGraphQLEvent"],function(a,b){k=a,j=b,l()},"MercurySyncDataFetcherImpl")}}g=!0;n(a,b,e,f+1)},p=function(){if(!c("CurrentUser").isLoggedInNow())return;i||h(0,3651);i.fetchAll(a,[l],!d("FBIDCheck").isUser_deprecated(a),"dff").then(function(d){g=!0,b(new(c("AsyncResponse"))(null,babelHelpers["extends"]({},d,{payload_source:"server_invalidate_global_state"}))),c("clearTimeout")(m[a])},o)};i?p():c("Bootloader").loadModules(["MessengerGraphQLThreadlistFetcher.bs"],function(a){i=a,p()},"MercurySyncDataFetcherImpl")},g)}function e(a,c,d,e){return new(b("Promise"))(function(b,f){o(a,c,d,b,f,0,e)})}function o(a,b,e,f,g,h,i){if(h>d("MessagingConfig").syncFetchRetries){g();return}var j=h===0?0:d("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(d("MessagingConfig").syncFetchTimeoutMultiplier,h);c("setTimeoutAcrossTransitions")(function(){var j=!1,k=function(c){if(j)return;j=!0;o(a,b,e,f,g,h+1,i)};c("Bootloader").loadModules(["MessengerThreadDFFFetcher.bs"],function(g){return g.fetch_(a,{id:b,limit:e,source:i},!d("FBIDCheck").isUser_deprecated(a)).then(function(a){j=!0,f(new(c("AsyncResponse"))(null,babelHelpers["extends"]({},a,{payload_source:"server_invalidate_thread_state"})))},k)},"MercurySyncDataFetcherImpl")},j)}function f(a,c,d,e){return new(b("Promise"))(function(b,f){p(a,c,d,b,f,0,e)})}function p(a,b,e,f,g,h,i){if(h>d("MessagingConfig").syncFetchRetries){g();return}var j=h===0?0:d("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(d("MessagingConfig").syncFetchTimeoutMultiplier,h);c("setTimeoutAcrossTransitions")(function(){var j=!1,k=function(c){if(j)return;j=!0;p(a,b,e,f,g,h+1)};c("Bootloader").loadModules(["MessengerMessageDFFFetcher.bs"],function(g){return g.fetch_(a,{thread_id:b,message_id:e,source:i},!d("FBIDCheck").isUser_deprecated(a)).then(function(a){j=!0,f(new(c("AsyncResponse"))(null,babelHelpers["extends"]({},a)))},k)},"MercurySyncDataFetcherImpl")},j)}g.fetchThreadlistFromGraphQL=a;g.fetchThreadFromGraphQL=e;g.fetchMessageFromGraphQL=f}),98);
__d("MercurySyncDataFetcher",["LogHistory","MercurySyncDataFetcherImpl","MessagingConfig","Promise","WebGraphQLConfig","clearTimeout","promiseDone","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){"use strict";var h=d("LogHistory").getInstance("mercury_sync_data_fetcher");function a(){var a=0;for(var b=0;b<c("MessagingConfig").syncFetchRetries;b++){var d=b===0?0:c("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(c("MessagingConfig").syncFetchTimeoutMultiplier,b);a+=d+c("MessagingConfig").syncFetchRequestTimeoutMs}return a}var i=a();function e(a){var e=null;return new(b("Promise"))(function(b,f){var g=function(a){h.error("fetch_threadlist_graphql_timeout",JSON.stringify({timeout:i})),c("clearTimeout")(e),f(a)};e=c("setTimeoutAcrossTransitions")(g,Math.max(i,c("WebGraphQLConfig").timeout*c("MessagingConfig").syncFetchRetries));c("promiseDone")(d("MercurySyncDataFetcherImpl").fetchThreadlistFromGraphQL(a),function(a){c("clearTimeout")(e),b(a)},g)})}function f(a,e,f,g){return new(b("Promise"))(function(b,j){var k=function(a){h.error("fetch_thread_graphql_timeout",JSON.stringify({timeout:i})),j(a)},l=c("setTimeoutAcrossTransitions")(k,i);c("promiseDone")(d("MercurySyncDataFetcherImpl").fetchThreadFromGraphQL(a,e,f,g),function(a){c("clearTimeout")(l),b(a)},k)})}function j(a,e,f,g){return new(b("Promise"))(function(b,j){var k=function(a){h.error("fetch_message_graphql_timeout",JSON.stringify({timeout:i})),j(a)},l=c("setTimeoutAcrossTransitions")(k,i);c("promiseDone")(d("MercurySyncDataFetcherImpl").fetchMessageFromGraphQL(a,e,f,g),function(a){c("clearTimeout")(l),b(a)},k)})}g.getMaxTimeoutMs=a;g.fetchThreadlistFromGraphQL=e;g.fetchThreadFromGraphQL=f;g.fetchMessageFromGraphQL=j}),98);
__d("MercurySyncDFFDataFetcher",["CurrentUser","MercurySingletonProvider","MercurySyncDataFetcher","MercuryThreadIDMap","MessengerState.bs","Promise"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.$1=a,this.__threadIDMap=c("MercuryThreadIDMap").getForFBID(this.$1)}a.getForFBID=function(a){return h.getForFBID(a)};a.get=function(){return h.get()};var e=a.prototype;e.fetchInvalidateGlobalStateForGraphQL=function(){return this.$1&&this.$1!=="0"&&c("CurrentUser").isLoggedIn()?d("MercurySyncDataFetcher").fetchThreadlistFromGraphQL(this.$1):new(b("Promise"))(function(a,b){return b(!0)})};e.fetchInvalidateThreadState=function(a,c,e){var f=11,g=3;a=a||c;c=this.__threadIDMap.getClientIDFromServerIDNow(a);if(!c)return b("Promise").resolve({getPayload:function(){return{}}});g=g+d("MessengerState.bs").getCurrentlyLoadedMessages(this.$1,c).length;return!a?b("Promise").resolve({getPayload:function(){return{}}}):d("MercurySyncDataFetcher").fetchThreadFromGraphQL(this.$1,a,Math.max(g,f),e)};e.fetchInvalidateMessage=function(a,c,e,f){a=a||c;return!a?b("Promise").resolve({getPayload:function(){return{}}}):d("MercurySyncDataFetcher").fetchMessageFromGraphQL(this.$1,a,e,f)};return a}();var h=new(c("MercurySingletonProvider"))(a);g["default"]=a}),98);
__d("MercurySyncConstants",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({ARBITER_EVENT_INVALID_STATE:"SYNC:INVALID_STATE",ARBITER_EVENT_INVALID_STATE_RETRY:"SYNC:INVALID_STATE_RETRY",ARBITER_EVENT_INVALID_STATE_RECOVER:"SYNC:INVALID_STATE_RECOVER",ARBITER_EVENT_INVALID_STATE_STALE:"SYNC:INVALID_STATE_STALE"});f["default"]=a}),66);
__d("MercurySyncTopicType",[],(function(a,b,c,d,e,f){a=Object.freeze({DELTA:"delta",DELTAFLOW:"deltaflow",DELTAFLOWREJECT:"deltaflowreject"});f["default"]=a}),66);
__d("onAfterLoadSafe",["Run","TimeSlice","requestIdleCallback"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("TimeSlice").guard(function(){return d("Run").onAfterLoad(function(){c("requestIdleCallback")(a)})},"delayed after load",{propagationType:c("TimeSlice").PropagationType.ORPHAN})()}g["default"]=a}),98);
__d("MercurySyncDeltaHandler",["invariant","Arbiter","Bootloader","ChatReliabilityInstrumentation","CurrentUser","LogHistory","MercuryDelayedDispatcher","MercuryMessagingLightswitch","MercuryServerPayloadPreprocessor","MercurySingletonProvider","MercurySyncConstants","MercurySyncDeltaHolder","MercurySyncDeltaTypes","MercurySyncEventsProxy","MercurySyncForcedFetchHandler","MercurySyncHolesTypedLogger","MercurySyncTopicType","MercuryThreadIDMap","MessengerDeltaTransformer.bs","gkx","onAfterLoadSafe","performanceAbsoluteNow","promiseDone","qpl"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("LogHistory").getInstance("mercury_sync_delta_handler"),j="app_id:219994525426954";a=function(){a.getForFBID=function(a){return k.getForFBID(a)};a.get=function(){return k.get()};function a(a){var b=this;this.$1=a;this.$2=c("MercurySyncForcedFetchHandler").getForFBID(this.$1);this.__payloadPreprocessor=c("MercuryServerPayloadPreprocessor").getForFBID(this.$1);this.__delayedDispatcher=c("MercuryDelayedDispatcher").getForFBID(this.$1);this.$3=c("MercurySyncDeltaHolder").getForFBID(this.$1);this.$4=0;this.$11=c("MercuryThreadIDMap").getForFBID(this.$1);this.$5=[];this.$10=c("MercurySyncEventsProxy").getForFBID(this.$1);c("MercuryMessagingLightswitch").guard(function(){i.debug("constructor",JSON.stringify({fbid:b.$1}))});c("Arbiter").subscribe(c("MercurySyncEventsProxy").Events.INIT,function(d,e){c("MercuryMessagingLightswitch").guard(function(){i.debug("initSeqID",JSON.stringify(e))});d=e&&e.seqID;var a=e&&e.fbid;if(!a)return;if(a!==b.$1)return;d?b.$3.updateLastSeqID(d):b.$3.updateLastSeqID(0);b.$13();c("gkx")("678667")&&c("onAfterLoadSafe")(function(){c("Bootloader").loadModules(["MessengerSyncSeqIDSanityCheck"],function(a){a.getForFBID(b.$1).init()},"MercurySyncDeltaHandler")})})}var b=a.prototype;b.setSource=function(a){this.$12=a};b.$13=function(){var a=this;c("MercuryMessagingLightswitch").guard(function(){i.debug("setUpSubscriptionsToRealTimeUpdates",JSON.stringify({fbid:a.$1}))});this.$6=c("Arbiter").subscribe(this.$10.getArbiterType(c("MercurySyncEventsProxy").Events.DELTA),function(b,d){b=d&&d.obj&&d.obj.queue;if(b&&b.toString()!==a.$1)return;b=d&&d.obj&&d.obj.delta;d=d&&d.obj&&d.obj.iseq;if(!b||!d)return;a.$14(d,c("MercurySyncTopicType").DELTA);a.$15(d,b);a.$3.push(d,b);a.$16()});this.$8=c("Arbiter").subscribe(this.$10.getArbiterType(c("MercurySyncEventsProxy").Events.FLOW_REJECT),function(b,c){b=c&&c.obj&&c.obj.queue;if(b&&b.toString()!==a.$1)return;a.$9&&a.$17()});this.$7=c("Arbiter").subscribe(this.$10.getArbiterType(c("MercurySyncEventsProxy").Events.FAKE_DFF),function(b,c){b=c&&c.obj&&c.obj.queue;if(b&&b.toString()!==a.$1)return;b=c&&c.obj&&c.obj.delta;if(!b)return;if(a.$18(b))if(a.$5.some(function(b){return a.$18(b)}))return;else a.$5.push(b);else a.$5.push(b);a.$16()});this.$9=!0};b.$18=function(a){return a["class"]===c("MercurySyncDeltaTypes").ForcedFetch&&!a.threadKey&&!a.messageId};b.$16=function(){if(this.$4>0)return;if(this.$5.length>0){var a=this.$5.shift();this.$19(this.$3.getLastSeqID(),a);this.$16()}a=this.$3.peek();if(!a)return;a=a-this.$3.getLastSeqID();if(a===1){var b=this.$3.pop();if(!b)return;var c=b.seqID;b=b.delta;this.$19(c,b);this.$16()}else a>1?this.$20():(this.$3.pop(),this.$16())};b.$19=function(a,b){b.numNoOps&&b.numNoOps>1?this.$3.updateLastSeqID(a+b.numNoOps-1):this.$3.updateLastSeqID(a),b["class"]===c("MercurySyncDeltaTypes").ForcedFetch?(c("MercuryMessagingLightswitch").guard(function(){i.debug("DFF",JSON.stringify(b))}),b.threadKey!==void 0&&b.messageId===void 0?this.$21(a,b):b.threadKey!==void 0&&b.messageId!==void 0?this.$22(a,b):(d("ChatReliabilityInstrumentation").logDFF_DELTA_INIT(JSON.stringify(b)),this.$23(a))):d("MessengerDeltaTransformer.bs").transform(this.$1,b)};b.$20=function(){var a=JSON.stringify({$24:this.$3.getLastSeqID(),nextSeqID:this.$3.peek()});c("MercuryMessagingLightswitch").guard(function(){i.warn("hole",a)});var b=this.$3.peek();!b&&h(0,5132);b=b-1;d("ChatReliabilityInstrumentation").logDFF_HOLE_INIT(a);this.$23(b)};b.$25=function(a,b,d,e){var f=this;this.$4&&h(0,5134);this.$4++;c("MercuryMessagingLightswitch").guard(function(){i.debug("_scheduleDataFetch:start",JSON.stringify({seqID:a}))});c("promiseDone")(b(),function(b){c("MercuryMessagingLightswitch").guard(function(){i.debug("_scheduleDataFetch:success",JSON.stringify({seqID:a}))}),f.$4--,d(a,b),f.$16()},function(b){c("MercuryMessagingLightswitch").guard(function(){i.error("_scheduleDataFetch:failure",JSON.stringify({seqID:a}))}),f.$4--,e(a,b),f.$16()})};b.emergencyDFF=function(a,b){this.$23(0,a,b)};b.$23=function(a,b,d){var e=this;if(!c("CurrentUser").isLoggedInNow())return;this.$25(void 0,function(){return e.$2.processGlobalDFFForGraphQL()},function(a,d){c("gkx")("1199098")&&e.$11.reset();var f=d.getPayload();e.__payloadPreprocessor.handleUpdate(f);f.sequence_id&&(c("MercuryMessagingLightswitch").guard(function(){i.debug("_initiateGlobalDFF:success",JSON.stringify({seqID:f.sequence_id}))}),c("gkx")("678668")?e.$3.updateLastSeqIDAndClearHistory(f.sequence_id):e.$3.updateLastSeqID(f.sequence_id));c("Arbiter").inform(c("MercurySyncConstants").ARBITER_EVENT_INVALID_STATE_RECOVER);b&&b(f.sequence_id)},function(f,g){c("MercuryMessagingLightswitch").guard(function(){i.error("_initiateGlobalDFF:failure","")}),g?(e.$9&&e.$17(),d&&d()):(c("Arbiter").inform(c("MercurySyncConstants").ARBITER_EVENT_INVALID_STATE_RETRY),c("MercuryMessagingLightswitch").guard(function(){i.debug("_initiateGlobalDFF:retry","")}),e.$23(a,b,d))})};b.$21=function(a,b){var d=this;this.$25(a,function(){return d.$2.processThreadDFF(a,b.threadKey,b.isLazy,d.$12)},function(a,b){d.__payloadPreprocessor.handleUpdate(b.getPayload()),d.$3.updateLastSeqID(a)},function(){c("MercuryMessagingLightswitch").guard(function(){i.error("_initiateThreadDFF:failure",JSON.stringify(b))});var e=babelHelpers["extends"]({},b);delete e.threadKey;d.$3.updateLastSeqID(a-1);d.$3.push(a,e)})};b.$22=function(a,b){var d=this;this.$25(a,function(){return d.$2.processMessageDFF(a,b.threadKey,b.messageId,b.isLazy,d.$12)},function(a,b){b=b.getPayload();var c=b.other_user_fbid?b.other_user_fbid:b.thread_fbid;b=[babelHelpers["extends"]({},b)];var e="client_channel_message";d.__delayedDispatcher.handleUpdateWaitForThread({actions:b,payload_source:e},c);d.$3.updateLastSeqID(a)},function(){c("MercuryMessagingLightswitch").guard(function(){i.error("_initiateMessageDFF:failure",JSON.stringify(b))});var e=babelHelpers["extends"]({},b);delete e.messageId;d.$3.updateLastSeqID(a-1);d.$3.push(a,e)})};b.$14=function(a,b){var d=a-this.$3.getLastSeqID();if(d!==1&&d!==0){if(!c("CurrentUser").isEmployee())return;new(c("MercurySyncHolesTypedLogger"))().setSeqID(a).setDifference(d).setTopicType(b).log()}};b.$15=function(a,b){switch(b["class"]){case c("MercurySyncDeltaTypes").NewMessage:var d=c("performanceAbsoluteNow")();c("Bootloader").loadModules(["QuickPerformanceLogger"],function(a){var e=b.messageMetadata.tags;Array.isArray(e)&&e.includes(j)&&c("MercuryMessagingLightswitch").guard(function(){a.markerEnd(c("qpl")._(25296903,"1856"),"SUCCESS",b.messageMetadata.offlineThreadingId,d)})},"MercurySyncDeltaHandler");c("MercuryMessagingLightswitch").guard(function(){i.debug("message_delta",JSON.stringify({seqID:a,threadKey:b.messageMetadata.threadKey,messageId:b.messageMetadata.messageId}))});break;case c("MercurySyncDeltaTypes").ReadReceipt:c("MercuryMessagingLightswitch").guard(function(){i.debug("read_receipt_delta",JSON.stringify({seqID:a,threadKey:b.threadKey,actionTimestampMs:b.actionTimestampMs,watermarkTimestampMs:b.watermarkTimestampMs}))});break;case c("MercurySyncDeltaTypes").DeliveryReceipt:c("MercuryMessagingLightswitch").guard(function(){i.debug("delivery_receipt_delta",JSON.stringify({seqID:a,deliveredWatermarkTimestampMs:b.deliveredWatermarkTimestampMs,messageIds:b.messageIds}))});break}};b.pause=function(){this.$4++};b.resume=function(){this.$4--,this.$16()};b.$17=function(a){a===void 0&&(a=!1),this.$9=!1,c("Arbiter").unsubscribe(this.$6),c("Arbiter").unsubscribe(this.$7),c("Arbiter").unsubscribe(this.$8),a||c("Arbiter").inform(c("MercurySyncConstants").ARBITER_EVENT_INVALID_STATE)};return a}();var k=new(c("MercurySingletonProvider"))(a);g["default"]=a}),98);
__d("MercurySyncForcedFetchHandler",["MercurySingletonProvider","MercurySyncDFFDataFetcher","MercuryThreadIDMap","MessengerState.bs","Promise"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return{getPayload:function(){return{sequence_id:a}}}}a=function(){a.getForFBID=function(a){return i.getForFBID(a)};a.get=function(){return i.get()};function a(a){this.$1=a,this.$2=c("MercuryThreadIDMap").getForFBID(this.$1),this.$3=c("MercurySyncDFFDataFetcher").getForFBID(this.$1)}var e=a.prototype;e.processMessageDFF=function(a,c,e,f,g){if(f){f=c.otherUserFbId!==void 0?c.otherUserFbId.toString():c.threadFbId.toString();f=this.$2.getClientIDFromServerIDNow(f);if(f===void 0)return b("Promise").resolve(h(a));f=d("MessengerState.bs").getMessagesFromIDs(this.$1,[e]);if(f.length===0)return b("Promise").resolve(h(a))}return this.$3.fetchInvalidateMessage(c.otherUserFbId,c.threadFbId,e,g)};e.processThreadDFF=function(a,c,d,e){if(d){d=c.otherUserFbId!==void 0?c.otherUserFbId.toString():c.threadFbId.toString();d=this.$2.getClientIDFromServerIDNow(d);if(d===void 0)return b("Promise").resolve(h(a))}return this.$3.fetchInvalidateThreadState(c.otherUserFbId,c.threadFbId,e)};e.processGlobalDFFForGraphQL=function(){return this.$3.fetchInvalidateGlobalStateForGraphQL()};return a}();var i=new(c("MercurySingletonProvider"))(a);g["default"]=a}),98);
__d("MontageDispatcher",["ExplicitRegistrationDispatcher"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("ExplicitRegistrationDispatcher"));b=new a({strict:!1});g["default"]=b}),98);
__d("MontageActions",["Bootloader","CurrentUser","MercuryServerPayloadPreprocessor","MontageDispatcher","WebGraphQL","keyMirror","promiseDone","uniqueID"],(function(a,b,c,d,e,f,g){"use strict";var h=c("keyMirror")({REQUEST_UPDATE:null,HAS_UPDATED:null,HANDLE_ACTION:null}),i=new Set();function a(a){c("MontageDispatcher").dispatch({type:h.REQUEST_UPDATE,threadFBID:a})}function b(a,b){c("MontageDispatcher").dispatch({type:h.REQUEST_UPDATE,threadFBID:a})}function d(a){c("MontageDispatcher").dispatch({type:h.HAS_UPDATED,threadFBID:a})}function e(a){if(i.has(a))return;i.add(a);c("Bootloader").loadModules(["MessengerMontageThreadQueryWebGraphQLQuery"],function(b){b=c("WebGraphQL").exec(new b({id:a}));c("promiseDone")(b,function(b){c("MercuryServerPayloadPreprocessor").getForFBID(c("CurrentUser").getID()).handleUpdate({current_montage_thread:b}),i["delete"](a)})},"MontageActions")}function f(a,b){c("MercuryServerPayloadPreprocessor").getForFBID(c("CurrentUser").getID()).handleUpdate({montage_delete_message_delta:b})}function j(a,b){c("Bootloader").loadModules(["MessengerNewMontageMessageWebGraphQLQuery"],function(a){a=c("WebGraphQL").exec(new a({id:b.message_fbid}));c("promiseDone")(a,function(a){c("MercuryServerPayloadPreprocessor").getForFBID(c("CurrentUser").getID()).handleUpdate({montage_new_message_delta:a.montage_message})})},"MontageActions")}function k(a){c("Bootloader").loadModules(["MessengerState.bs","MessengerMontagePollVoteMutationWebGraphQLMutation"],function(b,d){c("MercuryServerPayloadPreprocessor").getForFBID(c("CurrentUser").getID()).handleUpdate({montage_poll_sticker_vote:[a]});b=c("WebGraphQL").exec(new d({input:{client_mutation_id:c("uniqueID")(),story_card_poll_id:a.pollID,option:a.optionVotedIndex,actor_id:c("CurrentUser").getID()}}));c("promiseDone")(b,function(a){},function(a){})},"MontageActions")}g.Types=h;g.requestUpdate=a;g.montageThreadChanged=b;g.hasUpdated=d;g.loadMontageThreadForActor=e;g.deleteMontage=f;g.handleNewMontageDelta=j;g.updatePollStickerChoice=k}),98);
__d("RemovedMessageTombstoneContent",["fbt","CurrentUser","GenderConst","IntlVariations","MercuryIDs","MessengerParticipants.bs","MessengerState.bs","gkx"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a,b){var e;e=((e=a.unsender)==null?void 0:e.id)||a.author;var f=d("MercuryIDs").getUserIDFromParticipantID(e),g=c("CurrentUser").getID();if(f===g)return this._getFbtForCurrentViewerAuthor();g=d("MessengerState.bs").getThreadMetaNow(g,a.thread_id);g=g==null?void 0:(g=g.custom_nickname)==null?void 0:g[f];g=g||((f=b.get(e))==null?void 0:f.short_name)||((g=a.unsender)==null?void 0:g.short_name)||((f=a.unsender)==null?void 0:f.name);f=(a=b.get(e))==null?void 0:a.gender;if(g)return this._getFbtForOtherAuthor(g,f);else return this._getFbtForUnknownAuthor()}function b(a){if(a==null)return this._getFbtForUnknownAuthor().toString();var b=d("MercuryIDs").getUserIDFromParticipantID(a);if(b===c("CurrentUser").getID())return this._getFbtForCurrentViewerAuthor().toString();b=d("MessengerParticipants.bs").getNow(a);a=b&&b.short_name;b=b&&b.gender;if(a)return this._getFbtForOtherAuthor(a,b).toString();else return this._getFbtForUnknownAuthor().toString()}function e(){return c("gkx")("1531920")?h._("You unsent a message"):h._("You removed a message")}function f(a,b){return c("gkx")("1531920")?h._({"*":"{name} unsent a message"},[h._param("name",a,[1,b===c("GenderConst").FEMALE_SINGULAR?c("IntlVariations").GENDER_FEMALE:c("IntlVariations").GENDER_MALE])]):h._({"*":"{name} removed a message"},[h._param("name",a,[1,b===c("GenderConst").FEMALE_SINGULAR?c("IntlVariations").GENDER_FEMALE:c("IntlVariations").GENDER_MALE])])}function i(){return c("gkx")("1531920")?h._("A contact unsent a message"):h._("A contact removed a message")}g.getRemovedMessageTombstoneContent=a;g.getTombstoneContentForSnippet=b;g._getFbtForCurrentViewerAuthor=e;g._getFbtForOtherAuthor=f;g._getFbtForUnknownAuthor=i}),98);
__d("ScotchRTCCallInitUtils",["invariant","CurrentUser","MercuryIDs","MessengerParticipants.bs","MessengerParticipantsImages.re","MessengerState.bs","ScotchConstants","ScotchFBRTCCallSummary","ScotchFBRTCCallSummaryStore","ScotchFBRTCGroupCallStore","ScotchRTCCallActions","ScotchRTCCallStore","ScotchRTCGroupCallActions","ScotchRTCMWThreadDeltaHandler","ScotchRTCUser","URI","immutable"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a){var b=c("ScotchFBRTCCallSummary").restoreOrInitialize(c("ScotchFBRTCCallSummaryStore").getInstance(),a.peerID,a.callID,a.isCaller);c("ScotchRTCCallActions").setCallSummary(b);c("ScotchRTCCallStore").mutateCallSummary(function(b){b.onPopupOpened(),b.setCallType(a.protocol===d("ScotchConstants").SignalingProtocol.P2P?a.isAudio?d("ScotchConstants").CallType.VOIP:d("ScotchConstants").CallType.DIRECT_VIDEO:"mws"),b.setActiveConnection(a.protocol===d("ScotchConstants").SignalingProtocol.P2P?"p2p":"mws")})}function b(a,b){var e=this;a=a.map(function(a){return d("MercuryIDs").getParticipantIDFromUserID(a)});d("MessengerParticipants.bs").getMulti(a,function(a){a=c("immutable").Map(a);e.initializeParticipantsAndStartCall(a,!0,b)})}function e(a,b,e){var f=this,g=a.keySeq().toArray();d("MessengerParticipantsImages.re").getBigImageMultiWithSize({ids:g,callback:function(g){b&&c("ScotchRTCCallActions").initRemoteUsers(a.filter(function(a){a=a.fbid;return a!==c("CurrentUser").getID()}).map(function(a){return f._createRTCUser(a,g)}).toSet());var h=d("MercuryIDs").getParticipantIDFromUserID(c("CurrentUser").getID());c("ScotchRTCCallActions").initLocalUser(f._createRTCUser(a.get(h),g));e()},size:100})}function f(a){var b=a.peerID;a=a.groupThreadID;var e=b!=null?b:a;if(e==null)return;a=b!=null?d("MercuryIDs").getThreadIDFromUserID(e):d("MercuryIDs").getThreadIDFromThreadFBID(e);if(a===null)return;b=(b=c("ScotchFBRTCGroupCallStore").getState().thread)==null?void 0:b.thread_fbid;a!==b&&d("MessengerState.bs").getThreadMeta(c("CurrentUser").getID(),a,function(a){d("ScotchRTCGroupCallActions").initThread(a,null),d("ScotchRTCMWThreadDeltaHandler").initHandler(e)})}function i(a,b){var e=a.big_image_src,f=a.fbid,g=a.user_type,i=a.href,j=a.image_src,k=a.is_messenger_user,l=a.name,m=a.room_location,n=a.short_name;a=a.vanity;f||h(0,1174);if(b){var o=d("MercuryIDs").getParticipantIDFromUserID(f);e=b[o]}return new(c("ScotchRTCUser"))({FBID:f,isGuestUser:g==="guest",isMessengerUser:!!k,profileUrl:new(c("URI"))(i),profilePictureUrl:e||j,roomLocation:m,userName:l,userShortName:n,vanity:a?a:""})}g.initializeCallSummary=a;g.initializeRTCUsers=b;g.initializeParticipantsAndStartCall=e;g.initializeThreadFromCollisionContext=f;g._createRTCUser=i}),98);
__d("ScotchRTCGroupCallEscalationActions",["ScotchRTCAppDispatcher"],(function(a,b,c,d,e,f,g){"use strict";function a(){c("ScotchRTCAppDispatcher").dispatch({type:"GROUP_ESCALATION_START"})}function b(a){c("ScotchRTCAppDispatcher").dispatch({type:"GROUP_ESCALATION_CANCEL",p2pCallSummary:a})}function d(){c("ScotchRTCAppDispatcher").dispatch({type:"GROUP_ESCALATION_SUCCESS"})}function e(a){c("ScotchRTCAppDispatcher").dispatch({type:"GROUP_ESCALATION_SET_USERS_TO_RING",usersToRing:a})}function f(a){c("ScotchRTCAppDispatcher").dispatch({type:"GROUP_ESCALATION_SET_P2P_CALLSUMMARY",p2pCallSummary:a})}g.start=a;g.cancel=b;g.approve=d;g.setUsersToRing=e;g.setP2PCallSummary=f}),98);
__d("ScotchRTCGroupCallEscalator",["CurrentUser","MercuryIDs","MessengerParticipants.bs","ScotchConstants","ScotchFBRTCGroupCallStore","ScotchFBRTCMWProtocolStore","ScotchRTCAppDispatcher","ScotchRTCCallStore","ScotchRTCGroupCallActions","ScotchRTCGroupCallEscalationActions","ScotchRTCGroupCallEscalationStore","ScotchRTCMWProtocolHandler","ZenonDebugLogger","immutable"],(function(a,b,c,d,e,f,g){"use strict";var h=45e3;a=function(){function a(a,b,e,f){this.$3=a,this.$4=b,this.$5=e,this.$1=String(f),d("ScotchRTCGroupCallEscalationActions").setP2PCallSummary(c("ScotchRTCCallStore").getState().callSummary),this.$6=[e],this.$8=null}var b=a.prototype;b.getParticipants=function(){return this.$8};b.$9=function(){var a=this.$3,b=this.$1;return window.setTimeout(function(){var e=c("ScotchRTCGroupCallEscalationStore").isEscalated(),f=c("ScotchRTCCallStore").getState();f=f.callInfo;!e&&(f.callID===b||f.conferenceName===a)&&(i("Group Escalation timed out"),c("ScotchRTCGroupCallEscalationStore").logToP2PCallSummary(function(a){a.setEscalationTimedOut(),d("ScotchRTCGroupCallEscalationActions").cancel(a)}))},h)};b.startEscalationToMultiway=function(){var a=this;i("Escalating P2P call to Multiway call %o",this.$3);var b=c("ScotchRTCGroupCallEscalationStore").getState().inProgress;if(b)return;d("ScotchRTCGroupCallEscalationActions").start();this.$2=this.$9();this.$7=new(c("ScotchRTCMWProtocolHandler"))();c("ScotchRTCAppDispatcher").explicitlyRegisterStores([c("ScotchFBRTCGroupCallStore"),c("ScotchFBRTCMWProtocolStore")]);d("ScotchRTCGroupCallActions").setLayout(d("ScotchConstants").GroupVideoViewLayout.GRID);var e=d("MercuryIDs").getParticipantIDFromUserID(c("CurrentUser").getID());d("MessengerParticipants.bs").get(e,function(b){var f={};f[e]=b;b=c("immutable").Map(f);a.$8=b;d("ScotchRTCGroupCallActions").initThread(null,b);a.$10()})};b.$10=function(){var a=c("ScotchRTCCallStore").getState().localUser.getStream();a=a;a&&this.$7.onStreamReady(a,this.$6,this.$3,!0,{callTrigger:"multiway_escalation",p2pCallID:this.$1})};return a}();a.ESCALATION_TIMEOUT=h;function i(){}g["default"]=a}),98);
__d("ScotchFBRTCPeerConnection",["cr:1429706"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:1429706")}),98);
__d("ScotchRTCP2PCallEscalationActions",["ScotchRTCAppDispatcher"],(function(a,b,c,d,e,f,g){"use strict";function a(){c("ScotchRTCAppDispatcher").dispatch({type:"P2P_CALL_ESCALATION_START"})}function b(a){c("ScotchRTCAppDispatcher").dispatch({type:"P2P_CALL_ESCALATION_SET_REQUEST",request:a})}function d(){c("ScotchRTCAppDispatcher").dispatch({type:"P2P_CALL_ESCALATION_FAILURE",reason:"cancelled"})}function e(){c("ScotchRTCAppDispatcher").dispatch({type:"P2P_CALL_ESCALATION_FAILURE",reason:"timeout"})}function f(a){c("ScotchRTCAppDispatcher").dispatch({type:"P2P_CALL_ESCALATION_ACK",token:a})}function h(){c("ScotchRTCAppDispatcher").dispatch({type:"P2P_CALL_ESCALATION_SUCCESS"})}function i(a){c("ScotchRTCAppDispatcher").dispatch({type:"P2P_CALL_ESCALATION_FAILURE",reason:"denied",token:a,response:!1})}function j(a){c("ScotchRTCAppDispatcher").dispatch({type:"P2P_CALL_ESCALATION_SET_RESPONSE",response:a})}function k(a,b){a?c("ScotchRTCAppDispatcher").dispatch({type:"P2P_CALL_ESCALATION_SUCCESS",token:b}):c("ScotchRTCAppDispatcher").dispatch({type:"P2P_CALL_ESCALATION_FAILURE",reason:"denied",token:b,response:!1})}function l(){c("ScotchRTCAppDispatcher").dispatch({type:"REMOTE_VIDEO_MUTED"})}function m(a){c("ScotchRTCAppDispatcher").dispatch({type:"SET_P2P_CALL_ESCALATION_MEDIA",stream:a})}g.start=a;g.setRequest=b;g.cancel=d;g.timeout=e;g.handleACK=f;g.approve=h;g.decline=i;g.setResponse=j;g.parseResponse=k;g.muteRemoteVideo=l;g.setEscalateToMediaStream=m}),98);
__d("ScotchRTCP2PCallEscalator",["Promise","ScotchConstants","ScotchFBRTCCallSummaryStore","ScotchFBRTCPeerConnection","ScotchRTCCallStore","ScotchRTCP2PCallEscalationActions","ScotchRTCP2PCallEscalationStore","ScotchRTCP2PCallStore","ScotchRTCP2PProtocolHandler","ScotchRTCUtils","ZenonBrowsers","ZenonDebugLogger","dangerouslyBypassDispatchError"],(function(a,b,c,d,e,f,g){"use strict";var h=25e3;a=function(){a.initVideoInAudioCall=function(){return d("ZenonBrowsers").videoEscalationByUnmuteWorkaround()};a.isEscalated=function(){return c("ScotchRTCP2PCallEscalationStore").isEscalated()};a.isNegotiationAllowed=function(){return c("ScotchRTCP2PCallEscalationStore").isNegotiationAllowed()};function a(a,b,c){this.$3=a,this.$1=b,this.$2=c,this.$6()}var e=a.prototype;e.$6=function(){var a=this,b=c("ScotchRTCP2PCallEscalationStore").getState();this.$4=c("ScotchRTCP2PCallEscalationStore").addListener(function(){var d=c("ScotchRTCP2PCallEscalationStore").getState();if(d===b)return;!d.awaitingACK&&d.awaitingACK!==b.awaitingACK&&!d.inProgress&&window.clearTimeout(a.$5);if(d.callType!==b.callType&&d.inProgress){var e=c("ScotchRTCCallStore").getState();e=e.callSummary;e.setCallType(d.callType);e.save(c("ScotchFBRTCCallSummaryStore").getInstance())}b=d})};e.destroy=function(){i("P2P Escalator %o","destroy"),this.$4.remove(),window.clearTimeout(this.$5)};e.generateRequestToken=function(a){var b=c("ScotchRTCP2PCallEscalationStore").getState();b=b.token;if(b!=null&&a){i("P2P Escalator %o","request token","reuse");return b}i("P2P Escalator %o","request token");b=this.$2.sendVideoEscalationRequest(this.$3,this.$1,a);window.clearTimeout(this.$5);this.$5=this.$7();return b.msg_id.toString()};e.generateResponseToken=function(a,b){var e=c("ScotchRTCP2PCallEscalationStore").getState();e=e.token;if(e!=null){i("P2P Escalator %o","response token","reuse");return e}i("P2P Escalator %o %o %o","response token",b,a);e=a.peerID;var f=a.callID;a=a.msgID;e=this.$2.sendVideoRequestResponse(e,f,a,b);window.clearTimeout(this.$5);var g=e.msg_id.toString();!b?c("dangerouslyBypassDispatchError")(function(){return d("ScotchRTCP2PCallEscalationActions").decline(g)}):this.$5=this.$7();return g};e.$7=function(){return window.setTimeout(d("ScotchRTCP2PCallEscalationActions").timeout,h)};e.parseMessage=function(a){i("P2P Escalator %o","parse message",this.$3,a.msgType);switch(a.msgType){case d("ScotchConstants").PayloadType.VIDEO_REQUEST:a.ackID?this.$8(a):this.$9(a);break;case d("ScotchConstants").PayloadType.ACK:a.msg.ack_type===d("ScotchConstants").PayloadType.VIDEO_REQUEST&&d("ScotchRTCP2PCallEscalationActions").handleACK(a.ackID.toString());break}};e.$8=function(b){i("P2P Escalator %o","parse response",b);var e=b.ackID.toString();c("ScotchRTCP2PCallEscalationStore").getToken()===e&&this.$10(b);d("ScotchRTCP2PCallEscalationActions").parseResponse(a.requestVideoOn(b.msg),e);window.clearTimeout(this.$5)};e.$9=function(b){i("P2P Escalator %o","parse request",b);if(c("ScotchRTCP2PCallEscalationStore").isInProgress()&&!a.requestVideoOn(b.msg)){c("ScotchRTCP2PCallEscalationStore").didCurrentUserInitiate()?d("ScotchRTCP2PCallEscalationActions").cancel():(this.$10(b),d("ScotchRTCP2PCallEscalationActions").setRequest(b));return}if(c("ScotchRTCP2PCallEscalationStore").isInProgress()&&c("ScotchRTCP2PCallEscalationStore").didCurrentUserInitiate()){i("P2P Escalator %o","auto-approve","mutual consent");d("ScotchRTCP2PCallEscalationActions").approve();this.$10(b);this.generateResponseToken(b,!0);return}if(c("ScotchRTCP2PCallEscalationStore").isEscalated()){a.requestVideoOn(b.msg)?(i("P2P Escalator %o","auto-approve"),this.$10(b),this.generateResponseToken(b,!0),window.clearTimeout(this.$5)):(i("P2P Escalator %o","mute remote video"),d("ScotchRTCP2PCallEscalationActions").muteRemoteVideo());return}i("P2P Escalator %o %o","request",b);this.$10(b);d("ScotchRTCP2PCallEscalationActions").setRequest(b)};e.$10=function(a){var b=a.peerID,c=a.callID;a=a.msg;i("P2P Escalator %o","ACK","sent");this.$2.sendAck(b,c,a)};a.requestVideoOn=function(a){var b=a.reqVideoOn;a=a.videoon;return Boolean(b||a)};a.initEscalation=function(){var a=c("ScotchRTCP2PCallStore").getState(),e=a.protocolHandler;a=c("ScotchRTCCallStore").getState();a=a.localUser;var f=a.getStream();a=a.hasVideo();return(f&&a?b("Promise").resolve(f).then(function(a){e.updateLocalVideoTracker();return a}):c("ScotchRTCP2PProtocolHandler").initStream(!0).then(function(a){e.startLocalVideoTracker(a);return a})).then(function(a){d("ScotchRTCP2PCallEscalationActions").setEscalateToMediaStream(a);d("ScotchRTCP2PCallEscalationActions").start();return a})};a.onEscalationSucceeded=function(){var b=c("ScotchRTCP2PCallEscalationStore").getEscalateMediaStream(),d=c("ScotchRTCCallStore").getState();d=d.localUser;if(d.getStream()===b){var e=c("ScotchRTCCallStore").getState();e=e.remoteUsers;d.toggleDisableVideo(!1);e.first()&&e.first().toggleDisableVideo(!1)}else b&&c("dangerouslyBypassDispatchError")(function(){a.updateEscalationStream(b)})};a.onEscalationFailed=function(){var a=c("ScotchRTCP2PCallEscalationStore").getEscalateMediaStream(),b=c("ScotchRTCCallStore").getState();b=b.localUser;if(b.getStream()===a){var e=c("ScotchRTCCallStore").getState();e=e.remoteUsers;b.toggleDisableVideo(!0);e.first()&&e.first().toggleDisableVideo(!0)}else if(a){d("ScotchRTCUtils").stopMediaStream(a);b=c("ScotchRTCP2PCallStore").getState();e=b.protocolHandler;e.updateLocalVideoTracker()}};a.acceptEscalation=function(e){var f=c("ScotchRTCCallStore").getState(),g=f.localUser;f=f.remoteUsers;e=Boolean(e==null?void 0:e.muteVideo);if(g.hasVideo()){g.toggleDisableVideo(e);f.first()&&f.first().toggleDisableVideo(!1);f=c("ScotchRTCP2PCallStore").getState();f=f.protocolHandler;f.updateLocalVideoTracker();d("ScotchRTCP2PCallEscalationActions").setResponse(!0);return b("Promise").resolve(g.streams.first())}else return c("ScotchRTCP2PProtocolHandler").initStream(!e).then(function(b){d("ScotchRTCP2PCallEscalationActions").setResponse(!0);a.updateEscalationStream(b);return b})};a.declineEscalation=function(){d("ScotchRTCP2PCallEscalationActions").setResponse(!1)};a.updateEscalationStream=function(a){var b=c("ScotchRTCCallStore").getState().localUser.getStream();if(c("ScotchFBRTCPeerConnection").shouldUseAddTrackForUnifiedPlan()&&b){for(var d=a.getVideoTracks(),e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{f=d.next();if(f.done)break;g=f.value}g=g;b.addTrack(g)}g=c("ScotchRTCP2PCallStore").getState();f=g.protocolHandler;f.updateStreamForUnifiedPlan(b)}else c("ScotchRTCP2PProtocolHandler").replaceLocalStream(a)};return a}();a.ACK_TIMEOUT=h;function i(){}g["default"]=a}),98);
__d("ScotchFBRTCStatsHelpers",["Promise"],(function(a,b,c,d,e,f){var g=!1,h=function(a){if(a==="host"||a==="local")return"local";if(a==="serverreflexive"||a==="srflx")return"srflx";if(a==="peerreflexive"||a==="prflx")return"prflx";return a==="relayed"||a==="relay"?"relay":"unknown_"+a},i={UNKNOWN_CONNECTION:"l:unknown-unknown;r:unknown-unknown",connectionType:function(a,b,c,d){return a!==null&&a!==void 0&&b!==null&&c!==null&&c!==void 0&&d!==null?["l:",h(a),"-",b,";","r:",h(c),"-",d].join(""):null},getVideoCapabilitiesInfo:function(a){a=a.getVideoTracks();a=a[0];if(a==null)return null;if(typeof a.getCapabilities!=="function")return null;a=a.getCapabilities();var b=a.aspectRatio,c=a.facingMode,d=a.frameRate,e=a.height;a=a.width;return{facing_mode:(c=c)!=null?c:null,max_aspect_ratio:(c=b==null?void 0:b.max)!=null?c:null,max_frame_rate:(c=d==null?void 0:d.max)!=null?c:null,max_height:(d=e==null?void 0:e.max)!=null?d:null,max_width:(c=a==null?void 0:a.max)!=null?c:null,min_aspect_ratio:(e=b==null?void 0:b.min)!=null?e:null}},getMediaInputs:function(a){var b={audio_inputs:[],video_inputs:[]};a.forEach(function(a){switch(a.kind){case"videoinput":b.video_inputs.push(a.label);break;case"audioinput":b.audio_inputs.push(a.label);break}});return b},logCapabilities:function(a,b,c){a.setVideoCapabilities(i.getVideoCapabilitiesInfo(b)),a.setMediaInputs(i.getMediaInputs(c))},internalGetWindow:function(){return window},getBatteryStats:function(){return new(b("Promise"))(function(a,b){var c=i.internalGetWindow().navigator.getBattery;typeof c==="function"?a(c.call(navigator)):b()}).then(function(a){a.charging?g=!0:a.onchargingchange=function(a){a.target.charging&&(g=!0),a.target.onchargingchange=null};return{level:a.level*100,wasCharged:g}})["catch"](function(){return{placeholder:!0,level:-1,wasCharged:!1}})}};a=i;f["default"]=a}),66);
__d("ScotchMessengerChatLinksFunnelLogger",["UserAgentData","WebFunnelLogger"],(function(a,b,c,d,e,f,g){"use strict";var h="MessengerVideoChatLinksFunnelDefinition",i="defaultSessionKey",j="marker",k="link_hash:",l,m;function a(a){var b=o(),c=n();a&&(m=c=[].concat(c,a));b.setFunnelTags(c);b.markStart().setAction(j).log()}function n(){var a={bn:c("UserAgentData").browserName,bv:c("UserAgentData").browserVersion,os:c("UserAgentData").platformName},b=Object.keys(a).map(function(b){return b+":"+((b=a[b])!=null?b:"unknown")});return b}function b(a){return k+a}function d(a,b){var c=o();c.setAction(a);b&&b.actionTag&&c.setActionTag(b.actionTag);b&&b.funnelTags&&(m=(m||[]).concat(b.funnelTags),c.setFunnelTags(m));c.log()}function e(a){l=(a=a)!=null?a:i}function o(){return new(c("WebFunnelLogger"))(h).setSessionKey(l)}g.startFunnel=a;g.getLinkHashTag=b;g.appendAction=d;g.setSessionKey=e}),98);
__d("XGroupCallSendRequestController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/groupcall/sendrequest/",{av:{type:"FBID"},webrtc_fbtrace:{type:"Int"}})}),null);
__d("ScotchMultiwayRequests",["AsyncRequest","FBLogger","FBRTCMessageType","Promise","ScotchFBRTCMultiwayMessage","ScotchFBRTCUserCapabilities","ScotchMWDeviceCapabilities","ScotchRTCLogger","ScotchRTCUtils","ScotchRTWebUserActionLogger","XGroupCallSendRequestController","ZenonScreenSharingConstants"],(function(a,b,c,d,e,f,g){"use strict";var h=15e3;a=function(){function a(){}var e=a.prototype;e.sendJoinRequest=function(a,b,e,f,g,h,i,j,k){var l=i.callID,m=i.numParticipants;i=i.callTrigger;var n=j.userToEscalate,o=j.isEscalator;j=j.escP2PCallID;b=d("ScotchRTCUtils").createRequestHeader(c("FBRTCMessageType").JOIN,b,e,l,j);e={offer:{sdpString:f.toSdp()},deviceCapabilities:d("ScotchMWDeviceCapabilities").getDeviceCapabilities()};k!=null&&(e.syncPayload={stateStore:k});l=d("ScotchRTCUtils").createClientContextMessage(m,i?i:"");e.appMessages=[l];g&&g.length>0&&!n&&(e.usersToCall=g);n&&o&&(e.userToEscalate=n);h&&(e.mediaStatus=h);j=c("ScotchFBRTCUserCapabilities").getLocal();if(j.length>0){var p={};j.forEach(function(a){return p[a]=!0});e.userCapabilities=JSON.stringify(p)}f={joinRequest:e};k=this.$1(a,b,f);return this.$2(k)};e.sendHangupRequest=function(a,b,e,f,g,h){(e==null||e==="")&&c("FBLogger")("rtc_hangup_debug").warn("serverInfoData null when hanging up call: %s, conf: %s, reason: %s",h,b,g);b=d("ScotchRTCUtils").createRequestHeader(c("FBRTCMessageType").HANGUP,b,e,h);e={reason:f,detailedReasonString:g};h={hangupRequest:e};f=this.$1(a,b,h);return this.$2(f)};e.sendAddParticipantsRequest=function(a,b,e,f,g){b=d("ScotchRTCUtils").createRequestHeader(c("FBRTCMessageType").ADD_PARTICIPANTS,b,e,g);e={usersToInvite:f};g={addParticipantsRequest:e};f=this.$1(a,b,g);return this.$2(f)};e.sendRemoveParticipantsRequest=function(a,b,e,f,g){b=d("ScotchRTCUtils").createRequestHeader(c("FBRTCMessageType").REMOVE_PARTICIPANTS,b,e,g);e={usersToRemove:f};g={removeParticipantsRequest:e};f=this.$1(a,b,g);return this.$2(f)};e.sendStartScreenSharingRequest=function(a,b,c,e,f,g){return this.sendGenericDataMessageRequest(a,b,c,e,f,g,[],d("ZenonScreenSharingConstants").ZenonScreenSharingDataMessageTopic.Start,JSON.stringify((a={},a[d("ZenonScreenSharingConstants").SCREEN_SHARE_DATA_USER_ID_KEY]=f,a)))};e.sendEndScreenSharingRequest=function(a,b,c,e,f,g){return this.sendGenericDataMessageRequest(a,b,c,e,f,g,[],d("ZenonScreenSharingConstants").ZenonScreenSharingDataMessageTopic.End,JSON.stringify((a={},a[d("ZenonScreenSharingConstants").SCREEN_SHARE_DATA_USER_ID_KEY]=f,a)))};e.sendGenericDataMessageRequest=function(a,b,e,f,g,h,i,j,k){b=d("ScotchRTCUtils").createRequestHeader(c("FBRTCMessageType").DATA_MESSAGE,b,e,f);e={message:{body:{genericMessage:{data:k,topic:j}},header:{recipients:h,sender:g,serviceRecipients:i,topic_DEPRECATED:""}}};f={dataMessageRequest:e};k=this.$1(a,b,f);return this.$2(k)};e.sendSubscriptionRequest=function(a,b,e,f,g){b=d("ScotchRTCUtils").createRequestHeader(c("FBRTCMessageType").SUBSCRIPTION,b,e,g);e={subscriptions:f};g={subscriptionRequest:e};f=this.$1(a,b,g);return this.$2(f)};e.sendClientMediaUpdateRequest=function(a,b,e,f,g,h,i,j){b=d("ScotchRTCUtils").createRequestHeader(c("FBRTCMessageType").CLIENT_MEDIA_UPDATE,b,e,i);e={fromVersion:f,toVersion:g,mediaUpdates:h};j!=null&&(e.offer={sdpString:j.toSdp()});i={clientMediaUpdateRequest:e};f=this.$1(a,b,i);return this.$2(f)};e.sendUpdateRequest=function(a,b,e,f,g,h,i){b=d("ScotchRTCUtils").createRequestHeader(c("FBRTCMessageType").UPDATE,b,e,f);e={topic:g,version:h};i!=null&&(e.data=i);f={updateRequest:e};g=this.$1(a,b,f);return this.$2(g)};e.sendUnsubscribeRequest=function(a,b,e,f,g,h){b=d("ScotchRTCUtils").createRequestHeader(c("FBRTCMessageType").UNSUBSCRIBE,b,e,f);e={topic:g,version:h};f={unsubscribeRequest:e};g=this.$1(a,b,f);return this.$2(g)};e.sendApprovalRequest=function(a,b,e,f,g,h){b=d("ScotchRTCUtils").createRequestHeader(c("FBRTCMessageType").APPROVAL,b,e,f);e={targetUsers:g,approvalStatus:h};f={approvalRequest:e};g=this.$1(a,b,f);return this.$2(g)};e.$2=function(a){var d=a.jsonPayload.header,e=d.conferenceName;d=d.type;e||c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"ScotchMultiwayRequests._sendMessage: no conference name. Msg type: "+c("ScotchRTCLogger").multiwayMessageTypeName(d)});return new(b("Promise"))(function(b,d){var e=c("XGroupCallSendRequestController").getURIBuilder().getURI(),f=new(c("ScotchFBRTCMultiwayMessage"))(a);c("ScotchRTCLogger").getInstance().logSendingMultiwayMessage(f);e=new(c("AsyncRequest"))(e).setMethod("POST").setData({request:JSON.stringify(a)}).setAllowCrossPageTransition(!0).setHandler(function(a){c("ScotchRTCLogger").getInstance().logMultiwayResponseReceived(a.payload,f.header().clientSessionId),c("ScotchRTCLogger").getInstance().logSentMultiwayMessage(f),b(a.payload)}).setErrorHandler(function(a){c("ScotchRTCLogger").getInstance().logSendMultiwayMessageFailed(f);a=a.getErrorDescription();a=a!=null?a.toString():"AsyncRequest error";c("ScotchRTWebUserActionLogger").logError({errorDomain:"ScotchMultiwayRequests._sendMessage error: "+a});a=Error(a);d(a)}).setTimeoutHandler(h,function(){c("ScotchRTCLogger").getInstance().logSendMultiwayMessageFailed(f),d("timeout")});e.send()})};e.$1=function(a,b,c){return{endpoint:a,jsonPayload:{header:b,body:c}}};return a}();e=new a();g["default"]=e}),98);
__d("ZenonRTCVideoResolutionHelper",["gkx","qex","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h=!1,i=10;a=function(){function a(){}a.getMaxParticipants180=function(){return 100};a.getMaxParticipants360=function(){var a=c("qex")._("2005645");(a==null||a<=2)&&(a=7);return a};a.getMaxParticipants720=function(){return 2};a.shouldUseSupportedScaleFactorList=function(){var a;return(a=c("gkx")("1742654"))!=null?a:!1};a.shouldUseConservativeWayWhenSearchingForScalingRatio=function(){var a;return(a=c("gkx")("536"))!=null?a:!1};a.bitrateCappingEnabled=function(){return!0};a.getMaxBitrate720=function(){var a;return(a=c("qex")._("1850350"))!=null?a:3e6};a.getMaxBitrate360=function(){var a;return(a=c("qex")._("1850351"))!=null?a:1e6};a.getMaxBitrate180=function(){var a;return(a=c("qex")._("1850352"))!=null?a:3e5};a.getMaxBitrateForResolution=function(b){if(!a.bitrateCappingEnabled())return 0;if(b===180)return a.getMaxBitrate180();if(b===360)return a.getMaxBitrate360();return b===720?a.getMaxBitrate720():0};a.getMaxEncResolution=function(b){if(!a.encoderScalingEnabled())return null;var c=a.getMaxParticipants720(),d=a.getMaxParticipants360(),e=a.getMaxParticipants180(),f={height:720,width:1280},g={height:360,width:640},h={height:180,width:320};if(c>0&&b<=c)return f;if(d>0&&b<=d)return g;if(e>0&&b<=e)return h;if(e>0)return h;if(d>0)return g;return c>0?f:null};a.getMaxEncResolutionSimulcast=function(b,d,e,f){var g={height:720,width:1280},h={height:360,width:640},i={height:180,width:320};if(d<=e&&e<=2&&d>=0&&d<f){if(f===1)return a.getMaxEncResolution(b);if(f===2)if(d===0){if((e=c("qex")._("353"))!=null?e:!1)return h;else return i}else return b>2?h:g;if(f===3)if(d===0)return i;else if(d===1)return h;else if(d===2)return g}c("recoverableViolation")("Unsupported simulcast parameters passed to getMaxEncResolutionSimulcast","rtc_www");return null};a.getScalingFactor=function(b,c,d,e,f){f===void 0&&(f=!1);if(b.width==null||b.width<=0||b.height==null||b.height<=0||c.width==null||c.width<=0||c.height==null||c.height<=0)return null;var g=c.width;c=c.height;var h=b.width;b=b.height;if(f){f=[1,2,4];var i=Math.sqrt(g*c/(h*b));if(i<1+e)return 1;var j=1,k=Number.MAX_VALUE;for(var l=0;l<f.length;l++){var m=f[l],n=Math.abs(m-i);(a.shouldUseConservativeWayWhenSearchingForScalingRatio()?n<k:n<=k)&&Math.floor(g/m)%2===0&&Math.floor(c/m)%2===0&&(j=m,k=Math.abs(m-i))}return j}else{n=Math.sqrt(g*c/(h*b));if(n<1+e)return 1;return d?Math.floor(n+e):n}};a.encoderScalingEnabled=function(){return c("gkx")("1808893")};a.maybeLimitEncodingResolutionByParticipantCountHelper=function(b,c,d,e,f,g){g===void 0&&(g=!1);if(!a.encoderScalingEnabled()||f)return;if(d!=null&&d.length>0){f=d.filter(function(a){var b;return((b=a.receiver.track)==null?void 0:b.kind)==="video"&&a.currentDirection!=="inactive"&&((b=a.receiver.track)==null?void 0:b.readyState)==="live"});d=f.length;g&&(d-=1)}else{f=c.filter(function(a){return((a=a.track)==null?void 0:a.kind)==="video"});g=f.length;d=g+1}c=a.getMaxEncResolution(d);if(!c)return;f=[c];a.maybeLimitEncodingResolution(b,f,h,i/100,e,a.shouldUseSupportedScaleFactorList())};a.maybeLimitEncodingResolution=function(b,c,d,e,f,g){g===void 0&&(g=!1);b=b.filter(function(a){return((a=a.track)==null?void 0:a.kind)==="video"});if(b.length>0){var h;b=b[0];var i=b.getParameters();h=(h=b.track)==null?void 0:h.getSettings();if(!h)return;if(i.encodings==null||c.length!==i.encodings.length)return;for(var c=c.entries(),j=Array.isArray(c),k=0,c=j?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var l;if(j){if(k>=c.length)break;l=c[k++]}else{k=c.next();if(k.done)break;l=k.value}l=l;var m=l[0];l=l[1];var n=f?1:a.getScalingFactor(l,{height:h.height,width:h.width},d,e,g);if(n==null)continue;n===1?delete i.encodings[m].scaleResolutionDownBy:i.encodings[m].scaleResolutionDownBy=n;if(!f&&l.width!=null&&l.height!=null){n=Math.min(l.width,l.height);l=a.getMaxBitrateForResolution(n);l>0&&(i.encodings[m].maxBitrate=l)}else f&&delete i.encodings[m].maxBitrate}b.setParameters(i)}};a.maybeLimitEncodingResolutionByParticipantCount=function(b,c,d,e,f){f===void 0&&(f=!1);return a.maybeLimitEncodingResolutionByParticipantCountHelper(b,c,d,a.$1>0,e,f)};a.handleStartScreenSharing=function(b,c,d,e){a.$1++;return a.maybeLimitEncodingResolutionByParticipantCountHelper(b,c,d,a.$1>0,e)};a.handleStopScreenSharing=function(b,c,d,e){a.$1--;return a.maybeLimitEncodingResolutionByParticipantCountHelper(b,c,d,a.$1>0,e)};return a}();a.$1=0;g["default"]=a}),98);
__d("ScotchRTCMWProtocolHandler",["invariant","ChannelManager","CurrentUser","DateConsts","FBLogger","FBRTCRtcResponseStatusCode","MercuryIDs","Promise","ScotchConstants","ScotchFBRTCCallSummary","ScotchFBRTCCallSummaryStore","ScotchFBRTCGroupCallStore","ScotchFBRTCMWProtocolStore","ScotchFBRTCMediaMetricParser","ScotchFBRTCPeerConnection","ScotchFBRTCSdpUtils","ScotchFBRTCStatsHelpers","ScotchMessengerChatLinksFunnelLogger","ScotchMultiwayParticipantFetcher","ScotchMultiwayRequests","ScotchRTCAppData","ScotchRTCCallActions","ScotchRTCCallStore","ScotchRTCGroupCallActions","ScotchRTCGroupCallEscalationStore","ScotchRTCLogger","ScotchRTCMultiwayMessageHandler","ScotchRTCProxyUserStore","ScotchRTCProxyUserUtils","ScotchRTCSessionDescription","ScotchRTCSignalingExperiments","ScotchRTCUtils","ScotchRTWebClientFeatureGating","ScotchRTWebExperiments","ScotchRTWebUserActionLogger","ScotchgenerateRTCCallID","UserAgent","ZenonLocalMediaSDK","ZenonPeerID","ZenonPlatformExperiments","ZenonRTCVideoResolutionHelper","ZenonRTWebBrowserFeatureSupport","ZenonTSLogDataHelper","cr:1420073","emptyFunction","gkx","immutable","promiseDone","recoverableViolation","regeneratorRuntime","throttle"],(function(a,b,c,d,e,f,g,h){"use strict";var i=30*d("DateConsts").MS_PER_SEC,j={appId:d("ScotchRTCAppData").getMWAppID(),deviceId:d("ChannelManager").getCompleteConfig().sessionID,userId:c("CurrentUser").getID()};a=250;var k=!1,l=null,m=function(){function a(a){var b=this;this.$5=null;this.$7=!1;this.$8=!1;this.$9=!1;this.$10=c("ScotchRTCLogger").getInstance();this.$15=function(a){a=a.target;a=a.iceConnectionState;c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"RTCMWProtocolHandler_PC_iceconnectionstatechange: "+a});c("ScotchRTCCallActions").emit("onIceConnectionStateChange",a);var e=c("ScotchRTCCallStore").getState();e=e.callSummary;e==null?void 0:e.setPCIsConnected(a==="completed"||a==="connected");c("gkx")("965758")&&d("ZenonTSLogDataHelper").onIceConnectionStateChange(a);switch(a){case"completed":case"connected":c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"Clearing iceConnectionState disconnection timer"});window.clearTimeout(b.$5);b.$5=null;c("ScotchRTCLogger").getInstance().logMultiwayRelayConnected(c("ScotchRTCCallStore").getState().callInfo.conferenceName,c("ScotchRTCCallStore").getState().callInfo.serverInfoData,b.$3.toString());e==null?void 0:e.onNetworkReady();d("ScotchFBRTCMediaMetricParser").startCollectingMediaStats();break;case"disconnected":case"failed":b.$5==null&&(c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"Setting iceConnectionState disconnection timer"}),b.$5=window.setTimeout(function(){c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"Ending call due to iceConnectionState disconnection timeout"}),c("ScotchRTCCallActions").endCall(d("ScotchConstants").CallEndReason.CONNECTION_DROPPED,"ConnectionDropped"),b.$22()},i));break}e==null?void 0:e.save(c("ScotchFBRTCCallSummaryStore").getInstance())};this.$3=(a=a)!=null?a:c("ScotchgenerateRTCCallID")();this.$4=d("ZenonPeerID").ZenonMWPeerID}var e=a.prototype;e.setKeepLocalStreamsOnClose=function(a){this.$8=a;return this};e.setAllowIncomingCalls=function(a){this.$9=a;return this};e.startCall=function(b,e,f,g){var h=this,i=g.addStreamCallback;i=i===void 0?c("emptyFunction"):i;var j=g.callTrigger,k=g.formatParameters;k=k===void 0?{}:k;var l=g.preferredCodecs;l=l===void 0?{}:l;var m=g.offerSdpTransform,n=g.serverInfoData,o=g.shouldSetDescriptions;o=o===void 0?!0:o;var p=g.isEscalatedCall;p=p===void 0?!1:p;var q=g.connectedOnJoin;q=q===void 0?!1:q;var r=g.escP2PCallID;r=r===void 0?"":r;g=g.initialSyncStates;g=g===void 0?null:g;c("ScotchRTCCallActions").initialize({protocol:d("ScotchConstants").SignalingProtocol.MULTIWAY,conferenceName:f,serverInfoData:n,callID:this.$3.toString(),callTrigger:j});d("ScotchMessengerChatLinksFunnelLogger").appendAction("init_mw_call",{funnelTags:["conf_name:"+f,"call_id:"+this.$3]});var s=c("ScotchFBRTCCallSummary").restoreOrInitialize(c("ScotchFBRTCCallSummaryStore").getInstance(),this.$4,this.$3,!1);j&&s.onCallStarted(j);s.setJoinWithSID(n!=null);s.setActiveConnection("mws");s.setCallType("mws");s.onPopupOpened();s.setConferenceName(f);s.setServerInfoData(n);if(p){var t=c("ScotchRTCCallStore").getState().callSummary;s.setEscalationP2PCallID(t.callID)}this.$11(s);s.save(c("ScotchFBRTCCallSummaryStore").getInstance());c("ScotchRTCCallActions").setCallSummary(s);t={mandatory:{},optional:[{DtlsSrtpKeyAgreement:!0},{googNumUnsignalledRecvStreams:10},{RtpDataChannels:!0}]};var u=new(c("ScotchFBRTCPeerConnection"))(d("ScotchConstants").SignalingProtocol.MULTIWAY,{iceServers:[]},t);if(f.split(":")[0]!=="LIVE"&&!(c("UserAgent").isBrowser("Safari")||c("UserAgent").isBrowser("Mobile Safari"))){t=u.createDataChannel("data");t&&(t.onmessage=function(a){a=a.data;try{a=JSON.parse(a);a=a.body;h.$12(a)}catch(a){h.$10.logError(h.$4,h.$3,a)}})}u.getSdpSemantics()===d("ScotchConstants").SDPSemantics.UNIFIED_PLAN?u.addEventListener("track",function(b){h.$13(f,u,b),a.maybeLimitEncodingResolutionByParticipantCount(u)}):u.addEventListener("addstream",function(b){h.$14(f,b.stream),a.maybeLimitEncodingResolutionByParticipantCount(u),a.updateLocalEncodingActive(u,c("ScotchFBRTCGroupCallStore").getState().forceEncodingEnabled)});u.addEventListener("removestream",function(b){c("ScotchRTCCallActions").removeRemoteStream(b.stream),a.maybeLimitEncodingResolutionByParticipantCount(u),a.updateLocalEncodingActive(u,c("ScotchFBRTCGroupCallStore").getState().forceEncodingEnabled)});u.addEventListener("iceconnectionstatechange",this.$15);this.$16(u,e,f,n,b,i,k,l,o,p,q,r,j?j:s.getCallTrigger(),m,g);!n?c("ScotchRTCCallActions").call(b,u):c("ScotchRTCCallActions").join(u);c("gkx")("965758")&&c("ScotchRTWebUserActionLogger").logCheckpoint({callID:this.$3.toString(),checkpoint:"[Scotch] Eligible for tslog logging",conferenceName:f,callType:"mw"});return u};e.$11=function(a){c("promiseDone")(c("ScotchFBRTCStatsHelpers").getBatteryStats(),function(b){a.addExtraInfo(c("ScotchRTCLogger").Key.BATTERY_START,b.level)})};e.$13=function(b,e,f){c("ScotchRTWebUserActionLogger").logCheckpoint({callID:this.$3.toString(),checkpoint:"ScotchRTCMWProtocolHandler_onAddTrack",conferenceName:b});a.resubscribeToRemoteFbids();if(e.getSdpSemantics()===d("ScotchConstants").SDPSemantics.UNIFIED_PLAN){var g,h;h=(h=f)!=null?(h=h.track)!=null?h.id:h:h;g=(g=f)!=null?(g=g.transceiver)!=null?g.mid:g:g;if(g===void 0){var i;g=(i=f.target.getTransceivers().find(function(a){return a.receiver===f.transceiver.receiver}))==null?void 0:i.mid}e.processUnifiedTrackIdTranslation(h,g)}f.streams.length>0&&this.$14(b,f.streams[0])};e.$14=function(b,e){var f=this;c("ScotchRTWebUserActionLogger").logCheckpoint({callID:this.$3.toString(),checkpoint:"ScotchRTCMWProtocolHandler_onAddStream. Stream id="+e.id,conferenceName:b});e.addEventListener("addtrack",function(){a.resubscribeToRemoteFbids()});var g=e.id.split(":")[0],h=d("MercuryIDs").getParticipantIDFromUserID(g);if(g!==c("CurrentUser").getID()){g=d("ScotchRTCProxyUserUtils").getUserIDToFetch(g);var i=c("ScotchRTCProxyUserStore").getState();i=i.proxyingAsToProxyUser;c("promiseDone")(d("ScotchMultiwayParticipantFetcher").fetchAllParticipants(b,c("immutable").Set([g]),{proxyingAsToProxyUser:i}),function(a){a=a.get(h);f.$17(h,a,e)})}};e.$17=function(b,e,f){var g={};g[b]=e;d("ScotchRTCGroupCallActions").onParticipantsAdded(g);c("ScotchRTCCallActions").addRemoteStream(f);a.resubscribeToRemoteFbids()};e.$12=function(a){a.dominantSpeakerNotification&&this.$18(a.dominantSpeakerNotification)};e.setDescriptions=function(){this.$7=!0;var a=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.MULTIWAY);this.$6&&a&&a.setRemoteDescription(this.$6)};a.maybeLimitEncodingResolutionByParticipantCount=function(a){c("ZenonRTCVideoResolutionHelper").maybeLimitEncodingResolutionByParticipantCount(a.getSenders(),a.getReceivers(),[],k)};a.escalateLocalStream=function(e){e===void 0&&(e=!0);var f=c("ScotchFBRTCGroupCallStore").getState();f=f.videoEscalateState;if(e&&f!=="initial")return b("Promise").resolve();d("ScotchRTCGroupCallActions").videoEscalationStarted();return a.initStream(e).then(function(a){var b=c("ScotchRTCCallStore").getState(),f=b.callInfo,g=f.conferenceName;f=f.serverInfoData;var h=b.localUser;b=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.MULTIWAY);if(!b)return;var i=null;e&&(a.getTracks().forEach(function(a){a.kind==="audio"&&(a.enabled=!h.isAudioDisabled())}),i=h.streams.first(),b.removeStream(i));return o(b,[a],g,f,[]).then(function(){i&&c("ScotchRTCCallActions").removeLocalStream(i),c("ScotchRTCCallActions").addLocalStream(a),d("ScotchRTCGroupCallActions").videoEscalationCompleted()})})["catch"](function(a){c("ScotchRTWebUserActionLogger").logError({errorDomain:"ScotchFBRTCPeerConnection_escalateLocalStream",errorType:a.toString()}),d("ScotchRTCGroupCallActions").resetVideoEscalation()})};e.onStreamReady=function(a,b,e,f,g){var h={};f||c("ScotchRTCCallActions").addLocalStream(a);h.isEscalatedCall=f;g.p2pCallID&&(h.escP2PCallID=g.p2pCallID);g.serverInfoData&&(h.serverInfoData=g.serverInfoData);g.callTrigger&&(h.callTrigger=g.callTrigger);d("ScotchRTWebClientFeatureGating").preferIsacForGroupCalls()&&(h.preferredCodecs={audio:"ISAC/16000"});this.startCall(b,[a],e,h)};a.initStream=function(a,c){var d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c===void 0&&(c=!0);e.next=3;return b("regeneratorRuntime").awrap(n(a,c));case 3:d=e.sent;return e.abrupt("return",d);case 5:case"end":return e.stop()}},null,this)};a.updateLocalStream=function(e,f){f===void 0&&(f=!1);var g=c("ScotchRTCCallStore").getState(),h=g.callInfo,i=h.callID,j=h.conferenceName;h=h.serverInfoData;g=g.localUser;var k=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.MULTIWAY);if(!k)return b("Promise").resolve();if(d("ZenonRTWebBrowserFeatureSupport").isReplaceTrackSupported()){c("ScotchRTWebUserActionLogger").logCheckpoint({callID:i,checkpoint:"ScotchRTCMWProtocolHandler_updateLocalStream: use replaceTrack to swap media tracks",conferenceName:j});var l=f?g.getStream():g.getActiveStream();if(l!=null){var m=[],n=l.getAudioTracks(),p=n[0];n=l.getVideoTracks();var q=n[0];l=e.getAudioTracks();var r=l[0];n=e.getVideoTracks();var s=n[0];r!=null&&p!=null&&m.push(k.replaceTrack(r,p).then(function(){d("ScotchRTCGroupCallActions").onLocalTrackReplaced(r,p)}));s!=null&&q!=null&&g.hasVideo()&&!g.hasScreenStream()&&m.push(k.replaceTrack(s,q).then(function(){d("ScotchRTCGroupCallActions").onLocalTrackReplaced(s,q),a.maybeLimitEncodingResolutionByParticipantCount(k)}));return b("Promise").all(m).then(function(){c("ScotchRTWebUserActionLogger").logCheckpoint({callID:i,checkpoint:"ScotchRTCMWProtocolHandler_updateLocalStream: dispatch actions to Flux store",conferenceName:j}),c("ScotchRTCCallActions").removeAllLocalStreams(f===!1),c("ScotchRTCCallActions").addLocalStream(e)})["catch"](function(a){c("ScotchRTWebUserActionLogger").logError({errorDomain:"ScotchRTCMWProtocolHandler_updateLocalStream",errorType:a.message})})}}return o(k,[e],j,h,[]).then(function(){c("ScotchRTCCallActions").removeAllLocalStreams(!0),c("ScotchRTCCallActions").addLocalStream(e)})};a.updateLocalEncodingActive=function(a,d){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:if(!c("gkx")("1923585")){i.next=2;break}return i.abrupt("return");case 2:e=a.getRemoteStreams().length;f=e>0||d;g=!1;h=Date.now();i.next=8;return b("regeneratorRuntime").awrap(b("Promise").all(a.getSenders().map(function(a){var d,e;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.prev=0;d=a.getParameters();for(e=0;e<d.encodings.length;e++)!g&&d.encodings[e].active&&(g=!0),(e===0||!f)&&d.encodings[e].active!==f&&(d.encodings[e].active=f);h.next=5;return b("regeneratorRuntime").awrap(a.setParameters(d));case 5:h.next=10;break;case 7:h.prev=7,h.t0=h["catch"](0),c("FBLogger")("rtc_www").catching(h.t0).mustfix("Error while trying to toggle encoding");case 10:case"end":return h.stop()}},null,this,[[0,7]])})));case 8:g!==f&&c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"[Scotch]: Encoding set: "+JSON.stringify({active:f,time:Date.now()-h,prevNumRemoteStreams:e,numRemoteStreams:a.getRemoteStreams().length})});case 9:case"end":return i.stop()}},null,this)};a.startScreenStream=function(a){var e=c("ScotchRTCCallStore").getState(),f=e.callInfo,g=f.callID,i=f.conferenceName;f=f.serverInfoData;var j=e.localUser;e=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.MULTIWAY);var l=c("ScotchFBRTCMWProtocolStore").getState(),m=l.localScreenDurationTracker;if(!e)return;d("ZenonRTWebBrowserFeatureSupport").isReplaceTrackSupported()||h(0,21463);c("ZenonRTCVideoResolutionHelper").handleStartScreenSharing(e.getSenders(),e.getReceivers(),[],k);l=e.getSenders().find(function(a){return a.track&&a.track.kind==="video"});var n=l==null?void 0:l.track;if(l===void 0||!n){var p=j.getStream();p!=null&&d("ScotchRTCUtils").transferAudioTracks(a,p);p=o(e,[a],i,f,[])}else p=b("Promise").resolve(l.replaceTrack(a.getVideoTracks()[0])).then(function(){d("ScotchRTCGroupCallActions").onLocalTrackReplaced(a.getVideoTracks()[0],n)});c("promiseDone")(p,function(){for(var b=j.screenStreams,e=Array.isArray(b),f=0,b=e?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(e){if(f>=b.length)break;h=b[f++]}else{f=b.next();if(f.done)break;h=f.value}h=h;h!==a&&(c("ScotchRTCCallActions").removeLocalScreenStream(h),d("ScotchRTCUtils").stopMediaStream(h))}m.track(a);!m.isStarted()?m.start():m.update();c("ScotchRTCCallActions").addLocalScreenStream(a);c("ScotchRTWebUserActionLogger").logCheckpoint({callID:g,checkpoint:"screen_sharing_started",conferenceName:i})})};a.updateScreenStream=function(b,c){a.startScreenStream(c)};a.replaceScreenTrackWithVideo=function(a,d,e){if(!c("ZenonRTCVideoResolutionHelper").encoderScalingEnabled())a.replaceTrack(d);else{a=b("Promise").resolve(a.replaceTrack(d));c("promiseDone")(a,function(){c("ZenonRTCVideoResolutionHelper").handleStopScreenSharing(e.getSenders(),e.getReceivers(),[],k)},function(a){c("ZenonRTCVideoResolutionHelper").handleStopScreenSharing(e.getSenders(),e.getReceivers(),[],k)})}};a.stopScreenStream=function(b){var e,f=c("ScotchRTCCallStore").getState(),g=f.callInfo;f=f.localUser;var i=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.MULTIWAY),j=c("ScotchFBRTCMWProtocolStore").getState();j=j.localScreenDurationTracker;if(!i)return;d("ZenonRTWebBrowserFeatureSupport").isReplaceTrackSupported()||h(0,21463);e=(e=f.getStream())==null?void 0:e.getVideoTracks();if(e&&e.length>0){var k=i.getSenders().filter(function(a){return a.track&&a.track.kind==="video"});a.replaceScreenTrackWithVideo(k[0],e[0],i);d("ScotchRTCGroupCallActions").onLocalTrackReplaced(e[0],(i=k[0])==null?void 0:i.track)}else{e=f.getStream();e!=null&&d("ScotchRTCUtils").transferAudioTracks(e,b)}c("ScotchRTCCallActions").removeLocalScreenStream(b);d("ScotchRTCUtils").stopMediaStream(b);j.update();c("ScotchRTWebUserActionLogger").logCheckpoint({callID:g.callID,checkpoint:"screen_sharing_stopped",conferenceName:g.conferenceName})};a.endCall=function(b,d,e,f){f===void 0&&(f=""),c("promiseDone")(a.genEndCall(b,e,{serverInfoData:d,detailedReasonString:f,keepLocalStream:!1}))};a.genEndCall=function(a,e,f){var g=c("ScotchRTCCallStore").getState(),h=g.callSummary;g=g.callInfo;var i=c("ScotchFBRTCMWProtocolStore").getState();i=i.localScreenDurationTracker;f.keepLocalStream||c("ScotchRTCCallActions").removeAllLocalStreams(!0);c("ScotchRTCCallActions").removeAllLocalScreenStreams(!0);var k=f.detailedReasonString||"Hangup by user";c("ScotchRTCCallActions").hangup(d("ScotchRTCUtils").endCallReasonFromHangupReason(e),k);if(c("gkx")("965758")){g=d("ZenonTSLogDataHelper").serialize(g.tsLogData);c("ScotchRTCLogger").getInstance().logTsLogData(g,h.peerID,h.callID,a,f.serverInfoData)}i.stop();h.setScreenDuration(i.getDuration());g=c("ScotchRTCCallStore").getState().callInfo.callID;h=f.serverInfoData;return k==="DidNotInitiate"&&(g==null||g=="")&&(h==null||h=="")?new(b("Promise"))(function(){return null}):c("ScotchMultiwayRequests").sendHangupRequest(j,a,f.serverInfoData,e,k,c("ScotchRTCCallStore").getState().callInfo.callID).then(function(){c("ScotchRTCCallActions").hangupSuccess()})["catch"](function(a){c("ScotchRTCCallActions").hangupError();throw a})};a.otherUserInAnotherCall=function(a,b,d,e,f){f===void 0&&(f=""),c("promiseDone")(c("ScotchMultiwayRequests").sendHangupRequest(j,a,b,d,f||"User receiving this call is in another call",e))};e.iceRestart=function(a,b){var e=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.MULTIWAY);e&&o(e,[],a,b,[],{iceRestart:!0})};a.addParticipants=function(a,b,d){return c("ScotchMultiwayRequests").sendAddParticipantsRequest(j,a,b,d,c("ScotchRTCCallStore").getState().callInfo.callID)};a.removeParticipants=function(a,b,d){return c("ScotchMultiwayRequests").sendRemoveParticipantsRequest(j,a,b,d,c("ScotchRTCCallStore").getState().callInfo.callID)};a.notifyScreenShareStart=function(a){var b=c("ScotchRTCCallStore").getState(),d=b.callInfo;b=b.localUser;var e=d.callID,f=d.conferenceName;d=d.serverInfoData;return c("ScotchMultiwayRequests").sendStartScreenSharingRequest(j,f,d,e,b.FBID,a)};a.notifyScreenShareEnd=function(a){var b=c("ScotchRTCCallStore").getState(),d=b.callInfo;b=b.localUser;var e=d.callID,f=d.conferenceName;d=d.serverInfoData;return c("ScotchMultiwayRequests").sendEndScreenSharingRequest(j,f,d,e,b.FBID,a)};a.sendGenericDataMessageRequest=function(a,b,d,e){var f=c("ScotchRTCCallStore").getState(),g=f.callInfo;f=f.localUser;var h=g.callID,i=g.conferenceName;g=g.serverInfoData;return c("ScotchMultiwayRequests").sendGenericDataMessageRequest(j,i,g,h,f.FBID,d,Array.from(e),a,b)};a.subscriptionV2=function(b,c){b=b.map(function(a){var b=a.stream;a=a.videoQuality;return{cname:b.id,options:{videoQuality:a}}});c&&b.push({cname:""});a.$19(b)};a.$20=function(a){var b=c("ScotchRTCCallStore").getState();b=b.callInfo;var d=b.conferenceName,e=b.serverInfoData;b=b.callID;c("ScotchRTWebUserActionLogger").logCheckpoint({callID:b,checkpoint:"SendingSubscriptionRequest:"+JSON.stringify(a),conferenceName:d});c("ScotchMultiwayRequests").sendSubscriptionRequest(j,d,e,a,b)};a.subscribeToRemoteFbids=function(b,d){a.$1=b;a.$2=d;var e=c("ScotchRTCCallStore").getState(),f=e.callInfo,g=f.callID,h=f.conferenceName,i=f.conferenceState;f=f.protocol;var j=e.remoteUsers;e=i==="TERMINATED"||i==="TERMINATING";e&&c("ScotchRTWebUserActionLogger").logCheckpointOnceForDomain({callID:g,checkpoint:"subscribeToRemoteVideo when call terminated or terminating",conferenceName:h});if(f==="multiway"&&!e){var k=[],l=[];b.forEach(function(a){var b=a.user;a=a.videoQuality;var c=j.find(function(a){return a.FBID===b});if(!c){l.push({error:"remote user doesn't exist",user:b});return}c=c.getActiveStream();c&&c.getVideoTracks().length>0?k.push({stream:c,videoQuality:a}):l.push({error:"no active video track found",user:b})});l.length>0&&c("ScotchRTWebUserActionLogger").logError({errorDomain:"ScotchUtils.subscribeToRemoteVideo: missing subscriptions: "+JSON.stringify(l)});a.subscriptionV2(k,d)}};a.resubscribeToRemoteFbids=function(){var b=a.$1,c=a.$2;b!=null&&a.subscribeToRemoteFbids(b,c)};a.clientMediaUpdate=function(a,e,f,g,h,i){var k=c("ScotchRTCCallStore").getState().callInfo.callID;c("ScotchMultiwayRequests").sendClientMediaUpdateRequest(j,a,e,f,g,h,c("ScotchRTCCallStore").getState().callInfo.callID,i).then(function(e){var f,g,h,i,j,l,m,n,o,p,q,r,s,t,u,v;return b("regeneratorRuntime").async(function(w){while(1)switch(w.prev=w.next){case 0:f=e.header,g=e.body.clientMediaUpdateResponse,h=g.currentVersion,i=g.answer,j=g.mediaStatus,l=g.stateStore;m=f.responseStatusCode,n=f.transactionId;if(!(i!=null&&d("ZenonPlatformExperiments").shouldUseLobbyMode()&&m==c("FBRTCRtcResponseStatusCode").OK)){w.next=16;break}c("ScotchRTWebUserActionLogger").logCheckpoint({callID:k,checkpoint:"[WR] Received answer SDP in CMU response and lobby mode is enabled: "+JSON.stringify({transactionId:n}),conferenceName:a});o=new(c("ScotchRTCSessionDescription"))(d("ScotchConstants").SignalingProtocol.MULTIWAY,{type:"answer",sdp:i.sdpString});p=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.MULTIWAY);if(!(p==null)){w.next=9;break}c("recoverableViolation")("Peer Connection should not be null if renegotiation is requested","rtc_www");return w.abrupt("return");case 9:c("ScotchRTWebUserActionLogger").logCheckpoint({callID:k,checkpoint:"[WR] ScotchRTCMWProtocolHandler_onClientMediaUpdateResponse setting remote description: "+JSON.stringify({transactionId:n}),conferenceName:a});w.next=12;return b("regeneratorRuntime").awrap(p.setRemoteDescription(o));case 12:q=j,p.getSdpSemantics()===d("ScotchConstants").SDPSemantics.UNIFIED_PLAN&&(r={},Object.keys(q).forEach(function(a){var b=p.getWebrtcTrackIdFromMWTrackId(a);r[b]=q[a]}),q=r),d("ScotchRTCGroupCallActions").toggleRemoteStream(q,k),c("ScotchRTCCallActions").callSuccess(!0);case 16:if(l!=null&&Object.keys(l).length>0&&b("cr:1420073")!=null){s=Object.keys(l);for(t=0;t<s.length;t++)u=s[t],c("ScotchRTWebUserActionLogger").logCheckpoint({callID:k,checkpoint:"[SS] CMU response with ss payload for topic: "+u+" was received",conferenceName:a}),v=l[u],b("cr:1420073").setOutputState(u,v)}c("ScotchRTCLogger").getInstance().logMultiwayResponseProcessed(f,k);d("ScotchRTCGroupCallActions").onClientMediaUpdateResponse(m,h);case 19:case"end":return w.stop()}},null,this)})["catch"](function(a){c("ScotchRTCLogger").getInstance().logError(null,c("ScotchRTCCallStore").getState().callInfo.callID,a)})};a.sendUpdateRequest=function(a,b,d,e,f){var g=c("ScotchRTCCallStore").getState().callInfo.callID;c("ScotchRTWebUserActionLogger").logCheckpoint({callID:g,checkpoint:"[SS] Update request for topic: "+d+" and version "+e+" is being sent",conferenceName:a});c("ScotchMultiwayRequests").sendUpdateRequest(j,a,b,c("ScotchRTCCallStore").getState().callInfo.callID,d,e,f).then(function(d){var f=d.header,h=f.responseStatusCode;f=f.responseSubCode;d=d.body.updateResponse;var b=d.topic;d=d.version;h!==c("FBRTCRtcResponseStatusCode").OK&&c("ScotchRTWebUserActionLogger").logCheckpoint({callID:g,checkpoint:"MW response status code "+h+" with subcode: "+f+" to update request",conferenceName:a});d!=e&&c("ScotchRTWebUserActionLogger").logCheckpoint({callID:g,checkpoint:"Update response for topic "+b+" had version "+d+" which did not match sent version "+e,conferenceName:a})})["catch"](function(a){c("ScotchRTCLogger").getInstance().logError(null,c("ScotchRTCCallStore").getState().callInfo.callID,a)})};a.sendUnsubscribeRequest=function(a,b,d,e){var f=c("ScotchRTCCallStore").getState().callInfo.callID;c("ScotchMultiwayRequests").sendUnsubscribeRequest(j,a,b,f,d,e).then(function(d){var g=d.header,h=g.responseStatusCode;g=g.responseSubCode;d=d.body.updateResponse;var b=d.topic;d=d.version;h!==c("FBRTCRtcResponseStatusCode").OK&&c("ScotchRTWebUserActionLogger").logCheckpoint({callID:f,checkpoint:"MW response status code "+h+" with subcode: "+g+" to update request",conferenceName:a});d!=e&&c("ScotchRTWebUserActionLogger").logCheckpoint({callID:f,checkpoint:"Unsubscribe response for topic "+b+" had version "+d+" which did not match sent version "+e,conferenceName:a})})["catch"](function(a){c("ScotchRTCLogger").getInstance().logError(null,c("ScotchRTCCallStore").getState().callInfo.callID,a)})};a.sendApprovalRequest=function(a,b,d,e){var f=c("ScotchRTCCallStore").getState().callInfo.callID;c("ScotchMultiwayRequests").sendApprovalRequest(j,a,b,f,d,e).then(function(b){b=b.header;var d=b.responseStatusCode;b=b.responseSubCode;d!==c("FBRTCRtcResponseStatusCode").OK&&c("ScotchRTWebUserActionLogger").logCheckpoint({callID:f,checkpoint:"MW response status code "+d+" with subcode: "+b+" to approval request",conferenceName:a})})["catch"](function(a){c("ScotchRTCLogger").getInstance().logError(null,c("ScotchRTCCallStore").getState().callInfo.callID,a)})};e.$16=function(a,b,e,f,g,h,i,j,k,l,m,n,p,q,r){var s=this;this.$21(e,f);c("promiseDone")(o(a,b,e,f,g,{},h,i,j,k,l,n,p,q,r),function(a){a!=null&&(s.$6=a,s.$7&&s.setDescriptions()),c("ScotchRTCCallActions").callSuccess(a==null?!1:m)},function(a){a==="timeout"?c("ScotchRTCCallActions").endCall(d("ScotchConstants").CallEndReason.INCOMING_TIMEOUT):c("ScotchRTCCallActions").callError(a.responseStatusCode,a.responseSubCode),s.$22()})};e.$22=function(){var a=c("ScotchRTCCallStore").getConnection(d("ScotchConstants").SignalingProtocol.MULTIWAY);a&&a.close();this.$8||c("ScotchRTCCallActions").removeAllLocalStreams(!0)};e.$21=function(a,b){l==null&&(l=new(c("ScotchRTCMultiwayMessageHandler"))()),l.initialize(a,b,this.$9,this.$8)};e.$18=function(a){a=a.userId;if(c("ScotchFBRTCGroupCallStore").getState().dominantSpeakerFBID===a)return;c("ScotchRTWebUserActionLogger").logCheckpoint({callID:this.$3.toString(),checkpoint:"newDominantSpeakerID: "+a});d("ScotchRTCGroupCallActions").setDominantSpeaker(a)};a.maybeLimitBitrate=function(a){a=a.getSenders().filter(function(a){return a.track&&a.track.kind==="video"});if(a.length>0&&d("ScotchRTCSignalingExperiments").shouldCapMWBitrate()){a=a[0];var c=a.getParameters();c.encodings[0].maxBitrate=72e4;b("Promise").resolve(a.setParameters(c))}};return a}();m.$1=null;m.$2=!1;m.$19=c("throttle").withBlocking(m.$20,a);function n(a,c){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:e={requestAudio:c};f={requestVideo:a,width:{ideal:d("ScotchConstants").RTCConstraints.width.hd},height:{ideal:d("ScotchConstants").RTCConstraints.height.hd},frameRate:{ideal:d("ScotchConstants").RTCConstraints.frameRate.sd}};h.next=4;return b("regeneratorRuntime").awrap(d("ZenonLocalMediaSDK").getUserMedia(e,f));case 4:g=h.sent;return h.abrupt("return",g[0].webrtcStream);case 6:case"end":return h.stop()}},null,this)}function o(a,e,f,g,h,i,k,n,o,p,q,r,s,t,u){var v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,aa;return b("regeneratorRuntime").async(function($){while(1)switch($.prev=$.next){case 0:i===void 0&&(i={}),k===void 0&&(k=c("emptyFunction")),n===void 0&&(n={}),o===void 0&&(o={}),p===void 0&&(p=!0),q===void 0&&(q=!1),r===void 0&&(r=""),s===void 0&&(s=""),t===void 0&&(t=[]),x={},y=[],(z=a.getLocalStreams()||[],A=Array.isArray(z),B=0,z=A?z:z[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 12:if(!A){$.next=18;break}if(!(B>=z.length)){$.next=15;break}return $.abrupt("break",26);case 15:C=z[B++];$.next=22;break;case 18:B=z.next();if(!B.done){$.next=21;break}return $.abrupt("break",26);case 21:C=B.value;case 22:D=C,a.removeStream(D);case 24:$.next=12;break;case 26:e.forEach(function(b){y=y.concat(b.getTracks()),a.addStream(b,k)});y.forEach(function(a){x[a.id]=a.enabled});(v=l)==null?void 0:v.setShouldDeferServerRequests(!0);$.next=31;return b("regeneratorRuntime").awrap(a.createOffer(babelHelpers["extends"]({preserveH264:d("ScotchRTCUtils").isWatchPartyCall(f)||c("gkx")("1406693")},i),{DISABLE_OPUS_STEREO:d("ScotchRTWebClientFeatureGating").disableOpusStereo(),FORMAT_PARAMETERS:n,OFFER_SDP_TRANSFORM:t},o));case 31:E=$.sent;if(d("ScotchFBRTCSdpUtils").validateOfferSdp(f,E.toSdp())){$.next=34;break}throw c("FBRTCRtcResponseStatusCode").BAD_REQUEST;case 34:F=c("ScotchFBRTCMWProtocolStore").getState().clientMediaUpdateInfo.lastSyncedClientVersion+1;E.sessionDescription.setVersion(F);d("ScotchRTCGroupCallActions").setLocalClientVersion(F);$.next=39;return b("regeneratorRuntime").awrap(a.setLocalDescription(E));case 39:(d("ScotchRTCUtils").isGroupCall(f)||d("ScotchRTCUtils").isMessengerCall(f))&&m.maybeLimitBitrate(a);$.next=42;return b("regeneratorRuntime").awrap(m.updateLocalEncodingActive(a,c("ScotchFBRTCGroupCallStore").getState().forceEncodingEnabled));case 42:G={};H=!1;I=c("ScotchRTCCallStore").getState().callInfo.callID;u!=null&&b("cr:1420073")!=null&&u.forEach(function(e,a){c("ScotchRTWebUserActionLogger").logCheckpoint({callID:I,checkpoint:"[SS] JOIN request with ss payload for topic: "+a+" is being sent",conferenceName:f}),a.localeCompare("simple_external")==0&&(H=!0),G[a]=b("cr:1420073").setUpdatedInputState(a,e),d("ScotchRTCGroupCallActions").setStateSyncSubscribe(a)});if(!(l!=null)){$.next=49;break}$.next=49;return b("regeneratorRuntime").awrap(l.waitForSignalingConnected());case 49:d("ScotchRTWebExperiments").shouldSubscribeToSimpleTopicOnJoin()&&(H&&c("ScotchRTCLogger").getInstance().logCallAction(null,f,"STATE_SYNC_SUBSCRIBE_ON_JOIN","sending subscription to topic simple_external on JOIN request",null));d("ScotchRTCGroupCallActions").onJoinRequestSent();$.next=53;return b("regeneratorRuntime").awrap(c("ScotchMultiwayRequests").sendJoinRequest(j,f,g,E,h.length>0?h:null,y.length>0?x:null,{callID:I,callTrigger:s,numParticipants:c("ScotchRTCCallStore").getState().remoteUsers.size},{userToEscalate:q&&h.length>0?h[0]:null,isEscalator:c("ScotchRTCGroupCallEscalationStore").getState().toRing,escP2PCallID:r},G.size<=0?null:G));case 53:J=$.sent;c("ScotchRTCLogger").getInstance().logMultiwayResponseStartProcessing(J.header,I);K=Date.now();d("ScotchRTCGroupCallActions").onReceivedJoinResponse();L=J.header,M=L.responseStatusCode,N=L.responseSubCode;if(!(M!==c("FBRTCRtcResponseStatusCode").OK)){$.next=61;break}c("ScotchRTWebUserActionLogger").logCheckpoint({callID:I,checkpoint:"MW response status code "+M+" subcode "+N,conferenceName:f});return $.abrupt("return",new(b("Promise"))(function(a,b){b({responseStatusCode:M,responseSubCode:N})}));case 61:d("ScotchRTCGroupCallActions").onJoinResponse(J.header.serverInfoData);d("ScotchRTCProxyUserUtils").setProxyingAsUsersFromMessage(J.body.joinResponse);O=Date.now();if(!(J.body.joinResponse.isPendingApproval&&d("ZenonPlatformExperiments").shouldUseLobbyMode())){$.next=71;break}c("ScotchRTWebUserActionLogger").logCheckpoint({callID:I,checkpoint:"[WR] Received isPendingApproval in JOIN response with lobby mode enabled, not connecting fully",conferenceName:f});d("ScotchRTCGroupCallActions").onPendingApproval();d("ScotchRTCGroupCallActions").onProcessedJoinResponse(I);c("ScotchRTCLogger").getInstance().logMultiwayResponseProcessedFromResponsePayload(J,I);(P=l)==null?void 0:P.setShouldDeferServerRequests(!1);return $.abrupt("return",null);case 71:c("ScotchRTCLogger").getInstance().logMultiwayBeginSetRemoteDescription(J.header);Q=new(c("ScotchRTCSessionDescription"))(d("ScotchConstants").SignalingProtocol.MULTIWAY,{type:"answer",sdp:J.body.joinResponse.answer.sdpString},{FORMAT_PARAMETERS:n},J.header);c("ScotchRTWebUserActionLogger").logCheckpoint({callID:I,checkpoint:"ScotchRTCMWProtocolHandler_initPeerConnection shouldSetDescriptions on answer : "+String(p),conferenceName:f});if(!p){$.next=78;break}$.next=77;return b("regeneratorRuntime").awrap(a.setRemoteDescription(Q));case 77:c("ScotchRTCLogger").getInstance().logMultiwayEndSetRemoteDescription(J.header);case 78:R=Date.now();if(J.body.joinResponse.stateStore!=null&&Object.keys(J.body.joinResponse.stateStore).length>0&&b("cr:1420073")!=null){S=Object.keys(J.body.joinResponse.stateStore);for(T=0;T<S.length;T++)U=S[T],c("ScotchRTWebUserActionLogger").logCheckpoint({callID:I,checkpoint:"[SS] JOIN response with ss payload for topic: "+U+" was received",conferenceName:f}),V=J.body.joinResponse.stateStore[U],d("ScotchRTWebExperiments").shouldSubscribeToSimpleTopicOnJoin()&&(U.localeCompare("simple_external")==0&&c("ScotchRTCLogger").getInstance().logCallAction(null,f,"STATE_SYNC_OUTPUT_JOIN_RESPONSE","received output state: "+((W=V.data)!=null?W:"")+" on join response for topic simple_external",null)),b("cr:1420073").setOutputState(U,V)}X=Date.now();Y=J.body.joinResponse.mediaStatus;a.getSdpSemantics()===d("ScotchConstants").SDPSemantics.UNIFIED_PLAN&&(Z={},Object.keys(Y).forEach(function(b){var c=a.getWebrtcTrackIdFromMWTrackId(b);Z[c]=Y[b]}),Y=Z);aa=Date.now();d("ScotchRTCGroupCallActions").toggleRemoteStream(Y,I);d("ScotchRTCGroupCallActions").onProcessedJoinResponse(I);c("ScotchRTCLogger").getInstance().logMultiwayResponseProcessedFromResponsePayload(J,I,JSON.stringify({initial_logging_duration:O-K,set_remote_description_duration:R-O,state_sync_duration:X-R,unified_plan_duration:aa-X,is_meetup:c("gkx")("1369511")}));(w=l)==null?void 0:w.setShouldDeferServerRequests(!1);return $.abrupt("return",Q);case 89:case"end":return $.stop()}},null,this)}g["default"]=m}),98);
__d("ScotchFBRTCRetriableMessage",["ScotchConstants","clearTimeout","mixInEventEmitter","setTimeout"],(function(a,b,c,d,e,f,g){var h=1e4,i=7e3;a=function(){function a(a){this.$1=a,this.$2=h,this.$3=2,this.$6=null}var b=a.prototype;b.sendMessage=function(a,b,c,e){var f=e.sdp,g=e.hasVideo,h=e.attributes,j=e.multiwayInfo;e=e.callTrigger;this.$4=b;switch(a){case d("ScotchConstants").PayloadType.PCRESTART_OFFER:this.$5=this.$1.sendPCRestartOffer(b,c,f,g,h);break;case d("ScotchConstants").PayloadType.OFFER:this.$5=this.$1.sendOffer(b,c,f,g,h,e);break;case d("ScotchConstants").PayloadType.ANSWER:this.$2=i;this.$5=this.$1.sendAnswer(b,c,f,g,h,j);break;default:break}this.$7()};b.isAckMsg=function(a){return this.$5&&this.$5.msg_id===a.ack_id};b.stopRetrying=function(){this.$6&&(c("clearTimeout")(this.$6),this.$4=null,this.$5=null,this.$6=null)};b.$7=function(){this.$6=c("setTimeout")(this.$8.bind(this),this.$2)};b.$8=function(){this.$3<1?this.emit("timeoutFailure"):(this.emit("sendingRetry"),this.$1.resendSdpMessage(this.$4,this.$5),this.$7(),this.$3-=1)};return a}();c("mixInEventEmitter")(a,{sendingRetry:!0,timeoutFailure:!0});g["default"]=a}),98);
__d("XGroupCallController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/groupcall/{?call_context}/",{av:{type:"FBID"},call_context:{type:"String",required:!0},call_id:{type:"Int"},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:!0},initialize_video:{type:"Bool",defaultValue:!0},server_info_data:{type:"String"},nonce:{type:"String"},multiway_www_tier:{type:"String"},multiway_core_tier:{type:"String"},gk_enable:{type:"String"},gk_disable:{type:"String"},qe:{type:"StringToStringMap"},locale:{type:"String"},funnel_session_id:{type:"String"},auto_join:{type:"Bool",defaultValue:!1},referrer_context:{type:"Enum",enumType:1},use_joining_context:{type:"Bool",defaultValue:!1},peer_id:{type:"FBID"},thread_type:{type:"Enum",enumType:0}})}),null);
__d("XGroupCallSigningController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/groupcall/init/",{call_context:{type:"String",required:!0},call_id:{type:"Int"},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:!1},initialize_video:{type:"Bool",defaultValue:!1},server_info_data:{type:"String"},nonce:{type:"String"},multiway_www_tier:{type:"String"},multiway_core_tier:{type:"String"}})}),null);
__d("XVideoCallController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/incall/",{peer_id:{type:"FBID",required:!0},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:!1},audio_only:{type:"Bool",defaultValue:!1},nonce:{type:"String"},meeting_id:{type:"Int"},meeting_pass:{type:"String"},initialize_video:{type:"Bool",defaultValue:!0},locale:{type:"String"}})}),null);
__d("ScotchFBRTCUrlManager",["invariant","CurrentUser","Promise","ScotchFBRTCUtils","ScotchRTCLogger","URI","XGroupCallController","XGroupCallSigningController","XVideoCallController","ZenonRTCConfig","regeneratorRuntime"],(function(a,b,c,d,e,f,g,h){function i(a){c("ScotchRTCLogger").getInstance().logCallAction(a,void 0,c("ScotchRTCLogger").CallAction.OLD_URI);return c("XVideoCallController").getURIBuilder().setFBID("peer_id",a).getURI()}function j(a){if(c("CurrentUser").isEmployee()){var b=a.setSubdomain(c("CurrentUser").hasWorkUser()||c("CurrentUser").isWorkUser()?"fb":"www"),d="/intern/";return c("URI").getRequestURI().getPath().substr(0,d.length)!==d?b:b.setDomain(b.getDomain().toString().replace(/\.(intern|internmc|cstools)\./,"."))}return a}function k(a){var e,f,g,h,i,j,k,l,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:e=a.callContext,f=a.callID,g=a.usersToRing,h=a.hasVideo,i=a.initializeVideo,j=a.multiwayCoreTier,k=a.multiwayWwwTier,l=a.nonce,m=a.serverInfoData;n=c("XGroupCallSigningController").getURIBuilder().setString("call_context",e).setInt("call_id",f).setFBIDSet("users_to_ring",g).setBool("has_video",h).setBool("initialize_video",i).setString("server_info_data",m).setString("nonce",l).setString("multiway_www_tier",k).setString("multiway_core_tier",j).getURI();return o.abrupt("return",new(b("Promise"))(function(a,b){d("ScotchFBRTCUtils").sendServerRequest(n,function(b){a(b.payload.uri)},function(a){b(a)})}));case 3:case"end":return o.stop()}},null,this)}var l=function(a){if(d("ZenonRTCConfig").disableURLManager())return;window.history.replaceState({},"",a)};function m(a){var b=c("XVideoCallController").getURIBuilder().setFBID("peer_id","0").getURI().getPath();return a.getPath()===b}function n(a,b){a&&(b&&h(0,11934))}function a(a){m(new(c("URI"))(window.location))&&l(i(a))}function e(a,d,e,f,g,h,i,j,l){var m;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:n(!f,g),m=0;case 2:if(!(m<3)){o.next=15;break}o.prev=3;o.next=6;return b("regeneratorRuntime").awrap(k({callContext:a,callID:d,usersToRing:e,hasVideo:f,initializeVideo:g,multiwayCoreTier:h,multiwayWwwTier:i,nonce:j,serverInfoData:l}));case 6:return o.abrupt("return",o.sent);case 9:o.prev=9,o.t0=o["catch"](3),c("ScotchRTCLogger").getInstance().logToConsole(o.t0);case 12:m++;o.next=2;break;case 15:return o.abrupt("return",c("XGroupCallController").getURIBuilder().setString("call_context",a).setInt("call_id",d).setFBIDSet("users_to_ring",e).setBool("has_video",f).setBool("initialize_video",g).setString("server_info_data",l).setString("nonce",j).setString("multiway_www_tier",i).setString("multiway_core_tier",h).getURI());case 16:case"end":return o.stop()}},null,this,[[3,9]])}function f(a,b,e,f,g,h,i){i===void 0&&(i="");n(f,h);b=c("XVideoCallController").getURIBuilder().setFBID("peer_id",a).setInt("call_id",b).setBool("is_caller",e).setBool("audio_only",f).setString("nonce",g).setBool("initialize_video",h).getURI();return d("ScotchFBRTCUtils").isPeerVCEndpoint(a)||d("ScotchFBRTCUtils").isCollabTrigger(i)?j(b):b}g.onCallStarted=a;g.getGroupCallUri=e;g.getP2PCallUriWithNonce=f}),98);
__d("ScotchFBRTCUserSettings",["Promise","ScotchRTCMediaDevices","emptyFunction","mixInEventEmitter"],(function(a,b,c,d,e,f,g){"use strict";a={audioInput:"",audioOutput:"default",videoInput:"",remoteStream:null,_audioInputLabel:null,_videoInputLabel:null,isEnabled:function(){return Boolean(d("ScotchRTCMediaDevices").isSupported("enumerateDevices"))},selectAudioInputByLabel:function(a){this.audioInput||(this.audioInput=this._selectByLabel(a,this._audioInputLabel));return this.audioInput},selectVideoInputByLabel:function(a){this.videoInput||(this.videoInput=this._selectByLabel(a,this._videoInputLabel));return this.videoInput},_selectByLabel:function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(b&&b===d.label)return d.deviceId}return null},previewStart:function(){this.emit("previewStarted")},previewEnd:function(){this.emit("previewEnded")},save:function(a){var c=this,d=a.audioInput,e=a.audioOutput,f=a.videoInput;return new(b("Promise"))(function(a){var b=!!(d&&c.audioInput!==d||f&&c.videoInput!==f);c.audioInput=d;c.audioOutput=e;c.videoInput=f;c.emit("saved",b);a(b)})},updateForLocalStream:function(a){if(a.videoMediaSourceId)this.videoInput=a.videoMediaSourceId;else{var b=a.getVideoTracks();b=b[0];b&&(this._videoInputLabel=b.label)}if(a.audioMediaSourceId)this.audioInput=a.audioMediaSourceId;else{b=a.getAudioTracks();a=b[0];a&&(this._audioInputLabel=a.label)}},updateForRemoteStream:function(a){this.remoteStream=a,this.emit("remoteStreamChanged")},addListener:function(){},emit:c("emptyFunction")};c("mixInEventEmitter")(a,{previewStarted:!0,previewEnded:!0,remoteStreamChanged:!0,saved:!0});e=a;g["default"]=e}),98);
__d("XRTCCallNUXController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/rtc/call/nuxstatus/",{})}),null);
__d("ScotchRTCCallNUXActions",["ScotchFBRTCUtils","ScotchRTCAppDispatcher","ScotchRTCLogger","XRTCCallNUXController","dangerouslyBypassDispatchError"],(function(a,b,c,d,e,f,g){"use strict";function a(){d("ScotchFBRTCUtils").sendServerRequest(c("XRTCCallNUXController").getURIBuilder().getURI(),function(a){a=a.payload;c("ScotchRTCAppDispatcher").dispatch({type:"INIT_NUX_STATE",payload:a})},function(){})}function b(a){try{c("ScotchRTCAppDispatcher").dispatch({type:"MARK_NUX_VIEWED",nuxID:a})}catch(b){c("dangerouslyBypassDispatchError")(function(){return c("ScotchRTCAppDispatcher").dispatch({type:"MARK_NUX_VIEWED",nuxID:a})})}}function e(a){c("ScotchRTCAppDispatcher").dispatch({type:"DISMISS_NUX",nuxID:a})}g.refreshNUXState=a;g.markNUXViewed=b;g.dismissNUX=e}),98);
__d("ScotchRTCLocalMessageQueue",["CacheStorage"],(function(a,b,c,d,e,f,g){var h="localstorage",i="RTC_",j="offer",k="offer_msg",l="data_",m=30*1e3,n=new Map();function a(a){n.set(a,new Map())}function b(a,b){a=t(a,k);p(a,j,b)}function d(a){a=t(a,k);return q(a,j)}function e(a){a=t(a,k);a.remove(j)}function f(a,b,c){b=l+b.toString();var d=n.get(a)||new Map();c.msg_type==="offer"&&(b=j);d.set(b,c);n.set(a,d)}function o(a,b){var c=n.get(a)||new Map();for(var c=c,d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=c.length)break;f=c[e++]}else{e=c.next();if(e.done)break;f=e.value}f=f;f[0];f=f[1];b(f)}n.set(a,new Map())}function p(a,b,c){c={__t:Date.now(),__d:c};a.set(b,c)}function q(a,b){var c=a.get(b);if(c&&s(c))return c.__d;else c&&a.remove(b);return null}function r(a,b){var c=q(a,b);if(c!==null){a.remove(b);return c}return null}function s(a){return Date.now()-a.__t<m}function t(a,b){return new(c("CacheStorage"))(h,""+i+a+"_"+b+"_")}g.STORAGE_TYPE=h;g.PREFIX=i;g.OFFER_KEY=j;g.OFFER_SUFFIX=k;g.DATA_KEY_PREFIX=l;g.CACHE_LIFE=m;g.clearQueue=a;g.writePeerOfferToStorage=b;g.getPeerOfferFromStorage=d;g.clearPeerOfferFromStorage=e;g.enqueueMessage=f;g.drainQueue=o;g._storeData=p;g._getData=q;g._getAndRemoveData=r;g._isValid=s;g.getStorage=t}),98);
__d("ScotchRTCOneVCActions",["ScotchRTCAppDispatcher"],(function(a,b,c,d,e,f,g){"use strict";function a(a){c("ScotchRTCAppDispatcher").dispatch({type:"STORE_PARTICIPANTS",participants:a})}function b(a){c("ScotchRTCAppDispatcher").dispatch({type:"SET_MEETING_ID",meetingID:a})}function d(a){c("ScotchRTCAppDispatcher").dispatch({type:"SET_MEETING_PASSWORD",meetingPassword:a})}g.storeParticipants=a;g.setMeetingID=b;g.setMeetingPassword=d}),98);
__d("ScotchRTCPeerConnectionQueue",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=[],this.$2=[]}var b=a.prototype;b.push=function(a,b){switch(a){case"add":this.$1.push(b);break;case"remove":this.$2.push(b);break}};b.drain=function(){this.$3(this.$2),this.clear("remove"),this.$3(this.$1),this.clear("add")};b.$3=function(a){if(a.length<1)return;for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;try{d()}catch(a){}}};b.clear=function(a){switch(a){case"add":this.$1=[];break;case"remove":this.$2=[];break;default:this.$1=[],this.$2=[]}};return a}();f["default"]=a}),66);
__d("XRtcFetchProvisionalRingController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/provisionalring/",{user_id:{type:"Int",required:!0}})}),null);
__d("ZenonSdpFormat",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({PLAN_B:"plan-b",UNIFIED_PLAN:"unified-plan"});c=a;f["default"]=c}),66);
__d("ZenonRTCPeerConnectionConfig",["ZenonBrowsers","ZenonRTCConfig","ZenonRTWebBrowserFeatureSupport","ZenonSdpFormat","gkx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h="stun:stun.fbsbx.com:3478";function i(a,b,c){a={urls:a};b!==void 0&&c!==void 0&&(a.username=b,a.credential=c);return[a]}function j(a,b,c){if(d("ZenonBrowsers").isChromium()&&d("ZenonBrowsers").webrtcVersion()>=34){var e={urls:a};b!==void 0&&c!==void 0&&(e.username=b,e.credential=c);return[e]}e=[];for(var f=0;f<a.length;f++)b!==void 0&&c!==void 0?e.push({credential:c,url:a[f],username:b}):e.push({url:a[f]});return e}a=function(){function a(){this.sslPort="",this.tcpPort="",this.turnIP="",this.turnPassword="",this.turnUsername="",this.udpPort=""}var b=a.prototype;b.setTurnCredentials=function(a){this.turnIP=a.ip,this.udpPort=a.udp_port,this.tcpPort=a.tcp_port,this.sslPort=a.ssl_tcp_port,this.turnUsername=a.username,this.turnPassword=a.password};b.getConfig=function(){if(d("ZenonRTCConfig").getIsVCEndpointCall())return{iceServers:[]};var a=j([h]).concat(j(this.$1(),this.turnUsername,this.turnPassword));return{iceServers:a}};b.getConfigZenonPlatform=function(a){var b;a===void 0&&(a=!1);b=(b=c("qex")._("245"))!=null?b:!1;b=d("ZenonRTWebBrowserFeatureSupport").isInsertableStreamsSupported()&&b;if(d("ZenonRTCConfig").getIsVCEndpointCall())return{encodedInsertableStreams:b,iceServers:[],sdpSemantics:c("ZenonSdpFormat").PLAN_B};var e="max-compat",f=this.turnIP==="";a=!a&&c("gkx")("1675")||a&&(c("qex")._("458")||c("gkx")("967"))||d("ZenonBrowsers").onlySupportsUnifiedPlan()?c("ZenonSdpFormat").UNIFIED_PLAN:c("ZenonSdpFormat").PLAN_B;f?f=i([h]):f=i([h]).concat(i(this.$1(),this.turnUsername,this.turnPassword));return{bundlePolicy:e,encodedInsertableStreams:b,iceServers:f,sdpSemantics:a}};b.getConstraints=function(a){a===void 0&&(a=!1);var b=!0;d("ZenonBrowsers").isChromium()&&d("ZenonBrowsers").webrtcVersion()<57&&a&&(b=!1);return{mandatory:{},optional:[{DtlsSrtpKeyAgreement:b}]}};b.$2=function(a){var b=this.turnIP,c,d=a;switch(a){case"tcp":c=this.tcpPort;break;case"udp":c=this.udpPort;break;case"ssl":c=this.sslPort;d="tcp";break;default:c=this.udpPort;d=null;break}return!((b==null?void 0:b.length)&&((a=c)==null?void 0:a.length))?null:d!=null&&d.length>0?"turn:"+b+":"+c+"?transport="+d:"turn:"+b+":"+c};b.$1=function(){if(d("ZenonBrowsers").isFirefox()&&d("ZenonBrowsers").webrtcVersion()<27)return[this.$2()].filter(Boolean);else return[this.$2("udp"),this.$2("tcp"),this.$2("ssl")].filter(Boolean)};return a}();b=new a();g["default"]=b}),98);
__d("ZenonRTCPeerConnectionHelper",["FBLogger","RTCPeerConnection"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a.signalingState!=="closed"&&a.close()}function b(a,b,d){b===void 0&&(b={});d===void 0&&(d={});try{var e=[{googNumUnsignalledRecvStreams:10},{DtlsSrtpKeyAgreement:!0}];a.getZenonPeerConnectionConfig().isRtpDataChannels()&&e.push({RtpDataChannels:!0});return new(c("RTCPeerConnection"))(babelHelpers["extends"]({},b),babelHelpers["extends"]({optional:e},d))}catch(a){c("FBLogger")("rtc_www").catching(a).warn("Failed to create peer connection")}}function d(a){return a instanceof c("RTCPeerConnection")}g.closePeerConnection=a;g.createPeerConnection=b;g.isRTCPeerConnectionInstance=d}),98);
__d("XVideoCallTurnDiscoveryController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/turndiscovery/",{version:{type:"Int",required:!0},call_id:{type:"String"}})}),null);
__d("ZenonUtils",["AsyncRequest","AsyncResponse","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h=6e3;function a(a,b,d,e,f,g){b===void 0&&(b=c("emptyFunction"));d===void 0&&(d=c("emptyFunction"));e===void 0&&(e=!1);f===void 0&&(f=h);g===void 0&&(g={});a=new(c("AsyncRequest"))().setURI(a).setData(g).setAllowCrossPageTransition(!0).setHandler(b).setErrorHandler(d).setTimeoutHandler(f,function(a){d(new(c("AsyncResponse"))(a,{}))});e&&a.setOption("asynchronous_DEPRECATED",!1);a.send()}g.sendServerRequest=a}),98);
__d("ZenonTurnDiscovery",["Promise","XVideoCallTurnDiscoveryController","ZenonDebugLogger","ZenonUtils","err"],(function(a,b,c,d,e,f,g){"use strict";var h=3,i=null;function a(a,e,f){f===void 0&&(f=h);if(i)return i;var g=1,j=c("XVideoCallTurnDiscoveryController").getURIBuilder().setInt("version",g).setString("call_id",a).getURI();i=new(b("Promise"))(function(b,g){h(f);function h(f){d("ZenonUtils").sendServerRequest(j,function(a){a=a.payload;return b(a)},function(){f>0?(c("ZenonDebugLogger").getFBLogger({callID:a,peerID:e}).warn("Failed turn; going to retry"),h(f-1)):g(c("err")("failed"))})}});return i}g.requestTurnCreds=a}),98);
__d("ScotchRTCP2PProtocolHandler",["AsyncTypedRequest","Bootloader","CurrentUser","DateConsts","FBLogger","FBRTCMessageListener","Promise","RTWebIncomingRingConfiguration","ScotchConstants","ScotchFBRTCCallSummary","ScotchFBRTCCallSummaryStore","ScotchFBRTCIceCache","ScotchFBRTCMediaMetricParser","ScotchFBRTCMessage","ScotchFBRTCMessageDedup","ScotchFBRTCMessageSender","ScotchFBRTCPeerConnection","ScotchFBRTCPeerConnectionHelper","ScotchFBRTCRetriableMessage","ScotchFBRTCSdpUtils","ScotchFBRTCStatsHelpers","ScotchFBRTCUrlManager","ScotchFBRTCUserSettings","ScotchRTCCallActions","ScotchRTCCallNUXActions","ScotchRTCCallStore","ScotchRTCCallType","ScotchRTCEndCallReason","ScotchRTCGroupCallEscalationStore","ScotchRTCGroupCallEscalator","ScotchRTCLocalMessageQueue","ScotchRTCLogger","ScotchRTCOneVCActions","ScotchRTCP2PCallActions","ScotchRTCP2PCallEscalationActions","ScotchRTCP2PCallEscalationStore","ScotchRTCP2PCallEscalator","ScotchRTCP2PCallStore","ScotchRTCP2PCallWindowHandler","ScotchRTCPeerConnectionQueue","ScotchRTCSessionDescription","ScotchRTCSignalingExperiments","ScotchRTCStreamDurationTracker","ScotchRTCUtils","ScotchRTWebClientFeatureGating","ScotchRTWebExperiments","ScotchRTWebUserActionLogger","UserAgent","XRtcFetchProvisionalRingController","ZenonDebugLogger","ZenonExperimentFetcher","ZenonImmutableMediaTrack","ZenonLocalMediaSDK","ZenonLocalUploadLogLevel","ZenonRTCConfig","ZenonRTCPeerConnectionConfig","ZenonRTCPeerConnectionHelper","ZenonRTWebBrowserFeatureSupport","ZenonSignalingProtocol","ZenonTSLogDataHelper","ZenonTurnDiscovery","ZenonUserCapabilities","clearTimeout","debounce","gkx","promiseDone","regeneratorRuntime","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=1*d("DateConsts").MS_PER_MIN,i=15*d("DateConsts").MS_PER_SEC,j=30*d("DateConsts").MS_PER_SEC,k=10*d("DateConsts").MS_PER_SEC,l=30*d("DateConsts").MS_PER_SEC;a=function(){function a(){var b=this;this.$5={streams:{}};this.$6=c("ScotchRTCLogger").getInstance();this.$7=!1;this.$8=!0;this.$9=!1;this.$10="passive";this.$11=new(c("ScotchFBRTCMessageSender"))();this.$16=new(c("ScotchFBRTCIceCache"))();this.$17=!1;this.$18=[];this.$19=!1;this.$22=null;this.$23=null;this.$24=null;this.$26=new(c("ScotchRTCStreamDurationTracker"))("video");this.$27=new(c("ScotchRTCStreamDurationTracker"))("video");this.$28=new(c("ScotchRTCStreamDurationTracker"))("screen");this.$29=!1;this.$30=new(c("ScotchRTCPeerConnectionQueue"))();this.$33=!1;this.$50=function(a){a=a.candidate;a&&b.$64(a)};this.$51=function(a){a=a.target;a=a.iceConnectionState;b.$35("RTCP2PProtocolHandler_PC_iceconnectionstatechange: "+a);var e=c("ScotchRTCCallStore").getState();e=e.callSummary;e&&a!=="checking"&&a!=="new"&&a!=="closed"&&(e.setPCIsConnected(a==="completed"||a==="connected"),e.save(c("ScotchFBRTCCallSummaryStore").getInstance()));(b.$23==="disconnected"||b.$23==="failed")&&a==="connected"&&b.$34("connection recovery",b.$23);b.$34("ICE connection state change",a);switch(a){case"checking":b.$9=!0;break;case"connected":case"completed":b.$65();b.$66();b.$67();d("ScotchFBRTCMediaMetricParser").startCollectingMediaStats();break;case"failed":case"disconnected":break;case"closed":break}b.$68(a)};this.$70=function(){var a=b.$4.getCreatedIceCandidates();for(var c=0;c<a.length;c++)b.$64(a[c])};this.$52=function(a){a=a.target;a=a.iceGatheringState;b.$35("RTCP2PProtocolHandler_PC_icegatheringstatechange: "+a);b.$34("ICE gathering state change",a)};this.$53=function(a){var c=a.errorCode,d=a.errorText,e=a.hostCandidate;a=a.url;b.$71("ScotchRTCP2PProtocolHandler: PC icecandidateerror "+c+": "+d+". candidate: "+e);b.$34("ICE candidate error",{errorCode:c,errorText:d,hostCandidate:e,url:a})};this.$54=function(a){};this.$55=function(a){};this.$72=function(){var a;b.$25?a=d("ScotchConstants").CallEndReason.UNSUPPORTED_VERSION:a=d("ScotchConstants").CallEndReason.OTHER_NOT_CAPABLE;b.$38(a,!1,!0,!1,"TimedOut")};this.$56=c("debounce")(function(a){var e=a.target,f=e.iceConnectionState,g=e.signalingState;if(!d("ZenonRTCPeerConnectionHelper").isRTCPeerConnectionInstance(e))f=b.$4.getIceConnectionState(),g=b.$4.getSignalingState();else if(f!==b.$4.getIceConnectionState()||g!==b.$4.getSignalingState()){e="onNegotiationNeeded. iceConnectionState="+f+", pc="+b.$4.getIceConnectionState()+", signalingState="+g+", pc="+b.$4.getSignalingState();b.$6.logInfo(b.$2,b.$3,e)}b.$34("offer renegotiation",{iceConnectionState:f,isNegotiationExpected:b.$8});if(f==="closed")return;else if(!b.$8){b.$34("offer renegotiation","ignore");return}else if(!c("ScotchRTCP2PCallEscalator").isNegotiationAllowed()){b.$34("offer renegotiation","not allowed - escalating");return}else if(b.$7){b.$34("offer renegotiation","retry");c("setTimeout")(function(){return b.$56(a)},100);return}b.$8=!1;var h=[];g==="stable"&&(b.$9&&(b.internalResetConnection(),h.push("new offer"),b.$10="passive"),b.$34("offer renegotiation","create offer"),b.$69().then(function(a){if(a.strongDiff(b.$4.getLocalDescription())){b.$34("offer renegotiation",h);return a}return null}).then(function(a){a&&(b.$9&&d("ScotchRTCP2PCallActions").setConnectionStatus("RECONNECTING"),b.$73(a)),b.$10="active"})["catch"](function(a){b.$63(new Error("Failed to create offer onNegotiationNeeded: "+a.message))}))},50);this.$57=function(e){if(b.$29){b.$30.push("add",function(){return b.$57(e)});return}var f=e.stream,g=b.$74(f),h=b.$2;g===d("ScotchConstants").StreamType.SCREEN_CONTENT?(c("ScotchRTCCallActions").addRemoteScreenStream(f,h),!a.supportMultipleStreams()&&f.getAudioTracks().length>0&&b.$27.track(f)):(c("ScotchFBRTCUserSettings").updateForRemoteStream(f),c("ScotchRTCCallActions").addRemoteStream(f,h),b.$27.track(f),c("ScotchRTCP2PCallStore").addListener(c("debounce")(function(){c("ScotchRTCP2PCallStore").getState().callType!==c("ScotchRTCCallType").AUDIO_ONLY&&b.$65()},50)));b.$19=!0;while(b.$18.length>0)b.$75(b.$18.shift());b.$34("remote stream: added",f)};this.$58=function(a){a=c("ScotchRTCCallStore").getState().remoteUsers.first();a&&!a.isVideoDisabled()&&(c("ScotchRTCCallActions").toggleMuteRemoteVideo(!1,a.FBID),b.$34("on media track event",{action:"toggleMuteRemoteVideo",muted:!1,remoteUserID:a.FBID}))};this.$59=function(a){if(b.$29){b.$30.push("remove",function(){return b.$59(a)});return}var e=a.stream,f=b.$74(e),g=b.$2;if(f===d("ScotchConstants").StreamType.SCREEN_CONTENT){c("ScotchRTCCallActions").removeRemoteScreenStream(e,g);f=c("ScotchRTCCallStore").getState().remoteUsers.first();if(f){f=f.streams.first();f&&b.$27.track(f)}}else c("ScotchRTCCallActions").removeRemoteStream(e,g);b.$34("remote stream: removed",e)};this.$60=function(a){};this.$36=function(a){b.$35("RTCP2PProtocolHandler_Received_TURN_Creds");b.$34("TURN credentials received",a);c("ZenonRTCPeerConnectionConfig").setTurnCredentials(a);var d=c("ScotchRTCCallStore").getState();d=d.callSummary;d.isNull()||n(function(b){return b.setRelayIP(a.ip)})};this.$37=function(){b.$6.logError(b.$2,b.$3,"Failed to get turn creds"),b.$38(d("ScotchConstants").CallEndReason.CLIENT_ERROR,!1,!c("ScotchRTCP2PCallStore").isCaller(),!1,"NoTurnCreds")};this.$44=function(a,c){b.$38(a,!1,!1,!1,c.toString())};this.$43=function(a,c){var d=c.call_id;if(b.$81()){b.$6.logError(b.$2,b.$3,"Message sent after call ended: "+c.type);return}if(b.$2!==a||b.$3!==d)return;n(function(a){return a.onMessageSent(c)});b.$34("message sent",c)};this.$34("call controller init");this.$35("RTCP2PProtocolHandler_constructed")}var e=a.prototype;e.init=function(a,b){this.$1=c("CurrentUser").getID();this.$2=a;this.$3=b;this.$35("RTCP2PProtocolHandler_init_call");if(!d("ScotchRTWebExperiments").passOfferWithWindowMessages()){a=d("ScotchRTCLocalMessageQueue").getPeerOfferFromStorage(this.$2);this.$34("local message queue updates",{action:"getOffer",cachedOffer:a,callID:this.$3});if(a){this.$34("call: try","not ready");b=new(c("ScotchFBRTCMessage"))(a);d("ScotchRTCP2PCallActions").processMessage(b)}}return this};e.setPreserveLocalStream=function(a){this.$32=a;return this};e.fetchTURNCredentials=function(){if(d("ZenonRTCConfig").getIsVCEndpointCall()){this.$35("RTCP2PProtocolHandler_skip_TURN_discovery");return b("Promise").resolve()}this.$34("call: try","not ready");return d("ZenonTurnDiscovery").requestTurnCreds(this.$3.toString(),this.$2).then(this.$36,this.$37)};e.endCall=function(a,b,e){a===void 0&&(a=d("ScotchConstants").CallEndReason.HANGUP_CALL),b===void 0&&(b=""),e===void 0&&(e=!1),c("ScotchRTCCallActions").hangup(a,b),this.$38(a,!1,!0,e,b)};e.startCall=function(a,b){var e=this,f=c("ScotchRTCP2PCallStore").isCaller();this.$34("call: start process",{callTrigger:a,userCallType:this.$39(),isCaller:c("ScotchRTCP2PCallStore").isCaller()});this.$4=this.$40();this.$41();this.$30=new(c("ScotchRTCPeerConnectionQueue"))();this.$34("local message queue updates",{action:"getOffer",offer:b});var g=null;b?(this.$20=new(c("ScotchFBRTCMessage"))(b),d("ScotchFBRTCMessageDedup").check(this.$2,this.$20.callID,this.$20.msgID),g=!1):(g=!0,d("ScotchRTCP2PCallActions").setIsCaller(g));f&&!g&&this.handleCallCollision(this.$20,!1);g!==f&&(this.$34("caller mismatch",{initialValue:f,actualValue:g}),f?this.$35("RTCP2ProtocolHandler_offer_mismatch_caller_found_unexpected_cached_offer"):this.$35("RTCP2PProtocolHandler_offer_mismatch_callee_did_not_find_cached_offer"));this.$8=g;this.$20 instanceof c("ScotchFBRTCMessage")&&d("ScotchRTCP2PCallActions").processMessage(this.$20);this.$42(a,g);this.$11=new(c("ScotchFBRTCMessageSender"))();this.$11.onMessageSent=this.$43;this.$11.onSendFailure=this.$44;this.$31=new(c("ScotchRTCP2PCallEscalator"))(this.$2,this.$3,this.$11);d("ZenonRTCConfig").getIsVCEndpointCall()&&c("FBRTCMessageListener").setOneVCMessegeHandler(function(a){e.$45(a)});this.$46();d("ScotchRTCP2PCallActions").setConnectionStatus("CONTACTING");c("ScotchRTCCallActions").call([this.$2],this.$4);if(d("ScotchRTWebExperiments").shouldUseZenonSignaling()){b=c("ScotchRTCP2PCallStore").getState().signalingChild;b!=null&&b.addListener("messageReceived",function(a){e.$47(a)})}else c("FBRTCMessageListener").setMessageHandler(function(a){e.$47(a)});g&&(this.$24=c("setTimeout")(function(){e.__fetchProvisionalRing()},k));c("gkx")("965758")&&this.$35("[Scotch] Eligible for tslog logging")};e.__fetchProvisionalRing=function(){var a=this,d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:d=c("XRtcFetchProvisionalRingController").getURIBuilder().setInt("user_id",this.$2).getURI();e.next=3;return b("regeneratorRuntime").awrap(new(c("AsyncTypedRequest"))(d).setPayloadHandler(function(b){a.__onFetchProvisionalRingResponse(b)}).send());case 3:case"end":return e.stop()}},null,this)};e.__onFetchProvisionalRingResponse=function(a){a&&c("ScotchRTCP2PCallStore").getState().connectionStatus==="CONTACTING"&&d("ScotchRTCP2PCallActions").setConnectionStatus("PROVISIONAL_RINGING")};e.$42=function(a,b){b=c("ScotchFBRTCCallSummary").restoreOrInitialize(c("ScotchFBRTCCallSummaryStore").getInstance(),this.$2,this.$3,b,this.$20,a);b.onPopupOpened();b.setCallType(c("ScotchRTCP2PCallStore").getState().callType===c("ScotchRTCCallType").AUDIO_ONLY?d("ScotchConstants").CallType.VOIP:d("ScotchConstants").CallType.DIRECT_VIDEO);b.setActiveConnection("p2p");this.$48(b);c("ScotchRTCCallActions").setCallSummary(b)};e.$48=function(a){c("promiseDone")(c("ScotchFBRTCStatsHelpers").getBatteryStats(),function(b){a.addExtraInfo(c("ScotchRTCLogger").Key.BATTERY_START,b.level)})};e.startScreenStream=function(b){if(!a.supportMultipleStreams()){var e=c("ScotchRTCCallStore").getState();e=e.localUser;e=e.streams.first();d("ScotchRTCUtils").transferAudioTracks(b,e)}c("ScotchRTCCallActions").addLocalScreenStream(b);this.$35("screen_sharing_started")};e.stopScreenStream=function(b){var e=c("ScotchRTCCallStore").getState();e=e.localUser;if(!e.screenStreams.includes(b))return;if(!a.supportMultipleStreams()){e=e.streams.first();d("ScotchRTCUtils").transferAudioTracks(e,b)}c("ScotchRTCCallActions").removeLocalScreenStream(b);d("ScotchRTCUtils").stopMediaStream(b);this.$35("screen_sharing_stopped")};e.updateScreenStream=function(a,b){d("ScotchRTCUtils").transferAudioTracks(b,a),c("ScotchRTCCallActions").replaceLocalScreenStream(a,b),d("ScotchRTCUtils").stopMediaStream(a)};e.$49=function(b){if(!a.supportMultipleStreams()&&b.hasScreenStream())return!0;else return!b.isVideoDisabled()};e.$40=function(){var a=this,b=c("ScotchRTCP2PCallStore").getState();b=b.isPeerOnMobile;b=new(c("ScotchFBRTCPeerConnection"))(d("ScotchConstants").SignalingProtocol.P2P,c("ZenonRTCPeerConnectionConfig").getConfig(),c("ZenonRTCPeerConnectionConfig").getConstraints(b));var e,f=null,g,h;c("ScotchRTCCallStore").addListener(c("debounce")(function(){var b=c("ScotchRTCCallStore").getState();b=b.localUser;if(!b||b===e)return;e=b;var d=a.$49(b);f!==d&&f!==null&&a.$11&&a.$11.sendMuteStateUpdate(a.$2,a.$3,d);f=d;d=b.streams;b=b.screenStreams;var i=b!==h,j=d!==g;j&&c("gkx")("83")&&a.$26.update();j||i?(g=d,h=b,a.$41(i)):a.$26.update()},50));d("ZenonRTCConfig").getIsVCEndpointCall()&&b.createDataChannel("noop");b.addEventListener("icecandidate",this.$50);b.addEventListener("iceconnectionstatechange",this.$51);b.addEventListener("icegatheringstatechange",this.$52);b.addEventListener("icecandidateerror",this.$53);b.addEventListener("connectionstatechange",this.$54);b.addEventListener("signalingstatechange",this.$55);b.addEventListener("negotiationneeded",this.$56);b.addEventListener("addstream",this.$57);b.addEventListener("track",this.$58);b.addEventListener("removestream",this.$59);b.addEventListener("datachannel",this.$60);this.$61(b);return b};a.supportMultipleStreams=function(){var a=c("ScotchRTCP2PCallStore").getState();a=a.signalingExperiments;return a.support(c("ZenonUserCapabilities").MultipleStreamsPlanB)||a.support(c("ZenonUserCapabilities").MultipleStreamsUnified)};e.$62=function(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c=a.getStream();e=a.getScreenStream();f=!1;if(!c){g.next=8;break}e!=null?(this.$28.track(e),this.$26.track(e)):(this.$28.update(),this.$26.track(c));g.next=7;return b("regeneratorRuntime").awrap(d("ScotchFBRTCPeerConnectionHelper").resetLocalStreamsByTrack(this.$4,c,e));case 7:f=g.sent;case 8:this.$8=this.$8||f;case 9:case"end":return g.stop()}},null,this)};e.$41=function(b){b===void 0&&(b=!1);if(this.$4.getSignalingState()==="closed")return;var e=c("ScotchRTCCallStore").getState();e=e.localUser;if(!e)return;if(d("ZenonRTWebBrowserFeatureSupport").isReplaceTrackSupported()){c("promiseDone")(this.$62(e));return}var f=e.getStream();e=e.getScreenStream();var g=[];a.supportMultipleStreams()?(e?(g.push(e),this.$28.track(e)):this.$28.update(),f?(g.push(f),this.$26.track(f)):this.$26.update()):e?(this.$28.track(e),this.$26.track(e),g.push(e)):(this.$28.update(),f&&(this.$26.track(f),g.push(f)));if(d("ScotchRTWebClientFeatureGating").restartVideoWithTrackAPI()&&g.length===1){e=d("ScotchFBRTCPeerConnectionHelper").resetLocalStreamWithTrackAPI(this.$4,g[0],b);this.$8=this.$8||e}else{f=d("ScotchFBRTCPeerConnectionHelper").resetLocalStreams(this.$4,g);this.$8=this.$8||f}};e.updateStreamForUnifiedPlan=function(b){c("ScotchFBRTCPeerConnection").shouldUseAddTrackForUnifiedPlan()||c("FBLogger")("rtc_www").mustfix("This function must be called within Firefox context"),this.$8=!0,this.$4.addStream(b),a.replaceLocalStream(b)};e.$63=function(a){this.$38(d("ScotchConstants").CallEndReason.WEBRTC_ERROR,!1,!0,!1,a.message)};e.$68=function(a){var b=this,e=a==="connected"||a==="completed";a=a==="disconnected"||a==="failed";e&&this.$22!=null?(this.$35("Clearing platform connection drop timer"),c("clearTimeout")(this.$22),this.$22=null):a&&this.$22==null&&(this.$35("Setting platform connection drop timer"),this.$22=c("setTimeout")(function(){b.$35("Ending call on platform connection drop timeout"),b.$38(d("ScotchConstants").CallEndReason.CONNECTION_DROPPED,!1,!0,!1,"IceDisconnected")},l))};e.$69=function(){var a=!c("ScotchRTCP2PCallStore").isAudioOnly()||c("ScotchRTCP2PCallEscalator").initVideoInAudioCall(),b={ADD_AUDIO_NACK:d("ScotchRTCSignalingExperiments").shouldEnableAudioNack(),DISABLE_OPUS_STEREO:d("ScotchRTWebClientFeatureGating").disableOpusStereo(),SSRC_CONTENT_TYPE:d("ScotchRTWebClientFeatureGating").addScreenContentTypeInSDP()?c("ScotchRTCCallStore").getState().localUser.getMediaTypeForTracks():void 0};return this.$4.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:a,preserveH264:!1},b)};e.$64=function(a){var b=a.sdpMid;if(b!=null){b=this.$4.rewriteLocalIceCandidate(b,a.sdpMLineIndex);var c=b[0];b=b[1];if(window.RTCIceCandidate){var d=a.candidate;a=new RTCIceCandidate(babelHelpers["extends"]({candidate:d,sdpMid:c},b!=null?{sdpMLineIndex:b}:null))}else a.sdpMid=c}a.candidate!==""&&this.$11.sendIceCandidate(this.$2,this.$3,a)};e.internalResetConnection=function(){var a=this;this.$8=!1;var b=this.$2,e=c("ScotchRTCCallStore").getState().remoteUsers.first(),f=e.streams,g=e.screenStreams;this.$29=!0;this.$30.clear("add");this.$30.push("remove",function(){for(var a=f,d=Array.isArray(a),e=0,a=d?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(d){if(e>=a.length)break;h=a[e++]}else{e=a.next();if(e.done)break;h=e.value}h=h;c("ScotchRTCCallActions").removeRemoteStream(h,b)}for(var h=g,e=Array.isArray(h),d=0,h=e?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(e){if(d>=h.length)break;a=h[d++]}else{d=h.next();if(d.done)break;a=d.value}a=a;c("ScotchRTCCallActions").removeRemoteScreenStream(a,b)}});this.$4.reset().then(function(){a.$29=!1,a.$30.drain()})["catch"](function(b){a.$63(new Error("Failed to reset peer connection: "+b.message))});d("ZenonRTCConfig").getIsVCEndpointCall()&&this.$4.createDataChannel("noop")};e.$74=function(a){var b=d("ScotchConstants").StreamType;try{switch(this.$5.streams[a.id].type){case b.SCREEN_CONTENT:return b.SCREEN_CONTENT;case b.AUDIO_VIDEO:return b.AUDIO_VIDEO;case b.AUDIO_ONLY:return b.AUDIO_ONLY}}catch(c){return a.getVideoTracks().length>0?b.AUDIO_VIDEO:b.AUDIO_ONLY}};e.$65=function(){this.$26.isStarted()?this.$26.update():this.$26.start();var a=c("ScotchRTCP2PCallStore").getState();a=a.callType;a!==c("ScotchRTCCallType").AUDIO_ONLY&&(this.$27.isStarted()?this.$27.update():this.$27.start());this.$28.isStarted()?this.$28.update():this.$28.start()};e.$66=function(){var a=c("ScotchRTCP2PCallStore").getState().connectionStatus;if(a==="ESCALATING_TO_BJN")return;d("ScotchRTCP2PCallActions").setConnectionStatus("CONNECTED");this.$33||(this.$33=!0,this.$11.sendClientReportedEvent(this.$2,this.$3,d("ScotchConstants").ClientReportedEventType.MEDIA_CONNECTED),this.$35("RTCP2PProtocolHandler_first_time_media_connected"));n(function(a){a.onCallConnected(),a.onNetworkReady()})};e.startLocalVideoTracker=function(a){this.$26.track(a)};e.updateLocalVideoTracker=function(){this.$26.update()};a.initStream=function(b,d,e){c("ScotchRTWebUserActionLogger").startTimer("RTCP2PProtocolHandler_initStream");return a.internalInitStream(b,d,e).then(function(a){c("ScotchRTWebUserActionLogger").logStopTimer({timerName:"RTCP2PProtocolHandler_initStream",checkpointName:"RTCP2PProtocolHandler_initStream_success"});return a})["catch"](function(a){c("ScotchRTWebUserActionLogger").logStopTimer({timerName:"RTCP2PProtocolHandler_initStream",checkpointName:"RTCP2PProtocolHandler_initStream_failed"});throw a})};a.internalInitStream=function(a,b,d){var e=!a&&c("ScotchRTCP2PCallEscalator").initVideoInAudioCall();return o(a,e,b,d)};a.replaceLocalStream=function(a,b){b===void 0&&(b=!1);var e=c("ScotchRTCCallStore").getState().localUser.streams.first();c("ScotchRTCCallActions").replaceLocalStream(e,a);b&&d("ScotchRTCUtils").stopMediaStream(e)};e.escalateToMultiway=function(){var a=c("ScotchRTCP2PCallStore").getState(),b=a.callType,d=a.offerEscalationSupport;a=a.escalationConferenceName;if(d&&a){n(function(a){return a.setEscalationInitiated()});d=b!==c("ScotchRTCCallType").AUDIO_ONLY&&(c("ScotchRTCCallStore").hasRemoteVideo()||c("ScotchRTCCallStore").hasLocalVideo());b=new(c("ScotchRTCGroupCallEscalator"))(a,d,this.$2,this.$3);b.startEscalationToMultiway()}};e.handleSwitchToMultiway=function(){var a=c("ScotchRTCP2PCallStore").getState(),b=a.callType,d=a.offerEscalationSupport;a=a.escalationConferenceName;this.$7=!1;if(d&&a){n(function(a){return a.setReceivedEscalationRequest()});d=b!==c("ScotchRTCCallType").AUDIO_ONLY&&(c("ScotchRTCCallStore").hasRemoteVideo()||c("ScotchRTCCallStore").hasLocalVideo());b=new(c("ScotchRTCGroupCallEscalator"))(a,d,this.$2,this.$3);b.startEscalationToMultiway()}};e.$76=function(a,b){var e=c("gkx")("678353"),f=a&&e&&d("RTWebIncomingRingConfiguration").isSupportedClientForProtocol(c("ZenonSignalingProtocol").MW);this.$14=f;this.$15=b;d("ScotchRTCP2PCallActions").setMultiwayEscalationSupport(f,b);n(function(a){a.setConferenceName(b),f&&a.setEscalationAvailable()})};e.$46=function(){d("ScotchFBRTCUrlManager").onCallStarted(this.$2);if(this.$20){this.$7=!0;this.$8=!1;var a=this.$20.msg,b=a.sdp,c=a.attributes,e=a.offer_escalation_support;a=a.escalation_conference_name;d("ScotchRTCP2PCallActions").setRemoteSignalingExperiments(this.$20.getSignalingExperiments());this.$76(!!e,a);this.onReceivedRemoteSDP(d("ScotchFBRTCSdpUtils").removeH264(b),"offer",c);d("ScotchRTWebExperiments").passOfferWithWindowMessages()||d("ScotchRTCLocalMessageQueue").clearPeerOfferFromStorage(this.$2);this.$34("local message queue updates",{action:"removeOffer",offer:this.$20,callID:this.$3});this.$20=null}this.$34("call: try",{initialOffer:this.$20})};e.$73=function(a){var b=this;this.$7=!0;return this.$4.setLocalDescription(a).then(function(a){a=a.toDesc();var c=a.sdp;a=a.type;c=b.$4.transformLocalSdp(c);switch(a){case"offer":b.$77(c);b.$17=!1;break;case"answer":b.$78(c);break;default:break}})["catch"](function(a){b.$63(new Error("Failed to set local description: unexpected SDP type"))})};e.$79=function(){var b={},e=c("ScotchRTCCallStore").getState();e=e.localUser.screenStreams;if(a.supportMultipleStreams()===!1)for(var f=this.$4.getLocalStreams(),g=Array.isArray(f),h=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=f.length)break;i=f[h++]}else{h=f.next();if(h.done)break;i=h.value}i=i;var j=i.getVideoTracks().length?d("ScotchConstants").StreamType.AUDIO_VIDEO:d("ScotchConstants").StreamType.AUDIO_ONLY;b[i.id]={type:j}}else for(var i=this.$4.getLocalStreams(),j=Array.isArray(i),h=0,i=j?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(j){if(h>=i.length)break;g=i[h++]}else{h=i.next();if(h.done)break;g=h.value}f=g;g=e.includes(f)?d("ScotchConstants").StreamType.SCREEN_CONTENT:f.getVideoTracks().length?d("ScotchConstants").StreamType.AUDIO_VIDEO:d("ScotchConstants").StreamType.AUDIO_ONLY;b[f.id]={type:g}}return{streams:b}};e.$77=function(a){var b=this,e=this.$9?d("ScotchConstants").PayloadType.PCRESTART_OFFER:d("ScotchConstants").PayloadType.OFFER,f=c("ScotchRTCCallStore").getState();f=f.callSummary;f=f?f.getCallTrigger():"";this.$12=new(c("ScotchFBRTCRetriableMessage"))(this.$11);this.$12.addListener("sendingRetry",this.$70);this.$12.addListener("timeoutFailure",this.$72);this.$12.sendMessage(e,this.$2,this.$3,{sdp:a,hasVideo:!c("ScotchRTCP2PCallStore").isAudioOnly(),attributes:this.$79(),callTrigger:f});this.$21=c("setTimeout")(function(){b.$38(d("ScotchConstants").CallEndReason.NO_ANSWER_TIMEOUT,!1,!0,!1,"NoAnswerTimeout")},h)};e.$80=function(a){if(!Object.prototype.hasOwnProperty.call(a,"videoon"))return;a=!a.videoon;c("ScotchRTCCallActions").toggleMuteRemoteVideo(a,this.$2);for(var a=this.$4.getRemoteStreams(),b=Array.isArray(a),d=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(b){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;if(e.getAudioTracks().length>0){this.$34("remote steam: mute toggled",e);return}}this.$27.update()};e.$78=function(a){this.$13=new(c("ScotchFBRTCRetriableMessage"))(this.$11);this.$13.addListener("sendingRetry",this.$70);var b={escalationConferenceName:this.$15,negotiatedEscalationSupport:this.$14};this.$13.sendMessage(d("ScotchConstants").PayloadType.ANSWER,this.$2,this.$3,{sdp:a,hasVideo:!c("ScotchRTCP2PCallStore").isAudioOnly(),attributes:this.$79(),multiwayInfo:b})};e.processQueuedMessages=function(){var a=this;d("ScotchRTCLocalMessageQueue").drainQueue(this.$2,function(b){a.$47(b,{skipDupeCheck:!0})})};e.$47=function(a,b){var e;try{e=new(c("ScotchFBRTCMessage"))(a)}catch(b){this.$6.logError(this.$2,this.$3,"Unknown data: "+JSON.stringify(a));return}this.$6.logReceivedMessage(e.peerID,e.callID,e.msg);this.$34("message received",e.msg);if(this.$81()){this.$71("ScotchRTCP2PProtocolHandler: Ignoring message (call ended): "+e.msgID);return}if(!(b==null?void 0:b.skipDupeCheck)&&!d("ScotchFBRTCMessageDedup").check(e.peerID,e.callID,e.msgID)){this.$71("ScotchRTCP2PProtocolHandler: Ignoring message (duplicate): "+e.msgID);return}if(c("ScotchRTCCallStore").getState().callInfo.conferenceState==="AWAITING_USER_START"){this.$71("ScotchRTCP2PProtocolHandler: Ignoring message (awaiting user start): "+e.msgID);return}if(this.$2&&this.$2!==e.peerID){e.isOffer()&&this.$82(e);this.$71("ScotchRTCP2PProtocolHandler: Ignoring message (different peer): "+e.msgID);return}if(e.selfID!=null&&e.selfID!==this.$1){this.$71("ScotchRTCP2PProtocolHandler: Ignoring message (wrong receiver): "+e.msgID);return}if(!e.isForCall(this.$3,this.$15)){this.$71("ScotchRTCP2PProtocolHandler: Ignoring message (different call): "+e.msgID+"(callID: "+e.callID+")");return}this.$3&&this.$3===e.callID&&n(function(a){return a.onFullMessageReceived(e)});a=c("ScotchRTCGroupCallEscalationStore").getState().inProgress;switch(e.msgType){case d("ScotchConstants").PayloadType.ICERESTART_OFFER:case d("ScotchConstants").PayloadType.PCRESTART_OFFER:this.internalResetConnection();this.$83(e);break;case d("ScotchConstants").PayloadType.OFFER:this.$83(e);break;case d("ScotchConstants").PayloadType.ANSWER:case d("ScotchConstants").PayloadType.ICERESTART_ANSWER:case d("ScotchConstants").PayloadType.PCRESTART_ANSWER:d("ScotchRTCP2PCallActions").setRemoteSignalingExperiments(e.getSignalingExperiments());this.$84(e);break;case d("ScotchConstants").PayloadType.SDP_UPDATE:this.$85(e);break;case d("ScotchConstants").PayloadType.ICE_CANDIDATE:this.$86(e);break;case d("ScotchConstants").PayloadType.HANGUP:this.$87(e);break;case d("ScotchConstants").PayloadType.OFFER_ACK:this.$88(e);break;case d("ScotchConstants").PayloadType.OFFER_NACK:this.$25=!0;break;case d("ScotchConstants").PayloadType.ANSWER_ACK:this.$89();break;case d("ScotchConstants").PayloadType.MSG_ACK:this.$90(e);break;case d("ScotchConstants").PayloadType.SET_VIDEO:this.$91(e);break;case d("ScotchConstants").PayloadType.SWITCH_TO_MULTIWAY:a||this.handleSwitchToMultiway();break;case d("ScotchConstants").PayloadType.VIDEO_REQUEST:case d("ScotchConstants").PayloadType.ACK:case d("ScotchConstants").PayloadType.OK:case d("ScotchConstants").PayloadType.PING:case d("ScotchConstants").PayloadType.PING_ACK:case d("ScotchConstants").PayloadType.OTHER_DISMISS:case d("ScotchConstants").PayloadType.PRANSWER:break;default:break}this.$31.parseMessage(e)};e.$45=function(a){switch(a.msg_type){case"bjn_escalating":var b=c("ScotchRTCP2PCallStore").getState().connectionStatus;d("ScotchRTCP2PCallActions").setConnectionStatus("ESCALATING_TO_BJN");c("setTimeout")(function(){d("ScotchRTCP2PCallActions").setConnectionStatus(b)},i);break;case"participants":d("ScotchRTCOneVCActions").storeParticipants(JSON.parse(a.payload).list);break;default:break}};e.$82=function(a){var b=a.peerID,e=a.callID;this.$35("RTCP2PProtocolHanlder_collision_offer_from_another_peer");var f=a.msg,g=new(c("ScotchFBRTCCallSummary"))({peerID:b,callID:e,isCaller:!1});g.setActiveConnection("p2p");g.onFullMessageReceived(a);g.setCallType(d("ScotchFBRTCSdpUtils").isVideoSupported(f.sdp)?d("ScotchConstants").CallType.DIRECT_VIDEO:d("ScotchConstants").CallType.VOIP);this.$11.sendOfferAck(b,e,f);g.onOfferAckSent(f);a=new(c("ScotchRTCEndCallReason"))(d("ScotchConstants").CallEndReason.IN_ANOTHER_CALL);this.$92(b,e,a,!1);g.onCallEnded(a.getReasonID(),!1);g.save(c("ScotchFBRTCCallSummaryStore").getInstance())};e.$83=function(a){var b=a.msg;if(!d("ScotchRTWebExperiments").enableCallCollisionFix()){this.$3&&b.call_id!==this.$3&&this.$35("RTCP2PProtcolHandler_call_collision");var c=this.$4.getSignalingState();if(c!=="stable")return}if(b.calltype){this.$11.sendOfferNack(this.$2,b.call_id,b);return}this.$11.sendOfferAck(this.$2,b.call_id,b);this.$11.sendOtherDismiss(b.call_id);this.$93(b)?this.$94(a):this.$95(a)};e.resetCollisionSummary=function(a,b){var e=a.msg;n(function(a){a.onCallEnded(d("ScotchConstants").CallEndReason.OTHER_INSTANCE_HANDLED,!1,!1,"call_collision"+(b?"_resetConnection":"_atStart"))});var f=new(c("ScotchFBRTCCallSummary"))({peerID:this.$2,callID:e.call_id,isCaller:!1});c("ScotchRTCCallActions").setCallSummary(f);n(function(b){b.setActiveConnection("p2p"),b.onFullMessageReceived(a),b.onOfferAckSent(e),b.setCallType(d("ScotchFBRTCSdpUtils").isVideoSupported(e.sdp)?d("ScotchConstants").CallType.DIRECT_VIDEO:d("ScotchConstants").CallType.VOIP),b.setCallTrigger("call_collision")})};e.handleCallCollision=function(a,b){this.$6.logEvent(this.$2,this.$3,"Handling offer collision");this.resetCollisionSummary(a,b);if(d("ScotchRTWebExperiments").enableCallCollisionFix()){this.$3=a.callID;a=a.msg;b?this.internalResetConnection():this.$11.sendOtherDismiss(a.call_id);c("ScotchRTCCallActions").callCollision(a.call_id.toString(),this.$2);this.$35("RTCP2PProtocolHandler_handling_call_collision"+(b?"_resetConnection":"_atStart"))}};e.$94=function(a){var b=a.msg;this.$80(b);c("clearTimeout")(this.$24);this.$96();this.$97();this.$98();if(this.$3!==b.call_id){b=new(c("ScotchRTCEndCallReason"))(d("ScotchConstants").CallEndReason.OTHER_INSTANCE_HANDLED);this.$92(this.$2,this.$3,b,!1);this.handleCallCollision(a,!0)}else this.$6.logEvent(this.$2,this.$3,"Handling offer refresh");this.$17=!1;this.$20=a;d("ScotchRTCP2PCallActions").processMessage(a);this.$46();this.$34("offer accepted",a.msgID)};e.$95=function(a){this.$6.logEvent(this.$2,this.$3,"Ignoring offer"),this.$34("offer ignored",a.msgID)};e.$85=function(a){var b=this,e=a.msg;d("ScotchRTCP2PCallActions").processMessage(a);this.$80(e);switch(this.$4.getSignalingState()){case"stable":this.onReceivedRemoteSDP(this.$99("offer",a),"offer",e.attributes);break;case"have-local-offer":this.onReceivedRemoteSDP(this.$99("answer",a),"answer",e.attributes).then(function(){return b.$100()})["catch"](function(a){b.$63(new Error("Failed to handle sdp update when signaling state is 'have-local-offer': "+a.message))});break;case"have-remote-offer":c("setTimeout")(function(){return b.$85(a)},1e3);break;case"have-local-pranswer":case"have-remote-pranswer":break;case"closed":break}this.$34("SDP update",[e.sdp,e.attributes])};e.$99=function(a,b){b=b.msg;var e=c("ScotchRTCP2PCallStore").getState();e=e.isPeerOnMobile;var f=c("ScotchRTCP2PCallStore").isCaller();return a==="offer"?!e&&f&&c("UserAgent").isBrowser("Firefox")?d("ScotchFBRTCSdpUtils").setDtlsRole(b.sdp,this.$10):b.sdp:d("ScotchFBRTCSdpUtils").setDtlsRole(b.sdp,e&&!f?"passive":this.$10)};e.$100=function(){this.$7=!1};e.$67=function(){var a=this.$4.getSenders().find(function(a){var b;return(a==null?void 0:(b=a.track)==null?void 0:b.kind)==="audio"&&typeof a.getParameters==="function"&&typeof a.setParameters==="function"});if(a==null)return;if(d("ScotchRTCSignalingExperiments").shouldCapAudioBitrate()){var e=c("ZenonExperimentFetcher").getMediaQualityExperiments().getInt("max_audio_bitrate",0);if(e>0){var f=a.getParameters();f.encodings!=null?f.encodings[0].maxBitrate=e:f.encodings=[{maxBitrate:e}];b("Promise").resolve(a.setParameters(f))}else this.$6.logError(this.$2,this.$3,"received 0 for max audio bitrate")}};e.onReceivedRemoteSDP=function(a,b,e){var f=this;this.$101(e);e=c("ScotchRTCP2PCallStore").getState();e=e.isPeerOnMobile;e&&(a=d("ScotchFBRTCSdpUtils").setVideoBitrateConstraint(a));b==="answer"?a=this.$4.transformRemoteSdp(a):c("ScotchRTCP2PCallEscalationStore").isEscalated()&&(a=this.$4.processRemoteOfferSdpForP2PVideoEscalation(a));return this.$4.setRemoteDescription(new(c("ScotchRTCSessionDescription"))(d("ScotchConstants").SignalingProtocol.P2P,{type:b,sdp:a})).then(function(){f.$17=!0,f.$16.drainCandidates(f.$2,f.$3,function(a){return f.$4.onReceivedRemoteIceCandidate(a)})}).then(function(){return b!=="offer"?void 0:f.$4.createAnswer({DISABLE_OPUS_STEREO:d("ScotchRTWebClientFeatureGating").disableOpusStereo(),ADD_AUDIO_NACK:d("ScotchRTCSignalingExperiments").shouldEnableAudioNack()}).then(function(a){f.$73(a),f.$34("SDP update",{answer:a.toSdp()})})}).then(function(){f.$39()===c("ScotchRTCCallType").AUDIO_ONLY&&f.$11.sendMuteStateUpdate(f.$2,f.$3,!1)})["catch"](function(a){f.$63(a);throw a})};e.$101=function(a){if(a){var b=a.streams;this.$5=babelHelpers["extends"]({},this.$5,a,{streams:babelHelpers["extends"]({},this.$5.streams,b)})}};e.$93=function(a){return a.call_id===this.$3?!0:Boolean((this.$21||!this.$20)&&(!this.$3||a.call_id!==this.$3)&&c("ScotchRTCP2PCallStore").isCaller()&&(!a.handlescollision||a.call_id<this.$3))};e.$84=function(a){var b=this,e=this.$4.getSignalingState();if(e!=="have-local-offer")return;e=a.msg;this.$76(!!e.negotiated_escalation_support,e.escalation_conference_name);c("clearTimeout")(this.$24);this.$96();this.$97();this.$11.sendAnswerAck(this.$2,this.$3,e);d("ScotchRTCP2PCallActions").processMessage(a);d("ScotchRTCP2PCallActions").setConnectionStatus("CONNECTING");this.onReceivedRemoteSDP(e.sdp,"answer",e.attributes).then(function(){b.$100(),c("ScotchRTCCallActions").callSuccess(!0)})["catch"](function(a){b.$63(new Error("Failed to handle answer on receiving remote SDP"))});this.$80(e)};e.$90=function(a){var b=a.msg;this.$12&&this.$12.isAckMsg(b)?(n(function(b){b.onMsgAckReceived(a,!0)}),this.$88(a)):this.$13&&this.$13.isAckMsg(b)&&(n(function(b){b.onMsgAckReceived(a,!1)}),this.$89())};e.$88=function(a){d("ScotchRTCP2PCallActions").setConnectionStatus("RINGING"),n(function(b){b.setUploadLogLevel(d("ZenonLocalUploadLogLevel").getUploadLogLevel(d("ScotchConstants").convertToUploadLogLevel(a.msg.ull)))}),c("clearTimeout")(this.$24),this.$96()};e.$89=function(){this.$98(),this.$100(),c("ScotchRTCCallActions").incomingCallSuccess()};e.$91=function(a){this.$19?this.$75(a):(this.$71("ScotchRTCP2PProtocolHandler: P2P message "+a.msgType+" queued for delay handling"),this.$18.push(a))};e.$75=function(a){c("ScotchRTCP2PCallStore").getState().isRemoteVideoSupported&&!c("ScotchRTCP2PCallStore").isAudioOnly()&&this.$80(a.msg)};e.$86=function(a){var b=this,c=a.msg;c.call_id===this.$3&&this.$17?this.$4.onReceivedRemoteIceCandidate(c)["catch"](function(a){b.$102(c)}):this.$102(c)};e.$102=function(a){this.$16.cacheCandidate(this.$2,a.call_id,a)};e.$87=function(a){a=a.msg;var b=a.call_id,c=a.reason;a=a.subreason;b===this.$3?this.$38(c,!0,!1,!1,a):(this.$6.logError(this.$2,this.$3,"Receiving hangup for a different call: "+b.toString()),this.$34("hangup callID missmatch",b.toString()))};e.$38=function(a,b,e,f,g){var h=this,i=new(c("ScotchRTCEndCallReason"))(a).setSubreason(g).setRemoteEnded(b);c("ScotchRTCCallActions").setEndCallReason(i);d("ScotchRTCCallNUXActions").refreshNUXState();a=c("ScotchRTCP2PCallEscalationStore").getState().inProgress;a&&d("ScotchRTCP2PCallEscalationActions").cancel();c("clearTimeout")(this.$24);this.$96();this.$97();this.$98();if(this.$81()){this.$6.logError(this.$2,this.$3,"Ending an already-ended call");return}this.$6.logCallAction(this.$2,this.$3,c("ScotchRTCLogger").CallAction.END_CALL,i.toStrName());this.$34("call: ended",{reason:i.toStrName(),reasonID:i.getReasonID(),subReason:i.getSubreason(),isRemoteEnded:b,userCallType:this.$39(),isCaller:c("ScotchRTCP2PCallStore").isCaller()});e&&this.$92(this.$2,this.$3,i,f);this.$26.stop();this.$27.stop();this.$28.stop();c("ScotchRTCCallActions").hangupSuccess();this.$32||c("ScotchRTCCallActions").removeAllLocalStreams(!0);c("ScotchRTCCallActions").removeAllLocalScreenStreams(!0);c("ScotchRTCCallActions").removeAllRemoteStreams(this.$2);d("ScotchRTCP2PCallActions").setConnectionStatus("DISCONNECTED");if(c("gkx")("965758")){g=c("ScotchRTCCallStore").getState();a=g.callSummary;e=g.callInfo;f=d("ZenonTSLogDataHelper").serialize(e.tsLogData);this.$6.logTsLogData(f,a.peerID,a.callID,e.conferenceName)}n(function(a){a.setCallType(c("ScotchRTCP2PCallEscalationStore").getState().callType),a.setVideoDurations(h.$26.getDuration(),h.$27.getDuration()),a.setScreenDuration(h.$28.getDuration()),a.onCallEnded(i.getReasonID(),b,null,i.getSubreason()),h.$35("logged end call to call summary")});this.$4&&this.$4.close();i.getReasonID()===d("ScotchConstants").CallEndReason.HANGUP_CALL&&i.getSubreason()==="CallReset"&&b&&d("ScotchRTCP2PCallWindowHandler").close();if(c("UserAgent").isBrowser("FBLite")&&c("gkx")("718")){g=c("ScotchRTCCallStore").getState();f=g.callSummary;f.logThisSummary(c("ScotchFBRTCCallSummaryStore").getInstance(),!0);this.$35("logged fblite call to marauder")}};e.$39=function(){var a=c("ScotchRTCCallStore").getState();a=a.localUser;var b=this.$49(a);return b===!1&&a.isAudioDisabled()?c("ScotchRTCCallType").NO_AUDIO_VIDEO:b===!1&&!a.isAudioDisabled()?c("ScotchRTCCallType").AUDIO_ONLY:c("ScotchRTCCallType").AUDIO_VIDEO};e.shutDownP2PListenersForMultiwayEscalation=function(){var a=this;c("clearTimeout")(this.$24);this.$96();this.$97();this.$98();this.$26.stop();this.$27.stop();this.$4&&this.$4.removeAllListeners();c("setTimeout")(function(){c("ScotchRTCGroupCallEscalationStore").logToP2PCallSummary(function(b){b.setCallType(c("ScotchRTCP2PCallEscalationStore").getState().callType),b.setVideoDurations(a.$26.getDuration(),a.$27.getDuration()),b.setScreenDuration(a.$28.getDuration()),b.onCallEnded(d("ScotchConstants").CallEndReason.HANGUP_CALL,!1,!1,"multiway escalation")}),c("ScotchRTCCallActions").completeTransitionToMultiway()},100);this.destroy()};e.$92=function(a,b,c,d){if(!this.$11)return;this.$11.sendHangup(a,b,c.getReasonID(),d,c.getSubreason());this.$11.sendOtherDismiss(b)};e.$96=function(){this.$12&&this.$12.stopRetrying()};e.$98=function(){this.$13&&this.$13.stopRetrying()};e.$97=function(){this.$21&&c("clearTimeout")(this.$21),this.$21=null};e.$81=function(){return c("ScotchRTCCallStore").getState().callInfo.conferenceState==="TERMINATED"};e.$61=function(a){var c=this;m(function(d){d=d.logConnectionStats(function(){var c=a.getSignalingState();return c!=="closed"?a.getStats():b("Promise").reject("peer connection closed")},c.$2,c.$3);var e=d.start,f=d.stop;d=function b(d){d=d.target;d=d.iceConnectionState;(d==="completed"||d==="connected")&&(c.$35("RTCP2PProtocolHandler_call_connected"),c.$34("call: connected"),e(),a.removeEventListener("iceconnectionstatechange",b),a.addEventListener("iceconnectionstatechange",g))};var g=function b(c){c=c.target;c=c.iceConnectionState;c==="closed"&&(f(),a.removeEventListener("iceconnectionstatechange",b))};a.addEventListener("iceconnectionstatechange",d)})};e.$34=function(a,b){var c=this;m(function(d){return d.log(a,{peerID:c.$2,callID:c.$3,eventDetails:b})})};e.destroy=function(){this.$30.clear();if(d("ScotchRTWebExperiments").shouldUseZenonSignaling()){var a=c("ScotchRTCP2PCallStore").getState().signalingChild;a!=null&&a.removeAllListeners("messageReceived")}else c("FBRTCMessageListener").removeMessageHandler();d("ZenonRTCConfig").getIsVCEndpointCall()&&c("FBRTCMessageListener").removeOneVCMessageHandler();this.$11.onMessageSent=null,this.$11.onSendFailure=null};e.generateEscalationRequestToken=function(a){return this.$31.generateRequestToken(a)};e.generateEscalationResponseToken=function(a,b){return this.$31.generateResponseToken(a,b)};a.getDefaultVideoQuality=function(){return d("ZenonRTCConfig").getIsVCEndpointCall()||d("ZenonRTCConfig").shouldUseHDVideoQuality()?d("ScotchConstants").VideoQuality.HD_VIDEO:c("CurrentUser").isWorkUser()?d("ScotchConstants").VideoQuality.SD_VIDEO:d("ScotchConstants").VideoQuality.LQ_VIDEO};a.showRedialButton=function(){var a=c("ScotchRTCP2PCallStore").getState();a=a.endCallReason;var b=c("ScotchRTCCallStore").getState();b=b.callSummary;return a!=null&&(a.getReasonID()===d("ScotchConstants").CallEndReason.IGNORE_CALL||a.getReasonID()===d("ScotchConstants").CallEndReason.NO_ANSWER_TIMEOUT)||b.getCallDuration()<=j};a.showStarRating=function(){if(!d("ZenonRTCConfig").getIsVCEndpointCall()){var b=c("ScotchRTCP2PCallStore").getState(),e=b.endCallReason;b=b.wasConnected;return b&&e!=null&&e.getReasonID()===d("ScotchConstants").CallEndReason.HANGUP_CALL}else return!a.showRedialButton()};e.$71=function(a){this.$6.logInfo(this.$2,this.$3,a)};e.$35=function(a){c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:a,callID:this.$3?this.$3.toString():null,callType:"p2p"})};return a}();function m(a){if(!d("ZenonRTCConfig").getIsVCEndpointCall())return;c("Bootloader").loadModules(["ScotchCollabMessengerLogger"],a,"ScotchRTCP2PProtocolHandler")}function n(a){var b=c("ScotchRTCCallStore").getState();b=b.callSummary;a(b);b.save(c("ScotchFBRTCCallSummaryStore").getInstance())}function o(a,e,f,g){var h,i,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:h={requestAudio:!0};f!=null&&(h.deviceId={ideal:f});i={requestVideo:a||e,aspectRatio:{ideal:Number((16/9).toFixed(10))},height:{max:d("ScotchConstants").RTCConstraints.height.sd,min:d("ScotchConstants").RTCConstraints.height.lq,ideal:d("ScotchConstants").RTCConstraints.height.lq},width:{max:d("ScotchConstants").RTCConstraints.width.sd,min:d("ScotchConstants").RTCConstraints.width.lq,ideal:d("ScotchConstants").RTCConstraints.width.lq},frameRate:{max:d("ScotchConstants").RTCConstraints.frameRate.sd,min:10,ideal:d("ScotchConstants").RTCConstraints.frameRate.lq}};g!=null&&(i.deviceId={ideal:g});l.next=6;return b("regeneratorRuntime").awrap(d("ZenonLocalMediaSDK").getUserMediaWithFallback(h,a||e?i:{requestVideo:!1}));case 6:j=l.sent;if(!(e&&!a)){l.next=11;break}k=[];j.forEach(function(a){a.contentType==="video"&&(a.webrtcTrack.enabled=!1,k.push(new(c("ZenonImmutableMediaTrack"))({trackId:a.trackId,label:a.label,webrtcStream:a.webrtcStream,webrtcTrack:a.webrtcTrack,enabled:!1,userMuted:a.userMuted,remote:a.remote,contentType:a.contentType,contentHint:a.contentHint}))),k.push(a)});return l.abrupt("return",k[0].webrtcStream);case 11:return l.abrupt("return",j[0].webrtcStream);case 12:case"end":return l.stop()}},null,this)}g["default"]=a}),98);
__d("ZenonHistogramCounter",[],(function(a,b,c,d,e,f){"use strict";var g=1e4;a=function(){function a(a,b,c){this.$1=[];this.$2=0;this.$3=0;this.$4=0;this.$5=!1;this.$6=1;if(a>b||c<=0)return;(Math.floor(a)!==a||Math.floor(b)!==b||Math.floor(c)!==c)&&(this.$6=g);this.$3=Math.floor(a*this.$6+.5);this.$2=Math.floor(c*this.$6+.5);a=Math.floor((Math.floor(b*this.$6+.5)-this.$3)/this.$2)+2;this.$1=new Array(a).fill(0);this.$4=this.$3+(a-2)*this.$2;this.$5=!0}var b=a.prototype;b.update=function(a){if(!this.$5||this.$1.length===0)return;a=Math.floor(a*this.$6+.5);if(a<this.$3)++this.$1[0];else if(a>=this.$4)this.$1[this.$1.length-1]++;else{a=Math.floor((a-this.$3+.5)/this.$2)+1;this.$1[a]++}};b.getStats=function(){return this.$5?this.$1:null};return a}();f["default"]=a}),66);
__d("ZenonHistogram",[],(function(a,b,c,d,e,f){"use strict";function g(a,b){return(a.value||0)-(b.value||0)}a=function(){function a(){this.$1=[],this.$2=!0}var b=a.prototype;b.$3=function(){this.$2===!1&&this.$1.sort(g),this.$2=!0};b.add=function(a){this.$1.push(a),this.$2=!1};b.getAvgAndPercentile=function(a,b){this.$2||this.$3();var c=b?this.$1.filter(b):this.$1;if(c.length===0)return{avg:null,percentiles:null};b=c.reduce(function(a,b){return a+b.value},0)/c.length;a=a.map(function(a){a=Math.min(100,Math.max(0,a));a=(c.length-1)*a/100;var b=Math.floor(a),d=Math.ceil(a);if(b===d)return c[b].value;var e=c[b].value*(d-a);d=c[d].value*(a-b);return e+d});return{avg:b,percentiles:a}};return a}();f["default"]=a}),66);
__d("ZenonPercentMediaStat",["ZenonHistogram","ZenonMediaStatsConfig"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=new(c("ZenonHistogram"))()}var b=a.prototype;b.add=function(a,b,c,d){c={contentType:c,value:a,view:b,voiceEnergy:d};this.$1.add(c)};b.getAvgAndPercentile=function(a,b,c,e){var f;e==null?f=function(a){return a.view===b&&a.contentType===c}:f=function(a){var f=a.voiceEnergy>d("ZenonMediaStatsConfig").VOICE_ENERGY_THRESHOLD;return a.view===b&&a.contentType===c&&f===e};return this.$1.getAvgAndPercentile(a,f)};return a}();g["default"]=a}),98);
__d("ScotchFBRTCMediaMetricParser",["FBLogger","FBRTCParticipantCallState","ScotchCallModelEmitter","ScotchFBRTCGroupCallStore","ScotchFBRTCMediaMetricTracker","ScotchFBRTCMediaMetricsConst","ScotchFBRTCStatsHelpers","ScotchRTCCallStore","ScotchRTCLogger","ZenonHistogramCounter","ZenonMediaStatsConfig","ZenonMediaStatsParser","ZenonMediaStatsReportPoller","ZenonPercentMediaStat","ZenonRenderedView","performanceNow","promiseDone","qex","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=5e3,i=[d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_AV_SYNC_ABS],j=[{trackId:d("ZenonMediaStatsConfig").OUTBOUND_AUDIO_STATS_TRACKID,contentType:"audio",renderedView:c("ZenonRenderedView").GRID,isRemote:!1},{trackId:d("ZenonMediaStatsConfig").OUTBOUND_VIDEO_STATS_TRACKID,contentType:"video",renderedView:c("ZenonRenderedView").GRID,isRemote:!1},{trackId:d("ZenonMediaStatsConfig").OUTBOUND_SCREEN_STATS_TRACKID,contentType:"screen",renderedView:c("ZenonRenderedView").GRID,isRemote:!1}],k=[{trackId:d("ZenonMediaStatsConfig").GLOBAL_STATS_TRACKID,contentType:d("ZenonMediaStatsConfig").GLOBAL_STATS_CONTENT_TYPE,renderedView:d("ZenonMediaStatsConfig").GLOBAL_STATS_RENDERED_VIEW,isRemote:!1},{trackId:d("ZenonMediaStatsConfig").PINNED_AUDIO_STATS_TRACK_INFO.trackId,contentType:"audio",renderedView:c("ZenonRenderedView").PINNED,isRemote:!0},{trackId:d("ZenonMediaStatsConfig").PINNED_VIDEO_STATS_TRACK_INFO.trackId,contentType:"video",renderedView:c("ZenonRenderedView").PINNED,isRemote:!0}].concat(j),l=null;function a(){var a;if(l!==null)return;var e=0,f=new Map(),g=new(c("ZenonHistogramCounter"))(200,1e3,200),i=(a=c("qex")._("1064222"))!=null?a:h;a=function(){var a,h,j,k,m,q,r,x,y,z,A,B,C,D,E;return b("regeneratorRuntime").async(function(F){while(1)switch(F.prev=F.next){case 0:F.prev=0;a=c("ScotchRTCCallStore").getState().callInfo.conferenceState;h=c("ScotchRTCCallStore").getState().callSummary;j=c("ScotchRTCCallStore").getState().connections.first();k=c("ScotchRTCCallStore").getState().callInfo.tsLogData;m=c("ScotchFBRTCGroupCallStore").getState(),q=m.videoDurationTrackerInfo;if(!(a==="TERMINATED"||a==="TERMINATING")){F.next=10;break}window.clearInterval(l);l=null;return F.abrupt("return");case 10:if(!j){F.next=28;break}r=d("ScotchCallModelEmitter").CallsModelEmitterInstance.getCallsModel().get("0");x=Array.from(r.mediaTracks.values());F.next=15;return b("regeneratorRuntime").awrap(d("ZenonMediaStatsReportPoller").updateStatsFromConnection(x,f,g,j,k,i,r.participants));case 15:y=h.getMediaMetricTracker(),x.forEach(function(a){var b=f.get(a.trackId);if(b!=null){w(f,y,a.trackId,a.contentType,a.remote);var d=[c("ZenonRenderedView").GRID,c("ZenonRenderedView").THUMBNAIL];for(var e=0;e<d.length;e++){var g=d[e];v(f,y,a.trackId,a.contentType,g,a.remote)}n(f,h,a.trackId,a.contentType,a.remote);p(b,h)}}),h.setAvSyncAbsHist(g.getStats()),c("promiseDone")(c("ScotchFBRTCStatsHelpers").getBatteryStats(),function(a){h.addExtraInfo(c("ScotchRTCLogger").Key.BATTERY_END,a.level),h.setDeviceCharged(a.wasCharged),u(f,a.level)}),x.forEach(function(a){a.remote===!1&&a.enabled===!0&&(a.contentType==="video"?h.setVideoDevice(a.label):a.contentType==="audio"&&h.setAudioDevice(a.label))}),s(f,y,h),t(f,y),o(f,h),z=0,(A=c("ScotchRTCCallStore").getState(),B=A.callInfo),(B==null?void 0:B.conferenceState)==="CONNECTED"&&(B.protocol==="p2p"?z=2:((C=c("ScotchRTCCallStore").getState(),D=C.remoteUsers),D!=null&&(E=D.filter(function(a){a=a.participantState;return(a==null?void 0:a.state)===c("FBRTCParticipantCallState").CONNECTED}),z=E.count()),z++)),z>e&&(e=z,h.addExtraInfo(c("ScotchRTCLogger").Key.MAX_CONCURRENT_CONNECTED_PARTICIPANTS,e)),B.protocol!=="p2p"&&(h.setVideoDurations(q.localVideoDurationTracker.getDuration(),q.remoteVideoDurationTracker.getDuration()),h.setScreenDuration(q.localScreenDurationTracker.getDuration()));case 28:F.next=33;break;case 30:F.prev=30,F.t0=F["catch"](0),c("FBLogger")("rtc_www").catching(F.t0).warn("Error polling media metrics.");case 33:case"end":return F.stop()}},null,this,[[0,30]])};l=window.setInterval(a,i);a()}function m(a){switch(a){case c("ZenonRenderedView").GRID:return"grid";case c("ZenonRenderedView").PINNED:return"pinned";case c("ZenonRenderedView").THUMBNAIL:return"thumbnail"}return"grid"}function n(a,b,c,e,f){a=a.get(c);if(a==null)return;if(f)a.codec!=null&&e==="video"&&b.setVideoReceivedCodec(a.codec);else{if(c!==d("ZenonMediaStatsConfig").OUTBOUND_AUDIO_STATS_TRACKID&&c!==d("ZenonMediaStatsConfig").OUTBOUND_VIDEO_STATS_TRACKID&&c!==d("ZenonMediaStatsConfig").OUTBOUND_SCREEN_STATS_TRACKID)return;a.codec!=null&&(e==="audio"?b.setAudioSentCodec(a.codec):b.setVideoSentCodec(a.codec));if(e==="video"&&a.codecHistory!=null){f=Object.fromEntries(a.codecHistory.map(function(a){var b=a.codec;a=a.updateTime;return[Math.round(a).toString(),b]}));b.setEhist(f)}}}function o(a,b){var c=0;a.forEach(function(a){a.cumulativeStat.framesDecoded!=null&&a.maxTotalDecodeTime!=null&&(c=Math.max(c,a.maxTotalDecodeTime))});b.setVideoMaxTotalDecodeTime(c)}function p(a,b){a=a.cumulativeStat;var c=a.totalDecodeTime,d=a.totalEncodeTime;a=a.keyFramesEncoded;if(c){var e;b.setTotalDecodeTime(((e=b.getTotalDecodeTime())!=null?e:0)+c.getDeltaFromLastUpdate())}if(d){b.setTotalEncodeTime(((e=b.getTotalEncodeTime())!=null?e:0)+d.getDeltaFromLastUpdate())}if(a){b.setKeyFramesEncoded(((c=b.getKeyFramesEncoded())!=null?c:0)+a.getDeltaFromLastUpdate())}}function q(a,b,c,d,e,f){e=x(c,e,f);if(e!=null){a=a.deltaStat[c];c=a.getCount();if(f){f=((f=b.getMetricStats(d,e))==null?void 0:f.count)||-1;c>f&&b.addMetricStat(d,e,a.getLastAddedValue())}else{f=((f=b.getVideoMetric(d,e))==null?void 0:f.count)||-1;c>f&&b.setVideoMetric(d,e,a.getLastAddedValue())}}}function r(a,b,c,d,e,f){e=x(c,e,f);if(e!=null){a=a.cumulativeStat[c];if(a==null)return;c=a.getCount();if(f){f=((f=b.getMetricStats(d,e))==null?void 0:f.count)||-1;c>f&&b.addMetricStat(d,e,a.getCurrentValue())}else{f=((f=b.getVideoMetric(d,e))==null?void 0:f.count)||-1;c>f&&b.setVideoMetric(d,e,a.getCurrentValue())}}}function s(a,b,c){for(var d=0;d<j.length;d++){var e=j[d];w(a,b,e.trackId,e.contentType,e.isRemote);n(a,c,e.trackId,e.contentType,e.isRemote)}for(var e=k,d=Array.isArray(e),c=0,e=d?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(c>=e.length)break;f=e[c++]}else{c=e.next();if(c.done)break;f=c.value}f=f;v(a,b,f.trackId,f.contentType,f.renderedView,f.isRemote)}}function t(a,b){var c=d("ZenonMediaStatsConfig").GLOBAL_STATS_TRACKID;a=a.get(c);if(a==null)return;var e=!1,f=d("ZenonMediaStatsConfig").GLOBAL_STATS_CONTENT_TYPE==="audio";r(a,b,d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL_COUNT,c,e,f);r(a,b,d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOUDNESS_LEVEL,c,e,f)}function u(a,b){a=d("ZenonMediaStatsParser").getOrCreateTrackerFromMap(a,d("ZenonMediaStatsConfig").GLOBAL_STATS_TRACK_INFO);var e=d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.GLOBAL_BATTERY_USAGE;if(a.batteryLevel!=null&&a.batteryLevel!==b){var f=a.batteryLevel-b,g=c("performanceNow")();a.batteryLastChangeTimestamp!=null&&g>a.batteryLastChangeTimestamp&&f>0&&a.batteryCharging!==!0&&(a.percentStat[e]==null&&(a.percentStat[e]=new(c("ZenonPercentMediaStat"))()),a.percentStat[e].add(f*100*6e4/(g-a.batteryLastChangeTimestamp),d("ZenonMediaStatsConfig").GLOBAL_STATS_RENDERED_VIEW,d("ZenonMediaStatsConfig").GLOBAL_STATS_CONTENT_TYPE,0));a.batteryLastChangeTimestamp=g;f<0?a.batteryCharging=!0:a.batteryCharging=!1}a.batteryLevel=b}function v(a,b,e,f,g,h){var j=a.get(e),k=m(g),l=f==="audio";j!=null&&Object.keys(j.percentStat).forEach(function(a){var m=x(a,h,l),n=null;i.includes(a)&&(n=!0);if(m!=null){a=j.percentStat[a].getAvgAndPercentile(d("ZenonMediaStatsConfig").PERCENTILES_REQUESTED,g,f,n);if(a.avg!=null&&a.percentiles!=null){n=((n=a.percentiles)==null?void 0:n.length)||0;if(l){b.addMetricStat(e,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(m,k),a.avg);for(var o=0;o<n;o++){var p;b.addMetricStat(e,c("ScotchFBRTCMediaMetricTracker").getPercentMediaKey(m,k,d("ZenonMediaStatsConfig").PERCENTILES_REQUESTED[o]),(p=a.percentiles)==null?void 0:p[o])}}else{b.setVideoMetric(e,c("ScotchFBRTCMediaMetricTracker").getAvgMediaKey(m,k),a.avg);for(var p=0;p<n;p++){b.setVideoMetric(e,c("ScotchFBRTCMediaMetricTracker").getPercentMediaKey(m,k,d("ZenonMediaStatsConfig").PERCENTILES_REQUESTED[p]),(o=a.percentiles)==null?void 0:o[p])}}}}})}function w(a,b,c,e,f){var g=e==="audio",h=a.get(c);if(h==null)return;if(!f&&c!==d("ZenonMediaStatsConfig").OUTBOUND_AUDIO_STATS_TRACKID&&c!==d("ZenonMediaStatsConfig").OUTBOUND_VIDEO_STATS_TRACKID&&c!==d("ZenonMediaStatsConfig").OUTBOUND_SCREEN_STATS_TRACKID)return;if(g&&h.deltaStat.googCurrentDelayMs!=null){var i;a=(a=h.cumulativeStat.jitterBufferDelay)==null?void 0:a.getDeltaFromLastUpdate();i=(i=h.cumulativeStat.jitterBufferEmittedCount)==null?void 0:i.getDeltaFromLastUpdate();a!=null&&i>0&&b.addJitterBufferDelay(c,a/i)}!g&&f===!1&&(b.setHistResScale(c,e,h.histResScale),b.setVideoContentType(c,e));Object.keys(h.deltaStat).forEach(function(a){q(h,b,a,c,f,g)});Object.keys(h.cumulativeStat).forEach(function(a){r(h,b,a,c,f,g)})}function x(a,b,c){switch(a){case"packetsReceived":return c?d("ScotchFBRTCMediaMetricsConst").AUDIO_PACKETS_RECEIVED:d("ScotchFBRTCMediaMetricsConst").VIDEO_PKTS_RECEIVED;case"fecPacketsReceived":return c?d("ScotchFBRTCMediaMetricsConst").AUDIO_FEC_PACKETS_RECEIVED:d("ScotchFBRTCMediaMetricsConst").VIDEO_FEC_PKTS_RECEIVED;case"fecPacketsDiscarded":return c?d("ScotchFBRTCMediaMetricsConst").AUDIO_FEC_PACKETS_DISCARDED:d("ScotchFBRTCMediaMetricsConst").VIDEO_FEC_PKTS_DISCARDED;case d("ZenonMediaStatsConfig").DERIVED_METRICS.PACKETS_LOST_CORRECTED:return b?c?d("ScotchFBRTCMediaMetricsConst").AUDIO_PACKETS_RECEIVED_LOST:d("ScotchFBRTCMediaMetricsConst").VIDEO_PKTS_RECV_LOST:c?d("ScotchFBRTCMediaMetricsConst").AUDIO_PACKETS_SENT_LOST:d("ScotchFBRTCMediaMetricsConst").VIDEO_PKTS_SEND_LOST;case"packetsSent":return c?d("ScotchFBRTCMediaMetricsConst").AUDIO_PACKETS_SENT:d("ScotchFBRTCMediaMetricsConst").VIDEO_PKTS_SENT;case"bytesSent":return c?d("ScotchFBRTCMediaMetricsConst").AUDIO_BYTES_SENT:d("ScotchFBRTCMediaMetricsConst").VIDEO_BYTES_SENT;case"bytesReceived":return c?d("ScotchFBRTCMediaMetricsConst").AUDIO_BYTES_RECEIVED:d("ScotchFBRTCMediaMetricsConst").VIDEO_BYTES_RECEIVED;case"framesDecoded":return d("ScotchFBRTCMediaMetricsConst").FRAMES_DECODED;case"framesEncoded":return d("ScotchFBRTCMediaMetricsConst").FRAMES_ENCODED;case"framesReceived":return d("ScotchFBRTCMediaMetricsConst").FRAMES_RECEIVED;case"framesSent":return d("ScotchFBRTCMediaMetricsConst").FRAMES_SENT;case"keyFramesDecoded":return d("ScotchFBRTCMediaMetricsConst").KEYFRAMES_DECODED;case"pliCount":return d("ScotchFBRTCMediaMetricsConst").PICTURE_LOSS_INDICAION_RECEIVED;case"firCount":return d("ScotchFBRTCMediaMetricsConst").FULL_INTRA_REQUEST_RECEIVED;case"googActualEncBitrate":return d("ScotchFBRTCMediaMetricsConst").ENCODE_BITRATE;case"googDecodingPLC":return d("ScotchFBRTCMediaMetricsConst").DECODING_PLC;case"googDecodingPLCCNG":return d("ScotchFBRTCMediaMetricsConst").DECODING_PLC_CNG;case"googDecodingCNG":return d("ScotchFBRTCMediaMetricsConst").DECODING_CNG;case"googDecodingNormal":return d("ScotchFBRTCMediaMetricsConst").DECODING_NORMAL;case"googDecodingCTN":return d("ScotchFBRTCMediaMetricsConst").DECODING_NETEQ_CALL;case"googRtt":return c?b?d("ScotchFBRTCMediaMetricsConst").AUDIO_RTT_RECEIVED:d("ScotchFBRTCMediaMetricsConst").AUDIO_RTT_SENT:b?d("ScotchFBRTCMediaMetricsConst").VIDEO_RTT_RECEIVED:d("ScotchFBRTCMediaMetricsConst").VIDEO_RTT_SENT;case"googJitterReceived":case"jitter":return d("ScotchFBRTCMediaMetricsConst").JITTER;case"googAccelerateRate":return d("ScotchFBRTCMediaMetricsConst").ACCELERATE_RATE;case"googExpandRate":return d("ScotchFBRTCMediaMetricsConst").EXPAND_RATE;case"googPreemptiveExpandRate":return d("ScotchFBRTCMediaMetricsConst").PREEMPTIVE_RATE;case"googSecondaryDiscardedRate":return d("ScotchFBRTCMediaMetricsConst").DISCARD_RATE;case"googSpeechExpandRate":return d("ScotchFBRTCMediaMetricsConst").SPEECH_EXPAND_RATE;case d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_DECODE_TIME:return d("ScotchFBRTCMediaMetricsConst").VIDEO_DECODE_TIME;case d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_FREEZE_COUNT:return d("ScotchFBRTCMediaMetricsConst").VIDEO_FREEZE_COUNT;case d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_FREEZE_DURATION:return d("ScotchFBRTCMediaMetricsConst").VIDEO_FREEZE_DURATION;case d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_PAUSE_COUNT:return d("ScotchFBRTCMediaMetricsConst").VIDEO_PAUSE_COUNT;case d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_PAUSE_DURATION:return d("ScotchFBRTCMediaMetricsConst").VIDEO_PAUSE_DURATION;case"width":return d("ScotchFBRTCMediaMetricsConst").VIDEO_CAPTURE_WIDTH;case"height":return d("ScotchFBRTCMediaMetricsConst").VIDEO_CAPTURE_HEIGHT;case"availableOutgoingBitrate":return d("ScotchFBRTCMediaMetricsConst").VIDEOBWE_SEND_BANDWIDTH;case"frameWidth":return b?d("ScotchFBRTCMediaMetricsConst").VIDEO_DECODED_WIDTH:d("ScotchFBRTCMediaMetricsConst").VIDEO_ENCODED_WIDTH;case"frameHeight":return b?d("ScotchFBRTCMediaMetricsConst").VIDEO_DECODED_HEIGHT:d("ScotchFBRTCMediaMetricsConst").VIDEO_ENCODED_HEIGHT;case"totalPacketSendDelay":return c?d("ScotchFBRTCMediaMetricsConst").AUDIO_TOTAL_PACKET_SEND_DELAY:d("ScotchFBRTCMediaMetricsConst").VIDEO_TOTAL_PACKET_SEND_DELAY;case"totalDecodeTime":return c?d("ScotchFBRTCMediaMetricsConst").AUDIO_TOTAL_DECODE_TIME:d("ScotchFBRTCMediaMetricsConst").VIDEO_TOTAL_DECODE_TIME;case"totalEncodeTime":return c?d("ScotchFBRTCMediaMetricsConst").AUDIO_TOTAL_ENCODE_TIME:d("ScotchFBRTCMediaMetricsConst").VIDEO_TOTAL_ENCODE_TIME;case"totalAudioEnergy":return b?d("ScotchFBRTCMediaMetricsConst").AUDIO_RECEIVE_TOTAL_ENERGY:d("ScotchFBRTCMediaMetricsConst").AUDIO_SEND_TOTAL_ENERGY;case d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL:return b?d("ScotchFBRTCMediaMetricsConst").AUDIO_RECEIVE_LOG_LEVEL:d("ScotchFBRTCMediaMetricsConst").AUDIO_SEND_LOG_LEVEL;case d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL_COUNT:return b?d("ScotchFBRTCMediaMetricsConst").AUDIO_RECEIVE_LOG_LEVEL_COUNT:d("ScotchFBRTCMediaMetricsConst").AUDIO_SEND_LOG_LEVEL_COUNT;case d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOUDNESS_LEVEL:return b?d("ScotchFBRTCMediaMetricsConst").AUDIO_RECEIVE_LOUDNESS_LEVEL:d("ScotchFBRTCMediaMetricsConst").AUDIO_SEND_LOUDNESS_LEVEL;case"jitterBufferDelay":return c?d("ScotchFBRTCMediaMetricsConst").AUDIO_JITTER_BUFFER_DELAY:d("ScotchFBRTCMediaMetricsConst").VIDEO_JITTER_BUFFER_DELAY;case"jitterBufferEmittedCount":return c?d("ScotchFBRTCMediaMetricsConst").AUDIO_JITTER_BUFFER_EMITTED_COUNT:d("ScotchFBRTCMediaMetricsConst").VIDEO_JITTER_BUFFER_EMITTED_COUNT;case d("ZenonMediaStatsConfig").DERIVED_METRICS.E2E_LATENCY:return c?d("ScotchFBRTCMediaMetricsConst").AUDIO_E2E_LATENCY:d("ScotchFBRTCMediaMetricsConst").VIDEO_E2E_LATENCY;case d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC:return d("ScotchFBRTCMediaMetricsConst").AV_SYNC;case d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC_ABS:return d("ScotchFBRTCMediaMetricsConst").AV_SYNC_ABS;case d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC_COUNT:return d("ScotchFBRTCMediaMetricsConst").AV_SYNC_COUNT;case d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC_OOB:return d("ScotchFBRTCMediaMetricsConst").AV_SYNC_OOB;case d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_IS_STALLED:return d("ScotchFBRTCMediaMetricsConst").AUDIO_DEV_IS_STALLED;case d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_REC_STALLS:return d("ScotchFBRTCMediaMetricsConst").AUDIO_DEV_REC_STALLS;case d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_TOTAL_STALLS:return d("ScotchFBRTCMediaMetricsConst").AUDIO_DEV_TOTAL_STALLS;case d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_STALL_DURATION:return d("ScotchFBRTCMediaMetricsConst").AUDIO_DEV_STALL_DURATION;case d("ZenonMediaStatsConfig").DERIVED_METRICS.SIMULCAST_LAYER_CHANGES:return d("ScotchFBRTCMediaMetricsConst").SIMULCAST_LAYER_CHANGES;case d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SUM_PIXEL:return b?d("ScotchFBRTCMediaMetricsConst").VIDEO_SUM_DECODED_PIXEL:d("ScotchFBRTCMediaMetricsConst").VIDEO_SUM_ENCODED_PIXEL;case d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SUM_CAPTURE_PIXEL:return d("ScotchFBRTCMediaMetricsConst").VIDEO_SUM_CAPTURE_PIXEL;case d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_FRAME_COUNT:return d("ScotchFBRTCMediaMetricsConst").VIDEO_CAPTURE_FRAME_COUNT;case d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CONVERTED_QP_SUM:return b?d("ScotchFBRTCMediaMetricsConst").INBOUND_QP:d("ScotchFBRTCMediaMetricsConst").OUTBOUND_QP;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.AUDIO_NETEQ_WAIT_TIME:return d("ScotchFBRTCMediaMetricsConst").AUDIO_NETEQ_WAIT_TIME;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.AUDIO_PACKET_LOSS_RATE:return d("ScotchFBRTCMediaMetricsConst").AUDIO_PACKET_LOSS_RATE;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.AUDIO_PLC_CNG_RATE:return d("ScotchFBRTCMediaMetricsConst").AUDIO_PLC_CNG_RATE;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.AUDIO_PLC_RATE:return d("ScotchFBRTCMediaMetricsConst").AUDIO_PLC_RATE;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.GLOBAL_AUDIO_BITRATE:return d("ScotchFBRTCMediaMetricsConst").GLOBAL_AUDIO_BITRATE;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.GLOBAL_BATTERY_USAGE:return d("ScotchFBRTCMediaMetricsConst").GLOBAL_BATTERY_USAGE;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.GLOBAL_CPU_USAGE:return d("ScotchFBRTCMediaMetricsConst").GLOBAL_CPU_USAGE;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.GLOBAL_VIDEO_BITRATE:return d("ScotchFBRTCMediaMetricsConst").GLOBAL_VIDEO_BITRATE;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_AV_SYNC_ABS:return d("ScotchFBRTCMediaMetricsConst").VIDEO_AV_SYNC_ABS;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_AV_SYNC_OOB:return d("ScotchFBRTCMediaMetricsConst").VIDEO_AV_SYNC_OOB;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_FRAME_RATE:return d("ScotchFBRTCMediaMetricsConst").VIDEO_FRAME_RATE;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_FREEZE_COUNT_PER_MIN:return d("ScotchFBRTCMediaMetricsConst").VIDEO_FREEZE_COUNT_PER_MIN;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_FREEZE_DURATION_PER_MIN:return d("ScotchFBRTCMediaMetricsConst").VIDEO_FREEZE_DURATION_PER_MIN;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_NETEQ_WAIT_TIME:return d("ScotchFBRTCMediaMetricsConst").VIDEO_NETEQ_WAIT_TIME;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_PACKET_LOSS_RATE:return d("ScotchFBRTCMediaMetricsConst").VIDEO_PACKET_LOSS_RATE;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_RENDER_SCALE_RATIO:return d("ScotchFBRTCMediaMetricsConst").VIDEO_RENDER_SCALE_RATIO;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_CROPPING_RATIO:return d("ScotchFBRTCMediaMetricsConst").VIDEO_CROPPING_RATIO;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.ROUND_TRIP_TIME:return c?d("ScotchFBRTCMediaMetricsConst").AUDIO_RTT_SENT:d("ScotchFBRTCMediaMetricsConst").VIDEO_RTT_SENT;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_QUALITY:return d("ScotchFBRTCMediaMetricsConst").VIDEO_QUALITY_SENT;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_ENCODED_FRAME_RATE:return d("ScotchFBRTCMediaMetricsConst").VIDEO_ENCODED_FRAME_RATE;case d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_QP:return d("ScotchFBRTCMediaMetricsConst").VIDEO_QP_SENT}}g.DEFAULT_POLL_RATE_MS=h;g.startCollectingMediaStats=a;g.addZenonSpecialTrackStatsToScotch=s;g.addZenonAggregatedRxLoudnessToScotch=t;g.updateBatteryStats=u;g.addZenonPercentStatsToScotch=v;g.addZenonFilteredStatsToScotch=w;g.getMediaMetricConst=x}),98);
__d("ScotchCallModelEmitter",["invariant","EventEmitter","FBLogger","FBRTCParticipantCallState","ScotchFBRTCGroupCallStore","ScotchFBRTCScreenSharingUtils","ScotchRTCAppDispatcher","ScotchRTCCallStore","ScotchRTCCallType","ScotchRTCGroupCallEscalationStore","ScotchRTCP2PCallEscalationStore","ScotchRTCP2PCallStore","UserAgent","ZenonCall","ZenonCallFeatures","ZenonCallParticipant","ZenonCallsModelTypes","ZenonImmutableMediaTrack","ZenonRTCConfig","ZenonRTWebBrowserFeatureSupport","ZenonScreenSharingAvailabilityType","ZenonUserCapabilities","cr:1420073","immutable"],(function(a,b,c,d,e,f,g,h){"use strict";var i=[c("ScotchFBRTCGroupCallStore"),c("ScotchRTCCallStore"),c("ScotchRTCP2PCallStore"),c("ScotchRTCP2PCallEscalationStore"),c("ScotchRTCGroupCallEscalationStore")];b("cr:1420073")&&i.push(b("cr:1420073"));var j=["IgnoreCall","HangupCall","InAnotherCall","CallEndAcceptAfterHangUp","NoAnswerTimeout","IncomingTimeout","OtherInstanceHandled","SignalingMessageFailed","ConnectionDropped","ClientInterrupted","WebRTCError","ClientError","NoPermission","OtherNotCapable","NoUIShown","VersionUnsupported","CallerNotVisible","CarrierBlocked","OtherCarrierBlocked","ClientEncryptionError","InactiveTimeout"];a=function(a){babelHelpers.inheritsLoose(e,a);function e(){var b;b=a.call(this)||this;b.$ScotchCallModelEmitter1=c("ScotchRTCAppDispatcher").explicitlyRegisterStores(i);return b}var f=e.prototype;f.getDispatchTokens=function(){return this.$ScotchCallModelEmitter1};f.$ScotchCallModelEmitter3=function(){return c("ScotchRTCCallStore").getState().callInfo.collisionContext};f.$ScotchCallModelEmitter4=function(){var a=c("ScotchRTCCallStore").getState().callInfo.conferenceState;switch(a){case"CONNECTED":case"RENEGOTIATING":return d("ZenonCallsModelTypes").ZenonCallState.Connected;case"CONNECTING":var b=c("ScotchRTCCallStore").getState().remoteUsers.find(function(a){return a.hasStream()});return b?d("ZenonCallsModelTypes").ZenonCallState.Connected:d("ZenonCallsModelTypes").ZenonCallState.Connecting;case"TERMINATING":return d("ZenonCallsModelTypes").ZenonCallState.Terminating;case"TERMINATED":return d("ZenonCallsModelTypes").ZenonCallState.Terminated;case"PENDING_APPROVAL":return d("ZenonCallsModelTypes").ZenonCallState.PendingApproval;case"NEW":case"AWAITING_USER_START":return d("ZenonCallsModelTypes").ZenonCallState.New;default:h(0,14242,a)}};f.$ScotchCallModelEmitter5=function(a){a=this.$ScotchCallModelEmitter4();if(a!==d("ZenonCallsModelTypes").ZenonCallState.Terminating&&a!==d("ZenonCallsModelTypes").ZenonCallState.Terminated)return null;a=c("ScotchRTCCallStore").getState().callInfo.protocol==="multiway";a=a?c("ScotchFBRTCGroupCallStore").getState().endCallReason:c("ScotchRTCP2PCallStore").getState().endCallReason;return a!==null&&a!==void 0?(a=j[a.getReasonID()])!=null?a:"Unknown":null};f.$ScotchCallModelEmitter6=function(){return c("ScotchRTCCallStore").getState().callInfo.responseSubCode};f.$ScotchCallModelEmitter7=function(a){a=c("ScotchRTCCallStore").getState().callInfo.protocol==="multiway";var b;if(a)b=!0;else{var e=c("ScotchRTCP2PCallStore").getState(),f=e.offerEscalationSupport;e=e.escalationConferenceName;b=f&&e!=null}f=c("ScotchFBRTCGroupCallStore").getState().dominantSpeakerFBID;if(a)d("ZenonRTWebBrowserFeatureSupport").isReplaceTrackSupported()?e=c("ZenonScreenSharingAvailabilityType").Available:e=c("ZenonScreenSharingAvailabilityType").GroupCallUnsupported;else{var g=c("ScotchRTCP2PCallStore").getState(),h=g.callType;g=g.signalingExperiments;h===c("ScotchRTCCallType").AUDIO_ONLY?e=c("ZenonScreenSharingAvailabilityType").AudioCallUnsupported:!d("ScotchFBRTCScreenSharingUtils").canPeerReceiveScreenSharing(g)?e=c("ZenonScreenSharingAvailabilityType").RemoteUnsupported:e=c("ZenonScreenSharingAvailabilityType").Available}h=c("ScotchRTCP2PCallStore").getState();g=h.isPeerOnMobile;h=h.signalingExperiments;g=g&&c("UserAgent").isBrowser("Firefox");g=!g;a=!a&&(h.support(c("ZenonUserCapabilities").MultipleStreamsPlanB)||h.support(c("ZenonUserCapabilities").MultipleStreamsUnified));return new(c("ZenonCallFeatures"))({canAddParticipants:b,canReplaceLocalStreams:g,dominantSpeaker:f,screenSharingAvailability:e,supportMultipleStreams:a})};f.$ScotchCallModelEmitter8=function(a,b,d){for(var e=a.streams.toArray(),f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{g=e.next();if(g.done)break;h=g.value}h=h;for(var i=h.getTracks(),j=Array.isArray(i),k=0,i=j?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var l;if(j){if(k>=i.length)break;l=i[k++]}else{k=i.next();if(k.done)break;l=k.value}l=l;b.set(l.id,new(c("ZenonImmutableMediaTrack"))({trackId:l.id,label:l.label,webrtcStream:h,webrtcTrack:l,enabled:l.enabled,userMuted:Boolean(a.audioStreamMuteStates.get(l.id)),remote:d,contentType:l.kind==="video"?"video":"audio",contentHint:(l=l.contentHint)!=null?l:"",pausedDownlink:a.pausedDownlink}))}}for(var l=a.screenStreams.toArray(),k=Array.isArray(l),j=0,l=k?l:l[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(k){if(j>=l.length)break;i=l[j++]}else{j=l.next();if(j.done)break;i=j.value}h=i;for(var g=h.getTracks(),f=Array.isArray(g),e=0,g=f?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(f){if(e>=g.length)break;i=g[e++]}else{e=g.next();if(e.done)break;i=e.value}i=i;b.set(i.id,new(c("ZenonImmutableMediaTrack"))({trackId:i.id,label:i.label,webrtcStream:h,webrtcTrack:i,enabled:i.enabled,userMuted:Boolean(a.audioStreamMuteStates.get(i.id)),remote:d,contentType:i.kind==="video"?"screen":"audio",contentHint:(i=i.contentHint)!=null?i:"",pausedDownlink:a.pausedDownlink}))}}};f.$ScotchCallModelEmitter9=function(a){a=new Map();this.$ScotchCallModelEmitter8(c("ScotchRTCCallStore").getState().localUser,a,!1);for(var b=c("ScotchRTCCallStore").getState().remoteUsers.toArray(),d=Array.isArray(b),e=0,b=d?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;this.$ScotchCallModelEmitter8(f,a,!0)}return c("immutable").Map(a)};f.$ScotchCallModelEmitter10=function(a){a=new Map();var b=this.$ScotchCallModelEmitter11(c("ScotchRTCCallStore").getState().localUser,!0);a.set(b.id,b);b=c("ScotchRTCCallStore").getState().remoteUsers.toArray();for(var b=b,d=Array.isArray(b),e=0,b=d?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;f=this.$ScotchCallModelEmitter11(f,!1);a.set(f.id,f)}f=this.$ScotchCallModelEmitter12();return c("immutable").Map(a).merge(c("immutable").Map(f))};f.$ScotchCallModelEmitter11=function(a,b){var e=a.isMessengerUser?d("ZenonCallsModelTypes").ZenonCallParticipantType.Messenger:a.isGuestUser?d("ZenonCallsModelTypes").ZenonCallParticipantType.Guest:d("ZenonRTCConfig").getIsVCEndpointCall()?d("ZenonCallsModelTypes").ZenonCallParticipantType.Workplace:d("ZenonCallsModelTypes").ZenonCallParticipantType.Facebook;b?b=this.$ScotchCallModelEmitter13():(b=this.$ScotchCallModelEmitter14(a.participantState),a.getStream()!=null&&(b=d("ZenonCallsModelTypes").ZenonCallParticipantState.Connected));var f=new Set();for(var g=a.streams.toArray(),h=Array.isArray(g),i=0,g=h?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j;if(h){if(i>=g.length)break;j=g[i++]}else{i=g.next();if(i.done)break;j=i.value}j=j;for(var j=j.getTracks(),k=Array.isArray(j),l=0,j=k?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var m;if(k){if(l>=j.length)break;m=j[l++]}else{l=j.next();if(l.done)break;m=l.value}m=m;f.add(m.id)}}for(var m=a.screenStreams.toArray(),l=Array.isArray(m),k=0,m=l?m:m[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(l){if(k>=m.length)break;j=m[k++]}else{k=m.next();if(k.done)break;j=k.value}i=j;for(var h=i.getTracks(),g=Array.isArray(h),j=0,h=g?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(g){if(j>=h.length)break;i=h[j++]}else{j=h.next();if(j.done)break;i=j.value}i=i;f.add(i.id)}}i=new(c("ZenonCallParticipant"))({id:a.FBID,isVideoSubscribed:a.isVideoSubscribed,participantType:e,state:b,trackIDs:c("immutable").Set(f)});return i};f.$ScotchCallModelEmitter13=function(){var a=this.$ScotchCallModelEmitter4();if(a===d("ZenonCallsModelTypes").ZenonCallState.Terminating||a===d("ZenonCallsModelTypes").ZenonCallState.Terminated)return d("ZenonCallsModelTypes").ZenonCallParticipantState.Disconnected;else return d("ZenonCallsModelTypes").ZenonCallParticipantState.Connected};f.$ScotchCallModelEmitter14=function(a){if(c("ScotchRTCCallStore").getState().callInfo.protocol==="multiway"&&!c("ScotchRTCGroupCallEscalationStore").isInProgress())return this.$ScotchCallModelEmitter15(a);else return this.$ScotchCallModelEmitter16()};f.$ScotchCallModelEmitter15=function(a){if(!a)return d("ZenonCallsModelTypes").ZenonCallParticipantState.Disconnected;a=a.state;switch(a){case c("FBRTCParticipantCallState").DISCONNECTED:case c("FBRTCParticipantCallState").NO_ANSWER:case c("FBRTCParticipantCallState").REJECTED:case c("FBRTCParticipantCallState").UNREACHABLE:case c("FBRTCParticipantCallState").CONNECTION_DROPPED:case c("FBRTCParticipantCallState").PARTICIPANT_LIMIT_REACHED:case c("FBRTCParticipantCallState").IN_ANOTHER_CALL:case c("FBRTCParticipantCallState").RING_TYPE_UNSUPPORTED:case c("FBRTCParticipantCallState").HANGUP_IN_WAITING_ROOM:case c("FBRTCParticipantCallState").UNKNOWN:return d("ZenonCallsModelTypes").ZenonCallParticipantState.Disconnected;case c("FBRTCParticipantCallState").CONTACTING:return d("ZenonCallsModelTypes").ZenonCallParticipantState.Contacting;case c("FBRTCParticipantCallState").RINGING:return d("ZenonCallsModelTypes").ZenonCallParticipantState.Ringing;case c("FBRTCParticipantCallState").CONNECTING:return d("ZenonCallsModelTypes").ZenonCallParticipantState.Connecting;case c("FBRTCParticipantCallState").CONNECTED:return d("ZenonCallsModelTypes").ZenonCallParticipantState.Connected;case c("FBRTCParticipantCallState").PENDING_APPROVAL:return d("ZenonCallsModelTypes").ZenonCallParticipantState.PendingApproval;case c("FBRTCParticipantCallState").APPROVED:return d("ZenonCallsModelTypes").ZenonCallParticipantState.Approved;case c("FBRTCParticipantCallState").FAILED_APPROVAL:return d("ZenonCallsModelTypes").ZenonCallParticipantState.FailedApproval;default:h(0,14312,a)}};f.$ScotchCallModelEmitter16=function(){var a=c("ScotchRTCP2PCallStore").getState();a=a.connectionStatus;switch(a){case"CONNECTED":return d("ZenonCallsModelTypes").ZenonCallParticipantState.Connected;case"ESCALATING_TO_BJN":case"CONNECTING":return d("ZenonCallsModelTypes").ZenonCallParticipantState.Connecting;case"CONTACTING":return d("ZenonCallsModelTypes").ZenonCallParticipantState.Contacting;case"RECONNECTING":return d("ZenonCallsModelTypes").ZenonCallParticipantState.Reconnecting;case"RINGING":return d("ZenonCallsModelTypes").ZenonCallParticipantState.Ringing;case"PROVISIONAL_RINGING":return d("ZenonCallsModelTypes").ZenonCallParticipantState.ProvisionalRinging;case"INIT":case"DISCONNECTED":default:return d("ZenonCallsModelTypes").ZenonCallParticipantState.Disconnected}};f.$ScotchCallModelEmitter17=function(){var a=c("ScotchRTCCallStore").getState().callInfo.protocol==="multiway";if(a)return null;a=c("ScotchRTCP2PCallEscalationStore").getState();var b=a.awaitingACK,e=a.inProgress,f=a.failureReason,g=a.initiatedEscalation;a=a.escalated;if(a)return null;if(f&&!e)switch(f){case"cancelled":return d("ZenonCallsModelTypes").ZenonVideoEscalationStatus.Cancelled;case"denied":return d("ZenonCallsModelTypes").ZenonVideoEscalationStatus.Declined;case"timeout":return d("ZenonCallsModelTypes").ZenonVideoEscalationStatus.TimedOut}if(e&&g)return d("ZenonCallsModelTypes").ZenonVideoEscalationStatus.PendingPeerFeedback;if(e&&!g&&!b)return d("ZenonCallsModelTypes").ZenonVideoEscalationStatus.InitiatedFromPeer;return b?d("ZenonCallsModelTypes").ZenonVideoEscalationStatus.Accepted:null};f.$ScotchCallModelEmitter12=function(){var a=new Map(),b=c("ScotchRTCGroupCallEscalationStore").getState().usersToRing;b!==null&&c("ScotchRTCGroupCallEscalationStore").isInProgress()&&b.forEach(function(b){if(b.fbid!=null){b=new(c("ZenonCallParticipant"))({id:b.fbid,participantType:d("ZenonCallsModelTypes").ZenonCallParticipantType.Facebook,state:d("ZenonCallsModelTypes").ZenonCallParticipantState.Precontacting,trackIDs:c("immutable").Set()});a.set(b.id,b)}});return a};f.$ScotchCallModelEmitter18=function(){if(c("ScotchRTCGroupCallEscalationStore").isInProgress())return d("ZenonCallsModelTypes").ZenonGroupEscalationStatus.Started;if(c("ScotchRTCGroupCallEscalationStore").isEscalated())return d("ZenonCallsModelTypes").ZenonGroupEscalationStatus.Completed;return c("ScotchRTCGroupCallEscalationStore").getState().aborted?d("ZenonCallsModelTypes").ZenonGroupEscalationStatus.Cancelled:null};f.$ScotchCallModelEmitter19=function(){return b("cr:1420073")?b("cr:1420073").getState().inputStates:c("immutable").Map()};f.$ScotchCallModelEmitter20=function(){return b("cr:1420073")?b("cr:1420073").getState().outputStates:c("immutable").Map()};f.$ScotchCallModelEmitter21=function(a){return new(c("ZenonCall"))({callState:this.$ScotchCallModelEmitter4(),collisionContext:this.$ScotchCallModelEmitter3(),clientCallId:a,endCallReason:this.$ScotchCallModelEmitter5(a),responseSubCode:this.$ScotchCallModelEmitter6(),features:this.$ScotchCallModelEmitter7(a),groupEscalationStatus:this.$ScotchCallModelEmitter18(),mediaTracks:this.$ScotchCallModelEmitter9(a),participants:this.$ScotchCallModelEmitter10(a),remoteScreenSharingUserIDs:c("ScotchRTCCallStore").getState().remoteScreenSharingUserIDs,videoEscalationStatus:this.$ScotchCallModelEmitter17(),stateSyncInputStates:this.$ScotchCallModelEmitter19(),stateSyncOutputStates:this.$ScotchCallModelEmitter20(),rtpSenders_I_KNOW_WHAT_I_AM_DOING:this.$ScotchCallModelEmitter22(),rtpReceivers_I_KNOW_WHAT_I_AM_DOING:this.$ScotchCallModelEmitter23()})};f.$ScotchCallModelEmitter22=function(){return c("ScotchRTCCallStore").getState().connections.map(function(a){try{return c("immutable").Set(a.getSenders())}catch(a){c("FBLogger")("rtc_www").catching(a).mustfix("error while trying to getSenders()");return[]}}).flatten().toSet()};f.$ScotchCallModelEmitter23=function(){return c("ScotchRTCCallStore").getState().connections.map(function(a){try{return c("immutable").Set(a.getReceivers())}catch(a){c("FBLogger")("rtc_www").catching(a).mustfix("error while trying to getReceivers()");return[]}}).flatten().toSet()};f.getCallsModel=function(){var a=c("immutable").Map({0:this.$ScotchCallModelEmitter21("0")});return a};f.emitCallsModel=function(){var a=this.getCallsModel();try{var b=JSON.stringify(a);b!==this.$ScotchCallModelEmitter2&&(this.$ScotchCallModelEmitter2=b,this.emit("callsModelUpdate",a))}catch(b){c("FBLogger")("rtc_www").catching(b).mustfix("error while diffing callsModel"),this.$ScotchCallModelEmitter2=null,this.emit("callsModelUpdate",a)}};return e}(c("EventEmitter"));e=new a();g.ScotchCallModelEmitterStores=i;g.CallsModelEmitterInstance=e}),98);
__d("MessengerParticipants.re",["MessengerParticipants.bs","bs_curry"],(function(a,b,c,d,e,f){a=function(a,c){a=b("bs_curry")._2(b("MessengerParticipants.bs").get,a,c);return a};f.get=a;c=b("MessengerParticipants.bs").getNow;f.getNow=c;d=function(a,c){a=b("bs_curry")._2(b("MessengerParticipants.bs").getMulti,a,c);return a};f.getMulti=d;e=function(a,c){a=b("bs_curry")._2(b("MessengerParticipants.bs").getMultiEager,a,c);return a};f.getMultiEager=e;a=function(a,c){a=b("bs_curry")._2(b("MessengerParticipants.bs").getMultiEagerMap,a,c);return a};f.getMultiEagerMap=a;c=b("MessengerParticipants.bs").removeCallback;f.removeCallback=c}),null);
__d("PlatformType",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["Scotch","Zenon"]);c=a;f["default"]=c}),66);
__d("RTWebFluxDebugger",["FluxDebugUtils","WebStorage"],(function(a,b,c,d,e,f,g){"use strict";var h=c("WebStorage").getLocalStorage(),i=!!(h&&h.getItem("__fluxDebug")==="1"),j=new Map(),k;function a(a,b){Object.keys(b).forEach(function(a){j.set(a,b[a])}),k&&s(),k={dispatcher:a,originalDispatch:a.dispatch,patchedDispatch:null},i&&r()}function l(a){return a&&typeof a.toJS==="function"?a.toJS():a}function b(){var a={};for(var b=j.entries(),c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;var f=e[0];e=e[1];a[f]=l(e.getState())}return a}function m(a,b,c){var d=Date.now(),e=Array.from(j.entries()).map(function(a){var b=a[0];a=a[1];return{name:b,stateBefore:a.getState(),stateAfter:null}});b.call(a,c);if(!i)return;b=Date.now()-d;e=e.map(function(a,b){b=j.get(a.name);return b!=null?babelHelpers["extends"]({},a,{stateAfter:b.getState()}):null}).filter(Boolean);a=c.type;d=babelHelpers.objectWithoutPropertiesLoose(c,["type"]);console.groupCollapsed("Flux:",a);try{n(e)}finally{console.groupEnd()}}function n(a){a.filter(function(a){return a.stateBefore!==a.stateAfter}).forEach(function(a){p(a.name,function(){var b=l(a.stateBefore),c=l(a.stateAfter);b&&c&&d("FluxDebugUtils").diff(b,c).forEach(o)})})}function o(a){var b=a.path.join(".");switch(a.op){case"add":break;case"update":break;case"delete":break}}function p(a,b){q(a,function(){console.group(a),b()})}function q(a,b){try{b()}finally{console.groupEnd()}}function r(){if(!k)return;k.patchedDispatch&&s();k.patchedDispatch=k.dispatcher.dispatch=m.bind(null,k.dispatcher,k.dispatcher.dispatch)}function s(){if(!k||!k.patchedDispatch)return;k.dispatcher.dispatch=k.originalDispatch;k.patchedDispatch=null}window.__fluxDebugOn=function(){i=!0,h&&h.setItem("__fluxDebug","1"),r()};window.__fluxDebugOff=function(){i=!1,h&&h.setItem("__fluxDebug","0"),s()};window.__fluxDump=function(){var a=function(){if(c){if(d>=b.length)return"break";e=b[d++]}else{d=b.next();if(d.done)return"break";e=d.value}var a=e,f=a[0];a=a[1];p(f,function(){return!1})};for(var b=j,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e,f=a();if(f==="break")break}};window.__fluxDumpState=b;g.attach=a;g.fluxDumpState=b}),98);
__d("ScotchRTCCallNUXReducer",["ScotchFBRTCUtils","XBasicFBNuxDismissController","XBasicFBNuxViewController"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(b.type){case"DISMISS_NUX":var e=c("XBasicFBNuxDismissController").getURIBuilder().setInt("nux_id",b.nuxID).getURI();d("ScotchFBRTCUtils").sendServerRequest(e);switch(b.nuxID){case 6265:return a.set("showVideoChatFiltersNUX",!1);case 5609:return a.set("showAddGroupMemberNUX",!1);case 4775:return a.set("showRemoteCameraControlsNUX",!1);case 4774:return a.set("showRemoteScreenContentPopOutNUX",!1);case 4773:return a.set("showRemoteStreamsSliderNUX",!1);case 4776:return a.set("showSettingsNUX",!1);default:return a}default:return a}}function b(a,b){switch(b.type){case"INIT_NUX_STATE":b=b.payload;return a.set("showVideoChatFiltersNUX",b.showVideoChatFiltersNUX).set("showAddGroupMemberNUX",b.showAddGroupMemberNUX).set("showRemoteCameraControlsNUX",b.showRemoteCameraControlsNUX).set("showRemoteScreenContentPopOutNUX",b.showRemoteScreenContentPopOutNUX).set("showRemoteStreamsSliderNUX",b.showRemoteStreamsSliderNUX).set("showSettingsNUX",b.showSettingsNUX);default:return a}}function e(a,b){switch(b.type){case"MARK_NUX_VIEWED":b=c("XBasicFBNuxViewController").getURIBuilder().setInt("nux_id",b.nuxID).getURI();d("ScotchFBRTCUtils").sendServerRequest(b);return a;default:return a}}g.dismissNUX=a;g.refreshNUXState=b;g.markNUXViewed=e}),98);
__d("ScotchRTCCallNUXStoreState",["immutable"],(function(a,b,c,d,e,f,g){"use strict";a={showVideoChatFiltersNUX:!1,showAddGroupMemberNUX:!1,showRemoteCameraControlsNUX:!1,showRemoteScreenContentPopOutNUX:!1,showRemoteStreamsSliderNUX:!1,showSettingsNUX:!1};b=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("immutable").Record(a));g["default"]=b}),98);
__d("ScotchRTCCallNUXStore",["FluxReduceStore","ScotchRTCAppDispatcher","ScotchRTCCallNUXActions","ScotchRTCCallNUXReducer","ScotchRTCCallNUXStoreState"],(function(a,b,c,d,e,f,g){"use strict";var h=[d("ScotchRTCCallNUXReducer").dismissNUX,d("ScotchRTCCallNUXReducer").markNUXViewed,d("ScotchRTCCallNUXReducer").refreshNUXState];a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b;b=a.call(this,c("ScotchRTCAppDispatcher"))||this;b.reduce=function(a,b){return h.reduce(function(a,c){return c(a,b)},a)};d("ScotchRTCCallNUXActions").refreshNUXState();return b}var e=b.prototype;e.getInitialState=function(){return new(c("ScotchRTCCallNUXStoreState"))()};return b}(c("FluxReduceStore"));a.__moduleID=f.id;b=new a();g["default"]=b}),98);
__d("RTCCoExperienceActionTypes",[],(function(a,b,c,d,e,f){a=Object.freeze({TOGGLE_CHAT_WINDOW:"TOGGLE_CHAT_WINDOW",SET_FILTER:"SET_FILTER"});f["default"]=a}),66);
__d("ScotchRTCExpressionWWWLogger",["invariant","FBRTCParticipantCallState","ZenonDebugLogger","immutable","performanceNow"],(function(a,b,c,d,e,f,g,h){"use strict";a=function(){function a(){this.$1=c("immutable").Map()}var b=a.prototype;b.logStartTimer=function(a){var b=c("performanceNow")(),d=a.rtcExpressionIntent;this.$1=this.$1.set(d,b);a.rtcExpressionAction="enabled";this.logEvent(a);this.$2(d,{startTime:b})};b.$3=function(a){var b=this.$1.get(a);b||h(0,2586);this.$1=this.$1.remove(a);return parseInt(c("performanceNow")()-b,10)};b.logStopTimer=function(a){var b=a.rtcExpressionIntent;b=this.$3(b);a.rtcExpressionDuration=b;a.rtcExpressionAction="disabled";this.logEvent(a);return b};b.logEvent=function(a){};b.getExpressionLoggerInfoFromStore=function(a){var b=a.callInfo,d=b.callID;b=b.conferenceName;a=a.remoteUsers;a=a.filter(function(a){return a.getParticipantState()===c("FBRTCParticipantCallState").CONNECTED}).size+1;return{callID:d,conferenceName:b,rtcExpressionParticipantCount:a}};b.$2=function(a,b){};return a}();b=new a();g["default"]=b}),98);
__d("ScotchRTCCoExperienceReducer",["ScotchRTCCallStore","ScotchRTCCoExperienceStore","ScotchRTCExpressionWWWLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(b.type){case"TOGGLE_CHAT_WINDOW":b=c("ScotchRTCExpressionWWWLogger").getExpressionLoggerInfoFromStore(c("ScotchRTCCallStore").getState());a.chatWindowVisible?c("ScotchRTCExpressionWWWLogger").logStopTimer(babelHelpers["extends"]({},b,{rtcExpressionName:"chat",rtcExpressionIntent:"chat"})):c("ScotchRTCExpressionWWWLogger").logStartTimer(babelHelpers["extends"]({},b,{rtcExpressionName:"chat",rtcExpressionIntent:"chat"}));return a.set("chatWindowVisible",!a.chatWindowVisible);default:return a}}function b(a,b){switch(b.type){case"HANGUP":case"END_CALL":case"HANGUP_ERROR":case"HANGUP_SUCCESS":case"SET_FILTER":var d=c("ScotchRTCExpressionWWWLogger").getExpressionLoggerInfoFromStore(c("ScotchRTCCallStore").getState()),e=a.currentVideoFilter,f=a.videoFilterHistory;if(e){var g=c("ScotchRTCExpressionWWWLogger").logStopTimer(babelHelpers["extends"]({},d,{rtcExpressionName:e,rtcExpressionIntent:"effect"})),h=f.get(e)||0;f=f.set(e,h+g);c("ScotchRTCCoExperienceStore").logCoExperienceDurationToSummary(f)}b.filter&&c("ScotchRTCExpressionWWWLogger").logStartTimer(babelHelpers["extends"]({},d,{rtcExpressionName:b.filter,rtcExpressionIntent:"effect"}));return a.set("currentVideoFilter",b.filter).set("videoFilterHistory",f);default:return a}}g.processChatWindowToggle=a;g.processSetVideoFilter=b}),98);
__d("ScotchRTCCoExperienceStoreState",["immutable"],(function(a,b,c,d,e,f,g){"use strict";a={chatWindowVisible:!1,currentVideoFilter:null,videoFilterHistory:c("immutable").Map()};b=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("immutable").Record(a));g["default"]=b}),98);
__d("ScotchRTCCoExperienceStore",["FluxReduceStore","ScotchFBRTCCallSummaryStore","ScotchRTCAppDispatcher","ScotchRTCCallStore","ScotchRTCCoExperienceReducer","ScotchRTCCoExperienceStoreState"],(function(a,b,c,d,e,f,g){"use strict";var h=[d("ScotchRTCCoExperienceReducer").processChatWindowToggle,d("ScotchRTCCoExperienceReducer").processSetVideoFilter];a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.reduce=function(a,b){return h.reduce(function(a,c){return c(a,b)},a)},b)||babelHelpers.assertThisInitialized(c)}var d=b.prototype;d.getInitialState=function(){return new(c("ScotchRTCCoExperienceStoreState"))()};d.logCoExperienceDurationToSummary=function(a){var b=c("ScotchRTCCallStore").getState();b=b.callSummary;b.setEffectCount(a.size);var d=0;a.reduce(function(a,b){d+=b},0);b.setTotalVideoFilterDuration(d);b.setCoExperienceEffectDuration(d);b.save(c("ScotchFBRTCCallSummaryStore").getInstance())};return b}(c("FluxReduceStore"));a.__moduleID=f.id;b=new a(c("ScotchRTCAppDispatcher"));g["default"]=b}),98);
__d("ScotchRTCMediaDevicesActions",["ScotchRTCAppDispatcher"],(function(a,b,c,d,e,f,g){"use strict";function a(a){c("ScotchRTCAppDispatcher").dispatch({type:"ENUMERATE_MEDIA_DEVICES",devices:a})}g.enumerate=a}),98);
__d("ScotchRTCMediaDevicesStore",["FluxReduceStore","ScotchRTCAppDispatcher","ScotchRTCMediaDevices","ScotchRTCMediaDevicesActions","ScotchRTWebUserActionLogger","ZenonDebugLogger"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b;b=a.call(this,c("ScotchRTCAppDispatcher"))||this;b.$ScotchRTCMediaDevicesStore1=function(){d("ScotchRTCMediaDevices").enumerateDevices().then(function(a){c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"enumerateDevices: "+JSON.stringify(a)}),d("ScotchRTCMediaDevicesActions").enumerate(a)})["catch"](function(a){})};b.reduce=function(a,b){var c=b.type;b=b.devices;switch(c){case"ENUMERATE_MEDIA_DEVICES":return[].concat(b);default:return a}};b.$ScotchRTCMediaDevicesStore1();d("ScotchRTCMediaDevices").addEventListener("devicechange",b.$ScotchRTCMediaDevicesStore1);return b}var e=b.prototype;e.getInitialState=function(){return null};e.refresh=function(){this.$ScotchRTCMediaDevicesStore1()};e.getByLabel=function(a,b){var c=this.getState();return!c?null:c.find(function(c){return c.kind===b&&c.label===a})||c.find(function(c){return c.kind===b&&i(c.label,a)})};return b}(c("FluxReduceStore"));a.__moduleID=f.id;var h=/#\d+\s(\([\da-f]{4}:[\da-f]{4}\))$|\s#\d+$/;function i(a,b){return a.replace(h,"$1")===b.replace(h,"$1")}b=new a();g["default"]=b}),98);
__d("ScotchRTCP2PLoggerStore",["Bootloader","FluxReduceStore","ScotchRTCAppDispatcher","ScotchRTCCallStore","ScotchRTCLogger","ZenonRTCConfig"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=d=a.call.apply(a,[this].concat(f))||this,d.reduce=function(a,b){var e=c("ScotchRTCCallStore").getState(),f=e.remoteUsers;e=e.callInfo;if(!f.count())return a;var g=c("ScotchRTCLogger").getInstance();f=f.first().FBID;switch(b.type){case"AUDIO_MUTED":g.logCallAction(f,e.conferenceName,c("ScotchRTCLogger").CallAction.SET_MUTE,!0);break;case"AUDIO_UNMUTED":g.logCallAction(f,e.conferenceName,c("ScotchRTCLogger").CallAction.SET_MUTE,!1);break;case"VIDEO_MUTED":g.logCallAction(f,e.conferenceName,c("ScotchRTCLogger").CallAction.SET_VIDEO_ON,!1);break;case"VIDEO_UNMUTED":g.logCallAction(f,e.conferenceName,c("ScotchRTCLogger").CallAction.SET_VIDEO_ON,!0);break;case"SELF_VIEW_COLLAPSED":g.logCallAction(f,e.conferenceName,c("ScotchRTCLogger").CallAction.SET_SELF_VIEW_ON,!1);break;case"SELF_VIEW_UNCOLLAPSED":g.logCallAction(f,e.conferenceName,c("ScotchRTCLogger").CallAction.SET_SELF_VIEW_ON,!0);break;case"ADD_LOCAL_STREAM":d.$ScotchRTCP2PLoggerStore1("local stream: set",b.stream,f,Number(e.conferenceName));break;case"USER_SETTINGS_SAVE":case"USER_SETTINGS_SET_AUDIO_INPUT":case"USER_SETTINGS_SET_AUDIO_OUTPUT":case"USER_SETTINGS_SET_VIDEO_INPUT":g.logCallAction(f,e.conferenceName,c("ScotchRTCLogger").CallAction.USER_SETTINGS_CHANGED),d.$ScotchRTCP2PLoggerStore1("user settings change",b,f,Number(e.conferenceName))}return a},b)||babelHelpers.assertThisInitialized(d)}var d=b.prototype;d.getInitialState=function(){return{}};d.$ScotchRTCP2PLoggerStore1=function(a,b,c,d){h(function(e){return e.log(a,{peerID:c,callID:d,eventDetails:b})})};return b}(c("FluxReduceStore"));a.__moduleID=f.id;function h(a){if(!d("ZenonRTCConfig").getIsVCEndpointCall())return;c("Bootloader").loadModules(["ScotchCollabMessengerLogger"],a,"ScotchRTCP2PLoggerStore")}b=new a(c("ScotchRTCAppDispatcher"));g["default"]=b}),98);
__d("ScotchRTCUserSettingsReducers",["ScotchRTCMediaDevicesStore"],(function(a,b,c,d,e,f,g){function a(a,b){switch(b.type){case"USER_SETTINGS_EDIT":return a.set("editing",!0);case"USER_SETTINGS_CANCEL_EDITING":return a.set("editing",!1);case"USER_SETTINGS_SAVE":return a.set("audioInput",b.audioInput).set("audioOutput",b.audioOutput).set("editing",!1).set("videoInput",b.videoInput);case"USER_SETTINGS_SET_AUDIO_INPUT":return a.set("audioInput",b.audioInput);case"USER_SETTINGS_SET_AUDIO_OUTPUT":return a.set("audioOutput",b.audioOutput);case"USER_SETTINGS_SET_VIDEO_INPUT":return a.set("videoInput",b.videoInput);default:return a}}function b(a,b){switch(b.type){case"ADD_LOCAL_STREAM":return a.set("audioInput",h(b.stream.getAudioTracks()[0],"audioinput")||a.audioInput).set("videoInput",h(b.stream.getVideoTracks()[0],"videoinput")||a.videoInput);default:return a}}function h(a,b){if(!a)return null;a=c("ScotchRTCMediaDevicesStore").getByLabel(a.label,b);return a?a.deviceId:null}g.activelySetSettings=a;g.passivelySetSettings=b}),98);
__d("ScotchRTCUserSettingsStoreState",["immutable"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(c("immutable").Record({audioInput:null,audioOutput:null,editing:!1,videoInput:null}));g["default"]=a}),98);
__d("ScotchRTCUserSettingsStore",["FluxReduceStore","ScotchRTCAppDispatcher","ScotchRTCUserSettingsReducers","ScotchRTCUserSettingsStoreState"],(function(a,b,c,d,e,f,g){"use strict";var h=[d("ScotchRTCUserSettingsReducers").activelySetSettings,d("ScotchRTCUserSettingsReducers").passivelySetSettings];a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b;b=a.call(this,c("ScotchRTCAppDispatcher"))||this;b.reduce=function(a,b){return h.reduce(function(a,c){return c(a,b)},a)};return b}var d=b.prototype;d.getInitialState=function(){return new(c("ScotchRTCUserSettingsStoreState"))()};return b}(c("FluxReduceStore"));a.__moduleID=f.id;b=new a();g["default"]=b}),98);
__d("ScotchSignalingEventEmitter",["EventEmitter"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var c=b.prototype;c.emitJoinReady=function(a){this.emit("signalingPlatformEvent",{messageType:"joinReady",offer:a})};c.emitParentWindowConnectionTimeout=function(){this.emit("signalingPlatformEvent",{messageType:"parentWindowConnectionTimeout"})};return b}(c("EventEmitter"));b=new a();d=b;g["default"]=d}),98);
__d("ZenonLoggingConstants",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({ADMIN_MESSAGE:"admin_message",BREAKOUT_ROOM:"breakout_room",CHAT_TAB_ICON:"chat_tab_icon",CHAT_TAB_ICON_TOUR:"chat_tab_icon_tour",CHAT_TAB_VOICE_ICON:"chat_tab_voice_icon",MULTIWAY_ADMIN_MESSAGE_JOIN_AUDIO_CALL_BUTTON:"multiway_admin_message_join_audio_call_button",MULTIWAY_ADMIN_MESSAGE_JOIN_VIDEO_CALL_BUTTON:"multiway_admin_message_join_video_call_button",MULTIWAY_ADMIN_MESSAGE_START_AUDIO_CALL_BUTTON:"multiway_admin_message_start_audio_call_button",MULTIWAY_ADMIN_MESSAGE_START_VIDEO_CALL_BUTTON:"multiway_admin_message_start_video_call_button",MULTIWAY_CHAT_TAB_SHEET_JOIN_CALL_BUTTON:"multiway_chat_tab_sheet_join_call_button",MULTIWAY_POPUP_START_CALL_BUTTON:"multiway_popup_start_call_button",MULTIWAY_THREAD_HEADER_AUDIO_BUTTON:"multiway_thread_header_audio_button",MULTIWAY_THREAD_HEADER_JOIN_AUDIO_CALL_AUDIO_BUTTON:"multiway_thread_header_join_audio_call_audio_button",MULTIWAY_THREAD_HEADER_JOIN_AUDIO_CALL_VIDEO_BUTTON:"multiway_thread_header_join_audio_call_video_button",MULTIWAY_THREAD_HEADER_JOIN_VIDEO_CALL_AUDIO_BUTTON:"multiway_thread_header_join_video_call_audio_button",MULTIWAY_THREAD_HEADER_JOIN_VIDEO_CALL_VIDEO_BUTTON:"multiway_thread_header_join_video_call_video_button",MULTIWAY_THREAD_HEADER_VIDEO_BUTTON:"multiway_thread_header_video_button",MULTIWAY_THREAD_LIST_JOIN_CALL_BUTTON:"multiway_thread_list_join_call_button",POPUP_CALL_START_BUTTON:"popup_start_call_button",REDIAL_BUTTON:"redial_button",RESET_CALL:"install_screen_sharing_ext_dialog",RETURN_CALL:"return_call",SKYPE_DEPRECATION_DIALOG:"skype_deprecation_dialog",TEAMWORK_USER_AUDIO_CALL_ITEM:"teamwork_user_audio_call_item",TEAMWORK_USER_VIDEO_CALL_ITEM:"teamwork_user_video_call_item",TIMELINE_PROFILE:"timeline_profile",UNKNOWN:"unknown",VC_PRECALL_SETUP:"vc_precall_setup",WEB_MESSENGER:"web_messenger",WORKPLACE_GROUP_CALL:"workplace_group_call",WORKPLACE_P2P_CALL:"workplace_p2p_call"});c=b("$InternalEnum")({BATTERY_START:"battery_start",BATTERY_END:"battery_end",CALL_TYPE:"call_type",CONNECTION_EFFECTIVE_TYPE:"conn_effective_type",CPU_CORES:"cpu_cores",DEVICE_INFO:"device_info",DEVICE_MEMORY:"device_memory",DEVICE_PIXEL_RATIO:"device_pixel_ratio",INITIATED_BY_PAGE_ID:"initiated_by_page_id",INITIATED_BY_APP_ID:"initiated_by_app_id",PEER_IS_MOBILE:"peer_is_mobile",RATING_SHOWN:"rating_shown",RATING:"rating5",EFFECT_COUNT:"rtc_effect_count",EFFECT_TOTAL_DURATION:"rtc_effect_total_duration",VIDEO_DURATION_WITH_FILTER:"rtc_video_duration_with_filter_enabled",SCREEN_DURATION:"screen_duration",SURVEY_CHOICE:"survey_choice",SURVEY_DETAILS:"survey_details",SURVEY_SHOWN:"survey_shown",MEDIA_INPUTS:"media_inputs",VIDEO_CAPABILITIES:"video_capabilities",CB_ACTIVE:"cb_active",YEAR_CLASS:"year_class",DESKTOP_DEVICE_CLASS:"desktop_device_class",IS_BACKGROUNDED:"is_backgrounded",APPLICATION_STATE:"application_state",MAX_CONCURRENT_CONNECTED_PARTICIPANTS:"max_concurrent_connected_participants"});f.ZenonCallTrigger=a;f.ZenonLoggingKey=c}),66);
__d("ScotchUtils",["invariant","ChannelManager","CurrentUser","FBLogger","FBRTCHangupReason","FBRTCMessageListener","MercuryIDs","MessengerParticipants.re","PlatformType","Promise","RTWebFluxDebugger","ScotchConstants","ScotchFBRTCCallSummary","ScotchFBRTCCallSummaryStore","ScotchFBRTCGroupCallStore","ScotchFBRTCMWProtocolStore","ScotchRTCAppData","ScotchRTCAppDispatcher","ScotchRTCCallActions","ScotchRTCCallNUXStore","ScotchRTCCallNotificationStore","ScotchRTCCallStore","ScotchRTCCallType","ScotchRTCCoExperienceStore","ScotchRTCGroupCallActions","ScotchRTCGroupCallEscalationActions","ScotchRTCGroupCallEscalationStore","ScotchRTCMWProtocolHandler","ScotchRTCMediaDevicesStore","ScotchRTCP2PCallActions","ScotchRTCP2PCallEscalationActions","ScotchRTCP2PCallEscalationStore","ScotchRTCP2PCallEscalator","ScotchRTCP2PCallStore","ScotchRTCP2PCallWindowHandler","ScotchRTCP2PLoggerStore","ScotchRTCP2PProtocolHandler","ScotchRTCScreenSharing","ScotchRTCUser","ScotchRTCUserSettingsStore","ScotchRTWebClientFeatureGating","ScotchRTWebExperiments","ScotchRTWebUserActionLogger","ScotchSignalingEventEmitter","ScotchgenerateRTCCallID","ZenonDebugLogger","ZenonLoggingConstants","ZenonPeerID","ZenonRTWebBrowserFeatureSupport","ZenonSdpFormat","ZenonSignalingProtocol","cr:1420073","gkx","immutable","isStringNullOrEmpty","promiseDone","regeneratorRuntime"],(function(a,b,c,d,e,f,g,h){"use strict";a=function(){function a(a){this.$2="",this.$1=a}var e=a.prototype;e.initializeSignaling=function(a,d,e,f){c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"initializeSignaling",conferenceName:e});this.$2=e;if(this.$1.getConfigManager().getZenonStartCallImmediatelyConfig().isEnabled())c("ScotchSignalingEventEmitter").emitJoinReady(),c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"Signaling_JoinReady",conferenceName:e});else{d!=null&&c("FBRTCMessageListener").setParentWindowNonce(d);f=b("Promise").race([new(b("Promise"))(function(a){c("FBRTCMessageListener").setParentWindowStartCallHandler(function(b){a({offer:b,isTimeout:!1})})}),new(b("Promise"))(function(a){window.setTimeout(function(){a({offer:null,isTimeout:!0})},2e3)})]);c("promiseDone")(f,function(a){a.isTimeout?(c("FBRTCMessageListener").setParentWindowStartCallHandler(null),c("ScotchSignalingEventEmitter").emitParentWindowConnectionTimeout(),c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"Signaling_ParentWindowConnectionTimeout",conferenceName:e})):(c("ScotchSignalingEventEmitter").emitJoinReady(a.offer),c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"Signaling_JoinReady",conferenceName:e}))})}c("FBRTCMessageListener").init(!0,a)};e.initializeV2Infrastructure=function(a,b){b.peerID===d("ZenonPeerID").ZenonMWPeerID?this.initializeMW(b):this.initializeP2P(b)};e.initializeP2P=function(a){c("ScotchRTWebUserActionLogger").logCheckpoint({callID:a.callID==null?void 0:String(a.callID),checkpoint:"initializeP2P",conferenceName:a.roomID});var b={ScotchFBRTCGroupCallStore:c("ScotchFBRTCGroupCallStore"),ScotchRTCCallNotificationStore:c("ScotchRTCCallNotificationStore"),ScotchRTCCallStore:c("ScotchRTCCallStore"),ScotchRTCP2PCallEscalationStore:c("ScotchRTCP2PCallEscalationStore"),ScotchRTCCallNUXStore:c("ScotchRTCCallNUXStore"),ScotchRTCP2PCallStore:c("ScotchRTCP2PCallStore"),ScotchRTCCoExperienceStore:c("ScotchRTCCoExperienceStore"),ScotchRTCP2PLoggerStore:c("ScotchRTCP2PLoggerStore"),ScotchRTCMediaDevicesStore:c("ScotchRTCMediaDevicesStore"),ScotchRTCUserSettingsStore:c("ScotchRTCUserSettingsStore"),ScotchRTCGroupCallEscalationStore:c("ScotchRTCGroupCallEscalationStore"),ScotchFBRTCMWProtocolStore:c("ScotchFBRTCMWProtocolStore")},e=[];for(var f in b)e.push(b[f]);c("ScotchRTCAppDispatcher").explicitlyRegisterStores(e);e=a.roomID;c("isStringNullOrEmpty")(e)&&(e=c("ScotchgenerateRTCCallID")().toString(),c("ScotchRTWebUserActionLogger").logCheckpoint({callID:e,checkpoint:"ScotchgenerateRTCCallID",conferenceName:e}));c("ScotchRTCCallActions").initialize({protocol:d("ScotchConstants").SignalingProtocol.P2P,conferenceName:e,serverInfoData:null,callID:e});var g=a.initializeVideo?c("ScotchRTCCallType").AUDIO_VIDEO:c("ScotchRTCCallType").AUDIO_ONLY;d("ScotchRTCP2PCallActions").setCallType(g);d("ChannelManager").startChannelManagerForApp(d("ScotchRTCAppData").getChannelManagerAppName());d("RTWebFluxDebugger").attach(c("ScotchRTCAppDispatcher"),b);b=a.usersToRing.length===1;d("ScotchRTCP2PCallActions").setIsCaller(b);d("ScotchRTCP2PCallWindowHandler").init(window);a=a.peerID;b=c("ScotchFBRTCCallSummary").restoreOrInitialize(c("ScotchFBRTCCallSummaryStore").getInstance(),a,e,b);c("ScotchRTWebUserActionLogger").logCheckpoint({callID:e,checkpoint:"setCallSummaryFromStorage",conferenceName:e});b.onPopupOpened();b.setCallType(g===c("ScotchRTCCallType").AUDIO_ONLY?d("ScotchConstants").CallType.VOIP:d("ScotchConstants").CallType.DIRECT_VIDEO);b.setActiveConnection("p2p");b.save(c("ScotchFBRTCCallSummaryStore").getInstance());c("ScotchRTCCallActions").setCallSummary(b);g=c("ScotchRTCP2PCallStore").getState();b=g.protocolHandler;b.init(a,Number(e));g=new(c("ScotchRTCUser"))({FBID:c("CurrentUser").getID()});c("ScotchRTCCallActions").initLocalUser(g);b=new(c("ScotchRTCUser"))({FBID:a});c("ScotchRTCCallActions").initRemoteUsers(c("immutable").Set.of(b))};e.initializeMW=function(a){c("ScotchRTWebUserActionLogger").logCheckpoint({callID:a.callID==null?void 0:String(a.callID),checkpoint:"initializeMW",conferenceName:a.roomID});d("ChannelManager").startChannelManagerForApp(d("ScotchRTCAppData").getChannelManagerAppName());if(b("cr:1420073")!=null){var e={ScotchRTCCallStore:c("ScotchRTCCallStore"),ScotchFBRTCGroupCallStore:c("ScotchFBRTCGroupCallStore"),ScotchRTCCoExperienceStore:c("ScotchRTCCoExperienceStore"),ScotchFBRTCMWProtocolStore:c("ScotchFBRTCMWProtocolStore"),ScotchRTCCallNotificationStore:c("ScotchRTCCallNotificationStore"),ScotchRTCMediaDevicesStore:c("ScotchRTCMediaDevicesStore"),ScotchRTCGroupCallEscalationStore:c("ScotchRTCGroupCallEscalationStore"),ScotchRTCStateSyncStore:b("cr:1420073")},f={};c("ScotchRTCAppDispatcher").explicitlyRegisterStoresInMap(babelHelpers["extends"]({},e,f));d("RTWebFluxDebugger").attach(c("ScotchRTCAppDispatcher"),e)}else{f={ScotchRTCCallStore:c("ScotchRTCCallStore"),ScotchFBRTCGroupCallStore:c("ScotchFBRTCGroupCallStore"),ScotchRTCCoExperienceStore:c("ScotchRTCCoExperienceStore"),ScotchFBRTCMWProtocolStore:c("ScotchFBRTCMWProtocolStore"),ScotchRTCCallNotificationStore:c("ScotchRTCCallNotificationStore"),ScotchRTCMediaDevicesStore:c("ScotchRTCMediaDevicesStore"),ScotchRTCGroupCallEscalationStore:c("ScotchRTCGroupCallEscalationStore")};e={};c("ScotchRTCAppDispatcher").explicitlyRegisterStoresInMap(babelHelpers["extends"]({},f,e));d("RTWebFluxDebugger").attach(c("ScotchRTCAppDispatcher"),f)}d("ScotchRTCGroupCallActions").setLayout(d("ScotchConstants").GroupVideoViewLayout.GRID);e=d("MercuryIDs").getParticipantIDFromUserID(c("CurrentUser").getID());f={};f[e]=null;e=c("immutable").Map(f);d("ScotchRTCGroupCallActions").initThread(null,e);f=new(c("ScotchRTCUser"))({FBID:c("CurrentUser").getID()});c("ScotchRTCCallActions").initLocalUser(f);e=a.callID;f=a.peerID;f=c("ScotchFBRTCCallSummary").restoreOrInitialize(c("ScotchFBRTCCallSummaryStore").getInstance(),f,e,!0);f.setCallType("mws");f.setServerInfoData(a.serverInfoData);f.setConferenceName(a.roomID);f.save(c("ScotchFBRTCCallSummaryStore").getInstance());c("ScotchRTCCallActions").setCallSummary(f)};e.join=function(a){c("ScotchRTWebUserActionLogger").logCheckpoint({callID:a.serverCallID,checkpoint:"join",conferenceName:a.roomID});if(j()){a.usersToRing.length<=1||h(0,17639);a.usersToRing.length===0&&(a.peerID!==void 0&&a.peerID!==""||h(0,17640));var e=c("ScotchRTCCallStore").getState().remoteUsers.toArray()[0].FBID;a.peerID===e||h(0,15117,a.peerID,e);if(a.callTrigger===d("ZenonLoggingConstants").ZenonCallTrigger.REDIAL_BUTTON){e=c("ScotchgenerateRTCCallID")().toString();c("ScotchRTCCallActions").resetForRedial(e,e)}e=c("ScotchRTCP2PCallStore").getState();var f=e.protocolHandler;e=l(a.localMedia);for(var g=0;g<e.length;g++){var i=e[g];c("ScotchRTCCallActions").addLocalStream(i)}c("ScotchRTWebUserActionLogger").startTimer("fetchTurnCredentialsTimer");f.fetchTURNCredentials().then(function(){c("ScotchRTWebUserActionLogger").logStopTimer({timerName:"fetchTurnCredentialsTimer",checkpointName:"CallStart_fetchTurnCredentialsTimer"}),f.startCall(a.callTrigger,a.offer)})["catch"](function(){c("FBLogger")("rtc_www").warn("failed to fetch turn credentials"),c("ScotchRTWebUserActionLogger").logError({errorDomain:"failed to fetch turn credentials"})})}else{a.callTrigger===d("ZenonLoggingConstants").ZenonCallTrigger.REDIAL_BUTTON&&c("ScotchRTCCallActions").updateRemoteUsers(c("immutable").Set());i=l(a.localMedia);for(var g=0;g<i.length;g++){e=i[g];c("ScotchRTCCallActions").addLocalStream(e)}e={isEscalatedCall:!1};g=(g=c("ScotchFBRTCGroupCallStore").getState().thread)==null?void 0:(g=g.rtc_call_data)==null?void 0:g.server_info_data;e.serverInfoData=(g=g)!=null?g:a.serverInfoData;e.callTrigger=a.callTrigger;d("ScotchRTWebClientFeatureGating").preferIsacForGroupCalls()&&(e.preferredCodecs={audio:"ISAC/16000"});c("gkx")("1369511")&&(e.connectedOnJoin=!0);d("ScotchRTWebExperiments").shouldSubscribeToSimpleTopicOnJoin()&&(a.initialSyncStates!=null?a.initialSyncStates.set("simple_external",{number:42}):a.initialSyncStates=new Map([["simple_external",{number:42}]]));b("cr:1420073")!=null&&a.initialSyncStates!=null&&(e.initialSyncStates=a.initialSyncStates);g=new(c("ScotchRTCMWProtocolHandler"))(Number(a.serverCallID));a.roomID!=null||h(0,43894);g.startCall(a.usersToRing,i,a.roomID,e)}};e.approveParticipants=function(a,b){this.$3(b,1)};e.denyParticipants=function(a,b){this.$3(b,0)};e.getSdpFormat=function(a){return c("ZenonSdpFormat").PLAN_B};e.getSignalingProtocol=function(a){return j()?c("ZenonSignalingProtocol").P2P:c("ZenonSignalingProtocol").MW};e.getMediaMode=function(a){return j()?"p2p":"sfu"};e.getConferenceName=function(a){return this.$2};e.$3=function(a,b){var d=c("ScotchRTCCallStore").getState().callInfo,e=d.callID,f=d.conferenceName;d=d.serverInfoData;var g=a.toArray().join(", ");c("ScotchRTWebUserActionLogger").logCheckpoint({callID:e,checkpoint:"[WR] User is setting approval status of "+g+" to "+b,conferenceName:f});c("ScotchRTCMWProtocolHandler").sendApprovalRequest(f,d,a.toArray(),b)};e.unsubscribeFromStateSyncTopic=function(a,e){if(j()){c("FBLogger")("rtc_www").mustfix("Attempting to make state sync requests in P2P call");return}if(b("cr:1420073")==null)return;a=c("ScotchRTCCallStore").getState().callInfo;var f=a.callID,g=a.conferenceName;a=a.serverInfoData;c("ScotchRTWebUserActionLogger").logCheckpoint({callID:f,checkpoint:"[SS] User is unsubscribing from state with topic: "+e,conferenceName:g});f=b("cr:1420073").setUpdatedInputState(e,null);d("ScotchRTCGroupCallActions").setStateSyncUnsubscribe(e);c("ScotchRTCMWProtocolHandler").sendUnsubscribeRequest(g,a,e,f.version)};e.updateStateSyncTopic=function(a,e,f){if(j()){c("FBLogger")("rtc_www").mustfix("Attempting to make state sync requests in P2P call");return}if(b("cr:1420073")==null)return;a=c("ScotchRTCCallStore").getState().callInfo;var g=a.callID,h=a.conferenceName;a=a.serverInfoData;c("ScotchRTWebUserActionLogger").logCheckpoint({callID:g,checkpoint:"[SS] User is updating state with topic: "+e,conferenceName:h});g=b("cr:1420073").setUpdatedInputState(e,f);d("ScotchRTCGroupCallActions").setStateSyncSubscribe(e);c("ScotchRTCMWProtocolHandler").sendUpdateRequest(h,a,e,g.version,g.data)};e.muteTrack=function(a,b){this.$4(b,!1)};e.unmuteTrack=function(a,b){this.$4(b,!0)};e.$4=function(a,b){var d=c("ScotchRTCCallStore").getState();d=d.localUser;d=[].concat(d.streams.toArray(),d.screenStreams.toArray());var e=null;for(var d=d,f=Array.isArray(d),g=0,d=f?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=d.length)break;h=d[g++]}else{g=d.next();if(g.done)break;h=g.value}h=h;for(var h=h.getTracks(),i=Array.isArray(h),j=0,h=i?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k;if(i){if(j>=h.length)break;k=h[j++]}else{j=h.next();if(j.done)break;k=j.value}k=k;k.id===a&&(e=k)}}if(!e)return;c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"Toggle track:"+a+" from:"+e.enabled.toString()+" to:"+b.toString()});if(e.enabled===b)return;e.kind==="audio"?c("ScotchRTCCallActions").toggleMuteAudio(b):e.kind==="video"&&c("ScotchRTCCallActions").toggleMuteVideo(b)};e.endCall=function(a,b,e){if(j()){a=d("ScotchConstants").endCallReasonFromString(b);var f=c("ScotchRTCCallStore").getState().callInfo.conferenceState;if(f==="NEW"||f==="AWAITING_USER_START"){f=c("ScotchRTCCallStore").getState().callSummary;f.onCallEnded(a,!1,null,"DidNotInitiate");f.save(c("ScotchFBRTCCallSummaryStore").getInstance());return}f=c("ScotchRTCP2PCallStore").getState();f=f.protocolHandler;f.endCall(a,e)}else{f=c("ScotchRTCCallStore").getState().callInfo;a=f.conferenceName;f=f.serverInfoData;a=a==null||a==""?this.$2:a;b=m(b);a!=null||h(0,43894);c("ScotchRTCMWProtocolHandler").endCall(a,f,b,e)}};e.ringParticipants=function(a,b){if(b.length===0)return;if(j()){a=b.map(function(a){return d("MercuryIDs").getParticipantIDFromUserID(a)});d("MessengerParticipants.re").getMulti(a,function(a){d("ScotchRTCGroupCallEscalationActions").setUsersToRing(c("immutable").Map(a));a=c("ScotchRTCP2PCallStore").getState();a=a.protocolHandler;a.escalateToMultiway()})}else c("ScotchRTCMWProtocolHandler").addParticipants(c("ScotchRTCCallStore").getState().callInfo.conferenceName,c("ScotchRTCCallStore").getState().callInfo.serverInfoData,b)};e.addLocalTrack=function(a,b){b.contentType==="screen"||h(0,17183);j()||i()||h(0,14970);if(j()){a=c("ScotchRTCP2PCallStore").getState();a=a.protocolHandler;a.startScreenStream(b.webrtcStream)}else c("ScotchRTCMWProtocolHandler").startScreenStream(b.webrtcStream)};e.removeLocalTrack=function(a,b){j()||i()||h(0,14970);a=c("ScotchRTCCallStore").getState();a=a.localUser;a=a.screenStreams.toArray().find(function(a){return a.getTracks().find(function(a){return a.id===b})});if(!a)return;if(j()){var e=c("ScotchRTCP2PCallStore").getState();e=e.protocolHandler;e.stopScreenStream(a);d("ScotchRTCScreenSharing").stop()}else c("ScotchRTCMWProtocolHandler").stopScreenStream(a)};e.replaceLocalTrack=function(a,d,e,f){f===void 0&&(f=!1);a=c("ScotchRTCCallStore").getState();a=a.localUser;if(e.contentType==="screen"){var g=a.screenStreams.toArray().find(function(a){return a.getTracks().find(function(a){return a.id===d})});if(g)if(j()){var k=c("ScotchRTCP2PCallStore").getState();k=k.protocolHandler;k.updateScreenStream(g,e.webrtcStream)}else i()||h(0,21464),c("ScotchRTCMWProtocolHandler").updateScreenStream(g,e.webrtcStream);return b("Promise").resolve()}if(f){var l=a.streams.first();l!==void 0&&l.getTracks().forEach(function(a){a.kind!==e.webrtcTrack.kind&&(e.webrtcStream.addTrack(a),l.removeTrack(a))})}if(j()){c("ScotchRTCP2PProtocolHandler").replaceLocalStream(e.webrtcStream,!0);return b("Promise").resolve()}else{this.$5(a,e);return c("ScotchRTCMWProtocolHandler").updateLocalStream(e.webrtcStream,f)}};e.$5=function(a,b){var c;a=a.streams.toArray();c=(c=a.find(function(a){return(a==null?void 0:(a=a.getAudioTracks())==null?void 0:a.length)>0}))==null?void 0:c.getAudioTracks();a=(a=a.find(function(a){return(a==null?void 0:(a=a.getVideoTracks())==null?void 0:a.length)>0}))==null?void 0:a.getVideoTracks();c=(c=c&&c[0]&&!c[0].enabled)!=null?c:!1;a=(a=a&&a[0]&&!a[0].enabled)!=null?a:!1;if(c){c=b.webrtcStream.getAudioTracks()[0];c!=null&&(c.enabled=!1)}if(a){c=b.webrtcStream.getVideoTracks()[0];c!=null&&(c.enabled=!1)}};e.getCallProtocolType=function(){var a=c("ScotchRTCCallStore").getState().callInfo.protocol;return a==="p2p"?"p2p":a==="multiway"?"multiway":null};e.submitRating=function(a,b,d,e){b!==null&&c("ScotchRTCCallActions").submitRating(b),d!==null&&c("ScotchRTCCallActions").submitFeedback(d),e!==null&&c("ScotchRTCCallActions").submitSurveyChoice(e)};e.setRatingImpression=function(a,b){a&&c("ScotchRTCCallStore").mutateCallSummary(function(a){a.addExtraInfo(d("ZenonLoggingConstants").ZenonLoggingKey.RATING_SHOWN,"1")}),b&&c("ScotchRTCCallStore").mutateCallSummary(function(a){a.addExtraInfo(d("ZenonLoggingConstants").ZenonLoggingKey.SURVEY_SHOWN,"1")})};e.setLinkSurface=function(a,b){c("ScotchRTCCallStore").mutateCallSummary(function(a){a.setLinkSurface(b)})};e.acceptVideoEscalation=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:k();c("ScotchRTCCallStore").mutateCallSummary(function(a){a.setVidEscalationAcceptedClick(),a.setVidEscalationMediaRequested()});a.prev=2;a.next=5;return b("regeneratorRuntime").awrap(c("ScotchRTCP2PCallEscalator").acceptEscalation());case 5:c("ScotchRTCCallStore").mutateCallSummary(function(a){return a.setVidEscalationMediaSuccess()});a.next=12;break;case 8:a.prev=8,a.t0=a["catch"](2),c("ScotchRTCCallStore").mutateCallSummary(function(a){return a.setVidEscalationMediaFailed()});case 12:case"end":return a.stop()}},null,this,[[2,8]])};e.declineVideoEscalation=function(a){k(),c("ScotchRTCCallStore").mutateCallSummary(function(a){return a.setVidEscalationDeclinedClick()}),c("ScotchRTCP2PCallEscalator").declineEscalation()};e.cancelVideoEscalation=function(){k(),c("ScotchRTCCallStore").mutateCallSummary(function(a){return a.setVidEscalationInitClick()}),d("ScotchRTCP2PCallEscalationActions").cancel()};e.startVideoEscalation=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:if(!j()){a.next=15;break}c("ScotchRTCCallStore").mutateCallSummary(function(a){return a.setVidEscalationInitClick()});c("ScotchRTCCallStore").mutateCallSummary(function(a){return a.setVidEscalationMediaRequested()});a.prev=3;a.next=6;return b("regeneratorRuntime").awrap(c("ScotchRTCP2PCallEscalator").initEscalation());case 6:c("ScotchRTCCallStore").mutateCallSummary(function(a){return a.setVidEscalationMediaSuccess()});a.next=13;break;case 9:a.prev=9,a.t0=a["catch"](3),c("ScotchRTCCallStore").mutateCallSummary(function(a){return a.setVidEscalationMediaFailed()}),c("ScotchRTWebUserActionLogger").logError({errorDomain:"video_escalation_error",errorType:a.t0.toString()});case 13:a.next=16;break;case 15:c("ScotchRTCMWProtocolHandler").escalateLocalStream();case 16:case"end":return a.stop()}},null,this,[[3,9]])};e.removeParticipants=function(a,b){a=c("ScotchRTCCallStore").getState().callInfo;var d=a.conferenceName;a=a.serverInfoData;c("ScotchRTCMWProtocolHandler").removeParticipants(d,a,b)};e.notifyScreenShareStart=function(a){j()||c("ScotchRTCMWProtocolHandler").notifyScreenShareStart(a)};e.notifyScreenShareEnd=function(a){j()||c("ScotchRTCMWProtocolHandler").notifyScreenShareEnd(a)};e.forceEncodingEnabled=function(a,b){d("ScotchRTCGroupCallActions").forceEncodingEnabled(b)};e.createDataMessageSubscription=function(a,b,c){};e.removeDataMessageSubscription=function(a,b,c){};e.sendGenericDataMessage=function(a,b,d,e,f){j()||c("ScotchRTCMWProtocolHandler").sendGenericDataMessageRequest(b,d,e,f)};e.getLogIdentifiers=function(a){a=c("ScotchRTCCallStore").getState();var b=a.callInfo,e=a.callSummary;a=a.remoteUsers;if(j()){var f;return{sharedCallID:b.callID,localCallID:(f=e.localCallID)!=null?f:"",peerID:a.first().FBID}}else{return{sharedCallID:(f=b.serverInfoData)!=null?f:b.callID,localCallID:(a=e.localCallID)!=null?a:"",peerID:d("ZenonPeerID").ZenonMWPeerID}}};e.subscribeToRemoteVideo=function(a,b,d){c("ScotchRTCMWProtocolHandler").subscribeToRemoteFbids(b,d)};e.getPlatformType=function(){return c("PlatformType").Scotch};e.stopLocalVideo=function(a,b){c("ScotchRTCCallActions").stopLocalVideo()};return a}();function i(){return!j()&&d("ZenonRTWebBrowserFeatureSupport").isReplaceTrackSupported()}function j(){return c("ScotchRTCCallStore").getState().callInfo.protocol==="p2p"}function k(){j()||h(0,15678),c("ScotchRTCP2PCallEscalationStore").getState().inProgress||h(0,15713)}function l(a){var b=[];for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;b.includes(e.webrtcStream)||b.push(e.webrtcStream)}return b}function m(a){switch(a){case"HangupCall":return c("FBRTCHangupReason").HANGUP_CALL;case"IgnoreCall":return c("FBRTCHangupReason").IGNORE_CALL;case"NoAnswerTimeout":return c("FBRTCHangupReason").NO_ANSWER_TIMEOUT;case"InAnotherCall":return c("FBRTCHangupReason").IN_ANOTHER_CALL;case"ClientInterrupted":return c("FBRTCHangupReason").CLIENT_INTERRUPTED;case"ClientError":case"WebRTCError":return c("FBRTCHangupReason").CLIENT_ERROR;default:return c("FBRTCHangupReason").HANGUP_CALL}}g["default"]=a}),98);
__d("ZenonCallsContext",["ZenonCallSDK","err","immutable","react"],(function(a,b,c,d,e,f,g){"use strict";a=d("react");b=a.createContext({callMediaTypes:c("immutable").Map(),callSDK:new(c("ZenonCallSDK"))({}),callTimers:c("immutable").Map(),calls:c("immutable").Map(),currentClientCallId:"0",endCallHooks:new Set(),setCurrentClientCallId:function(){throw c("err")("setCurrentClientCallId is not implemented!")}});e=b;g["default"]=e}),98);
__d("ZenonDataMessageTopics",[],(function(a,b,c,d,e,f){"use strict";a="rtc_av_escalation_decline";f.AV_ESCALATION_DECLINE_DATA_MESSAGE_TOPIC=a}),66);
__d("ZenonRemoteVideoRenderingEnabledAtom",["Recoil"],(function(a,b,c,d,e,f,g){"use strict";a=d("Recoil").atom({"default":!0,key:"ZenonCallsRecoil_ZenonRemoteVideoRenderingEnabledAtom"});g["default"]=a}),98);
__d("ZenonRemoteVideoRenderingEnabledSelector",["Recoil","ZenonRemoteVideoRenderingEnabledAtom"],(function(a,b,c,d,e,f,g){"use strict";a=d("Recoil").selector({get:function(a){a=a.get;return a(c("ZenonRemoteVideoRenderingEnabledAtom"))},key:"ZenonVideoEscalationRecoil_ZenonRemoteVideoRenderingEnabledSelector"});g["default"]=a}),98);
__d("ZenonThreadContext",["react"],(function(a,b,c,d,e,f,g){"use strict";a=d("react");b=a.createContext(null);c=b;g["default"]=c}),98);
__d("ZenonThreadType",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({OneToOne:"ONE_TO_ONE",Group:"GROUP",Other:"OTHER"});c=a;f["default"]=c}),66);
__d("ZenonThreadHooks",["MercuryIDs","ZenonThreadContext","ZenonThreadType","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react"),i=h.useContext,j=h.useDebugValue,k=h.useMemo;function a(){var a=i(c("ZenonThreadContext"));a=a?a.id:null;j(a);return a}function b(){var a=i(c("ZenonThreadContext"));a=a?a.participants:[];j(a);return a}function e(){var a=i(c("ZenonThreadContext")),b=(a=a==null?void 0:(a=a.mercuryThread)==null?void 0:a.participants)!=null?a:null;a=k(function(){return b?b.map(function(a){return d("MercuryIDs").getUserIDFromParticipantID(a)}).filter(Boolean):[]},[b]);j(a);return a}function f(){var a=i(c("ZenonThreadContext"));a=a?a.imageUrl:null;j(a);return a}function l(){var a=i(c("ZenonThreadContext"));a=(a=a==null?void 0:a.type)!=null?a:c("ZenonThreadType").Other;j(a);return a}function m(){var a=i(c("ZenonThreadContext"));a=a?a.name:null;j(a);return a}function n(){var a=i(c("ZenonThreadContext"));a=a?a.hasOngoingCall:null;j(a);return a}function o(){var a=i(c("ZenonThreadContext"));a=a?a.mercuryThread:null;j(a);return a}g.useThreadFBID=a;g.useThreadAndCallParticipants=b;g.useThreadParticipants=e;g.useThreadImage=f;g.useThreadType=l;g.useThreadName=m;g.useOngoingCall=n;g.useMercuryThread=o}),98);
__d("ZenonCallsHooks",["FBLogger","Recoil","UserAgent","ZenonActorHooks","ZenonCallsContext","ZenonCallsModelTypes","ZenonDataMessageTopics","ZenonNetworkQualityMonitor","ZenonRemoteVideoRenderingEnabledSelector","ZenonScreenSharingAvailabilityType","ZenonThreadHooks","immutable","orEmptyArray","react","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";a=d("react");var h=a.useCallback,i=a.useContext,j=a.useDebugValue,k=a.useEffect,l=a.useMemo,m=a.useState,n={useAudioSharingRemoteUsersCount:function(){var a=n.useConnectedRemoteUsersIDs(),b=p(),c=0;b&&a.forEach(function(a){a=b.participants.get(a);if(a){a=a.trackIDs.map(function(a){return b.mediaTracks.get(a).contentType});a.includes("screen_audio")&&(c+=1)}});return c},useCallConnectedTime:function(){var a=i(c("ZenonCallsContext")),b=a.callTimers;a=a.currentClientCallId;a=(b=b.get(a))!=null?b:null;j(a);return a},useCallParticipant:function(a){var b=null,c=r();if(c){b=(c=c.get(a))!=null?c:null}j(b);return b},useCallParticipants:function(){var a=r();return(a=a)!=null?a:c("immutable").Map()},useCallParticipantsIDs:function(){var a=r(),b=l(function(){return a===null?[]:Array.from(a.keys()).sort()},[a]);j(b);return b},useCallState:function(){var a=p();a=a?a.callState:d("ZenonCallsModelTypes").ZenonCallState.New;j(a);return a},useCollisionContext:function(){var a=p();a=(a=a==null?void 0:a.collisionContext)!=null?a:null;j(a);return a},useConnectedCallParticipantsIDs:function(){var a=r(),b=l(function(){if(a!==null&&a.size>0){var b=a.filter(function(a){a=a.state;return a===d("ZenonCallsModelTypes").ZenonCallParticipantState.Connected});return Array.from(b.keys()).sort()}return[]},[a]);j(b);return b},useCurrentParticipant:function(){var a=d("ZenonActorHooks").useZenonActor();a=a[0];var b=r();return(b=b==null?void 0:b.get(a))!=null?b:null},useConnectedRemoteUserCount:function(){var a=d("ZenonActorHooks").useZenonActor(),b=a[0],c=r();a=l(function(){return c===null?0:c.filter(function(a){var c=a.id;a=a.state;return c!==b&&a===d("ZenonCallsModelTypes").ZenonCallParticipantState.Connected}).size},[b,c]);j(a);return a},useConnectedRemoteUsers:function(){var a=d("ZenonActorHooks").useZenonActor(),b=a[0],e=r();a=l(function(){return e!==null&&e.size>0?e.filter(function(a){var c=a.id;a=a.state;return c!==b&&a===d("ZenonCallsModelTypes").ZenonCallParticipantState.Connected}):c("immutable").Map()},[b,e]);j(a);return a},useConnectedRemoteUsersIDs:function(){var a=d("ZenonActorHooks").useZenonActor(),b=a[0],c=r();a=l(function(){if(c!==null&&c.size>0){var a=c.filter(function(a){var c=a.id;a=a.state;return c!==b&&a===d("ZenonCallsModelTypes").ZenonCallParticipantState.Connected});return Array.from(a.keys()).sort()}return[]},[b,c]);j(a);return a},useCoplayOutputState:function(){var a=p();if(a){a=(a=a.stateSyncOutputStates.get("coplay"))==null?void 0:a.data;return{eligibleParticipants:(a==null?void 0:a.eligibleParticipants)||[],matchState:(a==null?void 0:a.matchState)||null}}return null},useDominantSpeakerID_DEPRECATED:function(){var a=p();a=(a=a==null?void 0:a.features.dominantSpeaker)!=null?a:null;j(a);return a},useEndCallReason:function(){var a=p();a=(a=a==null?void 0:a.endCallReason)!=null?a:null;j(a);return a},useGetScreenAudio:function(){var a;a=(a=q().find(function(a){return a.contentType==="screen_audio"}))!=null?a:null;j(a);return a},useGroupEscalationStatus:function(){var a=p();a=(a=a==null?void 0:a.groupEscalationStatus)!=null?a:null;j(a);return a},useIsAudioCall:function(){var a=i(c("ZenonCallsContext")),b=a.callMediaTypes;a=a.currentClientCallId;b=b.get(a,"audio");j(b);return b==="audio"},useIsP2P_TEMP:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK;a=a.currentClientCallId;b=b.getCallProtocolType_DEPRECATED(a)==="p2p";return b},useLiveMediaTrack:function(a,b){var e=d("Recoil").useRecoilValue(c("ZenonRemoteVideoRenderingEnabledSelector")),f=p(),g=null;if(f&&(b!=="video"||e)){e=f.participants.get(a);if(e){g=(a=e.trackIDs.map(function(a){return f.mediaTracks.get(a)}).find(function(a){return a.contentType===b&&a.enabled&&a.webrtcTrack.readyState==="live"}))!=null?a:null}}j(g);return g},useLiveScreenOrVideoTrack:function(a){var b=n.useLiveMediaTrack(a,"video"),c=n.useSupportMultipleStreams();a=n.useLiveMediaTrack(a,"screen");if(c){b=(c=a)!=null?c:b}return b},useMediaTrack_DEBUG:function(a,b){var c=p(),d=null;if(c){a=c.participants.get(a);if(a){d=(a=a.trackIDs.map(function(a){return c.mediaTracks.get(a)}).find(function(a){return a.contentType===b}))!=null?a:null}}j(d);return d},useLiveMediaTracks_DEBUG:function(a,b){var d=p(),e=c("immutable").Set();if(d){a=d.participants.get(a);if(a){a=a.trackIDs.map(function(a){return d.mediaTracks.get(a)}).filter(function(a){return a.contentType===b&&a.enabled&&a.webrtcTrack.readyState==="live"});e=a}}j(e);return e},useLocalAudio:function(){var a;a=(a=q().find(function(a){return a.contentType==="audio"}))!=null?a:null;j(a);return a},useLocalScreen:function(){var a;a=(a=q().find(function(a){return a.contentType==="screen"}))!=null?a:null;j(a);return a},useLocalVideo:function(){var a;a=(a=q().find(function(a){return a.contentType==="video"}))!=null?a:null;j(a);return a},usePreContactingRemoteUsersIDs:function(){var a=d("ZenonActorHooks").useZenonActor(),b=a[0],c=r();a=l(function(){if(c!==null&&c.size>0){var a=c.filter(function(a){var c=a.id;a=a.state;return c!==b&&a===d("ZenonCallsModelTypes").ZenonCallParticipantState.Precontacting});return Array.from(a.keys()).sort()}return[]},[b,c]);j(a);return a},useRemoteScreen:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK;a=a.currentClientCallId;b=b.getCallProtocolType_DEPRECATED(a)==="p2p";a=p();var d=n.useSupportMultipleStreams(),e=null;if(b||d){e=a===null?null:(b=a.mediaTracks.find(function(a){return a.remote===!0&&a.contentType==="screen"&&a.enabled}))!=null?b:null}j(e);return e},useRemoteScreenTracks:function(){var a=n.useIsAudioCall(),b=p(),c=n.useSupportMultipleStreams();a=!a&&b!==null&&c?b.mediaTracks.filter(function(a){return a.remote===!0&&a.contentType==="screen"&&a.enabled}).toArray():[];j(a);return a},useRemoteVideoTracks:function(){var a=d("Recoil").useRecoilValue(c("ZenonRemoteVideoRenderingEnabledSelector")),b=n.useIsAudioCall(),e=p();a=a&&!b&&e!==null?e.mediaTracks.filter(function(a){return a.remote===!0&&a.contentType==="video"&&a.enabled}).toArray():[];j(a);return a},useReplaceScreenTrack:function(){var a=n.useAddLocalTrack(),b=n.useReplaceLocalTrack(),c=n.useLocalVideo(),d=n.useLocalScreen(),e=n.useSupportMultipleStreams();return h(function(f){c==null||e?d==null?a(f):b(d.trackId,f):b(c.trackId,f)},[a,e,d,c,b])},useResponseSubCode:function(){var a=p();return(a=a==null?void 0:a.responseSubCode)!=null?a:null},useVideoEscalationStatus:function(){var a=p();a=(a=a==null?void 0:a.videoEscalationStatus)!=null?a:null;j(a);return a},useAcceptVideoEscalation:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,d=a.currentClientCallId;return h(function(){b.acceptVideoEscalation(d)},[b,d])},useAddLocalTrack:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,d=a.currentClientCallId;return h(function(a){return b.addLocalTrack(d,a)},[b,d])},useApproveParticipants:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,d=a.currentClientCallId;return h(function(a){b.approveParticipants(d,a)},[b,d])},useCallSpecificState:function(a){if(typeof a==="function")throw c("unrecoverableViolation")("Functional state types will break useCallSpecificState!","rtc_www");var b=i(c("ZenonCallsContext")),d=b.currentClientCallId;b=m(function(){return c("immutable").Map([[d,a]])});var e=b[0],f=b[1];b=h(function(b){typeof b==="function"?f(function(c){return c.set(d,b(c.get(d,a)))}):f(e.set(d,b))},[d,a,e]);k(function(){e.has(d)||f(e.set(d,a))},[d,a,e]);return[e.get(d,a),b]},useCanAddParticipants:function(){var a=i(c("ZenonCallsContext")),b=a.calls;a=a.currentClientCallId;b=(a=(b=b.get(a))==null?void 0:b.features.canAddParticipants)!=null?a:!1;j(b);return b},useCanReplaceLocalStreams:function(){var a=i(c("ZenonCallsContext")),b=a.calls;a=a.currentClientCallId;b=(a=(b=b.get(a))==null?void 0:b.features.canReplaceLocalStreams)!=null?a:!1;j(b);return b},useCancelVideoEscalation:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,d=a.currentClientCallId;return h(function(){b.cancelVideoEscalation(d)},[b,d])},useDataMessageSubscription:function(a,b){var e=i(c("ZenonCallsContext")),f=e.callSDK,g=e.currentClientCallId,h=n.useCallState();k(function(){h===d("ZenonCallsModelTypes").ZenonCallState.Connected&&f.createDataMessageSubscription(g,a,b);return function(){f.removeDataMessageSubscription(g,a,b)}},[f,h,g,a,b])},useDeclineVideoEscalation:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,e=a.currentClientCallId,f=n.useConnectedRemoteUsersIDs();return h(function(){b.declineVideoEscalation_DEPRECATED(e),b.sendGenericDataMessage(e,d("ZenonDataMessageTopics").AV_ESCALATION_DECLINE_DATA_MESSAGE_TOPIC,"",f,[])},[b,e,f])},useDenyParticipants:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,d=a.currentClientCallId;return h(function(a){b.denyParticipants(d,a)},[b,d])},useEndCall:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,d=a.currentClientCallId,e=a.endCallHooks;return h(function(a,c){b.endCall(d,a,c),e.forEach(function(b){return b(a,c)})},[b,d,e])},useGetMediaMode:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK;a=a.currentClientCallId;return b.getMediaMode(a)},useGetPlatformType:function(){var a=i(c("ZenonCallsContext"));a=a.callSDK;return a.getPlatformType()},useGetSdpFormat:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK;a=a.currentClientCallId;return b.getSdpFormat(a)},useGetSignalingProtocol:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK;a=a.currentClientCallId;return b.getSignalingProtocol(a)},useIsGuest:function(a){var b=n.useCallParticipant(a),c=d("ZenonThreadHooks").useThreadParticipants();return l(function(){return(b==null?void 0:b.participantType)===d("ZenonCallsModelTypes").ZenonCallParticipantType.Guest||!c.includes(a)},[b,a,c])},useMuteTrack:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,d=a.currentClientCallId;return h(function(a){b.muteTrack(d,a)},[b,d])},useOnCallEnded:function(){var a=i(c("ZenonCallsContext")),b=a.endCallHooks;return h(function(a){b.add(a)},[b])},usePoorConnectionStatus:function(){var a=i(c("ZenonCallsContext")),b=a.calls;a=a.currentClientCallId;a=((b=b.get(a))==null?void 0:b.features.networkStatus.local)===d("ZenonNetworkQualityMonitor").ZenonNetworkQuality.Poor;j(a);return a},useRemoteTracksNetworkQualityMap:function(){var a=i(c("ZenonCallsContext")),b=a.calls;a=a.currentClientCallId;a=(b=b.get(a))==null?void 0:b.features.networkStatus.remote;j(a);return a},useRemoteScreenSharingUserIDs_DEPRECATED:function(){var a=p();return(a=a==null?void 0:a.remoteScreenSharingUserIDs)!=null?a:c("immutable").OrderedSet()},useRemoveAllGuestParticipants:function(){var a=d("ZenonActorHooks").useZenonActor(),b=a[0],c=n.useCallParticipantsIDs(),e=n.useRemoveParticipants(),f=l(function(){return c.filter(function(a){return b!==a})},[b,c]);return h(function(){e(f)},[f,e])},useRemoveLocalTrack:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,d=a.currentClientCallId;return h(function(a){return b.removeLocalTrack(d,a)},[b,d])},useRemoveParticipants:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,d=a.currentClientCallId;return h(function(a){b.removeParticipants(d,a)},[b,d])},useReplaceLocalTrack:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,d=a.currentClientCallId;return h(function(a,c,e){return b.replaceLocalTrack(d,a,c,e)},[b,d])},useRingParticipants:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,d=a.currentClientCallId;return h(function(a){b.ringParticipants(d,a)},[b,d])},useRtpReceivers_I_KNOW_WHAT_I_AM_DOING:function(){var a=p();a=c("orEmptyArray")(a==null?void 0:a.rtpReceivers_I_KNOW_WHAT_I_AM_DOING.toArray());o("useRtpReceivers");j(a);return a},useRtpSenders_I_KNOW_WHAT_I_AM_DOING:function(){var a=p();a=c("orEmptyArray")(a==null?void 0:a.rtpSenders_I_KNOW_WHAT_I_AM_DOING.toArray());o("useRtpSenders");j(a);return a},useScreenSharingAvailability:function(){var a=i(c("ZenonCallsContext")),b=a.calls;a=a.currentClientCallId;b=(a=(b=b.get(a))==null?void 0:b.features.screenSharingAvailability)!=null?a:c("ZenonScreenSharingAvailabilityType").Unknown;a=n.useIsAudioCall();(c("UserAgent").isBrowser("Safari")&&a||c("UserAgent").isBrowser("Oculus Browser"))&&(b=c("ZenonScreenSharingAvailabilityType").Unknown);j(b);return b},useServerInfoData:function(){var a=n.useCollisionContext();return(a=a==null?void 0:a.serverInfoData)!=null?a:null},useStartVideoEscalation:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,d=a.currentClientCallId;return h(function(){b.startVideoEscalation(d)},[b,d])},useSubscribeToRemoteVideo:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,d=a.currentClientCallId;return h(function(a,c){b.subscribeToRemoteVideo(d,a,c)},[b,d])},useSupportMultipleStreams:function(){var a=i(c("ZenonCallsContext")),b=a.calls;a=a.currentClientCallId;b=(a=(b=b.get(a))==null?void 0:b.features.supportMultipleStreams)!=null?a:!1;j(b);return b},useUnmuteTrack:function(){var a=i(c("ZenonCallsContext")),b=a.callSDK,d=a.currentClientCallId;return h(function(a){b.unmuteTrack(d,a)},[b,d])}};function o(a){k(function(){c("FBLogger")("ZenonCallsHooks").event(a)},[a])}function p(){var a=i(c("ZenonCallsContext")),b=a.calls;a=a.currentClientCallId;a=(b=b.get(a))!=null?b:null;j(a);return a}function q(){var a=p();a=a==null?void 0:a.mediaTracks;return!a?[]:a.filter(function(a){return a.remote===!1}).toArray()}function r(){var a=p();a=(a=a==null?void 0:a.participants)!=null?a:null;j(a);return a}b=n;g["default"]=b}),98);
__d("ZenonMWAVEscalationEnabledHooks",["ZenonBrowsers","ZenonCallsHooks","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h={isZenonMWAVEscalationEnabled:function(a){return!a&&c("gkx")("3608")&&d("ZenonBrowsers").supportsMWAVEscalation()},useIsZenonMWAVEscalationEnabled:function(){var a=c("ZenonCallsHooks").useIsP2P_TEMP();return h.isZenonMWAVEscalationEnabled(a)}};a=h;g["default"]=a}),98);
__d("ZenonCallsModelEmitter",["EventEmitter","FBLogger","ZenonCall","ZenonCallParticipant","ZenonCallsModelTypes","ZenonDismissReason","ZenonParticipantState","immutable"],(function(a,b,c,d,e,f,g){"use strict";var h=100;a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=d=a.call.apply(a,[this].concat(f))||this,d.$ZenonCallsModelEmitter1=c("immutable").Map(),d.$ZenonCallsModelEmitter2=null,d.$ZenonCallsModelEmitter3=null,b)||babelHelpers.assertThisInitialized(d)}var e=b.prototype;e.emitCallsModel=function(a,b){var d=this.$ZenonCallsModelEmitter1.get(a);b=new(c("ZenonCall"))({callState:this.$ZenonCallsModelEmitter4(b),clientCallId:a,collisionContext:b.collisionContext,endCallReason:this.$ZenonCallsModelEmitter5(b),features:b.currentUserCapabilities,groupEscalationStatus:this.$ZenonCallsModelEmitter6(b),mediaTracks:this.$ZenonCallsModelEmitter7(b),participants:this.$ZenonCallsModelEmitter8(b),rtpReceivers_I_KNOW_WHAT_I_AM_DOING:this.$ZenonCallsModelEmitter9(b),rtpSenders_I_KNOW_WHAT_I_AM_DOING:this.$ZenonCallsModelEmitter10(b),stateSyncInputStates:this.$ZenonCallsModelEmitter11(b),stateSyncOutputStates:this.$ZenonCallsModelEmitter12(b),videoEscalationStatus:this.$ZenonCallsModelEmitter13(b)});var e=!1;try{var f=JSON.stringify(d),g=JSON.stringify(b);d=!(d==null?void 0:d.mediaTracks.equals(b.mediaTracks));(f!==g||d)&&(e=!0)}catch(a){c("FBLogger")("rtc_www").catching(a).warn("[ZP] Error while diffing callsModel"),e=!0}e&&(this.$ZenonCallsModelEmitter1=this.$ZenonCallsModelEmitter1.set(a,b),this.$ZenonCallsModelEmitter14(this.$ZenonCallsModelEmitter1))};e.$ZenonCallsModelEmitter14=function(a){var b=this;this.$ZenonCallsModelEmitter3!=null?this.$ZenonCallsModelEmitter2=a:(this.emitCallsModelDelegate(a),this.$ZenonCallsModelEmitter3=window.setTimeout(function(){b.$ZenonCallsModelEmitter2!=null&&(b.emitCallsModelDelegate(b.$ZenonCallsModelEmitter2),b.$ZenonCallsModelEmitter2=null),window.clearTimeout(b.$ZenonCallsModelEmitter3),b.$ZenonCallsModelEmitter3=null},h))};e.emitCallsModelDelegate=function(a){this.emit("callsModelUpdate",a)};e.$ZenonCallsModelEmitter4=function(a){return i[a.connectionState]};e.$ZenonCallsModelEmitter5=function(a){return a.dismissReason!=null?d("ZenonDismissReason").dismissToEndCallReason(a.dismissReason):null};e.$ZenonCallsModelEmitter6=function(a){return null};e.$ZenonCallsModelEmitter7=function(a){return c("immutable").Map(a.getTracks())};e.$ZenonCallsModelEmitter8=function(a){var b=a.getConsolidatedParticipantStates(),e=a.getUserToTracksMap(),f=a.getTracks(),g=a.getExistingParticipantIds(),h=c("immutable").Map().withMutations(function(h){b.forEach(function(b,i){h.set(i,new(c("ZenonCallParticipant"))({id:i,isExistingParticipant:g.has(i),isVideoSubscribed:a.getIsUserVideoSubscribed(i),participantType:d("ZenonCallsModelTypes").ZenonCallParticipantType.Messenger,state:d("ZenonParticipantState").toCallParticipantState(b),trackIDs:c("immutable").Set((b=e.get(i))==null?void 0:b.keys()).filter(function(a){return f.has(a)}),userCapabilities:a.getUserCapabilities(i)}))})});return h};e.$ZenonCallsModelEmitter11=function(a){return c("immutable").Map(a.getStateSyncInputs())};e.$ZenonCallsModelEmitter12=function(a){return c("immutable").Map(a.getStateSyncOutputs())};e.$ZenonCallsModelEmitter13=function(a){return null};e.$ZenonCallsModelEmitter10=function(a){return c("immutable").Set(a.getRtpSenders_I_KNOW_WHAT_I_AM_DOING())};e.$ZenonCallsModelEmitter9=function(a){return c("immutable").Set(a.getRtpReceivers_I_KNOW_WHAT_I_AM_DOING())};e.getCallsModel=function(){return this.$ZenonCallsModelEmitter1};return b}(c("EventEmitter"));b=new a();var i=Object.freeze({clientInitiatedRenegotiation:d("ZenonCallsModelTypes").ZenonCallState.Connected,creatingSdp:d("ZenonCallsModelTypes").ZenonCallState.Connecting,init:d("ZenonCallsModelTypes").ZenonCallState.New,peerConnectionRestarting:d("ZenonCallsModelTypes").ZenonCallState.Connected,pendingApproval:d("ZenonCallsModelTypes").ZenonCallState.PendingApproval,sdpNegotiated:d("ZenonCallsModelTypes").ZenonCallState.Connected,sdpSet:d("ZenonCallsModelTypes").ZenonCallState.Connecting,serverInitiatedRenegotiating:d("ZenonCallsModelTypes").ZenonCallState.Connected,terminated:d("ZenonCallsModelTypes").ZenonCallState.Terminated,waitingForIncoming:d("ZenonCallsModelTypes").ZenonCallState.New});g.CALLS_MODEL_EMITTER_DELAY_MS=h;g.CallsModelEmitterInstance=b;g.CONNECTION_STATE_TO_CALL_STATE_MAP=i}),98);
__d("ZenonCapabilities",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b;a={AddParticipantEnabled:(b=a.addParticipantEnabled)!=null?b:!1,GROUP_COWATCH:(b=a.cowatchGroupEnabled)!=null?b:!1,MW_AV_ESCALATION:(b=a.multiwayVideoEscalation)!=null?b:!1,MultipleVideoStreamsAllowed:(b=a.multipleVideoStreamsAllowed)!=null?b:!1,cowatch:(b=a.cowatchEnabled)!=null?b:!1};return JSON.stringify(a)}f.capabilitiesToString=a}),66);
__d("ZenonConnectionInitState",["ZenonCapabilities","ZenonParticipantState"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c;if(b.type!=="createConnection")return;var e=b.payload.direction==="outgoing";b=b.payload;var f=b.dataChannels,g=b.initialSyncStates,h=b.mwRingRequest,i=b.serializedInitialSyncStates,j=b.tracks;b=b.usersToRing;var k=e?b:h==null?void 0:(c=h.jsonPayload.body.ringRequest)==null?void 0:c.otherParticipants;a.updateConnectionModel(function(b){k==null?void 0:k.forEach(function(a){b.updateParticipantState(a,d("ZenonParticipantState").ZenonParticipantState.CONTACTING)}),b.registerTrackFetcher(function(){return a.peerConnectionManager.getTracks()}),b.registerRtpSendersFetcher(function(){return a.peerConnectionManager.getRtpSenders()}),b.registerRtpReceiversFetcher(function(){return a.peerConnectionManager.getRtpReceivers()}),j==null?void 0:j.forEach(function(a){b.addLocalTrackToTrackMap({enabled:a.enabled,trackID:a.trackId,type:a.contentType,userID:b.selfUserID})})});e&&a.signalingClient.sendInvite(b);c=a.getConnectionModel();b=c.currentUserCapabilities;c=c.selfUserID;b={addParticipantEnabled:b.get("canAddParticipants"),cowatchEnabled:b.get("cowatchEnabled"),cowatchGroupEnabled:b.get("cowatchGroupEnabled"),multipleVideoStreamsAllowed:b.get("supportMultipleStreams"),multiwayVideoEscalation:b.get("multiwayVideoEscalation")};b=d("ZenonCapabilities").capabilitiesToString(b);a.signalingClient.sendClientInfo(new Map([[c,b]]),g,i);j&&a.peerConnectionManager.addLocalTracks(j,a.signalingClient.getSignalingModel().getMediaModeManager().getMediaMode(),e);f&&f.forEach(function(b){return a.peerConnectionManager.createDataChannel(b)});a.peerConnectionManager.getSupportsSimulcastOverSignaling()&&a.peerConnectionManager.createDataMessageSubscription("signalingVideoUploadUpdate",function(b){return a.peerConnectionManager.onSimulcastSignalingDataMessage(b)});(e||(h==null?void 0:(c=h.jsonPayload.body.ringRequest)==null?void 0:(b=c.offer)==null?void 0:b.sdpString)==null)&&a.peerConnectionManager.applyLocalSdp()}g.onCreateConnection=a}),98);
__d("ZenonConnectionPeerConnectionRestartingState",["ZenonMWMessageTypes","ZenonParticipantState"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b.type!=="sdpReceived")return;b=b.payload;var c=b.mediaStates,d=b.renegotiationOffer,e=b.sdp;b=b.source;a.updateConnectionModel(function(a){a.updateTrackMapFromMediaStates(c.tracks)});a.secondaryPeerConnectionManager.applyRemoteSdp(e,c,b,d)}function b(a,b){if(b.type!=="connectionEstablished"||b.payload.peerConnectionRole!=="secondary")return{};b=a.peerConnectionManager;var c=a.secondaryPeerConnectionManager,e=a.updateConnectionModel;c.setTrackListenersFromManager(b);c.swapPeerConnectionEventHandlers(b);a.signalingClient.sendClientEvent(d("ZenonMWMessageTypes").ZenonMWClientEventType.MEDIA_CONNECTED);e(function(a){a.registerTrackFetcher(function(){return c.getTracks()}),a.updateParticipantState(a.selfUserID,d("ZenonParticipantState").ZenonParticipantState.CONNECTED)});b.end(!1);e=a.signalingClient.getSignalingModel().getMediaModeManager().getMediaMode();e==="sfu"&&a.logEvent({name:"callEscalated"});return{activePeerConnection:"primary",peerConnectionManager:c,secondaryPeerConnectionManager:b}}g.onSdpReceived=a;g.onSecondaryConnectionEstablished=b}),98);
__d("ZenonConnectionSMGuards",["ZenonDebugLogger","ZenonInfraActionsLogger","ZenonMWMessageTypes","ZenonScreenShare"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b.type!=="addLocalTracks"||a.getConnectionModel().currentUserCapabilities.supportMultipleStreams){c("ZenonDebugLogger").getInstance().logGuardsResults("addScreenShareTrackWithReplaceGuard",!1);return!1}b=b.payload.tracks;if(!d("ZenonScreenShare").isScreenSharingTrack(b)){c("ZenonDebugLogger").getInstance().logGuardsResults("addScreenShareTrackWithReplaceGuard",!1);return!1}b=Array.from(a.getConnectionModel().getTracks().values()).some(function(a){return!a.remote&&(a.contentType==="video"||a.contentType==="screen")});c("ZenonDebugLogger").getInstance().logGuardsResults("addScreenShareTrackWithReplaceGuard",b);return b}function b(a,b){a=b.type==="createConnection"&&b.payload.direction==="incoming";c("ZenonDebugLogger").getInstance().logGuardsResults("incomingConnectionGuard",a);return a}function e(a,b){a=b.type==="createConnection"&&b.payload.direction==="outgoing";c("ZenonDebugLogger").getInstance().logGuardsResults("outgoingConnectionGuard",a);return a}function f(a,b){if(b.type!=="removeLocalTrack"||a.getConnectionModel().currentUserCapabilities.supportMultipleStreams){c("ZenonDebugLogger").getInstance().logGuardsResults("removeScreenShareTrackWithReplaceGuard",!1);return!1}b=b.payload.trackID;var e=a.getConnectionModel().getTracks().get(b);if(e==null||!d("ZenonScreenShare").isScreenSharingTrack([e])){c("ZenonDebugLogger").getInstance().logGuardsResults("removeScreenShareTrackWithReplaceGuard",!1);return!1}b=Array.from(a.getConnectionModel().getTracks().values()).some(function(a){return a.trackId!==e.trackId&&!a.remote&&(a.contentType==="video"||a.contentType==="screen")});c("ZenonDebugLogger").getInstance().logGuardsResults("removeScreenShareTrackWithReplaceGuard",b);return b}function h(a,b){a=b.type==="sdpReceived"&&b.payload.sdp.type==="answer";c("ZenonDebugLogger").getInstance().logGuardsResults("sdpAnswerReceiveGuard",a);return a}function i(a,b){a=b.type==="sdpReceived"&&b.payload.sdp.type==="offer";c("ZenonDebugLogger").getInstance().logGuardsResults("sdpOfferReceiveGuard",a);return a}function j(a,b){a=b.type==="sdpReceived"&&(b.payload.sdp.type==="answer"||b.payload.sdp.type==="offer"&&b.payload.mediaPath===d("ZenonMWMessageTypes").ZenonMWMediaPath.P2P);c("ZenonDebugLogger").getInstance().logGuardsResults("sdpAnswerOrP2POfferReceiveGuard",a);return a}function k(a,b){b=b.payload!=null&&b.payload.peerConnectionRole!=null&&b.payload.peerConnectionRole===a.activePeerConnection;c("ZenonDebugLogger").getInstance().logGuardsResults("activePeerConnectionGuard",b);return b}function l(a,b){a=b.payload!=null&&b.payload.peerConnectionRole!=null&&b.payload.peerConnectionRole==="secondary";c("ZenonDebugLogger").getInstance().logGuardsResults("secondaryPeerConnectionGuard",a);return a}function m(a,b){a=b.type==="mediaUpdateResponseReceived"&&b.payload.cancelNegotiations;c("ZenonDebugLogger").getInstance().logGuardsResults("cancelNegotiationsGuard",a);b.type==="mediaUpdateResponseReceived"&&c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP] cancel negotiations called with: "+String(b.payload.cancelNegotiations)});return a}g.addScreenShareTrackWithReplaceGuard=a;g.incomingConnectionGuard=b;g.outgoingConnectionGuard=e;g.removeScreenShareTrackWithReplaceGuard=f;g.sdpAnswerReceiveGuard=h;g.sdpOfferReceiveGuard=i;g.sdpAnswerOrP2POfferReceiveGuard=j;g.activePeerConnectionGuard=k;g.secondaryPeerConnectionGuard=l;g.cancelNegotiationsGuard=m}),98);
__d("ZenonConnectionSdpNegotiatedState",["ZenonScreenShare"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b.type!=="addLocalTracks"&&b.type!=="initiateAddLocalTracks")return;var c=b.payload.tracks;a.peerConnectionManager.addLocalTracks(c,a.signalingClient.getSignalingModel().getMediaModeManager().getMediaMode());a.peerConnectionManager.applyLocalSdp();a.updateConnectionModel(function(a){c.forEach(function(b){a.addLocalTrackToTrackMap({enabled:b.enabled,trackID:b.trackId,type:b.contentType,userID:a.selfUserID})})})}function b(a,b){if(b.type!=="addLocalTracks")return;var c=b.payload.tracks;if(!d("ZenonScreenShare").isScreenSharingTrack(c))return;a.peerConnectionManager.addLocalTracks(c,a.signalingClient.getSignalingModel().getMediaModeManager().getMediaMode());a.updateConnectionModel(function(a){c.forEach(function(b){a.addLocalTrackToTrackMap({enabled:b.enabled,trackID:b.trackId,type:b.contentType,userID:a.selfUserID})})})}function c(a,b){if(b.type!=="initiatePeerConnectionRestarting")return{};var c=a.peerConnectionManager,d=a.secondaryPeerConnectionManager;d.restart();d.setLocalMediaStateVersion(c.getLocalMediaStateVersion());d.addLocalTracks(Array.from(c.getTracks().values()).filter(function(a){return!a.remote}),a.signalingClient.getSignalingModel().getMediaModeManager().getMediaMode());c.getDataChannelLabels().forEach(function(a){d.createDataChannel(a)});a.secondaryPeerConnectionManager.getSupportsSimulcastOverSignaling()&&a.secondaryPeerConnectionManager.createDataMessageSubscription("signalingVideoUploadUpdate",function(b){return a.secondaryPeerConnectionManager.onSimulcastSignalingDataMessage(b)});b.payload.hasRemoteOffer||d.applyLocalSdp();return{activePeerConnection:"secondary"}}function e(a,b){if(b.type!=="removeLocalTrack"&&b.type!=="initiateRemoveLocalTrack")return;var c=b.payload.trackID;a.peerConnectionManager.removeLocalTrack(c);a.peerConnectionManager.applyLocalSdp();a.updateConnectionModel(function(a){a.removeLocalTrackFromTrackMap(c)})}function f(a,b){if(b.type!=="removeLocalTrack")return;var c=b.payload.trackID;a.peerConnectionManager.removeLocalTrack(c);a.updateConnectionModel(function(a){a.removeLocalTrackFromTrackMap(c)})}function h(a,b){if(b.type!=="replaceLocalTrack")return;b=b.payload;var c=b.replacementTrack,d=b.trackIDToReplace;a.peerConnectionManager.replaceLocalTrack(d,c);a.updateConnectionModel(function(a){a.removeLocalTrackFromTrackMap(d),a.addLocalTrackToTrackMap({enabled:c.enabled,trackID:c.trackId,type:c.contentType,userID:a.selfUserID})})}g.onAddLocalTracks=a;g.onAddScreenShareLocalTrack=b;g.onInitiatePeerConnectionRestarting=c;g.onRemoveLocalTrack=e;g.onRemoveScreenShareLocalTrack=f;g.onReplaceLocalTrack=h}),98);
__d("ZenonConnectionSdpSetState",["ZenonMWMessageTypes","ZenonParticipantState"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b.type!=="connectionEstablished")return;a.signalingClient.sendClientEvent(d("ZenonMWMessageTypes").ZenonMWClientEventType.MEDIA_CONNECTED);a.updateConnectionModel(function(a){a.updateParticipantState(a.selfUserID,d("ZenonParticipantState").ZenonParticipantState.CONNECTED)});a.logEvent({name:"callConnected"});a.logEvent({name:"connectionReady"})}g.onConnectionEstablished=a}),98);
__d("ZenonConnectionSharedActions",["ZenonDismissReason","ZenonInfraActionsLogger","ZenonMWMessageTypes","ZenonParticipantState","immutable"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b.type!=="addParticipants")return;var c=!1,e=b.payload.usersToRing;a.updateConnectionModel(function(a){var b=a.getConsolidatedParticipantStates();e.forEach(function(e){H(e,b)||(a.updateParticipantState(e,d("ZenonParticipantState").ZenonParticipantState.CONTACTING),c=!0)})});c&&a.signalingClient.sendAddParticipantsMessage(e)}function b(a,b){if(b.type!=="answerReady")return;b=b.payload;var c=b.mediaStates;b=b.sdp;a.signalingClient.sendSdp(b,c)}function e(a,b){if(b.type!=="capabilitiesReceived")return;var c=b.payload.capabilities;a.updateConnectionModel(function(a){a.updateCurrentUserCapabilities(c)})}function f(a,b){if(b.type!=="clientInfoReceived")return;var c=b.payload.userCapabilities;a.updateConnectionModel(function(a){a.updateAllParticipantsCapabilities(c)})}function h(a,b){if(b.type!=="connectionDestroyed"||b.payload.error===null)return;var c=d("ZenonDismissReason").mediaErrorToDismissReason(b.payload.error);a.updateConnectionModel(function(a){a.updateParticipantState(a.selfUserID,d("ZenonParticipantState").ZenonParticipantState.DISCONNECTED),a.dismissReason=c});a.logEvent({name:"connectionDestroyed"});a.logEvent({endCallReason:c,endCallSubreason:b.payload.error?b.payload.error:"",isRemoteEnded:!1,name:"callEnded"})}function i(a,b){if(b.type!=="connectionDropped")return;a.updateConnectionModel(function(a){H(a.selfUserID,a.getConsolidatedParticipantStates())&&a.updateParticipantState(a.selfUserID,d("ZenonParticipantState").ZenonParticipantState.CONNECTING)})}function j(a,b){if(b.type!=="createDataMessageSubscription")return{};var d=b.payload.dataChannelLabel;b=b.payload.messageHandler;var e=a.dataMessageSubscriptions.get(d,c("immutable").Set());a=a.dataMessageSubscriptions.set(d,e.add(b));return{dataMessageSubscriptions:a}}function k(a,b){if(b.type!=="dataMessageReceived")return;b=b.payload;var c=b.data;b=b.dataChannelLabel;a=a.dataMessageSubscriptions.get(b);a&&a.forEach(function(a){return a(c)})}function l(a,b){if(b.type!=="endConnection")return;b=b.payload;var c=b.dismissReason,e=b.dismissReasonSetByRemote,f=b.dismissSubreason;b=b.shouldInformPeer;a.updateConnectionModel(function(a){a.getConsolidatedParticipantStates().forEach(function(b,c){a.updateParticipantState(c,d("ZenonParticipantState").ZenonParticipantState.DISCONNECTED)}),a.dismissReason=c});b&&a.signalingClient.sendDismiss(c);a.logEvent({endCallReason:c,endCallSubreason:f,isRemoteEnded:e,name:"callEnded"});a.peerConnectionManager.end(!0)}function m(a,b){if(b.type!=="forceEncodingEnabled")return;a.peerConnectionManager.forceEncodingEnabled(b.payload.enabled)}function n(a,b){var c;if(b.type!=="iceCandidateReady")return;b=b.payload.candidate;b={candidateSdpString:b.candidate,sdpMLineIndex:(c=b.sdpMLineIndex)!=null?c:0,sdpMid:(c=b.sdpMid)!=null?c:""};a.signalingClient.sendIceCandidate(b)}function o(a,b){if(b.type!=="iceCandidateReceived")return;b=b.payload;b={candidate:b.candidateSdpString,sdpMLineIndex:b.sdpMLineIndex,sdpMid:b.sdpMid};var c=a.activePeerConnection,d=a.peerConnectionManager;a=a.secondaryPeerConnectionManager;c=c==="primary"?d:a;c.applyRemoteIceCandidate(b)}function p(a,b){if(b.type!=="localMediaStateUpdateProcessing")return;b=b.payload;var c=b.enabled;b=b.trackID;c?a.peerConnectionManager.unmuteLocalTrack(b):a.peerConnectionManager.muteLocalTrack(b)}function q(a,b){if(b.type!=="localMediaStateUpdateReady")return;a.signalingClient.sendMediaUpdate(b.payload.mediaStates)}function r(a,b){if(b.type!=="mediaUpdateReceived")return;a.peerConnectionManager.applyMediaUpdate(b.payload.mediaStates)}function s(a,b){if(b.type!=="mediaUpdateResponseReceived")return;if(b.payload.responseStatusCode!==d("ZenonMWMessageTypes").ZenonMWResponseStatusCode.OK){b.payload.cancelNegotiations&&a.peerConnectionManager.cancelPendingNegotiation();if(b.payload.responseSubCode===d("ZenonMWMessageTypes").ZenonMWResponseSubCode.REJECTING_CMU_WHEN_SMU_PENDING){a.peerConnectionManager.localMediaStateUpdateRetry((b=b.payload.retryAfter)!=null?b:0)}}else a.peerConnectionManager.clearRetryCount()}function t(a,b){if(b.type==="addLocalTracks"){var c={payload:b.payload,type:"initiateAddLocalTracks"};a.signalingClient.initiateClientRenegotiation(c)}else if(b.type==="removeLocalTrack"){c={payload:b.payload,type:"initiateRemoveLocalTrack"};a.signalingClient.initiateClientRenegotiation(c)}}function u(a,b){if(b.type!=="offerReady")return;a.signalingClient.sendSdp(b.payload.sdp,b.payload.mediaStates)}function v(a,b){if(b.type!=="offerReady")return;a.peerConnectionManager.cancelPendingNegotiation();a.peerConnectionManager.localMediaStateUpdateRetry(0)}function w(a,b){if(b.type!=="participantUpdateReceived")return;var c=b.payload.participantStates;a.updateConnectionModel(function(b){c.forEach(function(c,d){d!==b.selfUserID&&(b.updateParticipantState(d,c),I(c)&&a.logEvent({name:"atLeastOneParticipantAlerted"}),J(c)&&a.logEvent({name:"atLeastOneParticipantAnswered"}))})})}function x(a,b){if(b.type!=="removeDataMessageSubscription")return{};var d=b.payload.dataChannelLabel;b=b.payload.messageHandler;var e=a.dataMessageSubscriptions.get(d,c("immutable").Set());a=a.dataMessageSubscriptions.set(d,e["delete"](b));return{dataMessageSubscriptions:a}}function y(a,b){if(b.type!=="removeParticipants")return;b=b.payload.usersToRemove;a.signalingClient.sendRemoveParticipantsRequest(b)}function z(a,b){if(b.type!=="connectionRoomUpdateReceived")return;var c=b.payload.context;a.updateConnectionModel(function(a){a.collisionContext=c})}function A(a,b){if(b.type!=="sdpReceived")return;b=b.payload;var d=b.mediaStates,e=b.onProcessed,f=b.renegotiationOffer,g=b.sdp;b=b.source;a.peerConnectionManager.applyRemoteSdp(g,d,b,f,e);a.updateConnectionModel(function(a){a.updateTrackMapFromMediaStates(d.tracks),a.updateExistingParticipantsFromMediaStateTracks(d.tracks)});g.type==="answer"?a.logEvent({name:"answerSdpReceived"}):g.type==="offer"&&a.logEvent({name:"offerSdpReceived"});c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"Resending subscription request onSdpReceived"});b=K(a.currentSubscriptionRequest,a);a.signalingClient.sendSubscriptionRequest(b)}function B(a,b){if(b.type!=="sendGenericDataMessage")return;b=b.payload;var c=b.data,d=b.recipientIDs,e=b.serviceRecipients;b=b.topic;a.signalingClient.sendGenericDataMessage(b,c,d,e)}function C(a,b){if(b.type!=="stateSyncUnsubscribe")return;b=b.payload.topic;a.signalingClient.sendStateSyncUnsubscribe(b)}function D(a,b){if(b.type!=="stateSyncUpdate")return;b=b.payload;var c=b.inputData;b=b.topic;a.signalingClient.sendStateSyncUpdate(b,c)}function E(a,b){if(b.type!=="stopLocalTrack")return;b=b.payload.trackID;a.peerConnectionManager.stopLocalTrack(b)}function F(a,b){if(b.type!=="subscriptionRequest")return{};var c=b.payload;b=K(c,a);a.updateConnectionModel(function(a){c.subscriptions.forEach(function(b){a.updateUserVideoSubscription(b.user,!0)})});a.signalingClient.sendSubscriptionRequest(b);return{currentSubscriptionRequest:c}}function G(a,b){if(b.type!=="userApprovalRequest")return;b=b.payload;var c=b.approvalStatus;b=b.targetUsers;a.signalingClient.sendUsersApprovalRequest(c,b)}function H(a,b){b=b.get(a);return b===d("ZenonParticipantState").ZenonParticipantState.CONNECTED}function I(a){switch(a){case d("ZenonParticipantState").ZenonParticipantState.UNKNOWN:case d("ZenonParticipantState").ZenonParticipantState.CONTACTING:case d("ZenonParticipantState").ZenonParticipantState.UNCALLABLE:case d("ZenonParticipantState").ZenonParticipantState.UNREACHABLE:case d("ZenonParticipantState").ZenonParticipantState.PARTICIPANT_LIMIT_REACHED:case d("ZenonParticipantState").ZenonParticipantState.RING_TYPE_UNSUPPORTED:return!1;case d("ZenonParticipantState").ZenonParticipantState.RINGING:case d("ZenonParticipantState").ZenonParticipantState.CONNECTING:case d("ZenonParticipantState").ZenonParticipantState.CONNECTED:case d("ZenonParticipantState").ZenonParticipantState.DISCONNECTED:case d("ZenonParticipantState").ZenonParticipantState.IN_ANOTHER_CALL:case d("ZenonParticipantState").ZenonParticipantState.NO_ANSWER:case d("ZenonParticipantState").ZenonParticipantState.REJECTED:case d("ZenonParticipantState").ZenonParticipantState.CONNECTION_DROPPED:case d("ZenonParticipantState").ZenonParticipantState.PENDING_APPROVAL:case d("ZenonParticipantState").ZenonParticipantState.APPROVED:case d("ZenonParticipantState").ZenonParticipantState.FAILED_APPROVAL:case d("ZenonParticipantState").ZenonParticipantState.HANGUP_IN_WAITING_ROOM:case d("ZenonParticipantState").ZenonParticipantState.NEGOTIATING:return!0}}function J(a){switch(a){case d("ZenonParticipantState").ZenonParticipantState.UNKNOWN:case d("ZenonParticipantState").ZenonParticipantState.CONTACTING:case d("ZenonParticipantState").ZenonParticipantState.UNCALLABLE:case d("ZenonParticipantState").ZenonParticipantState.UNREACHABLE:case d("ZenonParticipantState").ZenonParticipantState.PARTICIPANT_LIMIT_REACHED:case d("ZenonParticipantState").ZenonParticipantState.RING_TYPE_UNSUPPORTED:case d("ZenonParticipantState").ZenonParticipantState.RINGING:case d("ZenonParticipantState").ZenonParticipantState.DISCONNECTED:case d("ZenonParticipantState").ZenonParticipantState.IN_ANOTHER_CALL:case d("ZenonParticipantState").ZenonParticipantState.NO_ANSWER:case d("ZenonParticipantState").ZenonParticipantState.REJECTED:case d("ZenonParticipantState").ZenonParticipantState.PENDING_APPROVAL:case d("ZenonParticipantState").ZenonParticipantState.APPROVED:case d("ZenonParticipantState").ZenonParticipantState.FAILED_APPROVAL:case d("ZenonParticipantState").ZenonParticipantState.HANGUP_IN_WAITING_ROOM:return!1;case d("ZenonParticipantState").ZenonParticipantState.CONNECTING:case d("ZenonParticipantState").ZenonParticipantState.CONNECTED:case d("ZenonParticipantState").ZenonParticipantState.CONNECTION_DROPPED:case d("ZenonParticipantState").ZenonParticipantState.NEGOTIATING:return!0}}function K(a,b){var e;b=b.getConnectionModel();var f=a==null?void 0:a.subscriptions;a=(a=a==null?void 0:a.includeDominantSpeaker)!=null?a:!0;c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"[ZP] Incoming subscriptions request: "+((e=JSON.stringify(f))!=null?e:"null")});f==null?e=L(b):e=M(f,b);f=e;b=f.trackSubscriptions;e=f.warnings;e.length>0&&c("ZenonInfraActionsLogger").logError({checkpoint:"[ZP] Subscription request warnings: "+JSON.stringify(e),errorDomain:"ZenonConnectionSharedActions_makeSubscriptionList"});a&&b.push({type:d("ZenonMWMessageTypes").ZenonMWSubscriptionType.DOMINANT_SPEAKER});return b}function L(a){var b=a.getRemoteUserToTracksMap(),c=[],e=[];b.forEach(function(b,e){a.clearFailedSubscriptionTimer(e);e=Array.from(b.entries());e=e.filter(function(a){a[0];a=a[1];return a.type!=="audio"});e.forEach(function(a){var b=a[0];a[1];c.push({options:{videoQuality:d("ZenonMWMessageTypes").ZenonMWVideoQuality.MEDIUM},trackId:b,type:d("ZenonMWMessageTypes").ZenonMWSubscriptionType.TRACK})})});return{trackSubscriptions:c,warnings:e}}function M(a,b){var e=b.getRemoteUserToTracksMap(),f=[],g=[];a.forEach(function(a){var h=a.user,i=a.videoQuality;if(h===b.selfUserID){c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP] Forfeiting subscription request for self user ID: "+h});return}a=e.get(h);if(!a){f.push({msg:"userToTrackMap not found",user:h});b.startFailedSubscriptionTimer(h);return}if(a.size===0){f.push({msg:"userToTrackMap is empty",user:h});b.startFailedSubscriptionTimer(h);return}b.clearFailedSubscriptionTimer(h);h=Array.from(a.entries());a=h.filter(function(a){a[0];a=a[1];return a.type!=="audio"&&a.enabled===!1});a.length>0&&c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP] Subscribing to muted video track: "+JSON.stringify(a)});h=h.filter(function(a){a[0];a=a[1];return a.type!=="audio"});h.forEach(function(a){var b=a[0];a[1];g.push({options:{videoQuality:i},trackId:b,type:d("ZenonMWMessageTypes").ZenonMWSubscriptionType.TRACK})})});return{trackSubscriptions:g,warnings:f}}g.onAddParticipants=a;g.onAnswerReady=b;g.onCapabilitiesReceived=e;g.onClientInfoReceived=f;g.onConnectionDestroyed=h;g.onConnectionDropped=i;g.onCreateDataMessageSubscription=j;g.onDataMessageReceived=k;g.onEndConnection=l;g.onForceEncodingEnabled=m;g.onIceCandidateReady=n;g.onIceCandidateReceived=o;g.onLocalMediaStateUpdateProcessing=p;g.onLocalMediaStateUpdateReady=q;g.onMediaUpdateReceived=r;g.onMediaUpdateResponseReceived=s;g.initiateClientRenegotiation=t;g.onOfferReady=u;g.onOfferReadyCancel=v;g.onParticipantUpdateReceivedEvent=w;g.onRemoveDataMessageSubscription=x;g.onRemoveParticipants=y;g.onRoomContextUpdateReceived=z;g.onSdpReceived=A;g.onSendGenericDataMessage=B;g.onStateSyncUnsubscribe=C;g.onStateSyncUpdate=D;g.onStopLocalTrack=E;g.onSubscriptionRequest=F;g.onUserApprovalRequest=G;g.makeSubscriptionList=K}),98);
/**
 * License: https://www.facebook.com/legal/license/MDzNl_j9yvg/
 */
__d("xstate-4.16.0",[],(function(a,b,c,d,e,f){"use strict";var g={},h={exports:g};function i(){Object.defineProperty(g,"__esModule",{value:!0}),g.TARGETLESS_KEY=g.DEFAULT_GUARD_TYPE=g.EMPTY_ACTIVITY_MAP=g.STATE_DELIMITER=void 0,g.STATE_DELIMITER=".",g.EMPTY_ACTIVITY_MAP={},g.DEFAULT_GUARD_TYPE="xstate.guard",g.TARGETLESS_KEY=""}var j=!1;function k(){j||(j=!0,i());return h.exports}var l={},m={exports:l};function n(){Object.defineProperty(l,"__esModule",{value:!0}),l.IS_PRODUCTION=void 0,l.IS_PRODUCTION=!0}var o=!1;function p(){o||(o=!0,n());return m.exports}var q={},r={exports:q};function s(){var a=this&&this.__assign||function(){a=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};return a.apply(this,arguments)},b=this&&this.__values||function(a){var b=typeof Symbol==="function"&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&typeof a.length==="number")return{next:function(){a&&d>=a.length&&(a=void 0);return{value:a&&a[d++],done:!a}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__read||function(a,b){var c=typeof Symbol==="function"&&a[Symbol.iterator];if(!c)return a;a=c.call(a);var d,e=[],f;try{while((b===void 0||b-->0)&&!(d=a.next()).done)e.push(d.value)}catch(a){f={error:a}}finally{try{d&&!d.done&&(c=a["return"])&&c.call(a)}finally{if(f)throw f.error}}return e},d=this&&this.__spread||function(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(c(arguments[b]));return a};Object.defineProperty(q,"__esModule",{value:!0});q.toObserver=q.toInvokeSource=q.evaluateGuard=q.reportUnhandledExceptionOnInvocation=q.normalizeTarget=q.toTransitionConfigArray=q.toSCXMLEvent=q.toEventObject=q.uniqueId=q.isActor=q.isMachine=q.symbolObservable=q.isObservable=q.toGuard=q.isString=q.isFunction=q.isArray=q.warn=q.updateContext=q.updateHistoryValue=q.updateHistoryStates=q.partition=q.isPromiseLike=q.isBuiltInEvent=q.mapContext=q.toArray=q.toArrayStrict=q.flatten=q.pathsToStateValue=q.toStatePaths=q.nestedPath=q.path=q.mapFilterValues=q.mapValues=q.pathToStateValue=q.toStateValue=q.isStateLike=q.toStatePath=q.getActionType=q.getEventType=q.matchesState=q.keys=void 0;var e=k(),f=p();function g(a){return Object.keys(a)}q.keys=g;function h(a,b,c){c===void 0&&(c=e.STATE_DELIMITER);var d=n(a,c),f=n(b,c);if(J(f))return J(d)?f===d:!1;return J(d)?d in f:g(d).every(function(a){return!(a in f)?!1:h(d[a],f[a])})}q.matchesState=h;function i(a){try{return J(a)||typeof a==="number"?""+a:a.type}catch(a){throw new Error("Events must be strings or objects with a string event.type property.")}}q.getEventType=i;function j(a){try{return J(a)||typeof a==="number"?""+a:I(a)?a.name:a.type}catch(a){throw new Error("Actions must be strings or objects with a string action.type property.")}}q.getActionType=j;function l(a,b){try{return H(a)?a:a.toString().split(b)}catch(b){throw new Error("'"+a+"' is not a valid state path.")}}q.toStatePath=l;function m(a){return typeof a==="object"&&"value"in a&&"context"in a&&"event"in a&&"_event"in a}q.isStateLike=m;function n(a,b){if(m(a))return a.value;if(H(a))return o(a);if(typeof a!=="string")return a;a=l(a,b);return o(a)}q.toStateValue=n;function o(a){if(a.length===1)return a[0];var b={},c=b;for(var d=0;d<a.length-1;d++)d===a.length-2?c[a[d]]=a[d+1]:(c[a[d]]={},c=c[a[d]]);return b}q.pathToStateValue=o;function r(a,b){var c={},d=g(a);for(var e=0;e<d.length;e++){var f=d[e];c[f]=b(a[f],f,a,e)}return c}q.mapValues=r;function s(a,c,d){var e,f,h={};try{for(var i=b(g(a)),j=i.next();!j.done;j=i.next()){var k=j.value,l=a[k];if(!d(l))continue;h[k]=c(l,k,a)}}catch(a){e={error:a}}finally{try{j&&!j.done&&(f=i["return"])&&f.call(i)}finally{if(e)throw e.error}}return h}q.mapFilterValues=s;i=function(a){return function(c){var d,e;c=c;try{for(var f=b(a),g=f.next();!g.done;g=f.next()){var h=g.value;c=c[h]}}catch(a){d={error:a}}finally{try{g&&!g.done&&(e=f["return"])&&e.call(f)}finally{if(d)throw d.error}}return c}};q.path=i;function t(a,c){return function(d){var e,f;d=d;try{for(var g=b(a),h=g.next();!h.done;h=g.next()){var i=h.value;d=d[c][i]}}catch(a){e={error:a}}finally{try{h&&!h.done&&(f=g["return"])&&f.call(g)}finally{if(e)throw e.error}}return d}}q.nestedPath=t;function u(a){if(!a)return[[]];if(J(a))return[[a]];var b=w(g(a).map(function(b){var c=a[b];return typeof c!=="string"&&(!c||!Object.keys(c).length)?[[b]]:u(a[b]).map(function(a){return[b].concat(a)})}));return b}q.toStatePaths=u;function v(a){var c,d,e={};if(a&&a.length===1&&a[0].length===1)return a[0][0];try{for(var a=b(a),f=a.next();!f.done;f=a.next()){var g=f.value,h=e;for(var i=0;i<g.length;i++){var j=g[i];if(i===g.length-2){h[j]=g[i+1];break}h[j]=h[j]||{};h=h[j]}}}catch(a){c={error:a}}finally{try{f&&!f.done&&(d=a["return"])&&d.call(a)}finally{if(c)throw c.error}}return e}q.pathsToStateValue=v;function w(a){var b;return(b=[]).concat.apply(b,d(a))}q.flatten=w;function x(a){return H(a)?a:[a]}q.toArrayStrict=x;function y(a){return a===void 0?[]:x(a)}q.toArray=y;function z(a,c,d){var e,f;if(I(a))return a(c,d.data);var g={};try{for(var h=b(Object.keys(a)),i=h.next();!i.done;i=h.next()){var j=i.value,k=a[j];I(k)?g[j]=k(c,d.data):g[j]=k}}catch(a){e={error:a}}finally{try{i&&!i.done&&(f=h["return"])&&f.call(h)}finally{if(e)throw e.error}}return g}q.mapContext=z;function A(a){return/^(done|error)\./.test(a)}q.isBuiltInEvent=A;function B(a){if(a instanceof Promise)return!0;return a!==null&&(I(a)||typeof a==="object")&&I(a.then)?!0:!1}q.isPromiseLike=B;function C(a,d){var e,f,g=c([[],[]],2),h=g[0];g=g[1];try{for(var a=b(a),i=a.next();!i.done;i=a.next()){var j=i.value;d(j)?h.push(j):g.push(j)}}catch(a){e={error:a}}finally{try{i&&!i.done&&(f=a["return"])&&f.call(a)}finally{if(e)throw e.error}}return[h,g]}q.partition=C;function D(a,b){return r(a.states,function(a,c){if(!a)return void 0;c=(J(b)?void 0:b[c])||(a?a.current:void 0);return!c?void 0:{current:c,states:D(a,c)}})}q.updateHistoryStates=D;function E(a,b){return{current:b,states:D(a,b)}}q.updateHistoryValue=E;function F(a,c,d,e){f.IS_PRODUCTION||G(!!a,"Attempting to update undefined context");d=a?d.reduce(function(a,d){var f,h,i=d.assignment;d={state:e,action:d,_event:c};var j={};if(I(i))j=i(a,c.data,d);else try{for(var k=b(g(i)),l=k.next();!l.done;l=k.next()){var m=l.value,n=i[m];j[m]=I(n)?n(a,c.data,d):n}}catch(a){f={error:a}}finally{try{l&&!l.done&&(h=k["return"])&&h.call(k)}finally{if(f)throw f.error}}return Object.assign({},a,j)},a):a;return d}q.updateContext=F;var G=function(){};q.warn=G;f.IS_PRODUCTION||(q.warn=G=function(a,b){var c=a instanceof Error?a:void 0;if(!c&&a)return;if(console!==void 0){a=["Warning: "+b];c&&a.push(c);console.warn.apply(console,a)}});function H(a){return Array.isArray(a)}q.isArray=H;function I(a){return typeof a==="function"}q.isFunction=I;function J(a){return typeof a==="string"}q.isString=J;function K(a,b){if(!a)return void 0;if(J(a))return{type:e.DEFAULT_GUARD_TYPE,name:a,predicate:b?b[a]:void 0};return I(a)?{type:e.DEFAULT_GUARD_TYPE,name:a.name,predicate:a}:a}q.toGuard=K;function aa(a){try{return"subscribe"in a&&I(a.subscribe)}catch(a){return!1}}q.isObservable=aa;q.symbolObservable=function(){return typeof Symbol==="function"&&Symbol.observable||"@@observable"}();function L(a){try{return"__xstatenode"in a}catch(a){return!1}}q.isMachine=L;function M(a){return!!a&&typeof a.send==="function"}q.isActor=M;q.uniqueId=function(){var a=0;return function(){a++;return a.toString(16)}}();function N(b,c){return J(b)||typeof b==="number"?a({type:b},c):b}q.toEventObject=N;function O(b,c){if(!J(b)&&"$$type"in b&&b.$$type==="scxml")return b;b=N(b);return a({name:b.type,data:b,$$type:"scxml",type:"external"},c)}q.toSCXMLEvent=O;function ba(b,c){c=x(c).map(function(c){return typeof c==="undefined"||typeof c==="string"||L(c)?{target:c,event:b}:a(a({},c),{event:b})});return c}q.toTransitionConfigArray=ba;function ca(a){return a===void 0||a===e.TARGETLESS_KEY?void 0:y(a)}q.normalizeTarget=ca;function P(a,b,c){if(!f.IS_PRODUCTION){var d=a.stack?" Stacktrace was '"+a.stack+"'":"";if(a===b)console.error("Missing onError handler for invocation '"+c+"', error was '"+a+"'."+d);else{var e=b.stack?" Stacktrace was '"+b.stack+"'":"";console.error("Missing onError handler and/or unhandled exception/promise rejection for invocation '"+c+"'. "+("Original error: '"+a+"'. "+d+" Current error is '"+b+"'."+e))}}}q.reportUnhandledExceptionOnInvocation=P;function Q(a,b,c,d,f){var g=a.options.guards;f={state:f,cond:b,_event:d};if(b.type===e.DEFAULT_GUARD_TYPE)return b.predicate(c,d.data,f);g=g[b.type];if(!g)throw new Error("Guard '"+b.type+"' is not implemented on machine '"+a.id+"'.");return g(c,d.data,f)}q.evaluateGuard=Q;function R(a){return typeof a==="string"?{type:a}:a}q.toInvokeSource=R;function da(a,b,c){if(typeof a==="object")return a;var d=function(){return void 0};return{next:a,error:b||d,complete:c||d}}q.toObserver=da}var t=!1;function u(){t||(t=!0,s());return r.exports}var v={},w={exports:v};function x(){var a=this&&this.__values||function(a){var b=typeof Symbol==="function"&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&typeof a.length==="number")return{next:function(){a&&d>=a.length&&(a=void 0);return{value:a&&a[d++],done:!a}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(v,"__esModule",{value:!0});v.mapState=void 0;var b=u();function c(c,d){var e,f,g;try{for(var h=a(b.keys(c)),i=h.next();!i.done;i=h.next()){var j=i.value;b.matchesState(j,d)&&(!g||d.length>g.length)&&(g=j)}}catch(a){e={error:a}}finally{try{i&&!i.done&&(f=h["return"])&&f.call(h)}finally{if(e)throw e.error}}return c[g]}v.mapState=c}var y=!1;function z(){y||(y=!0,x());return w.exports}var A={},B={exports:A};function C(){Object.defineProperty(A,"__esModule",{value:!0}),A.SpecialTargets=A.ActionTypes=void 0,(function(a){a.Start="xstate.start",a.Stop="xstate.stop",a.Raise="xstate.raise",a.Send="xstate.send",a.Cancel="xstate.cancel",a.NullEvent="",a.Assign="xstate.assign",a.After="xstate.after",a.DoneState="done.state",a.DoneInvoke="done.invoke",a.Log="xstate.log",a.Init="xstate.init",a.Invoke="xstate.invoke",a.ErrorExecution="error.execution",a.ErrorCommunication="error.communication",a.ErrorPlatform="error.platform",a.ErrorCustom="xstate.error",a.Update="xstate.update",a.Pure="xstate.pure",a.Choose="xstate.choose"})(A.ActionTypes||(A.ActionTypes={})),(function(a){a.Parent="#_parent",a.Internal="#_internal"})(A.SpecialTargets||(A.SpecialTargets={}))}var D=!1;function E(){D||(D=!0,C());return B.exports}var F={},G={exports:F};function H(){var a=this&&this.__values||function(a){var b=typeof Symbol==="function"&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&typeof a.length==="number")return{next:function(){a&&d>=a.length&&(a=void 0);return{value:a&&a[d++],done:!a}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")},b=this&&this.__read||function(a,b){var c=typeof Symbol==="function"&&a[Symbol.iterator];if(!c)return a;a=c.call(a);var d,e=[],f;try{while((b===void 0||b-->0)&&!(d=a.next()).done)e.push(d.value)}catch(a){f={error:a}}finally{try{d&&!d.done&&(c=a["return"])&&c.call(a)}finally{if(f)throw f.error}}return e},c=this&&this.__spread||function(){for(var a=[],c=0;c<arguments.length;c++)a=a.concat(b(arguments[c]));return a};Object.defineProperty(F,"__esModule",{value:!0});F.isInFinalState=F.nextEvents=F.has=F.getValue=F.getAdjList=F.getConfiguration=F.getAllStateNodes=F.getChildren=F.isLeafNode=void 0;var d=u(),e=function(a){return a.type==="atomic"||a.type==="final"};F.isLeafNode=e;function f(a){return d.keys(a.states).map(function(b){return a.states[b]})}F.getChildren=f;function g(a){var b=[a];return F.isLeafNode(a)?b:b.concat(d.flatten(f(a).map(g)))}F.getAllStateNodes=g;function h(b,c){var d,e,g,h,i,k,l,m;b=new Set(b);b=j(b);var n=new Set(c);try{for(var c=a(n),o=c.next();!o.done;o=c.next()){var p=o.value,q=p.parent;while(q&&!n.has(q))n.add(q),q=q.parent}}catch(a){d={error:a}}finally{try{o&&!o.done&&(e=c["return"])&&e.call(c)}finally{if(d)throw d.error}}o=j(n);try{for(var c=a(n),r=c.next();!r.done;r=c.next()){var p=r.value;if(p.type==="compound"&&(!o.get(p)||!o.get(p).length))b.get(p)?b.get(p).forEach(function(a){return n.add(a)}):p.initialStateNodes.forEach(function(a){return n.add(a)});else if(p.type==="parallel")try{for(var s=(i=void 0,a(f(p))),t=s.next();!t.done;t=s.next()){var u=t.value;if(u.type==="history")continue;n.has(u)||(n.add(u),b.get(u)?b.get(u).forEach(function(a){return n.add(a)}):u.initialStateNodes.forEach(function(a){return n.add(a)}))}}catch(a){i={error:a}}finally{try{t&&!t.done&&(k=s["return"])&&k.call(s)}finally{if(i)throw i.error}}}}catch(a){g={error:a}}finally{try{r&&!r.done&&(h=c["return"])&&h.call(c)}finally{if(g)throw g.error}}try{for(var u=a(n),t=u.next();!t.done;t=u.next()){var p=t.value,q=p.parent;while(q&&!n.has(q))n.add(q),q=q.parent}}catch(a){l={error:a}}finally{try{t&&!t.done&&(m=u["return"])&&m.call(u)}finally{if(l)throw l.error}}return n}F.getConfiguration=h;function i(a,b){var c=b.get(a);if(!c)return{};if(a.type==="compound"){a=c[0];if(a){if(F.isLeafNode(a))return a.key}else return{}}var d={};c.forEach(function(a){d[a.key]=i(a,b)});return d}function j(b){var c,d,e=new Map();try{for(var b=a(b),f=b.next();!f.done;f=b.next()){var g=f.value;e.has(g)||e.set(g,[]);g.parent&&(e.has(g.parent)||e.set(g.parent,[]),e.get(g.parent).push(g))}}catch(a){c={error:a}}finally{try{f&&!f.done&&(d=b["return"])&&d.call(b)}finally{if(c)throw c.error}}return e}F.getAdjList=j;function k(a,b){b=h([a],b);return i(a,j(b))}F.getValue=k;function l(a,b){if(Array.isArray(a))return a.some(function(a){return a===b});return a instanceof Set?a.has(b):!1}F.has=l;function m(a){return d.flatten(c(new Set(a.map(function(a){return a.ownEvents}))))}F.nextEvents=m;function n(a,b){if(b.type==="compound")return f(b).some(function(b){return b.type==="final"&&l(a,b)});return b.type==="parallel"?f(b).every(function(b){return n(a,b)}):!1}F.isInFinalState=n}var I=!1;function J(){I||(I=!0,H());return G.exports}var K={},aa={exports:K};function L(){Object.defineProperty(K,"__esModule",{value:!0});K.pure=K.choose=K.update=K.error=K.errorPlatform=K.errorExecution=K.invoke=K.init=K.log=K.doneState=K.after=K.assign=K.nullEvent=K.cancel=K.send=K.raise=K.stop=K.start=void 0;var a=E();K.start=a.ActionTypes.Start;K.stop=a.ActionTypes.Stop;K.raise=a.ActionTypes.Raise;K.send=a.ActionTypes.Send;K.cancel=a.ActionTypes.Cancel;K.nullEvent=a.ActionTypes.NullEvent;K.assign=a.ActionTypes.Assign;K.after=a.ActionTypes.After;K.doneState=a.ActionTypes.DoneState;K.log=a.ActionTypes.Log;K.init=a.ActionTypes.Init;K.invoke=a.ActionTypes.Invoke;K.errorExecution=a.ActionTypes.ErrorExecution;K.errorPlatform=a.ActionTypes.ErrorPlatform;K.error=a.ActionTypes.ErrorCustom;K.update=a.ActionTypes.Update;K.choose=a.ActionTypes.Choose;K.pure=a.ActionTypes.Pure}var M=!1;function N(){M||(M=!0,L());return aa.exports}var O={},ba={exports:O};function ca(){var a=this&&this.__assign||function(){a=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};return a.apply(this,arguments)},b=this&&this.__read||function(a,b){var c=typeof Symbol==="function"&&a[Symbol.iterator];if(!c)return a;a=c.call(a);var d,e=[],f;try{while((b===void 0||b-->0)&&!(d=a.next()).done)e.push(d.value)}catch(a){f={error:a}}finally{try{d&&!d.done&&(c=a["return"])&&c.call(a)}finally{if(f)throw f.error}}return e};Object.defineProperty(O,"__esModule",{value:!0});O.resolveActions=O.choose=O.escalate=O.forwardTo=O.pure=O.error=O.doneInvoke=O.done=O.after=O.isActionObject=O.assign=O.resolveStop=O.stop=O.start=O.cancel=O.resolveLog=O.log=O.respond=O.sendUpdate=O.sendParent=O.resolveSend=O.send=O.resolveRaise=O.raise=O.toActivityDefinition=O.toActionObjects=O.toActionObject=O.getActionFunction=O.initEvent=O.actionTypes=void 0;var c=E(),d=N();O.actionTypes=d;var e=u(),f=p();O.initEvent=e.toSCXMLEvent({type:d.init});function g(a,b){return b?b[a]||void 0:void 0}O.getActionFunction=g;function h(b,c){var d;if(e.isString(b)||typeof b==="number"){var f=g(b,c);e.isFunction(f)?d={type:b,exec:f}:f?d=f:d={type:b,exec:void 0}}else if(e.isFunction(b))d={type:b.name||b.toString(),exec:b};else{var f=g(b.type,c);if(e.isFunction(f))d=a(a({},b),{exec:f});else if(f){c=f.type||b.type;d=a(a(a({},f),b),{type:c})}else d=b}Object.defineProperty(d,"toString",{value:function(){return d.type},enumerable:!1,configurable:!0});return d}O.toActionObject=h;var i=function(a,b){if(!a)return[];a=e.isArray(a)?a:[a];return a.map(function(a){return h(a,b)})};O.toActionObjects=i;function j(b){var c=h(b);return a(a({id:e.isString(b)?b:c.id},c),{type:c.type})}O.toActivityDefinition=j;function k(a){return!e.isString(a)?m(a,{to:c.SpecialTargets.Internal}):{type:d.raise,event:a}}O.raise=k;function l(a){return{type:d.raise,_event:e.toSCXMLEvent(a.event)}}O.resolveRaise=l;function m(a,b){return{to:b?b.to:void 0,type:d.send,event:e.isFunction(a)?a:e.toEventObject(a),delay:b?b.delay:void 0,id:b&&b.id!==void 0?b.id:e.isFunction(a)?a.name:e.getEventType(a)}}O.send=m;function n(b,c,d,f){var g={_event:d},h=e.toSCXMLEvent(e.isFunction(b.event)?b.event(c,d.data,g):b.event);if(e.isString(b.delay)){f=f&&f[b.delay];f=e.isFunction(f)?f(c,d.data,g):f}else f=e.isFunction(b.delay)?b.delay(c,d.data,g):b.delay;c=e.isFunction(b.to)?b.to(c,d.data,g):b.to;return a(a({},b),{to:c,_event:h,event:h.data,delay:f})}O.resolveSend=n;function o(b,d){return m(b,a(a({},d),{to:c.SpecialTargets.Parent}))}O.sendParent=o;function q(){return o(d.update)}O.sendUpdate=q;function r(b,c){return m(b,a(a({},c),{to:function(a,b,c){a=c._event;return a.origin}}))}O.respond=r;var s=function(a,b){return{context:a,event:b}};function t(a,b){a===void 0&&(a=s);return{type:d.log,label:b,expr:a}}O.log=t;i=function(b,c,d){return a(a({},b),{value:e.isString(b.expr)?b.expr:b.expr(c,d.data,{_event:d})})};O.resolveLog=i;k=function(a){return{type:d.cancel,sendId:a}};O.cancel=k;function v(a){a=j(a);return{type:c.ActionTypes.Start,activity:a,exec:void 0}}O.start=v;function w(a){a=e.isFunction(a)?a:j(a);return{type:c.ActionTypes.Stop,activity:a,exec:void 0}}O.stop=w;function x(a,b,d){b=e.isFunction(a.activity)?a.activity(b,d.data):a.activity;d=typeof b==="string"?{id:b}:b;a={type:c.ActionTypes.Stop,activity:d};return a}O.resolveStop=x;q=function(a){return{type:d.assign,assignment:a}};O.assign=q;function y(a){return typeof a==="object"&&"type"in a}O.isActionObject=y;function z(a,b){b=b?"#"+b:"";return c.ActionTypes.After+"("+a+")"+b}O.after=z;function A(a,b){var d=c.ActionTypes.DoneState+"."+a;a={type:d,data:b};a.toString=function(){return d};return a}O.done=A;function B(a,b){var d=c.ActionTypes.DoneInvoke+"."+a;a={type:d,data:b};a.toString=function(){return d};return a}O.doneInvoke=B;function C(a,b){var d=c.ActionTypes.ErrorPlatform+"."+a;a={type:d,data:b};a.toString=function(){return d};return a}O.error=C;function D(a){return{type:c.ActionTypes.Pure,get:a}}O.pure=D;function F(b,c){return m(function(a,b){return b},a(a({},c),{to:b}))}O.forwardTo=F;function G(b,f){return o(function(a,c,f){return{type:d.error,data:e.isFunction(b)?b(a,c,f):b}},a(a({},f),{to:c.SpecialTargets.Parent}))}O.escalate=G;function H(a){return{type:c.ActionTypes.Choose,conds:a}}O.choose=H;function I(a,c,g,i,j){j=b(e.partition(j,function(a){return a.type===d.assign}),2);var k=j[0];j=j[1];var m=k.length?e.updateContext(g,i,k,c):g;k=e.flatten(j.map(function(b){switch(b.type){case d.raise:return l(b);case d.send:var g=n(b,m,i,a.options.delays);f.IS_PRODUCTION||e.warn(!e.isString(b.delay)||typeof g.delay==="number","No delay reference for delay expression '"+b.delay+"' was found on machine '"+a.id+"'");return g;case d.log:return O.resolveLog(b,m,i);case d.choose:g=b;g=(g=g.conds.find(function(b){b=e.toGuard(b.cond,a.options.guards);return!b||e.evaluateGuard(a,b,m,i,c)}))===null||g===void 0?void 0:g.actions;if(!g)return[];var j=I(a,c,m,i,O.toActionObjects(e.toArray(g),a.options.actions));m=j[1];return j[0];case d.pure:g=b.get(m,i.data);if(!g)return[];var j=I(a,c,m,i,O.toActionObjects(e.toArray(g),a.options.actions));m=j[1];return j[0];case d.stop:return x(b,m,i);default:return h(b,a.options.actions)}}));return[k,m]}O.resolveActions=I}var P=!1;function Q(){P||(P=!0,ca());return ba.exports}var R={},da={exports:R};function ea(){var a=this&&this.__assign||function(){a=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};return a.apply(this,arguments)},b=this&&this.__rest||function(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0&&(c[d]=a[d]);if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c},c=this&&this.__read||function(a,b){var c=typeof Symbol==="function"&&a[Symbol.iterator];if(!c)return a;a=c.call(a);var d,e=[],f;try{while((b===void 0||b-->0)&&!(d=a.next()).done)e.push(d.value)}catch(a){f={error:a}}finally{try{d&&!d.done&&(c=a["return"])&&c.call(a)}finally{if(f)throw f.error}}return e},d=this&&this.__spread||function(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(c(arguments[b]));return a};Object.defineProperty(R,"__esModule",{value:!0});R.State=R.bindActionToState=R.isState=R.stateValuesEqual=void 0;var e=k(),f=u(),g=J(),h=Q();function i(a,b){if(a===b)return!0;if(a===void 0||b===void 0)return!1;if(f.isString(a)||f.isString(b))return a===b;var c=f.keys(a),d=f.keys(b);return c.length===d.length&&c.every(function(c){return i(a[c],b[c])})}R.stateValuesEqual=i;function j(a){return f.isString(a)?!1:"value"in a&&"history"in a}R.isState=j;function l(b,c){var d=b.exec,e=a(a({},b),{exec:d!==void 0?function(){return d(c.context,c.event,{action:b,state:c,_event:c._event})}:void 0});return e}R.bindActionToState=l;j=function(){function a(a){var b=this;this.actions=[];this.activities=e.EMPTY_ACTIVITY_MAP;this.meta={};this.events=[];this.value=a.value;this.context=a.context;this._event=a._event;this._sessionid=a._sessionid;this.event=this._event.data;this.historyValue=a.historyValue;this.history=a.history;this.actions=a.actions||[];this.activities=a.activities||e.EMPTY_ACTIVITY_MAP;this.meta=a.meta||{};this.events=a.events||[];this.matches=this.matches.bind(this);this.toStrings=this.toStrings.bind(this);this.configuration=a.configuration;this.transitions=a.transitions;this.children=a.children;this.done=!!a.done;Object.defineProperty(this,"nextEvents",{get:function(){return g.nextEvents(b.configuration)}})}a.from=function(b,c){if(b instanceof a)return b.context!==c?new a({value:b.value,context:c,_event:b._event,_sessionid:null,historyValue:b.historyValue,history:b.history,actions:[],activities:b.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):b;var d=h.initEvent;return new a({value:b,context:c,_event:d,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})};a.create=function(b){return new a(b)};a.inert=function(b,c){if(b instanceof a){if(!b.actions.length)return b;var d=h.initEvent;return new a({value:b.value,context:c,_event:d,_sessionid:null,historyValue:b.historyValue,history:b.history,activities:b.activities,configuration:b.configuration,transitions:[],children:{}})}return a.from(b,c)};a.prototype.toStrings=function(a,b){var c=this;a===void 0&&(a=this.value);b===void 0&&(b=".");if(f.isString(a))return[a];var e=f.keys(a);return e.concat.apply(e,d(e.map(function(d){return c.toStrings(a[d],b).map(function(a){return d+b+a})})))};a.prototype.toJSON=function(){var a=this;a.configuration;a.transitions;a=b(a,["configuration","transitions"]);return a};a.prototype.matches=function(a){return f.matchesState(a,this.value)};return a}();R.State=j}var fa=!1;function S(){fa||(fa=!0,ea());return da.exports}var T={},ga={exports:T};function ha(){Object.defineProperty(T,"__esModule",{value:!0});T.consume=T.provide=void 0;var a=[],b=function(b,c){a.push(b);c=c(b);a.pop();return c};T.provide=b;b=function(b){return b(a[a.length-1])};T.consume=b}var ia=!1;function ja(){ia||(ia=!0,ha());return ga.exports}var U={},ka={exports:U};function la(){Object.defineProperty(U,"__esModule",{value:!0});U.isSpawnedActor=U.isActor=U.createDeferredActor=U.createInvocableActor=U.createNullActor=void 0;var a=u(),b=ja();function c(a){return{id:a,send:function(){return void 0},subscribe:function(){return{unsubscribe:function(){return void 0}}},toJSON:function(){return{id:a}}}}U.createNullActor=c;function d(b,d,f,g){var h=a.toInvokeSource(b.src);d=(d=d===null||d===void 0?void 0:d.options.services)===null||d===void 0?void 0:d[h.type];h=b.data?a.mapContext(b.data,f,g):void 0;f=d?e(d,b.id,h):c(b.id);f.meta=b;return f}U.createInvocableActor=d;function e(d,e,f){e=c(e);e.deferred=!0;a.isMachine(d)&&(e.state=b.provide(void 0,function(){return(f?d.withContext(f):d).initialState}));return e}U.createDeferredActor=e;function f(a){try{return typeof a.send==="function"}catch(a){return!1}}U.isActor=f;function g(a){return f(a)&&"id"in a}U.isSpawnedActor=g}var ma=!1;function na(){ma||(ma=!0,la());return ka.exports}var V={},oa={exports:V};function pa(){var a=this&&this.__assign||function(){a=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};return a.apply(this,arguments)},b=this&&this.__rest||function(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0&&(c[d]=a[d]);if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c};Object.defineProperty(V,"__esModule",{value:!0});V.toInvokeDefinition=V.toInvokeSource=void 0;var c=Q();function d(a){if(typeof a==="string"){var b={type:a};b.toString=function(){return a};return b}return a}V.toInvokeSource=d;function e(e){return a(a({type:c.actionTypes.invoke},e),{toJSON:function(){e.onDone;e.onError;var f=b(e,["onDone","onError"]);return a(a({},f),{type:c.actionTypes.invoke,src:d(e.src)})}})}V.toInvokeDefinition=e}var qa=!1;function ra(){qa||(qa=!0,pa());return oa.exports}var W={},sa={exports:W};function ta(){var a=this&&this.__assign||function(){a=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};return a.apply(this,arguments)},b=this&&this.__rest||function(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0&&(c[d]=a[d]);if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c},c=this&&this.__read||function(a,b){var c=typeof Symbol==="function"&&a[Symbol.iterator];if(!c)return a;a=c.call(a);var d,e=[],f;try{while((b===void 0||b-->0)&&!(d=a.next()).done)e.push(d.value)}catch(a){f={error:a}}finally{try{d&&!d.done&&(c=a["return"])&&c.call(a)}finally{if(f)throw f.error}}return e},d=this&&this.__spread||function(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(c(arguments[b]));return a},e=this&&this.__values||function(a){var b=typeof Symbol==="function"&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&typeof a.length==="number")return{next:function(){a&&d>=a.length&&(a=void 0);return{value:a&&a[d++],done:!a}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(W,"__esModule",{value:!0});W.StateNode=void 0;var f=u(),g=E(),h=u(),i=S(),j=N(),l=Q(),m=p(),n=k(),o=J(),q=na(),r=ra(),s="",t="#",v="*",w={},x=function(a){return a[0]===t},y=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},z=function(a,b,c){c=c.slice(0,-1).some(function(a){return!("cond"in a)&&!("in"in a)&&(f.isString(a.target)||f.isMachine(a.target))});b=b===s?"the transient event":"event '"+b+"'";f.warn(!c,"One or more transitions for "+b+" on state '"+a.id+"' are unreachable. Make sure that the default transition is the last one defined.")},A=function(){function k(b,c,g){var h=this;this.config=b;this.context=g;this.order=-1;this.__xstatenode=!0;this.__cache={events:void 0,relativeValue:new Map(),initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0};this.idMap={};this.options=Object.assign(y(),c);this.parent=this.options._parent;this.key=this.config.key||this.options._key||this.config.id||"(machine)";this.machine=this.parent?this.parent.machine:this;this.path=this.parent?this.parent.path.concat(this.key):[];this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:n.STATE_DELIMITER);this.id=this.config.id||d([this.machine.key],this.path).join(this.delimiter);this.version=this.parent?this.parent.version:this.config.version;this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&f.keys(this.config.states).length?"compound":this.config.history?"history":"atomic");m.IS_PRODUCTION||f.warn(!("parallel"in this.config),'The "parallel" property is deprecated and will be removed in version 4.1. '+(this.config.parallel?"Replace with `type: 'parallel'`":"Use `type: '"+this.type+"'`")+" in the config for state node '"+this.id+"' instead.");this.initial=this.config.initial;this.states=this.config.states?f.mapValues(this.config.states,function(b,c){b=new k(b,{_parent:h,_key:c});Object.assign(h.idMap,a((c={},c[b.id]=b,c),b.idMap));return b}):w;var i=0;function j(a){var b,c;a.order=i++;try{for(var a=e(o.getChildren(a)),d=a.next();!d.done;d=a.next()){var f=d.value;j(f)}}catch(a){b={error:a}}finally{try{d&&!d.done&&(c=a["return"])&&c.call(a)}finally{if(b)throw b.error}}}j(this);this.history=this.config.history===!0?"shallow":this.config.history||!1;this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(a){a=a.event;return a===s}):s in this.config.on:!1);this.strict=!!this.config.strict;this.onEntry=f.toArray(this.config.entry||this.config.onEntry).map(function(a){return l.toActionObject(a)});this.onExit=f.toArray(this.config.exit||this.config.onExit).map(function(a){return l.toActionObject(a)});this.meta=this.config.meta;this.doneData=this.type==="final"?this.config.data:void 0;this.invoke=f.toArray(this.config.invoke).map(function(b,c){var d;if(f.isMachine(b)){h.machine.options.services=a((d={},d[b.id]=b,d),h.machine.options.services);return r.toInvokeDefinition({src:b.id,id:b.id})}else if(f.isString(b.src))return r.toInvokeDefinition(a(a({},b),{id:b.id||b.src,src:b.src}));else if(f.isMachine(b.src)||f.isFunction(b.src)){d=h.id+":invocation["+c+"]";h.machine.options.services=a((c={},c[d]=b.src,c),h.machine.options.services);return r.toInvokeDefinition(a(a({id:d},b),{src:d}))}else{c=b.src;return r.toInvokeDefinition(a(a({id:c.type},b),{src:c}))}});this.activities=f.toArray(this.config.activities).concat(this.invoke).map(function(a){return l.toActivityDefinition(a)});this.transition=this.transition.bind(this)}k.prototype._init=function(){if(this.__cache.transitions)return;o.getAllStateNodes(this).forEach(function(a){return a.on})};k.prototype.withConfig=function(b,c){c===void 0&&(c=this.context);var d=this.options,e=d.actions,f=d.activities,g=d.guards,h=d.services;d=d.delays;return new k(this.config,{actions:a(a({},e),b.actions),activities:a(a({},f),b.activities),guards:a(a({},g),b.guards),services:a(a({},h),b.services),delays:a(a({},d),b.delays)},c)};k.prototype.withContext=function(a){return new k(this.config,this.options,a)};Object.defineProperty(k.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:f.mapValues(this.states,function(a){return a.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke}},enumerable:!1,configurable:!0});k.prototype.toJSON=function(){return this.definition};Object.defineProperty(k.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var a=this.transitions;return this.__cache.on=a.reduce(function(a,b){a[b.eventType]=a[b.eventType]||[];a[b.eventType].push(b);return a},{})},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0});k.prototype.getCandidates=function(a){if(this.__cache.candidates[a])return this.__cache.candidates[a];var b=a===s,c=this.transitions.filter(function(c){var d=c.eventType===a;return b?d:d||c.eventType===v});this.__cache.candidates[a]=c;return c};k.prototype.getDelayedTransitions=function(){var b=this,c=this.config.after;if(!c)return[];var d=function(a,c){c=f.isFunction(a)?b.id+":delay["+c+"]":a;c=l.after(c,b.id);b.onEntry.push(l.send(c,{delay:a}));b.onExit.push(l.cancel(c));return c},e=f.isArray(c)?c.map(function(b,c){c=d(b.delay,c);return a(a({},b),{event:c})}):f.flatten(f.keys(c).map(function(b,e){var g=c[b];g=f.isString(g)?{target:g}:g;var h=isNaN(+b)?b:+b,i=d(h,e);return f.toArray(g).map(function(b){return a(a({},b),{event:i,delay:h})})}));return e.map(function(c){var d=c.delay;return a(a({},b.formatTransition(c)),{delay:d})})};k.prototype.getStateNodes=function(a){var b,c=this;if(!a)return[];var d=a instanceof i.State?a.value:f.toStateValue(a,this.delimiter);if(f.isString(d)){a=this.getStateNode(d).initial;return a!==void 0?this.getStateNodes((b={},b[d]=a,b)):[this.states[d]]}a=f.keys(d);b=a.map(function(a){return c.getStateNode(a)});return b.concat(a.reduce(function(a,b){b=c.getStateNode(b).getStateNodes(d[b]);return a.concat(b)},[]))};k.prototype.handles=function(a){a=f.getEventType(a);return this.events.includes(a)};k.prototype.resolveState=function(b){var c=Array.from(o.getConfiguration([],this.getStateNodes(b.value)));return new i.State(a(a({},b),{value:this.resolve(b.value),configuration:c,done:o.isInFinalState(c,this)}))};k.prototype.transitionLeafNode=function(a,b,c){a=this.getStateNode(a);a=a.next(b,c);return!a||!a.transitions.length?this.next(b,c):a};k.prototype.transitionCompoundNode=function(a,b,c){var d=f.keys(a),e=this.getStateNode(d[0]);e=e._transition(a[d[0]],b,c);return!e||!e.transitions.length?this.next(b,c):e};k.prototype.transitionParallelNode=function(a,b,c){var d,g,h={};try{for(var i=e(f.keys(a)),j=i.next();!j.done;j=i.next()){var k=j.value,l=a[k];if(!l)continue;var m=this.getStateNode(k);m=m._transition(l,b,c);m&&(h[k]=m)}}catch(a){d={error:a}}finally{try{j&&!j.done&&(g=i["return"])&&g.call(i)}finally{if(d)throw d.error}}l=f.keys(h).map(function(a){return h[a]});k=f.flatten(l.map(function(a){return a.transitions}));m=l.some(function(a){return a.transitions.length>0});if(!m)return this.next(b,c);a=f.flatten(l.map(function(a){return a.entrySet}));j=f.flatten(f.keys(h).map(function(a){return h[a].configuration}));return{transitions:k,entrySet:a,exitSet:f.flatten(l.map(function(a){return a.exitSet})),configuration:j,source:b,actions:f.flatten(f.keys(h).map(function(a){return h[a].actions}))}};k.prototype._transition=function(a,b,c){if(f.isString(a))return this.transitionLeafNode(a,b,c);return f.keys(a).length===1?this.transitionCompoundNode(a,b,c):this.transitionParallelNode(a,b,c)};k.prototype.next=function(a,b){var c,g,i=this,j=b.name,k=[],l=[],m;try{for(var n=e(this.getCandidates(j)),o=n.next();!o.done;o=n.next()){var p=o.value,q=p.cond,r=p["in"],s=a.context;r=r?f.isString(r)&&x(r)?a.matches(f.toStateValue(this.getStateNodeById(r).path,this.delimiter)):h.matchesState(f.toStateValue(r,this.delimiter),f.path(this.path.slice(0,-2))(a.value)):!0;var t=!1;try{t=!q||f.evaluateGuard(this.machine,q,s,b,a)}catch(a){throw new Error("Unable to evaluate guard '"+(q.name||q.type)+"' in transition for event '"+j+"' in state node '"+this.id+"':\n"+a.message)}if(t&&r){p.target!==void 0&&(l=p.target);k.push.apply(k,d(p.actions));m=p;break}}}catch(a){c={error:a}}finally{try{o&&!o.done&&(g=n["return"])&&g.call(n)}finally{if(c)throw c.error}}if(!m)return void 0;if(!l.length)return{transitions:[m],entrySet:[],exitSet:[],configuration:a.value?[this]:[],source:a,actions:k};s=f.flatten(l.map(function(b){return i.getRelativeStateNodes(b,a.historyValue)}));q=!!m.internal;t=q?[]:f.flatten(s.map(function(a){return i.nodesFromChild(a)}));return{transitions:[m],entrySet:t,exitSet:q?[]:[this],configuration:s,source:a,actions:k}};k.prototype.nodesFromChild=function(a){if(a.escapes(this))return[];var b=[];a=a;while(a&&a!==this)b.push(a),a=a.parent;b.push(this);return b};k.prototype.escapes=function(a){if(this===a)return!1;var b=this.parent;while(b){if(b===a)return!1;b=b.parent}return!0};k.prototype.getActions=function(a,b,g,h){var i,j,k,m;h=o.getConfiguration([],h?this.getStateNodes(h.value):[this]);var n=a.configuration.length?o.getConfiguration(h,a.configuration):h;try{for(var p=e(n),q=p.next();!q.done;q=p.next()){var r=q.value;o.has(h,r)||a.entrySet.push(r)}}catch(a){i={error:a}}finally{try{q&&!q.done&&(j=p["return"])&&j.call(p)}finally{if(i)throw i.error}}try{for(var q=e(h),p=q.next();!p.done;p=q.next()){var r=p.value;(!o.has(n,r)||o.has(a.exitSet,r.parent))&&a.exitSet.push(r)}}catch(a){k={error:a}}finally{try{p&&!p.done&&(m=q["return"])&&m.call(q)}finally{if(k)throw k.error}}a.source||(a.exitSet=[],a.entrySet.push(this));h=f.flatten(a.entrySet.map(function(c){var d=[];if(c.type!=="final")return d;var e=c.parent;if(!e.parent)return d;d.push(l.done(c.id,c.doneData),l.done(e.id,c.doneData?f.mapContext(c.doneData,b,g):void 0));c=e.parent;c.type==="parallel"&&(o.getChildren(c).every(function(b){return o.isInFinalState(a.configuration,b)})&&d.push(l.done(c.id)));return d}));a.exitSet.sort(function(a,b){return b.order-a.order});a.entrySet.sort(function(a,b){return a.order-b.order});n=new Set(a.entrySet);r=new Set(a.exitSet);p=c([f.flatten(Array.from(n).map(function(a){return d(a.activities.map(function(a){return l.start(a)}),a.onEntry)})).concat(h.map(l.raise)),f.flatten(Array.from(r).map(function(a){return d(a.onExit,a.activities.map(function(a){return l.stop(a)}))}))],2);q=p[0];n=p[1];h=l.toActionObjects(n.concat(a.actions).concat(q),this.machine.options.actions);return h};k.prototype.transition=function(a,b,c){a===void 0&&(a=this.initialState);b=f.toSCXMLEvent(b);var e;if(a instanceof i.State)e=c===void 0?a:this.resolveState(i.State.from(a,c));else{a=f.isString(a)?this.resolve(f.pathToStateValue(this.getResolvedPath(a))):this.resolve(a);c=c?c:this.machine.context;e=this.resolveState(i.State.from(a,c))}if(!m.IS_PRODUCTION&&b.name===v)throw new Error("An event cannot have the wildcard type ('"+v+"')");if(this.strict&&(!this.events.includes(b.name)&&!f.isBuiltInEvent(b.name)))throw new Error("Machine '"+this.id+"' does not accept event '"+b.name+"'");a=this._transition(e.value,e,b)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:e,actions:[]};c=o.getConfiguration([],this.getStateNodes(e.value));c=a.configuration.length?o.getConfiguration(c,a.configuration):c;a.configuration=d(c);return this.resolveTransition(a,e,b)};k.prototype.resolveRaisedTransition=function(a,b,c){var e=a.actions;a=this.transition(a,b);a._event=c;a.event=c.data;(b=a.actions).unshift.apply(b,d(e));return a};k.prototype.resolveTransition=function(b,d,h,k){var m,n,p=this;h===void 0&&(h=l.initEvent);k===void 0&&(k=this.machine.context);var r=b.configuration,s=!d||b.transitions.length>0;s=s?o.getValue(this.machine,r):void 0;var t=d?d.historyValue?d.historyValue:b.source?this.machine.historyValue(d.value):void 0:void 0;k=d?d.context:k;var u=this.getActions(b,k,h,d),v=d?a({},d.activities):{};try{for(var w=e(u),x=w.next();!x.done;x=w.next()){var y=x.value;y.type===j.start?v[y.activity.id||y.activity.type]=y:y.type===j.stop&&(v[y.activity.id||y.activity.type]=!1)}}catch(a){m={error:a}}finally{try{x&&!x.done&&(n=w["return"])&&n.call(w)}finally{if(m)throw m.error}}y=c(l.resolveActions(this,d,k,h,u),2);x=y[0];var z=y[1];w=c(f.partition(x,function(a){return a.type===j.raise||a.type===j.send&&a.to===g.SpecialTargets.Internal}),2);u=w[0];y=w[1];w=x.filter(function(a){return a.type===j.start&&((a=a.activity)===null||a===void 0?void 0:a.type)===j.invoke});x=w.reduce(function(b,a){b[a.activity.id]=q.createInvocableActor(a.activity,p.machine,z,h);return b},d?a({},d.children):{});w=s?b.configuration:d?d.configuration:[];var A=w.reduce(function(a,b){b.meta!==void 0&&(a[b.id]=b.meta);return a},{}),B=o.isInFinalState(w,this);t=new i.State({value:s||d.value,context:z,_event:h,_sessionid:d?d._sessionid:null,historyValue:s?t?f.updateHistoryValue(t,s):void 0:d?d.historyValue:void 0,history:!s||b.source?d:void 0,actions:s?y:[],activities:s?v:d?d.activities:{},meta:s?A:d?d.meta:void 0,events:[],configuration:w,transitions:b.transitions,children:x,done:B});y=k!==z;t.changed=h.name===j.update||y;v=t.history;v&&delete v.history;if(!s)return t;A=t;if(!B){d=this._transient||r.some(function(a){return a._transient});d&&(A=this.resolveRaisedTransition(A,{type:j.nullEvent},h));while(u.length){w=u.shift();A=this.resolveRaisedTransition(A,w._event,h)}}b=A.changed||(v?!!A.actions.length||y||typeof v.value!==typeof A.value||!i.stateValuesEqual(A.value,v.value):void 0);A.changed=b;A.history=v;return A};k.prototype.getStateNode=function(a){if(x(a))return this.machine.getStateNodeById(a);if(!this.states)throw new Error("Unable to retrieve child state '"+a+"' from '"+this.id+"'; no child states exist.");var b=this.states[a];if(!b)throw new Error("Child state '"+a+"' does not exist on '"+this.id+"'");return b};k.prototype.getStateNodeById=function(a){a=x(a)?a.slice(t.length):a;if(a===this.id)return this;var b=this.machine.idMap[a];if(!b)throw new Error("Child state node '#"+a+"' does not exist on machine '"+this.id+"'");return b};k.prototype.getStateNodeByPath=function(a){if(typeof a==="string"&&x(a))try{return this.getStateNodeById(a.slice(1))}catch(a){}a=f.toStatePath(a,this.delimiter).slice();var b=this;while(a.length){var c=a.shift();if(!c.length)break;b=b.getStateNode(c)}return b};k.prototype.resolve=function(a){var b,c=this;if(!a)return this.initialStateValue||w;switch(this.type){case"parallel":return f.mapValues(this.initialStateValue,function(b,d){return b?c.getStateNode(d).resolve(a[d]||b):w});case"compound":if(f.isString(a)){var d=this.getStateNode(a);return d.type==="parallel"||d.type==="compound"?(b={},b[a]=d.initialStateValue,b):a}return!f.keys(a).length?this.initialStateValue||{}:f.mapValues(a,function(a,b){return a?c.getStateNode(b).resolve(a):w});default:return a||w}};k.prototype.getResolvedPath=function(a){if(x(a)){var b=this.machine.idMap[a.slice(t.length)];if(!b)throw new Error("Unable to find state node '"+a+"'");return b.path}return f.toStatePath(a,this.delimiter)};Object.defineProperty(k.prototype,"initialStateValue",{get:function(){var a;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var b;if(this.type==="parallel")b=f.mapFilterValues(this.states,function(a){return a.initialStateValue||w},function(a){return!(a.type==="history")});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '"+this.initial+"' not found on '"+this.key+"'");b=o.isLeafNode(this.states[this.initial])?this.initial:(a={},a[this.initial]=this.states[this.initial].initialStateValue,a)}this.__cache.initialStateValue=b;return this.__cache.initialStateValue},enumerable:!1,configurable:!0});k.prototype.getInitialState=function(a,b){a=this.getStateNodes(a);return this.resolveTransition({configuration:a,entrySet:a,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,void 0,b)};Object.defineProperty(k.prototype,"initialState",{get:function(){this._init();var a=this.initialStateValue;if(!a)throw new Error("Cannot retrieve initial state from simple state '"+this.id+"'.");return this.getInitialState(a)},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"target",{get:function(){var a;if(this.type==="history"){var b=this.config;f.isString(b.target)?a=x(b.target)?f.pathToStateValue(this.machine.getStateNodeById(b.target).path.slice(this.path.length-1)):b.target:a=b.target}return a},enumerable:!1,configurable:!0});k.prototype.getRelativeStateNodes=function(a,b,c){c===void 0&&(c=!0);return c?a.type==="history"?a.resolveHistory(b):a.initialStateNodes:[a]};Object.defineProperty(k.prototype,"initialStateNodes",{get:function(){var a=this;if(o.isLeafNode(this))return[this];if(this.type==="compound"&&!this.initial){m.IS_PRODUCTION||f.warn(!1,"Compound state node '"+this.id+"' has no initial state.");return[this]}var b=f.toStatePaths(this.initialStateValue);return f.flatten(b.map(function(b){return a.getFromRelativePath(b)}))},enumerable:!1,configurable:!0});k.prototype.getFromRelativePath=function(a){if(!a.length)return[this];a=c(a);var b=a[0];a=a.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '"+b+"' from node with no states");var d=this.getStateNode(b);if(d.type==="history")return d.resolveHistory();if(!this.states[b])throw new Error("Child state '"+b+"' does not exist on '"+this.id+"'");return this.states[b].getFromRelativePath(a)};k.prototype.historyValue=function(a){return!f.keys(this.states).length?void 0:{current:a||this.initialStateValue,states:f.mapFilterValues(this.states,function(b,c){if(!a)return b.historyValue();c=f.isString(a)?void 0:a[c];return b.historyValue(c||b.initialStateValue)},function(a){return!a.history})}};k.prototype.resolveHistory=function(a){var b=this;if(this.type!=="history")return[this];var c=this.parent;if(!a){var d=this.target;return d?f.flatten(f.toStatePaths(d).map(function(a){return c.getFromRelativePath(a)})):c.initialStateNodes}d=f.nestedPath(c.path,"states")(a).current;return f.isString(d)?[c.getStateNode(d)]:f.flatten(f.toStatePaths(d).map(function(a){return b.history==="deep"?c.getFromRelativePath(a):[c.states[a[0]]]}))};Object.defineProperty(k.prototype,"stateIds",{get:function(){var a=this,b=f.flatten(f.keys(this.states).map(function(b){return a.states[b].stateIds}));return[this.id].concat(b)},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"events",{get:function(){var a,b,c,d;if(this.__cache.events)return this.__cache.events;var g=this.states,h=new Set(this.ownEvents);if(g)try{for(var i=e(f.keys(g)),j=i.next();!j.done;j=i.next()){var k=j.value;k=g[k];if(k.states)try{for(var k=(c=void 0,e(k.events)),l=k.next();!l.done;l=k.next()){var m=l.value;h.add(""+m)}}catch(a){c={error:a}}finally{try{l&&!l.done&&(d=k["return"])&&d.call(k)}finally{if(c)throw c.error}}}}catch(b){a={error:b}}finally{try{j&&!j.done&&(b=i["return"])&&b.call(i)}finally{if(a)throw a.error}}return this.__cache.events=Array.from(h)},enumerable:!1,configurable:!0});Object.defineProperty(k.prototype,"ownEvents",{get:function(){var a=new Set(this.transitions.filter(function(a){return!(!a.target&&!a.actions.length&&a.internal)}).map(function(a){return a.eventType}));return Array.from(a)},enumerable:!1,configurable:!0});k.prototype.resolveTarget=function(a){var b=this;return a===void 0?void 0:a.map(function(a){if(!f.isString(a))return a;var c=a[0]===b.delimiter;if(c&&!b.parent)return b.getStateNodeByPath(a.slice(1));c=c?b.key+a:a;if(b.parent)try{a=b.parent.getStateNodeByPath(c);return a}catch(a){throw new Error("Invalid transition definition for state node '"+b.id+"':\n"+a.message)}else return b.getStateNodeByPath(c)})};k.prototype.formatTransition=function(b){var c=this,d=f.normalizeTarget(b.target),e="internal"in b?b.internal:d?d.some(function(a){return f.isString(a)&&a[0]===c.delimiter}):!0,g=this.machine.options.guards;d=this.resolveTarget(d);var h=a(a({},b),{actions:l.toActionObjects(f.toArray(b.actions)),cond:f.toGuard(b.cond,g),target:d,source:this,internal:e,eventType:b.event,toJSON:function(){return a(a({},h),{target:h.target?h.target.map(function(a){return"#"+a.id}):void 0,source:"#"+c.id})}});return h};k.prototype.formatTransitions=function(){var a,c,g=this,h;if(!this.config.on)h=[];else if(Array.isArray(this.config.on))h=this.config.on;else{var i=this.config.on,j=v,k=i[j];k=k===void 0?[]:k;var n=b(i,[typeof j==="symbol"?j:j+""]);h=f.flatten(f.keys(n).map(function(a){!m.IS_PRODUCTION&&a===s&&f.warn(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+('Please check the `on` configuration for "#'+g.id+'".'));var b=f.toTransitionConfigArray(a,n[a]);m.IS_PRODUCTION||z(g,a,b);return b}).concat(f.toTransitionConfigArray(v,k)))}i=this.config.always?f.toTransitionConfigArray("",this.config.always):[];j=this.config.onDone?f.toTransitionConfigArray(String(l.done(this.id)),this.config.onDone):[];m.IS_PRODUCTION||f.warn(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'+this.id+'".');k=f.flatten(this.invoke.map(function(a){var b=[];a.onDone&&b.push.apply(b,d(f.toTransitionConfigArray(String(l.doneInvoke(a.id)),a.onDone)));a.onError&&b.push.apply(b,d(f.toTransitionConfigArray(String(l.error(a.id)),a.onError)));return b}));var o=this.after;j=f.flatten(d(j,k,h,i).map(function(a){return f.toArray(a).map(function(a){return g.formatTransition(a)})}));try{for(var k=e(o),h=k.next();!h.done;h=k.next()){i=h.value;j.push(i)}}catch(b){a={error:b}}finally{try{h&&!h.done&&(c=k["return"])&&c.call(k)}finally{if(a)throw a.error}}return j};return k}();W.StateNode=A}var ua=!1;function va(){ua||(ua=!0,ta());return sa.exports}var X={},wa={exports:X};function xa(){Object.defineProperty(X,"__esModule",{value:!0});X.createMachine=X.Machine=void 0;var a=va();function b(b,c,d){d===void 0&&(d=b.context);d=typeof d==="function"?d():d;return new a.StateNode(b,c,d)}X.Machine=b;function c(b,c){var d=typeof b.context==="function"?b.context():b.context;return new a.StateNode(b,c,d)}X.createMachine=c}var ya=!1;function za(){ya||(ya=!0,xa());return wa.exports}var Aa={},Ba={exports:Aa};function Ca(){var a=this&&this.__assign||function(){a=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};return a.apply(this,arguments)};Object.defineProperty(Aa,"__esModule",{value:!0});Aa.Scheduler=void 0;var b={deferEvents:!1},c=function(){function c(c){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=a(a({},b),c)}c.prototype.initialize=function(a){this.initialized=!0;if(a){if(!this.options.deferEvents){this.schedule(a);return}this.process(a)}this.flushEvents()};c.prototype.schedule=function(a){if(!this.initialized||this.processingEvent){this.queue.push(a);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(a);this.flushEvents()};c.prototype.clear=function(){this.queue=[]};c.prototype.flushEvents=function(){var a=this.queue.shift();while(a)this.process(a),a=this.queue.shift()};c.prototype.process=function(a){this.processingEvent=!0;try{a()}catch(a){this.clear();throw a}finally{this.processingEvent=!1}};return c}();Aa.Scheduler=c}var Da=!1;function Ea(){Da||(Da=!0,Ca());return Ba.exports}var Fa={},Ga={exports:Fa};function Ha(){Object.defineProperty(Fa,"__esModule",{value:!0});Fa.registry=void 0;var a=new Map(),b=0;Fa.registry={bookId:function(){return"x:"+b++},register:function(b,c){a.set(b,c);return b},get:function(b){return a.get(b)},free:function(b){a["delete"](b)}}}var Ia=!1;function Ja(){Ia||(Ia=!0,Ha());return Ga.exports}var Y={},Ka={exports:Y};function La(){Object.defineProperty(Y,"__esModule",{value:!0});Y.registerService=Y.getGlobal=void 0;var b=p();function c(){if(typeof self!=="undefined")return self;if(typeof window!=="undefined")return window;return typeof a!=="undefined"?a:void 0}Y.getGlobal=c;function d(){var b=c();return b&&"__xstate__"in b?b.__xstate__:void 0}function e(a){if(b.IS_PRODUCTION||!c())return;var e=d();e&&e.register(a)}Y.registerService=e}var Ma=!1;function Na(){Ma||(Ma=!0,La());return Ka.exports}var Z={},Oa={exports:Z};function Pa(){var b=this&&this.__assign||function(){b=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};return b.apply(this,arguments)},c=this&&this.__values||function(a){var b=typeof Symbol==="function"&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&typeof a.length==="number")return{next:function(){a&&d>=a.length&&(a=void 0);return{value:a&&a[d++],done:!a}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")},d=this&&this.__read||function(a,b){var c=typeof Symbol==="function"&&a[Symbol.iterator];if(!c)return a;a=c.call(a);var d,e=[],f;try{while((b===void 0||b-->0)&&!(d=a.next()).done)e.push(d.value)}catch(a){f={error:a}}finally{try{d&&!d.done&&(c=a["return"])&&c.call(a)}finally{if(f)throw f.error}}return e},e=this&&this.__spread||function(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(d(arguments[b]));return a};Object.defineProperty(Z,"__esModule",{value:!0});Z.interpret=Z.spawn=Z.Interpreter=Z.InterpreterStatus=void 0;var f=E(),g=S(),h=N(),i=Q(),j=p(),k=u(),l=Ea(),m=na(),n=J(),o=Ja(),q=Na(),r=ja(),s={sync:!1,autoForward:!1},t;(function(a){a[a.NotStarted=0]="NotStarted",a[a.Running=1]="Running",a[a.Stopped=2]="Stopped"})(t=Z.InterpreterStatus||(Z.InterpreterStatus={}));var v=function(){function d(a,c){var e=this;c===void 0&&(c=d.defaultOptions);this.machine=a;this.scheduler=new l.Scheduler();this.delayedEventsMap={};this.listeners=new Set();this.contextListeners=new Set();this.stopListeners=new Set();this.doneListeners=new Set();this.eventListeners=new Set();this.sendListeners=new Set();this.initialized=!1;this.status=t.NotStarted;this.children=new Map();this.forwardTo=new Set();this.init=this.start;this.send=function(a,b){if(k.isArray(a)){e.batch(a);return e.state}var c=k.toSCXMLEvent(k.toEventObject(a,b));if(e.status===t.Stopped){j.IS_PRODUCTION||k.warn(!1,'Event "'+c.name+'" was sent to stopped service "'+e.machine.id+'". This service has already reached its final state, and will not transition.\nEvent: '+JSON.stringify(c.data));return e.state}if(e.status!==t.Running&&!e.options.deferEvents)throw new Error('Event "'+c.name+'" was sent to uninitialized service "'+e.machine.id+'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\nEvent: '+JSON.stringify(c.data));e.scheduler.schedule(function(){e.forward(c);var a=e.nextState(c);e.update(a,c)});return e._state};this.sendTo=function(a,c){var d=e.parent&&(c===f.SpecialTargets.Parent||e.parent.id===c),g=d?e.parent:k.isString(c)?e.children.get(c)||o.registry.get(c):k.isActor(c)?c:void 0;if(!g){if(!d)throw new Error("Unable to send event to child '"+c+"' from service '"+e.id+"'.");j.IS_PRODUCTION||k.warn(!1,"Service '"+e.id+"' has no parent: unable to send event "+a.type);return}"machine"in g?g.send(b(b({},a),{name:a.name===h.error?""+i.error(e.id):a.name,origin:e.sessionId})):g.send(a.data)};c=b(b({},d.defaultOptions),c);var g=c.clock,m=c.logger,n=c.parent,p=c.id;p=p!==void 0?p:a.id;this.id=p;this.logger=m;this.clock=g;this.parent=n;this.options=c;this.scheduler=new l.Scheduler({deferEvents:this.options.deferEvents});this.sessionId=o.registry.bookId()}Object.defineProperty(d.prototype,"initialState",{get:function(){var a=this;return this._initialState?this._initialState:r.provide(this,function(){a._initialState=a.machine.initialState;return a._initialState})},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"state",{get:function(){j.IS_PRODUCTION||k.warn(this.status!==t.NotStarted,"Attempted to read state from uninitialized service '"+this.id+"'. Make sure the service is started first.");return this._state},enumerable:!1,configurable:!0});d.prototype.execute=function(a,b){var d,e;try{for(var f=c(a.actions),g=f.next();!g.done;g=f.next()){var h=g.value;this.exec(h,a,b)}}catch(a){d={error:a}}finally{try{g&&!g.done&&(e=f["return"])&&e.call(f)}finally{if(d)throw d.error}}};d.prototype.update=function(a,b){var d,e,f,g,h,j,l,m,o=this;a._sessionid=this.sessionId;this._state=a;this.options.execute&&this.execute(this.state);this.children.forEach(function(a){o.state.children[a.id]=a});this.devTools&&this.devTools.send(b.data,a);if(a.event)try{for(var p=c(this.eventListeners),q=p.next();!q.done;q=p.next()){var r=q.value;r(a.event)}}catch(a){d={error:a}}finally{try{q&&!q.done&&(e=p["return"])&&e.call(p)}finally{if(d)throw d.error}}try{for(var q=c(this.listeners),p=q.next();!p.done;p=q.next()){var r=p.value;r(a,a.event)}}catch(a){f={error:a}}finally{try{p&&!p.done&&(g=q["return"])&&g.call(q)}finally{if(f)throw f.error}}try{for(var p=c(this.contextListeners),q=p.next();!q.done;q=p.next()){var s=q.value;s(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(a){h={error:a}}finally{try{q&&!q.done&&(j=p["return"])&&j.call(p)}finally{if(h)throw h.error}}s=n.isInFinalState(a.configuration||[],this.machine);if(this.state.configuration&&s){q=a.configuration.find(function(a){return a.type==="final"&&a.parent===o.machine});p=q&&q.doneData?k.mapContext(q.doneData,a.context,b):void 0;try{for(var s=c(this.doneListeners),q=s.next();!q.done;q=s.next()){var r=q.value;r(i.doneInvoke(this.id,p))}}catch(a){l={error:a}}finally{try{q&&!q.done&&(m=s["return"])&&m.call(s)}finally{if(l)throw l.error}}this.stop()}};d.prototype.onTransition=function(a){this.listeners.add(a);this.status===t.Running&&a(this.state,this.state.event);return this};d.prototype.subscribe=function(a,b,c){var d=this;if(!a)return{unsubscribe:function(){return void 0}};var e,f=c;typeof a==="function"?e=a:(e=a.next.bind(a),f=a.complete.bind(a));this.listeners.add(e);this.status===t.Running&&e(this.state);f&&this.onDone(f);return{unsubscribe:function(){e&&d.listeners["delete"](e),f&&d.doneListeners["delete"](f)}}};d.prototype.onEvent=function(a){this.eventListeners.add(a);return this};d.prototype.onSend=function(a){this.sendListeners.add(a);return this};d.prototype.onChange=function(a){this.contextListeners.add(a);return this};d.prototype.onStop=function(a){this.stopListeners.add(a);return this};d.prototype.onDone=function(a){this.doneListeners.add(a);return this};d.prototype.off=function(a){this.listeners["delete"](a);this.eventListeners["delete"](a);this.sendListeners["delete"](a);this.stopListeners["delete"](a);this.doneListeners["delete"](a);this.contextListeners["delete"](a);return this};d.prototype.start=function(a){var b=this;if(this.status===t.Running)return this;o.registry.register(this.sessionId,this);this.initialized=!0;this.status=t.Running;var c=a===void 0?this.initialState:r.provide(this,function(){return g.isState(a)?b.machine.resolveState(a):b.machine.resolveState(g.State.from(a,b.machine.context))});this.options.devTools&&this.attachDev();this.scheduler.initialize(function(){b.update(c,i.initEvent)});return this};d.prototype.stop=function(){var a,b,d,e,f,g,h,i,j,l,m=this;try{for(var n=c(this.listeners),p=n.next();!p.done;p=n.next()){var q=p.value;this.listeners["delete"](q)}}catch(b){a={error:b}}finally{try{p&&!p.done&&(b=n["return"])&&b.call(n)}finally{if(a)throw a.error}}try{for(var p=c(this.stopListeners),n=p.next();!n.done;n=p.next()){var q=n.value;q();this.stopListeners["delete"](q)}}catch(a){d={error:a}}finally{try{n&&!n.done&&(e=p["return"])&&e.call(p)}finally{if(d)throw d.error}}try{for(var n=c(this.contextListeners),p=n.next();!p.done;p=n.next()){var q=p.value;this.contextListeners["delete"](q)}}catch(a){f={error:a}}finally{try{p&&!p.done&&(g=n["return"])&&g.call(n)}finally{if(f)throw f.error}}try{for(var p=c(this.doneListeners),n=p.next();!n.done;n=p.next()){var q=n.value;this.doneListeners["delete"](q)}}catch(a){h={error:a}}finally{try{n&&!n.done&&(i=p["return"])&&i.call(p)}finally{if(h)throw h.error}}this.state.configuration.forEach(function(d){var e,a;try{for(var d=c(d.definition.exit),b=d.next();!b.done;b=d.next()){var f=b.value;m.exec(f,m.state)}}catch(a){e={error:a}}finally{try{b&&!b.done&&(a=d["return"])&&a.call(d)}finally{if(e)throw e.error}}});this.children.forEach(function(a){k.isFunction(a.stop)&&a.stop()});try{for(var q=c(k.keys(this.delayedEventsMap)),n=q.next();!n.done;n=q.next()){p=n.value;this.clock.clearTimeout(this.delayedEventsMap[p])}}catch(a){j={error:a}}finally{try{n&&!n.done&&(l=q["return"])&&l.call(q)}finally{if(j)throw j.error}}this.scheduler.clear();this.initialized=!1;this.status=t.Stopped;o.registry.free(this.sessionId);return this};d.prototype.batch=function(a){var b=this;if(this.status===t.NotStarted&&this.options.deferEvents)j.IS_PRODUCTION||k.warn(!1,a.length+' event(s) were sent to uninitialized service "'+this.machine.id+'" and are deferred. Make sure .start() is called for this service.\nEvent: '+JSON.stringify(event));else if(this.status!==t.Running)throw new Error(a.length+' event(s) were sent to uninitialized service "'+this.machine.id+'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.');this.scheduler.schedule(function(){var d,f,h=b.state,i=!1,j=[],l=function(a){var c=k.toSCXMLEvent(a);b.forward(c);h=r.provide(b,function(){return b.machine.transition(h,c)});j.push.apply(j,e(h.actions.map(function(a){return g.bindActionToState(a,h)})));i=i||!!h.changed};try{for(var m=c(a),n=m.next();!n.done;n=m.next()){var o=n.value;l(o)}}catch(a){d={error:a}}finally{try{n&&!n.done&&(f=m["return"])&&f.call(m)}finally{if(d)throw d.error}}h.changed=i;h.actions=j;b.update(h,k.toSCXMLEvent(a[a.length-1]))})};d.prototype.sender=function(a){return this.send.bind(this,a)};d.prototype.nextState=function(a){var b=this,c=k.toSCXMLEvent(a);if(c.name.indexOf(h.errorPlatform)===0&&!this.state.nextEvents.some(function(a){return a.indexOf(h.errorPlatform)===0}))throw c.data.data;a=r.provide(this,function(){return b.machine.transition(b.state,c)});return a};d.prototype.forward=function(a){var b,d;try{for(var e=c(this.forwardTo),f=e.next();!f.done;f=e.next()){var g=f.value,h=this.children.get(g);if(!h)throw new Error("Unable to forward event '"+a+"' from interpreter '"+this.id+"' to nonexistant child '"+g+"'.");h.send(a)}}catch(a){b={error:a}}finally{try{f&&!f.done&&(d=e["return"])&&d.call(e)}finally{if(b)throw b.error}}};d.prototype.defer=function(a){var b=this;this.delayedEventsMap[a.id]=this.clock.setTimeout(function(){a.to?b.sendTo(a._event,a.to):b.send(a._event)},a.delay)};d.prototype.cancel=function(a){this.clock.clearTimeout(this.delayedEventsMap[a]),delete this.delayedEventsMap[a]};d.prototype.exec=function(a,b,c){c===void 0&&(c=this.machine.options.actions);var d=b.context;b=b._event;c=a.exec||i.getActionFunction(a.type,c);c=k.isFunction(c)?c:c?c.exec:a.exec;if(c)try{return c(d,b.data,{action:a,state:this.state,_event:b})}catch(a){this.parent&&this.parent.send({type:"xstate.error",data:a});throw a}switch(a.type){case h.send:c=a;if(typeof c.delay==="number"){this.defer(c);return}else c.to?this.sendTo(c._event,c.to):this.send(c._event);break;case h.cancel:this.cancel(a.sendId);break;case h.start:c=a.activity;if(!this.state.activities[c.id||c.type])break;if(c.type===f.ActionTypes.Invoke){var e=k.toInvokeSource(c.src),g=this.machine.options.services?this.machine.options.services[e.type]:void 0,l=c.id,m=c.data;j.IS_PRODUCTION||k.warn(!("forward"in c),"`forward` property is deprecated (found in invocation of '"+c.src+"' in in machine '"+this.machine.id+"'). Please use `autoForward` instead.");var n="autoForward"in c?c.autoForward:!!c.forward;if(!g){j.IS_PRODUCTION||k.warn(!1,"No service found for invocation '"+c.src+"' in machine '"+this.machine.id+"'.");return}m=m?k.mapContext(m,d,b):void 0;d=k.isFunction(g)?g(d,b.data,{data:m,src:e}):g;k.isPromiseLike(d)?this.spawnPromise(Promise.resolve(d),l):k.isFunction(d)?this.spawnCallback(d,l):k.isObservable(d)?this.spawnObservable(d,l):k.isMachine(d)&&this.spawnMachine(m?d.withContext(m):d,{id:l,autoForward:n})}else this.spawnActivity(c);break;case h.stop:this.stopChild(a.activity.id);break;case h.log:b=a.label;e=a.value;b?this.logger(b,e):this.logger(e);break;default:j.IS_PRODUCTION||k.warn(!1,"No implementation found for action type '"+a.type+"'");break}return void 0};d.prototype.removeChild=function(a){this.children["delete"](a),this.forwardTo["delete"](a),delete this.state.children[a]};d.prototype.stopChild=function(a){var b=this.children.get(a);if(!b)return;this.removeChild(a);k.isFunction(b.stop)&&b.stop()};d.prototype.spawn=function(a,c,d){if(k.isPromiseLike(a))return this.spawnPromise(Promise.resolve(a),c);else if(k.isFunction(a))return this.spawnCallback(a,c);else if(m.isSpawnedActor(a))return this.spawnActor(a);else if(k.isObservable(a))return this.spawnObservable(a,c);else if(k.isMachine(a))return this.spawnMachine(a,b(b({},d),{id:c}));else throw new Error('Unable to spawn entity "'+c+'" of type "'+typeof a+'".')};d.prototype.spawnMachine=function(a,c){var e=this;c===void 0&&(c={});var f=new d(a,b(b({},this.options),{parent:this,id:c.id||a.id}));a=b(b({},s),c);a.sync&&f.onTransition(function(a){e.send(h.update,{state:a,id:f.id})});c=f;this.children.set(f.id,c);a.autoForward&&this.forwardTo.add(f.id);f.onDone(function(a){e.removeChild(f.id),e.send(k.toSCXMLEvent(a,{origin:f.id}))}).start();return c};d.prototype.spawnPromise=function(a,b){var c=this,d=!1;a.then(function(a){d||(c.removeChild(b),c.send(k.toSCXMLEvent(i.doneInvoke(b,a),{origin:b})))},function(a){if(!d){c.removeChild(b);var e=i.error(b,a);try{c.send(k.toSCXMLEvent(e,{origin:b}))}catch(d){k.reportUnhandledExceptionOnInvocation(a,d,b),c.devTools&&c.devTools.send(e,c.state),c.machine.strict&&c.stop()}}});var e={id:b,send:function(){return void 0},subscribe:function(b,c,d){var e=k.toObserver(b,c,d),f=!1;a.then(function(a){if(f)return;e.next(a);if(f)return;e.complete()},function(a){if(f)return;e.error(a)});return{unsubscribe:function(){return f=!0}}},stop:function(){d=!0},toJSON:function(){return{id:b}}};this.children.set(b,e);return e};d.prototype.spawnCallback=function(a,b){var c=this,d=!1,e=new Set(),f=new Set(),g=function(a){f.forEach(function(b){return b(a)});if(d)return;c.send(k.toSCXMLEvent(a,{origin:b}))},h;try{h=a(g,function(a){e.add(a)})}catch(a){this.send(i.error(b,a))}if(k.isPromiseLike(h))return this.spawnPromise(h,b);a={id:b,send:function(a){return e.forEach(function(b){return b(a)})},subscribe:function(a){f.add(a);return{unsubscribe:function(){f["delete"](a)}}},stop:function(){d=!0,k.isFunction(h)&&h()},toJSON:function(){return{id:b}}};this.children.set(b,a);return a};d.prototype.spawnObservable=function(a,b){var c=this,d=a.subscribe(function(a){c.send(k.toSCXMLEvent(a,{origin:b}))},function(a){c.removeChild(b),c.send(k.toSCXMLEvent(i.error(b,a),{origin:b}))},function(){c.removeChild(b),c.send(k.toSCXMLEvent(i.doneInvoke(b),{origin:b}))}),e={id:b,send:function(){return void 0},subscribe:function(b,c,d){return a.subscribe(b,c,d)},stop:function(){return d.unsubscribe()},toJSON:function(){return{id:b}}};this.children.set(b,e);return e};d.prototype.spawnActor=function(a){this.children.set(a.id,a);return a};d.prototype.spawnActivity=function(a){var b=this.machine.options&&this.machine.options.activities?this.machine.options.activities[a.type]:void 0;if(!b){j.IS_PRODUCTION||k.warn(!1,"No implementation found for activity '"+a.type+"'");return}b=b(this.state.context,a);this.spawnEffect(a.id,b)};d.prototype.spawnEffect=function(a,b){this.children.set(a,{id:a,send:function(){return void 0},subscribe:function(){return{unsubscribe:function(){return void 0}}},stop:b||void 0,toJSON:function(){return{id:a}}})};d.prototype.attachDev=function(){var c=q.getGlobal();if(this.options.devTools&&c){if(c.__REDUX_DEVTOOLS_EXTENSION__){var d=typeof this.options.devTools==="object"?this.options.devTools:void 0;this.devTools=c.__REDUX_DEVTOOLS_EXTENSION__.connect(b(b({name:this.id,autoPause:!0,stateSanitizer:function(a){return{value:a.value,context:a.context,actions:a.actions}}},d),{features:b({jump:!1,skip:!1},d?d.features:void 0)}),this.machine);this.devTools.init(this.state)}q.registerService(this)}};d.prototype.toJSON=function(){return{id:this.id}};d.prototype[k.symbolObservable]=function(){return this};d.defaultOptions=function(b){return{execute:!0,deferEvents:!0,clock:{setTimeout:function(a,b){return setTimeout(a,b)},clearTimeout:function(a){return clearTimeout(a)}},logger:b.console.log.bind(console),devTools:!1}}(typeof self!=="undefined"?self:a);d.interpret=y;return d}();Z.Interpreter=v;var w=function(a){return k.isString(a)?b(b({},s),{name:a}):b(b(b({},s),{name:k.uniqueId()}),a)};function x(a,b){var c=w(b);return r.consume(function(b){if(!j.IS_PRODUCTION){var d=k.isMachine(a)||k.isFunction(a);k.warn(!!b||d,'Attempted to spawn an Actor (ID: "'+(k.isMachine(a)?a.id:"undefined")+'") outside of a service. This will have no effect.')}if(b)return b.spawn(a,c.name,c);else return m.createDeferredActor(a,c.name)})}Z.spawn=x;function y(a,b){a=new v(a,b);return a}Z.interpret=y}var Qa=!1;function Ra(){Qa||(Qa=!0,Pa());return Oa.exports}var Sa={},Ta={exports:Sa};function Ua(){var a=this&&this.__values||function(a){var b=typeof Symbol==="function"&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&typeof a.length==="number")return{next:function(){a&&d>=a.length&&(a=void 0);return{value:a&&a[d++],done:!a}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")},b=this&&this.__read||function(a,b){var c=typeof Symbol==="function"&&a[Symbol.iterator];if(!c)return a;a=c.call(a);var d,e=[],f;try{while((b===void 0||b-->0)&&!(d=a.next()).done)e.push(d.value)}catch(a){f={error:a}}finally{try{d&&!d.done&&(c=a["return"])&&c.call(a)}finally{if(f)throw f.error}}return e};Object.defineProperty(Sa,"__esModule",{value:!0});Sa.matchState=void 0;var c=S();function d(d,e,f){var g,h;d=c.State.from(d,d instanceof c.State?d.context:void 0);try{for(var e=a(e),i=e.next();!i.done;i=e.next()){var j=b(i.value,2),k=j[0];j=j[1];if(d.matches(k))return j(d)}}catch(a){g={error:a}}finally{try{i&&!i.done&&(h=e["return"])&&h.call(e)}finally{if(g)throw g.error}}return f(d)}Sa.matchState=d}var Va=!1;function Wa(){Va||(Va=!0,Ua());return Ta.exports}var $={},Xa={exports:$};function Ya(){var a=this&&this.__createBinding||(Object.create?function(a,b,c,d){d===void 0&&(d=c),Object.defineProperty(a,d,{enumerable:!0,get:function(){return b[c]}})}:function(a,b,c,d){d===void 0&&(d=c),a[d]=b[c]}),b=this&&this.__exportStar||function(c,b){for(var d in c)d!=="default"&&!Object.prototype.hasOwnProperty.call(b,d)&&a(b,c,d)};Object.defineProperty($,"__esModule",{value:!0});$.createMachine=$.doneInvoke=$.spawn=$.matchState=$.InterpreterStatus=$.Interpreter=$.interpret=$.forwardTo=$.sendUpdate=$.sendParent=$.send=$.assign=$.actions=$.mapState=$.matchesState=$.State=$.StateNode=$.Machine=void 0;var c=u();Object.defineProperty($,"matchesState",{enumerable:!0,get:function(){return c.matchesState}});var d=z();Object.defineProperty($,"mapState",{enumerable:!0,get:function(){return d.mapState}});var e=va();Object.defineProperty($,"StateNode",{enumerable:!0,get:function(){return e.StateNode}});var g=S();Object.defineProperty($,"State",{enumerable:!0,get:function(){return g.State}});var h=za();Object.defineProperty($,"Machine",{enumerable:!0,get:function(){return h.Machine}});Object.defineProperty($,"createMachine",{enumerable:!0,get:function(){return h.createMachine}});var i=Q();Object.defineProperty($,"send",{enumerable:!0,get:function(){return i.send}});Object.defineProperty($,"sendParent",{enumerable:!0,get:function(){return i.sendParent}});Object.defineProperty($,"sendUpdate",{enumerable:!0,get:function(){return i.sendUpdate}});Object.defineProperty($,"assign",{enumerable:!0,get:function(){return i.assign}});Object.defineProperty($,"doneInvoke",{enumerable:!0,get:function(){return i.doneInvoke}});Object.defineProperty($,"forwardTo",{enumerable:!0,get:function(){return i.forwardTo}});var j=Ra();Object.defineProperty($,"interpret",{enumerable:!0,get:function(){return j.interpret}});Object.defineProperty($,"Interpreter",{enumerable:!0,get:function(){return j.Interpreter}});Object.defineProperty($,"spawn",{enumerable:!0,get:function(){return j.spawn}});Object.defineProperty($,"InterpreterStatus",{enumerable:!0,get:function(){return j.InterpreterStatus}});var k=Wa();Object.defineProperty($,"matchState",{enumerable:!0,get:function(){return k.matchState}});var l={raise:i.raise,send:i.send,sendParent:i.sendParent,sendUpdate:i.sendUpdate,log:i.log,cancel:i.cancel,start:i.start,stop:i.stop,assign:i.assign,after:i.after,done:i.done,respond:i.respond,forwardTo:i.forwardTo,escalate:i.escalate,choose:i.choose,pure:i.pure};$.actions=l;b(E(),$)}var Za=!1;function $a(){Za||(Za=!0,Ya());return Xa.exports}function b(a){switch(a){case void 0:return $a();case"/lib/utils":return u()}}e.exports=b}),null);
__d("xstate",["xstate-4.16.0"],(function(a,b,c,d,e,f){e.exports=b("xstate-4.16.0")()}),null);
__d("ZenonDeferrableStateMachine",["DateConsts","clearTimeout","setTimeout","xstate"],(function(a,b,c,d,e,f,g){"use strict";var h=30*d("DateConsts").MS_PER_SEC;function a(a,b){b=b===void 0?{}:b;var e=b.deferTimeout,f=b.onDeferTimeout,g=[],i=new Map(),j=d("xstate").interpret(a.withConfig({actions:{defer:function(a,b){g.push(b);if(f){i.set(b,c("setTimeout")(function(){f(b)},(a=e)!=null?a:h))}}}})).onTransition(function(a){if(a.value!==((a=a.history)==null?void 0:a.value)){a=g;g=[];while(a.length>0){var b=a.shift();j.send(b);c("clearTimeout")(i.get(b));i["delete"](b)}}}).start();return j}g.interpret=a}),98);
__d("ZenonConnectionStateMachine",["ZenonConnectionInitState","ZenonConnectionPeerConnectionRestartingState","ZenonConnectionSMGuards","ZenonConnectionSdpNegotiatedState","ZenonConnectionSdpSetState","ZenonConnectionSharedActions","ZenonDebugLogger","ZenonDeferrableStateMachine","ZenonInfraActionsLogger","gkx","immutable","qpl","xstate"],(function(a,b,c,d,e,f,g){"use strict";var h="ConnectionStateMachine";a=function(){function a(a,b){b===void 0&&(b="init");b=babelHelpers["extends"]({},H,{context:babelHelpers["extends"]({activePeerConnection:"primary",currentSubscriptionRequest:null,dataMessageSubscriptions:c("immutable").Map({})},a),initial:b});this.$1=d("ZenonDeferrableStateMachine").interpret(d("xstate").Machine(b,{guards:d("ZenonConnectionSMGuards")}),{onDeferTimeout:function(a){c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[Connection] "+a.type+" was deferred for too long"})}}).onTransition(function(b){var d;c("ZenonInfraActionsLogger").updateCachedValues({connectionState:b.value});c("ZenonDebugLogger").getInstance().logStateMachineTransition(h,b.changed,b.value,(d=b.history)==null?void 0:d.value,b.event.type,b.actions,a.signalingClient.getSignalingModel().getSignalingID());((d=b.history)==null?void 0:d.value)!==b.value&&a.updateConnectionModel(function(a){a.updateConnectionState(b.value)})});c("ZenonDebugLogger").getInstance().startQPL(c("qpl")._(64243854,"2452"),+a.signalingClient.getSignalingModel().getSignalingID())}var b=a.prototype;b.processEvent=function(a){var b=this.$1.state.context.signalingClient.getSignalingModel().getSignalingID();c("ZenonDebugLogger").getInstance().logStateMachine(h,this.getState(),a.type,b);this.$1.send(a)};b.getState=function(){var a=this.$1.state.toStrings();return a.length>0?this.$1.state.toStrings()[0]:"init"};return a}();b={actions:[d("ZenonConnectionSharedActions").onAddParticipants]};e={actions:[d("ZenonConnectionSharedActions").onLocalMediaStateUpdateProcessing]};f={actions:[d("ZenonConnectionSharedActions").onMediaUpdateReceived]};var i={actions:[d("ZenonConnectionSharedActions").onMediaUpdateResponseReceived]},j={actions:[d("ZenonConnectionSharedActions").onStopLocalTrack]},k={actions:[d("ZenonConnectionSharedActions").onLocalMediaStateUpdateReady]},l={actions:[d("ZenonConnectionSharedActions").onEndConnection],target:"terminated"},m={actions:[d("ZenonConnectionSharedActions").onCapabilitiesReceived]},n={actions:[d("ZenonConnectionSharedActions").onClientInfoReceived]},o={actions:[d("ZenonConnectionSharedActions").onParticipantUpdateReceivedEvent]},p={actions:[d("ZenonConnectionSharedActions").onRemoveParticipants]},q={actions:[d("ZenonConnectionSharedActions").onIceCandidateReady]},r={actions:[d("xstate").assign(d("ZenonConnectionSharedActions").onCreateDataMessageSubscription)]},s={actions:[d("xstate").assign(d("ZenonConnectionSharedActions").onRemoveDataMessageSubscription)]},t={actions:[d("ZenonConnectionSharedActions").onDataMessageReceived]},u={actions:[d("ZenonConnectionSharedActions").onRoomContextUpdateReceived]},v={actions:[d("ZenonConnectionSharedActions").onIceCandidateReceived]},w={actions:[d("ZenonConnectionSharedActions").onConnectionDestroyed],cond:d("ZenonConnectionSMGuards").activePeerConnectionGuard,target:"terminated"},x={actions:[d("ZenonConnectionSharedActions").onConnectionDropped],cond:d("ZenonConnectionSMGuards").activePeerConnectionGuard},y={actions:[d("ZenonConnectionSdpSetState").onConnectionEstablished]},z={actions:[d("ZenonConnectionSharedActions").onStateSyncUnsubscribe]},A={actions:[d("ZenonConnectionSharedActions").onStateSyncUpdate]},B={actions:[d("xstate").assign(d("ZenonConnectionSharedActions").onSubscriptionRequest)]},C={actions:[d("ZenonConnectionSharedActions").onSendGenericDataMessage]},D={actions:[d("ZenonConnectionSharedActions").onUserApprovalRequest]},E={actions:[d("ZenonConnectionSharedActions").onForceEncodingEnabled]},F={actions:[d("xstate").assign(d("ZenonConnectionSdpNegotiatedState").onInitiatePeerConnectionRestarting)],target:"peerConnectionRestarting"},G={actions:["defer"]},H={initial:"init",states:{init:{on:{addLocalTracks:G,capabilitiesReceived:m,clientInfoReceived:n,connectionDestroyed:w,connectionRoomUpdateReceived:u,createConnection:[{actions:[d("ZenonConnectionInitState").onCreateConnection],cond:d("ZenonConnectionSMGuards").outgoingConnectionGuard,target:"creatingSdp"},{actions:[d("ZenonConnectionInitState").onCreateConnection],cond:d("ZenonConnectionSMGuards").incomingConnectionGuard,target:"waitingForIncoming"}],createDataMessageSubscription:r,dataMessageReceived:t,endConnection:l,forceEncodingEnabled:E,iceCandidateReady:q,iceCandidateReceived:v,localMediaStateUpdateProcessing:e,localMediaStateUpdateReady:k,mediaUpdateReceived:f,mediaUpdateResponseReceived:G,participantUpdateReceived:o,removeDataMessageSubscription:s,removeLocalTrack:G,removeParticipants:p,replaceLocalTrack:G,sdpReceived:G,sendGenericDataMessage:C,stateSyncUnsubscribe:z,stateSyncUpdate:A,stopLocalTrack:j,subscriptionRequest:G,userApprovalRequest:D}},waitingForIncoming:{on:{addLocalTracks:G,capabilitiesReceived:m,clientInfoReceived:n,connectionDestroyed:w,connectionRoomUpdateReceived:u,createDataMessageSubscription:r,dataMessageReceived:t,endConnection:l,forceEncodingEnabled:E,iceCandidateReady:q,iceCandidateReceived:v,initiateAddLocalTracks:G,initiateRemoveLocalTrack:G,localMediaStateUpdateProcessing:e,localMediaStateUpdateReady:k,mediaUpdateReceived:f,mediaUpdateResponseReceived:G,offerReady:[{actions:[d("ZenonConnectionSharedActions").onOfferReady],target:"sdpSet"}],participantUpdateReceived:o,removeDataMessageSubscription:s,removeLocalTrack:G,removeParticipants:p,replaceLocalTrack:G,sdpReceived:[{actions:[d("ZenonConnectionSharedActions").onSdpReceived],cond:d("ZenonConnectionSMGuards").sdpOfferReceiveGuard,target:"creatingSdp"}],sendGenericDataMessage:C,stateSyncUnsubscribe:z,stateSyncUpdate:A,stopLocalTrack:j,subscriptionRequest:G,userApprovalRequest:D}},creatingSdp:{on:{addLocalTracks:G,answerReady:[{actions:[d("ZenonConnectionSharedActions").onAnswerReady],target:"sdpSet"}],capabilitiesReceived:m,clientInfoReceived:n,connectionDestroyed:w,connectionRoomUpdateReceived:u,createDataMessageSubscription:r,dataMessageReceived:t,endConnection:l,forceEncodingEnabled:E,iceCandidateReady:q,iceCandidateReceived:v,initiateAddLocalTracks:G,initiateRemoveLocalTrack:G,localMediaStateUpdateProcessing:e,localMediaStateUpdateReady:k,mediaUpdateReceived:f,mediaUpdateResponseReceived:G,offerReady:[{actions:[d("ZenonConnectionSharedActions").onOfferReady],target:"sdpSet"}],participantUpdateReceived:o,removeDataMessageSubscription:s,removeLocalTrack:G,removeParticipants:p,replaceLocalTrack:G,sdpReceived:G,sendGenericDataMessage:C,stateSyncUnsubscribe:z,stateSyncUpdate:A,stopLocalTrack:j,subscriptionRequest:G,userApprovalRequest:D}},sdpSet:{on:{addLocalTracks:G,capabilitiesReceived:m,clientInfoReceived:n,connectionDestroyed:w,connectionDropped:x,connectionEstablished:[{actions:[d("ZenonConnectionSdpSetState").onConnectionEstablished],target:"sdpNegotiated"}],connectionRoomUpdateReceived:u,createDataMessageSubscription:r,dataMessageReceived:t,endConnection:l,forceEncodingEnabled:E,iceCandidateReady:q,iceCandidateReceived:v,initiateAddLocalTracks:G,initiatePeerConnectionRestarting:F,initiateRemoveLocalTrack:G,localMediaStateUpdateProcessing:e,localMediaStateUpdateReady:k,mediaUpdateReceived:f,mediaUpdateResponseReceived:i,participantUpdateReceived:o,pendingApproval:[{target:"pendingApproval"}],removeDataMessageSubscription:s,removeLocalTrack:G,removeParticipants:p,replaceLocalTrack:G,sdpReceived:[{actions:[d("ZenonConnectionSharedActions").onSdpReceived],cond:d("ZenonConnectionSMGuards").sdpAnswerReceiveGuard},babelHelpers["extends"]({},G,{cond:d("ZenonConnectionSMGuards").sdpOfferReceiveGuard})],sendGenericDataMessage:C,stateSyncUnsubscribe:z,stateSyncUpdate:A,stopLocalTrack:j,subscriptionRequest:G,userApprovalRequest:D}},pendingApproval:{on:{addLocalTracks:G,capabilitiesReceived:G,clientInfoReceived:G,connectionDestroyed:w,connectionRoomUpdateReceived:G,createDataMessageSubscription:G,dataMessageReceived:G,endConnection:l,forceEncodingEnabled:G,iceCandidateReady:G,iceCandidateReceived:G,initiateAddLocalTracks:G,initiatePeerConnectionRestarting:F,initiateRemoveLocalTrack:G,localMediaStateUpdateProcessing:G,localMediaStateUpdateReady:G,mediaUpdateReceived:f,mediaUpdateResponseReceived:G,participantUpdateReceived:G,removeDataMessageSubscription:G,removeLocalTrack:G,replaceLocalTrack:G,stateSyncUnsubscribe:z,stateSyncUpdate:A,stopLocalTrack:G,subscriptionRequest:G}},sdpNegotiated:{on:{addLocalTracks:[{actions:[d("ZenonConnectionSdpNegotiatedState").onAddScreenShareLocalTrack],cond:d("ZenonConnectionSMGuards").addScreenShareTrackWithReplaceGuard},{actions:[d("ZenonConnectionSharedActions").initiateClientRenegotiation]}],addParticipants:b,capabilitiesReceived:m,clientInfoReceived:n,connectionDestroyed:w,connectionDropped:x,connectionEstablished:y,connectionRoomUpdateReceived:u,createDataMessageSubscription:r,dataMessageReceived:t,endConnection:l,forceEncodingEnabled:E,iceCandidateReady:q,iceCandidateReceived:v,initiateAddLocalTracks:{actions:[d("ZenonConnectionSdpNegotiatedState").onAddLocalTracks],target:"clientInitiatedRenegotiation"},initiatePeerConnectionRestarting:F,initiateRemoveLocalTrack:{actions:[d("ZenonConnectionSdpNegotiatedState").onRemoveLocalTrack],target:"clientInitiatedRenegotiation"},localMediaStateUpdateProcessing:e,localMediaStateUpdateReady:k,mediaUpdateReceived:f,mediaUpdateResponseReceived:i,offerReady:{actions:[d("ZenonConnectionSharedActions").onOfferReady],target:"clientInitiatedRenegotiation"},participantUpdateReceived:o,removeDataMessageSubscription:s,removeLocalTrack:[{actions:[d("ZenonConnectionSdpNegotiatedState").onRemoveScreenShareLocalTrack],cond:d("ZenonConnectionSMGuards").removeScreenShareTrackWithReplaceGuard},{actions:[d("ZenonConnectionSharedActions").initiateClientRenegotiation]}],removeParticipants:p,replaceLocalTrack:{actions:[d("ZenonConnectionSdpNegotiatedState").onReplaceLocalTrack]},sdpReceived:{actions:[d("ZenonConnectionSharedActions").onSdpReceived],cond:d("ZenonConnectionSMGuards").sdpOfferReceiveGuard,target:"serverInitiatedRenegotiating"},sendGenericDataMessage:C,stateSyncUnsubscribe:z,stateSyncUpdate:A,stopLocalTrack:j,subscriptionRequest:B,userApprovalRequest:D}},serverInitiatedRenegotiating:{on:{addLocalTracks:G,addParticipants:c("gkx")("4318")?G:b,answerReady:{actions:[d("ZenonConnectionSharedActions").onAnswerReady],target:"sdpNegotiated"},capabilitiesReceived:c("gkx")("4318")?G:m,clientInfoReceived:c("gkx")("4318")?G:n,connectionDestroyed:w,connectionDropped:x,connectionEstablished:y,connectionRoomUpdateReceived:u,createDataMessageSubscription:c("gkx")("4318")?G:r,dataMessageReceived:t,endConnection:l,forceEncodingEnabled:G,iceCandidateReady:q,iceCandidateReceived:v,initiateAddLocalTracks:G,initiatePeerConnectionRestarting:G,initiateRemoveLocalTrack:G,localMediaStateUpdateProcessing:e,localMediaStateUpdateReady:k,mediaUpdateReceived:c("gkx")("4318")?G:f,mediaUpdateResponseReceived:c("gkx")("4318")?G:i,offerReady:{actions:[d("ZenonConnectionSharedActions").onOfferReadyCancel]},participantUpdateReceived:c("gkx")("4318")?G:o,removeDataMessageSubscription:c("gkx")("4318")?G:s,removeLocalTrack:G,removeParticipants:c("gkx")("4318")?G:p,replaceLocalTrack:G,sendGenericDataMessage:C,stateSyncUnsubscribe:c("gkx")("4318")?G:z,stateSyncUpdate:c("gkx")("4318")?G:A,stopLocalTrack:j,subscriptionRequest:G,userApprovalRequest:D}},clientInitiatedRenegotiation:{on:{addLocalTracks:G,capabilitiesReceived:m,clientInfoReceived:n,connectionDestroyed:w,connectionDropped:x,connectionEstablished:[{actions:[d("ZenonConnectionSdpSetState").onConnectionEstablished],target:"sdpNegotiated"}],connectionRoomUpdateReceived:u,createDataMessageSubscription:r,dataMessageReceived:t,endConnection:l,forceEncodingEnabled:E,iceCandidateReady:q,iceCandidateReceived:v,initiateAddLocalTracks:G,initiatePeerConnectionRestarting:G,initiateRemoveLocalTrack:G,localMediaStateUpdateProcessing:G,localMediaStateUpdateReady:G,mediaUpdateReceived:f,mediaUpdateResponseReceived:[{actions:[d("ZenonConnectionSharedActions").onMediaUpdateResponseReceived],cond:d("ZenonConnectionSMGuards").cancelNegotiationsGuard,target:"sdpNegotiated"},{actions:[d("ZenonConnectionSharedActions").onMediaUpdateResponseReceived]}],offerReady:{actions:[d("ZenonConnectionSharedActions").onOfferReady]},participantUpdateReceived:o,removeDataMessageSubscription:s,removeLocalTrack:G,removeParticipants:p,replaceLocalTrack:G,sdpReceived:[{actions:[d("ZenonConnectionSharedActions").onSdpReceived],cond:d("ZenonConnectionSMGuards").sdpAnswerReceiveGuard},G],sendGenericDataMessage:C,stateSyncUnsubscribe:z,stateSyncUpdate:A,stopLocalTrack:G,subscriptionRequest:G,userApprovalRequest:D}},peerConnectionRestarting:{on:{addLocalTracks:G,addParticipants:b,answerReady:{actions:[d("ZenonConnectionSharedActions").onAnswerReady]},capabilitiesReceived:m,clientInfoReceived:n,connectionDestroyed:babelHelpers["extends"]({},w,{cond:d("ZenonConnectionSMGuards").secondaryPeerConnectionGuard}),connectionDropped:x,connectionEstablished:{actions:[d("xstate").assign(d("ZenonConnectionPeerConnectionRestartingState").onSecondaryConnectionEstablished)],cond:d("ZenonConnectionSMGuards").secondaryPeerConnectionGuard,target:"sdpNegotiated"},connectionRoomUpdateReceived:u,createDataMessageSubscription:r,dataMessageReceived:babelHelpers["extends"]({},t,{cond:d("ZenonConnectionSMGuards").secondaryPeerConnectionGuard}),endConnection:l,forceEncodingEnabled:G,iceCandidateReady:babelHelpers["extends"]({},q,{cond:d("ZenonConnectionSMGuards").secondaryPeerConnectionGuard}),iceCandidateReceived:v,initiateAddLocalTracks:G,initiatePeerConnectionRestarting:F,initiateRemoveLocalTrack:G,localMediaStateUpdateProcessing:e,localMediaStateUpdateReady:babelHelpers["extends"]({},k,{cond:d("ZenonConnectionSMGuards").secondaryPeerConnectionGuard}),mediaUpdateReceived:G,mediaUpdateResponseReceived:G,offerReady:{actions:[d("ZenonConnectionSharedActions").onOfferReady],cond:d("ZenonConnectionSMGuards").secondaryPeerConnectionGuard},participantUpdateReceived:o,removeDataMessageSubscription:s,removeLocalTrack:G,removeParticipants:p,replaceLocalTrack:G,sdpReceived:[{actions:[d("ZenonConnectionPeerConnectionRestartingState").onSdpReceived],cond:d("ZenonConnectionSMGuards").sdpAnswerOrP2POfferReceiveGuard},G],sendGenericDataMessage:C,stateSyncUnsubscribe:z,stateSyncUpdate:A,stopLocalTrack:j,subscriptionRequest:G,userApprovalRequest:D}},terminated:{}}};g["default"]=a}),98);
__d("ZenonConnectionStatePeerConnectionDelegate",[],(function(a,b,c,d,e,f){"use strict";var g={connectionDestroyed:function(a,b,c){a.processEvent({payload:{error:c,peerConnectionRole:b},type:"connectionDestroyed"})},connectionDropped:function(a,b){a.processEvent({payload:{peerConnectionRole:b},type:"connectionDropped"})},connectionEstablished:function(a,b){a.processEvent({payload:{peerConnectionRole:b},type:"connectionEstablished"})},createDataMessageSubscription:function(a,b,c){a.processEvent({payload:{dataChannelLabel:b,messageHandler:c},type:"createDataMessageSubscription"})},dataChannelMesageReceived:function(a,b,c,d){a.processEvent({payload:{data:d,dataChannelLabel:c,peerConnectionRole:b},type:"dataMessageReceived"})},removeDataMessageSubscription:function(a,b,c){a.processEvent({payload:{dataChannelLabel:b,messageHandler:c},type:"removeDataMessageSubscription"})},sendIceCandidate:function(a,b,c){a.processEvent({payload:{candidate:c,peerConnectionRole:b},type:"iceCandidateReady"})},sendLocalMediaStateUpdate:function(a,b,c){a.processEvent({payload:{mediaStates:c,peerConnectionRole:b},type:"localMediaStateUpdateReady"})},sendSdpReady:function(a,b,c,d,e){var f={tracks:[],version:c.version};d.forEach(function(a){a={enabled:a.enabled,trackID:a.trackId,type:a.contentType,userID:e};f.tracks.push(a)});d={mediaStates:f,peerConnectionRole:b,sdp:c};c.type==="offer"?a.processEvent({payload:d,type:"offerReady"}):a.processEvent({payload:d,type:"answerReady"})},setPeerConnectionEventHandlers:function(a,b,c,d){a.setPeerConnectionEventHandlers({onConnectionDestroyed:function(a){return g.connectionDestroyed(b,c,a)},onConnectionDropped:function(){return g.connectionDropped(b,c)},onConnectionEstablished:function(){return g.connectionEstablished(b,c)},onCreateDataMessageSubscription:function(a,c){g.createDataMessageSubscription(b,a,c)},onDataChannelMessageReceived:function(a,d){return g.dataChannelMesageReceived(b,c,a,d)},onIceCandidateReady:function(a){return g.sendIceCandidate(b,c,a)},onLocalMediaStateUpdate:function(a){return g.sendLocalMediaStateUpdate(b,c,a)},onLocalSdpSet:function(a,e){return g.sendSdpReady(b,c,a,e,d().selfUserID)},onRemoveDataMessageSubscription:function(a,c){g.removeDataMessageSubscription(b,a,c)}})}};a=g;f["default"]=a}),66);
__d("ZenonConnectionStateSignalingDelegate",[],(function(a,b,c,d,e,f){"use strict";var g={onCapabilitiesReceived:function(a,b,c){a.processEvent({payload:{capabilities:b,escalationConferenceName:c},type:"capabilitiesReceived"})},onClientInfoReceived:function(a,b){a.processEvent({payload:{userCapabilities:b},type:"clientInfoReceived"})},onClientRenegotiationReceived:function(a,b){a.processEvent(b)},onDismissReceived:function(a,b,c){c={dismissReason:b,dismissReasonSetByRemote:!0,dismissSubreason:"Server sent dismiss message to client: "+((b=c)!=null?b:"null"),shouldInformPeer:!1};a.processEvent({payload:c,type:"endConnection"})},onGenericDataMessageReceived:function(a,b,c){c={data:c,dataChannelLabel:b};a.processEvent({payload:c,type:"dataMessageReceived"})},onIceCandidateReceived:function(a,b){a.processEvent({payload:b,type:"iceCandidateReceived"})},onMediaUpdateReceived:function(a,b){a.processEvent({payload:{mediaStates:b},type:"mediaUpdateReceived"})},onMediaUpdateResponseReceived:function(a,b){a.processEvent({payload:b,type:"mediaUpdateResponseReceived"})},onParticipantUpdateReceived:function(a,b){a.processEvent({payload:{participantStates:b},type:"participantUpdateReceived"})},onPendingApprovalReceived:function(a){a.processEvent({type:"pendingApproval"})},onRenegotiationRequested:function(a,b){a.processEvent({payload:{hasRemoteOffer:b},type:"initiatePeerConnectionRestarting"})},onRoomContextUpdateReceived:function(a,b){a.processEvent({payload:{context:b},type:"connectionRoomUpdateReceived"})},onSdpReceived:function(a,b,c,d,e,f,g){a.processEvent({payload:{mediaPath:c,mediaStates:d,onProcessed:g,renegotiationOffer:f,sdp:b,source:e},type:"sdpReceived"})},setSignalingEventHandlers:function(a,b){a.setSignalingEventHandlers({onCapabilitiesReceived:function(a,c){return g.onCapabilitiesReceived(b,a,c)},onClientInfoReceived:function(a){return g.onClientInfoReceived(b,a)},onClientRenegotiationReceived:function(a){return g.onClientRenegotiationReceived(b,a)},onDismissReceived:function(a,c,d){return g.onDismissReceived(b,c,d)},onGenericDataMessageReceived:function(a,c){return g.onGenericDataMessageReceived(b,a,c)},onIceCandidateReceived:function(a){return g.onIceCandidateReceived(b,a)},onMediaUpdateReceived:function(a){return g.onMediaUpdateReceived(b,a)},onMediaUpdateResponseReceived:function(a){return g.onMediaUpdateResponseReceived(b,a)},onParticipantUpdateReceived:function(a){return g.onParticipantUpdateReceived(b,a)},onPendingApprovalReceived:function(){return g.onPendingApprovalReceived(b)},onRenegotiationRequested:function(a){return g.onRenegotiationRequested(b,a)},onRoomContextUpdateReceived:function(a){return g.onRoomContextUpdateReceived(b,a)},onSdpReceived:function(a,c,d,e,f,h){return g.onSdpReceived(b,a,c,d,e,f,h)}})}};a=g;f["default"]=a}),66);
__d("ZenonConnectionStateManager",["FBMqttChannel","Promise","ZenonCallsModelEmitter","ZenonCallsModelTypes","ZenonConnectionStateMachine","ZenonConnectionStateModel","ZenonConnectionStatePeerConnectionDelegate","ZenonConnectionStateSignalingDelegate","ZenonDismissReason","ZenonInfraActionsLogger","ZenonNetworkQualityMonitor","ZenonParticipantState","ZenonPeerConnectionManager","ZenonPlatformExperiments","gkx","immutable","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h="E2eeKey",i="E2eeState",j=15e3;a=function(){function a(a,b,e,f,g,h,i){var j=this;h===void 0&&(h=!1);this.$7={local:d("ZenonNetworkQualityMonitor").ZenonNetworkQuality.Good,remote:c("immutable").Map()};this.$11=function(){return j.$2};this.$9=function(a){a(j.$2),j.$10(),j.$16()};this.$1=a;var k=b.getSignalingModel();k.setNotifyCallback(function(){j.$9(function(a){a.collisionContext.serverInfoData=k.getRemoteSignalingID()});var a=k.getOverlayConfigServerLayer();a&&f.setServerLayer(a)});this.$2=new(c("ZenonConnectionStateModel"))(k,new Map(),e,{groupThreadID:null,peerID:null,serverInfoData:b.getSignalingModel().getRemoteSignalingID()});a=k.getMediaModeManager().getMediaMode()==="p2p";e=new(c("ZenonPeerConnectionManager"))(f,h,function(a){return g.log(a)},a,i);e.registerTrackListener(function(){j.$10()});e.registerNetworkStatusListener(function(a){var b=j.$7;j.$2.updateNetworkStatus(a);j.$10();j.$7=a;a.local!==b.local&&c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"ZenonNetworkQuality: "+a.local})});this.$6=e.getSdpFormat();h=new(c("ZenonPeerConnectionManager"))(f,h,function(a){return g.log(a)},a,i);this.$3=new(c("ZenonConnectionStateMachine"))({getConnectionModel:this.$11,logEvent:function(a){return g.log(a)},peerConnectionManager:e,secondaryPeerConnectionManager:h,signalingClient:b,updateConnectionModel:this.$9});c("ZenonConnectionStateSignalingDelegate").setSignalingEventHandlers(b,this.$3);c("ZenonConnectionStatePeerConnectionDelegate").setPeerConnectionEventHandlers(e,this.$3,"primary",this.$11);c("ZenonConnectionStatePeerConnectionDelegate").setPeerConnectionEventHandlers(h,this.$3,"secondary",this.$11);i!=null&&(this.$8=i,this.$12(b));this.$4=g;b.setLoggingEventHandler(function(a){return g.log(a)});this.$5=0}var e=a.prototype;e.start=function(a){var e,f,g,h,i,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:if(!c("gkx")("2129")){m.next=9;break}m.prev=1;m.next=4;return b("regeneratorRuntime").awrap(this.$13());case 4:m.next=9;break;case 6:m.prev=6,m.t0=m["catch"](1),this.end(d("ZenonDismissReason").ZenonDismissReason.ClientError,"MQTT did not connect");case 9:e=a.mwRingRequest!=null?"incoming":"outgoing",(f=a.dataChannels,g=a.initialSyncStates,h=a.localMedia,i=a.mwRingRequest,j=a.usersToRing),k=this.$14(),l={dataChannels:f,direction:e,initialSyncStates:d("ZenonPlatformExperiments").shouldUseStateSync()&&g?g:void 0,mwRingRequest:i,serializedInitialSyncStates:k,tracks:h,usersToRing:j},this.$3.processEvent({payload:l,type:"createConnection"});case 14:case"end":return m.stop()}},null,this,[[1,6]])};e.muteTrack=function(a){this.$15(a,!1)};e.unmuteTrack=function(a){this.$15(a,!0)};e.$15=function(a,b){b={enabled:b,trackID:a};this.$3.processEvent({payload:b,type:"localMediaStateUpdateProcessing"})};e.stopLocalTrack=function(a){a={trackID:a};this.$3.processEvent({payload:a,type:"stopLocalTrack"})};e.end=function(a,b){a={dismissReason:a,dismissReasonSetByRemote:!1,dismissSubreason:b,shouldInformPeer:!0};this.$3.processEvent({payload:a,type:"endConnection"})};e.addParticipants=function(a){a={usersToRing:a};this.$3.processEvent({payload:a,type:"addParticipants"})};e.removeParticipants=function(a){a={usersToRemove:a};this.$3.processEvent({payload:a,type:"removeParticipants"})};e.addLocalTrack=function(a){this.$3.processEvent({payload:{tracks:[a]},type:"addLocalTracks"})};e.replaceLocalTrack=function(a,b){this.$3.processEvent({payload:{replacementTrack:b,trackIDToReplace:a},type:"replaceLocalTrack"})};e.removeLocalTrack=function(a){this.$3.processEvent({payload:{trackID:a},type:"removeLocalTrack"})};e.createDataMessageSubscription=function(a,b){this.$3.processEvent({payload:{dataChannelLabel:a,messageHandler:b},type:"createDataMessageSubscription"})};e.removeDataMessageSubscription=function(a,b){this.$3.processEvent({payload:{dataChannelLabel:a,messageHandler:b},type:"removeDataMessageSubscription"})};e.sendGenericDataMessage=function(a,b,c,d){b={data:b,recipientIDs:c,serviceRecipients:d,topic:a};this.$3.processEvent({payload:b,type:"sendGenericDataMessage"})};e.updateStateSyncTopic=function(a,b){b={inputData:b,topic:a};this.$3.processEvent({payload:b,type:"stateSyncUpdate"})};e.unsubscribeFromStateSyncTopic=function(a){a={topic:a};this.$3.processEvent({payload:a,type:"stateSyncUnsubscribe"})};e.subscribeToRemoteVideo=function(a,b){b={includeDominantSpeaker:b,subscriptions:a};this.$3.processEvent({payload:b,type:"subscriptionRequest"})};e.approveParticipants=function(a){this.$3.processEvent({payload:{approvalStatus:1,targetUsers:a},type:"userApprovalRequest"})};e.denyParticipants=function(a){this.$3.processEvent({payload:{approvalStatus:0,targetUsers:a},type:"userApprovalRequest"})};e.forceEncodingEnabled=function(a){this.$3.processEvent({payload:{enabled:a},type:"forceEncodingEnabled"})};e.getConnectionState=function(){return this.$2.connectionState};e.getClientCallID=function(){return this.$1};e.getServerCallID=function(){return this.$2.collisionContext.serverInfoData};e.getSdpFormat=function(){return this.$6};e.$12=function(a){var b=this;a=a.getSignalingModel().getStateSyncStore();a.addTopicHandler(i,function(a){var c;return(c=b.$8)==null?void 0:c.processE2eeServerState(a)});this.createDataMessageSubscription(h,function(a){var c;return(c=b.$8)==null?void 0:c.processE2eeMessage(a)})};e.$14=function(){var a;if(this.$8!=null){var b=this.$8.getSerializedE2eeClientState();b.byteLength===0&&c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"E2ee client state is empty"});a=new Map();a.set(i,{data:btoa(String.fromCharCode.apply(null,b)),version:1})}return a};e.$10=function(){d("ZenonCallsModelEmitter").CallsModelEmitterInstance.emitCallsModel(this.$1,this.$2)};e.$16=function(){if(d("ZenonCallsModelEmitter").CONNECTION_STATE_TO_CALL_STATE_MAP[this.$2.connectionState]!==d("ZenonCallsModelTypes").ZenonCallState.Connected)return;var a=this.$2.getConsolidatedParticipantStates();if(a){a=Array.from(a.values());a=a.filter(function(a){return a===d("ZenonParticipantState").ZenonParticipantState.CONNECTED});a=a.length;a>this.$5&&(this.$4.log({connectedParticipantsCount:a,name:"setMaxConnectedParticipants"}),this.$5=a)}};e.$13=function(){return new(b("Promise"))(function(a,b){if(c("FBMqttChannel").getConnectionState()==="Connected")a();else{c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"MQTT not connected, deferring call start"});var d={onMQTTStateChanged:function(b){b==="Connected"&&(c("FBMqttChannel").unsubscribeChannelEvents(d),window.clearTimeout(e),a())}},e=window.setTimeout(function(){c("FBMqttChannel").unsubscribeChannelEvents(d),c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"MQTT never connected. Current status: "+c("FBMqttChannel").getConnectionState()}),b("timeout")},j);c("FBMqttChannel").subscribeChannelEvents(d)}})};return a}();g["default"]=a}),98);
__d("ZenonConnectionStateModel",["DateConsts","ZenonActorHooks","ZenonCallFeatures","ZenonInfraActionsLogger","ZenonMWAVEscalationEnabledHooks","ZenonNetworkQualityMonitor","ZenonParticipantState","ZenonRTWebBrowserFeatureSupport","ZenonScreenShare","ZenonScreenSharingAvailabilityType","gkx","immutable"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,e,f,g,h){f===void 0&&(f={groupThreadID:null,peerID:null,serverInfoData:null}),g===void 0&&(g=new(c("ZenonCallFeatures"))({canReplaceLocalStreams:!0,cowatchEnabled:!0,cowatchGroupEnabled:!0,multiwayVideoEscalation:c("ZenonMWAVEscalationEnabledHooks").isZenonMWAVEscalationEnabled(!1),networkStatus:{local:d("ZenonNetworkQualityMonitor").ZenonNetworkQuality.Good,remote:c("immutable").Map()},screenSharingAvailability:d("ZenonRTWebBrowserFeatureSupport").isReplaceTrackSupported()?c("ZenonScreenSharingAvailabilityType").Available:c("ZenonScreenSharingAvailabilityType").Unknown,supportMultipleStreams:!d("ZenonScreenShare").screenShareWithReplaceTrack()})),h===void 0&&(h="init"),this.$12=new Map(),this.selfUserID=d("ZenonActorHooks").ZenonActor.getID(),this.collisionContext=f,this.currentUserCapabilities=g,this.connectionDirection=e,this.connectionState=h,this.$5=function(){return new Map()},this.$6=function(){return[]},this.$7=function(){return[]},this.$8=function(){return a.getStateSyncStore().getInputStates()},this.$9=function(){return a.getStateSyncStore().getOutputStates()},this.$10=new Map(),this.$1=b,this.$1.set(this.selfUserID,c("gkx")("1460")?d("ZenonParticipantState").ZenonParticipantState.DISCONNECTED:d("ZenonParticipantState").ZenonParticipantState.CONNECTED),this.$2=new Set(),this.$4=new Map(this.$1),this.$11=null,this.$13=new Map(),this.$3=new Map()}var b=a.prototype;b.startFailedSubscriptionTimer=function(a){if(this.$12.get(a)!=null)return;var b=15;this.$12.set(a,window.setTimeout(function(){c("ZenonInfraActionsLogger").logError({callType:"mw",checkpoint:"[ZP] Failed subscription request for user: "+a+"\n            was never retried after "+b+" seconds",errorDomain:"ZenonConnectionStateModel_startFailedSubscriptionTimer"})},b*d("DateConsts").MS_PER_SEC))};b.clearFailedSubscriptionTimer=function(a){var b=this.$12.get(a);b!=null&&(window.clearTimeout(b),this.$12["delete"](a))};b.getConsolidatedParticipantStates=function(){return this.$4};b.getConnectedParticipantIDs=function(){var a=this;return new Set(Array.from(this.$4.keys()).filter(function(b){return a.$4.get(b)===d("ZenonParticipantState").ZenonParticipantState.CONNECTED}))};b.getRemoteConnectedParticipantIDs=function(){var a=this;return new Set(Array.from(this.$4.keys()).filter(function(b){return b!==a.selfUserID&&a.$4.get(b)===d("ZenonParticipantState").ZenonParticipantState.CONNECTED}))};b.updateParticipantState=function(a,b){this.$1.set(a,b),this.$2.has(a)||(this.$4=this.$4.set(a,b),b!==d("ZenonParticipantState").ZenonParticipantState.CONNECTED&&this.$11!=null&&this.$11.has(a)&&this.$11["delete"](a))};b.updateConnectionState=function(a){this.connectionState=a};b.updateCurrentUserCapabilities=function(a){a.addParticipantEnabled!=null&&(this.currentUserCapabilities=this.currentUserCapabilities.set("canAddParticipants",a.addParticipantEnabled)),a.cowatchEnabled!=null&&(this.currentUserCapabilities=this.currentUserCapabilities.set("cowatchEnabled",a.cowatchEnabled)),a.cowatchGroupEnabled!=null&&(this.currentUserCapabilities=this.currentUserCapabilities.set("cowatchGroupEnabled",a.cowatchGroupEnabled)),a.multipleVideoStreamsAllowed!=null&&(this.currentUserCapabilities=this.currentUserCapabilities.set("supportMultipleStreams",a.multipleVideoStreamsAllowed)),a.multiwayVideoEscalation!=null&&(this.currentUserCapabilities=this.currentUserCapabilities.set("multiwayVideoEscalation",a.multiwayVideoEscalation))};b.updateAllParticipantsCapabilities=function(a){for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;var e=d[0];d=d[1];this.$3.set(e,d)}};b.getUserCapabilities=function(a){return(a=this.$3.get(a))!=null?a:""};b.updateNetworkStatus=function(a){this.currentUserCapabilities=this.currentUserCapabilities.set("networkStatus",a)};b.updateConsolidatedParticipantStates=function(){var a=new Map(this.$1);this.$2.forEach(function(b){a.set(b,d("ZenonParticipantState").ZenonParticipantState.CONNECTED)});this.$4=a};b.getTracks=function(){return this.$5()};b.registerTrackFetcher=function(a){this.$5=a};b.getRtpSenders_I_KNOW_WHAT_I_AM_DOING=function(){return this.$6()};b.registerRtpSendersFetcher=function(a){this.$6=a};b.getRtpReceivers_I_KNOW_WHAT_I_AM_DOING=function(){return this.$7()};b.registerRtpReceiversFetcher=function(a){this.$7=a};b.getStateSyncInputs=function(){return this.$8()};b.getStateSyncOutputs=function(){return this.$9()};b.getUserToTracksMap=function(){return this.$10};b.getRemoteUserToTracksMap=function(){var a=this;return new Map(Array.from(this.$10.entries()).filter(function(b){b=b[0];return b!==a.selfUserID}))};b.getExistingParticipantIds=function(){return this.$11||new Set()};b.addLocalTrackToTrackMap=function(a){this.$14(a,this.selfUserID)};b.$14=function(a,b){var c;c=(c=this.$10.get(b))!=null?c:new Map();c.set(a.trackID,a);this.$10.set(b,c)};b.removeLocalTrackFromTrackMap=function(a){var b;b=(b=this.$10.get(this.selfUserID))!=null?b:new Map();b["delete"](a)};b.updateTrackMapFromMediaStates=function(a){var b=this;if(c("gkx")("1935994")){var d=this.$10.get(this.selfUserID);this.$10=new Map();d&&this.$10.set(this.selfUserID,d)}this.$2=new Set();a.forEach(function(a){var c=a.userID;c!=null&&(b.$14(a,c),b.$2.add(c))});this.updateConsolidatedParticipantStates()};b.updateExistingParticipantsFromMediaStateTracks=function(a){if(this.$11==null){var b=new Set();a.forEach(function(a){a=a.userID;a!=null&&b.add(a)});this.$11=b}};b.getIsUserVideoSubscribed=function(a){return(a=this.$13.get(a))!=null?a:!1};b.updateUserVideoSubscription=function(a,b){this.$13.set(a,b)};return a}();g["default"]=a}),98);
__d("ZenonSimulcastManager",["ZenonRTCVideoResolutionHelper"],(function(a,b,c,d,e,f,g){"use strict";var h=25e5,i=25e6,j=15,k=15e4,l=3e4,m=180*320,n=90*160;e=!1;f=0;var o=2,p=3;function a(a,b,c,d,e,f,g,k,l){e===void 0&&(e=!1);f===void 0&&(f=2);g===void 0&&(g={height:720,width:1280});k===void 0&&(k=!0);l===void 0&&(l=0);d=q(b.perSsrcTargetBitrateBpsMap,d);var m=0,n=[],o=[];for(var p=0;p<a.encodings.length;p++)if(t(p,b.qualityMask)){m++;var s=d.get(p);s!=null?o.push(s):o.push(h);if(m>=f)break}while(m<l)m++,o.push(h);for(var s=0;s<m;s++)n.push(r(s,o[s],a.encodings.length-1,c,m,g,e));for(var p=0;p<a.encodings.length;p++)p<m?(a.encodings[p].active=!0,a.encodings[p].scaleResolutionDownBy=n[p],m===1?(a.encodings[p].maxBitrate=h,delete a.encodings[p].maxFramerate):(a.encodings[p].maxBitrate=o[p],p===0&&(a.encodings[p].maxFramerate=j))):(a.encodings[p].active=!1,a.encodings[p].maxBitrate=i);e&&!k&&u(a);return{params:a}}function b(a){for(var b=0;b<a.encodings.length;b++)b===0?(a.encodings[b].active=!0,a.encodings[b].scaleResolutionDownBy=1,a.encodings[b].maxBitrate=h):(a.encodings[b].active=!1,a.encodings[b].maxBitrate=i);return a}function q(a,b){var c=new Map();if(a==null||b==null)return c;for(var b=b,d=Array.isArray(b),e=0,b=d?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;var g=f[0];f=f[1];g=a.get(g);g!=null&&c.set(f,g)}return c}function r(a,b,d,e,f,g,h){g===void 0&&(g={height:720,width:1280});h===void 0&&(h=!1);if(h)return 1;h=c("ZenonRTCVideoResolutionHelper").getMaxEncResolutionSimulcast(e,a,d,f);if(!h)return 1;h=s(a,b,h,f);return(e=c("ZenonRTCVideoResolutionHelper").getScalingFactor(h,g,!0,0,c("ZenonRTCVideoResolutionHelper").shouldUseSupportedScaleFactorList()))!=null?e:1}function s(a,b,c,d){if(d===2&&a===0){d=c.height!=null&&c.width!=null&&c.height*c.width>n;if(d&&b<l)return{height:90,width:160};a=c.height!=null&&c.width!=null&&c.height*c.width>m;if(a&&b<k)return{height:180,width:320}}return c}function t(a,b){return(1<<a&b)!==0}function u(a){for(var b=1;b<a.encodings.length;b++)a.encodings[b].active=!1,a.encodings[b].maxBitrate=i}function d(a){var b=new Map(),c="\r\n";a=a.split(c).filter(function(a){return a.startsWith("a=ssrc-group:SIM")});if(a.length===0)return b;c=a[0].split(" ").slice(1);for(var a=0;a<c.length;a++)b.set(c[a],a);return b}g.ALLOW_SCREENSHARE_SIMULCAST=e;g.MIN_NUM_ACTIVE_LAYERS=f;g.MAX_NUM_ACTIVE_LAYERS=o;g.NUM_LAYERS=p;g.getSimulcastEncodingParameters=a;g.getSimulcastSingleLayerParameters=b;g.getSimulcastLayerToTargetBitrateMap=q;g.getSimulcastSsrcToLayerMap=d}),98);
__d("ZenonVideoDurationTracker",["performanceNow"],(function(a,b,c,d,e,f,g){"use strict";function h(a){a.startedAt==null&&(a.startedAt=c("performanceNow")())}function i(a){a.startedAt!=null&&(a.duration=k(a),a.startedAt=null)}function j(a,b){b=b.filter(function(a){return a.enabled&&a.webrtcTrack.readyState!=="ended"});b.length>0?h(a):i(a)}function k(a){var b=a.startedAt;return b!=null?a.duration+c("performanceNow")()-b:a.duration}a=function(){function a(){this.$1={localScreenShareDuration:{duration:0,startedAt:null},localVideoDuration:{duration:0,startedAt:null},remoteVideoDuration:{duration:0,startedAt:null}}}var b=a.prototype;b.getLocalVideoDuration=function(){return k(this.$1.localVideoDuration)};b.getLocalScreenShareDuration=function(){return k(this.$1.localScreenShareDuration)};b.getRemoteVideoDuration=function(){return k(this.$1.remoteVideoDuration)};b.update=function(a){var b=this.$1.localVideoDuration,c=Array.from(a.values()).filter(function(a){var b=a.contentType==="video"||a.contentType==="screen";return b&&!a.remote});j(b,c);b=this.$1.localScreenShareDuration;c=Array.from(a.values()).filter(function(a){var b=a.contentType==="screen";return b&&!a.remote});j(b,c);b=this.$1.remoteVideoDuration;c=Array.from(a.values()).filter(function(a){var b=a.contentType==="video"||a.contentType==="screen";return b&&a.remote});j(b,c)};return a}();g["default"]=a}),98);
__d("RefCountedAudioContextSingleton",["ZenonDebugLogger","emptyFunction","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,i=null,j=new Set(),k=0;function a(){if(c("gkx")("3330"))return{audioContext:null,destroy:c("emptyFunction")};(i===null||i.state==="closed")&&(i=new h());var a=k++;j.add(a);return{audioContext:i,destroy:function(){j["delete"](a),i!==null&&j.size<1&&(i.state!=="closed"&&i.close(),i=null)}}}g.get=a}),98);
__d("ZenonNoiseSuppressionAudioWorkletNode",["FBLogger","NoiseSuppressionConfig","RefCountedAudioContextSingleton","expectationViolation","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=!1,j=null,k=null;function a(a){if(h==null){if(!a)return;c("expectationViolation")("Unable to toggle Noise Suppression. Make sure you initialize the AudioWorkletNode first by calling getNoiseSuppressionNodeInstance");return}if(i&&a){c("FBLogger")("rtc_www").mustfix("Failed to enable noise suppression node because it is permanently disabled");return}h.port.postMessage({enabledByUser:a});a===!1&&(k==null?void 0:k(),j=null,k=null,h=null)}function l(){return h!=null}function e(a,e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:if(!i){g.next=3;break}c("FBLogger")("rtc_www").mustfix("Failed to get noise suppression node because it is permanently disabled");return g.abrupt("return",a);case 3:if(l()){g.next=13;break}f=d("RefCountedAudioContextSingleton").get();j=f.audioContext;k=f.destroy;if(!(j==null)){g.next=9;break}return g.abrupt("return",a);case 9:g.next=11;return b("regeneratorRuntime").awrap(j.audioWorklet.addModule(c("NoiseSuppressionConfig").module_url));case 11:h=new AudioWorkletNode(j,"noise-suppression"),h.onprocessorerror=function(a){i=!0,c("FBLogger")("rtc_www").mustfix("Noise suppression node failed with error",a.message),c("FBLogger")("rtc_www").catching(a),e(h)};case 13:a.connect(h);return g.abrupt("return",h);case 15:case"end":return g.stop()}},null,this)}g.toggleNoiseSuppressionNode=a;g.isNoiseSuppressionNodeInitialized=l;g.connectNoiseSuppressionNode=e}),98);
__d("ZenonWebAudioManager",["FBLogger","RefCountedAudioContextSingleton","ZenonMediaActionLogger","ZenonMediaLoggingUtils","ZenonNoiseSuppressionAudioWorkletNode","ZenonUserActionLogger","qex","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=null,this.$2=null}var e=a.prototype;e.setupProcessedTrack=function(a,b){if(a.label==="MediaStreamAudioDestinationNode")return a;if(this.$3(b)!==!0){d("ZenonNoiseSuppressionAudioWorkletNode").toggleNoiseSuppressionNode(b.wasmNoiseSuppression===!0);this.$4();return a}if(!c("qex")._("13")&&b.wasmNoiseSuppression!=null)return a;(b==null?void 0:b.wasmNoiseSuppression)!=null&&c("ZenonUserActionLogger").logCheckpoint({checkpoint:(b.wasmNoiseSuppression?"Enabling":"Disabling")+" wasm Noise Suppression"});if(!this.$1){this.$1=this.$5();if(this.$1==null)return a}var e=this.$1,f=e.createMediaStreamSource(a.webrtcStream);e=e.createMediaStreamDestination();f.connect(e);this.connectFeatureNodesToSink(b,f,e);if(e.stream.getAudioTracks().length<=0){c("FBLogger")("rtc_www").warn("Web Audio destinationNode did not contain a media track");this.$4();return a}b=e.stream.getAudioTracks()[0];f=c("ZenonMediaLoggingUtils").serializeMediaStreamTrack(b);var g=c("ZenonMediaLoggingUtils").serializeMediaStreamTrack(a.webrtcTrack);c("ZenonMediaActionLogger").logEvent({checkpoint:"Returning processedTrack: "+f+", sourceTrack: "+g});return a.merge({label:"MediaStreamAudioDestinationNode",trackId:b.id,webrtcStream:e.stream,webrtcTrack:b})};e.$3=function(a){return Object.values(a).some(function(a){return a})};e.buildFeatureNodes=function(a,c,e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(d("ZenonNoiseSuppressionAudioWorkletNode").connectNoiseSuppressionNode(c,e));case 2:f=g.sent;d("ZenonNoiseSuppressionAudioWorkletNode").toggleNoiseSuppressionNode(a.wasmNoiseSuppression===!0);return g.abrupt("return",f);case 5:case"end":return g.stop()}},null,this)};e.connectFeatureNodesToSink=function(a,d,e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(this.buildFeatureNodes(a,d,function(a){c("FBLogger")("rtc_www").mustfix("Web Audio pipeline reset due to processor error. One or more AudioWorkletNode might be failing"),a.disconnect(e),d.connect(e)}));case 2:f=g.sent,d.disconnect(e),f.connect(e);case 5:case"end":return g.stop()}},null,this)};e.$5=function(){var a=d("RefCountedAudioContextSingleton").get(),b=a.audioContext;a=a.destroy;this.$1=b;this.$2=a;return b};e.$4=function(){this.$2==null?void 0:this.$2(),this.$1=null,this.$2=null};return a}();g["default"]=a}),98);
__d("ZenonMediaChannelManager",["FBLogger","ZenonBrowsers","ZenonImmutableMediaTrack","ZenonInfraActionsLogger","ZenonMediaStatsManager","ZenonMediaUtils","ZenonRTCVideoResolutionHelper","ZenonScreenShare","ZenonSdpFormat","ZenonSimulcastManager","ZenonVideoDurationTracker","ZenonWebAudioManager","cr:10225","err","gkx","promiseDone","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,d,e){var f=this;this.$1=null;this.$13=!1;this.$2=a;this.$4=new Map();this.$9=new Map();this.$10=new Map();this.$15=new Map();this.$7=[];this.$6=new(c("ZenonVideoDurationTracker"))();this.$5=new(c("ZenonMediaStatsManager"))(this.$2,this.$4,this.$15,d,this.$6);this.$14=new(c("ZenonWebAudioManager"))();this.$5.listen();this.$2.addEventListener("track",function(a){f.transformReceiverFromEvent(a),f.addRemoteTrackFromEvent(a),f.$16(),f.$17()});this.$2.addEventListener("signalingstatechange",function(){f.$17(),f.$18()});this.$2.addEventListener("removestream",function(){f.$16(!0)});this.$11=!0;this.$12=new Map();b("cr:10225")&&e!=null&&(this.$3=e,this.$1=new(b("cr:10225"))(e))}var e=a.prototype;e.onLocalSdpSet=function(a){var b;(b=this.$3)==null?void 0:b.onLocalSdpSet(a)};e.stopStatsPolling=function(){var a;this.$5.stopPolling();(a=this.$3)==null?void 0:a.stopStatsPoll()};e.getTracks=function(){return this.$4};e.clearTracks=function(){this.$4=new Map(),this.$15=new Map(),this.$18()};e.$16=function(a){a===void 0&&(a=!1),c("ZenonRTCVideoResolutionHelper").maybeLimitEncodingResolutionByParticipantCount(this.$2.getSenders(),this.$2.getReceivers(),this.$2.getTransceivers(),this.$2.supportsSimulcast(),a)};e.removeMissingTracks=function(a){var b=this;this.$4.forEach(function(c,d){c.remote&&a.find(function(a){return a.trackID===d})==null&&b.removeTrack(d)})};e.updateTrackInfo=function(a){var b=this.$4.get(a.trackID);if(b==null){c("FBLogger")("rtc_www").warn("Received track info update before track was available");this.$12.set(a.trackID,a);return}b=this.$19(b,a);this.$4.set(a.trackID,b);this.$18()};e.$19=function(a,b){if(a.contentType==="audio"&&b.type!=="screen_audio"||d("ZenonScreenShare").screenShareWithReplaceTrack())return a;var e=a.webrtcStream,f=e.getVideoTracks().length>1;b.type==="screen"&&f&&(e=c("ZenonMediaUtils").createStreamWithTrack(a.webrtcTrack),a.webrtcStream.removeTrack(a.webrtcTrack));return new(c("ZenonImmutableMediaTrack"))({contentHint:a.contentHint,contentType:(f=b.type)!=null?f:a.contentType,enabled:a.enabled,label:a.label,remote:a.remote,trackId:b.trackID,webrtcStream:e,webrtcTrack:a.webrtcTrack})};e.getLocalTracksForMWS=function(){var a=this,b=new Map(),d=this.$2.getTransceivers();this.$4.forEach(function(e,f){if(!e.remote){var g;if(a.getSdpFormat()===c("ZenonSdpFormat").UNIFIED_PLAN){var h,i=(h=(h=a.$15.get(f))==null?void 0:h.trackId)!=null?h:f;h=(h=(h=d.find(function(a){return((a=a.sender.track)==null?void 0:a.id)===i}))==null?void 0:h.mid)!=null?h:null;g=(h=a.$2.getLocalMWTrackId(h))!=null?h:f}else{g=(h=a.$10.get(f))!=null?h:f}h=e.update("trackId",function(){return g});b.set(g,h)}});return b};e.addTrack=function(a,c){return b("regeneratorRuntime").async(function(b){while(1)switch(b.prev=b.next){case 0:a.contentType==="video"&&a.remote===!1&&(this.$8=a),this.$20(a,c),this.$18();case 3:case"end":return b.stop()}},null,this)};e.transformSender=function(a){if(this.$1==null)return;this.$1.setupSenderTransform(a)};e.transformReceiverFromEvent=function(a){var b=a.receiver;a=(a=a.streams)==null?void 0:a.find(function(a){return((a=a.id)==null?void 0:a.length)>0});if(this.$1==null||a==null)return;this.$1.setupReceiverTransform(a.id,b)};e.addReceiveOnlyVideoTransceiverIfNeeded=function(a,b){this.$21("video","recvonly",a,b)};e.addInactiveAudioTransceiverIfNeeded=function(){this.$21("audio","inactive")};e.$21=function(a,b,e,f){var g=!1;this.$4.forEach(function(b,d){if(c("gkx")("3237")){if(b.contentType===a){g=!0;return}}else if(!b.remote&&b.contentType===a){g=!0;return}});if(this.$2.getSdpFormat()===c("ZenonSdpFormat").PLAN_B||g||d("ZenonBrowsers").noTransceiverForNegotiations()&&f!==!0&&e==="p2p")return;this.$2.addTransceiver(a,{direction:b})};e.removeTrack=function(a){var c,d;return b("regeneratorRuntime").async(function(b){while(1)switch(b.prev=b.next){case 0:d=this.$4.get(a);if(!(d==null)){b.next=3;break}return b.abrupt("return");case 3:this.$22(d),this.$18(),(c=this.$3)==null?void 0:c.freeEncryptorAndDecryptorForId(a);case 6:case"end":return b.stop()}},null,this)};e.replaceTrack=function(a,e){var f,g,h,i,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:g=this.$4.get(a);if(!(g==null)){m.next=3;break}return m.abrupt("return");case 3:if(!(d("ZenonScreenShare").isScreenSharingTrack([g])&&!d("ZenonScreenShare").isScreenSharingTrack([e])&&this.$8!=null)){m.next=12;break}m.next=6;return b("regeneratorRuntime").awrap(this.$23(g,this.$8));case 6:this.$11?this.unmuteTrack((h=(i=this.$8)==null?void 0:i.trackId)!=null?h:""):this.muteTrack((j=(k=this.$8)==null?void 0:k.trackId)!=null?j:"");c("ZenonRTCVideoResolutionHelper").handleStopScreenSharing(this.$2.getSenders(),this.$2.getReceivers(),this.$2.getTransceivers(),this.$2.supportsSimulcast());g.webrtcTrack.stop();g.webrtcTrack.readyState!=="ended"&&c("ZenonInfraActionsLogger").logError({errorDomain:"stopping trackToReplace failed: "+g.label});m.next=25;break;case 12:if(!(e!=null&&d("ZenonScreenShare").isScreenSharingTrack([e])&&a===((f=this.$8)==null?void 0:f.trackId)&&this.$8!=null)){m.next=20;break}this.$11=this.$8.enabled&&this.$8.webrtcTrack.enabled;m.next=16;return b("regeneratorRuntime").awrap(this.$23(this.$8,e));case 16:this.unmuteTrack(e.trackId);c("ZenonRTCVideoResolutionHelper").handleStartScreenSharing(this.$2.getSenders(),this.$2.getReceivers(),this.$2.getTransceivers(),this.$2.supportsSimulcast());m.next=25;break;case 20:if(!(e!=null)){m.next=25;break}(this.$8==null&&e.contentType==="video"||((l=this.$8)==null?void 0:l.trackId)===a)&&(this.$8=e);m.next=24;return b("regeneratorRuntime").awrap(this.$23(g,e));case 24:g.trackId!==e.trackId&&(g.webrtcTrack.stop(),g.webrtcTrack.readyState!=="ended"&&c("ZenonInfraActionsLogger").logError({errorDomain:"stopping trackToReplace failed: "+g.label}));case 25:this.$16(),this.$18();case 27:case"end":return m.stop()}},null,this)};e.addRemoteTrackFromEvent=function(a){var b=a.transceiver;b=this.$2.getRemoteMWTrackId(b.mid);a=c("ZenonMediaUtils").convertToZenonImmutableMediaTrack(a.track,{isRemote:!0,isUserMuted:!1,stream:a.streams?a.streams[0]:null},b);b=this.$12.get(a.trackId);b!=null&&(a=this.$19(a,b),this.$12["delete"](a.trackId));b=this.$9.get(a.trackId);b!=null&&(a.contentType!=="audio"&&(a.webrtcTrack.enabled=b.enabled,a=a.set("enabled",b.enabled)),a=a.set("userMuted",b.userMuted),this.$9["delete"](a.trackId));this.$4=this.$4.set(a.trackId,a);this.$18();this.$5.onRemoteTrackAdded(a)};e.createDataChannel=function(a,b){this.$2.createDataChannel(a,b)};e.muteTrack=function(a){var b=this.$4.get(a),c=b===this.$8;if(b==null){this.$9.set(a,{enabled:!1,userMuted:!0});return}a=b;b.userMuted||(a=a.set("userMuted",!0));var d=Boolean((b==null?void 0:b.remote)&&b.contentType==="audio");!d&&b.enabled&&b.webrtcTrack.enabled&&(a.webrtcTrack.enabled=!1,a=a.set("enabled",!1));c&&(this.$8=a);b!==a&&(this.$4=this.$4.set(a.trackId,a),this.$18())};e.unmuteTrack=function(a){var b=this.$4.get(a),c=b===this.$8;if(b==null){this.$9.set(a,{enabled:!0,userMuted:!1});return}a=b;b.userMuted&&(a=a.set("userMuted",!1));var d=Boolean((b==null?void 0:b.remote)&&b.contentType==="audio");!d&&!b.enabled&&!b.webrtcTrack.enabled&&(a.webrtcTrack.enabled=!0,a=a.set("enabled",!0));c&&(this.$8=a);b!==a&&(this.$4=this.$4.set(a.trackId,a),this.$18())};e.forceEncodingEnabled=function(a){if(a===this.$13)return;this.$13=a;this.$17()};e.getSdpFormat=function(){return this.$2.getSdpFormat()};e.setSimulcastSingleLayerParams=function(){if(this.$2.supportsSimulcast()&&!this.$2.getSimulcastInitialized()){var a=this.$2.getSenders().filter(function(a){return a.track&&a.track.kind==="video"});if(a.length!==0){a=a[0];var b=d("ZenonSimulcastManager").getSimulcastSingleLayerParameters(a.getParameters());if(this.$24(a))return;a.setParameters(b);this.$2.setSimulcastInitialized(!0)}}};e.stopLocalTracks=function(){this.$4.forEach(function(a){a.remote===!1&&(c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"stopping track: "+a.label}),a.webrtcTrack.stop(),a.webrtcTrack.readyState!=="ended"&&c("ZenonInfraActionsLogger").logError({errorDomain:"stopping track failed: "+a.label}))});if(this.$8!=null&&!this.$4.has(this.$8.trackId)){var a;c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"stopping local video track: "+this.$8.label});(a=this.$8)==null?void 0:a.webrtcTrack.stop();this.$8&&this.$8.webrtcTrack.readyState!=="ended"&&c("ZenonInfraActionsLogger").logError({errorDomain:"stopping local video track failed: "+this.$8.label})}this.$18()};e.stopLocalTrack=function(a){a=this.$4.get(a);if(a==null)return;if(a.remote)return;a.webrtcTrack.stop();a.webrtcTrack.readyState!=="ended"&&c("ZenonInfraActionsLogger").logError({errorDomain:"stopping local track failed: "+a.label})};e.registerNetworkStatusListener=function(a){this.$5.registerNetworkStatusListener(a)};e.registerTrackListener=function(a){this.$7.push(a)};e.setTrackListenersFromManager=function(a){this.$7=a.$7};e.timeSeries=function(){return this.$5.timeSeries()};e.$20=function(a,b){var d=a;if(a.contentType==="audio"){var e;d=this.$14.setupProcessedTrack(a,{wasmNoiseSuppression:(e=(e=a.flags)==null?void 0:e.wasmNoiseSuppression)!=null?e:!1})}this.$10.set(a.trackId,d.trackId);this.$15.set(a.trackId,d);if(this.$2.getSdpFormat()===c("ZenonSdpFormat").UNIFIED_PLAN){e=this.$25(d,b);this.transformSender(e)}else{b=this.$2.addTrack(d.webrtcTrack,d.webrtcStream);this.transformSender(b)}this.$4=this.$4.set(a.trackId,a)};e.$25=function(a,b){if(b==="p2p"){b=this.$2.getTransceivers().find(function(b){var c=b.sender.track,d=b.receiver.track;if(b.currentDirection==="inactive")return!1;if(c!==null&&d==null&&c.kind===a.contentType&&a.remote)return!0;else if(d!==null&&c==null&&d.kind===a.contentType&&a.remote===!1)return!0;return!1});if(b!=null){b.direction="sendrecv";b.sender.replaceTrack(a.webrtcTrack);return b.sender}return this.$2.addTrack(a.webrtcTrack,a.webrtcStream)}return this.$2.addTransceiver(a.webrtcTrack,{direction:"sendonly",streams:[a.webrtcStream]}).sender};e.$22=function(a){this.$4["delete"](a.trackId),this.$15["delete"](a.trackId),a.remote||(this.$2.removeTrack(a.webrtcTrack),a.webrtcTrack.stop())};e.$23=function(a,d){var e,f,g,h,i,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:f=(e=this.$15.get(a.trackId))!=null?e:a;g=this.$2.getSenders().find(function(b){var c;return((c=b.track)==null?void 0:c.id)===a.webrtcTrack.id||f.trackId===((c=b.track)==null?void 0:c.id)});if(!(g===void 0)){l.next=4;break}throw new(c("err"))("track to be replaced is not found");case 4:h=this.$10.get(a.trackId);h!=null?this.$10["delete"](a.trackId):h=a.trackId;this.$15["delete"](a.trackId);i=d;i.contentType==="audio"&&(i=this.$14.setupProcessedTrack(d,{wasmNoiseSuppression:(j=(k=i.flags)==null?void 0:k.wasmNoiseSuppression)!=null?j:!1}));l.next=11;return b("regeneratorRuntime").awrap(g.replaceTrack(i.webrtcTrack));case 11:this.$10.set(d.trackId,h),this.$15.set(d.trackId,i),this.$4["delete"](a.trackId),this.$4.set(d.trackId,d),this.$1&&this.$1.setupSenderTransform(g);case 16:case"end":return l.stop()}},null,this)};e.$18=function(){this.$6.update(this.$4),this.$7.forEach(function(a){a()})};e.$24=function(a){if(c("gkx")("2019")){a=this.$2.getTransceiverFromSender(a);if(!a||a.stopped)return!0}return!1};e.$26=function(){var a=!1,b=this.getTracks().values(),c=b.next();while(!c.done&&!a)a=c.value.remote,c=b.next();return this.$13||a};e.$17=function(){var a=this;if(c("gkx")("1923585"))return;var b=this.$26();this.$2.getSenders().forEach(function(d){if(a.$24(d))return;var e=d.getParameters(),f=!1;if(e.encodings!=null)for(var g=0;g<e.encodings.length;g++)(g===0||!b)&&e.encodings[g].active!==b&&(e.encodings[g].active=b,f=!0);f&&c("promiseDone")(d.setParameters(e),null,function(a){c("FBLogger")("rtc_www").catching(a).mustfix("Error while trying to toggle encoding")})})};return a}();g["default"]=a}),98);
__d("Network",["$InternalEnum","mixInEventEmitter"],(function(a,b,c,d,e,f,g){var h=!0,i=a.navigator.connection,j={0:"unknown",1:"ethernet",2:"wifi",3:"2g",4:"3g"},k=b("$InternalEnum")({Bluetooth:"bluetooth",Cellular:"cellular",Ethernet:"ethernet",None:"none",Wifi:"wifi",Wimax:"wimax",Other:"other",Unavailable:"unavailable",Unknown:"unknown"}),l=b("$InternalEnum")({Type_Slow2g:"slow-2g",Type_2g:"2g",Type_3g:"3g",Type_4g:"4g",Unavailable:"unavailable"});function m(){return h}function d(a){if(a==h)return;h=a;r.emit(a?"online":"offline")}function e(){if(!m())return 0;var a=i==null?void 0:i.downlinkMax;if(typeof a==="number"&&Number.isFinite(a))return a;a=i==null?void 0:i.downlink;return typeof a==="number"&&Number.isFinite(a)?a:null}function f(){if(!m())return 0;var a=i==null?void 0:i.rtt;return typeof a==="number"&&Number.isFinite(a)?a:null}function n(){return i!=null&&i!=void 0}function o(){var a=i?String(i.type):"0";return j[a]||a}function p(){var a=i==null?void 0:i.type;return(a=typeof a==="string"?k.cast(a):null)!=null?a:k.Unavailable}function q(){var a=i==null?void 0:i.effectiveType;return(a=typeof a==="string"?l.cast(a):null)!=null?a:l.Unavailable}var r={NetworkConnectivityType:k,NetworkConnectivityEffectiveType:l,getBandwidth:e,getEffectiveType:q,getType:p,getType_DEPRECATED_DO_NOT_USE:o,isOnline:m,setOnline:d,getRTT:f,containsNetworkInformation:n};c("mixInEventEmitter")(r,{online:!0,offline:!0});a.addEventListener?(a.addEventListener("online",d.bind(null,!0)),a.addEventListener("offline",d.bind(null,!1))):a.attachEvent&&(a.attachEvent("online",d.bind(null,!0)),a.attachEvent("offline",d.bind(null,!1)));b=r;g["default"]=b}),98);
__d("ZenonFirstMediaPacketFinder",["Promise","ZenonSdpFormat","performanceNow"],(function(a,b,c,d,e,f,g){"use strict";var h=500;a=function(){function a(a){this.$1={audio:null,screen:null,screen_audio:null,video:null},this.$2={audio:!1,screen:!1,screen_audio:!1,video:!1},this.$3=null,this.$4=a}var d=a.prototype;d.setUpForTrackType=function(a){var b=this;this.$2[a]=this.$1[a]==null;this.$2[a]&&this.$3==null&&(this.$3=window.setInterval(function(){b.$5()},h),this.$5())};d.getFirstPacketTimes=function(){return this.$1};d.$6=function(){if(this.$4.getSdpFormat()===c("ZenonSdpFormat").PLAN_B)return this.$4.getReceivers();else return this.$4.getTransceivers().filter(function(a){return a.currentDirection==="sendrecv"||a.currentDirection==="recvonly"}).map(function(a){return a.receiver})};d.$7=function(){var a=this;return Object.keys(this.$2).some(function(b){return a.$2[b]&&a.$1[b]==null})};d.$5=function(){var a=this,d=this.$6().filter(function(a){return a.track!=null});d=d.map(function(b){var d=b.track;return d!=null?b.getStats().then(function(b){if(b.values)for(var b=b.values(),e=Array.isArray(b),f=0,b=e?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=b.length)break;g=b[f++]}else{f=b.next();if(f.done)break;g=f.value}g=g;g.type==="inbound-rtp"&&Number(g.packetsReceived)>0&&a.$1[d.kind]==null&&(a.$1[d.kind]=c("performanceNow")(),a.$3!=null&&!a.$7()&&(window.clearInterval(a.$3),a.$3=null))}}):null});b("Promise").all(d)};return a}();g["default"]=a}),98);
__d("ZenonMediaStatsManager",["FBLogger","Network","ZenonCallFalcoEventUtils","ZenonCumulativeMediaStat","ZenonDeltaMediaStat","ZenonFirstMediaPacketFinder","ZenonHistogramCounter","ZenonMediaActionLogger","ZenonMediaStatsConfig","ZenonMediaStatsReportPoller","ZenonNetworkQualityMonitor","ZenonTSLogDataHelper","gkx","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=[d("ZenonMediaStatsConfig").OUTBOUND_AUDIO_STATS_TRACKID,d("ZenonMediaStatsConfig").OUTBOUND_VIDEO_STATS_TRACKID,d("ZenonMediaStatsConfig").OUTBOUND_SCREEN_STATS_TRACKID,d("ZenonMediaStatsConfig").GLOBAL_STATS_TRACKID,d("ZenonMediaStatsConfig").PINNED_AUDIO_STATS_TRACK_INFO.trackId,d("ZenonMediaStatsConfig").PINNED_VIDEO_STATS_TRACK_INFO.trackId],i=1e4,j={tet:1e3,tpsd:1e3};a=function(){function a(a,b,e,f,g,h){h===void 0&&(h=5e3),this.$9=null,this.__iceconnectionstate="disconnected",this.$1=a,this.$2=b,this.$3=e,this.$4=new Map(),this.$6=f,this.$7=d("ZenonTSLogDataHelper").emptyTSLogDataHolder(),this.__videoDurationTracker=g,this.$8=h,this.$5=function(){},this.$10=new(d("ZenonNetworkQualityMonitor").ZenonNetworkQualityMonitor)(),this.$11={audioDevices:[],videoDevices:[]},this.$12=new(c("ZenonFirstMediaPacketFinder"))(a),this.$13=new(c("ZenonHistogramCounter"))(200,1e3,200),this.$14=new Map()}var e=a.prototype;e.listen=function(){var a=this;this.$1.addEventListener("iceconnectionstatechange",function(b){b=b.target;a.__iceconnectionstate=b.iceConnectionState;switch(a.__iceconnectionstate){case"connected":a.pollRecurring();break;case"failed":case"disconnected":a.updateNetworkStatus(a.$10.determineNetworkStatus(null,!0));break}})};e.pollOnce=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.prev=0;a.next=3;return b("regeneratorRuntime").awrap(d("ZenonMediaStatsReportPoller").updateStatsFromConnection(Array.from(new Set([].concat(Array.from(this.$2.values()),Array.from(this.$3.values())))),this.$4,this.$13,this.$1,this.$7,this.$8));case 3:this.$9!=null&&this.$6(this.$15());a.next=9;break;case 6:a.prev=6,a.t0=a["catch"](0),c("FBLogger")("rtc_www").catching(a.t0).warn("Error polling media metrics.");case 9:this.updateNetworkStatus(this.$10.determineNetworkStatus(this.$4,this.__iceconnectionstate==="failed"||this.__iceconnectionstate==="disconnected")),this.updateNetworkHealthStats();case 11:case"end":return a.stop()}},null,this,[[0,6]])};e.pollRecurring=function(){var a=this;if(this.$9!=null)return;this.$9=window.setInterval(function(){return a.pollOnce()},this.$8);this.pollOnce()};e.stopPolling=function(){this.$9!=null&&(window.clearInterval(this.$9),this.$9=null),this.logNetworkHealthStats()};e.onRemoteTrackAdded=function(a){this.$12.setUpForTrackType(a.contentType)};e.timeSeries=function(){var a=d("ZenonTSLogDataHelper").serialize(this.$7);return a.streams.length===0||!c("gkx")("965758")?null:JSON.stringify(a)};e.registerNetworkStatusListener=function(a){this.$5=a};e.updateNetworkStatus=function(a){this.$5(a)};e.updateNetworkHealthStats=function(){if(!c("Network").containsNetworkInformation())return;for(var a=d("ZenonMediaStatsConfig").NETWORK_HEALTH_STATS.values(),b=Array.isArray(a),e=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(b){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;var g=this.$14.get(f);g==null&&(g=new(c("ZenonDeltaMediaStat"))(),this.$14.set(f,g));this.$16(f,g)}};e.$16=function(a,b){var e=0;switch(a){case"bandwidth":e=c("Network").getBandwidth();break;case"rtt":e=c("Network").getRTT();break;default:c("FBLogger")("rtc_www").warn(a+" stats collection is not implemented")}e!=null?b.add(e):d("ZenonMediaStatsConfig").isPreChromium86()&&c("FBLogger")("rtc_www").warn(a+" in null. Skipped logging")};e.logNetworkHealthStats=function(){var a;a=JSON.stringify({bandwidth:(a=this.$14.get("bandwidth"))==null?void 0:a.getAverage(),rtt:(a=this.$14.get("rtt"))==null?void 0:a.getAverage()});c("ZenonMediaActionLogger").logEvent({checkpoint:"Network health stats "+a})};e.getNetworkHealthStats=function(){return this.$14};e.$15=function(){var a=this,b={CoreAudioMetrics:{isstall:"0",voice_detect_pct:[]},CoreVideoMetrics:{screen:{capture_stall:{is_stall:"0"},encode_stall:{is_stall:"0"},sent_stall:{is_stall:"0"}},video:{capture_stall:{is_stall:"0"},encode_stall:{is_stall:"0"},sent_stall:{is_stall:"0"}}},DebugAudioMetrics:{NetworkReceive:{}},extraInfo:{mediaPacketTimes:this.$12.getFirstPacketTimes()},receiver:{},sender:{},video:{}},c={},e=this.$4.get(d("ZenonMediaStatsConfig").OUTBOUND_AUDIO_STATS_TRACKID);e!=null&&(this.$17(e,b.sender),this.$18(e,b.CoreAudioMetrics));e=this.$4.get(d("ZenonMediaStatsConfig").OUTBOUND_SCREEN_STATS_TRACKID);e!=null&&(this.$19(b.video,e),this.$20(b.video,e,c));var f=this.$4.get(d("ZenonMediaStatsConfig").OUTBOUND_VIDEO_STATS_TRACKID);f!=null&&this.$20(b.video,f,c);(e!=null||f!=null)&&this.$21(b.video,f,e);this.$22(b);this.$4.forEach(function(d,e){var f=d.localIceCandidateStats,g=d.remoteIceCandidateStats;!b.extraInfo.localIceCandidate&&f&&(b.extraInfo.localIceCandidate=f);!b.extraInfo.remoteIceCandidate&&g&&(b.extraInfo.remoteIceCandidate=g);if(!h.includes(e)&&d.remote===!0)d.contentType==="audio"?(a.$23(d,e,b.receiver,c),a.$24(d,c)):d.contentType==="video"&&a.$25(b.video,d,c);else if(d.remote===!1){g=(f=a.$3.get(e))!=null?f:a.$2.get(e);if(g==null)return;g.enabled===!0&&g.webrtcTrack.readyState==="live"&&(g.contentType==="audio"?a.$26(a.$11.audioDevices,g):g.contentType==="video"&&a.$26(a.$11.videoDevices,g));a.$11.audioDevices.length>0&&(b.CoreAudioMetrics.audio_device=a.$11.audioDevices[a.$11.audioDevices.length-1]);a.$11.videoDevices.length>0&&(b.CoreVideoMetrics.video_device=a.$11.videoDevices[a.$11.videoDevices.length-1]);return}});this.$27(b,c);this.$28(b,c);this.$29(b);return b};e.$29=function(a){var b;b=(b=this.$13.getStats())!=null?b:[];var c=b.some(function(a){return a>0});if(c){a.video.receiver=(c=a.video.receiver)!=null?c:{};a.video.receiver.avhist=b}};e.$22=function(a){var b=this.$4.get(d("ZenonMediaStatsConfig").OUTBOUND_VIDEO_STATS_TRACKID),c=this.$4.get(d("ZenonMediaStatsConfig").OUTBOUND_SCREEN_STATS_TRACKID);b!=null&&this.$30(b,a.CoreVideoMetrics.video);c!=null&&this.$30(c,a.CoreVideoMetrics.screen)};e.$26=function(a,b){a.length===0?a.push(b.label):b.label!==a[a.length-1]&&a.push(b.label)};e.$27=function(a,b){b.totalRxLevel!=null&&b.totalRxLevelCount!=null&&b.totalRxLevelCount>0&&(a.CoreAudioMetrics.rx_chan_proc_lvl=d("ZenonCallFalcoEventUtils").nonNullIntNumber(Math.round(b.totalRxLevel/b.totalRxLevelCount)));b=this.$4.get(d("ZenonMediaStatsConfig").GLOBAL_STATS_TRACKID);if(b==null)return;var c=b.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOUDNESS_LEVEL];b=b.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL_COUNT];c&&b&&(a.receiver.rx_sum_lvl=c.getCurrentValue(),a.receiver.taulc=b.getCurrentValue())};e.$28=function(a,b){var c={},e=a.receiver,f=e.jbd;e=e.jbec;if(f!=null&&e!=null&&e>0){f=d("ZenonCallFalcoEventUtils").nonNullIntNumber(Math.round(f/e));c.neteq={meanWait:f}}e=b.maxSpeechExpandRate!=null?Math.round(b.maxSpeechExpandRate*i):null;f=b.minSpeechExpandRate!=null?Math.round(b.minSpeechExpandRate*i):null;b=b.countSpeechExpandRate!=null&&b.countSpeechExpandRate>0&&b.sumSpeechExpandRate!=null?Math.round(b.sumSpeechExpandRate*i/b.countSpeechExpandRate):null;(e!=null||b!=null||f!=null)&&(c.speech_expand_rate={M:d("ZenonCallFalcoEventUtils").nonNullIntNumber(e),avg:d("ZenonCallFalcoEventUtils").nonNullIntNumber(b),m:d("ZenonCallFalcoEventUtils").nonNullIntNumber(f)});a.DebugAudioMetrics.NetworkReceive={jb_nm:c}};e.$17=function(a,b){var c=a.cumulativeStat,e=c.bytesSent;c=c.packetsSent;var f=a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.PACKETS_LOST_CORRECTED],g=a.deltaStat.googRtt,h=a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOUDNESS_LEVEL],i=a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL_COUNT];f=new Map([["bytes",e],["plost",f],["psent",c]]);f.forEach(function(a,c){a!=null&&c!=="codec"&&c!=="ice"&&c!=="ice_g0"&&(b[c]=a.getCurrentValue())});if(e){c=e.getElapsedTime();c>0&&(b.ube_avg=Math.round(e.getDeltaValue()*8/c*1e3))}if(g){f=g.getTotal();e=g.getCount();if(e>0){b.avgrtt=Math.round(f/e);b.maxrtt=Math.max((c=b.maxrtt)!=null?c:Number.MIN_SAFE_INTEGER,g.getMax());b.minrtt=Math.min((f=b.minrtt)!=null?f:Number.MAX_SAFE_INTEGER,g.getMin())}}a.codec!=null&&a.codec!==""&&(b.codec={www:a.codec});h&&i&&(b.tx_sum_lvl=h.getCurrentValue(),b.taulc=i.getCurrentValue());return b};e.$23=function(a,b,c,e){a.codec!=null&&a.codec!==""&&(c.codec==null&&(c.codec={}),c.codec[b]=a.codec);b=a.cumulativeStat;var f=b.bytesReceived,g=b.fecPacketsDiscarded,h=b.fecPacketsReceived,i=b.googDecodingCNG,j=b.googDecodingCTN,k=b.googDecodingNormal,m=b.googDecodingPLC,n=b.googDecodingPLCCNG,o=b.insertedSamplesForDeceleration,p=b.jitterBufferDelay,q=b.jitterBufferEmittedCount,r=b.packetsReceived,s=b.removedSamplesForAcceleration,t=b.totalAudioEnergy,u=b.totalSamplesDuration;b=b.totalSamplesReceived;var v=a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.PACKETS_LOST_CORRECTED],w=a.deltaStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.E2E_LATENCY];a=a.deltaStat;var x=a.googRtt,y=a.googSpeechExpandRate;a=a.jitter;if(f){var z=f.getElapsedTime();if(z>0){var A=l(c.dbe_total_bytes,f.getDeltaValue());c.dbe_total_bytes=A;z=l(c.dbe_total_time,z);c.dbe_total_time=z;c.dbe_avg=Math.round(A*8/z*1e3)}}if(w!=null&&r!=null){e.sumAudioE2eLatency=((A=e.sumAudioE2eLatency)!=null?A:0)+w.getAverage()*r.getCurrentValue();e.countAudioE2eLatency=((z=e.countAudioE2eLatency)!=null?z:0)+r.getCurrentValue();e.sumAudioE2eLatency!=null&&e.countAudioE2eLatency>0&&(c.e2el=Math.round(e.sumAudioE2eLatency/e.countAudioE2eLatency))}if(x){e.sumrtt=((A=e.sumrtt)!=null?A:0)+x.getTotal();e.countrtt=((w=e.countrtt)!=null?w:0)+x.getCount();e.sumrtt!=null&&e.countrtt>0&&(c.avgrtt=Math.round(e.sumrtt/e.countrtt));c.maxrtt=Math.max((z=c.maxrtt)!=null?z:Number.MIN_SAFE_INTEGER,x.getMax());c.minrtt=Math.min((A=c.minrtt)!=null?A:Number.MAX_SAFE_INTEGER,x.getMin())}if(y){e.sumSpeechExpandRate=((w=e.sumSpeechExpandRate)!=null?w:0)+y.getTotal();e.countSpeechExpandRate=((z=e.countSpeechExpandRate)!=null?z:0)+y.getCount();e.maxSpeechExpandRate=Math.max((A=e.maxSpeechExpandRate)!=null?A:Number.MIN_SAFE_INTEGER,y.getMax());e.minSpeechExpandRate=Math.min((x=e.minSpeechExpandRate)!=null?x:Number.MAX_SAFE_INTEGER,y.getMin())}p&&(c.jbd=l(c.jbd,1e3*p.getCurrentValue()));t&&(c.taue=l(c.taue,1e5*t.getCurrentValue()),c.taut=l(c.taut,t.getElapsedTime()));u&&(c.sp_dur=l(c.sp_dur,1e3*u.getCurrentValue()));if(b){w=b.getCurrentValue();if(w>0&&j!=null){if(s!=null){z=Math.round(s.getCurrentValue()*j.getCurrentValue()/w);c.dec_ar=l(c.dec_ar,z)}if(o){A=Math.round(o.getCurrentValue()*j.getCurrentValue()/w);c.dec_per=l(c.dec_per,A)}}}x=new Map([["dec_plc",m],["dec_plc_cng",n],["dec_cng",i],["dec_normal",k],["neteq_calls",j],["decel_cnt",o],["bytes",f],["plost",v],["precv",r],["fecpd",g],["fecpr",h],["jbec",q],["sp_dur",u],["sp_r",b]]);x.forEach(function(a,b){a!=null&&b!=="codec"&&b!=="ice"&&b!=="ice_g0"&&(c[b]=l(c[b],a.getCurrentValue()))});if(a&&r&&c.precv!=null&&c.precv>0){y=c.precv;p=a.getTotal()*r.getCurrentValue();e.weightedJitterSum=((t=e.weightedJitterSum)!=null?t:0)+p;c.jitter=Math.round(1e3*e.weightedJitterSum/y)}return c};e.$20=function(a,b,e){a.ld=Math.round(this.__videoDurationTracker.getLocalVideoDuration());var f=a.sender||{};b.codec!=null&&b.codec!==""&&(f.ename=b.codec);if(b.histResScale){f.histResScale==null&&(f.histResScale=new Array(5).fill(0));var g=f.histResScale;g.forEach(function(a,c){g[c]+=b.histResScale[c]})}var h=b.cumulativeStat,i=h.bytesSent,k=h.captureFrameCount,m=h.firCount,n=h.framesEncoded,o=h.framesSent,p=h.keyFramesEncoded,q=h.nackCount,r=h.packetsSent,s=h.pliCount,t=h.simulcast_layer_changes,u=h.totalEncodeTime,v=h.totalPacketSendDelay,w=h.videoConvertedQpSum,x=h.videoSumCapturePixel;h=h.videoSumPixel;var y=b.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.PACKETS_LOST_CORRECTED],z=b.deltaStat,A=z.frameHeight,B=z.frameWidth,C=z.height;z=z.width;i=new Map([["enc_bytes",i],["eiframes",k],["eqps",w],["plost",y],["psent",r],["pli",s],["fcsn",o],["fir",m],["tet",u],["tpsd",v],["fcap",k],["frames",n],["kframes",p],["nack",q],["sim_l_chg",t],["ah",A],["aw",B],["ch",C],["cw",z]]);i.forEach(function(a,b){if(a!=null&&b!=="ename"&&b!=="histResScale"&&b!=="ehist"&&b!=="ss")if(a instanceof c("ZenonCumulativeMediaStat")){var d;d=(d=j[b])!=null?d:1;f[b]=l(f[b],a.getCurrentValue()*d)}else{f[b]=Math.round((d=a.getLastAddedValue())!=null?d:0)}});a.ld!=null&&a.ld>0&&f.frames!=null&&f.frames>0&&(f.efrate=Math.round(f.frames*1e3/a.ld));if(x&&f.fcap!=null&&f.fcap>0){w=f.fcap;e.videoSumCapturePixel=l((y=e.videoSumCapturePixel)!=null?y:void 0,x.getCurrentValue());f.eipxl=Math.round(e.videoSumCapturePixel/w)}if(h&&f.frames!=null&&f.frames>0){r=f.frames;e.videoSumPixel=l((s=e.videoSumPixel)!=null?s:void 0,h.getCurrentValue());f.eopxl=Math.round(e.videoSumPixel/r)}b.codecHistory!=null&&(f.ehist=Object.fromEntries(b.codecHistory.map(function(a){var b=a.codec;a=a.updateTime;return[Math.round(a).toString(),b]})));a.sender=f};e.$25=function(a,b,c){a.rd=Math.round(this.__videoDurationTracker.getRemoteVideoDuration());var e=a.receiver,f=e===void 0?{}:e;b.codec!=null&&b.codec!==""&&b.lastUpdate>((e=c.lastCodecUpdate)!=null?e:Number.MIN_SAFE_INTEGER)&&(f.dname=b.codec,c.lastCodecUpdate=b.lastUpdate);e=b.cumulativeStat;var g=e.bytesReceived,h=e.firCount,i=e.framesDecoded,j=e.framesReceived,k=e.jitterBufferDelay,m=e.jitterBufferEmittedCount,n=e.jitterBufferFramesSentToDecoder,o=e.keyFramesDecoded,p=e.nackCount,q=e.packetsReceived,r=e.pliCount,s=e.totalDecodeTime,t=e.tracktimestamp,u=e.videoConvertedQpSum,v=e.videoDecodedBytes,w=e.videoDecodeTime,x=e.videoFreezeCount,y=e.videoFreezeDuration,z=e.videoPauseCount,A=e.videoPauseDuration;e=e.videoSumPixel;var B=b.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.PACKETS_LOST_CORRECTED],C=b.deltaStat,D=C.avSync,E=C.avSyncAbs,F=C.e2eLatency,G=C.frameHeight;C=C.frameWidth;if(i){if(b.maxTotalDecodeTime!=null){f.dec_time=Math.round(Math.max(b.maxTotalDecodeTime,(b=f.dec_time)!=null?b:0))}b=l(f.frd,i.getCurrentValue());if(F&&b>0){var H;F=F.getAverage()*i.getCurrentValue();f.e2el=(H=f.e2el)!=null?H:0;f.frd=(H=f.frd)!=null?H:0;f.e2el=Math.round((f.e2el*f.frd+F)/b)}if(e!=null&&b>0){F=((H=c.aggVideoSumPixel)!=null?H:0)+e.getCurrentValue();f.dpxl=Math.round(F/b);c.aggVideoSumPixel=F}if(D!=null&&E!=null&&b>0){e=((H=c.weigtedAvSync)!=null?H:0)+D.getAverage()*i.getCurrentValue();H=((F=c.weigtedAvSyncAbs)!=null?F:0)+E.getAverage()*i.getCurrentValue();f.av=Math.round(e/b);f.avabs=Math.round(H/b);c.weigtedAvSync=e;c.weigtedAvSyncAbs=H}f.frd=b;f.dec_frame=b}if(C&&G&&t.getCurrentTime()>((D=c.lastFrameUpdate)!=null?D:Number.MIN_SAFE_INTEGER)){f.rh=(F=G.getLastAddedValue())!=null?F:0;f.rw=(E=C.getLastAddedValue())!=null?E:0;c.lastFrameUpdate=t.getCurrentTime()}s&&(f.tdt=l(f.tdt,1e3*s.getCurrentValue()));k&&(f.jbd=l(f.jbd,1e3*k.getCurrentValue()));i=new Map([["recv",g],["qps",u],["plost",B],["precv",q],["pli",r],["pact",z],["padur",A],["jbec",m],["jtasb",j],["jtfrm",n],["jtkey",o],["nack",p],["fir",h],["frcnt",x],["frdur",y],["dec_time_all_streams",w],["dec_bytes",v]]);i.forEach(function(a,b){a!=null&&b!=="dname"&&b!=="avhist"&&(f[b]=l(f[b],a.getCurrentValue()))});f.jbd!=null&&f.jbec!=null&&f.jbec>0&&(f.recjbl=Math.round(f.jbd/f.jbec));a.receiver=f};e.$19=function(a,b){var c,d=((c=a.sender)==null?void 0:c.ss)||{};d.dur=Math.round(this.__videoDurationTracker.getLocalScreenShareDuration());c=b.cumulativeStat;var e=c.captureFrameCount,f=c.framesEncoded,g=c.videoBytesSent,h=c.videoConvertedQpSum,i=c.videoSumCapturePixel;c=c.videoSumPixel;b=b.deltaStat.availableOutgoingBitrate;e=new Map([["eiframes",e],["eqps",h],["frames",f]]);e.forEach(function(a,b){a!=null&&(d[b]=a.getCurrentValue())});if(i!=null&&d.eiframes!=null&&d.eiframes>0){h=d.eiframes;d.eipxl=Math.round(i.getCurrentValue()/h)}if(c!=null&&d.frames!=null&&d.frames>0){f=d.frames;d.eopxl=Math.round(c.getCurrentValue()/f)}b&&(d.avbw=Math.round(b.getAverage()));if(g&&d.dur!=null&&d.dur>0){e=d.dur;d.avbr=Math.round(g.getCurrentValue()*8/e)}a.sender=(i=a.sender)!=null?i:{};a.sender.ss=d};e.$21=function(a,b,c){b=(b=b==null?void 0:b.deltaStat)!=null?b:{};b=b.googActualEncBitrate;c=(c=c==null?void 0:c.deltaStat)!=null?c:{};c=c.googActualEncBitrate;var d=0,e=0;b!=null&&(d+=b.getTotal(),e+=b.getCount());c!=null&&(d+=c.getTotal(),e+=c.getCount());e!==0&&(a.bwe={avg_enc_bitrate:Math.round(d/e)})};e.$24=function(a,b){var c=a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL];a=a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL_COUNT];if(c&&a){var e;b.totalRxLevel=((e=b.totalRxLevel)!=null?e:0)+c.getCurrentValue();b.totalRxLevelCount=((e=b.totalRxLevelCount)!=null?e:0)+a.getCurrentValue()}};e.$18=function(a,b){var c=a.cumulativeStat,e=c.audioDevRecStalls,f=c.audioDevStallDuration;c=c.audioDevTotalStalls;var g=a.deltaStat.audioDevIsStalled;c=new Map([["astall",c],["sdur",f],["rstall",e]]);c.forEach(function(a,c){a!=null&&c!=="audio_device"&&c!=="rx_chan_proc_lvl_hist"&&c!=="voice_detect_pct"&&(b[c]=d("ZenonCallFalcoEventUtils").nonNullIntNumber(Math.round(a.getCurrentValue())))});if(g){b.isstall=d("ZenonCallFalcoEventUtils").nonNullIntNumber((f=g.getLastAddedValue())!=null?f:0)}e=a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOUDNESS_LEVEL];c=a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL_COUNT];c!=null&&c.getCurrentValue()>0&&e!=null&&(b.captured_lvl=d("ZenonCallFalcoEventUtils").nonNullIntNumber(Math.round(e.getCurrentValue()/c.getCurrentValue())))};e.$30=function(a,b){var c=a.cumulativeStat,d=c.videoCaptureStallDuration,e=c.videoCaptureTotalStalls,f=c.videoEncodeStallDuration,g=c.videoEncodeTotalStalls,h=c.videoSentStallDuration;c=c.videoSentTotalStalls;a=a.deltaStat;var i=a.videoCaptureIsStalled,j=a.videoEncodeIsStalled;a=a.videoSentIsStalled;k(b.capture_stall,e,d,i);k(b.encode_stall,g,f,j);k(b.sent_stall,c,h,a)};return a}();function k(a,b,c,e){b=new Map([["nstall",b],["sdur",c]]);b.forEach(function(b,c){b!=null&&c!=="video_device"&&(a[c]=d("ZenonCallFalcoEventUtils").nonNullIntNumber(Math.round(b.getCurrentValue())))});if(e){a.is_stall=d("ZenonCallFalcoEventUtils").nonNullIntNumber((c=e.getLastAddedValue())!=null?c:0)}}function l(a,b){return a===void 0?Math.round(b):Math.round(a+b)}g["default"]=a}),98);
__d("ZenonAudioLevelDeriver",["ZenonCumulativeMediaStat","ZenonMediaStatsConfig"],(function(a,b,c,d,e,f,g){"use strict";var h=9.5/Math.log(32767);function i(a,b){a=Math.round(20+h*Math.log(a/b));a=Math.max(1,Math.min(a,20));return a}function j(a,b){var c=-127;a>0&&b>0&&(c=Math.round(10*Math.log10(a/b)),c=Math.max(-127,Math.min(c,0)));c+=127;return c}function k(a,b,e){a!=null&&(e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL]==null?e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL]=new(c("ZenonCumulativeMediaStat"))(a):e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL].update(e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL].getCurrentValue()+a)),b!=null&&(e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOUDNESS_LEVEL]==null?e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOUDNESS_LEVEL]=new(c("ZenonCumulativeMediaStat"))(b):e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOUDNESS_LEVEL].update(e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOUDNESS_LEVEL].getCurrentValue()+b)),e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL_COUNT]==null?e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL_COUNT]=new(c("ZenonCumulativeMediaStat"))(1):e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL_COUNT].update(e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_LOG_LEVEL_COUNT].getCurrentValue()+1)}function a(a,b){var c=0,e=0;a.filter(function(a){return a.webrtcTrack.readyState==="live"&&a.contentType==="audio"}).forEach(function(a){if(a.remote&&a.webrtcTrack.enabled===!1)return;var d=b.get(a.trackId);if(d==null||d.cumulativeStat.totalAudioEnergy==null||d.cumulativeStat.totalSamplesDuration==null)return;var f=d.cumulativeStat,g=f.totalAudioEnergy;f=f.totalSamplesDuration;g=g.getDeltaFromLastUpdate();f=f.getDeltaFromLastUpdate();if(f===0)return;if(a.remote===!0){c+=g;e=Math.max(e,f);a=i(g,f);k(a,null,d)}else{a=j(g,f);k(null,a,d)}});a=b.get(d("ZenonMediaStatsConfig").GLOBAL_STATS_TRACKID);if(a==null||e===0)return;var f=j(c,e);k(null,f,a)}g.computeAudioLevels=a}),98);
__d("ZenonAudioPlaybackIssueLogger",["ZenonMediaActionLogger"],(function(a,b,c,d,e,f,g){"use strict";var h=5e3;a=function(){function a(){this.$1=new Map()}var b=a.prototype;b.detectAudioPlaybackIssue=function(a,b){var c=this;a.filter(function(a){return a.webrtcTrack.enabled&&a.webrtcTrack.readyState==="live"&&a.contentType==="audio"&&a.remote}).forEach(function(a){var d=b.get(a.trackId);if(d==null)return;d=d.cumulativeStat;var e=d.bytesReceived;d=d.totalAudioEnergy;if(e==null||d==null||e.getTimeSinceLastUpdate()===0)return;d=d.getDeltaFromLastUpdate();var f=e.getDeltaFromLastUpdate()*8;e=e.getTimeSinceLastUpdate()/1e3;f=f/e;c.$1.has(a.trackId)||c.$1.set(a.trackId,!1);e=c.$1.get(a.trackId);d===0&&f>h?e===!1&&(c.logAudioPlaybackIssueCheckpoint("start",a.trackId,f,d),c.$1.set(a.trackId,!0)):e===!0&&(c.logAudioPlaybackIssueCheckpoint("end",a.trackId,f,d),c.$1.set(a.trackId,!1))})};b.logAudioPlaybackIssueCheckpoint=function(a,b,d,e){c("ZenonMediaActionLogger").logEvent({checkpoint:(a==="start"?"Detected new":"No longer detecting")+" audio playback issue for track "+b+". Bitrate is "+d+" bps, audio energy delta is "+e+".",mediaID:b})};return a}();b=new a();g["default"]=b}),98);
__d("ZenonAudioStallStatsDeriver",["ZenonCumulativeMediaStat","ZenonDeltaMediaStat","ZenonMediaActionLogger","ZenonMediaStatsConfig","ZenonMediaStatsParser"],(function(a,b,c,d,e,f,g){"use strict";var h=5e3;function i(a){var b=a.audioEncoding;a=a.cumulativeStat;var e=a.bytesSent,f=a["media-sourcetimestamp"];a=a[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_STALL_DURATION];var g=(b==null?void 0:b.enabled)===!1||(b==null?void 0:b.enabled)===!0&&(b==null?void 0:b.prevState)===!1;if(!g&&e!=null&&f!=null){if(e.getCurrentTimeSinceLastUpdate()>h&&a!=null){if(a.getCurrentTimeSinceLastUpdate()!==0){c("ZenonMediaActionLogger").logEvent({checkpoint:"[audio stall deriver] calculated a stall due to byteSent update time "+e.getCurrentTimeSinceLastUpdate()+" greater than threshold. audioEncoding: "+JSON.stringify((g=b)!=null?g:{})})}return a.getCurrentTimeSinceLastUpdate()}if((e.getCurrentValue()===0||e.getDeltaFromLastUpdate()===0)&&f.getDeltaFromLastUpdate()!==0){c("ZenonMediaActionLogger").logEvent({checkpoint:"[audio stall deriver] calculated a stall due to no "+(e.getCurrentValue()===0?"current bytes":"delta bytes")+".  audioEncoding: "+JSON.stringify((g=b)!=null?g:{})})}return e.getCurrentValue()===0||e.getDeltaFromLastUpdate()===0?f.getDeltaFromLastUpdate():0}return 0}function j(a){a.deltaStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_IS_STALLED]==null&&(a.deltaStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_IS_STALLED]=new(c("ZenonDeltaMediaStat"))()),a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_REC_STALLS]==null&&(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_REC_STALLS]=new(c("ZenonCumulativeMediaStat"))(0)),a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_TOTAL_STALLS]==null&&(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_TOTAL_STALLS]=new(c("ZenonCumulativeMediaStat"))(0)),a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_STALL_DURATION]==null&&(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_STALL_DURATION]=new(c("ZenonCumulativeMediaStat"))(0))}function k(a){var b=i(a),c=b===0?0:1;j(a);var e=!m(a)&&c?1:0;a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_REC_STALLS].update(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_REC_STALLS].getCurrentValue()+e);a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_TOTAL_STALLS].update(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_TOTAL_STALLS].getCurrentValue()+e);a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_STALL_DURATION].update(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_STALL_DURATION].getCurrentValue()+b);a.deltaStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_IS_STALLED].add(c)}function l(a,b){b=b?0:1;var e=!m(a)&&b?1:0;a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_REC_STALLS].update(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_REC_STALLS].getCurrentValue()+e);a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_TOTAL_STALLS].update(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_TOTAL_STALLS].getCurrentValue()+e);a.deltaStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_IS_STALLED].add(b);var f=a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_STALL_DURATION];b=b&&f?f.getCurrentTimeSinceLastUpdate():0;a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_STALL_DURATION].update(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_STALL_DURATION].getCurrentValue()+b);e!==0&&c("ZenonMediaActionLogger").logEvent({checkpoint:"[audio stall deriver] calculated additional stall due no tracks"})}function m(a){return a.deltaStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_IS_STALLED]!=null&&a.deltaStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AUDIO_DEV_IS_STALLED].getLastAddedValue()===1}function a(a,b){var c=0;a.filter(function(a){return a.contentType==="audio"&&!a.remote&&a.webrtcTrack.readyState==="live"}).forEach(function(a){c++;a=b.get(a.trackId);a!=null&&k(a)});a=d("ZenonMediaStatsParser").getOrCreateTrackerFromMap(b,d("ZenonMediaStatsConfig").OUTBOUND_AUDIO_STATS_TRACK_INFO);a!=null&&(j(a),c===0?l(a,!1):l(a,!0))}g.updateStatsWithDerivedMetric=a}),98);
__d("ZenonAvSyncDeriver",["ZenonCumulativeMediaStat","ZenonDeltaMediaStat","ZenonMediaStatsConfig"],(function(a,b,c,d,e,f,g){"use strict";function h(a){a=a.webrtcStream.getAudioTracks();return a!=null&&a.length>0?a[0].id:null}function i(a){var b;if(a.cumulativeStat.totalAudioEnergy!=null&&a.cumulativeStat.totalAudioEnergy.getDeltaFromLastUpdate()<=d("ZenonMediaStatsConfig").VOICE_ENERGY_THRESHOLD){a.isAudioEnergyLow=!0;return!0}b=(b=a.isAudioEnergyLow)!=null?b:!1;a.isAudioEnergyLow=!1;return b}function a(a,b,e){a.filter(function(a){return a.contentType==="video"&&a.remote}).forEach(function(a){var f=h(a);if(f!=null){f=b.get(f);var g=b.get(a.trackId);if(f!=null&&f.cumulativeStat.estimatedPlayoutTimestamp!=null&&g!=null&&g.cumulativeStat.estimatedPlayoutTimestamp!=null){var k,l,m;a=g.cumulativeStat.estimatedPlayoutTimestamp;var n=f.cumulativeStat.estimatedPlayoutTimestamp;k=(k=g.lastEstimatedPlayoutTimestamp)!=null?k:0;l=(l=f.lastEstimatedPlayoutTimestamp)!=null?l:0;g.lastEstimatedPlayoutTimestamp=a.getCurrentValue();f.lastEstimatedPlayoutTimestamp=n.getCurrentValue();var o=g.cumulativeStat.packetsReceived?g.cumulativeStat.packetsReceived.getDeltaFromLastUpdate()>0:!1,p=f.cumulativeStat.packetsReceived?f.cumulativeStat.packetsReceived.getDeltaFromLastUpdate()>0:!1;if(((m=g.lastEstimatedPlayoutTimestamp)!=null?m:0)<=k||((m=f.lastEstimatedPlayoutTimestamp)!=null?m:0)<=l||i(f)||!o||!p){j(g,d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC_COUNT,0);j(g,d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC_OOB,0);return}j(g,d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC_COUNT,1);k=n.getCurrentValue()-a.getCurrentValue();m=Math.abs(k);if(m>d("ZenonMediaStatsConfig").AV_SYNC_CUTOFF){j(g,d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC_OOB,1);return}j(g,d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC_OOB,0);l=[{key:d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC,value:k},{key:d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC_ABS,value:m}];l.forEach(function(a){g.deltaStat[a.key]==null&&(g.deltaStat[a.key]=new(c("ZenonDeltaMediaStat"))()),g.deltaStat[a.key].add(a.value)});e.update(m)}}})}function j(a,b,d){a.cumulativeStat[b]==null&&(a.cumulativeStat[b]=new(c("ZenonCumulativeMediaStat"))(0)),a.cumulativeStat[b].update(a.cumulativeStat[b].getCurrentValue()+d)}g.findAssociatedAudioTrackId=h;g.isMutedDuringInterval=i;g.updateTrackerWithAvSync=a}),98);
__d("ZenonE2ELatencyDeriver",["ZenonDeltaMediaStat","ZenonMediaStatsConfig"],(function(a,b,c,d,e,f,g){"use strict";var h=-22089888e5;function a(a,b){a.filter(function(a){return a.remote}).forEach(function(a){a=b.get(a.trackId);var e=d("ZenonMediaStatsConfig").DERIVED_METRICS.E2E_LATENCY;if(a!=null&&a.cumulativeStat.estimatedPlayoutTimestamp!=null&&a.cumulativeStat.estimatedPlayoutTimestamp.getDeltaFromLastUpdate()>0){var f=Date.now()-h-a.cumulativeStat.estimatedPlayoutTimestamp.getCurrentValue();a.deltaStat[e]==null&&(a.deltaStat[e]=new(c("ZenonDeltaMediaStat"))());a.deltaStat[e].add(f)}})}g.updateTrackerWithE2ELatency=a}),98);
__d("ZenonMediaElementTracker",["FBLogger","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect,i=new Map();function j(a,b){i.has(a)&&c("FBLogger")("rtc_www").warn("ZenonMediaElementTracker already has a stream associated with the given element"),i.set(a,b)}function k(a){i["delete"](a)||c("FBLogger")("rtc_www").warn("ZenonMediaElementTracker did not have a stream associated with the given element")}function a(a){for(var b=i,d=Array.isArray(b),e=0,b=d?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;var g=f[0];f=f[1];for(var f=f.getTracks(),h=Array.isArray(f),j=0,f=h?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k;if(h){if(j>=f.length)break;k=f[j++]}else{j=f.next();if(j.done)break;k=j.value}k=k;var l=a.get(k.id);if(l==null)continue;if(k.kind==="video"&&g instanceof HTMLVideoElement){if(g.videoWidth===0||g.videoHeight===0)continue;k=g.getBoundingClientRect();l.renderedWidth=k.width;l.renderedHeight=k.height;var m=k.width/g.videoWidth,n=k.height/g.videoHeight,o=getComputedStyle(g);o=o.objectFit;var p=1,q=1;switch(o){case"cover":p=Math.max(m,n);q=k.width*k.height/(p*p*g.videoWidth*g.videoHeight);break;case"contain":p=Math.min(m,n);break;default:c("FBLogger")("rtc_www").warn("Unknown object-fit type %s",o)}l.scaleRatio=p*p;l.croppingRatio=q}}}}function b(a,b){h(function(){var c=a.current;if(!b||!c)return;j(c,b);return function(){k(c)}},[a,b])}g.trackElement=j;g.untrackElement=k;g.updateStats=a;g.useMediaElementTracker=b}),98);
__d("ZenonMuteStateDeriver",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){a.forEach(function(a){var c=b.get(a.trackId);if(c==null)return;c.isMuted=!a.enabled||a.webrtcTrack.readyState==="ended"})}f.updateMuteState=a}),66);
__d("ZenonOutboundStatsWriter",["ZenonCumulativeMediaStat","ZenonDeltaMediaStat","ZenonMediaStatsConfig","ZenonMediaStatsParser"],(function(a,b,c,d,e,f,g){"use strict";var h=Object.freeze({audio:d("ZenonMediaStatsConfig").OUTBOUND_AUDIO_STATS_TRACK_INFO,screen:d("ZenonMediaStatsConfig").OUTBOUND_SCREEN_STATS_TRACK_INFO,screen_audio:d("ZenonMediaStatsConfig").OUTBOUND_SCREEN_AUDIO_STATS_TRACK_INFO,video:d("ZenonMediaStatsConfig").OUTBOUND_VIDEO_STATS_TRACK_INFO});function i(a,b,e){if(e==null)return;a.cumulativeStat[b]==null?a.cumulativeStat[b]=new(c("ZenonCumulativeMediaStat"))(e.getCurrentValue()):b==="packetsLost"||b===d("ZenonMediaStatsConfig").DERIVED_METRICS.PACKETS_LOST_CORRECTED?a.cumulativeStat[b].updateNonStrictCumulative(a.cumulativeStat[b].getCurrentValue()+e.getDeltaFromLastUpdate()):a.cumulativeStat[b].update(a.cumulativeStat[b].getCurrentValue()+e.getDeltaFromLastUpdate())}function j(a,b,d){if(d==null)return;a.deltaStat[b]==null&&(a.deltaStat[b]=new(c("ZenonDeltaMediaStat"))());d=d.getLastAddedValue();d!=null&&a.deltaStat[b].add(d)}function a(a,b){a.filter(function(a){return a.remote===!1&&a.webrtcTrack.readyState==="live"}).forEach(function(a){var c=b.get(a.trackId);if(c!=null){a=h[a.contentType];a=d("ZenonMediaStatsParser").getOrCreateTrackerFromMap(b,a);var e=c.cumulativeStat,f=c.deltaStat,g=c.histResScale;c.percentStat;c.simulcastStats;c=babelHelpers.objectWithoutPropertiesLoose(c,["cumulativeStat","deltaStat","histResScale","percentStat","simulcastStats"]);Object.assign(a,c);a.histResScale=[].concat(g);for(var k in e)i(a,k,e[k]);for(var l in f)j(a,l,f[l])}})}g.updateOutboundStats=a}),98);
__d("ZenonPacketsLostDeriver",["ZenonCumulativeMediaStat","ZenonMediaStatsConfig"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){a.filter(function(a){return a.webrtcTrack.enabled===!0&&a.webrtcTrack.readyState==="live"}).forEach(function(a){var e=b.get(a.trackId);if(e==null||e.cumulativeStat.packetsLost==null)return;var f=e.cumulativeStat.packetsLost;a.remote?a=e.cumulativeStat.packetsReceived:a=e.cumulativeStat.packetsSent;if(e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.PACKETS_LOST_CORRECTED]==null)e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.PACKETS_LOST_CORRECTED]=new(c("ZenonCumulativeMediaStat"))(f.getCurrentValue());else{a=a!=null&&a.isReset()?f.getCurrentValue():f.getDeltaFromLastUpdate();e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.PACKETS_LOST_CORRECTED].updateNonStrictCumulative(e.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.PACKETS_LOST_CORRECTED].getCurrentValue()+a)}})}g.updatePacketsLost=a}),98);
__d("ZenonVideoQualityDeriver",["ZenonMediaStatsConfig"],(function(a,b,c,d,e,f,g){"use strict";var h=1280*720;b=160*96;var i=Math.log2(h/b);c=51;var j=16,k=c-j,l=k+Math.floor(i*6);function m(a){var b=Math.max(1,Math.min(63,a));a=[1,5,12,28,42,53,64];var c=a.findIndex(function(a){return a>b});return c==null?0:Math.min(51,Math.floor(12+6*c+6*(b-a[c-1])/(a[c]-a[c-1])))}function a(a){var b=a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CONVERTED_QP_SUM],c=a.cumulativeStat.framesEncoded,e=a.deltaStat,f=e.frameHeight;e=e.frameWidth;if(b==null||c==null||f==null||e==null)return;c=c.getDeltaFromLastUpdate();b=b.getDeltaFromLastUpdate();e=e.getLastAddedValue();f=f.getLastAddedValue();if(c===0||f==null||e==null||e<=0||f<=0)return;b=b/c;if(b<=0)return;((c=a.codec)==null?void 0:c.indexOf("264"))===-1&&((c=a.codec)==null?void 0:c.indexOf("265"))===-1?a=m(b):a=b;c=Math.max(0,Math.min(k,a-j));b=e*f;a=Math.max(0,Math.min(i,Math.log2(h/b)));return Math.max(0,l-c-a*6)/l*100}g._convertToH264QP=m;g.computeVideoQuality=a}),98);
__d("ZenonPerStreamAggregator",["ZenonAvSyncDeriver","ZenonDeltaMediaStat","ZenonMediaStatsConfig","ZenonMediaStatsParser","ZenonPercentMediaStat","ZenonRenderedView","ZenonVideoQualityDeriver"],(function(a,b,c,d,e,f,g){"use strict";var h=Object.freeze({audio:d("ZenonMediaStatsConfig").OUTBOUND_AUDIO_STATS_TRACK_INFO,screen:d("ZenonMediaStatsConfig").OUTBOUND_SCREEN_STATS_TRACK_INFO,screen_audio:d("ZenonMediaStatsConfig").OUTBOUND_SCREEN_AUDIO_STATS_TRACK_INFO,video:d("ZenonMediaStatsConfig").OUTBOUND_VIDEO_STATS_TRACK_INFO});function a(a,b){s(a,b),r(a,b),q(a,b)}function i(a,b,d,e,f,g){if(d==null)return;a.percentStat[b]==null&&(a.percentStat[b]=new(c("ZenonPercentMediaStat"))());a.percentStat[b].add(d,e,f,g)}function j(a,b){return a<b?a:b}function k(a,b){var c=b.get(a.trackId),e=0;if(c==null)return e;if(a.contentType==="audio")c.cumulativeStat.totalAudioEnergy!=null&&(e=c.cumulativeStat.totalAudioEnergy.getDeltaFromLastUpdate());else{c=d("ZenonAvSyncDeriver").findAssociatedAudioTrackId(a);if(c!=null){a=b.get(c);a!=null&&a.cumulativeStat.totalAudioEnergy!=null&&(e=a.cumulativeStat.totalAudioEnergy.getDeltaFromLastUpdate(),d("ZenonAvSyncDeriver").isMutedDuringInterval(a)&&(e=0))}}return e}function l(a,b){var e,f=d("ZenonMediaStatsConfig").DERIVED_METRICS.RENDERED_VIEW;b=b.get(a.trackId);if(b==null)return c("ZenonRenderedView").GRID;b.deltaStat[f]==null&&(b.deltaStat[f]=new(c("ZenonDeltaMediaStat"))());a=(a=b.renderedView)!=null?a:c("ZenonRenderedView").GRID;e=(e=c("ZenonRenderedView").cast(b.deltaStat[f].getLastAddedValue()))!=null?e:a;b.deltaStat[f].add(a);b=j(a,e);return b}function m(a,b,c,d){if(a.cumulativeStat[c]&&a.cumulativeStat[c].getDeltaFromLastUpdate()!==0&&a.cumulativeStat[b]!=null){b=a.cumulativeStat[b].getDeltaFromLastUpdate()/a.cumulativeStat[c].getDeltaFromLastUpdate();return b*((a=d)!=null?a:1)}return null}function n(a){var b=null,c=d("ZenonMediaStatsConfig").DERIVED_METRICS.PACKETS_LOST_CORRECTED;a.cumulativeStat.packetsReceived!=null&&a.cumulativeStat[c]!=null&&a.cumulativeStat[c].getDeltaFromLastUpdate()+a.cumulativeStat.packetsReceived.getDeltaFromLastUpdate()!==0&&(b=a.cumulativeStat[c].getDeltaFromLastUpdate()/(a.cumulativeStat[c].getDeltaFromLastUpdate()+a.cumulativeStat.packetsReceived.getDeltaFromLastUpdate()));return b}function o(a,b,c){if(a.cumulativeStat[b]&&a.cumulativeStat[b].getTimeSinceLastUpdate()!==0){a=a.cumulativeStat[b].getDeltaFromLastUpdate()/a.cumulativeStat[b].getTimeSinceLastUpdate();return a*((b=c)!=null?b:1)}return null}function p(a,b,c){if(a.deltaStat[b]){a=a.deltaStat[b].getLastAddedValue();return a!=null?a*((b=c)!=null?b:1):null}return null}function q(a,b){var c=d("ZenonMediaStatsParser").getOrCreateTrackerFromMap(b,d("ZenonMediaStatsConfig").GLOBAL_STATS_TRACK_INFO),e=0,f=0,g=0,h=0,j=0,k=0;a.filter(function(a){return a.webrtcTrack.readyState==="live"&&a.webrtcTrack.muted===!1}).forEach(function(a){var c=b.get(a.trackId);if(c!=null)if(a.remote===!1)c.cumulativeStat.totalEncodeTime!=null&&c.cumulativeStat.totalEncodeTime.getTimeSinceLastUpdate()>0&&(h+=c.cumulativeStat.totalEncodeTime.getDeltaFromLastUpdate(),j+=c.cumulativeStat.totalEncodeTime.getTimeSinceLastUpdate(),k++);else{var d=o(c,"bytesReceived",8e3);if(d==null)return;a.contentType==="audio"?f+=d:g+=d;c.cumulativeStat.totalDecodeTime!=null&&c.cumulativeStat.totalDecodeTime.getTimeSinceLastUpdate()>0&&(h+=c.cumulativeStat.totalDecodeTime.getDeltaFromLastUpdate(),j+=c.cumulativeStat.totalDecodeTime.getTimeSinceLastUpdate(),k++)}});if(k>0){a=j/k;a=h*1e3/a;i(c,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.GLOBAL_CPU_USAGE,a,d("ZenonMediaStatsConfig").GLOBAL_STATS_RENDERED_VIEW,d("ZenonMediaStatsConfig").GLOBAL_STATS_CONTENT_TYPE,e)}f+g>0&&(i(c,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.GLOBAL_AUDIO_BITRATE,f,d("ZenonMediaStatsConfig").GLOBAL_STATS_RENDERED_VIEW,d("ZenonMediaStatsConfig").GLOBAL_STATS_CONTENT_TYPE,e),i(c,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.GLOBAL_VIDEO_BITRATE,g,d("ZenonMediaStatsConfig").GLOBAL_STATS_RENDERED_VIEW,d("ZenonMediaStatsConfig").GLOBAL_STATS_CONTENT_TYPE,e))}function r(a,b){a.filter(function(a){return a.remote===!1&&a.webrtcTrack.readyState==="live"}).forEach(function(a){var c=b.get(a.trackId);if(c!=null){var e=h[a.contentType];e=d("ZenonMediaStatsParser").getOrCreateTrackerFromMap(b,e);i(e,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.ROUND_TRIP_TIME,p(c,"googRtt",1),d("ZenonMediaStatsConfig").GLOBAL_STATS_RENDERED_VIEW,a.contentType,0);var f=d("ZenonVideoQualityDeriver").computeVideoQuality(c);i(e,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_QUALITY,f,d("ZenonMediaStatsConfig").GLOBAL_STATS_RENDERED_VIEW,a.contentType,0);i(e,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_ENCODED_FRAME_RATE,o(c,"framesEncoded",1e3),d("ZenonMediaStatsConfig").GLOBAL_STATS_RENDERED_VIEW,a.contentType,0);i(e,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_QP,m(c,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CONVERTED_QP_SUM,"framesEncoded",1),d("ZenonMediaStatsConfig").GLOBAL_STATS_RENDERED_VIEW,a.contentType,0)}})}function s(a,b){var e=d("ZenonMediaStatsParser").getOrCreateTrackerFromMap(b,d("ZenonMediaStatsConfig").PINNED_AUDIO_STATS_TRACK_INFO),f=d("ZenonMediaStatsParser").getOrCreateTrackerFromMap(b,d("ZenonMediaStatsConfig").PINNED_VIDEO_STATS_TRACK_INFO);a.filter(function(a){return a.webrtcTrack.readyState==="live"&&a.remote===!0}).forEach(function(a){var g=b.get(a.trackId);if(g!=null){var h=k(a,b),j=l(a,b);if(a.contentType==="audio"){var q=j===c("ZenonRenderedView").PINNED?e:g;i(q,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.AUDIO_PLC_RATE,m(g,"googDecodingPLC","googDecodingCTN"),j,a.contentType,h);i(q,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.AUDIO_PLC_CNG_RATE,m(g,"googDecodingPLCCNG","googDecodingCTN"),j,a.contentType,h);i(q,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.AUDIO_NETEQ_WAIT_TIME,m(g,"jitterBufferDelay","jitterBufferEmittedCount",1e3),j,a.contentType,h);i(q,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.AUDIO_PACKET_LOSS_RATE,n(g),j,a.contentType,h)}else if(a.contentType==="video"){q=j===c("ZenonRenderedView").PINNED?f:g;i(q,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_NETEQ_WAIT_TIME,m(g,"jitterBufferDelay","jitterBufferEmittedCount",1e3),j,a.contentType,h);if(g.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC_COUNT]!=null&&g.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC_COUNT].getDeltaFromLastUpdate()>0){var r=0;g.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC_OOB]==null||g.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC_OOB].getDeltaFromLastUpdate()===0?i(q,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_AV_SYNC_ABS,p(g,d("ZenonMediaStatsConfig").DERIVED_METRICS.AV_SYNC_ABS,1),j,a.contentType,h):r=1;i(q,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_AV_SYNC_OOB,r,j,a.contentType,h)}i(q,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_FRAME_RATE,o(g,"framesDecoded",1e3),j,a.contentType,h);i(q,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_FREEZE_COUNT_PER_MIN,o(g,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_FREEZE_COUNT,6e4),j,a.contentType,h);i(q,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_FREEZE_DURATION_PER_MIN,o(g,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_FREEZE_DURATION,6e4),j,a.contentType,h);i(q,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_PACKET_LOSS_RATE,n(g),j,a.contentType,h);i(q,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_RENDER_SCALE_RATIO,g.scaleRatio,j,a.contentType,h);i(q,d("ZenonMediaStatsConfig").PER_STREAM_AGG_METRICS.VIDEO_CROPPING_RATIO,g.croppingRatio,j,a.contentType,h)}}})}g.aggregatePerStream=a}),98);
__d("ZenonResourceUsageStatsTracker",["FBLogger","Promise","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function d(){var a;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.prev=0;d.next=3;return b("regeneratorRuntime").awrap(h());case 3:a=d.sent;return d.abrupt("return",a);case 7:d.prev=7,d.t0=d["catch"](0),c("FBLogger")("rtc_www").warn(d.t0);case 10:return d.abrupt("return",null);case 11:case"end":return d.stop()}},null,this,[[0,7]])}function h(){var c="gdpnckbgamaigmkbcklkeoipnfaalgad";return new(b("Promise"))(function(b,d){var e;(e=a.chrome)==null?void 0:(e=e.runtime)==null?void 0:e.sendMessage(c,"",function(a){var c=[];if(a)Object.keys(a).forEach(function(b){b=a[b];c.push.apply(c,b)});else{d("No response from cpu monitoring extension");return}var e=0,f=0,g=0,h=0;c.length>0&&(c.sort(function(a,b){return a.timestamp>b.timestamp?1:-1}),e=Math.round(c.reduce(function(a,b){return a+b.cpu},0)/c.length),h=Math.round(c[c.length-1].cpu),f=Math.round(Math.max.apply(Math,c.map(function(a){return a.cpu}).concat([0]))),g=Math.round(Math.min.apply(Math,c.map(function(a){return a.cpu}))));e={avgCpu:e,maxCpu:f,minCpu:g,mostRecentCpu:h};b(e)})})}g.getProcessStats=d}),98);
__d("ZenonVideoCaptureMetricDeriver",["ZenonCumulativeMediaStat","ZenonMediaStatsConfig"],(function(a,b,c,d,e,f,g){"use strict";var h={VIDEO_CAPTURE_FRAME_COUNT_STAT_KEY:d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_FRAME_COUNT,VIDEO_SUM_CAPTURE_PIXEL_STAT_KEY:d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SUM_CAPTURE_PIXEL,calculateVideoCaptureFrameCount:function(a){var b=a.cumulativeStat.tracktimestamp,c=a.deltaStat.framesPerSecond;if(c!=null&&b!=null&&b.getCurrentValue()>a.lastUpdate&&b.getDeltaFromLastUpdate()!==b.getCurrentValue()){a=c.getLastAddedValue();c=b.getDeltaFromLastUpdate();if(typeof a==="number"){b=Math.round(a*c/1e3);return b}}return 0},calculateVideoSumCapturePixel:function(a,b){var c=a.cumulativeStat,d=c.captureFrameCount;c=c.tracktimestamp;var e=a.deltaStat,f=e.height;e=e.width;if(d!=null&&e!=null&&f!=null&&c!=null&&c.getCurrentValue()>a.lastUpdate){c=b?d.getCurrentValue():d.getDeltaFromLastUpdate();b=(a=e.getLastAddedValue())!=null?a:0;e=(d=f.getLastAddedValue())!=null?d:0;a=c*b*e;return a}return 0},updateStatsWithDerivedMetric:function(a,b){var e=["video","screen"];a.filter(function(a){return e.includes(a.contentType)&&a.remote===!1}).forEach(function(a){a=b.get(a.trackId);if(a!=null){if(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_FRAME_COUNT]!=null){var e=a.cumulativeStat.framesEncoded;if(e!=null)if(e.getDeltaFromLastUpdate()<0)a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_FRAME_COUNT].update(0);else{e=h.calculateVideoCaptureFrameCount(a);a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_FRAME_COUNT].getCurrentValue()===0&&(e+=e);a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_FRAME_COUNT].update(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_FRAME_COUNT].getCurrentValue()+e)}}else a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_FRAME_COUNT]=new(c("ZenonCumulativeMediaStat"))(0);if(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SUM_CAPTURE_PIXEL]!=null){e=a.cumulativeStat.captureFrameCount;e=e.getDeltaFromLastUpdate()<0;var f=h.calculateVideoSumCapturePixel(a,e);e?a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SUM_CAPTURE_PIXEL].update(f):a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SUM_CAPTURE_PIXEL].update(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SUM_CAPTURE_PIXEL].getCurrentValue()+f)}else{e=h.calculateVideoSumCapturePixel(a,!0);a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SUM_CAPTURE_PIXEL]=new(c("ZenonCumulativeMediaStat"))(e)}}})}};a=h;g["default"]=a}),98);
__d("ZenonVideoConvertedQpDeriver",["ZenonCumulativeMediaStat","ZenonMediaStatsConfig","ZenonVideoQpConversion"],(function(a,b,c,d,e,f,g){"use strict";var h=["video","screen"],i={calculateVideoConvertedQP:function(a){var b=a.cumulativeStat,c=b.framesDecoded,e=b.framesEncoded,f=b.qpSum;b=b.tracktimestamp;var g=a.codec;e=e!=null?e:c;if(f!=null&&e!=null&&g!=null&&b!=null&&b.getCurrentValue()>a.lastUpdate){c=e.getCount()===1||f.getCount()===1;c?(b=f.getCurrentValue(),a=e.getCurrentValue()):(b=f.getDeltaFromLastUpdate(),a=e.getDeltaFromLastUpdate());c=g.includes("264");f=d("ZenonVideoQpConversion").convertQp(a,b,c);return f*a}return 0},updateStatsWithDerivedMetric:function(a,b){a.filter(function(a){return h.includes(a.contentType)&&a.webrtcTrack.readyState==="live"&&a.webrtcTrack.muted===!1}).forEach(function(a){a=b.get(a.trackId);if(a!=null){var e=a.cumulativeStat.qpSum;if(e!=null){e=e.getDeltaFromLastUpdate()<0;var f=i.calculateVideoConvertedQP(a),g=d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CONVERTED_QP_SUM;a.cumulativeStat[g]!=null?e?a.cumulativeStat[g].update(f):a.cumulativeStat[g].update(a.cumulativeStat[g].getCurrentValue()+f):a.cumulativeStat[g]=new(c("ZenonCumulativeMediaStat"))(f)}}})}};a=i;g["default"]=a}),98);
__d("ZenonVideoDecodeTimeDeriver",["ZenonCumulativeMediaStat","ZenonMediaStatsConfig"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){var d=a.filter(function(a){return a.contentType!=="audio"&&a.remote&&a.webrtcTrack.readyState!=="ended"}).reduce(function(a,d){d=b.get(d.trackId);if(d!=null&&d.cumulativeStat.framesDecoded!=null&&d.cumulativeStat.framesDecoded.getDeltaFromLastUpdate()>0){var e=d.cumulativeStat.framesDecoded.getTimeSinceLastUpdate();d.cumulativeStat.framesDecoded.getCount()===2&&(e+=h(d.cumulativeStat.framesDecoded,c));return Math.max(e,a)}return a},0);b.forEach(function(a){if(a.cumulativeStat.framesDecoded!=null){a.maxTotalDecodeTime=((a=a.maxTotalDecodeTime)!=null?a:0)+d}})}function b(a,b,e){a.filter(function(a){return a.contentType!=="audio"&&a.remote&&a.webrtcTrack.readyState!=="ended"}).forEach(function(a){a=b.get(a.trackId);if(a!=null&&a.cumulativeStat.framesDecoded!=null&&a.cumulativeStat.framesDecoded.getDeltaFromLastUpdate()>0){var f=a.cumulativeStat.framesDecoded.getTimeSinceLastUpdate();a.cumulativeStat.framesDecoded.getCount()===2&&(f+=h(a.cumulativeStat.framesDecoded,e));a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_DECODE_TIME]==null?a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_DECODE_TIME]=new(c("ZenonCumulativeMediaStat"))(f):a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_DECODE_TIME].update(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_DECODE_TIME].getCurrentValue()+f)}})}function h(a,b){return a.getDeltaFromLastUpdate()>0?Math.round(b*a.getFirstValue()/a.getDeltaFromLastUpdate()):0}g.findMaxDecodeTime=a;g.updateTrackerWithDecodeTime=b}),98);
__d("ZenonVideoDecodedBytesDeriver",["ZenonCumulativeMediaStat","ZenonMediaStatsConfig"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){a.filter(function(a){return a.contentType!=="audio"&&a.remote&&a.webrtcTrack.readyState!=="ended"}).forEach(function(a){a=b.get(a.trackId);if(a!=null){var e=a.cumulativeStat,f=e.bytesReceived;e=e.framesDecoded;if(f&&e){var g=e.getElapsedTime()===0&&e.getCurrentValue()>0;if(g||e.getDeltaFromLastUpdate()>0){e=f.getDeltaFromLastUpdate();g&&(e=f.getCurrentValue());a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_DECODED_BYTES]==null?a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_DECODED_BYTES]=new(c("ZenonCumulativeMediaStat"))(e):a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_DECODED_BYTES].update(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_DECODED_BYTES].getCurrentValue()+e)}}}})}g.updateTrackerWithDecodedBytes=a}),98);
__d("ZenonVideoFreezeCountDeriver",["ZenonCumulativeMediaStat","ZenonMediaStatsConfig"],(function(a,b,c,d,e,f,g){"use strict";var h=10,i={calculateVideoFreeze:function(a){a=a.cumulativeStat;var b=a.framesDecoded,c=a.totalInterFrameDelay;a=a.totalSquaredInterFrameDelay;if(b!=null&&c!=null&&a!=null&&b.getDeltaFromLastUpdate()>0){var d=b.getDeltaFromLastUpdate(),e=b.getAverageOverTime()*1e3;c=c.getDeltaFromLastUpdate();a=a.getDeltaFromLastUpdate();e=1/e;var f=e*h/100;e=Math.max(3*e,e+.15);var g=(f*f*d+e*e*(d-1)/d)/d;a=(a-c*c/d)/d;c=a>g?1:0;g=0;if(c)if(d>1){a=a-f*f;g=Math.sqrt(a*d*d/(d-1))*1e3}else g=b.getTimeSinceLastUpdate()/2>e*1e3?b.getTimeSinceLastUpdate()/2:0;return{count:c,duration:g}}return{count:0,duration:0}},updateStatsWithDerivedMetric:function(a,b){var e=d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_FREEZE_COUNT,f=d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_FREEZE_DURATION;a.filter(function(a){return a.contentType==="video"&&a.remote&&a.webrtcTrack.readyState!=="ended"}).forEach(function(a){a=b.get(a.trackId);if(a!=null){var d=i.calculateVideoFreeze(a);a.cumulativeStat[e]!=null?a.cumulativeStat[e].update(a.cumulativeStat[e].getCurrentValue()+d.count):a.cumulativeStat[e]=new(c("ZenonCumulativeMediaStat"))(d.count);a.cumulativeStat[f]!=null?a.cumulativeStat[f].update(a.cumulativeStat[f].getCurrentValue()+d.duration):a.cumulativeStat[f]=new(c("ZenonCumulativeMediaStat"))(d.duration)}})}};a=i;g["default"]=a}),98);
__d("ZenonVideoPauseDeriver",["ZenonCumulativeMediaStat","ZenonMediaStatsConfig"],(function(a,b,c,d,e,f,g){"use strict";var h=5e3;function a(a,b){a.filter(function(a){return a.contentType==="video"&&a.remote}).forEach(function(a){a=b.get(a.trackId);a!=null&&i(a)})}function i(a){var b=a.cumulativeStat,e=b.framesDecoded;b=b.packetsReceived;if(b!=null){var f;f=(f=a.isVideoPaused)!=null?f:!1;if(!f)b.getDeltaFromLastUpdate()===0&&b.getTimeSinceLastUpdate()>1e3&&(a.isVideoPaused=!0,a.lastVideoPacketTime=b.getPreviousTime());else if(e!=null&&e.getDeltaFromLastUpdate()>0){a.isVideoPaused=!1;e=(b.getCurrentTime()+b.getPreviousTime())/2-((f=a.lastVideoPacketTime)!=null?f:b.getPreviousTime());a.lastVideoPacketTime=void 0;e>=h&&(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_PAUSE_COUNT]!=null?a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_PAUSE_COUNT].update(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_PAUSE_COUNT].getCurrentValue()+1):a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_PAUSE_COUNT]=new(c("ZenonCumulativeMediaStat"))(1),a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_PAUSE_DURATION]!=null?a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_PAUSE_DURATION].update(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_PAUSE_DURATION].getCurrentValue()+e):a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_PAUSE_DURATION]=new(c("ZenonCumulativeMediaStat"))(e))}}}g.updateVideoPause=a}),98);
__d("ZenonVideoStallStatsDeriver",["ZenonCumulativeMediaStat","ZenonDeltaMediaStat","ZenonMediaStatsConfig","ZenonMediaStatsParser"],(function(a,b,c,d,e,f,g){"use strict";var h=1e4,i=1500,j=6e3,k=[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_IS_STALLED,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_ENCODE_IS_STALLED,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SENT_IS_STALLED],l=[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_STALL_DURATION,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_ENCODE_STALL_DURATION,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SENT_STALL_DURATION],m=[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_TOTAL_STALLS,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_ENCODE_TOTAL_STALLS,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SENT_TOTAL_STALLS],n=function(a){return((a=a==null?void 0:a.getCurrentTimeSinceLastUpdate())!=null?a:0)>j};function o(a,b){var c=0;b!=null&&r(a)&&(c=b.getDeltaFromLastUpdate());return c}function p(a,b){var c=0;b!=null&&s(a)&&(c=b.getDeltaFromLastUpdate());return c}function q(a,b,c){var d=0;c!=null&&t(a,b)&&(d=c.getDeltaFromLastUpdate());return d}function r(a){var b=!1;a!=null&&a.getElapsedTime()!==0&&(b=n(a)||a.getDeltaFromLastUpdate()===0||a.getCurrentValue()===0);return b}function s(a){var b=!1;a!=null&&a.getElapsedTime()!==0&&(b=n(a)||a.getDeltaFromLastUpdate()===0||a.getCurrentValue()===0);return b}function t(a,b){var c=!1;if(b!=null&&b.getElapsedTime()!==0){var d=h;a.contentType==="screen"&&(d=i);c=n(b)||b.getDeltaFromLastUpdate()<=d||b.getCurrentValue()===0}return c}function u(a){k.forEach(function(b){a.deltaStat[b]==null&&(a.deltaStat[b]=new(c("ZenonDeltaMediaStat"))())}),l.forEach(function(b){a.cumulativeStat[b]==null&&(a.cumulativeStat[b]=new(c("ZenonCumulativeMediaStat"))(0))}),m.forEach(function(b){a.cumulativeStat[b]==null&&(a.cumulativeStat[b]=new(c("ZenonCumulativeMediaStat"))(0))})}function v(a,b){var c=b.cumulativeStat,e=c.bytesSent,f=c.captureFrameCount,g=c.framesEncoded;c=c["media-sourcetimestamp"];var h=b.videoEncoding;if(a.webrtcTrack.enabled===!1)return;else if((h==null?void 0:h.enabled)===!1)return;h=o(f,c);w(b,h,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_IS_STALLED,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_STALL_DURATION,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_CAPTURE_TOTAL_STALLS);f=p(g,c);w(b,f,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_ENCODE_IS_STALLED,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_ENCODE_STALL_DURATION,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_ENCODE_TOTAL_STALLS);h=q(a,e,c);w(b,h,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SENT_IS_STALLED,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SENT_STALL_DURATION,d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SENT_TOTAL_STALLS)}function w(a,b,c,d,e){var f=b===0?0:1,g=!x(a,c)&&f?1:0;a.cumulativeStat[e].update(a.cumulativeStat[e].getCurrentValue()+g);a.cumulativeStat[d].update(a.cumulativeStat[d].getCurrentValue()+b);a.deltaStat[c].add(f)}function x(a,b){return a.deltaStat[b]!=null&&a.deltaStat[b].getLastAddedValue()===1}function a(a,b){a.filter(function(a){return(a.contentType==="video"||a.contentType==="screen")&&!a.remote}).forEach(function(a){var c=d("ZenonMediaStatsParser").getOrCreateTrackerFromMap(b,d("ZenonMediaStatsConfig").OUTBOUND_VIDEO_STATS_TRACK_INFO);a.contentType==="screen"&&(c=d("ZenonMediaStatsParser").getOrCreateTrackerFromMap(b,d("ZenonMediaStatsConfig").OUTBOUND_SCREEN_STATS_TRACK_INFO));c!=null&&(u(c),v(a,c))})}g.updateStatsWithDerivedMetric=a}),98);
__d("ZenonVideoSumPixelDeriver",["ZenonCumulativeMediaStat","ZenonMediaStatsConfig"],(function(a,b,c,d,e,f,g){"use strict";var h=["video","screen"],i={calculateVideoSumPixel:function(a,b,c){var d=a.cumulativeStat,e=d.framesDecoded,f=d.framesEncoded;d=d.tracktimestamp;var g=a.deltaStat,h=g.frameHeight;g=g.frameWidth;c=c?e:f;if(c!=null&&g!=null&&h!=null&&d!=null&&d.getCurrentValue()>a.lastUpdate){e=b?c.getCurrentValue():c.getDeltaFromLastUpdate();d=(f=g.getLastAddedValue())!=null?f:0;b=(a=h.getLastAddedValue())!=null?a:0;c=e*d*b;return c}return 0},updateStatsWithDerivedMetric:function(a,b){a.filter(function(a){return h.includes(a.contentType)}).forEach(function(a){var e=a.remote;a=b.get(a.trackId);if(a!=null)if(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SUM_PIXEL]!=null){var f=a.cumulativeStat,g=f.framesDecoded;f=f.framesEncoded;g=e?g:f;if(g!=null){f=g.getDeltaFromLastUpdate()<0;g=i.calculateVideoSumPixel(a,f,e);f?a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SUM_PIXEL].update(g):a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SUM_PIXEL].update(a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SUM_PIXEL].getCurrentValue()+g)}}else{f=i.calculateVideoSumPixel(a,!0,e);a.cumulativeStat[d("ZenonMediaStatsConfig").DERIVED_METRICS.VIDEO_SUM_PIXEL]=new(c("ZenonCumulativeMediaStat"))(f)}})}};a=i;g["default"]=a}),98);
__d("ZenonMediaStatsReportPoller",["Promise","UserAgent","ZenonAudioLevelDeriver","ZenonAudioPlaybackIssueLogger","ZenonAudioStallStatsDeriver","ZenonAvSyncDeriver","ZenonE2ELatencyDeriver","ZenonMediaElementTracker","ZenonMediaStatsConfig","ZenonMediaStatsParser","ZenonMuteStateDeriver","ZenonOutboundStatsWriter","ZenonPacketsLostDeriver","ZenonPerStreamAggregator","ZenonResourceUsageStatsTracker","ZenonSpeakerTracker","ZenonTSLogDataHelper","ZenonVideoCaptureMetricDeriver","ZenonVideoConvertedQpDeriver","ZenonVideoDecodeTimeDeriver","ZenonVideoDecodedBytesDeriver","ZenonVideoFreezeCountDeriver","ZenonVideoPauseDeriver","ZenonVideoScaleHistogram","ZenonVideoStallStatsDeriver","ZenonVideoSumPixelDeriver","gkx","immutable","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return b.toArray().find(function(b){return b.trackIDs.contains(a.trackId)})}function i(a,e,f,g,i,j,k){var l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:l=f.getSenders().map(function(f){var j,l,m,n,o;return b("regeneratorRuntime").async(function(p){while(1)switch(p.prev=p.next){case 0:l=(j=f.track)==null?void 0:j.id;if(!(l!=null)){p.next=12;break}m=a.find(function(a){return a.trackId===l});if(!(m!=null&&m.webrtcTrack.readyState!=="ended")){p.next=12;break}p.next=6;return b("regeneratorRuntime").awrap(f.getStats());case 6:n=p.sent,o=d("ZenonMediaStatsParser").makeStatsReportMap(n),c("gkx")("965758")&&d("ZenonTSLogDataHelper").addData(g,m.enabled,d("ZenonMediaStatsParser").filterMediaReports(o),d("ZenonMediaStatsConfig").TSLOG_STATS_REQUESTED,m.contentType,h(m,i)),d("ZenonMediaStatsParser").updateTrackStatsWithReport(m,e,o),d("ZenonMediaStatsParser").updateTrackStatsFromSender(m,e,f),k.push(m);case 12:case"end":return p.stop()}},null,this)});n.next=3;return b("regeneratorRuntime").awrap(b("Promise").all(l));case 3:m=f.getReceivers().map(function(f){var k,l,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:l=(k=f.track)==null?void 0:k.id;if(!(l!=null)){q.next=11;break}m=a.find(function(a){return a.trackId===l});if(!(m!=null&&m.webrtcTrack.readyState!=="ended")){q.next=11;break}q.next=6;return b("regeneratorRuntime").awrap(f.getStats());case 6:n=q.sent,o=d("ZenonMediaStatsParser").makeStatsReportMap(n),c("gkx")("965758")&&(p=m.contentType==="audio"?m.userMuted:m.enabled,d("ZenonTSLogDataHelper").addData(g,p,d("ZenonMediaStatsParser").filterMediaReports(o),d("ZenonMediaStatsConfig").TSLOG_STATS_REQUESTED,m.contentType,h(m,i))),d("ZenonMediaStatsParser").updateTrackStatsWithReport(m,e,o),j.push(m);case 11:case"end":return q.stop()}},null,this)});n.next=6;return b("regeneratorRuntime").awrap(b("Promise").all(m));case 6:case"end":return n.stop()}},null,this)}function j(a,e,f,g,i){var j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:j=function(){return new(b("Promise"))(function(a){f.getStats(a)})};m.next=3;return b("regeneratorRuntime").awrap(j());case 3:k=m.sent,l=d("ZenonMediaStatsParser").makeStatsReportMap(k),a.forEach(function(a){a.webrtcTrack.readyState!=="ended"&&(c("gkx")("965758")&&d("ZenonTSLogDataHelper").addData(g,a.enabled,d("ZenonMediaStatsParser").filterLegacyMediaReports(a,l),d("ZenonMediaStatsConfig").TSLOG_STATS_REQUESTED,a.contentType,h(a,i)),d("ZenonMediaStatsParser").updateTrackStatsWithChromiumLegacyReport(a,e,l))});case 6:case"end":return m.stop()}},null,this)}function k(a,b){a.forEach(function(a){a=b.get(a.trackId);a!=null&&a.cumulativeStat.tracktimestamp!=null&&(a.lastUpdate=a.cumulativeStat.tracktimestamp.getCurrentValue())})}function a(a,e,f,g,h,l,m){var n,o,p,q,r;return b("regeneratorRuntime").async(function(s){while(1)switch(s.prev=s.next){case 0:m===void 0&&(m=c("immutable").Map());n=[];o=[];s.next=5;return b("regeneratorRuntime").awrap(i(a,e,g,h,m,n,o));case 5:if(!(c("UserAgent").isBrowser("Chrome")||c("UserAgent").isBrowser("Opera")||c("UserAgent").isBrowser("Edge (Chromium Based)"))){s.next=8;break}s.next=8;return b("regeneratorRuntime").awrap(j(a,e,g,h,m));case 8:d("ZenonMediaElementTracker").updateStats(e);if(!c("gkx")("965758")){s.next=23;break}s.next=12;return b("regeneratorRuntime").awrap(g.getStats());case 12:p=s.sent;q=d("ZenonMediaStatsParser").makeStatsReportMap(p);d("ZenonTSLogDataHelper").addCandidatePairStats(h,q);d("ZenonTSLogDataHelper").addNonMediaStates(h);d("ZenonTSLogDataHelper").addRenderedFrameData(e,q,h);s.next=19;return b("regeneratorRuntime").awrap(d("ZenonResourceUsageStatsTracker").getProcessStats());case 19:r=s.sent,r!=null&&d("ZenonTSLogDataHelper").addCallCpuData(d("ZenonMediaStatsConfig").GLOBAL_STATS_TRACKID,r,h),d("ZenonTSLogDataHelper").addSenderVideoStallData(e,h),d("ZenonTSLogDataHelper").advance(h);case 23:d("ZenonSpeakerTracker").updateStats(a,e),d("ZenonPacketsLostDeriver").updatePacketsLost(a,e),d("ZenonMuteStateDeriver").updateMuteState(a,e),c("ZenonVideoFreezeCountDeriver").updateStatsWithDerivedMetric(a,e),d("ZenonVideoPauseDeriver").updateVideoPause(a,e),c("ZenonVideoCaptureMetricDeriver").updateStatsWithDerivedMetric(a,e),c("ZenonVideoSumPixelDeriver").updateStatsWithDerivedMetric(a,e),c("ZenonVideoConvertedQpDeriver").updateStatsWithDerivedMetric(a,e),d("ZenonVideoDecodedBytesDeriver").updateTrackerWithDecodedBytes(a,e),d("ZenonVideoDecodeTimeDeriver").findMaxDecodeTime(a,e,l),d("ZenonVideoDecodeTimeDeriver").updateTrackerWithDecodeTime(a,e,l),d("ZenonVideoScaleHistogram").updateTrackerWithScaleHistogram(a,e),d("ZenonE2ELatencyDeriver").updateTrackerWithE2ELatency(a,e),d("ZenonAudioLevelDeriver").computeAudioLevels(a,e),d("ZenonAudioStallStatsDeriver").updateStatsWithDerivedMetric(a,e),d("ZenonVideoStallStatsDeriver").updateStatsWithDerivedMetric(a,e),d("ZenonAvSyncDeriver").updateTrackerWithAvSync(a,e,f),d("ZenonOutboundStatsWriter").updateOutboundStats(o,e),d("ZenonPerStreamAggregator").aggregatePerStream([].concat(n,o),e),c("ZenonAudioPlaybackIssueLogger").detectAudioPlaybackIssue(a,e),k(a,e);case 44:case"end":return s.stop()}},null,this)}g.updateStatsFromConnection=a}),98);
__d("ZenonLayout",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["Grid","DominantSpeaker"]);c=a;f["default"]=c}),66);
__d("ZenonSpeakerTracker",["ZenonCallsHooks","ZenonLayout","ZenonRenderedView","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect,i=null,j=[],k=[];function l(a,b,c){i=a,j=b,k=c}function a(a,b){for(var a=a,d=Array.isArray(a),e=0,a=d?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;if(!f.remote)continue;var g=b.get(f.trackId);if(!g)continue;g.isDominantSpeaker=j.indexOf(f.trackId)!==-1;if(i!=null)switch(i){case c("ZenonLayout").Grid:g.renderedView=c("ZenonRenderedView").GRID;break;case c("ZenonLayout").DominantSpeaker:f=k.indexOf(f.trackId)!==-1;g.renderedView=f?c("ZenonRenderedView").PINNED:c("ZenonRenderedView").THUMBNAIL;break}}}function b(a,b,d){var e,f=(e=c("ZenonCallsHooks").useLiveMediaTrack((e=b)!=null?e:"","video"))==null?void 0:e.trackId,g=(b=c("ZenonCallsHooks").useLiveMediaTrack((e=b)!=null?e:"","audio"))==null?void 0:b.trackId,i=(b=c("ZenonCallsHooks").useLiveMediaTrack((e=d)!=null?e:"","video"))==null?void 0:b.trackId,j=(b=c("ZenonCallsHooks").useLiveMediaTrack((e=d)!=null?e:"","audio"))==null?void 0:b.trackId;h(function(){l(a,[f,g],[i,j])},[i,j,a,f,g])}g.updateLayout=l;g.updateStats=a;g.useUpdateSpeakerTracker=b}),98);
__d("StructuredConfigBase",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){this.$1=a}var b=a.prototype;b.getBool=function(a){return this.$1.getValue(a)>0};b.getInt=function(a){return this.$1.getValue(a)};return a}();f["default"]=a}),66);
__d("Configs",["StructuredConfigBase"],(function(a,b,c,d,e,f){"use strict";c=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$ExampleConfig1=c.getBool(0),c.$ExampleConfig2=c.getBool(2),c.$ExampleConfig3=c.getInt(1),c.$ExampleConfig4=c.getInt(3),b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.updateParams=function(){this.$ExampleConfig1=this.getBool(0),this.$ExampleConfig2=this.getBool(2),this.$ExampleConfig3=this.getInt(1),this.$ExampleConfig4=this.getInt(3)};c.isEnabled=function(){return this.$ExampleConfig1};c.isSomeBoolean=function(){return this.$ExampleConfig2};c.getSomeInteger=function(){return this.$ExampleConfig3};c.getSomeOtherInteger=function(){return this.$ExampleConfig4};return b}(a=b("StructuredConfigBase"));d=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$SimulcastOverSignalingConfig1=c.getBool(651),b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.updateParams=function(){this.$SimulcastOverSignalingConfig1=this.getBool(651)};c.isSimulcastOverSignalingEnabled=function(){return this.$SimulcastOverSignalingConfig1};return b}(a);f=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$ZenonSdpTransformConfig1=c.getBool(244),c.$ZenonSdpTransformConfig2=c.getBool(420),c.$ZenonSdpTransformConfig3=c.getBool(421),c.$ZenonSdpTransformConfig4=c.getBool(245),c.$ZenonSdpTransformConfig5=c.getBool(246),c.$ZenonSdpTransformConfig6=c.getBool(248),c.$ZenonSdpTransformConfig7=c.getBool(1448),c.$ZenonSdpTransformConfig8=c.getBool(1444),c.$ZenonSdpTransformConfig9=c.getBool(1445),c.$ZenonSdpTransformConfig10=c.getInt(1446),c.$ZenonSdpTransformConfig11=c.getInt(1447),b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.updateParams=function(){this.$ZenonSdpTransformConfig1=this.getBool(244),this.$ZenonSdpTransformConfig2=this.getBool(420),this.$ZenonSdpTransformConfig3=this.getBool(421),this.$ZenonSdpTransformConfig4=this.getBool(245),this.$ZenonSdpTransformConfig5=this.getBool(246),this.$ZenonSdpTransformConfig6=this.getBool(248),this.$ZenonSdpTransformConfig7=this.getBool(1448),this.$ZenonSdpTransformConfig8=this.getBool(1444),this.$ZenonSdpTransformConfig9=this.getBool(1445),this.$ZenonSdpTransformConfig10=this.getInt(1446),this.$ZenonSdpTransformConfig11=this.getInt(1447)};c.isPreserveH264=function(){return this.$ZenonSdpTransformConfig1};c.isPreferH264ForMwCall=function(){return this.$ZenonSdpTransformConfig2};c.isPreferSwH264=function(){return this.$ZenonSdpTransformConfig3};c.isAddAudioNack=function(){return this.$ZenonSdpTransformConfig4};c.isDisableOpusStereo=function(){return this.$ZenonSdpTransformConfig5};c.isPreferIsacForGroupAudio=function(){return this.$ZenonSdpTransformConfig6};c.isEnableOpusFmtpMunging=function(){return this.$ZenonSdpTransformConfig7};c.isSetOpusUsedtx=function(){return this.$ZenonSdpTransformConfig8};c.isSetOpusUseinbandfec=function(){return this.$ZenonSdpTransformConfig9};c.getSetOpusMaxplaybackrate=function(){return this.$ZenonSdpTransformConfig10};c.getSetOpusMaxaveragebitrate=function(){return this.$ZenonSdpTransformConfig11};return b}(a);b=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$ZenonPeerConnectionConfig1=c.getBool(302),b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.updateParams=function(){this.$ZenonPeerConnectionConfig1=this.getBool(302)};c.isRtpDataChannels=function(){return this.$ZenonPeerConnectionConfig1};return b}(a);var g=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.$ZenonStartCallImmediatelyConfig1=c.getBool(308),a)||babelHelpers.assertThisInitialized(c)}var c=a.prototype;c.updateParams=function(){this.$ZenonStartCallImmediatelyConfig1=this.getBool(308)};c.isEnabled=function(){return this.$ZenonStartCallImmediatelyConfig1};return a}(a),h=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.$ZenonMultiCallSupportConfig1=c.getInt(309),a)||babelHelpers.assertThisInitialized(c)}var c=a.prototype;c.updateParams=function(){this.$ZenonMultiCallSupportConfig1=this.getInt(309)};c.getMaxConnectedCalls=function(){return this.$ZenonMultiCallSupportConfig1};return a}(a),i=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.$ZenonPlatformSupportConfig1=c.getBool(316),c.$ZenonPlatformSupportConfig2=c.getBool(318),c.$ZenonPlatformSupportConfig3=c.getInt(317),c.$ZenonPlatformSupportConfig4=c.getInt(319),a)||babelHelpers.assertThisInitialized(c)}var c=a.prototype;c.updateParams=function(){this.$ZenonPlatformSupportConfig1=this.getBool(316),this.$ZenonPlatformSupportConfig2=this.getBool(318),this.$ZenonPlatformSupportConfig3=this.getInt(317),this.$ZenonPlatformSupportConfig4=this.getInt(319)};c.isSupportsZenonPlatform=function(){return this.$ZenonPlatformSupportConfig1};c.isStartImmediatelyEnabled=function(){return this.$ZenonPlatformSupportConfig2};c.getMaxConnectedCalls=function(){return this.$ZenonPlatformSupportConfig3};c.getParentWindowConnectionTimeoutMs=function(){return this.$ZenonPlatformSupportConfig4};return a}(a),j=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.$ZenonSimulcastConfig1=c.getBool(453),a)||babelHelpers.assertThisInitialized(c)}var c=a.prototype;c.updateParams=function(){this.$ZenonSimulcastConfig1=this.getBool(453)};c.isSimulcastEnabled=function(){return this.$ZenonSimulcastConfig1};return a}(a);a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$DynamicRuleConfig1=c.getBool(1342),c.$DynamicRuleConfig2=c.getInt(1359),b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.updateParams=function(){this.$DynamicRuleConfig1=this.getBool(1342),this.$DynamicRuleConfig2=this.getInt(1359)};c.isEnabled=function(){return this.$DynamicRuleConfig1};c.getProcessIntervalMs=function(){return this.$DynamicRuleConfig2};return b}(a);e.exports={ExampleConfig:c,SimulcastOverSignalingConfig:d,ZenonSdpTransformConfig:f,ZenonPeerConnectionConfig:b,ZenonStartCallImmediatelyConfig:g,ZenonMultiCallSupportConfig:h,ZenonPlatformSupportConfig:i,ZenonSimulcastConfig:j,DynamicRuleConfig:a}}),null);
__d("OverlayConfigDefaults",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze([1,0,0,20,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,0,-1,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,-1,-1,0,1,-1,-1,-1,-1,-1,-1,1,1,0,2e3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1e3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,16e3,2e4,0,-1]);e.exports=a}),null);
__d("OverlayConfigDefaultsLayer",["OverlayConfigDefaults","OverlayConfigLayerSource"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){}var b=a.prototype;b.getLayerSource=function(){return c("OverlayConfigLayerSource").DEFAULT};b.getValue=function(a){return c("OverlayConfigDefaults")[a]};b.logExposure=function(a){};return a}();g["default"]=a}),98);
__d("OverlayConfigLayerManager",["OverlayConfigConstants","OverlayConfigDefaultsLayer","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=[new(c("OverlayConfigDefaultsLayer"))()]}var b=a.prototype;b.getValue=function(a){for(var b=this.$1.length-1;b>=0;b--){var e=this.$1[b].getValue(a);if(e>d("OverlayConfigConstants").OverlayConfigNotPresentFlagValue)return e}throw c("unrecoverableViolation")("OverlayConfigLayerManager: No value found for id "+String(a),"rtc_www")};b.addLayer=function(a){this.$1.push(a);return this.$1.length-1};b.replaceLayer=function(a,b){if(a===0)throw c("unrecoverableViolation")("OverlayConfigLayerManager: Tried to replace default layer!","rtc_www");else if(this.$1[a]==null)throw c("unrecoverableViolation")("OverlayConfigLayerManager: Layer does not exist at index "+String(a),"rtc_www");this.$1[a]=b};b.clone=function(){var b=new a();b.$1=this.$1.slice();return b};return a}();g["default"]=a}),98);
__d("OverlayConfigManager",["Configs","OverlayConfigLayerManager"],(function(a,b,c,d,e,f){"use strict";var g=(a=b("Configs")).ExampleConfig,h=a.SimulcastOverSignalingConfig,i=a.ZenonSdpTransformConfig,j=a.ZenonPeerConnectionConfig,k=a.ZenonStartCallImmediatelyConfig,l=a.ZenonMultiCallSupportConfig,m=a.ZenonPlatformSupportConfig,n=a.ZenonSimulcastConfig,o=a.DynamicRuleConfig;c=function(){function a(){this.layerManager=new(b("OverlayConfigLayerManager"))()}var c=a.prototype;c.getExampleConfig=function(){return new g(this.layerManager)};c.getSimulcastOverSignalingConfig=function(){return new h(this.layerManager)};c.getZenonSdpTransformConfig=function(){return new i(this.layerManager)};c.getZenonPeerConnectionConfig=function(){return new j(this.layerManager)};c.getZenonStartCallImmediatelyConfig=function(){return new k(this.layerManager)};c.getZenonMultiCallSupportConfig=function(){return new l(this.layerManager)};c.getZenonPlatformSupportConfig=function(){return new m(this.layerManager)};c.getZenonSimulcastConfig=function(){return new n(this.layerManager)};c.getDynamicRuleConfig=function(){return new o(this.layerManager)};return a}();e.exports=c}),null);
__d("OverlayConfigManagerWithServerLayer",["OverlayConfigManager"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this)||this;c.$OverlayConfigManagerWithServerLayer1=-1;b!=null&&(c.layerManager=b.layerManager.clone());return c}var c=b.prototype;c.setServerLayer=function(a){if(this.$OverlayConfigManagerWithServerLayer1>-1){this.layerManager.replaceLayer(this.$OverlayConfigManagerWithServerLayer1,a);return}this.$OverlayConfigManagerWithServerLayer1=this.layerManager.addLayer(a)};return b}(c("OverlayConfigManager"));g["default"]=a}),98);
__d("ZenonCallLogger",["ZenonInfraActionsLogger","gkx","uuid"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set(["setMediaStats","updateE2EEStats"]);a=function(){function a(a,b){var d,e=this;this.$1=[];this.$2={localCallID:c("uuid")(),peerID:a.peerID,sharedCallID:(d=a.serverInfoData)!=null?d:a.callID};b.forEach(function(b){return e.$1.push(new b(a,function(a){Object.assign(e.$2,a)}))})}var b=a.prototype;b.log=function(a){!h.has(a.name)&&c("gkx")("2890")&&c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP] ZenonCallLogger event: "+a.name}),this.$1.forEach(function(b){b.processEvent(a)})};b.getLogIdentifiers=function(){return this.$2};return a}();g["default"]=a}),98);
__d("ZenonMWMessageLogger",["ZenonLoggingEventTypes","ZenonMWMessageTypes"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set(),i=new Set();function a(a,b){a=a.jsonPayload;var c=a.body;a=a.header;if(h.has(a.transactionId))return;switch(a.type){case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.JOIN:c.joinRequest&&j(c.joinRequest,b);break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.ICE_CANDIDATE:c.iceCandidateRequest&&l(c.iceCandidateRequest,b,d("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send);break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CLIENT_MEDIA_UPDATE:c.clientMediaUpdateRequest&&m(c.clientMediaUpdateRequest,b);break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.SERVER_MEDIA_UPDATE:c.serverMediaUpdateResponse&&p(c.serverMediaUpdateResponse,b);break}h.add(a.transactionId)}function b(a,b){a=a.jsonPayload;var c=a.body;a=a.header;if(i.has(a.transactionId))return;switch(a.type){case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.JOIN:c.joinResponse&&k(c.joinResponse,b);break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.ICE_CANDIDATE:c.iceCandidateRequest&&l(c.iceCandidateRequest,b,d("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive);break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CLIENT_MEDIA_UPDATE:c.clientMediaUpdateResponse&&n(c.clientMediaUpdateResponse,b);break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.SERVER_MEDIA_UPDATE:c.serverMediaUpdateRequest&&o(c.serverMediaUpdateRequest,b);break}i.add(a.transactionId)}function j(a,b){var c=a.answer;a=a.offer;b({name:"inviteSent"});q(a,b,d("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send);c&&q(c,b,d("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send)}function k(a,b){a=a.answer;a&&q(a,b,d("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive)}function l(a,b,c){a=a.iceCandidateSdps;a.forEach(function(a){a.candidateSdpString!=null&&b({direction:c,name:"updateIceInfo",sdpString:a.candidateSdpString})})}function m(a,b){a=a.offer;a&&q(a,b,d("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send)}function n(a,b){a=a.answer;a&&q(a,b,d("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive)}function o(a,b){var c=a.answer;a=a.offer;a&&q(a,b,d("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive);c&&q(c,b,d("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive)}function p(a,b){a=a.answer;a&&q(a,b,d("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send)}function q(a,b,c){a.sdpString!=null&&b({direction:c,name:"updateIceInfo",sdpString:a.sdpString})}g.logSentMessage=a;g.logReceivedMessage=b}),98);
__d("ZenonMWMessageReliabilityLogger",["$InternalEnum","ChannelClientID","ODS","QuickPerformanceLogger","RtcInfraReliabilityFalcoEvent","ZenonActorHooks","ZenonMWMessageMap","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map(),i=b("$InternalEnum").Mirrored(["RECEIVED_REQUEST","RECEIVED_RESPONSE","PROCESSING_REQUEST","START_PROCESSING_RESPONSE","PROCESSING_RESPONSE","PROCESSED_REQUEST","PROCESSED_RESPONSE","SENDING_REQUEST","SENDING_RESPONSE","SENT_REQUEST","SENT_REQUEST_FROM_HANDLER","SENT_RESPONSE","SEND_REQUEST_FAILED","SEND_REQUEST_FAILED_FROM_HANDLER","SEND_RESPONSE_FAILED"]);function a(a){p(a)?u(a,i.RECEIVED_RESPONSE):u(a,i.RECEIVED_REQUEST)}function e(a){u(a,i.START_PROCESSING_RESPONSE)}function f(a){p(a)?u(a,i.PROCESSING_RESPONSE):u(a,i.PROCESSING_REQUEST)}function j(a){p(a)?u(a,i.PROCESSED_RESPONSE):u(a,i.PROCESSED_REQUEST)}function k(a){p(a)?u(a,i.SENDING_RESPONSE):u(a,i.SENDING_REQUEST)}function l(a){p(a)?u(a,i.SENT_RESPONSE):u(a,i.SENT_REQUEST)}function m(a){u(a,i.SENT_REQUEST_FROM_HANDLER)}function n(a){p(a)?u(a,i.SEND_RESPONSE_FAILED):u(a,i.SEND_REQUEST_FAILED)}function o(a){u(a,i.SEND_REQUEST_FAILED_FROM_HANDLER)}function p(a){a=a.jsonPayload.header;return a.responseStatusCode!=null}function q(a){return isNaN(+a)?0:+a}function r(a,b){var e=a.jsonPayload.header;e=c("ZenonMWMessageMap")[e.type].toLowerCase();a=p(a)?"response":"request";switch(b){case i.RECEIVED_REQUEST:case i.RECEIVED_RESPONSE:d("ODS").bumpEntityKey(4083,"zenon_multiway","receive_"+a+"_"+e);d("ODS").flush();return;case i.PROCESSED_REQUEST:d("ODS").bumpEntityKey(4083,"zenon_multiway","processed_"+a+"_"+e);d("ODS").flush();return;case i.SENT_RESPONSE:case i.SENT_REQUEST:d("ODS").bumpEntityKey(4083,"zenon_multiway","sent_"+a+"_"+e);d("ODS").flush();return;default:return}}var s=["server_media_update"];function t(a,b){a=a.jsonPayload.header;var d=c("ZenonMWMessageMap")[a.type].toLowerCase();if(!s.includes(d))return;var e=q(a.transactionId);switch(b){case i.RECEIVED_REQUEST:c("QuickPerformanceLogger").markerStart(c("qpl")._(398983169,"10731"),e);c("QuickPerformanceLogger").markerAnnotate(c("qpl")._(398983169,"10731"),{string:{messageTags:JSON.stringify(a.messageTags),messageType:d}},{instanceKey:e});return;case i.PROCESSED_REQUEST:c("QuickPerformanceLogger").markerPoint(c("qpl")._(398983169,"10731"),"processed_request",{instanceKey:e});return;case i.SENT_RESPONSE:c("QuickPerformanceLogger").markerEnd(c("qpl")._(398983169,"10731"),2,e);return;case i.SEND_RESPONSE_FAILED:c("QuickPerformanceLogger").markerEnd(c("qpl")._(398983169,"10731"),3,e);return;default:return}}function u(a,b){var e=a.endpoint,f=e.appId!==""?String(e.appId):d("ZenonActorHooks").ZenonActor.getAppID(),g=a.jsonPayload.header,i=String(Date.now());c("RtcInfraReliabilityFalcoEvent").log(function(){return{client_session_id:g.clientSessionId,conference_name:g.conferenceName,data:{extra_data:JSON.stringify({messageTags:g.messageTags}),response_status_code:String(g.responseStatusCode)},event_name:b,message_type:c("ZenonMWMessageMap")[g.type],retry_count:String(g.retryCount),server_info_data:g.serverInfoData,tc:i,transaction_id:g.transactionId,version:"1",web_app_id:f,web_device_id:c("ChannelClientID").getID()}});e=(e=h.get(g.transactionId))!=null?e:new Set();h.set(g.transactionId,e);if(e.has(b))return;e.add(b);r(a,b);t(a,b)}g.logReceivedMessage=a;g.logStartProcessingResponse=e;g.logProcessingMessage=f;g.logProcessedMessage=j;g.logSendingMessage=k;g.logSentMessage=l;g.logSentRequestFromHandler=m;g.logSendMessageFailed=n;g.logSendRequestFailedFromHandler=o}),98);
__d("ZenonMWAddRemoveParticipantsTranslator",["ZenonMWMessageTypes","ZenonMWTranslatorUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b={usersToInvite:b.participants};a=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.ADD_PARTICIPANTS);return c("ZenonMWTranslatorUtils").createMWMessage(a,{addParticipantsRequest:b})}function b(a,b){b={usersToRemove:b.participants};a=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.REMOVE_PARTICIPANTS);return c("ZenonMWTranslatorUtils").createMWMessage(a,{removeParticipantsRequest:b})}g.toAddParticipantsRequest=a;g.toRemoveParticipantsRequest=b}),98);
__d("ZenonMWApprovalTranslator",["ZenonMWMessageTypes","ZenonMWTranslatorUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=b.approvalStatus;b=b.targetUsers;e={approvalStatus:e,targetUsers:b};b=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.APPROVAL);return c("ZenonMWTranslatorUtils").createMWMessage(b,{approvalRequest:e})}g.toApprovalRequest=a}),98);
__d("ZenonMWClientEventTranslator",["ZenonMWMessageTypes","ZenonMWTranslatorUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b={clientEvents:[{type:b.clientEventType}]};a=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CLIENT_EVENT);return c("ZenonMWTranslatorUtils").createMWMessage(a,{clientEventRequest:b})}g.toClientEventRequest=a}),98);
__d("ZenonMWClientMediaUpdateTranslator",["ZenonMWMessageTypes","ZenonMWTranslatorUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[];a=a.jsonPayload;var d=a.body;a=a.header;d=d.clientMediaUpdateResponse;var e=a.responseStatusCode,f=a.responseSubCode,g=a.retryAfterMsec;if(d){var h=d.answer,i=d.mediaStatus;if(h!=null&&i!=null){h=(h=h.sdpString)!=null?h:"";i=c("ZenonMWTranslatorUtils").toZenonMediaStates(i);var j={ackMessageId:a.transactionId,eventName:"localSdpResponse",hasAnswerInJoinResponse:!1,source:"clientMediaUpdate"},k=d.renegotiationOffer,l=null;k!=null&&k.sdpString!=null&&(l={sdp:k.sdpString,type:"offer",version:c("ZenonMWTranslatorUtils").getSdpVersion(k.sdpString)});k={eventName:"remoteSdpRequest",mediaPath:d.mediaPath,mediaStates:i,negotiateType:!1,renegotiationOffer:l,sdp:{sdp:h,type:"answer",version:c("ZenonMWTranslatorUtils").getSdpVersion(h)},source:"clientMediaUpdateResponse"};b.push(j);b.push(k)}c("ZenonMWTranslatorUtils").addStateStoreSignalingEvents(d.stateStore,b);i={ackMessageId:a.transactionId,acknowledgedVersion:d.currentVersion,eventName:"mediaUpdateResponse",responseStatusCode:e,responseSubCode:f,retryAfter:g};b.push(i)}return b}function b(a,b,e){b={fromVersion:b.version,mediaUpdates:[{mediaStatus:c("ZenonMWTranslatorUtils").toMWMediaStatus(b),mediaStatusEx:c("ZenonMWTranslatorUtils").toMWMediaStatusEx(b)}],toVersion:b.version};e!==void 0&&(b.offer={sdpString:e.sdp});e=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CLIENT_MEDIA_UPDATE);return c("ZenonMWTranslatorUtils").createMWMessage(e,{clientMediaUpdateRequest:b})}g.fromClientMediaUpdateResponse=a;g.toClientMediaUpdateRequest=b}),98);
__d("ZenonMWConferenceStateTranslator",["ZenonMWMessageTypes","ZenonMWTranslatorUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[];a=a.jsonPayload.body.conferenceStateRequest;if(a){var d=a.appMessages,e=a.participantStates,f={eventName:"participantUpdateRequest",participantStates:new Map(),versionId:a.version},g={eventName:"clientInfoRequest",userCapabilities:new Map()};Object.keys(e).forEach(function(a){var b=e[a],d=b.state;b=b.userCapabilities;f.participantStates.set(a,c("ZenonMWTranslatorUtils").fromMWParticipantState(d));g.userCapabilities.set(a,(d=b)!=null?d:"")});b.push(f);b.push(g);a=c("ZenonMWTranslatorUtils").getCollisionContextFromAppMessages(d);if(a){d={context:a,eventName:"roomContextUpdateRequest"};b.push(d)}}return b}function b(a,b){b={currentVersion:b.requestVersionId};a=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWResponseHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CONFERENCE_STATE);return c("ZenonMWTranslatorUtils").createMWMessage(a,{conferenceStateResponse:b})}g.fromConferenceStateRequest=a;g.toConferenceStateResponse=b}),98);
__d("ZenonMWDataMessageTranslator",["ZenonActorHooks","ZenonMWMessageTypes","ZenonMWTranslatorUtils","orEmptyArray"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[];a=a.jsonPayload.body.dataMessageRequest;if(a){var d=a.message.header,e=c("ZenonMWTranslatorUtils").getGenericDataMessageData(a);a=c("ZenonMWTranslatorUtils").getGenericDataMessageTopic(a);if(e!=null&&a!=null){e={data:e,eventName:"genericDataMessageRequest",recipientIDs:c("orEmptyArray")(d.recipients),serviceRecipients:c("orEmptyArray")(d.serviceRecipients),topic:a};b.push(e)}}return b}function b(a,b){var e={data:b.data,topic:b.topic};a=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.DATA_MESSAGE);return c("ZenonMWTranslatorUtils").createMWMessage(a,{dataMessageRequest:{message:{body:{genericMessage:e},header:{recipients:b.recipientIDs,sender:d("ZenonActorHooks").ZenonActor.getID(),serviceRecipients:b.serviceRecipients,topic_DEPRECATED:""}}}})}function e(a){a=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWResponseHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.DATA_MESSAGE);return c("ZenonMWTranslatorUtils").createMWMessage(a,{dataMessageResponse:{deliveryResult:{}}})}g.fromDataMessageRequest=a;g.toDataMessageRequest=b;g.toDataMessageResponse=e}),98);
__d("ZenonMWDismissTranslator",["ZenonMWMessageTypes","ZenonMWTranslatorUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[];a=a.jsonPayload.body.dismissRequest;if(a){var d=a.detailedReasonString;a=a.reason;a={eventName:"terminateRequest",fromJoinResponse:!1,reason:c("ZenonMWTranslatorUtils").fromMWDismissReason(a),shouldInformPeer:!0,subreason:d};b.push(a)}return b}function b(a){a=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWResponseHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.DISMISS);return c("ZenonMWTranslatorUtils").createMWMessage(a,{})}g.fromDismissRequest=a;g.toDismissResponse=b}),98);
__d("ZenonMWHangupTranslator",["ZenonMWMessageTypes","ZenonMWTranslatorUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[];a=a.jsonPayload.header;a={ackMessageId:a.transactionId,eventName:"hangupResponse"};b.push(a);return b}function b(a,b){b=b.reason;b={detailedReasonString:"",reason:c("ZenonMWTranslatorUtils").toMWHangupReason(b)};a=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.HANGUP);return c("ZenonMWTranslatorUtils").createMWMessage(a,{hangupRequest:b})}g.fromHangupResponse=a;g.toHangupRequest=b}),98);
__d("ZenonMWIceCandidateTranslator",["ZenonMWMessageTypes","ZenonMWTranslatorUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[];a=a.jsonPayload.body.iceCandidateRequest;if(a){a={eventName:"iceCandidateRequest",iceCandidates:a.iceCandidateSdps.map(function(a){var b;return{candidateSdpString:(b=a.candidateSdpString)!=null?b:"",sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid}})};b.push(a)}return b}function b(a){var b=[];a=a.jsonPayload.header;a={ackMessageId:a.transactionId,eventName:"iceCandidateResponse"};b.push(a);return b}function e(a){a=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWResponseHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.ICE_CANDIDATE);return c("ZenonMWTranslatorUtils").createMWMessage(a,{})}function f(a,b){b=b.iceCandidates;b=b.map(function(a){return{candidateSdpString:a.candidateSdpString,sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid}});b={iceCandidateSdps:b};a=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.ICE_CANDIDATE);return c("ZenonMWTranslatorUtils").createMWMessage(a,{iceCandidateRequest:b})}g.fromIceCandidateRequest=a;g.fromIceCandidateResponse=b;g.toIceCandidateResponse=e;g.toIceCandidateRequest=f}),98);
__d("ZenonJoiningContext",[],(function(a,b,c,d,e,f){"use strict";b="joining_context";function a(a){var b=a.groupThreadID,c=a.peerID;a=a.serverInfoData;return{group_thread_id:b,peer_id:c,server_info_data:a}}f.JOINING_CONTEXT_TOPIC=b;f.convertCollisionToJoiningContext=a}),66);
__d("ZenonMWJoinTranslator",["ZenonInfraActionsLogger","ZenonJoiningContext","ZenonMWMessageTypes","ZenonMWTranslatorUtils","ZenonScreenShare","gkx","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[],e=a.jsonPayload.header,f=e.responseStatusCode,g=e.responseSubCode;if(f&&f!==d("ZenonMWMessageTypes").ZenonMWResponseStatusCode.OK){g="JOIN response status code: "+f+" subcode "+((g=g)!=null?g:"[undefined]");c("ZenonInfraActionsLogger").logError({callType:"mw",checkpoint:"[ZP] Got non-OK "+g,errorDomain:"ZenonMWMessageTranslator.fromJoinResponse"});f={eventName:"terminateRequest",fromJoinResponse:!0,reason:c("ZenonMWTranslatorUtils").fromMWJoinResponseStatusToDismissReason(f,e.responseSubCode),shouldInformPeer:!1,subreason:g};b.push(f);return b}g=a.jsonPayload.body.joinResponse;if(!g)return b;c("ZenonMWTranslatorUtils").maybeAddOverlayConfigServerUpdateRequest(b,e);f=(a=(f=g.answer)==null?void 0:f.sdpString)!=null?a:"";a=f!=="";e={ackMessageId:e.transactionId,eventName:"localSdpResponse",hasAnswerInJoinResponse:a,source:"joinResponse"};b.push(e);if(a){e={sdp:f,type:"answer",version:c("ZenonMWTranslatorUtils").getSdpVersion(f)};a=c("ZenonMWTranslatorUtils").toZenonMediaStates(g.mediaStatusEx);f=g.renegotiationOffer;var i=null;f!=null&&f.sdpString!=null&&(i={sdp:f.sdpString,type:"offer",version:c("ZenonMWTranslatorUtils").getSdpVersion(f.sdpString)});f={eventName:"remoteSdpRequest",mediaPath:g.mediaPath,mediaStates:a,negotiateType:!1,renegotiationOffer:i,sdp:e,source:"joinResponse"};b.push(f)}a={capabilities:{addParticipantEnabled:!0,cowatchEnabled:!0,cowatchGroupEnabled:!0,multipleVideoStreamsAllowed:g.multipleVideoStreamsAllowed},eventName:"capabilitiesRequest"};b.push(a);c("ZenonMWTranslatorUtils").addStateStoreSignalingEvents(g.stateStore,b);if(h()&&g.isPendingApproval){i={eventName:"pendingApprovalRequest"};b.push(i)}return b}function b(a,b,e,f){var g=b.initialSyncStates;g={deviceCapabilities:[d("ZenonMWMessageTypes").ZenonMWCapability.SUPPORT_NEW_PARTICIPANT_STATES,d("ZenonMWMessageTypes").ZenonMWCapability.REQUIRE_FULL_SDP_IN_SMU,d("ZenonMWMessageTypes").ZenonMWCapability.SUPPORT_SDP_RENEGOTIATION].concat(c("qex")._("167")?[d("ZenonMWMessageTypes").ZenonMWCapability.REQUIRE_FULL_SDP_IN_SMU_OPTIMIZED]:[]),mediaStatus:c("ZenonMWTranslatorUtils").toMWMediaStatus(e.mediaStates),mediaStatusEx:c("ZenonMWTranslatorUtils").toMWMediaStatusEx(e.mediaStates),offer:{},syncPayload:g?{stateStore:c("ZenonMWTranslatorUtils").toMWSyncStateStore(g)}:void 0,userCapabilities:b.userCapabilities.get(a.userInfo.userID)};e.sdp.type==="offer"&&(g.offer={sdpString:e.sdp.sdp});j(e.sdp.sdp)&&(g.deviceCapabilities.push(d("ZenonMWMessageTypes").ZenonMWCapability.SUPPORT_MWPP),e.sdp.type==="answer"&&(g.answer={sdpString:e.sdp.sdp}),k()&&g.deviceCapabilities.push(d("ZenonMWMessageTypes").ZenonMWCapability.SUPPORT_MWPP_DEESCALATION));d("ZenonScreenShare").screenShareWithReplaceTrack()||g.deviceCapabilities.push(d("ZenonMWMessageTypes").ZenonMWCapability.SUPPORT_MULTIPLE_VIDEO_STREAMS);b=f==null?void 0:f.otherParticipants;b&&(g.usersToCall=b);b=(e=f==null?void 0:f.roomInfo.context)!=null?e:a.roomInfo.context;if(b){f=d("ZenonJoiningContext").convertCollisionToJoiningContext(b);g.appMessages=[{body:{genericMessage:{data:JSON.stringify(f),topic:d("ZenonJoiningContext").JOINING_CONTEXT_TOPIC}},header:{topic_DEPRECATED:d("ZenonJoiningContext").JOINING_CONTEXT_TOPIC}}]}e=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.JOIN);b&&b.serverInfoData!=null&&(e.serverInfoData=b.serverInfoData);i(b,e)&&(e.conferenceType=d("ZenonMWMessageTypes").ZenonMWConferenceType.ROOM);return c("ZenonMWTranslatorUtils").createMWMessage(e,{joinRequest:g})}function h(){var a=c("gkx")("1450329");a&&c("ZenonInfraActionsLogger").logCheckpointOnceForDomain({checkpoint:"gk: rtc_www_lobby_mode"});return a}function i(a,b){return(a==null?void 0:a.peerID)!==null&&b.conferenceName===null}function j(a){var b;a=c("ZenonMWTranslatorUtils").isUnifiedPlan(a);return a&&(((b=c("qex")._("458"))!=null?b:!1)||c("gkx")("967"))||!a}function k(){var a;return(a=c("qex")._("795"))!=null?a:!1}g.fromJoinResponse=a;g.toJoinRequest=b}),98);
__d("ZenonMWPingTranslator",["ZenonMWMessageTypes","ZenonMWTranslatorUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[];a=a.jsonPayload.header;a={ackMessageId:a.transactionId,eventName:"pingResponse"};b.push(a);return b}function b(a){var b=Object.freeze({});a=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.PING);return c("ZenonMWTranslatorUtils").createMWMessage(a,{pingRequest:b})}g.fromPingResponse=a;g.toPingRequest=b}),98);
__d("ZenonMWRingTranslator",["ZenonMWMessageTypes","ZenonMWTranslatorUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[];a=a.jsonPayload;var e=a.body;a=a.header;e=e.ringRequest;if(e){var f=e.appMessages,g=e.caller,h=e.otherParticipants,i=e.ringType;g=g;i=i===d("ZenonMWMessageTypes").ZenonMWRingType.PEER_VIDEO_CALL||i===d("ZenonMWMessageTypes").ZenonMWRingType.GROUP_VIDEO_CALL||i===d("ZenonMWMessageTypes").ZenonMWRingType.LIVE_STREAM||i===d("ZenonMWMessageTypes").ZenonMWRingType.PEER_ESCALATED_AUDIO_CALL;var j=a.conferenceName;a=a.serverInfoData;var k=c("ZenonMWTranslatorUtils").getCollisionContextFromAppMessages(f);k&&(k==null?void 0:k.serverInfoData)==null&&(k.serverInfoData=a);f=c("ZenonMWTranslatorUtils").getRoomMetadataFromAppMessages(f);h={eventName:"inviteRequest",inviterID:g,isRemoteOfferer:!1,otherParticipants:h,requestingVideo:i,roomInfo:{context:(g=k)!=null?g:{groupThreadID:null,peerID:null,serverInfoData:a},name:j,room:f,sender:f.sender}};b.push(h);g=(k=(i=e.offer)==null?void 0:i.sdpString)!=null?k:"";j=(a=e.mediaStatusEx)!=null?a:null;if(g!==""&&j!=null){f={sdp:g,type:"offer",version:c("ZenonMWTranslatorUtils").getSdpVersion(g)};h=c("ZenonMWTranslatorUtils").toZenonMediaStates(j);i={eventName:"remoteSdpRequest",mediaPath:e.mediaPath,mediaStates:h,negotiateType:!1,sdp:f,source:"ringRequest"};b.push(i)}}return b}function b(a,b){b=b.status;b==="IN_ANOTHER_CALL"&&(a.signalingID=null);b=c("ZenonMWTranslatorUtils").toMWDeviceStatus(b);b={deviceCapabilities:[d("ZenonMWMessageTypes").ZenonMWCapability.SUPPORT_AUDIO_DEPRECATED,d("ZenonMWMessageTypes").ZenonMWCapability.SUPPORT_VIDEO_DEPRECATED],deviceStatus:b};a=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWResponseHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.RING);return c("ZenonMWTranslatorUtils").createMWMessage(a,{ringResponse:b})}g.fromRingRequest=a;g.toRingResponse=b}),98);
__d("ZenonMWServerMediaUpdateTranslator",["ZenonInfraActionsLogger","ZenonMWMessageReliabilityLogger","ZenonMWMessageTypes","ZenonMWTranslatorUtils","qex","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,e=[],f=a.jsonPayload,g=f.body;f=f.header;g=g.serverMediaUpdateRequest;var h=f.transactionId;if(!g)return e;c("ZenonMWTranslatorUtils").maybeAddOverlayConfigServerUpdateRequest(e,f);b=(b=(b=g.answer)==null?void 0:b.sdpString)!=null?b:"";var i="answer";if(b===""){var j;b=(j=(j=g.offer)==null?void 0:j.sdpString)!=null?j:"";i="offer"}if(g.renegotiationRequested){j={eventName:"initiateRenegotiationRequest",fromVersion:g.fromVersion,hasRemoteOffer:i==="offer"&&b!=="",mediaPath:g.mediaPath,messageTags:(j=f.messageTags)!=null?j:[],onProcessed:function(){d("ZenonMWMessageReliabilityLogger").logProcessedMessage(a)},version:g.toVersion};e.push(j)}if(b==="")if(c("qex")._("167")&&g.mediaStatus){j={eventName:"mediaUpdateRequest",mediaStates:c("ZenonMWTranslatorUtils").toZenonMediaStates(g.mediaStatus,g.fromVersion,g.toVersion),messageTags:(j=f.messageTags)!=null?j:[],onProcessed:function(){d("ZenonMWMessageReliabilityLogger").logProcessedMessage(a)}};e.push(j)}else{c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"No SDP string in SMU request, transaction id: "+h});return e}else{c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"SMU request SDP type: "+i+", transaction id: "+h});j={sdp:b,type:i,version:c("ZenonMWTranslatorUtils").getSdpVersion(b)};h=c("ZenonMWTranslatorUtils").toZenonMediaStates(g.mediaStatus);h={eventName:"remoteSdpRequest",fromVersion:g.fromVersion,mediaPath:g.mediaPath,mediaStates:h,messageTags:(h=f.messageTags)!=null?h:[],negotiateType:!1,onProcessed:function(){d("ZenonMWMessageReliabilityLogger").logProcessedMessage(a)},sdp:j,source:"serverMediaUpdateRequest"};if(i==="answer"&&c("ZenonMWTranslatorUtils").isUnifiedPlan(h.sdp.sdp)){j={sdp:b,type:"offer",version:c("ZenonMWTranslatorUtils").getSdpVersion(b)};h.renegotiationOffer=j}e.push(h)}c("ZenonMWTranslatorUtils").addStateStoreSignalingEvents(g.stateStore,e);b={capabilities:{multipleVideoStreamsAllowed:g.multipleVideoStreamsAllowed},eventName:"capabilitiesRequest",messageTags:(i=f.messageTags)!=null?i:[]};e.push(b);return e}function b(a,b,d){return h(a,(a=b.acknowledgedVersion)!=null?a:null,c("ZenonMWTranslatorUtils").toMWResponseStatusCode(b.status),d)}function e(a,b){return h(a,b.acknowledgedVersion,c("ZenonMWTranslatorUtils").toMWResponseStatusCode(b.status))}function f(a,b){return h(a,b.acknowledgedVersion,(a=b.responseStatusCode)!=null?a:d("ZenonMWMessageTypes").ZenonMWResponseStatusCode.CONDITIONAL_REQUEST_FAILED)}function h(a,b,e,f){if(b==null)throw c("unrecoverableViolation")("Error creating ServerMediaUpdateResponse: acknowledgedVersion is null","messenger_web_product");b={currentVersion:b};f&&(b.answer={sdpString:f.sdp.sdp},b.mediaStatus=c("ZenonMWTranslatorUtils").toMWClientMediaStatus(f.mediaStates));f=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWResponseHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.SERVER_MEDIA_UPDATE,e);return c("ZenonMWTranslatorUtils").createMWMessage(f,{serverMediaUpdateResponse:b})}g.fromServerMediaUpdateRequest=a;g.toServerMediaUpdateResponse=b;g.toServerMediaUpdateRenegotiationResponse=e;g.toServerMediaUpdateNoSdpResponse=f}),98);
__d("ZenonMWStateSyncTranslator",["ZenonMWMessageTypes","ZenonMWTranslatorUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.jsonPayload;var b=a.body.updateResponse;a=a.header.transactionId;if(!b)return[];var c=b.topic;b=b.version;a={ackMessageId:a,eventName:"stateSyncUpdateResponse",topic:c,version:b};return[a]}function b(a){a=a.jsonPayload.body.notifyRequest;if(!a)return[];var b=a.data,c=a.topic;a=a.version;b={data:b,eventName:"stateSyncNotifyRequest",responseRequired:!0,topic:c,version:a};return[b]}function e(a){a=a.jsonPayload;var b=a.body.unsubscribeResponse;a=a.header.transactionId;if(!b)return[];var c=b.topic;b=b.version;a={ackMessageId:a,eventName:"stateSyncUnsubscribeResponse",topic:c,version:b};return[a]}function f(a,b){var e=b.data,f=b.topic;b=b.version;e={data:e,topic:f,version:b};f=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.UPDATE);return c("ZenonMWTranslatorUtils").createMWMessage(f,{updateRequest:e})}function h(a,b){var e=b.topic;b=b.version;e={topic:e,version:b};b=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWResponseHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.NOTIFY);return c("ZenonMWTranslatorUtils").createMWMessage(b,{notifyResponse:e})}function i(a,b){var e=b.topic;b=b.version;e={topic:e,version:b};b=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.UNSUBSCRIBE);return c("ZenonMWTranslatorUtils").createMWMessage(b,{unsubscribeRequest:e})}g.fromUpdateResponse=a;g.fromNotifyRequest=b;g.fromUnsubscribeResponse=e;g.toUpdateRequest=f;g.toNotifyResponse=h;g.toUnsubscribeRequest=i}),98);
__d("ZenonMWSubscriptionTranslator",["ZenonMWMessageTypes","ZenonMWTranslatorUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b=b.subscriptions;b={subscriptions:b};a=c("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.SUBSCRIPTION);return c("ZenonMWTranslatorUtils").createMWMessage(a,{subscriptionRequest:b})}g.toSubscriptionRequest=a}),98);
__d("ZenonSignalingMessage",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b){this.$1=a,this.$2=b}var b=a.prototype;b.getHeader=function(){return this.$1};b.getEvents=function(){return this.$2};b.setSignalingID=function(a){this.$1.signalingID=a};b.setRetryCount=function(a){this.$1.retryCount=a};return a}();f["default"]=a}),66);
__d("ZenonMWMessageTranslator",["ZenonActorHooks","ZenonMWAddRemoveParticipantsTranslator","ZenonMWApprovalTranslator","ZenonMWClientEventTranslator","ZenonMWClientMediaUpdateTranslator","ZenonMWConferenceStateTranslator","ZenonMWDataMessageTranslator","ZenonMWDismissTranslator","ZenonMWHangupTranslator","ZenonMWIceCandidateTranslator","ZenonMWJoinTranslator","ZenonMWMessageTypes","ZenonMWPingTranslator","ZenonMWRingTranslator","ZenonMWServerMediaUpdateTranslator","ZenonMWStateSyncTranslator","ZenonMWSubscriptionTranslator","ZenonMWTranslatorUtils","ZenonSignalingMessage","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getHeader();a=a.getEvents();if(a.length===0)throw c("unrecoverableViolation")("Unexpected Translation: called toMWMessage with empty signaling events","messenger_web_product");else{var e=a[0];switch(e.eventName){case"addParticipantsRequest":return d("ZenonMWAddRemoveParticipantsTranslator").toAddParticipantsRequest(b,e);case"clientEventRequest":return d("ZenonMWClientEventTranslator").toClientEventRequest(b,e);case"clientInfoRequest":if(a.length>=2&&a[1].eventName==="localSdpRequest"&&(a[1].sdp.type==="offer"||a[1].sdp.type==="answer"))return d("ZenonMWJoinTranslator").toJoinRequest(b,e,a[1]);break;case"genericDataMessageRequest":return d("ZenonMWDataMessageTranslator").toDataMessageRequest(b,e);case"inviteRequest":if(a.length>=3&&a[1].eventName==="clientInfoRequest"&&a[2].eventName==="localSdpRequest"&&a[2].sdp.type==="offer")return d("ZenonMWJoinTranslator").toJoinRequest(b,a[1],a[2],e);break;case"genericDataMessageResponse":return d("ZenonMWDataMessageTranslator").toDataMessageResponse(b);case"inviteResponse":return d("ZenonMWRingTranslator").toRingResponse(b,e);case"dismissResponse":return d("ZenonMWDismissTranslator").toDismissResponse(b);case"initiateRenegotiationResponse":if(a.length>=3&&a[1].eventName==="remoteSdpResponse"&&a[2].eventName==="localSdpRequest"&&a[2].sdp.type==="answer")return d("ZenonMWServerMediaUpdateTranslator").toServerMediaUpdateResponse(b,a[1],a[2]);else return d("ZenonMWServerMediaUpdateTranslator").toServerMediaUpdateRenegotiationResponse(b,e);case"iceCandidateRequest":return d("ZenonMWIceCandidateTranslator").toIceCandidateRequest(b,e);case"iceCandidateResponse":return d("ZenonMWIceCandidateTranslator").toIceCandidateResponse(b);case"localSdpRequest":return d("ZenonMWClientMediaUpdateTranslator").toClientMediaUpdateRequest(b,e.mediaStates,e.sdp);case"mediaUpdateRequest":return d("ZenonMWClientMediaUpdateTranslator").toClientMediaUpdateRequest(b,e.mediaStates);case"mediaUpdateResponse":return d("ZenonMWServerMediaUpdateTranslator").toServerMediaUpdateNoSdpResponse(b,e);case"participantUpdateResponse":return d("ZenonMWConferenceStateTranslator").toConferenceStateResponse(b,e);case"pingRequest":return d("ZenonMWPingTranslator").toPingRequest(b);case"remoteSdpResponse":return e.type==="offer"&&(a.length>=2&&a[1].eventName==="localSdpRequest"&&a[1].sdp.type==="answer")?d("ZenonMWServerMediaUpdateTranslator").toServerMediaUpdateResponse(b,e,a[1]):d("ZenonMWServerMediaUpdateTranslator").toServerMediaUpdateResponse(b,e);case"removeParticipantsRequest":return d("ZenonMWAddRemoveParticipantsTranslator").toRemoveParticipantsRequest(b,e);case"stateSyncNotifyResponse":return d("ZenonMWStateSyncTranslator").toNotifyResponse(b,e);case"stateSyncUnsubscribeRequest":return d("ZenonMWStateSyncTranslator").toUnsubscribeRequest(b,e);case"stateSyncUpdateRequest":return d("ZenonMWStateSyncTranslator").toUpdateRequest(b,e);case"subscriptionRequest":return d("ZenonMWSubscriptionTranslator").toSubscriptionRequest(b,e);case"terminateRequest":return d("ZenonMWHangupTranslator").toHangupRequest(b,e);case"usersApprovalRequest":return d("ZenonMWApprovalTranslator").toApprovalRequest(b,e)}}return null}function b(a){var b=a.jsonPayload.header;if(b.receiverUserId!=null&&b.receiverUserId!==d("ZenonActorHooks").ZenonActor.getID())throw c("unrecoverableViolation")("Ignoring MW message; receiverUserId does not match self ID","messenger_web_product");var e=b.type,f=b.responseStatusCode==null;b=c("ZenonMWTranslatorUtils").mwMessageHeaderToSignalingMessageHeader(b);var g=[];switch(e){case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.RING:f&&(g=d("ZenonMWRingTranslator").fromRingRequest(a));break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.DISMISS:f&&(g=d("ZenonMWDismissTranslator").fromDismissRequest(a));break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.JOIN:f||(g=d("ZenonMWJoinTranslator").fromJoinResponse(a));break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.ICE_CANDIDATE:f?g=d("ZenonMWIceCandidateTranslator").fromIceCandidateRequest(a):g=d("ZenonMWIceCandidateTranslator").fromIceCandidateResponse(a);break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CONFERENCE_STATE:f&&(g=d("ZenonMWConferenceStateTranslator").fromConferenceStateRequest(a));break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CLIENT_MEDIA_UPDATE:f||(g=d("ZenonMWClientMediaUpdateTranslator").fromClientMediaUpdateResponse(a));break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.SERVER_MEDIA_UPDATE:f&&(g=d("ZenonMWServerMediaUpdateTranslator").fromServerMediaUpdateRequest(a));break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.PING:f||(g=d("ZenonMWPingTranslator").fromPingResponse(a));break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.HANGUP:f||(g=d("ZenonMWHangupTranslator").fromHangupResponse(a));break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.DATA_MESSAGE:f&&(g=d("ZenonMWDataMessageTranslator").fromDataMessageRequest(a));break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.UPDATE:f||(g=d("ZenonMWStateSyncTranslator").fromUpdateResponse(a));break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.UNSUBSCRIBE:f||(g=d("ZenonMWStateSyncTranslator").fromUnsubscribeResponse(a));break;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.NOTIFY:f&&(g=d("ZenonMWStateSyncTranslator").fromNotifyRequest(a));break}return new(c("ZenonSignalingMessage"))(b,g)}g.toMWMessage=a;g.toSignalingMessage=b}),98);
__d("ZenonRelayEnvironment",["RelayFBEnvironment","RelayHooks","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect,i=null;function a(){var a=d("RelayHooks").useRelayEnvironment();h(function(){i=a},[a])}function b(){var a;return(a=i)!=null?a:c("RelayFBEnvironment")}g.useUpdateZenonRelayEnvironment=a;g.getZenonRelayEnvironment=b}),98);
__d("ZenonMWSendMessageMutation",["CometRelayErrorHandling","Promise","RelayModern","ZenonMWSendMessageMutation.graphql","ZenonRelayEnvironment","gkx","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new(b("Promise"))(function(e,f){d("RelayModern").commitMutation(d("ZenonRelayEnvironment").getZenonRelayEnvironment(),{mutation:h!==void 0?h:h=b("ZenonMWSendMessageMutation.graphql"),onCompleted:function(a){return e(a)},onError:function(a){c("gkx")("708253")&&d("CometRelayErrorHandling").markErrorAsHandled(a);return f(a)},variables:{input:{message:a}}})}));case 1:case"end":return e.stop()}},null,this)}function j(a){a=a.rtc_web_send_multiway_signaling_message;var b=null,c=null;a!=null&&(a.header!=null&&(b=JSON.parse(a.header)),a.body!=null&&(c=JSON.parse(a.body)));return{body:c,header:b}}function a(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(i(a));case 2:c=d.sent;return d.abrupt("return",j(c));case 4:case"end":return d.stop()}},null,this)}g.sendMessage=a}),98);
__d("ZenonGraphQLMWMessageSender",["ZenonDebugLogger","ZenonInfraActionsLogger","ZenonMWMessageLogger","ZenonMWMessageReliabilityLogger","ZenonMWMessageTranslator","ZenonMWSendMessageMutation","ZenonMWTranslatorUtils","regeneratorRuntime","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){}var e=a.prototype;e.handleResponse=function(a){var b=a.header||null;a=a.body||null;var e=c("ZenonDebugLogger").getInstance();if(b!=null&&a!=null){b=c("ZenonMWTranslatorUtils").createMWMessage(b,a);e.logMWMessage("RECEIVED","GraphQL",b);d("ZenonMWMessageReliabilityLogger").logReceivedMessage(b);a=d("ZenonMWMessageTranslator").toSignalingMessage(b);if(this.$1!=null)this.$1(a),d("ZenonMWMessageReliabilityLogger").logProcessingMessage(b);else throw c("unrecoverableViolation")("Should never have null message receiver","rtc_www")}};e.asyncSendMessage=function(a){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:e=c("ZenonDebugLogger").getInstance();d("ZenonMWMessageReliabilityLogger").logSendingMessage(a);e.logMWMessage("SENDING","GraphQL",a);this.$2&&d("ZenonMWMessageLogger").logSentMessage(a,this.$2);h.prev=4;h.next=7;return b("regeneratorRuntime").awrap(d("ZenonMWSendMessageMutation").sendMessage(JSON.stringify(a)));case 7:f=h.sent;d("ZenonMWMessageReliabilityLogger").logSentMessage(a);this.handleResponse(f);h.next=18;break;case 12:h.prev=12,h.t0=h["catch"](4),g=h.t0!=null?h.t0.toString():"Message Send Error",d("ZenonMWMessageReliabilityLogger").logSendMessageFailed(a),e.logSendMultiwayMessageFailure(g,a.jsonPayload.header.type),h.t0!=null&&c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"Failed to send MW message of type "+a.jsonPayload.header.type+". Stack Trace: "+h.t0.stack+"."});case 18:case"end":return h.stop()}},null,this,[[4,12]])};e.sendMessage=function(a){a=d("ZenonMWMessageTranslator").toMWMessage(a);a!=null&&this.asyncSendMessage(a)};e.setMessageReceiver=function(a){this.$1=a};e.setLoggingEventHandler=function(a){this.$2=a};return a}();g["default"]=a}),98);
__d("ZenonSignalingConstants",[],(function(a,b,c,d,e,f){"use strict";a="/rtc_multi";b="D3F4U1T_F8_TR4CK";f.RTC_MULTI_MQTT_TOPIC=a;f.DEFAULT_TRACK=b}),66);
__d("ZenonMqttMWMessageSender",["FBMqttChannel","Promise","ZenonDebugLogger","ZenonMWMessageLogger","ZenonMWMessageReliabilityLogger","ZenonMWMessageTranslator","ZenonSignalingConstants","ZenonUserActionLogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=15e3;a=function(){function a(){}var e=a.prototype;e.waitForMqttConnected=function(){return new(b("Promise"))(function(a,b){if(c("FBMqttChannel").getConnectionState()==="Connected")a();else{c("ZenonUserActionLogger").logCheckpoint({checkpoint:"MQTT not connected, deferring sending MWS message"});c("ZenonUserActionLogger").startTimer("MQTT not connected");var d={onMQTTStateChanged:function(b){b==="Connected"&&(c("ZenonUserActionLogger").stopTimer({checkpointName:"MQTT connected after deferring sending MWS message",timerName:"MQTT not connected"}),c("FBMqttChannel").unsubscribeChannelEvents(d),window.clearTimeout(e),a())}},e=window.setTimeout(function(){c("FBMqttChannel").unsubscribeChannelEvents(d),c("ZenonUserActionLogger").stopTimer({checkpointName:"MQTT never connected. Current status: "+c("FBMqttChannel").getConnectionState(),timerName:"MQTT not connected"}),b("timeout")},h);c("FBMqttChannel").subscribeChannelEvents(d)}})};e.asyncSendMessage=function(a){var e=this,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:f=!0;h.next=3;return b("regeneratorRuntime").awrap(this.waitForMqttConnected()["catch"](function(a){c("ZenonUserActionLogger").logCheckpoint({checkpoint:"Not sending MWS message through MQTT because MQTT could not connect. Error: "+a}),f=!1}));case 3:if(f){h.next=5;break}return h.abrupt("return");case 5:g=c("ZenonDebugLogger").getInstance();d("ZenonMWMessageReliabilityLogger").logSendingMessage(a);g.logMWMessage("SENDING","MQTT",a);this.$2&&d("ZenonMWMessageLogger").logSentMessage(a,this.$2);h.prev=9;h.next=12;return b("regeneratorRuntime").awrap(c("FBMqttChannel").publish(d("ZenonSignalingConstants").RTC_MULTI_MQTT_TOPIC,JSON.stringify(a)).then(function(b){d("ZenonMWMessageReliabilityLogger").logSentMessage(a)},function(b){e.$3(a,b.toString())}));case 12:h.next=17;break;case 14:h.prev=14,h.t0=h["catch"](9),this.$3(a,h.t0.toString());case 17:case"end":return h.stop()}},null,this,[[9,14]])};e.$3=function(a,b){var e=c("ZenonDebugLogger").getInstance();b=b!=null?b:"MQTT Message Send Error";d("ZenonMWMessageReliabilityLogger").logSendMessageFailed(a);e.logSendMultiwayMessageFailure(b,a.jsonPayload.header.type)};e.sendMessage=function(a){a=d("ZenonMWMessageTranslator").toMWMessage(a);a!=null&&this.asyncSendMessage(a)};e.setMessageReceiver=function(a){this.$1=a};e.setLoggingEventHandler=function(a){this.$2=a};return a}();g["default"]=a}),98);
__d("ZenonXControllerSendRequest",["AsyncRequest","Promise","XGroupCallSendMessageController","XGroupCallSendRequestController","ZenonActorHooks","ZenonMWMessageReliabilityLogger","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=6e3;function i(a,e){return new(b("Promise"))(function(b,f){d("ZenonMWMessageReliabilityLogger").logSendingMessage(e),a.setMethod("POST").setAllowCrossPageTransition(!0).setHandler(function(a){d("ZenonMWMessageReliabilityLogger").logSentMessage(e),b(a)}).setErrorHandler(function(a){d("ZenonMWMessageReliabilityLogger").logSendRequestFailedFromHandler(e);a=a.getErrorDescription();a=new(c("err"))(a!=null?a.toString():"AsyncRequest error");f(a)}).setTimeoutHandler(h,function(){f("Timeout")}),a.send()})}function a(a){var b=c("XGroupCallSendMessageController").getURIBuilder();c("gkx")("2028434")&&b.setFBID("av",d("ZenonActorHooks").ZenonActor.getID());b=b.getURI();b=new(c("AsyncRequest"))(b).setData({message:JSON.stringify(a)});return i(b,a)}function e(a){var b=c("XGroupCallSendRequestController").getURIBuilder();c("gkx")("2028434")&&b.setFBID("av",d("ZenonActorHooks").ZenonActor.getID());b=b.getURI();b=new(c("AsyncRequest"))(b).setData({request:JSON.stringify(a)});return i(b,a)}g.sendMessage=a;g.sendRequest=e}),98);
__d("ZenonXControllerMWMessageSender",["ZenonDebugLogger","ZenonMWMessageLogger","ZenonMWMessageReliabilityLogger","ZenonMWMessageTranslator","ZenonMWMessageTypes","ZenonMWTranslatorUtils","ZenonXControllerSendRequest","regeneratorRuntime","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){}var e=a.prototype;e.handleResponse=function(a){a=a.payload;if(a==null)return;var b=a.header||null;a=a.body||null;var e=c("ZenonDebugLogger").getInstance();if(b!=null&&a!=null){b=c("ZenonMWTranslatorUtils").createMWMessage(b,a);d("ZenonMWMessageReliabilityLogger").logStartProcessingResponse(b);e.logMWMessage("RECEIVED","XController",b);d("ZenonMWMessageReliabilityLogger").logReceivedMessage(b);a=d("ZenonMWMessageTranslator").toSignalingMessage(b);if(this.$1!=null)this.$1(a),d("ZenonMWMessageReliabilityLogger").logProcessingMessage(b);else throw c("unrecoverableViolation")("Should never have null message receiver","rtc_www")}};e.asyncSendMessage=function(a){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:e=c("ZenonDebugLogger").getInstance();e.logMWMessage("SENDING","XController",a);this.$2&&d("ZenonMWMessageLogger").logSentMessage(a,this.$2);h.prev=3;if(!this.isResponseExpected(a)){h.next=11;break}h.next=7;return b("regeneratorRuntime").awrap(d("ZenonXControllerSendRequest").sendRequest(a));case 7:f=h.sent;this.handleResponse(f);h.next=13;break;case 11:h.next=13;return b("regeneratorRuntime").awrap(d("ZenonXControllerSendRequest").sendMessage(a));case 13:h.next=20;break;case 15:h.prev=15,h.t0=h["catch"](3),g=h.t0!=null?h.t0.toString():"Message Send Error",d("ZenonMWMessageReliabilityLogger").logSendMessageFailed(a),e.logSendMultiwayMessageFailure(g,a.jsonPayload.header.type);case 20:case"end":return h.stop()}},null,this,[[3,15]])};e.isResponseExpected=function(a){switch(a.jsonPayload.header.type){case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.JOIN:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CLIENT_MEDIA_UPDATE:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.DATA_MESSAGE:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CLIENT_EVENT:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.UNSUBSCRIBE:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.UPDATE:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CONNECT:return!0;case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.RING:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.SERVER_MEDIA_UPDATE:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.NOTIFY:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CONFERENCE_STATE:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.HANGUP:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.ICE_CANDIDATE:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.DISMISS:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.ADD_PARTICIPANTS:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.SUBSCRIPTION:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.REMOVE_PARTICIPANTS:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.PING:case d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.P2P_PROTOCOL:return!1;default:return!1}};e.sendMessage=function(a){a=d("ZenonMWMessageTranslator").toMWMessage(a);a!=null&&this.asyncSendMessage(a)};e.setMessageReceiver=function(a){this.$1=a};e.setLoggingEventHandler=function(a){this.$2=a};return a}();g["default"]=a}),98);
__d("ZenonHybridMWMessageSender",["FBLogger","ZenonActorHooks","ZenonGraphQLMWMessageSender","ZenonInfraActionsLogger","ZenonMWMessageTranslator","ZenonMWMessageTypes","ZenonMqttMWMessageSender","ZenonXControllerMWMessageSender"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=new(c("ZenonXControllerMWMessageSender"))(),this.$2=new(c("ZenonGraphQLMWMessageSender"))(),this.$3=new(c("ZenonMqttMWMessageSender"))(),this.$4=!1,this.$4=d("ZenonActorHooks").ZenonActor.isPage()}var b=a.prototype;b.sendMessage=function(a){try{var b=d("ZenonMWMessageTranslator").toMWMessage(a),e=b==null?void 0:b.jsonPayload.header.type;if(a.getHeader().remoteSignalingID==null&&e!=null&&e!==d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.JOIN){c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP][DROP] No remoteSignalingID in message: "+e});c("FBLogger")("rtc_www").warn("[ZP][DROP] No remoteSignalingID in message: "+e);return}b!=null&&(this.$4?this.$2.asyncSendMessage(b):(this.$3.asyncSendMessage(b),e!==d("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.DATA_MESSAGE&&this.$2.asyncSendMessage(b)))}catch(a){c("FBLogger")("rpweb").catching(a).warn("Error sending message from ZenonHybridMWMessageSender");throw a}};b.setMessageReceiver=function(a){this.$1.setMessageReceiver(a),this.$2.setMessageReceiver(a)};b.setLoggingEventHandler=function(a){this.$1.setLoggingEventHandler(a),this.$2.setLoggingEventHandler(a)};return a}();g["default"]=a}),98);
__d("ZenonMultiwayReliabilityLogProcessor",["ChannelClientID","RtcInfraReliabilityFalcoEvent","ZenonActorHooks","ZenonPeerID","ZenonSignalingProtocolUtils"],(function(a,b,c,d,e,f,g){"use strict";var h={version:"1",web_app_id:d("ZenonActorHooks").ZenonActor.getAppID(),web_device_id:c("ChannelClientID").getID()};a=function(){function a(a){c("ZenonSignalingProtocolUtils").isMwSupportedProtocol(a.protocol)&&(a.peerID=d("ZenonPeerID").ZenonMWPeerID),this.$1=a.conferenceName,this.$3=a.signalingID,this.$2=a.serverInfoData}var b=a.prototype;b.processEvent=function(a){var b=this;switch(a.name){case"connectionReady":c("RtcInfraReliabilityFalcoEvent").log(function(){return b.$4("CONNECTION_READY")});break;case"inviteResponseReceived":c("RtcInfraReliabilityFalcoEvent").log(function(){return b.$4("INVITE_RESPONSE_RECEIVED")});break;case"mediaConnected":c("RtcInfraReliabilityFalcoEvent").log(function(){return b.$4("RELAY_CONNECTED")});break;case"setRemoteSdpAnswer":c("RtcInfraReliabilityFalcoEvent").log(function(){return b.$4("BEGIN_SET_REMOTE_DESCRIPTION")});break;case"endSetRemoteDescription":c("RtcInfraReliabilityFalcoEvent").log(function(){return b.$4("END_SET_REMOTE_DESCRIPTION")});break;case"beginRemoteSdpMunging":c("RtcInfraReliabilityFalcoEvent").log(function(){return b.$4("BEGIN_REMOTE_SDP_MUNGING")});break;case"endRemoteSdpMunging":c("RtcInfraReliabilityFalcoEvent").log(function(){return b.$4("END_REMOTE_SDP_MUNGING")});break}};b.$4=function(a){a=babelHelpers["extends"]({client_session_id:this.$3,conference_name:this.$1,event_name:a,server_info_data:this.$2,tc:Date.now().toString()},h);return a};return a}();g["default"]=a}),98);
__d("TokenBucketRateLimit",["DateConsts"],(function(a,b,c,d,e,f,g){"use strict";var h=1e3;a=function(){function a(a,b){this.$1=a*h,this.$2=a*h,this.$3=Date.now(),this.$4=b*h}var b=a.prototype;b.take=function(a){a===void 0&&(a=1);a=a*h;this.$5();if(this.$2<a)return!1;this.$2-=a;return!0};b.$5=function(){if(this.$2>=this.$1)return;var a=Date.now(),b=(a-this.$3)/d("DateConsts").MS_PER_SEC;b=Math.round(b*this.$4);if(b===0)return;this.$2=Math.min(this.$1,this.$2+b);this.$3=a};return a}();g["default"]=a}),98);
__d("ZenonSDKRateLimiter",["TokenBucketRateLimit","ZenonPlatformRateLimitSitevarConfig"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=new Map()}var b=a.prototype;b.take=function(a,b){b===void 0&&(b=1);a=this.$2(a);return a.take(b)};b.$2=function(a){var b,d=this.$1.get(a);if(d)return d;b=(b=c("ZenonPlatformRateLimitSitevarConfig").buckets.get(a))!=null?b:c("ZenonPlatformRateLimitSitevarConfig")["default"];d=new(c("TokenBucketRateLimit"))(b.bucket_size,b.refill_rate);this.$1.set(a,d);return d};return a}();g["default"]=a}),98);
__d("ZenonSignalingInitState",["setInterval"],(function(a,b,c,d,e,f,g){"use strict";var h=3e4;function a(a,b){if(b.type==="receiveInviteRequest"){a.onInviteReceived(b.payload,b.configuration);return{inviteMessageID:b.messageID}}return{}}function b(a,b){b.type==="sendInviteRequest"&&a.sendSignalingEvent(b.payload)}function d(a){if(!a.pingTimer){var b={eventName:"pingRequest"},d=c("setInterval")(function(){a.sendSignalingEvent(b)},h);return{pingTimer:d}}return{}}g.onReceiveInvite=a;g.onSendInvite=b;g.startPingTimer=d}),98);
__d("ZenonSignalingInviteReceivedState",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b.type==="sendInviteResponse"&&(a.inviteMessageID!=null?b.payload.status!=="OK"&&(b.payload.ackMessageId=a.inviteMessageID,a.sendSignalingEvent(b.payload)):c("FBLogger")("rtc_www").mustfix("onSendInviteResponse handler invoked without populated inviteMessageID in signaling state machine context."))}g.onSendInviteResponse=a}),98);
__d("ZenonSignalingNegotiationCompleteState",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){if(b.type==="receiveRemoteSdpRequest"){b=b.payload;var c=b.mediaPath,d=b.mediaStates,e=b.sdp;b=b.source;a.onSdpReceived(e,c,d,(a=b)!=null?a:null);return{lastRemoteMediaUpdateVersion:e.version}}return{}}function b(a,b){if(b.type==="sendMediaUpdateRequest")if(a.isMediaUpdateResponsePending===!0)return{mediaUpdateRequestToSend:b.payload};else{a=a.sendSignalingEvent(b.payload);return{isMediaUpdateResponsePending:!0,mediaUpdateRequestToSend:null,mediaUpdateRequestTransactionId:a}}return{}}f.onReceiveAnswer=a;f.onSendMediaUpdateRequest=b}),66);
__d("ZenonSignalingSMEvents",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a.eventName){case"addParticipantsRequest":return{payload:a,type:"sendAddParticipantsRequest"};case"addParticipantsResponse":return{payload:a,type:"sendAddParticipantsResponse"};case"answerIntentRequest":return{payload:a,type:"sendAnswerIntentRequest"};case"usersApprovalRequest":return{payload:a,type:"sendUsersApprovalRequest"};case"capabilitiesRequest":return{payload:a,type:"sendCapabilitiesRequest"};case"clientEventRequest":return{payload:a,type:"sendClientEventRequest"};case"clientInfoRequest":return{payload:a,type:"sendClientInfoRequest"};case"clientRenegotiationRequest":return{payload:a,type:"sendClientRenegotiationRequest"};case"dismissResponse":return{payload:a,type:"sendDismissResponse"};case"iceCandidateRequest":return{payload:a,type:"sendIceCandidateRequest"};case"iceCandidateResponse":return{payload:a,type:"sendIceCandidateResponse"};case"initiateRenegotiationRequest":return null;case"initiateRenegotiationResponse":return{payload:a,type:"sendInitiateRenegotiationResponse"};case"inviteRequest":return{payload:a,type:"sendInviteRequest"};case"inviteResponse":return{payload:a,type:"sendInviteResponse"};case"localSdpRequest":return{payload:a,type:"sendLocalSdpRequest"};case"localSdpResponse":return{payload:a,type:"sendLocalSdpResponse"};case"mediaUpdateRequest":return{payload:a,type:"sendMediaUpdateRequest"};case"mediaUpdateResponse":return{payload:a,type:"sendMediaUpdateResponse"};case"overlayConfigServerUpdateRequest":return{payload:a,type:"sendOverlayConfigServerUpdateRequest"};case"participantUpdateRequest":return{payload:a,type:"sendParticipantUpdateRequest"};case"participantUpdateResponse":return{payload:a,type:"sendParticipantUpdateResponse"};case"pingResponse":return null;case"pingRequest":return{payload:a,type:"sendPingRequest"};case"remoteSdpRequest":return null;case"remoteSdpResponse":return{payload:a,type:"sendRemoteSdpResponse"};case"subscriptionRequest":return{payload:a,type:"sendSubscriptionRequest"};case"removeParticipantsRequest":return{payload:a,type:"sendRemoveParticipantsRequest"};case"stateSyncNotifyRequest":return null;case"stateSyncNotifyResponse":return{payload:a,type:"sendStateSyncNotifyResponse"};case"stateSyncUnsubscribeRequest":return{payload:a,type:"sendStateSyncUnsubscribeRequest"};case"stateSyncUnsubscribeResponse":return null;case"stateSyncUpdateRequest":return{payload:a,type:"sendStateSyncUpdateRequest"};case"stateSyncUpdateResponse":return null;case"terminateRequest":return{payload:a,type:"sendTerminateRequest"};case"hangupResponse":return null;case"roomContextUpdateRequest":return null;case"genericDataMessageRequest":return{payload:a,type:"sendGenericDataMessageRequest"};case"pendingApprovalRequest":return null;case"genericDataMessageResponse":return{payload:a,type:"sendGenericDataMessageResponse"};default:a;return null}}function b(a,b,c){switch(a.eventName){case"addParticipantsRequest":return{payload:a,type:"receiveAddParticipantsRequest"};case"addParticipantsResponse":return{payload:a,type:"receiveAddParticipantsResponse"};case"pendingApprovalRequest":return{configuration:c,messageID:b,payload:a,type:"receivePendingApprovalRequest"};case"answerIntentRequest":return null;case"clientEventRequest":return null;case"clientRenegotiationRequest":return null;case"capabilitiesRequest":return{configuration:c,messageID:b,payload:a,type:"receiveCapabilitiesRequest"};case"clientInfoRequest":return{configuration:c,messageID:b,payload:a,type:"receiveClientInfoRequest"};case"dismissResponse":return{configuration:c,messageID:b,payload:a,type:"receiveDismissResponse"};case"iceCandidateRequest":return{configuration:c,messageID:b,payload:a,type:"receiveIceCandidateRequest"};case"iceCandidateResponse":return{configuration:c,messageID:b,payload:a,type:"receiveIceCandidateResponse"};case"initiateRenegotiationRequest":return{configuration:c,messageID:b,payload:a,type:"receiveInitiateRenegotiationRequest"};case"initiateRenegotiationResponse":return null;case"inviteRequest":return{configuration:c,messageID:b,payload:a,type:"receiveInviteRequest"};case"inviteResponse":return{configuration:c,messageID:b,payload:a,type:"receiveInviteResponse"};case"localSdpRequest":return null;case"localSdpResponse":return{configuration:c,messageID:b,payload:a,type:"receiveLocalSdpResponse"};case"mediaUpdateRequest":return{configuration:c,messageID:b,payload:a,type:"receiveMediaUpdateRequest"};case"mediaUpdateResponse":return{configuration:c,messageID:b,payload:a,type:"receiveMediaUpdateResponse"};case"overlayConfigServerUpdateRequest":return{configuration:c,messageID:b,payload:a,type:"receiveOverlayConfigServerUpdateRequest"};case"participantUpdateRequest":return{configuration:c,messageID:b,payload:a,type:"receiveParticipantUpdateRequest"};case"participantUpdateResponse":return{configuration:c,messageID:b,payload:a,type:"receiveParticipantUpdateResponse"};case"pingResponse":return{configuration:c,messageID:b,payload:a,type:"receivePingResponse"};case"pingRequest":return null;case"remoteSdpRequest":return{configuration:c,messageID:b,payload:a,type:"receiveRemoteSdpRequest"};case"remoteSdpResponse":return{configuration:c,messageID:b,payload:a,type:"receiveRemoteSdpResponse"};case"stateSyncNotifyRequest":return{configuration:c,messageID:b,payload:a,type:"receiveStateSyncNotifyRequest"};case"stateSyncNotifyResponse":return null;case"stateSyncUnsubscribeRequest":return null;case"stateSyncUnsubscribeResponse":return{configuration:c,messageID:b,payload:a,type:"receiveStateSyncUnsubscribeResponse"};case"stateSyncUpdateRequest":return null;case"stateSyncUpdateResponse":return{configuration:c,messageID:b,payload:a,type:"receiveStateSyncUpdateResponse"};case"subscriptionRequest":return null;case"removeParticipantsRequest":return null;case"usersApprovalRequest":return null;case"terminateRequest":return{configuration:c,messageID:b,payload:a,type:"receiveTerminateRequest"};case"hangupResponse":return null;case"roomContextUpdateRequest":return{configuration:c,messageID:b,payload:a,type:"receiveRoomContextUpdateRequest"};case"genericDataMessageRequest":return{configuration:c,messageID:b,payload:a,type:"receiveGenericDataMessageRequest"};case"genericDataMessageResponse":return{configuration:c,messageID:b,payload:a,type:"receiveGenericDataMessageResponse"};default:a;return null}}f.getSendEvent=a;f.getReceiveEvent=b}),66);
__d("ZenonSignalingSharedActions",["ZenonDebugLogger","ZenonInfraActionsLogger","ZenonMWMessageTypes","ZenonSignalingTypes","killswitch"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){a.sendSignalingEvent(b.payload)}function b(a,b){if(b.type!=="receiveCapabilitiesRequest")return;a.onCapabilitiesReceived(b.payload.capabilities,(a=b.payload.escalationConferenceName)!=null?a:null)}function e(a,b){if(b.type!=="receiveClientInfoRequest")return;a.onClientInfoReceived(b.payload.userCapabilities)}function f(a,b){if(b.type!=="receiveGenericDataMessageRequest")return;a.sendSignalingEvent({ackMessageId:b.messageID,eventName:"genericDataMessageResponse"});a.onGenericDataMessageReceived(b.payload.topic,b.payload.data)}function h(a,b){if(b.type!=="receiveIceCandidateRequest")return;var c={ackMessageId:b.messageID,eventName:"iceCandidateResponse"};a.sendSignalingEvent(c);var d=a.onIceCandidateReceived;b.payload.iceCandidates.forEach(function(a){return d(a)})}function i(a,b){var c;if(b.type!=="receiveInitiateRenegotiationRequest")return{};var e=b.payload,f=e.hasRemoteOffer;e=e.messageTags;var g=w(a.lastRemoteMediaUpdateVersion,b.payload.fromVersion);c={ackMessageId:b.messageID,acknowledgedVersion:g?(c=a.lastRemoteMediaUpdateVersion)!=null?c:0:b.payload.version,eventName:"initiateRenegotiationResponse",hasRemoteOffer:f,messageTags:e,status:g?d("ZenonSignalingTypes").ZenonRemoteSdpResponseStatus.REJECTED_FROM_VERSION_DOES_NOT_MATCH:d("ZenonSignalingTypes").ZenonRemoteSdpResponseStatus.OK};a.sendSignalingEvent(c);b.payload.onProcessed();if(g)return{};e=a.signalingModel.getMediaModeManager();b.payload.mediaPath===d("ZenonMWMessageTypes").ZenonMWMediaPath.P2P?(e.onDeescalated(),f?a.logEvent({name:"renegotiationSmuReqWithOfferReceived"}):a.logEvent({name:"renegotiationSmuReqWithAnswerReceived"})):e.onSfuEscalated();a.onRenegotiationRequested(f);return f?{}:B((c=a.lastRemoteMediaUpdateVersion)!=null?c:null,b.payload.version)}function j(a,b){if(b.type!=="receiveLocalSdpResponse")return;b.payload.source==="joinResponse"&&a.logEvent({name:"inviteResponseReceived"});b=b.payload.hasAnswerInJoinResponse;b||a.logEvent({name:"inviteResponseProcessed"});a.logEvent({hasAnswerInJoinResponse:b,name:"setHasAnswerInJoinResponse"});a.logEvent({name:"startHeartbeat"})}function k(a,b){if(b.type!=="receiveMediaUpdateRequest")return{};var c=a.lastRemoteMediaUpdateVersion,e=b.payload,f=e.mediaStates,g=f.fromVersion;f=f.version;var h=e.messageTags;e=e.onProcessed;e&&e();e=c!=null&&g!=null&&c!==g;g={ackMessageId:b.messageID,acknowledgedVersion:e&&a.lastRemoteMediaUpdateVersion!=null?a.lastRemoteMediaUpdateVersion:b.payload.mediaStates.version,eventName:"mediaUpdateResponse",messageTags:h,responseStatusCode:e?d("ZenonMWMessageTypes").ZenonMWResponseStatusCode.CONDITIONAL_REQUEST_FAILED:d("ZenonMWMessageTypes").ZenonMWResponseStatusCode.OK};a.sendSignalingEvent(g);if(!e){a.onMediaUpdateReceived(b.payload.mediaStates);if(c==null||f>c)return{lastRemoteMediaUpdateVersion:f}}return{}}function l(a,b){if(b.type!=="receiveParticipantUpdateRequest")return;var c={ackMessageId:b.messageID,eventName:"participantUpdateResponse",requestVersionId:b.payload.versionId};a.sendSignalingEvent(c);a.onParticipantUpdateReceived(b.payload.participantStates)}function m(a){a.onPendingApprovalReceived(),a.logEvent({name:"pendingApproval"})}function n(a,b){var c;if(b.type!=="receiveRemoteSdpRequest")return{};var e=w(a.lastRemoteMediaUpdateVersion,b.payload.fromVersion);if(((c=b.payload)==null?void 0:c.source)!=="joinResponse"){c={ackMessageId:b.messageID,acknowledgedVersion:e?a.lastRemoteMediaUpdateVersion:b.payload.sdp.version,eventName:"remoteSdpResponse",messageTags:b.payload.messageTags,negotiateType:b.payload.negotiateType,status:e?d("ZenonSignalingTypes").ZenonRemoteSdpResponseStatus.REJECTED_FROM_VERSION_DOES_NOT_MATCH:d("ZenonSignalingTypes").ZenonRemoteSdpResponseStatus.OK,type:b.payload.sdp.type};a.sendSignalingEvent(c)}if(e){b.payload.onProcessed&&b.payload.onProcessed();return{}}b.payload.source==="serverMediaUpdateRequest"&&b.payload.sdp.type==="answer"&&a.logEvent({name:"smuWithAnswerReceived"});a.onSdpReceived(b.payload.sdp,b.payload.mediaPath,b.payload.mediaStates,(c=b.payload.source)!=null?c:null,b.payload.renegotiationOffer,b.payload.onProcessed);return B((e=a.lastRemoteMediaUpdateVersion)!=null?e:null,b.payload.sdp.version)}function o(a,b){if(b.type!=="receiveRoomContextUpdateRequest")return;a.onRoomContextUpdateReceived(b.payload.context)}function p(a,b){if(b.type!=="receiveStateSyncNotifyRequest")return;var c=a.signalingModel,d=b.payload,e=d.data,f=d.responseRequired,g=d.topic;d=d.version;c.getStateSyncStore().updateOutputState(g,{data:e,version:d});c.notify();if(f){e={ackMessageId:b.messageID,eventName:"stateSyncNotifyResponse",topic:g,version:d};a.sendSignalingEvent(e)}}function q(a,b){if(b.type!=="receiveOverlayConfigServerUpdateRequest")return;if(c("killswitch")("RP_ZENON_OVERLAYCONFIG_SERVER_LAYER"))return;a=a.signalingModel;a.updateOverlayConfigServerLayer(b.payload.serverLayer);a.notify()}function r(a,b){if(b.type!=="receiveTerminateRequest")return;b.payload.fromJoinResponse===!0&&a.logEvent({name:"inviteResponseReceived"});if(b.payload.shouldInformPeer){var c={ackMessageId:b.messageID,eventName:"dismissResponse"};a.sendSignalingEvent(c)}a.onDismissReceived(a.signalingModel.getSignalingID(),b.payload.reason,(c=b.payload.subreason)!=null?c:null)}function s(a,b){if(b.type!=="sendSubscriptionRequest")return{};var d=a.lastSubscriptions;a=a.sendSignalingEvent;var e=[].concat(b.payload.subscriptions).sort(C);e=JSON.stringify(e);d!==e?a(b.payload):c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"Not sending identical subscription request."});return{lastSubscriptions:e}}function t(a,b){if(b.type!=="sendClientRenegotiationRequest")return;b=b.payload.negotiationEvent;a.onClientRenegotiationReceived(b)}function u(a,b){b.type==="sendTerminateRequest"&&b.payload.shouldInformPeer&&a.sendSignalingEvent(b.payload)}function v(a,b){if(b.type!=="sendUsersApprovalRequest")return;a.sendSignalingEvent(b.payload)}function w(a,b){return a!=null&&b!=null&&a!==b}function x(a,b){return z(a,b,!1)}function y(a,b){return z(a,b,!0)}function z(a,b,d){if(b.type==="receiveMediaUpdateResponse"){var e;e=(e=a==null?void 0:a.lastAckedLocalSdpVersion)!=null?e:-1;var f=b.payload.acknowledgedVersion;c("ZenonDebugLogger").getInstance().logConsole("receiveMediaUpdate: lastAckedSdpVersion "+String(e)+", remoteAckedVersion: "+String(f));if(f>=e){a.lastAckedLocalSdpVersion=f;a.onMediaUpdateResponseReceived({cancelNegotiations:d,responseStatusCode:(e=b.payload.responseStatusCode)!=null?e:null,responseSubCode:(f=b.payload.responseSubCode)!=null?f:null,retryAfter:(d=b.payload.retryAfter)!=null?d:null})}else c("ZenonDebugLogger").getInstance().logConsole("mediaUpdateResponse: Ignoring old message response");e=a.mediaUpdateRequestToSend;if(e){f=a.sendSignalingEvent(e);return{isMediaUpdateResponsePending:!0,lastAckedLocalSdpVersion:a.lastAckedLocalSdpVersion,mediaUpdateRequestToSend:null,mediaUpdateRequestTransactionId:f}}else return{isMediaUpdateResponsePending:!1,lastAckedLocalSdpVersion:a.lastAckedLocalSdpVersion,mediaUpdateRequestTransactionId:""}}return{}}function A(a,b){if(b.type!=="sendLocalSdpRequest")return{};a=a.sendSignalingEvent(b.payload);return{mediaUpdateRequestTransactionId:a}}function B(a,b){return a==null||b>a?{lastRemoteMediaUpdateVersion:b}:{}}function C(a,b){if(a.type!==b.type)return a.type-b.type;a=(a=a.trackId)!=null?a:null;b=(b=b.trackId)!=null?b:null;if(a===null||b===null)return 0;else return a.localeCompare(b)}g.genericEventSender=a;g.onReceiveCapabilitiesRequest=b;g.onReceiveClientInfoRequest=e;g.onReceiveGenericDataMessageRequest=f;g.onReceiveIceCandidateRequest=h;g.onReceiveInitiateRenegotiationRequest=i;g.onReceiveLocalSdpResponse=j;g.onReceiveMediaUpdateRequest=k;g.onReceiveParticipantUpdateRequest=l;g.onReceivePendingApprovalRequest=m;g.onReceiveRemoteSdpRequest=n;g.onReceiveRoomContextUpdateRequest=o;g.onReceiveStateSyncNotifyRequest=p;g.onReceiveOverlayConfigServerUpdateRequest=q;g.onReceiveTerminateRequest=r;g.onSendSubscriptionRequest=s;g.onSendClientRenegotiationRequest=t;g.onSendTerminateRequest=u;g.onSendUsersApprovalRequest=v;g.shouldRejectRequest=w;g.onNonSDPReceiveMediaUpdateResponse=x;g.onReceiveMediaUpdateResponse=y;g.onSendLocalSdpRequestOffer=A}),98);
__d("ZenonSignalingSMGuards",["ZenonDebugLogger","ZenonInfraActionsLogger","ZenonMWMessageTypes","ZenonSignalingSharedActions"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){a=b.type==="receiveRemoteSdpRequest"&&b.payload.sdp.type==="offer"&&d("ZenonSignalingSharedActions").shouldRejectRequest(a.lastRemoteMediaUpdateVersion,b.payload.fromVersion)===!1;c("ZenonDebugLogger").getInstance().logGuardsResults("sdpOfferReceiveNotRejectedGuard",a);return a}function b(a,b){a=b.type==="receiveRemoteSdpRequest"&&b.payload.sdp.type==="offer"&&d("ZenonSignalingSharedActions").shouldRejectRequest(a.lastRemoteMediaUpdateVersion,b.payload.fromVersion);c("ZenonDebugLogger").getInstance().logGuardsResults("sdpOfferReceiveRejectedGuard",a);return a}function e(a,b){a=b.type==="receiveRemoteSdpRequest"&&b.payload.sdp.type==="answer";c("ZenonDebugLogger").getInstance().logGuardsResults("sdpAnswerReceiveGuard",a);return a}function f(a,b){a=b.type==="sendLocalSdpRequest"&&b.payload.sdp.type==="answer";c("ZenonDebugLogger").getInstance().logGuardsResults("sdpAnswerSendGuard",a);return a}function h(a,b){a=b.type==="receiveLocalSdpResponse"&&b.payload.source==="joinResponse";c("ZenonDebugLogger").getInstance().logGuardsResults("sdpJoinResponseReceiveGuard",a);return a}function i(a,b){a=b.type==="receiveRemoteSdpRequest"&&b.payload.sdp.type==="offer";c("ZenonDebugLogger").getInstance().logGuardsResults("sdpOfferReceiveGuard",a);return a}function j(a,b){a=b.type==="sendLocalSdpRequest"&&b.payload.sdp.type==="offer";c("ZenonDebugLogger").getInstance().logGuardsResults("sdpOfferSendGuard",a);return a}function k(a,b){a=b.type==="sendLocalSdpRequest"&&b.payload.sdp.type==="offer";c("ZenonDebugLogger").getInstance().logGuardsResults("sdpOfferSendGuardNegotiationComplete",a);return a}function l(a,b){var e=b.type==="receiveMediaUpdateResponse"&&b.payload.responseStatusCode!==d("ZenonMWMessageTypes").ZenonMWResponseStatusCode.OK&&b.payload.ackMessageId===a.mediaUpdateRequestTransactionId;c("ZenonDebugLogger").getInstance().logGuardsResults("receiveNonOkMediaUpdateResponseGuard",e);b.type==="receiveMediaUpdateResponse"&&b.payload.responseStatusCode!==d("ZenonMWMessageTypes").ZenonMWResponseStatusCode.OK&&c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP] Server rejected offer with code: "+String(b.payload.responseStatusCode)+". Outgoing transaction id was: "+String(a.mediaUpdateRequestTransactionId)+". Incoming transaction id was: "+String(b.payload.ackMessageId)+". Transaction should be canceled: "+String(e)+"."});return e}g.sdpOfferReceiveNotRejectedGuard=a;g.sdpOfferReceiveRejectedGuard=b;g.sdpAnswerReceiveGuard=e;g.sdpAnswerSendGuard=f;g.sdpJoinResponseReceiveGuard=h;g.sdpOfferReceiveGuard=i;g.sdpOfferSendGuard=j;g.sdpOfferSendGuardNegotiationComplete=k;g.receiveNonOkMediaUpdateResponseGuard=l}),98);
__d("ZenonSignalingTerminatedState",["clearInterval"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a.pingTimer){c("clearInterval")(a.pingTimer);delete a.pingTimer;return a}return{}}g.stopPingTimer=a}),98);
__d("ZenonSignalingStateMachine",["ZenonDebugLogger","ZenonDeferrableStateMachine","ZenonInfraActionsLogger","ZenonSignalingInitState","ZenonSignalingInviteReceivedState","ZenonSignalingNegotiationCompleteState","ZenonSignalingSMEvents","ZenonSignalingSMGuards","ZenonSignalingSharedActions","ZenonSignalingTerminatedState","gkx","qpl","xstate"],(function(a,b,c,d,e,f,g){"use strict";var h="SignalingStateMachine";a=function(){function a(a,b){var e=this;b===void 0&&(b="init");b=babelHelpers["extends"]({},D,{context:babelHelpers["extends"]({},a),initial:b});this.$1=d("ZenonDeferrableStateMachine").interpret(d("xstate").Machine(b,{guards:d("ZenonSignalingSMGuards")}),{onDeferTimeout:function(a){c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[Signaling] "+a.type+" was deferred for too long"})}});this.$1.onTransition(function(a){var b;c("ZenonInfraActionsLogger").updateCachedValues({signalingState:a.value});c("ZenonDebugLogger").getInstance().logStateMachineTransition(h,a.changed,a.value,(b=a.history)==null?void 0:b.value,a.event.type,a.actions,e.$2().signalingModel.getSignalingID())});c("ZenonDebugLogger").getInstance().startQPL(c("qpl")._(64245348,"8823"),+a.signalingModel.getSignalingID())}var b=a.prototype;b.processSendEvent=function(a){a=d("ZenonSignalingSMEvents").getSendEvent(a);a!=null&&this.$3(a)};b.processReceiveEvent=function(a,b,c){a=d("ZenonSignalingSMEvents").getReceiveEvent(a,b,c);a!=null&&this.$3(a)};b.$3=function(a){var b=this.$2().signalingModel.getSignalingID();c("ZenonDebugLogger").getInstance().logStateMachine(h,this.getState(),a.type,b);this.$1.send(a)};b.$2=function(){return this.$1.state.context};b.getState=function(){var a=this.$1.state.toStrings();return a.length>0?this.$1.state.toStrings()[0]:"init"};return a}();b={actions:[d("ZenonSignalingSharedActions").genericEventSender]};e={actions:[d("ZenonSignalingSharedActions").onReceiveTerminateRequest],target:"terminated"};f={actions:[d("ZenonSignalingSharedActions").genericEventSender]};var i={actions:[d("ZenonSignalingSharedActions").genericEventSender]},j={actions:[d("ZenonSignalingSharedActions").genericEventSender]},k={actions:[d("ZenonSignalingSharedActions").onReceiveCapabilitiesRequest]},l={actions:[d("ZenonSignalingSharedActions").onReceiveClientInfoRequest]},m={actions:[d("ZenonSignalingSharedActions").onReceiveGenericDataMessageRequest]},n={actions:[d("ZenonSignalingSharedActions").onReceiveIceCandidateRequest]},o={actions:[d("ZenonSignalingSharedActions").genericEventSender]},p={actions:[d("ZenonSignalingSharedActions").genericEventSender]},q={actions:[d("ZenonSignalingSharedActions").genericEventSender]},r={actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onSendSubscriptionRequest)]},s={actions:[d("ZenonSignalingSharedActions").onSendTerminateRequest],target:"terminated"},t={actions:[d("ZenonSignalingSharedActions").genericEventSender]},u={actions:[d("ZenonSignalingSharedActions").onReceiveParticipantUpdateRequest]},v={actions:[d("ZenonSignalingSharedActions").onReceiveRoomContextUpdateRequest]},w={actions:[d("ZenonSignalingSharedActions").onReceiveOverlayConfigServerUpdateRequest]},x={actions:[d("ZenonSignalingSharedActions").onReceiveStateSyncNotifyRequest]},y={actions:[d("ZenonSignalingSharedActions").genericEventSender]},z={actions:[d("ZenonSignalingSharedActions").genericEventSender]},A={actions:[d("ZenonSignalingSharedActions").onSendUsersApprovalRequest]},B={actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onReceiveMediaUpdateRequest)]},C={actions:["defer"]},D={initial:"init",states:{init:{on:{sendInviteRequest:{actions:[d("xstate").assign(d("ZenonSignalingInitState").startPingTimer),d("ZenonSignalingInitState").onSendInvite],target:"inviteSent"},receiveInviteRequest:{target:"inviteReceived",actions:[d("xstate").assign(d("ZenonSignalingInitState").startPingTimer),d("xstate").assign(d("ZenonSignalingInitState").onReceiveInvite)]},receiveRoomContextUpdateRequest:v,receiveTerminateRequest:e,sendClientInfoRequest:b,sendRemoveParticipantsRequest:t,sendUsersApprovalRequest:A,sendSubscriptionRequest:r,sendTerminateRequest:s,receiveMediaUpdateRequest:B,receiveOverlayConfigServerUpdateRequest:w,receiveStateSyncNotifyRequest:x,receiveCapabilitiesRequest:C,receiveClientInfoRequest:C,receiveGenericDataMessageRequest:C,receiveIceCandidateRequest:C,receiveParticipantUpdateRequest:C,receiveLocalSdpResponse:C,receiveMediaUpdateResponse:C,receiveRemoteSdpRequest:C,sendGenericDataMessageRequest:C,sendIceCandidateRequest:C,sendStateSyncUnsubscribeRequest:C,sendStateSyncUpdateRequest:C,sendCapabilitiesRequest:C,sendClientRenegotiationRequest:C}},inviteSent:{on:{sendLocalSdpRequest:{actions:[d("ZenonSignalingSharedActions").genericEventSender],cond:d("ZenonSignalingSMGuards").sdpOfferSendGuard,target:"offerSdpSent"},receiveIceCandidateRequest:n,receiveParticipantUpdateRequest:u,receiveRoomContextUpdateRequest:v,receiveTerminateRequest:e,sendCapabilitiesRequest:q,sendClientInfoRequest:b,sendRemoveParticipantsRequest:t,receiveMediaUpdateRequest:B,receiveOverlayConfigServerUpdateRequest:w,receiveStateSyncNotifyRequest:x,sendSubscriptionRequest:r,sendTerminateRequest:s,sendUsersApprovalRequest:A,sendMediaUpdateRequest:C,sendIceCandidateRequest:C,receiveGenericDataMessageRequest:C,sendGenericDataMessageRequest:C,sendStateSyncUnsubscribeRequest:C,sendStateSyncUpdateRequest:C,sendClientRenegotiationRequest:C}},offerSdpSent:{on:{receiveLocalSdpResponse:{actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onReceiveLocalSdpResponse)],cond:d("ZenonSignalingSMGuards").sdpJoinResponseReceiveGuard,target:"offerSdpAcknowledged"},receiveCapabilitiesRequest:k,receiveClientInfoRequest:l,receiveIceCandidateRequest:n,receiveMediaUpdateRequest:B,receiveParticipantUpdateRequest:u,receiveRoomContextUpdateRequest:v,receiveTerminateRequest:e,sendAddParticipantsRequest:p,sendAnswerIntentRequest:f,sendUsersApprovalRequest:A,sendClientInfoRequest:b,sendRemoveParticipantsRequest:t,receiveOverlayConfigServerUpdateRequest:w,receiveStateSyncNotifyRequest:x,sendSubscriptionRequest:r,receivePendingApprovalRequest:C,receiveRemoteSdpRequest:C,receiveInitiateRenegotiationRequest:C,sendGenericDataMessageRequest:C,sendIceCandidateRequest:C,sendMediaUpdateRequest:C,receiveGenericDataMessageRequest:C,sendStateSyncUnsubscribeRequest:C,sendStateSyncUpdateRequest:C,sendTerminateRequest:C,sendClientRenegotiationRequest:C}},offerSdpAcknowledged:{on:{receivePendingApprovalRequest:{actions:[d("ZenonSignalingSharedActions").onReceivePendingApprovalRequest]},receiveRemoteSdpRequest:{actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onReceiveRemoteSdpRequest)],cond:d("ZenonSignalingSMGuards").sdpAnswerReceiveGuard,target:"negotiationComplete"},receiveInitiateRenegotiationRequest:{actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onReceiveInitiateRenegotiationRequest)],target:"negotiationComplete"},receiveCapabilitiesRequest:k,receiveClientInfoRequest:l,receiveIceCandidateRequest:n,receiveMediaUpdateRequest:B,receiveParticipantUpdateRequest:u,receiveRoomContextUpdateRequest:v,receiveTerminateRequest:e,sendAddParticipantsRequest:p,sendAnswerIntentRequest:f,sendUsersApprovalRequest:A,sendClientInfoRequest:b,sendRemoveParticipantsRequest:t,receiveOverlayConfigServerUpdateRequest:w,receiveStateSyncNotifyRequest:x,sendStateSyncUnsubscribeRequest:z,sendStateSyncUpdateRequest:y,sendSubscriptionRequest:r,sendTerminateRequest:s,sendGenericDataMessageRequest:C,sendIceCandidateRequest:C,sendMediaUpdateRequest:C,receiveGenericDataMessageRequest:C,sendClientRenegotiationRequest:C}},inviteReceived:{on:{sendInviteResponse:{actions:[d("ZenonSignalingInviteReceivedState").onSendInviteResponse],target:"inviteAcknowledged"},receiveRoomContextUpdateRequest:v,sendAnswerIntentRequest:f,sendIceCandidateRequest:j,sendUsersApprovalRequest:A,sendRemoveParticipantsRequest:t,receiveMediaUpdateRequest:B,receiveOverlayConfigServerUpdateRequest:w,receiveStateSyncNotifyRequest:x,sendStateSyncUnsubscribeRequest:z,sendStateSyncUpdateRequest:y,sendSubscriptionRequest:r,sendTerminateRequest:s,receiveCapabilitiesRequest:C,receiveClientInfoRequest:C,receiveGenericDataMessageRequest:C,receiveIceCandidateRequest:C,receiveParticipantUpdateRequest:C,receiveRemoteSdpRequest:C,sendGenericDataMessageRequest:C,receiveTerminateRequest:C,sendClientRenegotiationRequest:C,sendMediaUpdateRequest:C}},inviteAcknowledged:{on:{sendLocalSdpRequest:[{actions:[d("ZenonSignalingSharedActions").genericEventSender],cond:d("ZenonSignalingSMGuards").sdpOfferSendGuard,target:"offerSdpSent"},{actions:[d("ZenonSignalingSharedActions").genericEventSender],cond:d("ZenonSignalingSMGuards").sdpAnswerSendGuard,target:"negotiationComplete"}],receiveRemoteSdpRequest:{actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onReceiveRemoteSdpRequest)],cond:d("ZenonSignalingSMGuards").sdpOfferReceiveGuard,target:"offerSdpReceived"},receiveCapabilitiesRequest:k,receiveClientInfoRequest:l,receiveIceCandidateRequest:n,receiveMediaUpdateRequest:B,receiveParticipantUpdateRequest:u,receiveRoomContextUpdateRequest:v,receiveTerminateRequest:e,sendAnswerIntentRequest:f,sendClientInfoRequest:b,sendIceCandidateRequest:j,sendRemoveParticipantsRequest:t,receiveOverlayConfigServerUpdateRequest:w,receiveStateSyncNotifyRequest:x,sendStateSyncUnsubscribeRequest:z,sendStateSyncUpdateRequest:y,sendSubscriptionRequest:r,sendTerminateRequest:s,sendUsersApprovalRequest:A,sendMediaUpdateRequest:C,sendGenericDataMessageRequest:C,receiveGenericDataMessageRequest:C,sendClientRenegotiationRequest:C}},offerSdpReceived:{on:{sendLocalSdpRequest:{actions:d("ZenonSignalingSharedActions").genericEventSender,cond:d("ZenonSignalingSMGuards").sdpAnswerSendGuard,target:"negotiationComplete"},receiveCapabilitiesRequest:k,receiveClientInfoRequest:l,receiveIceCandidateRequest:n,receiveMediaUpdateRequest:B,receiveParticipantUpdateRequest:u,receiveRoomContextUpdateRequest:v,receiveTerminateRequest:e,sendAnswerIntentRequest:f,sendCapabilitiesRequest:q,sendUsersApprovalRequest:A,sendClientInfoRequest:b,sendIceCandidateRequest:j,sendRemoveParticipantsRequest:t,receiveOverlayConfigServerUpdateRequest:w,receiveStateSyncNotifyRequest:x,sendStateSyncUnsubscribeRequest:z,sendStateSyncUpdateRequest:y,sendSubscriptionRequest:r,sendTerminateRequest:s,receiveRemoteSdpRequest:C,sendGenericDataMessageRequest:C,receiveGenericDataMessageRequest:C,sendClientRenegotiationRequest:C,sendMediaUpdateRequest:C}},negotiationComplete:{on:{receiveCapabilitiesRequest:k,receiveClientInfoRequest:l,receiveGenericDataMessageRequest:m,receiveIceCandidateRequest:n,receiveInitiateRenegotiationRequest:{actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onReceiveInitiateRenegotiationRequest)]},receiveLocalSdpResponse:{actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onReceiveLocalSdpResponse)],cond:d("ZenonSignalingSMGuards").sdpJoinResponseReceiveGuard},receiveMediaUpdateRequest:B,receiveMediaUpdateResponse:{actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onNonSDPReceiveMediaUpdateResponse)]},receiveOverlayConfigServerUpdateRequest:w,receiveParticipantUpdateRequest:u,receivePendingApprovalRequest:{actions:[d("ZenonSignalingSharedActions").onReceivePendingApprovalRequest]},receiveRemoteSdpRequest:[{actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onReceiveRemoteSdpRequest)],cond:d("ZenonSignalingSMGuards").sdpOfferReceiveNotRejectedGuard,target:"serverInitiatedRenegotiating"},{actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onReceiveRemoteSdpRequest)],cond:d("ZenonSignalingSMGuards").sdpOfferReceiveRejectedGuard},{actions:[d("xstate").assign(d("ZenonSignalingNegotiationCompleteState").onReceiveAnswer)],cond:d("ZenonSignalingSMGuards").sdpAnswerReceiveGuard}],receiveRoomContextUpdateRequest:v,receiveStateSyncNotifyRequest:x,receiveTerminateRequest:e,sendAddParticipantsRequest:p,sendClientEventRequest:o,sendClientRenegotiationRequest:{actions:[d("ZenonSignalingSharedActions").onSendClientRenegotiationRequest],target:"clientInitiatedRenegotiating"},sendGenericDataMessageRequest:i,sendIceCandidateRequest:j,sendLocalSdpRequest:[{actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onSendLocalSdpRequestOffer)],cond:d("ZenonSignalingSMGuards").sdpOfferSendGuardNegotiationComplete,target:"clientInitiatedRenegotiating"},{actions:[d("ZenonSignalingSharedActions").genericEventSender],cond:d("ZenonSignalingSMGuards").sdpAnswerSendGuard}],sendMediaUpdateRequest:[{actions:[d("xstate").assign(d("ZenonSignalingNegotiationCompleteState").onSendMediaUpdateRequest)]}],sendPingRequest:{actions:[d("ZenonSignalingSharedActions").genericEventSender]},sendRemoveParticipantsRequest:t,sendStateSyncUnsubscribeRequest:z,sendStateSyncUpdateRequest:y,sendSubscriptionRequest:r,sendTerminateRequest:s,sendUsersApprovalRequest:A}},serverInitiatedRenegotiating:{on:{sendLocalSdpRequest:[{actions:["defer"],cond:d("ZenonSignalingSMGuards").sdpOfferSendGuard},{actions:[d("ZenonSignalingSharedActions").genericEventSender],cond:d("ZenonSignalingSMGuards").sdpAnswerSendGuard,target:"negotiationComplete"}],receiveCapabilitiesRequest:c("gkx")("3738")?C:k,receiveClientInfoRequest:c("gkx")("3738")?C:l,receiveGenericDataMessageRequest:m,receiveIceCandidateRequest:n,receiveMediaUpdateRequest:c("gkx")("3738")?C:B,receiveParticipantUpdateRequest:u,receiveRoomContextUpdateRequest:v,sendUsersApprovalRequest:A,receiveTerminateRequest:e,sendAddParticipantsRequest:c("gkx")("3738")?C:p,sendIceCandidateRequest:j,sendRemoveParticipantsRequest:c("gkx")("3738")?C:t,receiveOverlayConfigServerUpdateRequest:c("gkx")("3738")?C:w,receiveStateSyncNotifyRequest:c("gkx")("3738")?C:x,sendStateSyncUnsubscribeRequest:c("gkx")("3738")?C:z,sendStateSyncUpdateRequest:c("gkx")("3738")?C:y,sendSubscriptionRequest:c("gkx")("3738")?C:r,sendTerminateRequest:s,sendGenericDataMessageRequest:i,sendClientEventRequest:o,receiveLocalSdpResponse:C,receiveRemoteSdpRequest:C,sendMediaUpdateRequest:C,sendClientRenegotiationRequest:C,receiveMediaUpdateResponse:C}},clientInitiatedRenegotiating:{on:{sendLocalSdpRequest:[{actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onSendLocalSdpRequestOffer)],cond:d("ZenonSignalingSMGuards").sdpOfferSendGuard},{actions:["defer"],cond:d("ZenonSignalingSMGuards").sdpAnswerSendGuard}],receiveRemoteSdpRequest:[{actions:["defer"],cond:d("ZenonSignalingSMGuards").sdpOfferReceiveGuard},{actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onReceiveRemoteSdpRequest)],cond:d("ZenonSignalingSMGuards").sdpAnswerReceiveGuard,target:"negotiationComplete"}],receiveMediaUpdateResponse:[{actions:[d("xstate").assign(d("ZenonSignalingSharedActions").onReceiveMediaUpdateResponse)],cond:d("ZenonSignalingSMGuards").receiveNonOkMediaUpdateResponseGuard,target:"negotiationComplete"},{actions:["defer"]}],receiveCapabilitiesRequest:k,receiveClientInfoRequest:l,receiveGenericDataMessageRequest:m,receiveIceCandidateRequest:n,receiveMediaUpdateRequest:B,receiveParticipantUpdateRequest:u,receiveRoomContextUpdateRequest:v,sendUsersApprovalRequest:A,receiveTerminateRequest:e,sendAddParticipantsRequest:p,sendIceCandidateRequest:j,sendRemoveParticipantsRequest:t,receiveOverlayConfigServerUpdateRequest:w,receiveStateSyncNotifyRequest:x,sendStateSyncUnsubscribeRequest:z,sendStateSyncUpdateRequest:y,sendSubscriptionRequest:r,sendTerminateRequest:s,sendGenericDataMessageRequest:i,sendClientEventRequest:o,receiveLocalSdpResponse:C,sendMediaUpdateRequest:C,sendClientRenegotiationRequest:C}},terminated:{entry:[d("xstate").assign(d("ZenonSignalingTerminatedState").stopPingTimer)]}}};g["default"]=a}),98);
__d("ZenonSignalingClient",["ZenonInfraActionsLogger","ZenonMediaActionLogger","ZenonSignalingStateMachine","gkx","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,d,e){var f=this;this.$5=null;this.$6=function(){};this.$1=a;var g=this.$7();this.$2=new(c("ZenonSignalingStateMachine"))(babelHelpers["extends"]({logEvent:function(a){return f.$6(a)},onInviteReceived:function(a,b){e(a,b,f)},sendSignalingEvent:function(a){return d.sendEvent(a)}},g,{signalingModel:a}));b.setReceiver(function(a,b,c){return f.$2.processReceiveEvent(a,b,c)});this.$3=b;this.$4=d}var b=a.prototype;b.getSignalingModel=function(){return this.$1};b.sendInvite=function(a,b){b={eventName:"inviteRequest",inviterID:"0",isRemoteOfferer:!1,otherParticipants:a,requestingVideo:!1,roomInfo:{name:"mock"}};this.$2.processSendEvent(b)};b.initiateClientRenegotiation=function(a){a={eventName:"clientRenegotiationRequest",negotiationEvent:a};this.$2.processSendEvent(a)};b.sendSdp=function(a,b){b={eventName:"localSdpRequest",mediaStates:b,sdp:a};this.$2.processSendEvent(b)};b.sendIceCandidate=function(a){a={eventName:"iceCandidateRequest",iceCandidates:[a]};this.$2.processSendEvent(a)};b.sendClientEvent=function(a){a={clientEventType:a,eventName:"clientEventRequest"};this.$2.processSendEvent(a)};b.sendDismiss=function(a){this.$6({name:"dismissSent"});a={eventName:"terminateRequest",fromJoinResponse:!1,reason:a,shouldInformPeer:!0};this.$2.processSendEvent(a)};b.sendGenericDataMessage=function(a,b,c,d){b={data:b,eventName:"genericDataMessageRequest",recipientIDs:c,serviceRecipients:d,topic:a};this.$2.processSendEvent(b)};b.sendMediaUpdate=function(a){a={eventName:"mediaUpdateRequest",mediaStates:a};this.$2.processSendEvent(a)};b.sendAddParticipantsMessage=function(a){a={eventName:"addParticipantsRequest",participants:a};this.$2.processSendEvent(a)};b.sendRemoveParticipantsRequest=function(a){a={eventName:"removeParticipantsRequest",participants:a};this.$2.processSendEvent(a)};b.sendUsersApprovalRequest=function(a,b){a={approvalStatus:a,eventName:"usersApprovalRequest",targetUsers:b};this.$2.processSendEvent(a)};b.sendClientInfo=function(a,b,c){var d=this,e;(b||c)&&(e=new Map());b&&b.forEach(function(a,b){var c;(c=e)==null?void 0:c.set(b,d.getSignalingModel().getStateSyncStore().updateInputState(b,a))});c&&c.forEach(function(a,b){var c;(c=e)==null?void 0:c.set(b,a)});b={eventName:"clientInfoRequest",initialSyncStates:e,userCapabilities:a};this.$2.processSendEvent(b)};b.sendStateSyncUnsubscribe=function(a){var b=this.getSignalingModel(),c=b.getStateSyncStore().unsubscribe(a);a={eventName:"stateSyncUnsubscribeRequest",topic:a,version:c.version};this.$2.processSendEvent(a);b.notify()};b.sendStateSyncUpdate=function(a,b){var c=this.getSignalingModel();b=c.getStateSyncStore().updateInputState(a,b);a={data:b.data!=null?b.data:void 0,eventName:"stateSyncUpdateRequest",topic:a,version:b.version};this.$2.processSendEvent(a);c.notify()};b.sendSubscriptionRequest=function(a){a={eventName:"subscriptionRequest",subscriptions:a};this.$2.processSendEvent(a)};b.receiveMessage=function(a){var b=a.getHeader(),d=b.remoteSignalingID;b=b.roomInfo;d!=null&&this.$1.getRemoteSignalingID()!==d&&(this.$1.updateRemoteSignalingID(d),this.$6({name:"setRemoteSignalingID",remoteSignalingID:d}),this.$1.notify());this.$8()&&b!=null&&this.$1.getRoomInfo().name!==b.name&&(c("ZenonInfraActionsLogger").updateCachedValues({conferenceName:b.name}),c("ZenonMediaActionLogger").updateCachedValues({conferenceName:b.name}),this.$1.updateRoomInfo(b),this.$1.notify());this.$3.receiveMessage(a)};b.isTerminated=function(){return this.$2.getState()==="terminated"};b.sendAnswerIntent=function(){var a={eventName:"answerIntentRequest"};this.$2.processSendEvent(a)};b.respondToInvite=function(a){a={ackMessageId:"",eventName:"inviteResponse",status:a};this.$2.processSendEvent(a)};b.setSignalingEventHandlers=function(a){if(this.$5!=null){c("recoverableViolation")("setSignalingEventHandlers should only be called once, to avoid accidentally losing handlers.","rtc_www");return}this.$5=a};b.setLoggingEventHandler=function(a){this.$6=a,this.$3.setLoggingEventHandler(a)};b.$7=function(){return{onCapabilitiesReceived:this.$9("onCapabilitiesReceived"),onClientInfoReceived:this.$9("onClientInfoReceived"),onClientRenegotiationReceived:this.$9("onClientRenegotiationReceived"),onDismissReceived:this.$9("onDismissReceived"),onGenericDataMessageReceived:this.$9("onGenericDataMessageReceived"),onIceCandidateReceived:this.$9("onIceCandidateReceived"),onInviteAcknowledgeSent:this.$9("onInviteAcknowledgeSent"),onMediaUpdateReceived:this.$9("onMediaUpdateReceived"),onMediaUpdateResponseReceived:this.$9("onMediaUpdateResponseReceived"),onParticipantUpdateReceived:this.$9("onParticipantUpdateReceived"),onPendingApprovalReceived:this.$9("onPendingApprovalReceived"),onRenegotiationRequested:this.$9("onRenegotiationRequested"),onRoomContextUpdateReceived:this.$9("onRoomContextUpdateReceived"),onSdpReceived:this.$9("onSdpReceived")}};b.$9=function(a){var b=this;return function(){if(b.$5&&b.$5[a]){var c;(c=b.$5)[a].apply(c,arguments)}}};b.$8=function(){return c("gkx")("3608")&&c("gkx")("1999049")};return a}();g["default"]=a}),98);
__d("ZenonMWEventAggregator",["ZenonSignalingMessage","ZenonSignalingTypes","randomInt","throttle"],(function(a,b,c,d,e,f,g){"use strict";var h=250;a=function(){function a(a,b){this.$3={},this.$4={},this.$5={},this.$6=0,this.$7=!1,this.$1=a,this.$2=b}var b=a.prototype;b.sendEvent=function(a){var b=[];switch(a.eventName){case"clientInfoRequest":this.$3.clientInfoRequest=a;b=this.$8();break;case"inviteRequest":this.$3.inviteRequest=a;b=this.$8();break;case"localSdpRequest":a.sdp.type==="offer"?this.$7?b=[a]:(this.$3.localSdpRequest=a,this.$7=!0,b=this.$8()):a.sdp.type==="answer"&&(this.$7?this.$5.initiateRenegotiationResponse!=null?(this.$5.localSdpRequest=a,b=this.$9()):(this.$4.localSdpRequest=a,b=this.$10()):(this.$3.localSdpRequest=a,this.$7=!0,b=this.$8()));break;case"remoteSdpResponse":a.type==="offer"?a.status===d("ZenonSignalingTypes").ZenonRemoteSdpResponseStatus.OK?this.$5.initiateRenegotiationResponse!=null?(this.$5.remoteSdpResponse=a,b=this.$9()):(this.$4.remoteSdpResponse=a,b=this.$10()):(this.$4={},this.$5={},b=[a]):b=[a];break;case"iceCandidateRequest":case"pingRequest":this.$1.getMediaModeManager().getMediaMode()==="p2p"&&(b=[a]);break;case"subscriptionRequest":c("throttle").withBlocking(function(){b=[a]},h);break;case"initiateRenegotiationResponse":a.hasRemoteOffer===!0?(this.$5.initiateRenegotiationResponse=a,b=this.$9()):b=[a];break;case"usersApprovalRequest":case"iceCandidateResponse":case"addParticipantsRequest":case"dismissResponse":case"genericDataMessageRequest":case"genericDataMessageResponse":case"inviteResponse":case"mediaUpdateRequest":case"mediaUpdateResponse":case"overlayConfigServerUpdateRequest":case"participantUpdateResponse":case"removeParticipantsRequest":case"stateSyncNotifyResponse":case"stateSyncUnsubscribeRequest":case"stateSyncUpdateRequest":case"terminateRequest":case"clientEventRequest":b=[a];break}return this.$11(b,a)};b.$12=function(a,b){return{messageID:(a=a)!=null?a:String(c("randomInt")(0,4294967294)+1),messageTags:(a=b)!=null?a:[],protocol:this.$1.getProtocol(),remoteInfo:this.$1.getRemoteInfo(),remoteSignalingID:this.$1.getRemoteSignalingID(),retryCount:0,roomInfo:this.$1.getRoomInfo(),sequenceNumber:this.$6++,signalingID:this.$1.getSignalingID(),userInfo:this.$1.getUserInfo()}};b.$8=function(){var a=this.$3,b=a.clientInfoRequest,c=a.inviteRequest;a=a.localSdpRequest;if(b!=null&&a!=null){this.$3={};return c!=null?[c,b,a]:[b,a]}return[]};b.$10=function(){var a=this.$4,b=a.localSdpRequest;a=a.remoteSdpResponse;if(a&&b){this.$4={};return[a,b]}return[]};b.$9=function(){var a=this.$5,b=a.initiateRenegotiationResponse,c=a.localSdpRequest;a=a.remoteSdpResponse;if(b&&a&&c){this.$5={};return[b,a,c]}return[]};b.$11=function(a,b){if(a.length>0){var d;d=(d=b.ackMessageId)!=null?d:(d=a.find(function(a){return a.ackMessageId}))==null?void 0:d.ackMessageId;b=(b=b.messageTags)!=null?b:(b=a.find(function(a){return a.messageTags}))==null?void 0:b.messageTags;d=this.$12(d,b);b=new(c("ZenonSignalingMessage"))(d,a);this.$2.sendMessage(b);return d.messageID}return""};return a}();g["default"]=a}),98);
__d("ZenonMWMessageSenderFactory",["ZenonGraphQLMWMessageSender"],(function(a,b,c,d,e,f,g){"use strict";function a(){return new(c("ZenonGraphQLMWMessageSender"))()}g.createMWMessageSender=a}),98);
__d("ZenonP2PEventAggregator",["ZenonSignalingMessage","randomInt"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){this.$3={},this.$1=a,this.$2=b}var b=a.prototype;b.sendEvent=function(a){var b;b=(b=a.ackMessageId)!=null?b:null;b=this.$4(b);var d=[];switch(a.eventName){case"answerIntentRequest":this.$5();break;case"inviteResponse":this.$3.inviteResponse=a;d=this.$6();break;case"remoteSdpResponse":this.$3.remoteSdpResponse=a;d=this.$6();break;case"terminateRequest":this.$5();d.push(a);break}if(d.length>0){a=new(c("ZenonSignalingMessage"))(b,d);this.$2.sendMessage(a);return a.getHeader().messageID}return""};b.setRemoteSignalingID=function(a){};b.$5=function(){var a=this.$4(null);a.remoteInfo={userID:a.userInfo.userID};var b={eventName:"answerIntentRequest"};a=new(c("ZenonSignalingMessage"))(a,[b]);this.$2.sendMessage(a)};b.$4=function(a){return{messageID:(a=a)!=null?a:String(c("randomInt")(0,4294967294)+1),protocol:this.$1.getProtocol(),remoteInfo:this.$1.getRemoteInfo(),retryCount:0,roomInfo:this.$1.getRoomInfo(),signalingID:this.$1.getSignalingID(),userInfo:this.$1.getUserInfo()}};b.$6=function(){var a=this.$3,b=a.inviteResponse;a=a.remoteSdpResponse;if(b!=null&&a!=null){this.$3={};return[b,a]}return[]};return a}();g["default"]=a}),98);
__d("CallEndReason",[],(function(a,b,c,d,e,f){a=Object.freeze({IGNORE_CALL:"IgnoreCall",HANGUP_CALL:"HangupCall",IN_ANOTHER_CALL:"InAnotherCall",ACCEPT_AFTER_HANGUP:"CallEndAcceptAfterHangUp",NO_ANSWER_TIMEOUT:"NoAnswerTimeout",INCOMING_TIMEOUT:"IncomingTimeout",OTHER_INSTANCE_HANDLED:"OtherInstanceHandled",SIGNALING_MESSAGE_FAILED:"SignalingMessageFailed",CONNECTION_DROPPED:"ConnectionDropped",CLIENT_INTERRUPTED:"ClientInterrupted",WEBRTC_ERROR:"WebRTCError",CLIENT_ERROR:"ClientError",NO_PERMISSION:"NoPermission",OTHER_NOT_CAPABLE:"OtherNotCapable",NO_UI_ERROR:"NoUIShown",UNSUPPORTED_VERSION:"VersionUnsupported",CALLER_NOT_VISIBLE:"CallerNotVisible",CARRIER_BLOCKED:"CarrierBlocked",OTHER_CARRIER_BLOCKED:"OtherCarrierBlocked",CLIENT_ENCRYPTION_ERROR:"ClientEncryptionError"});f["default"]=a}),66);
__d("WebrtcMessageType",[],(function(a,b,c,d,e,f){a=Object.freeze({OFFER:"offer",ANSWER:"answer",ICE_CANDIDATE:"ice_candidate",OK:"ok",HANG_UP:"hang_up",OTHER_DISMISS:"other_dismiss",MESSAGE_ACK:"msg_ack",PRANSWER:"pranswer",PING:"ping",PING_ACK:"ping_ack",ICE_RESTART_OFFER:"icerestart_offer",ICE_RESTART_ANSWER:"icerestart_answer",OFFER_ACK:"offer_ack",ANSWER_ACK:"answer_ack",SET_VIDEO:"set_video",ACK:"ack",INVALID:"invalid",OFFER_NACK:"offer_nack",NACK:"nack",VIDEO_REQUEST:"video_request",SDP_UPDATE:"sdp_update",SWITCH_TO_MULTIWAY:"switch_to_multiway",ON_HOLD:"on_hold",NEGOTIATE:"negotiate",RING:"ring",PR_OFFER_ACK:"pr_offer_ack",NOTIFY_MEDIA_STATE:"notify_media_state",CLIENT_REPORTED_EVENT:"client_reported_event",PCRESTART_OFFER:"pcrestart_offer"});f["default"]=a}),66);
__d("ZenonP2PMessageTypes",["CallEndReason","WebrtcMessageType"],(function(a,b,c,d,e,f,g){"use strict";g.ZenonP2PCallEndReason=c("CallEndReason"),g.ZenonP2PSignalingPayloadType=c("WebrtcMessageType")}),98);
__d("ZenonP2PTranslatorUtils",["ZenonActorHooks","ZenonDismissReason","ZenonP2PMessageTypes","ZenonSignalingProtocol"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=h[a];return(a=a)!=null?a:d("ZenonDismissReason").ZenonDismissReason.CallEnded}function b(a,b){var e=b.call_id,f=b.from;b=b.source;var g=f+":"+d("ZenonActorHooks").ZenonActor.getID();return{messageID:a,protocol:c("ZenonSignalingProtocol").P2P,remoteInfo:{deviceInfo:{deviceID:b},userID:f},remoteSignalingID:String(e),retryCount:0,roomInfo:{name:g},signalingID:String(e),userInfo:{userID:d("ZenonActorHooks").ZenonActor.getID()}}}function e(a){switch(a){case d("ZenonDismissReason").ZenonDismissReason.HangupCall:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.HANGUP_CALL;case d("ZenonDismissReason").ZenonDismissReason.IgnoreCall:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.IGNORE_CALL;case d("ZenonDismissReason").ZenonDismissReason.InAnotherCall:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.IN_ANOTHER_CALL;case d("ZenonDismissReason").ZenonDismissReason.AcceptAfterHangUp:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.ACCEPT_AFTER_HANGUP;case d("ZenonDismissReason").ZenonDismissReason.NoAnswerTimeout:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.NO_ANSWER_TIMEOUT;case d("ZenonDismissReason").ZenonDismissReason.IncomingTimeout:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.INCOMING_TIMEOUT;case d("ZenonDismissReason").ZenonDismissReason.OtherInstanceHandled:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.OTHER_INSTANCE_HANDLED;case d("ZenonDismissReason").ZenonDismissReason.SignalingMessageFailed:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.SIGNALING_MESSAGE_FAILED;case d("ZenonDismissReason").ZenonDismissReason.ConnectionDropped:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CONNECTION_DROPPED;case d("ZenonDismissReason").ZenonDismissReason.ClientInterrupted:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CLIENT_INTERRUPTED;case d("ZenonDismissReason").ZenonDismissReason.WebRTCError:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.WEBRTC_ERROR;case d("ZenonDismissReason").ZenonDismissReason.ClientError:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CLIENT_ERROR;case d("ZenonDismissReason").ZenonDismissReason.NoPermission:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.NO_PERMISSION;case d("ZenonDismissReason").ZenonDismissReason.OtherNotCapable:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.OTHER_NOT_CAPABLE;case d("ZenonDismissReason").ZenonDismissReason.NoUIShown:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.NO_UI_ERROR;case d("ZenonDismissReason").ZenonDismissReason.VersionUnsupported:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.UNSUPPORTED_VERSION;case d("ZenonDismissReason").ZenonDismissReason.CallerNotVisible:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CALLER_NOT_VISIBLE;case d("ZenonDismissReason").ZenonDismissReason.CarrierBlocked:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CARRIER_BLOCKED;case d("ZenonDismissReason").ZenonDismissReason.OtherCarrierBlocked:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.OTHER_CARRIER_BLOCKED;case d("ZenonDismissReason").ZenonDismissReason.ClientEncryptionError:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CLIENT_ENCRYPTION_ERROR;default:return d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.HANGUP_CALL}}var h=Object.freeze((f={},f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.HANGUP_CALL]=d("ZenonDismissReason").ZenonDismissReason.HangupCall,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.IGNORE_CALL]=d("ZenonDismissReason").ZenonDismissReason.IgnoreCall,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.IN_ANOTHER_CALL]=d("ZenonDismissReason").ZenonDismissReason.InAnotherCall,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.ACCEPT_AFTER_HANGUP]=d("ZenonDismissReason").ZenonDismissReason.AcceptAfterHangUp,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.NO_ANSWER_TIMEOUT]=d("ZenonDismissReason").ZenonDismissReason.NoAnswerTimeout,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.INCOMING_TIMEOUT]=d("ZenonDismissReason").ZenonDismissReason.IncomingTimeout,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.OTHER_INSTANCE_HANDLED]=d("ZenonDismissReason").ZenonDismissReason.OtherInstanceHandled,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.SIGNALING_MESSAGE_FAILED]=d("ZenonDismissReason").ZenonDismissReason.SignalingMessageFailed,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CONNECTION_DROPPED]=d("ZenonDismissReason").ZenonDismissReason.ConnectionDropped,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CLIENT_INTERRUPTED]=d("ZenonDismissReason").ZenonDismissReason.ClientInterrupted,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CLIENT_ERROR]=d("ZenonDismissReason").ZenonDismissReason.ClientError,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.WEBRTC_ERROR]=d("ZenonDismissReason").ZenonDismissReason.WebRTCError,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CLIENT_ERROR]=d("ZenonDismissReason").ZenonDismissReason.ClientError,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.NO_PERMISSION]=d("ZenonDismissReason").ZenonDismissReason.NoPermission,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.OTHER_NOT_CAPABLE]=d("ZenonDismissReason").ZenonDismissReason.OtherNotCapable,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.NO_UI_ERROR]=d("ZenonDismissReason").ZenonDismissReason.NoUIShown,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.UNSUPPORTED_VERSION]=d("ZenonDismissReason").ZenonDismissReason.VersionUnsupported,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CALLER_NOT_VISIBLE]=d("ZenonDismissReason").ZenonDismissReason.CallerNotVisible,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CARRIER_BLOCKED]=d("ZenonDismissReason").ZenonDismissReason.CarrierBlocked,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.OTHER_CARRIER_BLOCKED]=d("ZenonDismissReason").ZenonDismissReason.OtherCarrierBlocked,f[d("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CLIENT_ENCRYPTION_ERROR]=d("ZenonDismissReason").ZenonDismissReason.ClientEncryptionError,f));g.fromP2PCallEndReason=a;g.p2pMessageToSignalingMessageHeader=b;g.toP2PCallEndReason=e}),98);
__d("ZenonP2PMessageTranslator",["errorCode","ZenonDismissReason","ZenonMWMessageTypes","ZenonP2PMessageTypes","ZenonP2PTranslatorUtils","ZenonParticipantState","ZenonSignalingMessage"],(function(a,b,c,d,e,f,g,h){"use strict";var i=0,j=3;function a(a){var b=a.getHeader();a=a.getEvents();if(a.length===0)throw new Error("Unexpected Translation: called toP2PMessage with empty signaling events");switch(a[0].eventName){case"answerIntentRequest":return r(b);case"inviteResponse":if(a[0].status==="NOT_SUPPORTED")return p(b);else return o(b);case"terminateRequest":return q(b,a[0]);default:return null}}function b(a){switch(a.type){case d("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.OFFER:return k(a);case d("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.HANG_UP:return l(a);case d("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.OTHER_DISMISS:return m(a);case d("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.ICE_CANDIDATE:return n(a);default:return null}}function k(a){var b=d("ZenonP2PTranslatorUtils").p2pMessageToSignalingMessageHeader(String(a.msg_id),a),e=[],f=a.escalation_conference_name,g=a.from,h=a.videoon;h={eventName:"inviteRequest",inviterID:g,isRemoteOfferer:!0,otherParticipants:[],requestingVideo:h,roomInfo:{context:{groupThreadID:null,peerID:g,serverInfoData:null},name:f}};e.push(h);f={eventName:"remoteSdpRequest",mediaPath:d("ZenonMWMessageTypes").ZenonMWMediaPath.P2P,sdp:{sdp:a.sdp,type:"offer",version:0},mediaStates:{tracks:[],version:0},negotiateType:!1,source:"p2pOffer"};e.push(f);h={capabilities:{addParticipantEnabled:a.offer_escalation_support,cowatchEnabled:!1,cowatchGroupEnabled:!1},eventName:"capabilitiesRequest"};e.push(h);f=new Map([[g,d("ZenonParticipantState").ZenonParticipantState.CONNECTED]]);a={eventName:"participantUpdateRequest",participantStates:f,versionId:i};e.push(a);return new(c("ZenonSignalingMessage"))(b,e)}function l(a){var b=d("ZenonP2PTranslatorUtils").p2pMessageToSignalingMessageHeader(String(a.msg_id),a),e=[],f=a.from,g=a.reason;a=a.subreason;g={eventName:"terminateRequest",fromJoinResponse:!1,reason:d("ZenonP2PTranslatorUtils").fromP2PCallEndReason(g),shouldInformPeer:!0,subreason:a};e.push(g);a=new Map([[f,d("ZenonParticipantState").ZenonParticipantState.DISCONNECTED]]);g={eventName:"participantUpdateRequest",participantStates:a,versionId:j};e.push(g);return new(c("ZenonSignalingMessage"))(b,e)}function m(a){a=d("ZenonP2PTranslatorUtils").p2pMessageToSignalingMessageHeader(String(a.msg_id),a);var b=[],e={eventName:"terminateRequest",fromJoinResponse:!1,reason:d("ZenonDismissReason").ZenonDismissReason.OtherInstanceHandled,shouldInformPeer:!0};b.push(e);return new(c("ZenonSignalingMessage"))(a,b)}function n(a){var b=d("ZenonP2PTranslatorUtils").p2pMessageToSignalingMessageHeader(String(a.msg_id),a),e=[],f=a.sdp,g=a.sdp_line_idx;a=a.sdp_mid;f={candidateSdpString:f,sdpMLineIndex:g,sdpMid:a};g={eventName:"iceCandidateRequest",iceCandidates:[f]};e.push(g);return new(c("ZenonSignalingMessage"))(b,e)}function o(a){if(a.signalingID===null)throw new Error("Unexpected P2P Translation: expected signalingID to not be null");return{ack_id:parseInt(a.messageID,10),call_id:parseInt(a.signalingID,10),msg_id:parseInt(a.messageID,10),type:"offer_ack"}}function p(a){if(a.signalingID===null)throw new Error("Unexpected P2P Translation: expected signalingID to not be null");return{ack_id:parseInt(a.messageID,10),call_id:parseInt(a.signalingID,10),error_code:1356043,msg_id:parseInt(a.messageID,10),type:"offer_nack"}}function q(a,b){if(a.signalingID===null)throw new Error("Unexpected P2P Translation: expected signalingID to not be null");var c=parseInt(a.messageID,10);a=parseInt(a.signalingID,10);b=d("ZenonP2PTranslatorUtils").toP2PCallEndReason(b.reason);return{call_id:a,msg_id:c,reason:b,type:"hang_up",version:0}}function r(a){if(a.signalingID===null)throw new Error("Unexpected P2P Translation: expected signalingID to not be null");var b=parseInt(a.signalingID,10);a=parseInt(a.messageID,10);return{call_id:b,msg_id:a,type:"other_dismiss"}}g.toP2PMessage=a;g.toSignalingMessage=b}),98);
__d("ZenonP2PSendMessageMutation",["Promise","RelayFBEnvironment","RelayModern","ZenonP2PSendMessageMutation.graphql","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,e,f){return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:return g.abrupt("return",new(b("Promise"))(function(g,i){d("RelayModern").commitMutation(c("RelayFBEnvironment"),{mutation:h!==void 0?h:h=b("ZenonP2PSendMessageMutation.graphql"),onCompleted:function(a){return g(a)},onError:function(a){return i(a)},variables:{input:{message:a,msg_id:f,recipient_id:e}}})}));case 1:case"end":return g.stop()}},null,this)}function a(a,c,d){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(i(a,c,d));case 2:f=g.sent;return g.abrupt("return",(e=f.rtc_web_send_p2p_signaling_message)!=null?e:!1);case 4:case"end":return g.stop()}},null,this)}g.sendMessage=a}),98);
__d("ZenonP2PMessageSender",["ZenonP2PMessageTranslator","ZenonP2PSendMessageMutation"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){}var b=a.prototype;b.sendMessage=function(a){var b=d("ZenonP2PMessageTranslator").toP2PMessage(a);if(b!=null){a=a.getHeader();var c=a.remoteInfo.userID;a=a.messageID;d("ZenonP2PSendMessageMutation").sendMessage(JSON.stringify(b),c,a)}};b.setMessageReceiver=function(a){};b.setLoggingEventHandler=function(a){};return a}();g["default"]=a}),98);
__d("ZenonTransactionManager",["cr:134"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){this.$4=function(){},this.$3=new Map(),this.$1=a,this.$2=b}var c=a.prototype;c.$5=function(a){var c=this;if(this.$3.has(a))return this.$3.get(a);this.$3.set(a,new(b("cr:134"))(a,this.$2,function(a){return c.$1.sendMessage(a)},function(a){var b=a.getHeader(),d=b.messageID,e=b.protocol;b=a.getEvents();b.forEach(function(a){return c.$4(a,d,e)})}));return this.$3.get(a)};c.sendMessage=function(a){var b=a.getHeader();b=b.messageID;b=this.$5(b);b!==void 0&&b!==null&&b.sendMessage(a)};c.receiveMessage=function(a){var b=a.getHeader();b=b.messageID;b=this.$5(b);b!==void 0&&b!==null&&b.receiveMessage(a)};c.setReceiver=function(a){this.$4=a};c.setLoggingEventHandler=function(a){this.$1.setLoggingEventHandler(a)};return a}();g["default"]=a}),98);
__d("ZenonProtocolConfiguration",["ZenonMWEventAggregator","ZenonMWMessageSenderFactory","ZenonP2PEventAggregator","ZenonP2PMessageSender","ZenonSignalingProtocol","ZenonTransactionManager"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b===void 0&&(b=null);var e,f,g;if(a.getProtocol()===c("ZenonSignalingProtocol").P2P)e=new(c("ZenonP2PMessageSender"))(),f=new(c("ZenonTransactionManager"))(e,a),g=new(c("ZenonP2PEventAggregator"))(a,f);else{e=(b=b)!=null?b:d("ZenonMWMessageSenderFactory").createMWMessageSender();f=new(c("ZenonTransactionManager"))(e,a);g=new(c("ZenonMWEventAggregator"))(a,f)}return{eventAggregator:g,messageSender:e,transactionManager:f}}g.getConfiguration=a}),98);
__d("ZenonMediaModeManager",["$InternalEnum","ZenonInfraActionsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h=b("$InternalEnum").Mirrored(["MwCaller","MwCallee","MwppCaller","MwppCallee"]);a=function(){function a(){this.$1="sfu"}var b=a.prototype;b.onJoin=function(a,b,c){a=this.$2(a,b,c);switch(a){case h.MwppCaller:case h.MwppCallee:this.$3("p2p");return;case h.MwCaller:case h.MwCallee:this.$3("sfu");return}};b.onDeescalated=function(){this.$3("p2p")};b.onSfuEscalated=function(){this.$3("sfu")};b.getMediaMode=function(){return this.$1};b.$3=function(a){this.$1=a,c("ZenonInfraActionsLogger").updateCachedValues({mediaPath:a}),c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"Media mode updated to "+a,mediaPath:a})};b.$2=function(a,b,c){return a?b===1?h.MwppCaller:h.MwCaller:c?h.MwppCallee:h.MwCallee};return a}();g["default"]=a}),98);
__d("ZenonStateSyncStore",["ZenonInfraActionsLogger","ZenonStateSyncSerializer"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=new Map(),this.$2=new Map(),this.$3=new Set(),this.$4=new Map()}var b=a.prototype;b.addTopicHandler=function(a,b){this.$3.add(a);var c=this.getTopicHandlers(a);this.$4.set(a,c.add(b))};b.getTopicHandlers=function(a){return(a=this.$4.get(a))!=null?a:new Set()};b.getInputStates=function(){return this.$1};b.getOutputStates=function(){return this.$2};b.updateInputState=function(a,b){var e;this.$3.add(a);e=((e=(e=this.$1.get(a))==null?void 0:e.version)!=null?e:0)+1;this.$1.set(a,{data:b,version:e});b=d("ZenonStateSyncSerializer").serializeInputState(a,b);a==="live_stream"&&c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"Update state sync "+a+" and serialized input data "+JSON.stringify(b)});return b!==null?{data:b,version:e}:{version:e}};b.updateOutputState=function(a,b){var c;if(!this.$3.has(a))return;c=(c=(c=this.$2.get(a))==null?void 0:c.version)!=null?c:-1;if(b.version<=c)return;var e=d("ZenonStateSyncSerializer").deserializeOutputState(a,b.data);this.$2.set(a,{data:e,version:b.version});c=this.getTopicHandlers(a);c&&c.forEach(function(a){return a(e)})};b.unsubscribe=function(a){var b;this.$3["delete"](a);b=((b=(b=this.$1.get(a))==null?void 0:b.version)!=null?b:0)+1;this.$1.set(a,{data:null,version:b});return{version:b}};return a}();g["default"]=a}),98);
__d("ZenonSignalingModel",["ZenonMediaModeManager","ZenonStateSyncStore"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,d,e,f,g){this.$8=new(c("ZenonStateSyncStore"))(),this.$10=new(c("ZenonMediaModeManager"))(),this.$1=a,this.$2=b,this.$3=d,this.$4=e,this.$5=f,this.$6=g}var b=a.prototype;b.getSignalingID=function(){return this.$1};b.updateRemoteSignalingID=function(a){this.$2=a};b.getRemoteSignalingID=function(){return this.$2};b.getUserInfo=function(){return this.$3};b.getRemoteInfo=function(){return this.$4};b.getRoomInfo=function(){return this.$5};b.updateRoomInfo=function(a){this.$5=a};b.getProtocol=function(){return this.$6};b.getMediaModeManager=function(){return this.$10};b.getStateSyncStore=function(){return this.$8};b.updateOverlayConfigServerLayer=function(a){this.$7=a};b.getOverlayConfigServerLayer=function(){return this.$7};b.setNotifyCallback=function(a){this.$9=a};b.notify=function(){this.$9&&this.$9()};return a}();g["default"]=a}),98);
__d("ZenonSignalingClientManager",["ZenonActorHooks","ZenonProtocolConfiguration","ZenonSignalingModel","immutable","randomInt"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,e){e===void 0&&(e=null),this.$6=null,this.$1=c("immutable").Map(),this.$2={userID:d("ZenonActorHooks").ZenonActor.getID()},this.$3=b,this.$4=new Set(),this.$5=a,this.$6=e}var b=a.prototype;b.getSignalingClient=function(a){return this.$1.get(a)};b.getSignalingClientWithRemoteSignalingID=function(a){var b=this.$1.find(function(b){return b.getSignalingModel().getRemoteSignalingID()===a&&!b.isTerminated()});return b};b.createSignalingClient=function(a,b,e,f,g){var h=this;a=(a=a)!=null?a:String(c("randomInt")(0,4294967294)+1);e=new(c("ZenonSignalingModel"))(a,e,this.$2,b,g,f);b=d("ZenonProtocolConfiguration").getConfiguration(e,this.$6);g=b.eventAggregator;f=b.messageSender;b=b.transactionManager;e=new this.$5(e,b,g,this.$3);f.setMessageReceiver(function(a){return h.receiveMessage(a)});this.$1=this.$1.set(a,e);return e};b.receiveMessage=function(a){var b=a.getHeader(),c=this.$7(a);if(c==null)return;else a.setSignalingID(c);var d=this.getSignalingClient(c);if(d!=null)d.receiveMessage(a);else{d=this.createSignalingClient(c,b.remoteInfo,b.remoteSignalingID,b.protocol,b.roomInfo);d.getSignalingModel().updateRemoteSignalingID(b.remoteSignalingID);d.receiveMessage(a)}};b.$7=function(a){var b=a.getHeader(),d=b.signalingID;if(d!=null)return d;if(!this.$8(b.messageID))return null;b=b.remoteSignalingID;if(a.getEvents().some(function(a){return a.eventName==="terminateRequest"})&&b!=null){a=this.getSignalingClientWithRemoteSignalingID(b);a&&(d=a.getSignalingModel().getSignalingID())}if(d==null){b=c("randomInt")(0,4294967294)+1;d=String(b)}return d};b.$8=function(a){if(this.$4.has(a))return!1;this.$4.add(a);return!0};return a}();g["default"]=a}),98);
__d("ZenonSimulcastUtils",["UserAgent","ZenonSimulcastManager","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a;a=(a=c("gkx")("527"))!=null?a:!1;return a}function a(a){return a&&i()&&h()}function i(){return c("UserAgent").isBrowser("Chrome >= 88")}function b(){return c("gkx")("527")?d("ZenonSimulcastManager").NUM_LAYERS:1}g.shouldUseChromeSimulcast=h;g.shouldUseSimulcast=a;g.isCurrentBrowserCompatibleWithSimulcast=i;g.getNumLayers=b}),98);
__d("ZenonTransportEventEmitter",["EventEmitter"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var c=b.prototype;c.emitJoinReady=function(a){this.emit("transportPlatformEvent",{messageType:"joinReady",mwRingRequest:a})};c.emitParentWindowConnectionTimeout=function(){this.emit("transportPlatformEvent",{messageType:"parentWindowConnectionTimeout",mwRingRequest:null})};return b}(c("EventEmitter"));b=new a();d=b;g["default"]=d}),98);
__d("ZenonCallsManager",["invariant","FBLogger","FBMqttChannel","OverlayConfigManagerWithServerLayer","PersistedQueue","PlatformType","Promise","ZenonCallLogger","ZenonConnectionStateManager","ZenonDebugLogger","ZenonDismissReason","ZenonHybridMWMessageSender","ZenonInfraActionsLogger","ZenonMWMessageTranslator","ZenonMultiwayReliabilityLogProcessor","ZenonRTCPeerConnectionConfig","ZenonSDKRateLimiter","ZenonSignalingChildTransport","ZenonSignalingClient","ZenonSignalingClientManager","ZenonSignalingProtocol","ZenonSimulcastUtils","ZenonTransportEventEmitter","ZenonTurnDiscovery","cr:11367","cr:11756","cr:11879","cr:1557768","cr:1578322","cr:1606520","gkx","immutable","performanceNow","promiseDone","regeneratorRuntime","unrecoverableViolation"],(function(a,b,c,d,e,f,g,h){"use strict";var i="E2eeKey";a=function(){function a(a){var d=this;this.$4=new Map();this.$5=null;this.$7=null;c("gkx")("357")&&(this.$7=new(c("ZenonSDKRateLimiter"))());this.$1=c("immutable").Map();this.$2=a;a=null;b("cr:11367")!==null?a=new(b("cr:11367"))(new(c("ZenonHybridMWMessageSender"))()):a=new(c("ZenonHybridMWMessageSender"))();this.$3=new(c("ZenonSignalingClientManager"))(c("ZenonSignalingClient"),function(a,b,c){return d.onInviteReceived(a,b,c)},a);this.$6=this.$8();var e=null,f=0,g=c("ZenonDebugLogger").getInstance();c("FBMqttChannel").subscribeChannelEvents({onMQTTStateChanged:function(a){if(a==="Disconnected"&&e==null)e=c("performanceNow")();else if(a==="Connecting")f++;else if(a==="Connected"&&e!=null){var b=c("performanceNow")()-e;g.logMQTTConnectStats(b,f);e=null;f=0}g.logMQTTStateChange(a)}})}var e=a.prototype;e.$8=function(){var a,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:a=Date.now();f.prev=1;f.next=4;return b("regeneratorRuntime").awrap(d("ZenonTurnDiscovery").requestTurnCreds("ZenonPlatform","MW_PEER_ID"));case 4:e=f.sent;c("ZenonRTCPeerConnectionConfig").setTurnCredentials(e);c("ZenonInfraActionsLogger").logCheckpoint({callType:"mw",checkpoint:"[ZP] successfully acquired TURN credentials. Took "+(Date.now()-a)+" ms."});f.next=12;break;case 9:f.prev=9,f.t0=f["catch"](1),c("ZenonInfraActionsLogger").logError({callType:"mw",checkpoint:"[ZP] failed to get TURN credentials. Took "+(Date.now()-a)+" ms. Error message: "+f.t0,errorDomain:"ZenonCallsManager_fetchTurnCredentials"});case 12:case"end":return f.stop()}},null,this,[[1,9]])};e.getLogProcessors=function(){var a=[b("cr:11756"),c("ZenonMultiwayReliabilityLogProcessor")];b("cr:1557768")&&a.push(b("cr:1557768"));b("cr:1578322")&&a.push(b("cr:1578322"));b("cr:1606520")&&a.push(b("cr:1606520"));return a};e.onInviteReceived=function(a,b,e){b=this.$2.getConfigManager().getZenonMultiCallSupportConfig().getMaxConnectedCalls();var f=this.$1.filter(function(a){return a.getConnectionState()!=="terminated"}),g=f.filter(function(b){return b.getServerCallID()===((b=a.roomInfo.context)==null?void 0:b.serverInfoData)});if(g.size>0){e.respondToInvite("OK");return}g=f.some(function(a){return a.getServerCallID()==null});f.size>=b&&(f.size>b&&c("FBLogger")("rtc_www").warn("We have more than supported number of calls occurring"),e.respondToInvite("IN_ANOTHER_CALL"),g||e.sendDismiss(d("ZenonDismissReason").ZenonDismissReason.InAnotherCall))};e.join=function(a){var e,f,g,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;return b("regeneratorRuntime").async(function(I){while(1)switch(I.prev=I.next){case 0:c("PersistedQueue").eventEmitter.emit("active",null);a.peerID!=null||h(0,18600);g={userID:a.peerID};j=a.callTrigger,k=a.clientCallID,l=a.localMedia,m=a.mwRingRequest,n=a.peerID,o=a.peerIDForJoiningContext,p=a.roomID,q=p===void 0?null:p,r=a.serverCallID,s=a.usersToRing;t={context:{groupThreadID:null,peerID:o,serverInfoData:null},name:q};m!=null&&(m.jsonPayload.header.clientSessionId=(u=r)!=null?u:"");if(!(this.$1.get(k)!=null)){I.next=8;break}throw c("unrecoverableViolation")("Call with id "+k+" already exists. Use a new clientCallID/clientSessionID if rejoining.","rtc_www");case 8:v=null;r!=null&&(v=this.$3.getSignalingClient(r));v==null&&(v=this.$3.createSignalingClient(r,g,a.serverInfoData,c("ZenonSignalingProtocol").MWPP,t));w=v.getSignalingModel();x=w.getSignalingID();y=m==null;z=(m==null?void 0:(e=m.jsonPayload.body.ringRequest)==null?void 0:(f=e.offer)==null?void 0:f.sdpString)!=null;w.getMediaModeManager().onJoin(y,s.length,z);A=this.$4.get(k);A==null&&(C=l.find(function(a){return a.contentType==="video"})!=null,A=new(c("ZenonCallLogger"))({callID:(B=r)!=null?B:k,callTrigger:j,conferenceName:a.roomID,isCaller:y,isVideo:C,peerID:n,protocol:c("ZenonSignalingProtocol").MWPP,serverInfoData:a.serverInfoData,signalingID:x},this.getLogProcessors()),this.$4.set(k,A),c("ZenonInfraActionsLogger").updateCachedValues({signalingID:x}));D=d("ZenonSimulcastUtils").shouldUseSimulcast(!0);v!=null||h(0,23327);if(!(w.getMediaModeManager().getMediaMode()==="p2p")){I.next=23;break}I.next=23;return b("regeneratorRuntime").awrap(this.$6);case 23:if(!b("cr:11879")){I.next=27;break}I.next=26;return b("regeneratorRuntime").awrap(b("cr:11879").createNewSecureFrameManager(function(a){var b;(b=A)==null?void 0:b.log({e2eeStats:a,name:"updateE2EEStats"})},function(a,b){var c;(c=v)==null?void 0:c.sendGenericDataMessage(i,b,[a],[])}));case 26:E=I.sent;case 27:F=new(c("OverlayConfigManagerWithServerLayer"))(this.$2.getConfigManager());G=new(c("ZenonConnectionStateManager"))(k,v,y?"outgoing":"incoming",F,A,D,E);A.log({hasOfferInRingRequest:z,isCaller:y,name:"callJoinRequest"});this.$1=this.$1.set(k,G);I.next=33;return b("regeneratorRuntime").awrap(G.start(a));case 33:c("ZenonInfraActionsLogger").logCheckpoint({callID:r,callType:"mw",checkpoint:"[ZP] ZenonCallsManager_join called, starting connectionStateManager",conferenceName:a.roomID,isCaller:y}),m&&(H=d("ZenonMWMessageTranslator").toSignalingMessage(m),this.$3.receiveMessage(H)),c("gkx")("965758")?c("ZenonInfraActionsLogger").logCheckpoint({callID:this.$9(r,k),callType:"mw",checkpoint:"[ZP] Eligible for tslog logging",conferenceName:a.roomID,isCaller:y,serverInfoData:a.serverInfoData}):c("ZenonInfraActionsLogger").logCheckpoint({callID:this.$9(r,k),callType:"mw",checkpoint:"[ZP] Not eligible for tslog logging",conferenceName:a.roomID,isCaller:y,serverInfoData:a.serverInfoData});case 36:case"end":return I.stop()}},null,this)};e.$9=function(a,b){return(a=a)!=null?a:b};e.addLocalTrack=function(a,b){this.$10(a,function(a){a.addLocalTrack(b)})};e.removeLocalTrack=function(a,b){this.$10(a,function(a){a.removeLocalTrack(b)})};e.muteTrack=function(a,b){this.$10(a,function(a){a.muteTrack(b)})};e.unmuteTrack=function(a,b){this.$10(a,function(a){a.unmuteTrack(b)})};e.stopLocalVideo=function(a,b){this.$10(a,function(a){a.stopLocalTrack(b)})};e.initializeV2Infrastructure=function(a,b){var d=b.callID,e=b.callTrigger,f=b.initializeVideo,g=b.peerID,h=b.peerIDForJoiningContext,i=b.roomID;i=i===void 0?null:i;b=b.serverInfoData;var j={userID:g};h={context:{groupThreadID:null,peerID:h,serverInfoData:null},name:i};j=this.$3.createSignalingClient(d==null?void 0:String(d),j,b,c("ZenonSignalingProtocol").MWPP,h);h=j.getSignalingModel().getSignalingID();j=new(c("ZenonCallLogger"))({callID:d==null?a:String(d),callTrigger:e,conferenceName:i,isCaller:!0,isVideo:f,peerID:g,protocol:c("ZenonSignalingProtocol").MWPP,serverInfoData:b,signalingID:h},this.getLogProcessors());this.$4.set(a,j);c("ZenonInfraActionsLogger").updateCachedValues({signalingID:h})};e.initializeSignaling=function(a,b,d,e){var f=this,g=this.$2.getSignalingListener();g.subscribe(function(a){return f.$3.receiveMessage(a)},function(a){});c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP] Subscribed to MQTT channels. MQTT connection state: "+c("FBMqttChannel").getConnectionState()});g=this.$2.getConfigManager().getZenonStartCallImmediatelyConfig().isEnabled();if(g)c("ZenonTransportEventEmitter").emitJoinReady();else if(b!=null){g=this.$2.getConfigManager().getZenonPlatformSupportConfig().getParentWindowConnectionTimeoutMs();this.$5=new(c("ZenonSignalingChildTransport"))(b,a,g,d,e)}else c("ZenonTransportEventEmitter").emitParentWindowConnectionTimeout();this.$5&&c("promiseDone")(this.$5.connect(),function(a){a.state==="join_ready"?c("ZenonTransportEventEmitter").emitJoinReady(a.mwRingRequest):c("ZenonTransportEventEmitter").emitParentWindowConnectionTimeout()})};e.endCall=function(a,b,e){b=d("ZenonDismissReason").endCallToDismissReason(b);var f=this.$1.get(a);if(f)f.end(b,e);else{f=this.$4.get(a);f!=null?f.log({endCallReason:b,endCallSubreason:e,isRemoteEnded:!1,name:"callEnded"}):c("FBLogger")("rtc_www").warn("ZenonCallLogger missing for endCall")}};e.ringParticipants=function(a,b){this.$10(a,function(a){a.addParticipants(b)})};e.removeParticipants=function(a,b){this.$10(a,function(a){a.removeParticipants(b)})};e.replaceLocalTrack=function(a,c,d,e){e===void 0;this.$10(a,function(a){a.replaceLocalTrack(c,d)});return b("Promise").resolve()};e.notifyScreenShareStart=function(a){};e.notifyScreenShareEnd=function(a){};e.forceEncodingEnabled=function(a,b){this.$10(a,function(a){a.forceEncodingEnabled(b)})};e.acceptVideoEscalation=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:h(0,11323);case 1:case"end":return a.stop()}},null,this)};e.declineVideoEscalation=function(a){};e.cancelVideoEscalation=function(){h(0,11323)};e.startVideoEscalation=function(){h(0,11323)};e.submitRating=function(a,b,c,d){c===void 0&&(c=null);d===void 0&&(d=null);a=this.$4.get(a);a&&(b!=null&&a.log({name:"callRated",rating:b}),c!=null&&a.log({feedback:c,name:"callFeedbackSubmitted"}),d!=null&&a.log({name:"callSurveyChoiceSubmitted",surveyChoice:d}))};e.setRatingImpression=function(a,b){};e.setLinkSurface=function(a,b){a=this.$4.get(a);if(!a)return;b!=null&&a.log({linkSurface:b,name:"setLinkSurface"})};e.getCalls=function(){return this.$1};e.setCalls=function(a){this.$1=a};e.createDataMessageSubscription=function(a,b,c){this.$10(a,function(a){a.createDataMessageSubscription(b,c)})};e.removeDataMessageSubscription=function(a,b,c){this.$10(a,function(a){a.removeDataMessageSubscription(b,c)})};e.sendGenericDataMessage=function(a,b,c,d,e){if(!this.$11("dataMessage-"+b))return;this.$10(a,function(a){a.sendGenericDataMessage(b,c,d,e)})};e.getLogIdentifiers=function(a){return(a=this.$4.get(a))==null?void 0:a.getLogIdentifiers()};e.subscribeToRemoteVideo=function(a,b,c){a=this.$1.get(a);a!=null&&a.subscribeToRemoteVideo(b,c)};e.updateStateSyncTopic=function(a,b,c){if(!this.$11("updateStateSync-"+b))return;this.$10(a,function(a){a.updateStateSyncTopic(b,c)})};e.unsubscribeFromStateSyncTopic=function(a,b){this.$10(a,function(a){a.unsubscribeFromStateSyncTopic(b)})};e.approveParticipants=function(a,b){this.$10(a,function(a){a.approveParticipants(b.toArray())})};e.denyParticipants=function(a,b){this.$10(a,function(a){a.denyParticipants(b.toArray())})};e.getSdpFormat=function(a){return this.$10(a,function(a){return a.getSdpFormat()})};e.getPlatformType=function(){return c("PlatformType").Zenon};e.getSignalingProtocol=function(a){a=this.$12(a);return a==null?null:(a=this.$3.getSignalingClientWithRemoteSignalingID(a))==null?void 0:a.getSignalingModel().getProtocol()};e.getMediaMode=function(a){a=this.$12(a);return a==null?null:(a=this.$3.getSignalingClientWithRemoteSignalingID(a))==null?void 0:a.getSignalingModel().getMediaModeManager().getMediaMode()};e.getConferenceName=function(a){a=this.$12(a);return a==null?null:(a=this.$3.getSignalingClientWithRemoteSignalingID(a))==null?void 0:a.getSignalingModel().getRoomInfo().name};e.$12=function(a){return this.$10(a,function(a){return a.getServerCallID()})};e.$11=function(a){if(this.$7&&!this.$7.take(a)){c("FBLogger")("rtc_www").mustfix("[ZP] Dropping "+a+" invocation. This SDK method is being called too rapidly.");return!1}return!0};e.getCallProtocolType=function(){return"multiway"};e.$10=function(a,b){var d=this.$1.get(a);if(d!=null)return b(d);c("FBLogger")("rtc_www").warn("No call with id "+a+" was found. Call the join() method before invoking other call methods.");return null};return a}();g["default"]=a}),98);
__d("ZenonPeerConnectionDataActions",[],(function(a,b,c,d,e,f){"use strict";a=function(a,b){if(b.type==="createDataChannel"){b=b.payload;var c=b.dataChannelLabel;b=b.onDataChannelMessage;a.mediaChannelManager.createDataChannel(c,b)}};b=function(a,b){if(b.type==="dataChannelMessageReceived"){b=b.payload;var c=b.data;b=b.dataChannelLabel;a.onDataChannelMessageReceived(b,c)}};c=function(a,b){if(b.type==="createDataMessageSubscription"){b=b.payload;var c=b.dataChannelLabel;b=b.onSignalingDataMessage;a.onCreateDataMessageSubscription(c,b)}};d=function(a,b){if(b.type==="removeDataMessageSubscription"){b=b.payload;var c=b.dataChannelLabel;b=b.onSignalingDataMessage;a.onRemoveDataMessageSubscription(c,b)}};f.onCreateDataChannel=a;f.onDataChannelMessageReceived=b;f.onCreateDataMessageSubscription=c;f.onRemoveDataMessageSubscription=d}),66);
__d("ZenonPeerConnectionIceActions",["ZenonInfraActionsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h={onIceConnected:function(a){a.onConnectionEstablished()},onIceConnectionStateChanged:function(a,b){if(b.type==="iceConnectionStateChange"){c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"iceConnectionStateChange: "+b.payload.iceConnectionState});var d=b.payload.iceConnectionState==="connected"||b.payload.iceConnectionState==="completed",e=b.payload.iceConnectionState==="disconnected"||b.payload.iceConnectionState==="failed";d?h.onIceConnected(a):e&&a.onConnectionDropped();return b.payload}return{}}};a=h;g["default"]=a}),98);
__d("AggregateError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(c,d){var e;d=(d=d)!=null?d:g(c);e=a.call(this,d)||this;e.name="AggregateError";e.errors=c;e.message=d;Error.captureStackTrace&&Error.captureStackTrace(babelHelpers.assertThisInitialized(e),b);return e}return b}(babelHelpers.wrapNativeSuper(Error));function g(a){if(a.length===0)return"No errors";return a.length===1?a[0].message:a.map(function(a){return"- "+a.message}).join("\n")}f["default"]=a}),66);
__d("ZenonPeerConnectionMediaActions",["AggregateError","Promise","ZenonInfraActionsLogger","ZenonLoggingEventTypes","err","gkx","promiseDone","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";e=function(a,b){b.type==="applyRemoteIceCandidate"&&b.payload!=null&&c("promiseDone")(a.sdpManager.setRemoteIceCandidate(b.payload),function(){a.logEvent({direction:d("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive,name:"updateIceInfo",sdpString:b.payload.candidate})})};f=function(a,b){c("ZenonInfraActionsLogger").logError({checkpoint:"Failed to add local tracks: "+b.data.toString(),errorDomain:"ZenonPeerConnectionMediaActions_onAddLocalTracks"})};var h=function(a,b){c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"Successfully added local tracks"});return b.data},i=function(a,d){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:if(!(d.type!=="addLocalTracks")){h.next=2;break}return h.abrupt("return",{});case 2:e=d.payload.tracks;f=[];h.next=6;return b("regeneratorRuntime").awrap(b("Promise").allSettled(e.map(function(c){return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(a.mediaChannelManager.addTrack(c,d.payload.mediaMode));case 2:y(a,c.trackId,c.enabled);case 3:case"end":return e.stop()}},null,this)})));case 6:g=h.sent;g.forEach(function(a){a.status==="rejected"&&f.push(new(c("err"))(a.reason))});if(!(f.length>0)){h.next=10;break}throw new(c("AggregateError"))(f);case 10:a.mediaChannelManager.addReceiveOnlyVideoTransceiverIfNeeded(d.payload.mediaMode,d.payload.callInitiator);c("gkx")("1829601")&&a.mediaChannelManager.addInactiveAudioTransceiverIfNeeded();c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"add local tracks"});return h.abrupt("return",{localMediaStateVersion:a.localMediaStateVersion+e.length});case 14:case"end":return h.stop()}},null,this)},j=function(a,b){if(b.type!=="forceEncodingEnabled")return;a.mediaChannelManager.forceEncodingEnabled(b.payload.enabled)},k=function(a,b){b.type==="iceCandidateReady"&&a.onIceCandidateReady(b.payload)},l=function(a,b){if(b.type!=="localMediaStateUpdateRetry")return{};c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"local media state update retry with media status only"});b=z(a);a=b.localMediaStateVersion;return{localMediaStateUpdateRetryTimerId:null,localMediaStateVersion:a}},m=function(a,b){if(b.type==="muteLocalTrack"){a=x(a,b.payload.trackId,!1);c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"mute local track"});return a}return{}},n=function(a,b){c("ZenonInfraActionsLogger").logError({checkpoint:"Failed to remove local track: "+b.data.toString(),errorDomain:"ZenonPeerConnectionMediaActions_onRemoveLocalTracks"})},o=function(a,b){c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"Successfully removed local track"});return b.data},p=function(a,d){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:if(!(d.type!=="removeLocalTrack")){g.next=2;break}return g.abrupt("return",{});case 2:e=d.payload.trackId;g.next=5;return b("regeneratorRuntime").awrap(a.mediaChannelManager.removeTrack(e));case 5:f=x(a,e,!1);c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"remove local track with id "+e});return g.abrupt("return",f);case 8:case"end":return g.stop()}},null,this)},q=function(a,b){c("ZenonInfraActionsLogger").logError({checkpoint:"Failed to replace local tracks: "+b.data.toString(),errorDomain:"ZenonPeerConnectionMediaActions_onReplaceLocalTrack"})},r=function(a,d){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:if(!(d.type!=="replaceLocalTrack")){i.next=2;break}return i.abrupt("return",a);case 2:e=d.payload,f=e.replacementTrack,g=e.trackIdToReplace;i.next=5;return b("regeneratorRuntime").awrap(a.mediaChannelManager.replaceTrack(g,f));case 5:h=x(a,d.payload.trackIdToReplace,!1);h=x(babelHelpers["extends"]({},a,h),d.payload.replacementTrack.trackId,d.payload.replacementTrack.enabled);c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"replace local track with id "+g+" by track "+f.trackId});return i.abrupt("return",h);case 9:case"end":return i.stop()}},null,this)},s=function(a,b){c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"Successfully replaced local track"});return b.data},t=function(a,b){return b.type!=="setLocalMediaStateVersion"?{}:{localMediaStateVersion:b.payload.version}},u=function(a,b){if(b.type!=="stopLocalTrack")return;b=b.payload.trackId;a.mediaChannelManager.stopLocalTrack(b)},v=function(a,b){if(b.type==="unmuteLocalTrack"){a=x(a,b.payload.trackId,!0);c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"unmute local track"});return a}return{}};function a(a,b){if(b.type!=="applyMediaUpdate")return;w(a.mediaChannelManager,b.payload.mediaStates)}function w(a,b){b&&(b.tracks.forEach(function(b){var c=b.enabled,d=b.trackID;if(d==="data"||d==="stream_label")return;a.updateTrackInfo(b);c?a.unmuteTrack(d):a.muteTrack(d)}),a.removeMissingTracks(b.tracks))}function x(a,b,c){y(a,b,c);return z(a)}function y(a,b,c){a=a.mediaChannelManager;c?a.unmuteTrack(b):a.muteTrack(b)}function z(a){var b=a.mediaChannelManager,c=[];b=b.getLocalTracksForMWS();b.forEach(function(a){a={enabled:a.enabled,trackID:a.trackId,type:a.contentType};c.push(a)});b=a.localMediaStateVersion+1;var d={tracks:c,version:b};a.onLocalMediaStateUpdate(d);return{localMediaStateVersion:b}}g.applyRemoteIceCandidate=e;g.onAddLocalTracksError=f;g.onAddedLocalTracks=h;g.onAddingLocalTracks=i;g.onForceEncodingEnabled=j;g.onIceCandidateReady=k;g.onLocalMediaStateUpdateRetry=l;g.onMuteLocalTrack=m;g.onRemoveLocalTrackError=n;g.onRemovedLocalTrack=o;g.onRemovingLocalTrack=p;g.onReplaceLocalTrackError=q;g.onReplacingLocalTrack=r;g.onReplacedLocalTrack=s;g.onSetLocalMediaStateVersion=t;g.onStopLocalTrack=u;g.onUnmuteLocalTrack=v;g.onApplyMediaUpdate=a;g.applyMediaStates=w}),98);
__d("ZenonPeerConnectionSMGuards",["ZenonDebugLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){a=b.type==="applyRemoteSdp"&&b.payload.sdp.type==="offer";c("ZenonDebugLogger").getInstance().logGuardsResults("applyRemoteOfferSdpGuard",a);return a}function b(a,b){a=b.type==="applyRemoteSdp"&&b.payload.sdp.type==="answer";c("ZenonDebugLogger").getInstance().logGuardsResults("applyRemoteAnswerSdpGuard",a);return a}function d(a,b){a=b.type==="iceConnectionStateChange"&&(b.payload.iceConnectionState==="connected"||b.payload.iceConnectionState==="completed");c("ZenonDebugLogger").getInstance().logGuardsResults("iceConnectedEventGuard",a);return a}function e(a){a=a.iceConnectionState==="connected"||a.iceConnectionState==="completed";c("ZenonDebugLogger").getInstance().logGuardsResults("iceConnectedGuard",a);return a}function f(a,b){a=b.type==="iceConnectionStateChange"&&b.payload.iceConnectionState==="disconnected";c("ZenonDebugLogger").getInstance().logGuardsResults("iceDisconnectedEventGuard",a);return a}function h(a){a=a.iceConnectionState!=="connected"&&a.iceConnectionState!=="completed";c("ZenonDebugLogger").getInstance().logGuardsResults("iceNotConnectedGuard",a);return a}function i(a){a=(a=a.outstandingLocalOffer)!=null?a:!1;c("ZenonDebugLogger").getInstance().logGuardsResults("outstandingLocalOfferGuard",a);return a}g.applyRemoteOfferSdpGuard=a;g.applyRemoteAnswerSdpGuard=b;g.iceConnectedEventGuard=d;g.iceConnectedGuard=e;g.iceDisconnectedEventGuard=f;g.iceNotConnectedGuard=h;g.outstandingLocalOfferGuard=i}),98);
/**
 * Copyright @ 2015 Atlassian Pty Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Modified by Facebook.
 *
 * @emails oncall+rp_rooms_infra_www
 * @nolint
 * @preserve-header
 * @preserve-whitespace
 * @format
 */__d("ZenonSDPInteropTransform",["killswitch","sdp-transform"],(function $module_ZenonSDPInteropTransform(global,require,importDefault,importNamespace,requireLazy,module,exports){

"use strict";





exports.write=function(session,opts,options){
if(
typeof session!=="undefined"&&
typeof session.media!=="undefined"&&
Array.isArray(session.media))
{
session.media.forEach(function(mLine){







var groupedSsrcs=[];
var ungroupedSsrcs=Object.keys(mLine.sources||{});


if(
typeof mLine.ssrcGroups!=="undefined"&&
Array.isArray(mLine.ssrcGroups))
{
mLine.ssrcGroups.forEach(function(ssrcGroup){
if(
typeof ssrcGroup.ssrcs!=="undefined"&&
Array.isArray(ssrcGroup.ssrcs))
{
groupedSsrcs=groupedSsrcs.concat(ssrcGroup.ssrcs);
ungroupedSsrcs=ungroupedSsrcs.filter(
function(ssrc){return ssrcGroup.ssrcs.indexOf(ssrc)===-1;});

ssrcGroup.ssrcs=ssrcGroup.ssrcs.join(" ");
}
});
}


if(
typeof mLine.sources!=="undefined"&&
Object.keys(mLine.sources).length!==0)
{
var alreadyAddedSsrcs=new Set();
mLine.ssrcs=[];
groupedSsrcs.concat(ungroupedSsrcs).forEach(function(ssrc){
var source=mLine.sources[ssrc];
Object.keys(source).forEach(function(attribute){
if(!importDefault("killswitch")("RTC_DEDUPLICATE_SSRCS")){
var newSsrcKey=[
String(ssrc),
String(attribute),
String(source[attribute])].
join("|");
if(!alreadyAddedSsrcs.has(newSsrcKey)){
mLine.ssrcs.push({
attribute:attribute,
id:ssrc,
value:source[attribute]});

alreadyAddedSsrcs.add(newSsrcKey);
}
}else{
mLine.ssrcs.push({
attribute:attribute,
id:ssrc,
value:source[attribute]});

}
});
});
if(options&&options.iceOptions){
mLine.iceOptions=options.iceOptions;
}
delete mLine.sources;
}
});
}


if(
typeof session!=="undefined"&&
typeof session.groups!=="undefined"&&
Array.isArray(session.groups))
{
session.groups.forEach(function(g){
if(typeof g.mids!=="undefined"&&Array.isArray(g.mids)){
g.mids=g.mids.join(" ");
}
});
}

return require("sdp-transform").write(session,opts);
};

exports.parse=function(sdp){
var session=require("sdp-transform").parse(sdp);

if(
typeof session!=="undefined"&&
typeof session.media!=="undefined"&&
Array.isArray(session.media))
{
session.media.forEach(function(mLine){

if(typeof mLine.ssrcs!=="undefined"&&Array.isArray(mLine.ssrcs)){
mLine.sources={};
mLine.ssrcs.forEach(function(ssrc){
if(!mLine.sources[ssrc.id])mLine.sources[ssrc.id]={};
mLine.sources[ssrc.id][ssrc.attribute]=ssrc.value;
});

delete mLine.ssrcs;
}


if(
typeof mLine.ssrcGroups!=="undefined"&&
Array.isArray(mLine.ssrcGroups))
{
mLine.ssrcGroups.forEach(function(ssrcGroup){
if(typeof ssrcGroup.ssrcs==="string"){
ssrcGroup.ssrcs=ssrcGroup.ssrcs.split(" ");
}
});
}
});
}

if(
typeof session!=="undefined"&&
typeof session.groups!=="undefined"&&
Array.isArray(session.groups))
{
session.groups.forEach(function(g){
if(typeof g.mids==="string"){
g.mids=g.mids.split(" ");
}
});
}

return session;
};}),34);
__d("ZenonSDP",["ZenonSDPInteropTransform","ZenonSdpFormat","gkx","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){this.$1={};var e=a.sdp;e!=null&&(this.$1=d("ZenonSDPInteropTransform").parse(e));this.$3=a.type;this.$2=b;this.$3==="answer"&&b===c("ZenonSdpFormat").PLAN_B&&(this.$4("audio","sendrecv"),c("gkx")("2310")?this.$5():this.$4("video","sendrecv"))}var b=a.prototype;b.$6=function(a,b,c){a=a.split(";");var d=a.findIndex(function(a){return a.startsWith(b+"=")});c=b+"="+c;d>=0?a[d]=c:a.push(c);return""+a.join(";")};b.getMedia=function(){var a=this.$1.media;return a};b.getGroups=function(){var a;return(a=this.$1.groups)!=null?a:null};b.getMediaCname=function(){var a="",b=this.$1.media;b!=null&&b.some(function(b){return b.sources==null?!1:Object.keys(b.sources).some(function(d){if(d!=null&&typeof d==="string"){d=c("nullthrows")(b.sources)[d];if(d!=null&&d.cname!=null){a=d.cname;return!0}}return!1})});return a};b.addFmtpConfig=function(a,b,c){var d=this,e=this.$1.media;e!=null&&e.forEach(function(e){e.rtp.filter(function(b){return b.codec===a}).forEach(function(a){var f=e.fmtp.find(function(b){return b.payload===a.payload});f==null?e.fmtp.push({config:b+"="+c,payload:a.payload}):f.config=d.$6(f.config,b,c)})})};b.maybeAddPtimeForOpusOnly=function(a){var b=this.$1.media;if(b==null)return;b.forEach(function(b){if(b.type!=="audio")return;var c=b.rtp.filter(function(a){return a.codec!=="opus"}).length>=1;if(c)return;c=b.rtp.find(function(a){return a.codec==="opus"});if(c==null)return;if(b.ptime!=null)return;b.ptime=a})};b.addAudioNACK=function(){var a=this.$1.media;a!=null&&a.forEach(function(a){if(a.type!=="audio")return;a.rtcpFb==null&&(a.rtcpFb=[]);a.rtp.forEach(function(b){var c;if(!((c=a.rtcpFb)==null?void 0:c.some(function(a){return a.payload===b.payload&&a.type==="nack"}))){(c=a.rtcpFb)==null?void 0:c.push({payload:b.payload,type:"nack"})}})})};b.replaceAudioCname=function(a){var b=this.$1.media;b!=null&&b.forEach(function(b){b.type==="audio"&&b.sources!=null&&Object.keys(b.sources).forEach(function(d){if(d!=null&&typeof d==="string"){d=c("nullthrows")(b.sources)[d];d!=null&&d.cname!=null&&(d.cname=a+d.cname)}})})};b.filterExtension=function(a){var b=this.$1.media;b!=null&&b.forEach(function(b){b.type==="video"&&b.ext!=null&&(b.ext=b.ext.filter(function(b){return!b.uri.includes(a)}))})};b.enableGFD=function(){var a="http://www.webrtc.org/experiments/rtp-hdrext/generic-frame-descriptor-00",b=this.$1.media;if(b==null)return;b.forEach(function(b){var c;b.ext==null&&(b.ext=[]);c=(c=(c=b.ext)==null?void 0:c.some(function(b){return b.uri===a}))!=null?c:!1;if(c)return;c=(c=(c=b.ext)==null?void 0:c.reduce(function(a,b){return Math.max(a,b.value)},0))!=null?c:0;(b=b.ext)==null?void 0:b.push({uri:a,value:c+1})})};b.useDTLSOverCrypto=function(){var a=this.$1.media;a!=null&&a.forEach(function(a){a.fingerprint!=null&&delete a.crypto})};b.removeCodec=function(a){var b=this.$1.media;b!=null&&b.forEach(function(b){var c=b.rtp.filter(function(b){return b.codec===a}).map(function(a){a=a.payload;return a}),d=b.fmtp.filter(function(a){a=a.config.match(/apt=(\d*)/);return a!=null?c.includes(Number(a[1])):!1}).map(function(a){a=a.payload;return a}),e=c.concat(d);if(e.length<1)return;b.rtp=b.rtp.filter(function(a){return!e.includes(a.payload)});b.fmtp=b.fmtp.filter(function(a){return!e.includes(a.payload)});b.rtcpFb!=null&&(b.rtcpFb=b.rtcpFb.filter(function(a){return!e.includes(a.payload)}));b.rtcpFbTrrInt!=null&&(b.rtcpFbTrrInt=b.rtcpFbTrrInt.filter(function(a){return!e.includes(a.payload)}));d=new RegExp("("+e.join("|")+") ?","g");b.payloads=b.payloads.replace(d,"").trim()})};b.preferCodec=function(a,b){var c=b.preferredCodec,d=b.preferredCodecRate;b=this.$1.media;b!=null&&b.forEach(function(b){if(b.type===a){var e=b.rtp.find(function(a){return a.codec===c&&a.rate===d});e!=null&&(b.payloads=b.payloads.replace(e.payload+" ",""),b.payloads=e.payload+" "+b.payloads)}})};b.mungeInactiveMediaSSRC=function(a){var b=new Map();a!=null&&a.$1.media!=null&&a.$1.media.forEach(function(a){a.sources!=null&&a.mid!=null&&b.set(a.mid,a.sources)});a=this.$1.media;a==null?void 0:a.forEach(function(a){if(a.mid!=null&&a.direction==="inactive"&&a.sources==null){var c=b.get(a.mid);c!=null&&(a.sources=c)}})};b.preferH264Codec=function(a){var b=this.$1.media;b!=null&&b.forEach(function(b){if(b.type==="video"){var c=[];b.rtp.forEach(function(a){a.codec==="H264"&&c.push(a.payload)});var d=a.levelAsymmetryAllowed?"1":"0",e=a.packetizationMode?"1":"0",f=new RegExp("level-asymmetry-allowed="+d+";packetization-mode="+e+";profile-level-id="+a.profileLevelId);d=b.fmtp.find(function(a){return a.config.match(f)&&c.includes(a.payload)});d!=null&&(b.payloads=b.payloads.replace(d.payload+" ",""),b.payloads=d.payload+" "+b.payloads)}})};b.$4=function(a,b){var c=this.$1.media;c!=null&&c.forEach(function(c){c.type===a&&(c.direction=b)})};b.$5=function(){var a=this.$1.media;a!=null&&a.forEach(function(a){a.type==="video"&&(a.direction==="inactive"||a.direction==="sendonly")?a.direction="sendonly":a.direction="sendrecv"})};b.stripDataChannel=function(){var a=this.$1,b=a.groups;a=a.media;var c=null;a!=null&&a.forEach(function(a){a.type==="application"&&(a.port=0,a.protocol="UDP/DTLS/SCTP",c=typeof a.mid==="number"?a.mid.toString():a.mid)});b!=null&&c!==null&&b.forEach(function(a){var b=typeof a.mids==="string"?a.mids.split(" "):a.mids;a.mids=b.filter(function(a){return a!==c})})};b.convertMediaSetupActpass=function(){var a=this.$1.media;if(a==null)return;a.forEach(function(a){if(a.type==="application")return;a.setup="actpass"})};b.copyWithTypeAndActpass=function(a){a=this.copyWithType(a);a.convertMediaSetupActpass();return a};b.copyWithType=function(b){return new a({sdp:this.toDesc().sdp,type:b},this.$2)};b.setVersion=function(a){this.$1.origin.sessionVersion=a};b.getSdpFormat=function(){return this.$2};b.getType=function(){return this.$3};b.toDesc=function(){return{sdp:d("ZenonSDPInteropTransform").write(this.$1,{},{iceOptions:"trickle fb-force-5245"}),type:this.$3}};b.toLoggingString=function(){var a="\n",b=[" IP4 "," IP6 "],c=this.toDesc().sdp.split(a);c.forEach(function(a,d){a.startsWith("a=crypto:")?c[d]="a=crypto:**-----**":a.startsWith("a=candidate:")?c[d]="a=candidate:**-----**":b.forEach(function(b){var e=a.indexOf(b);e!==-1&&(c[d]=a.slice(0,e+b.length)+"**-----**")})});return c.join(a)};return a}();g["default"]=a}),98);
__d("ZenonPeerConnectionSdpActions",["Promise","UserAgent","ZenonInfraActionsLogger","ZenonPeerConnectionMediaActions","ZenonSDP","ZenonSdpFormat","regeneratorRuntime","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,d){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:if(!(d.type!=="remoteSdpFailed")){i.next=2;break}return i.abrupt("return");case 2:c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"trying to rollback to last successful sdp pair",sdpFormat:a.sdpManager.getSdpFormat()});if(!(((e=a.sdpManager.getLocalSdp())==null?void 0:e.getSdpFormat())===c("ZenonSdpFormat").UNIFIED_PLAN&&!c("UserAgent").isBrowser("Safari"))){i.next=8;break}i.next=6;return b("regeneratorRuntime").awrap(a.sdpManager.rollbackSdp());case 6:i.next=15;break;case 8:if(!(a.lastSuccessfulSdpPair==null)){i.next=10;break}throw c("unrecoverableViolation")("No last successfully negotiated SDP pair, should never happen here","rtc_www");case 10:f=a.lastSuccessfulSdpPair,g=f.localSdp,h=f.remoteSdp;i.next=13;return b("regeneratorRuntime").awrap(a.sdpManager.setLocalSdp(g));case 13:i.next=15;return b("regeneratorRuntime").awrap(a.sdpManager.setRemoteSdp(h,a.logEvent));case 15:c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"successful rollback to last successful sdp pair",sdpFormat:a.sdpManager.getSdpFormat()});case 16:case"end":return i.stop()}},null,this)};e=function(a,d){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:if(!(d.type==="applyLocalSdp"||d.type==="localMediaStateUpdateRetry")){g.next=7;break}e=a.localMediaStateVersion+1;g.next=4;return b("regeneratorRuntime").awrap(a.sdpManager.createAndSetLocalSdp(e,"offer"));case 4:c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"apply local SDP",sdpFormat:a.sdpManager.getSdpFormat()});f=d.type==="localMediaStateUpdateRetry"?null:a.localMediaStateUpdateRetryTimerId;return g.abrupt("return",{localMediaStateUpdateRetryTimerId:f,localMediaStateVersion:e,outstandingLocalOffer:!0});case 7:return g.abrupt("return",b("Promise").resolve({}));case 8:case"end":return g.stop()}},null,this)};f=function(a,e){var f,g,h,i,j,k,l,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:if(!(e.type==="applyRemoteSdp")){o.next=21;break}f=a.mediaChannelManager,g=a.sdpManager;h=e.payload.sdp,i=h.sdp,j=h.type;if(!(j==="answer")){o.next=9;break}a.logEvent({name:"setRemoteSdpAnswer"});o.next=7;return b("regeneratorRuntime").awrap(g.setRemoteSdp(new(c("ZenonSDP"))({sdp:i,type:j},f.getSdpFormat()),a.logEvent));case 7:a.logEvent({name:"endSetRemoteDescription"}),c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"apply remote answer",sdpFormat:a.sdpManager.getSdpFormat()});case 9:d("ZenonPeerConnectionMediaActions").applyMediaStates(f,e.payload.mediaStates);k=e.payload.renegotiationOffer;if(!(k!=null)){o.next=19;break}l=k.sdp,m=k.type;o.next=15;return b("regeneratorRuntime").awrap(g.setRemoteSdp(new(c("ZenonSDP"))({sdp:l,type:m},f.getSdpFormat()),a.logEvent));case 15:n=a.localMediaStateVersion+1;o.next=18;return b("regeneratorRuntime").awrap(a.sdpManager.createAndSetLocalSdp(n,"answer"));case 18:c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"Apply renegotiation offer and set local answer",sdpFormat:a.sdpManager.getSdpFormat()});case 19:e.payload.source==="joinResponse"?a.logEvent({name:"inviteResponseProcessed"}):e.payload.source==="serverMediaUpdateRequest"&&e.payload.sdp.type==="answer"&&a.logEvent({name:"smuWithAnswerProcessed"}),e.payload.onProcessed&&e.payload.onProcessed();case 21:case"end":return o.stop()}},null,this)};var h=function(a,e){var f,g,h,i,j,k,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:f=a.mediaChannelManager,g=a.sdpManager;if(!(e.type==="applyRemoteSdp")){n.next=16;break}h=e.payload.sdp,i=h.sdp,j=h.type;if(!(j==="offer")){n.next=16;break}a.logEvent({name:"setRemoteSdpOffer"});n.next=7;return b("regeneratorRuntime").awrap(g.setRemoteSdp(new(c("ZenonSDP"))({sdp:i,type:j},f.getSdpFormat()),a.logEvent));case 7:k=n.sent;d("ZenonPeerConnectionMediaActions").applyMediaStates(f,e.payload.mediaStates);e.payload.onProcessed&&e.payload.onProcessed();l=a.localMediaStateVersion+1;n.next=13;return b("regeneratorRuntime").awrap(a.sdpManager.createAndSetLocalSdp(l,"answer"));case 13:m=n.sent;c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"apply remote offer and set local answer",sdpFormat:a.sdpManager.getSdpFormat()});return n.abrupt("return",{lastSuccessfulSdpPair:{localSdp:m.copyWithTypeAndActpass("offer"),remoteSdp:k.copyWithType("answer")},localMediaStateVersion:l});case 16:return n.abrupt("return",{});case 17:case"end":return n.stop()}},null,this)},i=function(a,b){c("ZenonInfraActionsLogger").logError({checkpoint:"Failed to apply remote offer and set local answer: "+b.data.toString(),errorDomain:"ZenonPeerConnectionSdpActions_onApplyRemoteOfferAndSetLocalAnswer",sdpFormat:a.sdpManager.getSdpFormat()})},j=function(a){var b=a.sdpManager.getLocalSdp();if(b==null)throw c("unrecoverableViolation")("Local sdp should never be null after setting remote answer","rtc_www");a=a.sdpManager.getRemoteSdp();if(a==null)throw c("unrecoverableViolation")("Remote sdp should never be null after setting remote answer","rtc_www");return{lastSuccessfulSdpPair:{localSdp:b,remoteSdp:a},outstandingLocalOffer:!1}},k=function(a){a.logEvent({name:"negotiationComplete"})},l=function(a,b){var c=a.sdpManager.getLocalSdp();b=b.data;if(c!==null&&b.localMediaStateVersion!=null){var d=c.toDesc(),e=d.sdp;d=d.type;a.onLocalSdpSet({sdp:e,type:d,version:b.localMediaStateVersion},a.mediaChannelManager.getLocalTracksForMWS())}c!==null&&a.mediaChannelManager.onLocalSdpSet(c);return b};g.applyingLastSuccessfulSdpPair=a;g.applyLocalSdp=e;g.applyRemoteAnswer=f;g.applyRemoteOfferAndSetLocalAnswer=h;g.onApplyRemoteOfferSetLocalAnswerError=i;g.updateSdpPair=j;g.logNegotiationCompleted=k;g.onLocalSdpSet=l}),98);
__d("ZenonPeerConnectionTerminatedState",[],(function(a,b,c,d,e,f){"use strict";a=function(a){a.sdpManager.restartPeerConnection()};f.restart=a}),66);
__d("ZenonPeerConnectionTerminatingState",["FBLogger","Promise","ZenonInfraActionsLogger","ZenonMediaError"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,e){var f;a.mediaChannelManager.stopStatsPolling();(e.type!=="endCall"||e.payload.stopLocalTracks)&&(c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"stopping local tracks"}),a.mediaChannelManager.stopLocalTracks());switch(e.type){case"endCall":if(((f=e.payload)==null?void 0:f.restart)!==!0){a.onConnectionDestroyed((f=e.payload.error)!=null?f:null)}break;case"applyLocalSdp":case"error.platform.applyLocalSdpInvoke":a.onConnectionDestroyed(d("ZenonMediaError").ZenonMediaError.SetLocalSdpFailed);break;case"applyRemoteSdp":case"error.platform.applyRemoteSdpInvoke":case"error.platform.renegotiatingInvoke":a.onConnectionDestroyed(d("ZenonMediaError").ZenonMediaError.SetRemoteSdpFailed);break;case"error.platform.rollingSdpBackInvoke":a.onConnectionDestroyed(d("ZenonMediaError").ZenonMediaError.RollbackSdpFailed);break;default:c("FBLogger")("rtc_www").warn("Event "+e.type+" logged as unknown error. Please add a more specific error for this event type.");a.onConnectionDestroyed(d("ZenonMediaError").ZenonMediaError.UnknownError);break}a.sdpManager.closePeerConnection();return b("Promise").resolve(c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"cleaning up peer connection"}))};e=function(a,b){};g.cleanUp=a;g.done=e}),98);
__d("ZenonPeerConnectionStateMachine",["ZenonDebugLogger","ZenonDeferrableStateMachine","ZenonInfraActionsLogger","ZenonPeerConnectionDataActions","ZenonPeerConnectionIceActions","ZenonPeerConnectionMediaActions","ZenonPeerConnectionSMGuards","ZenonPeerConnectionSdpActions","ZenonPeerConnectionTerminatedState","ZenonPeerConnectionTerminatingState","gkx","qpl","xstate"],(function(a,b,c,d,e,f,g){"use strict";var h="PeerConnectionStateMachine";a=function(){function a(a,b){var e=this;b===void 0&&(b="init");a=babelHelpers["extends"]({},l,{context:babelHelpers["extends"]({},a,{iceConnectionState:"new",iceConnectionTimeoutID:null,lastSuccessfulSdpPair:null,localMediaStateUpdateRetryTimerId:null,localMediaStateVersion:1,outstandingLocalOffer:!1,retryCount:0}),initial:b});this.$1=d("ZenonDeferrableStateMachine").interpret(d("xstate").Machine(a,{guards:d("ZenonPeerConnectionSMGuards")}),{onDeferTimeout:function(a){c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[Peer Connection] "+a.type+" was deferred for too long"})}});this.$2=Date.now();c("ZenonDebugLogger").getInstance().startQPL(c("qpl")._(64239068,"6172"),this.$2);this.$1.onTransition(function(a){var b;c("ZenonInfraActionsLogger").updateCachedValues({peerConnectionState:a.value});c("ZenonDebugLogger").getInstance().logStateMachineTransition(h,a.changed,a.value,(b=a.history)==null?void 0:b.value,a.event.type,a.actions,e.$2.toString());a.value==="terminated"&&c("ZenonDebugLogger").getInstance().endQPL(c("qpl")._(64239068,"6172"),e.$2)})}var b=a.prototype;b.processEvent=function(a){c("ZenonDebugLogger").getInstance().logStateMachine(h,this.getState(),a.type,this.$2.toString()),this.$1.send(a)};b.getState=function(){var a=this.$1.state.toStrings();return a.length>0?this.$1.state.toStrings()[0]:"init"};b.getContext=function(){return this.$1.state.context};b.getLocalMediaStateVersion=function(){return this.$1.state.context.localMediaStateVersion};return a}();b={actions:[d("ZenonPeerConnectionMediaActions").onApplyMediaUpdate]};e={actions:[d("xstate").assign(c("ZenonPeerConnectionIceActions").onIceConnectionStateChanged)]};f={actions:[d("ZenonPeerConnectionDataActions").onDataChannelMessageReceived]};var i={actions:[d("ZenonPeerConnectionMediaActions").onForceEncodingEnabled]},j={actions:[d("ZenonPeerConnectionMediaActions").onIceCandidateReady]},k={actions:["defer"]},l={initial:"init",states:{init:{on:{addLocalTracks:{target:"addingLocalTracks"},applyLocalSdp:{target:"applyingLocalSdp"},applyMediaUpdate:b,applyRemoteIceCandidate:k,applyRemoteSdp:{cond:d("ZenonPeerConnectionSMGuards").applyRemoteOfferSdpGuard,target:"renegotiating"},createDataChannel:{actions:[d("ZenonPeerConnectionDataActions").onCreateDataChannel]},createDataMessageSubscription:{actions:[d("ZenonPeerConnectionDataActions").onCreateDataMessageSubscription]},dataChannelMessageReceived:f,forceEncodingEnabled:k,iceCandidateReady:k,iceConnectionStateChange:e,localMediaStateUpdateRetry:{actions:[d("xstate").assign(d("ZenonPeerConnectionMediaActions").onLocalMediaStateUpdateRetry)]},muteLocalTrack:{actions:[d("xstate").assign(d("ZenonPeerConnectionMediaActions").onMuteLocalTrack)]},removeDataMessageSubscription:{actions:[d("ZenonPeerConnectionDataActions").onRemoveDataMessageSubscription]},removeLocalTrack:{target:"removingLocalTrack"},replaceLocalTrack:{target:"replacingLocalTrack"},setLocalMediaStateVersion:{actions:[d("xstate").assign(d("ZenonPeerConnectionMediaActions").onSetLocalMediaStateVersion)]},stopLocalTrack:{actions:[d("ZenonPeerConnectionMediaActions").onStopLocalTrack]},unmuteLocalTrack:{actions:[d("xstate").assign(d("ZenonPeerConnectionMediaActions").onUnmuteLocalTrack)]}}},applyingLocalSdp:{invoke:{id:"applyLocalSdpInvoke",onDone:{actions:[d("xstate").assign(d("ZenonPeerConnectionSdpActions").onLocalSdpSet)],target:"hasLocalSdp"},onError:{target:"terminating"},src:d("ZenonPeerConnectionSdpActions").applyLocalSdp},on:{addLocalTracks:k,applyMediaUpdate:b,applyLocalSdp:k,applyRemoteIceCandidate:k,applyRemoteSdp:k,createDataChannel:k,createDataMessageSubscription:k,dataChannelMessageReceived:f,endCall:{target:"terminating"},forceEncodingEnabled:k,iceCandidateReady:k,iceConnectionStateChange:e,localMediaStateUpdateRetry:k,muteLocalTrack:k,removeDataMessageSubscription:k,removeLocalTrack:k,replaceLocalTrack:k,stopLocalTrack:k,unmuteLocalTrack:k}},rollingSdpBack:{invoke:{id:"rollingSdpBackInvoke",onDone:{target:"connected"},onError:{target:"terminating"},src:d("ZenonPeerConnectionSdpActions").applyingLastSuccessfulSdpPair},on:{addLocalTracks:k,applyMediaUpdate:b,applyLocalSdp:k,applyRemoteIceCandidate:k,applyRemoteSdp:k,createDataChannel:k,createDataMessageSubscription:k,dataChannelMessageReceived:f,endCall:{target:"terminating"},forceEncodingEnabled:k,iceCandidateReady:j,iceConnectionStateChange:e,localMediaStateUpdateRetry:k,muteLocalTrack:k,remoteSdpFailed:k,removeDataMessageSubscription:k,removeLocalTrack:k,replaceLocalTrack:k,stopLocalTrack:k,unmuteLocalTrack:k}},hasLocalSdp:{entry:[function(a){return a.mediaChannelManager.setSimulcastSingleLayerParams()}],on:{addLocalTracks:k,applyMediaUpdate:b,applyRemoteIceCandidate:k,applyRemoteSdp:[{cond:d("ZenonPeerConnectionSMGuards").applyRemoteAnswerSdpGuard,target:"applyingRemoteSdp"},{cond:d("ZenonPeerConnectionSMGuards").applyRemoteOfferSdpGuard,target:"renegotiating"}],remoteSdpFailed:{target:"rollingSdpBack"},createDataChannel:k,createDataMessageSubscription:k,removeDataMessageSubscription:k,dataChannelMessageReceived:f,endCall:{target:"terminating"},forceEncodingEnabled:k,iceCandidateReady:j,iceConnectionStateChange:e,localMediaStateUpdateRetry:k,muteLocalTrack:k,removeLocalTrack:k,replaceLocalTrack:k,stopLocalTrack:k,unmuteLocalTrack:k}},applyingRemoteSdp:{invoke:[{id:"applyRemoteSdpInvoke",onDone:[{actions:[d("xstate").assign(d("ZenonPeerConnectionSdpActions").updateSdpPair)],cond:d("ZenonPeerConnectionSMGuards").iceNotConnectedGuard,target:"negotiated"},{actions:[d("xstate").assign(d("ZenonPeerConnectionSdpActions").updateSdpPair),c("ZenonPeerConnectionIceActions").onIceConnected],cond:d("ZenonPeerConnectionSMGuards").iceConnectedGuard,target:"connected"}],onError:{target:"terminating"},src:d("ZenonPeerConnectionSdpActions").applyRemoteAnswer}],on:{addLocalTracks:k,applyMediaUpdate:c("gkx")("4318")?k:b,applyLocalSdp:k,applyRemoteIceCandidate:k,applyRemoteSdp:k,createDataChannel:k,createDataMessageSubscription:k,dataChannelMessageReceived:c("gkx")("4318")?k:f,endCall:{target:"terminating"},forceEncodingEnabled:k,iceCandidateReady:j,iceConnectionStateChange:e,localMediaStateUpdateRetry:k,muteLocalTrack:k,removeDataMessageSubscription:k,removeLocalTrack:k,replaceLocalTrack:k,stopLocalTrack:k,unmuteLocalTrack:k}},negotiated:{entry:[d("ZenonPeerConnectionSdpActions").logNegotiationCompleted],on:{addLocalTracks:k,applyMediaUpdate:b,applyLocalSdp:k,applyRemoteIceCandidate:{actions:[d("ZenonPeerConnectionMediaActions").applyRemoteIceCandidate]},applyRemoteSdp:k,createDataChannel:k,createDataMessageSubscription:k,dataChannelMessageReceived:f,endCall:{target:"terminating"},forceEncodingEnabled:i,iceCandidateReady:j,iceConnectionStateChange:[{actions:[d("xstate").assign(c("ZenonPeerConnectionIceActions").onIceConnectionStateChanged)],cond:d("ZenonPeerConnectionSMGuards").iceConnectedEventGuard,target:"connected"},{actions:[d("xstate").assign(c("ZenonPeerConnectionIceActions").onIceConnectionStateChanged)]}],localMediaStateUpdateRetry:k,muteLocalTrack:k,removeDataMessageSubscription:k,removeLocalTrack:k,replaceLocalTrack:k,stopLocalTrack:k,unmuteLocalTrack:k}},connected:{on:{addLocalTracks:{target:"addingLocalTracks"},applyLocalSdp:{target:"applyingLocalSdp"},applyMediaUpdate:b,applyRemoteIceCandidate:{actions:[d("ZenonPeerConnectionMediaActions").applyRemoteIceCandidate]},applyRemoteSdp:{cond:d("ZenonPeerConnectionSMGuards").applyRemoteOfferSdpGuard,target:"renegotiating"},createDataChannel:{actions:[d("ZenonPeerConnectionDataActions").onCreateDataChannel]},createDataMessageSubscription:{actions:[d("ZenonPeerConnectionDataActions").onCreateDataMessageSubscription]},dataChannelMessageReceived:f,endCall:{target:"terminating"},forceEncodingEnabled:i,iceCandidateReady:j,iceConnectionStateChange:[{actions:[d("xstate").assign(c("ZenonPeerConnectionIceActions").onIceConnectionStateChanged)],cond:d("ZenonPeerConnectionSMGuards").iceDisconnectedEventGuard,target:"negotiated"},{actions:[d("xstate").assign(c("ZenonPeerConnectionIceActions").onIceConnectionStateChanged)]}],localMediaStateUpdateRetry:[{cond:d("ZenonPeerConnectionSMGuards").outstandingLocalOfferGuard,target:"applyingLocalSdp"},{actions:[d("xstate").assign(d("ZenonPeerConnectionMediaActions").onLocalMediaStateUpdateRetry)]}],muteLocalTrack:{actions:[d("xstate").assign(d("ZenonPeerConnectionMediaActions").onMuteLocalTrack)]},removeDataMessageSubscription:{actions:[d("ZenonPeerConnectionDataActions").onRemoveDataMessageSubscription]},removeLocalTrack:{target:"removingLocalTrack"},replaceLocalTrack:{target:"replacingLocalTrack"},stopLocalTrack:{actions:[d("ZenonPeerConnectionMediaActions").onStopLocalTrack]},unmuteLocalTrack:{actions:[d("xstate").assign(d("ZenonPeerConnectionMediaActions").onUnmuteLocalTrack)]}}},addingLocalTracks:{invoke:{id:"addLocalTracksInvoke",onDone:{actions:[d("xstate").assign(d("ZenonPeerConnectionMediaActions").onAddedLocalTracks)],target:"connected"},onError:{actions:[d("ZenonPeerConnectionMediaActions").onAddLocalTracksError],target:"connected"},src:d("ZenonPeerConnectionMediaActions").onAddingLocalTracks},on:{addLocalTracks:k,applyLocalSdp:k,applyMediaUpdate:b,applyRemoteIceCandidate:k,applyRemoteSdp:k,createDataChannel:k,createDataMessageSubscription:k,dataChannelMessageReceived:f,endCall:{target:"terminating"},forceEncodingEnabled:k,iceCandidateReady:k,iceConnectionStateChange:e,localMediaStateUpdateRetry:k,muteLocalTrack:k,removeDataMessageSubscription:k,removeLocalTrack:k,replaceLocalTrack:k,stopLocalTrack:k,unmuteLocalTrack:k}},removingLocalTrack:{invoke:{id:"removeLocalTrackInvoke",onDone:{actions:[d("xstate").assign(d("ZenonPeerConnectionMediaActions").onRemovedLocalTrack)],target:"connected"},onError:{actions:[d("ZenonPeerConnectionMediaActions").onRemoveLocalTrackError],target:"connected"},src:d("ZenonPeerConnectionMediaActions").onRemovingLocalTrack},on:{addLocalTracks:k,applyLocalSdp:k,applyMediaUpdate:k,applyRemoteIceCandidate:k,applyRemoteSdp:k,createDataChannel:k,createDataMessageSubscription:k,dataChannelMessageReceived:f,endCall:{target:"terminating"},forceEncodingEnabled:k,iceCandidateReady:k,iceConnectionStateChange:e,localMediaStateUpdateRetry:k,muteLocalTrack:k,removeDataMessageSubscription:k,removeLocalTrack:k,replaceLocalTrack:k,stopLocalTrack:k,unmuteLocalTrack:k}},replacingLocalTrack:{invoke:{id:"replaceLocalTrackInvoke",onDone:{actions:[d("xstate").assign(d("ZenonPeerConnectionMediaActions").onReplacedLocalTrack)],target:"connected"},onError:{actions:[d("ZenonPeerConnectionMediaActions").onReplaceLocalTrackError],target:"connected"},src:d("ZenonPeerConnectionMediaActions").onReplacingLocalTrack},on:{addLocalTracks:k,applyLocalSdp:k,applyMediaUpdate:k,applyRemoteIceCandidate:k,applyRemoteSdp:k,createDataChannel:k,createDataMessageSubscription:k,dataChannelMessageReceived:f,endCall:{target:"terminating"},forceEncodingEnabled:k,iceCandidateReady:k,iceConnectionStateChange:e,localMediaStateUpdateRetry:k,muteLocalTrack:k,removeDataMessageSubscription:k,removeLocalTrack:k,replaceLocalTrack:k,stopLocalTrack:k,unmuteLocalTrack:k}},renegotiating:{invoke:{id:"renegotiatingInvoke",onDone:[{actions:[d("xstate").assign(d("ZenonPeerConnectionSdpActions").onLocalSdpSet)],cond:d("ZenonPeerConnectionSMGuards").iceNotConnectedGuard,target:"negotiated"},{actions:[d("xstate").assign(d("ZenonPeerConnectionSdpActions").onLocalSdpSet)],cond:d("ZenonPeerConnectionSMGuards").iceConnectedGuard,target:"connected"}],onError:{actions:[d("ZenonPeerConnectionSdpActions").onApplyRemoteOfferSetLocalAnswerError],target:"terminating"},src:d("ZenonPeerConnectionSdpActions").applyRemoteOfferAndSetLocalAnswer},on:{addLocalTracks:k,applyLocalSdp:k,applyMediaUpdate:k,applyRemoteIceCandidate:k,applyRemoteSdp:k,createDataChannel:k,createDataMessageSubscription:k,dataChannelMessageReceived:c("gkx")("4318")?k:f,endCall:{target:"terminating"},forceEncodingEnabled:k,iceConnectionStateChange:k,localMediaStateUpdateRetry:k,muteLocalTrack:k,removeDataMessageSubscription:k,removeLocalTrack:k,replaceLocalTrack:k,stopLocalTrack:k,unmuteLocalTrack:k}},terminating:{exit:[d("ZenonPeerConnectionTerminatingState").done],invoke:[{onDone:{target:"terminated"},src:d("ZenonPeerConnectionTerminatingState").cleanUp}],on:{addLocalTracks:k,applyLocalSdp:k,applyMediaUpdate:k,applyRemoteIceCandidate:k,applyRemoteSdp:k,createDataChannel:k,createDataMessageSubscription:k,dataChannelMessageReceived:k,forceEncodingEnabled:k,iceConnectionStateChange:k,localMediaStateUpdateRetry:k,muteLocalTrack:k,removeDataMessageSubscription:k,removeLocalTrack:k,replaceLocalTrack:k,restartPeerConnection:k,stopLocalTrack:k,unmuteLocalTrack:k}},terminated:{on:{restartPeerConnection:{actions:[d("ZenonPeerConnectionTerminatedState").restart],target:"init"},addLocalTracks:k,applyLocalSdp:k,applyMediaUpdate:k,applyRemoteIceCandidate:k,applyRemoteSdp:k,createDataChannel:k,createDataMessageSubscription:k,dataChannelMessageReceived:k,forceEncodingEnabled:k,iceConnectionStateChange:k,localMediaStateUpdateRetry:k,muteLocalTrack:k,removeDataMessageSubscription:k,removeLocalTrack:k,replaceLocalTrack:k,stopLocalTrack:k,unmuteLocalTrack:k}}}};g["default"]=a}),98);
__d("ZenonEventListenerCache",["orEmptyArray"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=new Map()}var b=a.prototype;b.add=function(a,b){var c=this.getByType(a);c.push(b);this.$1.set(a,c)};b["delete"]=function(a,b){var c=this.getByType(a);c=c.filter(function(a){return a!==b});c.length<1?this.$1["delete"](a):this.$1.set(a,c)};b.forEachEventListener=function(a){var b=this,c=this.getCachedEventTypes();c.forEach(function(c){var d=b.getByType(c);d.forEach(function(b){a(c,b)})})};b.getByType=function(a){return c("orEmptyArray")(this.$1.get(a))};b.getCachedEventTypes=function(){return Array.from(this.$1.keys())};b.getAll=function(){return this.$1};return a}();g["default"]=a}),98);
__d("ZenonSimulcastSdpUtils",["Random","UserAgent","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h="\r\n";function i(a){a=a.filter(function(a){return a.startsWith("a=ssrc:")}).map(function(a){return a.split(" ")[0].split(":")[1]});return new Set(a)}function j(a,b){var c=new RegExp("^a=ssrc:\\d+ "+b+":");b=a.filter(function(a){return c.test(a)})[0];return b.split(" ")[1].split(":")[1]}function k(a){a=a.filter(function(a){return a.startsWith("a=ssrc-group:FID")}).map(function(a){return a.split(" ")[2]});return new Set(a)}function l(a){var b=new RegExp("^a=ssrc:\\d+ msid:");a=a.filter(function(a){return b.test(a)})[0];a=a.split(" ");return a.length>2?a[2]:null}function m(a,b){var c=[];for(var e=0;e<a;e++){var f=0;while(f===0||b.has(f.toString()))f=d("Random").uint32();b.add(f.toString());c.push(f.toString())}return c}function a(a,b){if(!c("UserAgent").isBrowser("Chrome >= 88")){c("recoverableViolation")("Attempted to add plan-b simulcast in unsupported browser","rtc_www");return a}if(b<=1||b>3){c("recoverableViolation")("Unsupported number of layers passed: "+b,"rtc_www");return a}var d=a.trim().split(h),e=i(d),f=d.findIndex(function(a){return/^m=video/.test(a)});if(f===-1)return a;a=f+1;while(a<d.length){if(d[a].startsWith("m="))break;a++}a=d.splice(f,a-f);var g=i(a),n=k(a);g=new Set(Array.from(g).filter(function(a){return!n.has(a)}));if(g.size!==1||n.size>1)return[].concat(d.slice(0,f),a,d.slice(f)).join(h);var o=n.size===1;g=Array.from(g)[0];var p="";o&&(p=Array.from(n)[0]);var q=j(a,"cname"),r=j(a,"msid"),s=l(a);s!=null&&(r+=" "+s);var t=j(a,"mslabel"),u=j(a,"label");s=[g].concat(m(b-1,e));g=[];o&&(s.forEach(function(a){return e.add(a)}),g=[p].concat(m(b-1,e)));var v=[];v.push("a=ssrc-group:SIM "+s.join(" "));for(var p=0;p<g.length;p++)v.push("a=ssrc-group:FID "+s[p]+" "+g[p]);b=[];if(o)for(var p=0;p<s.length;p++)b.push(s[p]),b.push(g[p]);else b=s;b.forEach(function(a){v.push("a=ssrc:"+a+" cname:"+q),v.push("a=ssrc:"+a+" msid:"+r),v.push("a=ssrc:"+a+" mslabel:"+t),v.push("a=ssrc:"+a+" label:"+u)});a=a.filter(function(a){return!a.startsWith("a=ssrc")});a=[].concat(a,v);return[].concat(d.slice(0,f),a,d.slice(f)).join(h)+h}g.addSimulcastToChromeOffer=a}),98);
__d("ZenonRTCPeerConnectionWrapper",["FBLogger","Promise","UserAgent","ZenonBrowsers","ZenonEventListenerCache","ZenonInfraActionsLogger","ZenonRTCPeerConnectionHelper","ZenonSDP","ZenonSdpFormat","ZenonSimulcastSdpUtils","ZenonSimulcastUtils","gkx","orEmptyArray","recoverableViolation","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,e,f){b===void 0&&(b={}),e===void 0&&(e={}),f===void 0&&(f=!1),this.$5=new(c("ZenonEventListenerCache"))(),this.$8=!1,this.$9=!1,this.count=0,this.$2=a,this.$3=b,this.$4=e,this.$1=d("ZenonRTCPeerConnectionHelper").createPeerConnection(a,b,e),this.$6=new Map(),this.$7=f,f&&(this.$8=!0),this.$10=new Map(),this.$11=new Map()}var e=a.prototype;e.createOffer=function(a){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:a===void 0&&(a={});f.next=3;return b("regeneratorRuntime").awrap(this.$12(a));case 3:e=f.sent;this.$8&&(e.sdp!=null&&(e.sdp=d("ZenonSimulcastSdpUtils").addSimulcastToChromeOffer(e.sdp,d("ZenonSimulcastUtils").getNumLayers())),this.$8=!1);return f.abrupt("return",new(c("ZenonSDP"))(e,this.getSdpFormat()));case 6:case"end":return f.stop()}},null,this)};e.rollbackSdp=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.prev=0;a.next=3;return b("regeneratorRuntime").awrap(this.$1.setLocalDescription({type:"rollback"}));case 3:a.next=9;break;case 5:a.prev=5;a.t0=a["catch"](0);c("ZenonInfraActionsLogger").logError({error:a.t0.toString(),errorDomain:"ZenonRTCPeerConnectionWrapper_rollbackSDP",sdpFormat:this.getSdpFormat()});throw a.t0;case 9:case"end":return a.stop()}},null,this,[[0,5]])};e.setLocalDescription=function(a){var d=this,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:this.$13(a.getMedia(),this.$10);if(!this.$14()){g.next=14;break}g.prev=2;e=a.toDesc();g.next=6;return b("regeneratorRuntime").awrap(new(b("Promise"))(function(a,b){d.$1.setLocalDescription(e,a,b)}));case 6:g.next=12;break;case 8:g.prev=8;g.t0=g["catch"](2);c("FBLogger")("rtc_www").catching(g.t0).mustfix("Error processing legacy API setLocalDescription in ZenonRTCPeerConnectionWrapper.");throw g.t0;case 12:g.next=24;break;case 14:g.prev=14;f=a.toDesc();g.next=18;return b("regeneratorRuntime").awrap(this.$1.setLocalDescription(f));case 18:g.next=24;break;case 20:g.prev=20;g.t1=g["catch"](14);c("FBLogger")("rtc_www").catching(g.t1).mustfix("Error processing modern API setLocalDescription in ZenonRTCPeerConnectionWrapper.");throw g.t1;case 24:case"end":return g.stop()}},null,this,[[2,8],[14,20]])};e.createAnswer=function(){var a=this,d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:if(!this.$14()){f.next=7;break}e=function(){return new(b("Promise"))(function(b,c){return a.$1.createAnswer(b,c)})};f.next=4;return b("regeneratorRuntime").awrap(e());case 4:d=f.sent;f.next=10;break;case 7:f.next=9;return b("regeneratorRuntime").awrap(this.$1.createAnswer());case 9:d=f.sent;case 10:return f.abrupt("return",new(c("ZenonSDP"))(d,this.getSdpFormat()));case 11:case"end":return f.stop()}},null,this)};e.setRemoteDescription=function(a){var d=this,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:this.$13(a.getMedia(),this.$11);if(!this.$14()){g.next=14;break}g.prev=2;e=a.toDesc();g.next=6;return b("regeneratorRuntime").awrap(new(b("Promise"))(function(a,b){d.$1.setRemoteDescription(e,a,b)}));case 6:g.next=12;break;case 8:g.prev=8;g.t0=g["catch"](2);c("FBLogger")("rtc_www").catching(g.t0).mustfix("Error processing legacy API setRemoteDescription in ZenonRTCPeerConnectionWrapper.");throw g.t0;case 12:g.next=24;break;case 14:g.prev=14;f=a.toDesc();g.next=18;return b("regeneratorRuntime").awrap(this.$1.setRemoteDescription(f));case 18:g.next=24;break;case 20:g.prev=20;g.t1=g["catch"](14);c("FBLogger")("rtc_www").catching(g.t1).mustfix("Error processing modern API setRemoteDescription in ZenonRTCPeerConnectionWrapper.");throw g.t1;case 24:case"end":return g.stop()}},null,this,[[2,8],[14,20]])};e.setRemoteIceCandidate=function(a){if(this.$1.currentRemoteDescription===null){c("FBLogger")("rtc_www").mustfix("Remote ICE candidate should not be applied before remote description");return b("Promise").resolve()}return this.$1.addIceCandidate(a)};e.close=function(){d("ZenonRTCPeerConnectionHelper").closePeerConnection(this.$1)};e.restart=function(){this.$1=d("ZenonRTCPeerConnectionHelper").createPeerConnection(this.$2,this.$3,this.$4),this.addCachedEventListenersToPeerConnection()};e.addEventListener=function(a,b){this.$5.add(a,b),this.$1.addEventListener(a,b)};e.createDataChannel=function(a,b){if(d("ZenonBrowsers").isDataChannelSupported()&&!this.$6.has(a)){var e=this.$1.createDataChannel(a);e?(e.onmessage=function(a){return b(a.data)},this.$6.set(a,e)):c("recoverableViolation")("Unable to create requested data channel: "+a,"rtc_www")}};e.getAllEventListeners=function(){return this.$5.getAll()};e.getEventListenersForType=function(a){return c("orEmptyArray")(this.$5.getByType(a))};e.canAcceptRemoteSdp=function(){return this.$1.iceConnectionState!=="closed"&&this.$1.signalingState!=="closed"||!c("gkx")("4259")};e.removeEventListener=function(a,b){this.$5["delete"](a,b),this.$1.removeEventListener(a,b)};e.removeAllEventListeners=function(){var a=this;this.$5.forEachEventListener(function(b,c){a.$1.removeEventListener(b),a.$5["delete"](b,c)})};e.addCachedEventListenersToPeerConnection=function(){var a=this;this.$5.forEachEventListener(function(b,c){a.$1.addEventListener(b,c)})};e.addTrack=function(a,b){return b==null?this.$1.addTrack(a):this.$1.addTrack(a,b)};e.addTransceiver=function(a,b){return this.$1.addTransceiver(a,b)};e.getTransceivers=function(){return typeof this.$1.getTransceivers==="function"?this.$1.getTransceivers():[]};e.getTransceiverFromSender=function(a){return this.getTransceivers().find(function(b){return b.sender===a})};e.getReceivers=function(){return typeof this.$1.getReceivers==="function"?this.$1.getReceivers():[]};e.getSenders=function(){return typeof this.$1.getSenders==="function"?this.$1.getSenders():[]};e.getStats=function(a){return this.$1.getStats(a)};e.removeTrack=function(a){var b=!1;for(var d=this.$1.getSenders(),e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{f=d.next();if(f.done)break;g=f.value}g=g;g.track===a&&(this.$1.removeTrack(g),b=!0)}b||c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"ZenonRTCPeerConnectionWrapper.removeTrack: Could not find sender for track "+a.id,sdpFormat:this.getSdpFormat()})};e.supportsSimulcast=function(){return this.$7};e.getSimulcastInitialized=function(){return this.$9};e.setSimulcastInitialized=function(a){this.$9=a};e.$14=function(){return c("UserAgent").isBrowser("Chrome < 51")||c("UserAgent").isBrowser("Opera < 43")};e.$12=function(a){var c=this;return this.$14()?new(b("Promise"))(function(b,d){return c.$1.createOffer(b,d,a)}):b("Promise").resolve(this.$1.createOffer(a))};e.getSdpFormat=function(){var a;return(a=this.$3.sdpSemantics)!=null?a:c("ZenonSdpFormat").PLAN_B};e.$13=function(a,b){var d=this;if(this.getSdpFormat()===c("ZenonSdpFormat").PLAN_B)return;a.forEach(function(a){if(a.type!=="application"){var c=a.msid;c=d.getTrackIdFromMsid(c);c!=null&&a.mid!=null&&b.set(String(a.mid),c)}})};e.getTrackIdFromMsid=function(a){if(a!=null){a=a.split(" ");if(a.length>=2)return a[1];else c("FBLogger")("rtc_www").warn("MSID did not have an eligible ID for caching")}return null};e.getLocalMWTrackId=function(a){return a!==null?(a=this.$10.get(a))!=null?a:null:null};e.getRemoteMWTrackId=function(a){return a!==null?(a=this.$11.get(a))!=null?a:null:null};e.getCurrentRemoteDescription=function(){return this.$1.currentRemoteDescription!=null?new(c("ZenonSDP"))(this.$1.currentRemoteDescription,this.getSdpFormat()):null};return a}();g["default"]=a}),98);
__d("ZenonSDPManager",["FBLogger","ZenonBrowsers","ZenonInfraActionsLogger","ZenonPlatformExperiments","ZenonScreenShare","ZenonSdpFormat","gkx","performanceNow","qex","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h="http://www.webrtc.org/experiments/rtp-hdrext/playout-delay";a=function(){function a(a,b){this.$2=null,this.$3=null,this.$1=a,this.$4=b.getZenonSdpTransformConfig()}var e=a.prototype;e.getLocalSdp=function(){return this.$2};e.getRemoteSdp=function(){return this.$3};e.getSdpFormat=function(){return this.$1.getSdpFormat()};e.useForE2EE=function(){var a;return(a=c("qex")._("245"))!=null?a:!1};e.shouldPreferH264Multiway=function(){return this.useForE2EE()?!1:c("gkx")("1707280")};e.createLocalSdp=function(a,d){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:if(!(d==="offer")){f.next=6;break}f.next=3;return b("regeneratorRuntime").awrap(this.$1.createOffer(babelHelpers["extends"]({},c("gkx")("1829601")?{offerToReceiveAudio:this.$1.getSdpFormat()===c("ZenonSdpFormat").UNIFIED_PLAN?void 0:!0}:{},{offerToReceiveVideo:this.$1.getSdpFormat()===c("ZenonSdpFormat").UNIFIED_PLAN?void 0:!0,preserveH264:this.$4.isPreserveH264()})));case 3:f.t0=f.sent;f.next=9;break;case 6:f.next=8;return b("regeneratorRuntime").awrap(this.$1.createAnswer());case 8:f.t0=f.sent;case 9:e=f.t0;this.$4.isPreferIsacForGroupAudio()&&e.preferCodec("audio",{preferredCodec:"ISAC",preferredCodecRate:16e3});this.shouldPreferH264Multiway()&&(this.$4.isPreferSwH264()?e.preferH264Codec({levelAsymmetryAllowed:!0,packetizationMode:!0,profileLevelId:"42e01f"}):e.preferCodec("video",{preferredCodec:"H264",preferredCodecRate:9e4}));(!this.$4.isPreserveH264()||this.useForE2EE())&&e.removeCodec("H264");this.$5(e,!1);e.setVersion(a);this.$2=e;return f.abrupt("return",e);case 17:case"end":return f.stop()}},null,this)};e.setLocalSdp=function(a){var d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.prev=0;c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP]["+a.getType()+"] Set local description sdp :"+a.toLoggingString()});d=c("performanceNow")();f.next=5;return b("regeneratorRuntime").awrap(this.$1.setLocalDescription(a));case 5:e=c("performanceNow")()-d;c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"[ZP]["+a.getType()+"] Finished setting local sdp of type in: "+String(e)});f.next=13;break;case 9:f.prev=9;f.t0=f["catch"](0);c("ZenonInfraActionsLogger").logError({checkpoint:"[ZP] Failed to set local sdp",error:f.t0.toString(),errorDomain:"ZenonSDPManager_setLocalSdp",sdpFormat:this.$1.getSdpFormat()});throw f.t0;case 13:this.$2=a;case 14:case"end":return f.stop()}},null,this,[[0,9]])};e.rollbackSdp=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.prev=0;a.next=3;return b("regeneratorRuntime").awrap(this.$1.rollbackSdp());case 3:c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP] Successfully called rollback sdp"});a.next=10;break;case 6:a.prev=6;a.t0=a["catch"](0);c("ZenonInfraActionsLogger").logError({checkpoint:"[ZP] Failed to set rollback sdp",error:a.t0.toString(),errorDomain:"ZenonSDPManager_rollbackSDP",sdpFormat:this.$1.getSdpFormat()});throw a.t0;case 10:case"end":return a.stop()}},null,this,[[0,6]])};e.createAndSetLocalSdp=function(a,c){var d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(this.createLocalSdp(a,c));case 2:d=e.sent;e.next=5;return b("regeneratorRuntime").awrap(this.setLocalSdp(d));case 5:return e.abrupt("return",d);case 6:case"end":return e.stop()}},null,this)};e.setRemoteSdp=function(a,e){var f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:if(this.$1.canAcceptRemoteSdp()){h.next=2;break}return h.abrupt("return",a);case 2:e({name:"beginRemoteSdpMunging"});this.$5(a,!0);e({name:"endRemoteSdpMunging"});d("ZenonScreenShare").screenShareWithReplaceTrack()&&c("gkx")("2255")&&(c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP]["+a.getType()+"] Munge inactive media SSRC"}),a.mungeInactiveMediaSSRC(this.$1.getCurrentRemoteDescription()));h.prev=6;c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP]["+a.getType()+"] Set remote description sdp: "+a.toLoggingString()});f=c("performanceNow")();h.next=11;return b("regeneratorRuntime").awrap(this.$1.setRemoteDescription(a));case 11:g=c("performanceNow")()-f;c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP]["+a.getType()+"] Finished setting remote sdp in: "+String(g)});h.next=19;break;case 15:h.prev=15;h.t0=h["catch"](6);c("ZenonInfraActionsLogger").logError({checkpoint:"[ZP] Failed to set remote sdp",error:h.t0.toString(),errorDomain:"ZenonSDPManager_setRemoteSdp",sdpFormat:this.$1.getSdpFormat()});throw h.t0;case 19:this.$3=a;return h.abrupt("return",a);case 21:case"end":return h.stop()}},null,this,[[6,15]])};e.setRemoteIceCandidate=function(a){return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.prev=0;d.next=3;return b("regeneratorRuntime").awrap(this.$1.setRemoteIceCandidate(a));case 3:d.next=10;break;case 5:d.prev=5;d.t0=d["catch"](0);c("FBLogger")("rtc_www").catching(d.t0).warn("Failed to setRemoteIceCandidate with ",JSON.stringify(a));c("ZenonInfraActionsLogger").logError({checkpoint:"[ZP] Failed to set remote ice candidate",error:d.t0.toString(),errorDomain:"ZenonSDPManager_setRemoteIceCandidate",sdpFormat:this.$1.getSdpFormat()});throw d.t0;case 10:case"end":return d.stop()}},null,this,[[0,5]])};e.closePeerConnection=function(){this.$1.close()};e.restartPeerConnection=function(){this.$1.restart()};e.$5=function(a,b){var e;a.useDTLSOverCrypto();c("gkx")("2562")&&!d("ZenonBrowsers").isDataChannelSupported()&&a.stripDataChannel();d("ZenonPlatformExperiments").isOpusMungeEnabled()&&a.maybeAddPtimeForOpusOnly(d("ZenonPlatformExperiments").getOpusPtimeMungeValue());c("gkx")("1720807")&&a.addFmtpConfig("H264","sps-pps-idr-in-keyframe","1");this.$4.isDisableOpusStereo()&&a.addFmtpConfig("opus","stereo","0");a.addAudioNACK();b&&c("qex")._("1863445")&&(c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP] replacing audio cname in sdp to disable AV sync"}),a.replaceAudioCname("mungedStream"));!b&&!((e=c("qex")._("1863447"))!=null?e:!1)&&a.filterExtension(h);!b&&((e=c("qex")._("245"))!=null?e:!1)&&a.enableGFD()};return a}();g["default"]=a}),98);
__d("ZenonSimulcastDataMessageParser",["recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=null,c=0;a.perSsrcTargetBitrateBpsMap!=null&&(b=h(a.perSsrcTargetBitrateBpsMap));if(a.qualityMask!=null){a=parseInt(a.qualityMask,10);isNaN(a)||(c=a)}return{perSsrcTargetBitrateBpsMap:b,qualityMask:c}}function h(a){var b=new Map();Object.keys(a).forEach(function(d){var e=parseInt(a[d],10);if(isNaN(e)){c("recoverableViolation")("Simulcast bitrate string could not be parsed as int","rtc_www");return}b.set(d,e)});return b}g.parseSimulcastControlMessage=a}),98);
__d("ZenonPeerConnectionManager",["DateConsts","FBLogger","ZenonInfraActionsLogger","ZenonMediaChannelManager","ZenonMediaError","ZenonPeerConnectionStateMachine","ZenonRTCPeerConnectionConfig","ZenonRTCPeerConnectionWrapper","ZenonSDPManager","ZenonSimulcastDataMessageParser","ZenonSimulcastManager","ZenonSimulcastUtils","clearTimeout","gkx","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=30*d("DateConsts").MS_PER_SEC,i=6;a=function(){function a(a,b,d,e,f){var g=this;b===void 0&&(b=!1);d===void 0&&(d=function(){});e===void 0&&(e=!1);this.$5=null;this.$6=function(){};this.$7=new Set();this.$8=new Map();this.$9=!1;this.$11=null;this.$13=function(a){a=a.target;a=a.iceConnectionState;c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"iceConnectionStateChange: "+a,sdpFormat:g.$4.getSdpFormat()});var b=a==="connected"||a==="completed";a!=="checking"&&a!=="new"&&a!=="closed"&&g.$6({connected:b,name:"peerConnectionStateChanged",newState:a});b&&g.$6({name:"mediaConnected"});g.updateIceConnectionTimer(a);g.$1.processEvent({payload:{iceConnectionState:a},type:"iceConnectionStateChange"})};this.$15=function(a){a=a.target;a.signalingState==="closed"&&c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"Peer connection signaling state changed to closed",sdpFormat:g.$4.getSdpFormat()})};this.$14=function(a){a=a.candidate;a!=null&&g.$1.processEvent({payload:a,type:"iceCandidateReady"})};this.$9=b;this.$10=a.getSimulcastOverSignalingConfig().isSimulcastOverSignalingEnabled();this.$6=d;this.$5=null;d=c("ZenonRTCPeerConnectionConfig").getConfigZenonPlatform(e);this.$4=new(c("ZenonRTCPeerConnectionWrapper"))(a,babelHelpers["extends"]({},d),{},b);this.$6({name:"peerConnectionCreated",sdpFormat:d.sdpSemantics});this.$2=new(c("ZenonMediaChannelManager"))(this.$4,function(a){return g.$6({mediaStats:a,name:"setMediaStats"})},f);this.$3=new(c("ZenonSDPManager"))(this.$4,a);this.$1=new(c("ZenonPeerConnectionStateMachine"))(babelHelpers["extends"]({},this.$12(),{logEvent:function(a){return g.$6(a)},mediaChannelManager:this.$2,sdpManager:this.$3}));this.$4.addEventListener("iceconnectionstatechange",this.$13);this.$4.addEventListener("icecandidate",this.$14);this.$4.addEventListener("signalingstatechange",this.$15)}var b=a.prototype;b.updateIceConnectionTimer=function(a){var b=this,e=a==="connected"||a==="completed";a=a==="disconnected"||a==="failed";e&&this.$11!=null?(c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"Clearing platform connection drop timer",sdpFormat:this.$4.getSdpFormat()}),c("clearTimeout")(this.$11),this.$11=null):a&&this.$11==null&&(c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"Setting platform connection drop timer",sdpFormat:this.$4.getSdpFormat()}),this.$11=c("setTimeout")(function(){c("ZenonInfraActionsLogger").logCheckpointEmployeesTestUsersOnly({checkpoint:"Ending call on platform connection drop timeout",sdpFormat:b.$4.getSdpFormat()}),b.$1.processEvent({payload:{error:d("ZenonMediaError").ZenonMediaError.IceDisconnected,stopLocalTracks:!0},type:"endCall"})},h))};b.getLocalMediaStateVersion=function(){return this.$1.getLocalMediaStateVersion()};b.setLocalMediaStateVersion=function(a){this.$1.processEvent({payload:{version:a},type:"setLocalMediaStateVersion"})};b.addLocalTracks=function(a,b,c){this.$1.processEvent({payload:{callInitiator:c,mediaMode:b,tracks:a},type:"addLocalTracks"})};b.removeLocalTrack=function(a){this.$1.processEvent({payload:{trackId:a},type:"removeLocalTrack"})};b.replaceLocalTrack=function(a,b){this.$1.processEvent({payload:{replacementTrack:b,trackIdToReplace:a},type:"replaceLocalTrack"})};b.createDataChannel=function(a){var b=this;this.$7.add(a);this.$1.processEvent({payload:{dataChannelLabel:a,onDataChannelMessage:function(c){b.$1.processEvent({payload:{data:c,dataChannelLabel:a},type:"dataChannelMessageReceived"}),b.$9&&a==="data"&&!b.$10&&b.maybeHandleSimulcastDataMessage(c)}},type:"createDataChannel"})};b.onSimulcastSignalingDataMessage=function(a){this.$9&&this.$10&&this.maybeHandleSignalingSimulcastDataMessage(a)};b.createDataMessageSubscription=function(a,b){this.$8.has(a)||(this.$8.set(a,b),this.$1.processEvent({payload:{dataChannelLabel:a,onSignalingDataMessage:b},type:"createDataMessageSubscription"}))};b.removeDataMessageSubscription=function(a){if(this.$8.has(a)){var b;b=(b=this.$8.get(a))!=null?b:function(){};this.$8["delete"](a);this.$1.processEvent({payload:{dataChannelLabel:a,onSignalingDataMessage:b},type:"removeDataMessageSubscription"})}};b.getSdpFormat=function(){return this.$4.getSdpFormat()};b.getDataChannelLabels=function(){return this.$7};b.getDataMessageSubscriptions=function(){return this.$8};b.getSupportsSimulcastOverSignaling=function(){return this.$10};b.setSupportsSimulcastOverSignaling=function(a){this.$10=a};b.localMediaStateUpdateRetry=function(a){var b=this,c=this.$1.getContext();c.retryCount<i&&(c.retryCount++,c.localMediaStateUpdateRetryTimerId=window.setTimeout(function(){b.$1.processEvent({type:"localMediaStateUpdateRetry"})},a))};b.clearRetryCount=function(){var a=this.$1.getContext();a.retryCount=0};b.cancelPendingNegotiation=function(){this.$1.processEvent({type:"remoteSdpFailed"})};b.muteLocalTrack=function(a){this.$1.processEvent({payload:{trackId:a},type:"muteLocalTrack"})};b.unmuteLocalTrack=function(a){this.$1.processEvent({payload:{trackId:a},type:"unmuteLocalTrack"})};b.stopLocalTrack=function(a){this.$1.processEvent({payload:{trackId:a},type:"stopLocalTrack"})};b.applyLocalSdp=function(){this.$1.processEvent({type:"applyLocalSdp"})};b.applyMediaUpdate=function(a){this.$1.processEvent({payload:{mediaStates:a},type:"applyMediaUpdate"})};b.applyRemoteSdp=function(a,b,c,d,e){this.$1.processEvent({payload:{mediaStates:b,onProcessed:e,renegotiationOffer:d,sdp:a,source:c},type:"applyRemoteSdp"})};b.applyRemoteIceCandidate=function(a){this.$1.processEvent({payload:a,type:"applyRemoteIceCandidate"})};b.forceEncodingEnabled=function(a){this.$1.processEvent({payload:{enabled:a},type:"forceEncodingEnabled"})};b.end=function(a,b){var c=this.$2.timeSeries();this.$6({name:"logTSData",time_series:c});this.$1.processEvent({payload:{restart:b,stopLocalTracks:a},type:"endCall"})};b.restart=function(){this.end(!1,!0),this.$2.clearTracks(),this.$1.processEvent({type:"restartPeerConnection"})};b.getTracks=function(){return this.$2.getTracks()};b.updateTrackInfo=function(a){return this.$2.updateTrackInfo(a)};b.getLocalTracksForMWS=function(){return this.$2.getLocalTracksForMWS()};b.getRtpSenders=function(){return this.$4.getSenders()};b.getRtpReceivers=function(){return this.$4.getReceivers()};b.setPeerConnectionEventHandlers=function(a){this.$5=a};b.swapPeerConnectionEventHandlers=function(a){var b=this.$5;this.$5=a.$5;a.$5=b};b.registerNetworkStatusListener=function(a){this.$2.registerNetworkStatusListener(a)};b.registerTrackListener=function(a){this.$2.registerTrackListener(a)};b.setTrackListenersFromManager=function(a){this.$2.setTrackListenersFromManager(a.$2)};b.setLoggingEventHandler=function(a){this.$6=a};b.$12=function(){return{onConnectionDestroyed:this.$16("onConnectionDestroyed"),onConnectionDropped:this.$16("onConnectionDropped"),onConnectionEstablished:this.$16("onConnectionEstablished"),onCreateDataMessageSubscription:this.$16("onCreateDataMessageSubscription"),onDataChannelMessageReceived:this.$16("onDataChannelMessageReceived"),onIceCandidateReady:this.$16("onIceCandidateReady"),onLocalMediaStateUpdate:this.$16("onLocalMediaStateUpdate"),onLocalSdpSet:this.$16("onLocalSdpSet"),onRemoveDataMessageSubscription:this.$16("onRemoveDataMessageSubscription")}};b.$16=function(a){var b=this;return function(){if(b.$5&&b.$5[a]){var c;(c=b.$5)[a].apply(c,arguments)}}};b.maybeHandleSimulcastDataMessage=function(a){try{a=JSON.parse(a);a=a.body;if(a.videoUploadRequest){a=d("ZenonSimulcastDataMessageParser").parseSimulcastControlMessage(a.videoUploadRequest);this.handleSimulcastUploadRequest(a)}}catch(a){c("FBLogger")("rtc_www").warn("MaybeHandleSimulcastDataMessage failed:",a)}};b.maybeHandleSignalingSimulcastDataMessage=function(a){try{a=JSON.parse(a);if(a.qualityMask&&a.perSsrcTargetBitrateBpsMap){a={perSsrcTargetBitrateBpsMap:a.perSsrcTargetBitrateBpsMap,qualityMask:a.qualityMask};a=d("ZenonSimulcastDataMessageParser").parseSimulcastControlMessage(a);this.handleSimulcastUploadRequest(a)}}catch(a){c("FBLogger")("rtc_www").warn("MaybeHandleSignalingSimulcastDataMessage failed:",a)}};b.handleSimulcastUploadRequest=function(a){var b,e;if(!d("ZenonSimulcastUtils").isCurrentBrowserCompatibleWithSimulcast()||!this.$4.supportsSimulcast()||typeof ((b=window.RTCRtpSender)==null?void 0:b.prototype.getParameters)!=="function")return;b=this.$4.getSenders().filter(function(a){return a.track&&a.track.kind==="video"});if(b.length===0)return;b=b[0];if(c("gkx")("2019")){var f=this.$4.getTransceiverFromSender(b);if(!f||f.stopped)return}f=!1;var g=this.$2.getTracks();if((e=b.track)==null?void 0:e.id){g=g.get((e=b.track)==null?void 0:e.id);f=g&&g.contentType==="screen"}e=this.getTotalVideoParticipants();a=d("ZenonSimulcastManager").getSimulcastEncodingParameters(b.getParameters(),a,e,d("ZenonSimulcastManager").getSimulcastSsrcToLayerMap(((g=this.$3.getLocalSdp())==null?void 0:g.toDesc().sdp)||""),f,d("ZenonSimulcastManager").MAX_NUM_ACTIVE_LAYERS,{height:(e=(a=b.track)==null?void 0:a.getSettings().height)!=null?e:720,width:(f=(g=b.track)==null?void 0:g.getSettings().width)!=null?f:1280},d("ZenonSimulcastManager").ALLOW_SCREENSHARE_SIMULCAST,d("ZenonSimulcastManager").MIN_NUM_ACTIVE_LAYERS);e=a.params;b.setParameters(e)};b.getTotalVideoParticipants=function(){var a=this.$4.getTransceivers(),b=this.$4.getReceivers();if(a!=null&&a.length>0){a=a.filter(function(a){var b;return((b=a.receiver.track)==null?void 0:b.kind)==="video"&&a.currentDirection!=="inactive"&&((b=a.receiver.track)==null?void 0:b.readyState)==="live"});a=a.length}else{b=b.filter(function(a){return((a=a.track)==null?void 0:a.kind)==="video"});a=b.length+1}return a};return a}();g["default"]=a}),98);
__d("OverlayConfigLayer",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b){this.$1=a,this.$2=b}var b=a.prototype;b.getLayerSource=function(){return this.$1};b.getValue=function(a){return this.$2[a]};b.logExposure=function(a){};return a}();f["default"]=a}),66);
__d("OverlayConfigLayerBuilder",["OverlayConfigConstants","OverlayConfigLayer","unrecoverableViolation"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){this.$1=new Array(b("OverlayConfigConstants").OverlayConfigNumParameters).fill(b("OverlayConfigConstants").OverlayConfigNotPresentFlagValue),this.$2=a}var c=a.prototype;c.build=function(){return new(b("OverlayConfigLayer"))(this.$2,this.$1)};c.$3=function(a,c){a>=b("OverlayConfigConstants").OverlayConfigNumParameters&&b("unrecoverableViolation")("Parameter ID passed in exceeds max parameter id","rtc_www"),this.$1[a]=c};c.$4=function(a,b){this.$3(a,b?1:0)};c.setExampleConfigEnabled=function(a){this.$4(0,a)};c.setExampleConfigSomeBoolean=function(a){this.$4(2,a)};c.setExampleConfigSomeInteger=function(a){this.$3(1,a)};c.setExampleConfigSomeOtherInteger=function(a){this.$3(3,a)};c.setSimulcastOverSignalingConfigSimulcastOverSignalingEnabled=function(a){this.$4(651,a)};c.setZenonSdpTransformConfigPreserveH264=function(a){this.$4(244,a)};c.setZenonSdpTransformConfigPreferH264ForMwCall=function(a){this.$4(420,a)};c.setZenonSdpTransformConfigPreferSwH264=function(a){this.$4(421,a)};c.setZenonSdpTransformConfigAddAudioNack=function(a){this.$4(245,a)};c.setZenonSdpTransformConfigDisableOpusStereo=function(a){this.$4(246,a)};c.setZenonSdpTransformConfigPreferIsacForGroupAudio=function(a){this.$4(248,a)};c.setZenonSdpTransformConfigEnableOpusFmtpMunging=function(a){this.$4(1448,a)};c.setZenonSdpTransformConfigSetOpusUsedtx=function(a){this.$4(1444,a)};c.setZenonSdpTransformConfigSetOpusUseinbandfec=function(a){this.$4(1445,a)};c.setZenonSdpTransformConfigSetOpusMaxplaybackrate=function(a){this.$3(1446,a)};c.setZenonSdpTransformConfigSetOpusMaxaveragebitrate=function(a){this.$3(1447,a)};c.setZenonPeerConnectionConfigRtpDataChannels=function(a){this.$4(302,a)};c.setZenonStartCallImmediatelyConfigEnabled=function(a){this.$4(308,a)};c.setZenonMultiCallSupportConfigMaxConnectedCalls=function(a){this.$3(309,a)};c.setZenonPlatformSupportConfigSupportsZenonPlatform=function(a){this.$4(316,a)};c.setZenonPlatformSupportConfigStartImmediatelyEnabled=function(a){this.$4(318,a)};c.setZenonPlatformSupportConfigMaxConnectedCalls=function(a){this.$3(317,a)};c.setZenonPlatformSupportConfigParentWindowConnectionTimeoutMs=function(a){this.$3(319,a)};c.setZenonSimulcastConfigSimulcastEnabled=function(a){this.$4(453,a)};c.setDynamicRuleConfigEnabled=function(a){this.$4(1342,a)};c.setDynamicRuleConfigProcessIntervalMs=function(a){this.$3(1359,a)};return a}();e.exports=a}),null);
__d("ChromeOverlayConfigLayer",["OverlayConfigLayerBuilder","OverlayConfigLayerSource","ZenonBrowsers"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=new(c("OverlayConfigLayerBuilder"))(c("OverlayConfigLayerSource").BROWSER);a.setZenonSdpTransformConfigDisableOpusStereo(!0);a.setSimulcastOverSignalingConfigSimulcastOverSignalingEnabled(!0);a.setZenonPeerConnectionConfigRtpDataChannels(d("ZenonBrowsers").isDataChannelSupported());return a.build()}();b=a;g["default"]=b}),98);
__d("EdgeOverlayConfigLayer",["OverlayConfigLayerBuilder","OverlayConfigLayerSource"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=new(c("OverlayConfigLayerBuilder"))(c("OverlayConfigLayerSource").BROWSER);a.setZenonSdpTransformConfigDisableOpusStereo(!0);return a.build()}();b=a;g["default"]=b}),98);
__d("FirefoxOverlayConfigLayer",["OverlayConfigLayerBuilder","OverlayConfigLayerSource"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=new(c("OverlayConfigLayerBuilder"))(c("OverlayConfigLayerSource").BROWSER);a.setZenonSdpTransformConfigDisableOpusStereo(!0);return a.build()}();b=a;g["default"]=b}),98);
__d("OperaOverlayConfigLayer",["OverlayConfigLayerBuilder","OverlayConfigLayerSource","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=new(c("OverlayConfigLayerBuilder"))(c("OverlayConfigLayerSource").BROWSER);a.setZenonSdpTransformConfigDisableOpusStereo(!0);a.setZenonSdpTransformConfigPreserveH264(c("gkx")("1406693"));return a.build()}();b=a;g["default"]=b}),98);
__d("ZenonP2PMessageValidator",["ZenonActorHooks","ZenonP2PMessageTypes","err","orEmptyArray"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=JSON.parse(a);var b=a.call_id,e=a.from,f=a.id,g=a.msg_type,h=a.payload,i=a.source,j=a.to;a=a.type;if(j!=null&&j.toString()!==d("ZenonActorHooks").ZenonActor.getID())throw c("err")("P2P message.to field "+j+" does not match logged in user ID "+d("ZenonActorHooks").ZenonActor.getID()+" for msg_type "+g);if(e&&b&&h){j={call_id:b,from:e,id:f,msg_type:g,payload:h,source:i,type:a};return j}else throw c("err")("P2P message does not have valid from, call_id, and payload fields")}function b(a){if(a){var b=a.msg_type;switch(b){case d("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.OFFER:return i(a);case d("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.HANG_UP:return j(a);case d("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.ICE_CANDIDATE:return h(a);case d("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.OTHER_DISMISS:return k(a)}}return null}function h(a){var b=a.from,c=a.payload;a=a.source;c=JSON.parse(c);var e=c.call_id,f=c.capability,g=c.label,h=c.msg_id,i=c.sdp,j=c.sdp_line_idx,k=c.sdp_mid;c=c.version;e={call_id:e,capability:f,from:b,label:g,msg_id:h,sdp:i,sdp_line_idx:j,sdp_mid:k,source:a,type:d("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.ICE_CANDIDATE,version:c};return e}function i(a){var b,e,f=a.from,g=a.payload;a=a.source;g=JSON.parse(g);var h=g.call_id,i=g.calltype,j=g.capability;b=(b=g.escalation_conference_name)!=null?b:null;var k=c("orEmptyArray")(g.experiments),l=c("orEmptyArray")(g.extraParams);e=(e=g.fbexp)!=null?e:"";var m=g.handlescollision!==void 0?g.handlescollision:!1,n=g.offer_escalation_support!==void 0?g.offer_escalation_support:!1,o=g.msg_id,p=g.sdp;g=g.videoon;h={call_id:h,calltype:i,capability:j,escalation_conference_name:b,experiments:k,extraParams:l,fbexp:e,from:f,handlescollision:m,msg_id:o,offer_escalation_support:n,sdp:p,source:a,type:d("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.OFFER,videoon:g};return h}function j(a){var b=a.from,c=a.payload;a=a.source;c=JSON.parse(c);var e=c.call_id,f=c.capability,g=c.msg_id,h=c.reason;c=c.subreason;e={call_id:e,capability:f,from:b,msg_id:g,reason:h,source:a,subreason:c,type:d("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.HANG_UP};return e}function k(a){var b=a.from,c=a.payload;a=a.source;c=JSON.parse(c);var e=c.call_id,f=c.capability;c=c.msg_id;e={call_id:e,capability:f,from:b,msg_id:c,source:a,type:d("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.OTHER_DISMISS};return e}g.getValidP2PMessage=a;g.transformP2PMessage=b}),98);
__d("RTWebSignalingListener",["FBLogger","FBMqttChannel","ZenonDebugLogger","ZenonMWMessageReliabilityLogger","ZenonMWMessageTranslator","ZenonP2PMessageTranslator","ZenonP2PMessageValidator","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){}var b=a.prototype;b.subscribe=function(a,b,e){var f=this;c("FBMqttChannel").subscribe("/webrtc",function(e){var g=c("ZenonDebugLogger").getInstance(),h=d("ZenonP2PMessageValidator").getValidP2PMessage(e),i=d("ZenonP2PMessageValidator").transformP2PMessage(h);f.$1(e,b);if(i){e=d("ZenonP2PMessageTranslator").toSignalingMessage(i);e&&(g.logP2PMessageReceived(h),a(e),g.logP2PMessageProcessed(h))}});c("FBMqttChannel").subscribe("/rtc_multi",function(b){try{var g=JSON.parse(b),h=c("ZenonDebugLogger").getInstance();d("ZenonMWMessageReliabilityLogger").logReceivedMessage(g);h.logMWMessage("RECEIVED","MQTT",g);h=d("ZenonMWMessageTranslator").toSignalingMessage(g);a(h);e&&f.$2(b,e);d("ZenonMWMessageReliabilityLogger").logProcessingMessage(g)}catch(a){c("FBLogger")("rpweb").catching(a).warn("Error receiving MQTT message from /rtc_multi topic")}})};b.unsubscribe=function(){c("FBMqttChannel").unsubscribeAll("/webrtc"),c("FBMqttChannel").unsubscribeAll("/rtc_multi")};b.$1=function(a,b){try{a=JSON.parse(a);b(a)}catch(a){c("recoverableViolation")("Signaling messages should be json parsable. error:"+a,"rtweb")}};b.$2=function(a,b){try{a=JSON.parse(a);b(a)}catch(a){c("recoverableViolation")("Signaling messages should be json parsable. error:"+a,"rtweb")}};return a}();g["default"]=a}),98);
__d("ZenonOverlayConfigManager",["ChromeOverlayConfigLayer","EdgeOverlayConfigLayer","FirefoxOverlayConfigLayer","OperaOverlayConfigLayer","OverlayConfigManager","RTWebSignalingListener","UserAgentData"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.$1=a;this.$2=new(c("OverlayConfigManager"))();var b={Chrome:c("ChromeOverlayConfigLayer"),"Edge (Chromium Based)":c("EdgeOverlayConfigLayer"),Firefox:c("FirefoxOverlayConfigLayer"),Opera:c("OperaOverlayConfigLayer")};b=b[c("UserAgentData").browserName];b&&this.$2.layerManager.addLayer(b);a.appConfig&&this.$2.layerManager.addLayer(a.appConfig)}var b=a.prototype;b.getSignalingListener=function(){var a;return(a=this.$1.signalingListener)!=null?a:new(c("RTWebSignalingListener"))()};b.getConfigManager=function(){return this.$2};return a}();g["default"]=a}),98);
__d("ZenonCallSDK",["EventEmitter","ScotchCallModelEmitter","ScotchRTWebUserActionLogger","ScotchSignalingEventEmitter","ScotchUtils","ZenonBrowsers","ZenonCallsManager","ZenonCallsModelEmitter","ZenonInfraActionsLogger","ZenonOverlayConfigManager","ZenonPlatformExperiments","ZenonTransportEventEmitter","gkx","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(e,a);function e(b){var e;e=a.call(this)||this;b=new(c("ZenonOverlayConfigManager"))(b);e.$ZenonCallSDK2=b;var f=b.getConfigManager().getZenonPlatformSupportConfig().isSupportsZenonPlatform()&&h();e.$ZenonCallSDK1=f?new(c("ZenonCallsManager"))(b):new(c("ScotchUtils"))(b);b=f?d("ZenonCallsModelEmitter"):d("ScotchCallModelEmitter");b.CallsModelEmitterInstance.addListener("callsModelUpdate",function(a){e.emit("callsModelUpdate",a)});f?(c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"ZenonCallSDK is using platform: Zenon Platform"}),c("ZenonTransportEventEmitter").addListener("transportPlatformEvent",function(a){e.emit("signalingEvent",a)})):(c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"ZenonCallSDK is using platform: Scotch"}),c("ScotchSignalingEventEmitter").addListener("signalingPlatformEvent",function(a){e.emit("signalingEvent",a)}));return e}var f=e.prototype;f.initSignaling=function(a,b,d,e){var f=this.$ZenonCallSDK2.getConfigManager().getZenonPlatformSupportConfig().isSupportsZenonPlatform(),g=f&&h();g||c("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"Using Scotch because isSupportsZenonPlatform: "+f.toString()+" and isZenonPlatform: "+h().toString(),conferenceName:d});this.$ZenonCallSDK1.initializeSignaling(a,b,d,e)};f.endCall=function(a,b,c){this.$ZenonCallSDK1.endCall(a,b,c)};f.join=function(a){this.$ZenonCallSDK1.join(a)};f.ringParticipants=function(a,b){this.$ZenonCallSDK1.ringParticipants(a,b)};f.removeParticipants=function(a,b){this.$ZenonCallSDK1.removeParticipants(a,b)};f.forceEncodingEnabled=function(a,b){this.$ZenonCallSDK1.forceEncodingEnabled(a,b)};f.addLocalTrack=function(a,b){this.$ZenonCallSDK1.addLocalTrack(a,b)};f.removeLocalTrack=function(a,b){this.$ZenonCallSDK1.removeLocalTrack(a,b)};f.replaceLocalTrack=function(a,b,c,d){d===void 0&&(d=!1);return this.$ZenonCallSDK1.replaceLocalTrack(a,b,c,d)};f.muteTrack=function(a,b){this.$ZenonCallSDK1.muteTrack(a,b)};f.unmuteTrack=function(a,b){this.$ZenonCallSDK1.unmuteTrack(a,b)};f.stopLocalVideo=function(a,b){this.$ZenonCallSDK1.stopLocalVideo(a,b)};f.acceptVideoEscalation=function(a){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.next=2;return b("regeneratorRuntime").awrap(this.$ZenonCallSDK1.acceptVideoEscalation());case 2:case"end":return a.stop()}},null,this)};f.cancelVideoEscalation=function(a){this.$ZenonCallSDK1.cancelVideoEscalation()};f.startVideoEscalation=function(a){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.next=2;return b("regeneratorRuntime").awrap(this.$ZenonCallSDK1.startVideoEscalation());case 2:case"end":return a.stop()}},null,this)};f.createDataMessageSubscription=function(a,b,c){this.$ZenonCallSDK1.createDataMessageSubscription(a,b,c)};f.removeDataMessageSubscription=function(a,b,c){this.$ZenonCallSDK1.removeDataMessageSubscription(a,b,c)};f.sendGenericDataMessage=function(a,b,c,d,e){this.$ZenonCallSDK1.sendGenericDataMessage(a,b,c,d,e)};f.getLogIdentifiers=function(a){return this.$ZenonCallSDK1.getLogIdentifiers(a)};f.subscribeToRemoteVideo=function(a,b,c){this.$ZenonCallSDK1.subscribeToRemoteVideo(a,b,c)};f.unsubscribeFromStateSyncTopic=function(a,b){c("gkx")("1418215")&&this.$ZenonCallSDK1.unsubscribeFromStateSyncTopic(a,b)};f.subscribeToStateSyncTopic=function(a,b){c("gkx")("1418215")&&this.$ZenonCallSDK1.updateStateSyncTopic(a,b,null)};f.updateStateSyncTopic=function(a,b,d){c("gkx")("1418215")&&this.$ZenonCallSDK1.updateStateSyncTopic(a,b,d)};f.approveParticipants=function(a,b){if(!d("ZenonPlatformExperiments").shouldUseLobbyMode()){var e=b.toArray().join(", ");c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[WR] Product is trying to approve users "+e});return}this.$ZenonCallSDK1.approveParticipants(a,b)};f.denyParticipants=function(a,b){if(!d("ZenonPlatformExperiments").shouldUseLobbyMode()){var e=b.toArray().join(", ");c("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[WR] Product is trying to deny users "+e});return}this.$ZenonCallSDK1.denyParticipants(a,b)};f.getSdpFormat=function(a){return this.$ZenonCallSDK1.getSdpFormat(a)};f.getPlatformType=function(){return this.$ZenonCallSDK1.getPlatformType()};f.getSignalingProtocol=function(a){return this.$ZenonCallSDK1.getSignalingProtocol(a)};f.getMediaMode=function(a){return this.$ZenonCallSDK1.getMediaMode(a)};f.getConferenceName=function(a){return this.$ZenonCallSDK1.getConferenceName(a)};f.declineVideoEscalation_DEPRECATED=function(a){this.$ZenonCallSDK1.declineVideoEscalation(a)};f.notifyScreenShareStart_DEPRECATED=function(a){this.$ZenonCallSDK1.notifyScreenShareStart(a)};f.notifyScreenShareEnd_DEPRECATED=function(a){this.$ZenonCallSDK1.notifyScreenShareEnd(a)};f.getCallProtocolType_DEPRECATED=function(a){return this.$ZenonCallSDK1.getCallProtocolType()};f.initV2Infrastructure_DEPRECATED=function(a,b){this.$ZenonCallSDK1.initializeV2Infrastructure(a,b)};f.setLinkSurface=function(a,b){this.$ZenonCallSDK1.setLinkSurface(a,b)};f.submitRating_DEPRECATED=function(a,b,c,d){c===void 0&&(c=null),d===void 0&&(d=null),this.$ZenonCallSDK1.submitRating(a,b,c,d)};f.setRatingImpression_DEPRECATED=function(a,b,c){b===void 0&&(b=!1),c===void 0&&(c=!1),this.$ZenonCallSDK1.setRatingImpression(b,c)};return e}(c("EventEmitter"));function h(){var a=c("gkx")("1984542"),b=c("gkx")("1845186"),e=d("ZenonBrowsers").isFBWebviewWithChromeMinVersion(67)&&c("gkx")("1888615");return a||b||e}g["default"]=a}),98);